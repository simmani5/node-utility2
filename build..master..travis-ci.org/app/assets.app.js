/* this rollup was created with utility2
 * https://github.com/kaizhu256/node-utility2
 */



/*
assets.app.js

this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps

instruction
    1. save this script as assets.app.js
    2. run the shell-command:
        $ PORT=8081 node assets.app.js
    3. open a browser to http://127.0.0.1:8081 and play with the web-demo
    4. edit this script to suit your needs
*/
/* utility2.rollup.js begin */
/* istanbul ignore all */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function () {
    "use strict";
    // init utility2_app
    globalThis.utility2_app = (
        globalThis.utility2_app_old
        || globalThis.globalLocal
    );
    globalThis.utility2_app.local = globalThis.utility2_app;
    globalThis.utility2_app_old = null;
}());



/* script-begin /assets.utility2.rollup.js */
/* this rollup was created with utility2
 * https://github.com/kaizhu256/node-utility2
 */



/* script-begin /assets.utility2.rollup.begin.js */
/* utility2.rollup.js begin */
/* istanbul ignore all */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function () {
    "use strict";
    // init utility2_rollup
    globalThis.utility2_rollup = (
        globalThis.utility2_rollup_old
        || globalThis.globalLocal
    );
    globalThis.utility2_rollup.local = globalThis.utility2_rollup;
    globalThis.utility2_rollup_old = null;
}());
/* script-end /assets.utility2.rollup.begin.js */



/* script-begin /assets.utility2.lib.apidoc.js */
// usr/bin/env node
/*
 * lib.apidoc.js (2019.8.1)
 * https://github.com/kaizhu256/node-apidoc-lite
 * this zero-dependency package will auto-generate documentation for your npm-package with zero-config
 *
 */



/* istanbul instrument in package apidoc */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_apidoc = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.apidoc = local;



/* validateLineSortedReset */
local.cliRun = function (opt) {
/*
 * this function will run the cli with given <opt>
 */
    local.cliDict._eval = local.cliDict._eval || function () {
    /*
     * <code>
     * will eval <code>
     */
        globalThis.local = local;
        local.vm.runInThisContext(process.argv[3]);
    };
    local.cliDict["--eval"] = local.cliDict["--eval"] || local.cliDict._eval;
    local.cliDict["-e"] = local.cliDict["-e"] || local.cliDict._eval;
    local.cliDict._help = local.cliDict._help || function () {
    /*
     *
     * will print help
     */
        var commandList;
        var file;
        var packageJson;
        var text;
        var textDict;
        commandList = [
            {
                argList: "<arg2>  ...",
                description: "usage:",
                command: [
                    "<arg1>"
                ]
            }, {
                argList: "'console.log(\"hello world\")'",
                description: "example:",
                command: [
                    "--eval"
                ]
            }
        ];
        file = __filename.replace((
            /.*\//
        ), "");
        opt = Object.assign({}, opt);
        packageJson = require("./package.json");
        // validate comment
        opt.rgxComment = opt.rgxComment || (
            /\)\u0020\{\n(?:|\u0020{4})\/\*\n(?:\u0020|\u0020{5})\*((?:\u0020<[^>]*?>|\u0020\.\.\.)*?)\n(?:\u0020|\u0020{5})\*\u0020(will\u0020.*?\S)\n(?:\u0020|\u0020{5})\*\/\n(?:\u0020{4}|\u0020{8})\S/
        );
        textDict = {};
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {
            if (key[0] === "_" && key !== "_default") {
                return;
            }
            text = String(local.cliDict[key]);
            if (key === "_default") {
                key = "";
            }
            textDict[text] = textDict[text] || (ii + 2);
            ii = textDict[text];
            if (commandList[ii]) {
                commandList[ii].command.push(key);
                return;
            }
            try {
                commandList[ii] = opt.rgxComment.exec(text);
                commandList[ii] = {
                    argList: (commandList[ii][1] || "").trim(),
                    command: [
                        key
                    ],
                    description: commandList[ii][2]
                };
            } catch (ignore) {
                local.assertThrow(null, new Error(
                    "cliRun - cannot parse comment in COMMAND "
                    + key
                    + ":\nnew RegExp("
                    + JSON.stringify(opt.rgxComment.source)
                    + ").exec(" + JSON.stringify(text).replace((
                        /\\\\/g
                    ), "\u0000").replace((
                        /\\n/g
                    ), "\\n\\\n").replace((
                        /\u0000/g
                    ), "\\\\") + ");"
                ));
            }
        });
        text = "";
        text += packageJson.name + " (" + packageJson.version + ")\n\n";
        text += commandList.filter(function (elem) {
            return elem;
        }).map(function (elem, ii) {
            elem.command = elem.command.filter(function (elem) {
                return elem;
            });
            switch (ii) {
            case 0:
            case 1:
                elem.argList = [
                    elem.argList
                ];
                break;
            default:
                elem.argList = elem.argList.split(" ");
                elem.description = (
                    "# COMMAND "
                    + (elem.command[0] || "<none>") + "\n# "
                    + elem.description
                );
            }
            return (
                elem.description + "\n  " + file
                + ("  " + elem.command.sort().join("|") + "  ")
                    .replace((
                    /^\u0020{4}$/
                ), "  ")
                + elem.argList.join("  ")
            );
        })
        .join("\n\n");
        console.log(text);
    };
    local.cliDict["--help"] = local.cliDict["--help"] || local.cliDict._help;
    local.cliDict["-h"] = local.cliDict["-h"] || local.cliDict._help;
    local.cliDict._default = local.cliDict._default || local.cliDict._help;
    local.cliDict.help = local.cliDict.help || local.cliDict._help;
    local.cliDict._interactive = local.cliDict._interactive || function () {
    /*
     *
     * will start interactive-mode
     */
        globalThis.local = local;
        local.identity(local.replStart || require("repl").start)({
            useGlobal: true
        });
    };
    local.cliDict["--interactive"] = (
        local.cliDict["--interactive"]
        || local.cliDict._interactive
    );
    local.cliDict["-i"] = local.cliDict["-i"] || local.cliDict._interactive;
    local.cliDict._version = local.cliDict._version || function () {
    /*
     *
     * will print version
     */
        console.log(require(__dirname + "/package.json").version);
    };
    local.cliDict["--version"] = (
        local.cliDict["--version"]
        || local.cliDict._version
    );
    local.cliDict["-v"] = local.cliDict["-v"] || local.cliDict._version;
    // default to --help command if no arguments are given
    if (process.argv.length <= 2) {
        local.cliDict._help();
        return;
    }
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        return;
    }
    local.cliDict._default();
};

local.moduleDirname = function (module, modulePathList) {
/*
 * this function will search modulePathList for the module's __dirname
 */
    var result;
    // search process.cwd()
    if (!module || module === "." || module.indexOf("/") >= 0) {
        return require("path").resolve(process.cwd(), module || "");
    }
    // search modulePathList
    [
        "node_modules"
    ]
    .concat(modulePathList)
    .concat(require("module").globalPaths)
    .concat([
        process.env.HOME + "/node_modules", "/usr/local/lib/node_modules"
    ])
    .some(function (modulePath) {
        try {
            result = require("path").resolve(
                process.cwd(),
                modulePath + "/" + module
            );
            result = require("fs").statSync(result).isDirectory() && result;
            return result;
        } catch (ignore) {
            result = null;
        }
        return result;
    });
    return result || "";
};

local.objectSetDefault = function (dict, defaults, depth) {
/*
 * this function will recursively set defaults for undefined-items in dict
 */
    dict = dict || {};
    defaults = defaults || {};
    Object.keys(defaults).forEach(function (key) {
        var defaults2;
        var dict2;
        dict2 = dict[key];
        // handle misbehaving getter
        try {
            defaults2 = defaults[key];
        } catch (ignore) {}
        if (defaults2 === undefined) {
            return;
        }
        // init dict[key] to default value defaults[key]
        switch (dict2) {
        case "":
        case null:
        case undefined:
            dict[key] = defaults2;
            return;
        }
        // if dict2 and defaults2 are both non-null and non-array objects,
        // then recurse with dict2 and defaults2
        if (
            depth > 1
            // dict2 is a non-null and non-array object
            && typeof dict2 === "object" && dict2 && !Array.isArray(dict2)
            // defaults2 is a non-null and non-array object
            && typeof defaults2 === "object" && defaults2
            && !Array.isArray(defaults2)
        ) {
            // recurse
            local.objectSetDefault(dict2, defaults2, depth - 1);
        }
    });
    return dict;
};

local.stringHtmlSafe = function (text) {
/*
 * this function will make the text html-safe
 * https://stackoverflow.com/questions/7381974/which-characters-need-to-be-escaped-on-html
 */
    return text
    .replace((
        /&/g
    ), "&amp;")
    .replace((
        /"/g
    ), "&quot;")
    .replace((
        /'/g
    ), "&apos;")
    .replace((
        /</g
    ), "&lt;")
    .replace((
        />/g
    ), "&gt;")
    .replace((
        /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
    ), "&$1");
};

/* jslint ignore:start */
local.templateApidocHtml = '\
<div class="apidocDiv">\n\
<style>\n\
/*csslint\n\
*/\n\
.apidocDiv {\n\
    background: #fff;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
}\n\
.apidocDiv a[href] {\n\
    color: #33f;\n\
    font-weight: bold;\n\
    text-decoration: none;\n\
}\n\
.apidocDiv a[href]:hover {\n\
    text-decoration: underline;\n\
}\n\
.apidocCodeCommentSpan {\n\
    background: #bbf;\n\
    color: #000;\n\
    display: block;\n\
}\n\
.apidocCodeKeywordSpan {\n\
    color: #d00;\n\
    font-weight: bold;\n\
}\n\
.apidocCodePre {\n\
    background: #eef;\n\
    border: 1px solid;\n\
    color: #777;\n\
    overflow-wrap: break-word;\n\
    padding: 5px;\n\
    white-space: pre-wrap;\n\
}\n\
.apidocFooterDiv {\n\
    margin-top: 20px;\n\
    text-align: center;\n\
}\n\
.apidocModuleLi {\n\
    margin-top: 10px;\n\
}\n\
.apidocSectionDiv {\n\
    border-top: 1px solid;\n\
    margin-top: 20px;\n\
}\n\
.apidocSignatureSpan {\n\
    color: #777;\n\
    font-weight: bold;\n\
}\n\
</style>\n\
<h1>api documentation for\n\
    <a\n\
        {{#if env.npm_package_homepage}}\n\
        href="{{env.npm_package_homepage}}"\n\
        {{/if env.npm_package_homepage}}\n\
    >{{env.npm_package_name}} ({{env.npm_package_version}})</a>\n\
</h1>\n\
<h4>{{env.npm_package_description}}</h4>\n\
<div class="apidocSectionDiv"><a\n\
    href="#apidoc.tableOfContents"\n\
    id="apidoc.tableOfContents"\n\
><h1>table of contents</h1></a><ol>\n\
    {{#each moduleList}}\n\
    <li class="apidocModuleLi"><a href="#{{id}}">module {{name}}</a><ol>\n\
        {{#each elemList}}\n\
        <li>\n\
            {{#if source}}\n\
            <a class="apidocElementLiA" href="#{{id}}">\n\
            {{name}}\n\
            <span class="apidocSignatureSpan">{{signature}}</span>\n\
            </a>\n\
            {{#unless source}}\n\
            <span class="apidocSignatureSpan">{{name}}</span>\n\
            {{/if source}}\n\
        </li>\n\
        {{/each elemList}}\n\
    </ol></li>\n\
    {{/each moduleList}}\n\
</ol></div>\n\
{{#each moduleList}}\n\
<div class="apidocSectionDiv">\n\
<h1><a href="#{{id}}" id="{{id}}">module {{name}}</a></h1>\n\
    {{#each elemList}}\n\
    {{#if source}}\n\
    <h2>\n\
        <a href="#{{id}}" id="{{id}}">\n\
        {{name}}\n\
        <span class="apidocSignatureSpan">{{signature}}</span>\n\
        </a>\n\
    </h2>\n\
    <ul>\n\
    <li>description and source-code<pre class="apidocCodePre">{{source truncate 4096}}</pre></li>\n\
    <li>example usage<pre class="apidocCodePre">{{example}}</pre></li>\n\
    </ul>\n\
    {{/if source}}\n\
    {{/each elemList}}\n\
</div>\n\
{{/each moduleList}}\n\
<div class="apidocFooterDiv">\n\
    [ this document was created with\n\
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>\n\
    ]\n\
</div>\n\
</div>\n\
';
/* jslint ignore:end */

local.templateRender = function (template, dict, opt) {
/*
 * this function will render the template with given dict
 */
    var argList;
    var getValue;
    var match;
    var renderPartial;
    var rgx;
    var skip;
    var value;
    dict = dict || {};
    opt = opt || {};
    getValue = function (key) {
        argList = key.split(" ");
        value = dict;
        if (argList[0] === "#this/") {
            return;
        }
        // iteratively lookup nested values in the dict
        argList[0].split(".").forEach(function (key) {
            value = value && value[key];
        });
        return value;
    };
    renderPartial = function (match0, helper, key, partial) {
        switch (helper) {
        case "each":
        case "eachTrimRightComma":
            value = getValue(key);
            value = (
                Array.isArray(value)
                ? value.map(function (dict) {
                    // recurse with partial
                    return local.templateRender(partial, dict, opt);
                }).join("")
                : ""
            );
            // remove trailing-comma from last elem
            if (helper === "eachTrimRightComma") {
                value = value.trimRight().replace((
                    /,$/
                ), "");
            }
            return value;
        case "if":
            partial = partial.split("{{#unless " + key + "}}");
            partial = (
                getValue(key)
                ? partial[0]
                // handle 'unless' case
                : partial.slice(1).join("{{#unless " + key + "}}")
            );
            // recurse with partial
            return local.templateRender(partial, dict, opt);
        case "unless":
            return (
                getValue(key)
                ? ""
                // recurse with partial
                : local.templateRender(partial, dict, opt)
            );
        default:
            // recurse with partial
            return match0[0] + local.templateRender(match0.slice(1), dict, opt);
        }
    };
    // render partials
    rgx = (
        /\{\{#(\w+)\u0020([^}]+?)\}\}/g
    );
    template = template || "";
    match = rgx.exec(template);
    while (match) {
        rgx.lastIndex += 1 - match[0].length;
        template = template.replace(
            new RegExp(
                "\\{\\{#(" + match[1] + ") (" + match[2]
                + ")\\}\\}([\\S\\s]*?)\\{\\{/" + match[1] + " " + match[2]
                + "\\}\\}"
            ),
            renderPartial
        );
        match = rgx.exec(template);
    }
    // search for keys in the template
    return template.replace((
        /\{\{[^}]+?\}\}/g
    ), function (match0) {
        var markdownToHtml;
        var notHtmlSafe;
        notHtmlSafe = opt.notHtmlSafe;
        try {
            getValue(match0.slice(2, -2));
            if (value === undefined) {
                return match0;
            }
            argList.slice(1).forEach(function (arg0, ii, list) {
                switch (arg0) {
                case "alphanumeric":
                    value = value.replace((
                        /\W/g
                    ), "_");
                    break;
                case "decodeURIComponent":
                    value = decodeURIComponent(value);
                    break;
                case "encodeURIComponent":
                    value = encodeURIComponent(value);
                    break;
                case "jsonStringify":
                    value = JSON.stringify(value);
                    break;
                case "jsonStringify4":
                    value = JSON.stringify(value, null, 4);
                    break;
                case "markdownSafe":
                    value = value.replace((
                        /`/g
                    ), "'");
                    break;
                case "markdownToHtml":
                    markdownToHtml = true;
                    break;
                case "notHtmlSafe":
                    notHtmlSafe = true;
                    break;
                case "padEnd":
                case "padStart":
                case "slice":
                    skip = ii + 2;
                    value = String(value)[arg0](
                        list[skip - 1],
                        list[skip]
                    );
                    break;
                case "truncate":
                    skip = ii + 1;
                    if (value.length > list[skip]) {
                        value = value.slice(
                            0,
                            Math.max(list[skip] - 3, 0)
                        ).trimRight() + "...";
                    }
                    break;
                // default to String.prototype[arg0]()
                default:
                    if (ii <= skip) {
                        break;
                    }
                    value = value[arg0]();
                }
            });
            value = String(value);
            // default to htmlSafe
            if (!notHtmlSafe) {
                value = value
                .replace((
                    /&/g
                ), "&amp;")
                .replace((
                    /"/g
                ), "&quot;")
                .replace((
                    /'/g
                ), "&apos;")
                .replace((
                    /</g
                ), "&lt;")
                .replace((
                    />/g
                ), "&gt;")
                .replace((
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
                ), "&$1");
            }
            markdownToHtml = (
                markdownToHtml
                && (typeof local.marked === "function" && local.marked)
            );
            if (markdownToHtml) {
                value = markdownToHtml(value)
                .replace((
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
                ), "&$1");
            }
            return value;
        } catch (errCaught) {
            errCaught.message = (
                "templateRender could not render expression "
                + JSON.stringify(match0)
                + "\n"
            ) + errCaught.message;
            local.assertThrow(null, errCaught);
        }
    });
};

local.tryCatchOnError = function (fnc, onError) {
/*
 * this function will run the fnc in a tryCatch block,
 * else call onError with errCaught
 */
    var result;
    // validate onError
    local.assertThrow(typeof onError === "function", typeof onError);
    try {
        // reset errCaught
        local._debugTryCatchError = null;
        result = fnc();
        local._debugTryCatchError = null;
        return result;
    } catch (errCaught) {
        // debug errCaught
        local._debugTryCatchError = errCaught;
        return onError(errCaught);
    }
};
}());



// run shared js-env code - function
(function () {
local.apidocCreate = function (opt) {
/*
 * this function will create the apidoc from <opt>.dir
 */
    var elemCreate;
    var module;
    var moduleMain;
    var readExample;
    var tmp;
    var toString;
    var trimLeft;
    elemCreate = function (module, prefix, key) {
    /*
     * this function will create the apidoc-elem in given <module>
     */
        var elem;
        if (opt.modeNoApidoc) {
            return elem;
        }
        elem = {};
        elem.moduleName = prefix.split(".");
        // handle case where module is a function
        if (elem.moduleName.slice(-1)[0] === key) {
            elem.moduleName.pop();
        }
        elem.moduleName = elem.moduleName.join(".");
        elem.id = encodeURIComponent("apidoc.elem." + prefix + "." + key);
        elem.typeof = typeof module[key];
        elem.name = (
            elem.typeof + " <span class=\"apidocSignatureSpan\">"
            + elem.moduleName + ".</span>" + key
        )
            // handle case where module is a function
            .replace(">.<", "><");
        if (elem.typeof !== "function") {
            return elem;
        }
        // init source
        elem.source = local.stringHtmlSafe(
            trimLeft(toString(module[key])) || "n/a"
        ).replace((
            /\([\S\s]*?\)/
        ), function (match0) {
            // init signature
            elem.signature = match0.replace((
                /\u0020*?\/\*[\S\s]*?\*\/\u0020*/g
            ), "")
            .replace((
                /,/g
            ), ", ")
            .replace((
                /\s+/g
            ), " ");
            return elem.signature;
        })
        .replace((
            /(\u0020*?\/\*[\S\s]*?\*\/\n)/
        ), "<span class=\"apidocCodeCommentSpan\">$1</span>")
        .replace((
            /^function\u0020\(/
        ), key + " = function (");
        // init example
        opt.exampleList.some(function (example) {
            example.replace(
                new RegExp("((?:\n.*?){8}\\.)(" + key + ")(\\((?:.*?\n){8})"),
                function (ignore, match1, match2, match3) {
                    elem.example = "..." + trimLeft(
                        local.stringHtmlSafe(match1)
                        + "<span class=\"apidocCodeKeywordSpan\">"
                        + local.stringHtmlSafe(match2)
                        + "</span>"
                        + local.stringHtmlSafe(match3)
                    ).trimRight() + "\n...";
                }
            );
            return elem.example;
        });
        elem.example = elem.example || "n/a";
        return elem;
    };
    readExample = function (file) {
    /*
     * this function will read the example from given file
     */
        var result;
        local.tryCatchOnError(function () {
            file = local.path.resolve(opt.dir, file);
            console.error("apidocCreate - readExample " + file);
            result = "";
            result = (
                "\n\n\n\n\n\n\n\n"
                // bug-workaround - truncate example to manageable size
                + local.fs.readFileSync(file, "utf8").slice(0, 262144)
                + "\n\n\n\n\n\n\n\n"
            ).replace((
                /\r\n*/g
            ), "\n");
        }, console.error);
        return result;
    };
    toString = function (value) {
    /*
     * this function will try to return the string form of the value
     */
        var result;
        local.tryCatchOnError(function () {
            result = "";
            result = String(value);
        }, console.error);
        return result;
    };
    trimLeft = function (text) {
    /*
     * this function will normalize the whitespace around the text
     */
        var whitespace;
        whitespace = "";
        text.trim().replace((
            /^\u0020*/gm
        ), function (match0) {
            if (!whitespace || match0.length < whitespace.length) {
                whitespace = match0;
            }
        });
        text = text.replace(new RegExp("^" + whitespace, "gm"), "");
        // enforce 128 character column limit
        text = text.replace((
            /^.{128}[^\\\n]+/gm
        ), function (match0) {
            return match0.replace((
                /(.{128}(?:\b|\w+))/g
            ), "$1\n").trimRight();
        });
        return text;
    };
    // init opt
    opt.dir = local.moduleDirname(
        opt.dir,
        opt.modulePathList || require("module").paths
    );
    local.objectSetDefault(opt, {
        env: {
            npm_package_description: ""
        },
        packageJson: JSON.parse(readExample("package.json")),
        require: function (file) {
            return local.tryCatchOnError(function () {
                return require(file);
            }, console.error);
        }
    });
    Object.keys(opt.packageJson).forEach(function (key) {
        tmp = opt.packageJson[key];
        // strip email from npmdoc documentation
        // https://github.com/npmdoc/node-npmdoc-hpp/issues/1
        if (tmp) {
            if (tmp.email) {
                delete tmp.email;
            }
            if (Array.isArray(tmp)) {
                tmp.forEach(function (elem) {
                    if (elem && elem.email) {
                        delete elem.email;
                    }
                });
            }
        }
        if (key[0] === "_" || key === "readme") {
            delete opt.packageJson[key];
        } else if (typeof tmp === "string") {
            opt.env["npm_package_" + key] = tmp;
        }
    });
    local.objectSetDefault(opt, {
        blacklistDict: {
            globalThis
        },
        circularSet: new Set([
            globalThis
        ]),
        exampleDict: {},
        exampleList: [],
        html: "",
        libFileList: [],
        moduleDict: {},
        moduleExtraDict: {},
        packageJson: {
            bin: {}
        },
        template: local.templateApidocHtml,
        whitelistDict: {}
    }, 2);
    // init exampleList
    ([
        1, 2, 3, 4
    ]).forEach(function (depth) {
        opt.exampleList = opt.exampleList.concat(
            // find . -maxdepth 1 -mindepth 1 -name "*.js" -type f
            // https://stackoverflow.com/questions/4509624/how-to-limit-depth-for-recursive-file-list
            local.child_process.execSync(
                "find \"" + opt.dir
                + "\" -maxdepth " + depth + " -mindepth " + depth
                + " -type f | sed -e \"s|" + opt.dir
                + "/||\" | grep -iv "
/* jslint ignore:start */
+ '"\
/\\.\\|\\(\\b\\|_\\)\\(\
bower_component\\|\
coverage\\|\
git\\|\
min\\|\
node_module\\|\
rollup\\|\
tmp\\|\
vendor\\)s\\{0,1\\}\\(\\b\\|_\\)\
" '
/* jslint ignore:end */
                + " | sort | head -n 256"
            ).toString()
            .split("\n")
        );
    });
    opt.exampleList = opt.exampleList.filter(function (file) {
        if (file && !opt.exampleDict[file]) {
            opt.exampleDict[file] = true;
            return true;
        }
    }).slice(0, 256).map(readExample);
    // init moduleMain
    local.tryCatchOnError(function () {
        console.error("apidocCreate - requiring " + opt.dir + " ...");
        moduleMain = {};
        moduleMain = (
            opt.moduleDict[opt.env.npm_package_name]
            || opt.require(opt.dir)
            || opt.require(
                opt.dir + "/"
                + (opt.packageJson.bin)[Object.keys(opt.packageJson.bin)[0]]
            ) || {}
        );
        opt.circularSet.add(moduleMain);
        console.error("apidocCreate - ... required " + opt.dir);
    }, console.error);
    tmp = {};
    // handle case where module is a function
    if (typeof moduleMain === "function") {
        (function () {
            var text;
            text = toString(moduleMain);
            tmp = function () {
                return;
            };
            // coverage-hack
            tmp();
            Object.defineProperties(tmp, {
                toString: {
                    get: function () {
                        return function () {
                            return text;
                        };
                    }
                }
            });
        }());
    }
    // normalize moduleMain
    moduleMain = local.objectSetDefault(tmp, moduleMain);
    opt.moduleDict[opt.env.npm_package_name] = moduleMain;
    // init circularSet - builtins
    [
        "assert",
        "buffer",
        "child_process",
        "cluster",
        "crypto",
        "dgram",
        "dns",
        "domain",
        "events",
        "fs",
        "http",
        "https",
        "net",
        "os",
        "path",
        "querystring",
        "readline",
        "repl",
        "stream",
        "string_decoder",
        "timers",
        "tls",
        "tty",
        "url",
        "util",
        "vm",
        "zlib"
    ].forEach(function (key) {
        local.tryCatchOnError(function () {
            opt.circularSet.add(require(key));
        }, local.nop);
    });
    // init circularSet - blacklistDict
    Object.keys(opt.blacklistDict).forEach(function (key) {
        opt.circularSet.add(opt.blacklistDict[key]);
    });
    // init circularSet - moduleDict
    Object.keys(opt.moduleDict).forEach(function (key) {
        opt.circularSet.add(opt.moduleDict[key]);
    });
    // init circularSet - prototype
    opt.circularSet.forEach(function (elem) {
        opt.circularSet.add(elem && elem.prototype);
    });
    // init moduleDict child
    local.apidocModuleDictAdd(opt, opt.moduleDict);
    // init swgg.apiDict
    Object.keys(
        (moduleMain.swgg && moduleMain.swgg.apiDict) || {}
    ).forEach(function (key) {
        tmp = "swgg.apiDict";
        opt.moduleDict[tmp] = opt.moduleDict[tmp] || {};
        tmp = opt.moduleDict[tmp];
        tmp[key + ".ajax"] = (
            moduleMain.swgg.apiDict[key]
            && moduleMain.swgg.apiDict[key].ajax
        );
    });
    // init moduleExtraDict
    opt.moduleExtraDict[opt.env.npm_package_name] = (
        opt.moduleExtraDict[opt.env.npm_package_name] || {}
    );
    module = opt.moduleExtraDict[opt.env.npm_package_name];
    ([
        1, 2, 3, 4
    ]).forEach(function (depth) {
        opt.libFileList = opt.libFileList.concat(
            // find . -maxdepth 1 -mindepth 1 -name "*.js" -type f
            // https://stackoverflow.com/questions/4509624/how-to-limit-depth-for-recursive-file-list
            local.child_process.execSync(
                "find \"" + opt.dir
                + "\" -maxdepth " + depth + " -mindepth " + depth
                + " -name \"*.js\" -type f | sed -e \"s|" + opt.dir
                + "/||\" | grep -iv "
/* jslint ignore:start */
+ '"\
/\\.\\|\\(\\b\\|_\\)\\(\
archive\\|artifact\\|asset\\|\
bower_component\\|build\\|\
coverage\\|\
doc\\|dist\\|\
example\\|external\\|\
fixture\\|\
git\\|\
log\\|\
min\\|mock\\|\
node_module\\|\
rollup\\|\
spec\\|\
test\\|tmp\\|\
vendor\\)s\\{0,1\\}\\(\\b\\|_\\)\
" '
/* jslint ignore:end */
                + " | sort | head -n 256"
            ).toString()
            .split("\n")
        );
    });
    opt.ii = 256;
    opt.libFileList.every(function (file) {
        local.tryCatchOnError(function () {
            tmp = {};
            tmp.name = local.path.basename(file)
            .replace("lib.", "")
            .replace((
                /\.[^.]*?$/
            ), "")
            .replace((
                /\W/g
            ), "_");
            ([
                tmp.name,
                tmp.name.slice(0, 1).toUpperCase() + tmp.name.slice(1)
            ]).some(function (name) {
                tmp.isFiltered = name && (
                    !opt.packageJson.main
                    || ("./" + file).indexOf(opt.packageJson.main) < 0
                ) && !module[name];
                return !tmp.isFiltered;
            });
            if (!tmp.isFiltered) {
                return;
            }
            console.error("apidocCreate - libFile " + file);
            tmp.module = opt.require(opt.dir + "/" + file);
            // filter circular-reference
            if (!(tmp.module && opt.circularSet.has(tmp.module))) {
                return;
            }
            opt.ii -= 1;
            module[tmp.name] = tmp.module;
        }, console.error);
        return opt.ii;
    });
    local.apidocModuleDictAdd(opt, opt.moduleExtraDict);
    Object.keys(opt.moduleDict).forEach(function (key) {
        if (key.indexOf(opt.env.npm_package_name + ".") !== 0) {
            return;
        }
        tmp = key.split(".").slice(1).join(".");
        moduleMain[tmp] = moduleMain[tmp] || opt.moduleDict[key];
    });
    // init moduleList
    opt.moduleList = Object.keys(opt.moduleDict)
    .sort()
    .map(function (prefix) {
        module = opt.moduleDict[prefix];
        // handle case where module is a function
        if (typeof module === "function") {
            local.tryCatchOnError(function () {
                module[prefix.split(".").slice(-1)[0]] = (
                    module[prefix.split(".").slice(-1)[0]] || module
                );
            }, console.error);
        }
        return {
            elemList: Object.keys(module).filter(function (key) {
                return local.tryCatchOnError(function () {
                    return (
                        key
                        && (
                            /^\w[\w\-.]*?$/
                        ).test(key)
                        && key.indexOf("testCase_") !== 0
                        && (
                            module[key] !== opt.blacklistDict[key]
                            || opt.whitelistDict[key]
                        )
                    );
                }, console.error);
            }).map(function (key) {
                return elemCreate(module, prefix, key);
            }).sort(function (aa, bb) {
                return (
                    aa.name > bb.name
                    ? 1
                    : -1
                );
            }),
            id: encodeURIComponent("apidoc.module." + prefix),
            name: prefix
        };
    });
    // render apidoc
    opt.result = local.templateRender(opt.template, opt, {
        notHtmlSafe: true
    })
    .trim()
    .replace((
        /\u0020+$/gm
    ), "") + "\n";
    return opt.result;
};

local.apidocModuleDictAdd = function (opt, moduleDict) {
/*
 * this function will add the modules in <moduleDict> to <opt>.moduleDict
 */
    var isModule;
    var objectKeys;
    var tmp;
    objectKeys = function (dict) {
    /*
     * this function will return a list of the dict's keys, with valid getters
     */
        return Object.keys(dict).sort().filter(function (key) {
            return local.tryCatchOnError(function () {
                return dict[key] || true;
            }, local.nop);
        });
    };
    [
        "child", "prototype", "grandchild", "prototype"
    ].forEach(function (elem) {
        objectKeys(moduleDict).forEach(function (prefix) {
            if (!(
                /^\w[\w\-.]*?$/
            ).test(prefix)) {
                return;
            }
            objectKeys(moduleDict[prefix]).forEach(function (key) {
                if (!(
                    /^\w[\w\-.]*?$/
                ).test(key) || !moduleDict[prefix][key]) {
                    return;
                }
                tmp = (
                    elem === "prototype"
                    ? {
                        module: moduleDict[prefix][key].prototype,
                        name: prefix + "." + key + ".prototype"
                    }
                    : {
                        module: moduleDict[prefix][key],
                        name: prefix + "." + key
                    }
                );
                if (
                    !tmp.module
                    || !(
                        typeof tmp.module === "function"
                        || typeof tmp.module === "object"
                    )
                    || Array.isArray(tmp.module)
                    || opt.moduleDict[tmp.name]
                    || opt.circularSet.has(tmp.module)
                ) {
                    return;
                }
                isModule = ([
                    tmp.module,
                    tmp.module.prototype
                ]).some(function (dict) {
                    return objectKeys(dict || {}).some(function (key) {
                        return typeof dict[key] === "function";
                    });
                });
                if (!isModule) {
                    return;
                }
                opt.circularSet.add(tmp.module);
                opt.moduleDict[tmp.name] = tmp.module;
            });
        });
    });
};
}());



// run node js-env code - init-after
/* istanbul ignore next */
(function () {
if (local.isBrowser) {
    return;
}



local.cliDict = {};

local.cliDict._default = function () {
/*
 * <moduleDirectory>
 * will create apidoc from <moduleDirectory>
 */
    // jslint files
    process.stdout.write(local.apidocCreate({
        dir: process.argv[2],
        modulePathList: module.paths
    }));
};

// run the cli
if (module === require.main && !globalThis.utility2_rollup) {
    local.cliRun();
}
}());



}());
/* script-end /assets.utility2.lib.apidoc.js */



/* script-begin /assets.utility2.lib.db.js */
// usr/bin/env node
/*
 * lib.db.js (2018.12.31)
 * https://github.com/kaizhu256/node-db-lite
 * this zero-dependency package will provide a persistent, in-browser database, with a working web-demo
 *
 * browser example:
    <script src="assets.db-lite.js"></script>
    <script>
    var dbTable1;
    dbTable1 = window.dbTable1 = window.utility2_db.dbTableCreateOne({
        name: "dbTable1"
    });
    dbTable1.idIndexCreate({ name: "field1" });
    dbTable1.crudSetOneById({ field1: "hello", field2: "world" });
    console.log(dbTable1.crudGetManyByQuery({
        limit: Infinity,
        query: { field1: "hello" },
        skip: 0,
        sort: [{ fieldName: 'field1', isDescending: false }]
    }));
    </script>
 *
 * node example:
    var db, dbTable1;
    utility2_db = require("./assets.db-lite.js");
    dbTable1 = global.dbTable1 = utility2_db.dbTableCreateOne({
        name: "dbTable1"
    });
    dbTable1.idIndexCreate({ name: "field1" });
    dbTable1.crudSetOneById({ field1: "hello", field2: "world" });
    console.log(dbTable1.crudGetManyByQuery({
        limit: Infinity,
        query: { field1: "hello" },
        skip: 0,
        sort: [{ fieldName: 'field1', isDescending: false }]
    }));
 */



/* istanbul instrument in package db */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_db = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.db = local;



/* validateLineSortedReset */
local.cliRun = function (opt) {
/*
 * this function will run the cli with given <opt>
 */
    local.cliDict._eval = local.cliDict._eval || function () {
    /*
     * <code>
     * will eval <code>
     */
        globalThis.local = local;
        local.vm.runInThisContext(process.argv[3]);
    };
    local.cliDict["--eval"] = local.cliDict["--eval"] || local.cliDict._eval;
    local.cliDict["-e"] = local.cliDict["-e"] || local.cliDict._eval;
    local.cliDict._help = local.cliDict._help || function () {
    /*
     *
     * will print help
     */
        var commandList;
        var file;
        var packageJson;
        var text;
        var textDict;
        commandList = [
            {
                argList: "<arg2>  ...",
                description: "usage:",
                command: [
                    "<arg1>"
                ]
            }, {
                argList: "'console.log(\"hello world\")'",
                description: "example:",
                command: [
                    "--eval"
                ]
            }
        ];
        file = __filename.replace((
            /.*\//
        ), "");
        opt = Object.assign({}, opt);
        packageJson = require("./package.json");
        // validate comment
        opt.rgxComment = opt.rgxComment || (
            /\)\u0020\{\n(?:|\u0020{4})\/\*\n(?:\u0020|\u0020{5})\*((?:\u0020<[^>]*?>|\u0020\.\.\.)*?)\n(?:\u0020|\u0020{5})\*\u0020(will\u0020.*?\S)\n(?:\u0020|\u0020{5})\*\/\n(?:\u0020{4}|\u0020{8})\S/
        );
        textDict = {};
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {
            if (key[0] === "_" && key !== "_default") {
                return;
            }
            text = String(local.cliDict[key]);
            if (key === "_default") {
                key = "";
            }
            textDict[text] = textDict[text] || (ii + 2);
            ii = textDict[text];
            if (commandList[ii]) {
                commandList[ii].command.push(key);
                return;
            }
            try {
                commandList[ii] = opt.rgxComment.exec(text);
                commandList[ii] = {
                    argList: (commandList[ii][1] || "").trim(),
                    command: [
                        key
                    ],
                    description: commandList[ii][2]
                };
            } catch (ignore) {
                local.assertThrow(null, new Error(
                    "cliRun - cannot parse comment in COMMAND "
                    + key
                    + ":\nnew RegExp("
                    + JSON.stringify(opt.rgxComment.source)
                    + ").exec(" + JSON.stringify(text).replace((
                        /\\\\/g
                    ), "\u0000").replace((
                        /\\n/g
                    ), "\\n\\\n").replace((
                        /\u0000/g
                    ), "\\\\") + ");"
                ));
            }
        });
        text = "";
        text += packageJson.name + " (" + packageJson.version + ")\n\n";
        text += commandList.filter(function (elem) {
            return elem;
        }).map(function (elem, ii) {
            elem.command = elem.command.filter(function (elem) {
                return elem;
            });
            switch (ii) {
            case 0:
            case 1:
                elem.argList = [
                    elem.argList
                ];
                break;
            default:
                elem.argList = elem.argList.split(" ");
                elem.description = (
                    "# COMMAND "
                    + (elem.command[0] || "<none>") + "\n# "
                    + elem.description
                );
            }
            return (
                elem.description + "\n  " + file
                + ("  " + elem.command.sort().join("|") + "  ")
                    .replace((
                    /^\u0020{4}$/
                ), "  ")
                + elem.argList.join("  ")
            );
        })
        .join("\n\n");
        console.log(text);
    };
    local.cliDict["--help"] = local.cliDict["--help"] || local.cliDict._help;
    local.cliDict["-h"] = local.cliDict["-h"] || local.cliDict._help;
    local.cliDict._default = local.cliDict._default || local.cliDict._help;
    local.cliDict.help = local.cliDict.help || local.cliDict._help;
    local.cliDict._interactive = local.cliDict._interactive || function () {
    /*
     *
     * will start interactive-mode
     */
        globalThis.local = local;
        local.identity(local.replStart || require("repl").start)({
            useGlobal: true
        });
    };
    local.cliDict["--interactive"] = (
        local.cliDict["--interactive"]
        || local.cliDict._interactive
    );
    local.cliDict["-i"] = local.cliDict["-i"] || local.cliDict._interactive;
    local.cliDict._version = local.cliDict._version || function () {
    /*
     *
     * will print version
     */
        console.log(require(__dirname + "/package.json").version);
    };
    local.cliDict["--version"] = (
        local.cliDict["--version"]
        || local.cliDict._version
    );
    local.cliDict["-v"] = local.cliDict["-v"] || local.cliDict._version;
    // default to --help command if no arguments are given
    if (process.argv.length <= 2) {
        local.cliDict._help();
        return;
    }
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        return;
    }
    local.cliDict._default();
};

local.jsonCopy = function (obj) {
/*
 * this function will deep-copy obj
 */
    return (
        obj === undefined
        ? undefined
        : JSON.parse(JSON.stringify(obj))
    );
};

local.jsonStringifyOrdered = function (obj, replacer, space) {
/*
 * this function will JSON.stringify <obj>,
 * with object-keys sorted and circular-references removed
 * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Syntax
 */
    var circularSet;
    var stringify;
    var tmp;
    stringify = function (obj) {
    /*
     * this function will recursively JSON.stringify obj,
     * with object-keys sorted and circular-references removed
     */
        // if obj is not an object or function, then JSON.stringify as normal
        if (!(
            obj
            && typeof obj === "object"
            && typeof obj.toJSON !== "function"
        )) {
            return JSON.stringify(obj);
        }
        // ignore circular-reference
        if (circularSet.has(obj)) {
            return;
        }
        circularSet.add(obj);
        // if obj is an array, then recurse its items
        if (Array.isArray(obj)) {
            tmp = "[" + obj.map(function (obj) {
                // recurse
                tmp = stringify(obj);
                return (
                    typeof tmp === "string"
                    ? tmp
                    : "null"
                );
            }).join(",") + "]";
            circularSet.delete(obj);
            return tmp;
        }
        // if obj is not an array,
        // then recurse its items with object-keys sorted
        tmp = "{" + Object.keys(obj).sort().map(function (key) {
            // recurse
            tmp = stringify(obj[key]);
            if (typeof tmp === "string") {
                return JSON.stringify(key) + ":" + tmp;
            }
        }).filter(function (obj) {
            return typeof obj === "string";
        }).join(",") + "}";
        circularSet.delete(obj);
        return tmp;
    };
    circularSet = new Set();
    return JSON.stringify((
        (typeof obj === "object" && obj)
        // recurse
        ? JSON.parse(stringify(obj))
        : obj
    ), replacer, space);
};

local.listShuffle = function (list) {
/*
 * this function will inplace shuffle <list> using fisher-yates algorithm
 * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle
 */
    var ii;
    var random;
    var swap;
    ii = list.length;
    while (ii > 1) {
        ii -= 1;
        random = Math.floor(Math.random() * (ii + 1));
        swap = list[ii];
        list[ii] = list[random];
        list[random] = swap;
    }
    return list;
};

local.objectSetOverride = function (dict, overrides, depth, env) {
/*
 * this function will recursively set overrides for items in dict
 */
    dict = dict || {};
    env = env || (typeof process === "object" && process.env) || {};
    overrides = overrides || {};
    Object.keys(overrides).forEach(function (key) {
        var dict2;
        var overrides2;
        dict2 = dict[key];
        overrides2 = overrides[key];
        if (overrides2 === undefined) {
            return;
        }
        // if both dict2 and overrides2 are non-null and non-array objects,
        // then recurse with dict2 and overrides2
        if (
            depth > 1
            // dict2 is a non-null and non-array object
            && typeof dict2 === "object" && dict2 && !Array.isArray(dict2)
            // overrides2 is a non-null and non-array object
            && typeof overrides2 === "object" && overrides2
            && !Array.isArray(overrides2)
        ) {
            local.objectSetOverride(dict2, overrides2, depth - 1, env);
            return;
        }
        // else set dict[key] with overrides[key]
        dict[key] = (
            dict === env
            // if dict is env, then overrides falsy-value with empty-string
            ? overrides2 || ""
            : overrides2
        );
    });
    return dict;
};

local.onErrorDefault = function (err) {
/*
 * this function will if <err> exists, then print it to stderr
 */
    if (err) {
        console.error(err);
    }
    return err;
};

local.onErrorWithStack = function (onError) {
/*
 * this function will create wrapper around <onError>
 * that will append current-stack to err.stack
 */
    var onError2;
    var stack;
    stack = new Error().stack.replace((
        /(.*?)\n.*?$/m
    ), "$1");
    onError2 = function (err, data, meta) {
        if (
            err
            && typeof err.stack === "string"
            && err !== local.errDefault
            && String(err.stack).indexOf(stack.split("\n")[2]) < 0
        ) {
            // append current-stack to err.stack
            err.stack += "\n" + stack;
        }
        onError(err, data, meta);
    };
    // debug onError
    onError2.toString = function () {
        return String(onError);
    };
    return onError2;
};

local.onParallel = function (onError, onEach, onRetry) {
/*
 * this function will create a function that will
 * 1. run async tasks in parallel
 * 2. if counter === 0 or err occurred, then call onError(err)
 */
    var onParallel;
    onError = local.onErrorWithStack(onError);
    onEach = onEach || local.nop;
    onRetry = onRetry || local.nop;
    onParallel = function (err, data) {
        if (onRetry(err, data)) {
            return;
        }
        // decrement counter
        onParallel.counter -= 1;
        // validate counter
        if (!(onParallel.counter >= 0 || err || onParallel.err)) {
            err = new Error(
                "invalid onParallel.counter = " + onParallel.counter
            );
        // ensure onError is run only once
        } else if (onParallel.counter < 0) {
            return;
        }
        // handle err
        if (err) {
            onParallel.err = err;
            // ensure counter <= 0
            onParallel.counter = -Math.abs(onParallel.counter);
        }
        // call onError when isDone
        if (onParallel.counter <= 0) {
            onError(err, data);
            return;
        }
        onEach();
    };
    // init counter
    onParallel.counter = 0;
    // return callback
    return onParallel;
};

local.replStart = function () {
/*
 * this function will start the repl-debugger
 */
    var that;
    if (globalThis.utility2_repl1) {
        return;
    }
    // start repl
    that = require("repl").start({
        useGlobal: true
    });
    globalThis.utility2_repl1 = that;
    that.onError = function (err) {
    /*
     * this function will debug repl-err
     */
        globalThis.utility2_debugReplError = err;
        console.error(err);
    };
    // save eval-function
    that.evalDefault = that.eval;
    // hook custom-eval-function
    that.eval = function (script, context, file, onError) {
        var onError2;
        onError2 = function (err, data) {
            // debug err
            globalThis.utility2_debugReplError = (
                err || globalThis.utility2_debugReplError
            );
            onError(err, data);
        };
        script.replace((
            /^(\S+)\u0020(.*?)\n/
        ), function (ignore, match1, match2) {
            switch (match1) {
            // syntax-sugar - run async shell-command
            case "$":
                switch (match2) {
                // syntax-sugar - run git diff
                case "git diff":
                    match2 = "git diff --color | cat";
                    break;
                // syntax-sugar - run git log
                case "git log":
                    match2 = "git log -n 4 | cat";
                    break;
                // syntax-sugar - run git log
                case "ll":
                    match2 = "ls -Fal";
                    break;
                }
                // source lib.utility2.sh
                if (
                    process.platform !== "win32"
                    && process.env.npm_config_dir_utility2 && (match2 !== ":")
                ) {
                    match2 = (
                        ". " + process.env.npm_config_dir_utility2
                        + "/lib.utility2.sh;" + match2
                    );
                }
                // run async shell-command
                require("child_process").spawn(match2, {
                    shell: true,
                    stdio: [
                        "ignore", 1, 2
                    ]
                // on shell exit, print return prompt
                }).on("exit", function (exitCode) {
                    console.error("exit-code " + exitCode);
                    that.evalDefault(
                        "\n",
                        context,
                        file,
                        onError2
                    );
                });
                script = "\n";
                break;
            // syntax-sugar - map text with charCodeAt
            case "charCode":
                console.error(
                    match2.split("").map(function (chr) {
                        return (
                            "\\u"
                            + chr.charCodeAt(0).toString(16).padStart(4, 0)
                        );
                    }).join("")
                );
                script = "\n";
                break;
            // syntax-sugar - sort chr
            case "charSort":
                console.error(JSON.stringify(match2.split("").sort().join("")));
                script = "\n";
                break;
            // syntax-sugar - grep current dir
            case "grep":
                // run async shell-command
                require("child_process").spawn((
                    "find . -type f | grep -v -E "
/* jslint ignore:start */
+ '"\
/\\.|(\\b|_)(\\.\\d|\
archive|artifact|\
bower_component|build|\
coverage|\
doc|\
external|\
fixture|\
git_module|\
jquery|\
log|\
min|misc|mock|\
node_module|\
raw|\rollup|\
swp|\
tmp|\
vendor)s{0,1}(\\b|_)\
" '
/* jslint ignore:end */
                    + "| tr \"\\n\" \"\\000\" | xargs -0 grep -HIin -E \""
                    + match2 + "\""
                ), {
                    shell: true,
                    stdio: [
                        "ignore", 1, 2
                    ]
                })
                // on shell exit, print return prompt
                .on("exit", function (exitCode) {
                    console.error("exit-code " + exitCode);
                    that.evalDefault(
                        "\n",
                        context,
                        file,
                        onError2
                    );
                });
                script = "\n";
                break;
            // syntax-sugar - list object's keys, sorted by item-type
            // console.error(Object.keys(global).map(function(key){return(typeof global[key]==='object'&&global[key]&&global[key]===global[key]?'global':typeof global[key])+' '+key;}).sort().join('\n')) // jslint ignore:line
            case "keys":
                script = (
                    "console.error(Object.keys(" + match2
                    + ").map(function(key){return("
                    + "typeof " + match2 + "[key]==='object'&&"
                    + match2 + "[key]&&"
                    + match2 + "[key]===global[key]"
                    + "?'global'"
                    + ":typeof " + match2 + "[key]"
                    + ")+' '+key;"
                    + "}).sort().join('\\n'))\n"
                );
                break;
            // syntax-sugar - print stringified arg
            case "print":
                script = "console.error(String(" + match2 + "))\n";
                break;
            // syntax-sugar - read file
            case "readFile":
                try {
                    console.error(JSON.stringify(
                        require("fs").readFileSync(match2, "utf8")
                    ));
                } catch (errCaught) {
                    console.error(errCaught);
                }
                script = "\n";
                break;
            }
        });
        // eval the script
        that.evalDefault(script, context, file, onError2);
    };
    that.socket = {
        end: local.nop,
        on: local.nop,
        write: local.nop
    };
    // init process.stdout
    process.stdout._writeDefault = (
        process.stdout._writeDefault
        || process.stdout._write
    );
    process.stdout._write = function (chunk, encoding, callback) {
        process.stdout._writeDefault(chunk, encoding, callback);
        // coverage-hack - ignore else-statement
        local.nop(that.socket.writable && (function () {
            that.socket.write(chunk, encoding);
        }()));
    };
    // start serverRepl1
    globalThis.utility2_serverRepl1 = require("net").createServer(function (
        socket
    ) {
        // init socket
        that.socket = socket;
        that.socket.on("data", that.write.bind(that));
        that.socket.on("error", that.onError);
        that.socket.setKeepAlive(true);
    });
    // coverage-hack - ignore else-statement
    local.nop(process.env.PORT_REPL && (function () {
        console.error(
            "repl-server listening on port " + process.env.PORT_REPL
        );
        globalThis.utility2_serverRepl1.listen(process.env.PORT_REPL);
    }()));
};

local.setTimeoutOnError = function (onError, timeout, err, data) {
/*
 * this function will after timeout has passed,
 * then call <onError>(<err>, <data>)
 */
    if (typeof onError === "function") {
        setTimeout(function () {
            onError(err, data);
        }, timeout);
    }
    return data;
};
}());



// run shared js-env code - lib.storage.js
(function (local) {
var child_process;
var clear;
var defer;
var deferList;
var fs;
var getItem;
var init;
var keys;
var length;
var os;
var removeItem;
var setItem;
var storage;
var storageDir;

storageDir = "tmp/storage." + (
    local.isBrowser
    ? "undefined"
    : process.env.NODE_ENV
);
if (!local.isBrowser) {
    // require modules
    child_process = require("child_process");
    fs = require("fs");
    os = require("os");
}

clear = function (onError) {
/*
 * this function will clear storage
 */
    defer({
        action: "clear"
    }, onError);
};

defer = function (opt, onError) {
/*
 * this function will defer <opt>.action until storage is ready
 */
    var data;
    var isDone;
    var objectStore;
    var onError2;
    var req;
    var tmp;
    onError = onError || function (err) {
        // validate no err occurred
        local.assertThrow(!err, err);
    };
    if (!storage) {
        deferList.push(function () {
            defer(opt, onError);
        });
        init();
        return;
    }
    if (local.isBrowser) {
        onError2 = function () {
            /* istanbul ignore next */
            if (isDone) {
                return;
            }
            isDone = true;
            onError(
                req && (req.error || req.transaction.error),
                data || req.result || ""
            );
        };
        switch (opt.action) {
        case "clear":
        case "removeItem":
        case "setItem":
            objectStore = storage
            .transaction(storageDir, "readwrite")
            .objectStore(storageDir);
            break;
        default:
            objectStore = storage
            .transaction(storageDir, "readonly")
            .objectStore(storageDir);
        }
        switch (opt.action) {
        case "clear":
            req = objectStore.clear();
            break;
        case "getItem":
            req = objectStore.get(String(opt.key));
            break;
        case "keys":
            data = [];
            req = objectStore.openCursor();
            req.onsuccess = function () {
                if (!req.result) {
                    onError2();
                    return;
                }
                data.push(req.result.key);
                req.result.continue();
            };
            break;
        case "length":
            req = objectStore.count();
            break;
        case "removeItem":
            req = objectStore.delete(String(opt.key));
            break;
        case "setItem":
            req = objectStore.put(opt.value, String(opt.key));
            break;
        }
        [
            "onabort", "onerror", "onsuccess"
        ].forEach(function (handler) {
            req[handler] = req[handler] || onError2;
        });
        // debug req
        local._debugStorageReq = req;
    } else {
        switch (opt.action) {
        case "clear":
            child_process.spawnSync("rm -f " + storage + "/*", {
                shell: true,
                stdio: [
                    "ignore", 1, 2
                ]
            });
            setTimeout(onError);
            break;
        case "getItem":
            fs.readFile(
                storage + "/" + encodeURIComponent(String(opt.key)),
                "utf8",
                function (ignore, data) {
                    onError(null, data || "");
                }
            );
            break;
        case "keys":
            fs.readdir(storage, function (err, data) {
                onError(err, data && data.map(decodeURIComponent));
            });
            break;
        case "length":
            fs.readdir(storage, function (err, data) {
                onError(err, data && data.length);
            });
            break;
        case "removeItem":
            fs.unlink(
                storage + "/" + encodeURIComponent(String(opt.key)),
                // ignore err
                function () {
                    onError();
                }
            );
            break;
        case "setItem":
            tmp = os.tmpdir() + "/" + Date.now() + Math.random();
            // save to tmp
            fs.writeFile(tmp, opt.value, function (err) {
                // validate no err occurred
                local.assertThrow(!err, err);
                // rename tmp to key
                fs.rename(
                    tmp,
                    storage + "/" + encodeURIComponent(String(opt.key)),
                    onError
                );
            });
            break;
        }
    }
};

deferList = [];

getItem = function (key, onError) {
/*
 * this function will get the item with given key from storage
 */
    defer({
        action: "getItem",
        key
    }, onError);
};

init = function () {
/*
 * this function will init storage
 */
    var onError;
    var req;
    onError = function (err) {
        // validate no err occurred
        local.assertThrow(!err, err);
        if (local.isBrowser) {
            storage = globalThis[storageDir];
        }
        while (deferList.length) {
            deferList.shift()();
        }
    };
    if (local.isBrowser) {
        storage = globalThis[storageDir];
    }
    if (storage) {
        onError();
        return;
    }
    if (local.isBrowser) {
        // init indexedDB
        try {
            req = globalThis.indexedDB.open(storageDir);
            // debug req
            local._debugStorageReqIndexedDB = req;
            req.onerror = onError;
            req.onsuccess = function () {
                globalThis[storageDir] = req.result;
                onError();
            };
            req.onupgradeneeded = function () {
                if (!req.result.objectStoreNames.contains(storageDir)) {
                    req.result.createObjectStore(storageDir);
                }
            };
        } catch (ignore) {}
    } else {
        // mkdirp storage
        storage = storageDir;
        child_process.spawnSync("mkdir", [
            "-p", storage
        ], {
            stdio: [
                "ignore", 1, 2
            ]
        });
        onError();
    }
};

keys = function (onError) {
/*
 * this function will get all the keys in storage
 */
    defer({
        action: "keys"
    }, onError);
};

length = function (onError) {
/*
 * this function will get the number of items in storage
 */
    defer({
        action: "length"
    }, onError);
};

removeItem = function (key, onError) {
/*
 * this function will remove the item with given key from storage
 */
    defer({
        action: "removeItem",
        key
    }, onError);
};

setItem = function (key, value, onError) {
/*
 * this function will set the item with given key and value to storage
 */
    defer({
        action: "setItem",
        key,
        value
    }, onError);
};

// init local
local.storage = storage;
local.storageClear = clear;
local.storageDefer = defer;
local.storageDeferList = deferList;
local.storageDir = storageDir;
local.storageGetItem = getItem;
local.storageInit = init;
local.storageKeys = keys;
local.storageLength = length;
local.storageRemoveItem = removeItem;
local.storageSetItem = setItem;
}(local));



// run shared js-env code - lib.dbTable.js
(function () {
local._DbTable = function (opt) {
/*
 * this function will create a dbTable
 */
    this.name = String(opt.name);
    // register dbTable in dbTableDict
    local.dbTableDict[this.name] = this;
    this.dbRowList = [];
    this.isDirty = null;
    this.idIndexList = [
        {
            isInteger: false,
            name: "_id",
            dict: {}
        }
    ];
    this.onSaveList = [];
    this.sizeLimit = opt.sizeLimit || 0;
};

local._DbTable.prototype._cleanup = function () {
/*
 * this function will cleanup soft-deleted records from the dbTable
 */
    var dbRow;
    var ii;
    var list;
    if (!this.isDirty && this.dbRowList.length <= this.sizeLimit) {
        return;
    }
    this.isDirty = null;
    // cleanup dbRowList
    list = this.dbRowList;
    this.dbRowList = [];
    // optimization - while-loop
    ii = 0;
    while (ii < list.length) {
        dbRow = list[ii];
        // cleanup isRemoved
        if (!dbRow.$isRemoved) {
            this.dbRowList.push(dbRow);
        }
        ii += 1;
    }
    if (this.sizeLimit && this.dbRowList.length >= 1.5 * this.sizeLimit) {
        this.dbRowList = this._crudGetManyByQuery(
            {},
            this.sortDefault,
            0,
            this.sizeLimit
        );
    }
};

local._DbTable.prototype._crudGetManyByQuery = function (
    query,
    sort,
    skip,
    limit,
    shuffle
) {
/*
 * this function will get the dbRow's in the dbTable,
 * with given query, sort, skip, and limit
 */
    var ii;
    var result;
    result = this.dbRowList;
    // get by query
    if (result.length && query && Object.keys(query).length) {
        result = local.dbRowListGetManyByQuery(this.dbRowList, query);
    }
    // sort
    (sort || []).forEach(function (element) {
        // bug-workaround - v8 does not have stable-sort
        // optimization - while-loop
        ii = 0;
        while (ii < result.length) {
            result[ii].$ii = ii;
            ii += 1;
        }
        result.sort(function (aa, bb) {
            return local.sortCompare(
                local.dbRowGetItem(aa, element.fieldName),
                local.dbRowGetItem(bb, element.fieldName),
                aa.$ii,
                bb.$ii
            );
        });
        if (element.isDescending) {
            result.reverse();
        }
    });
    // skip
    result = result.slice(skip || 0);
    // shuffle
    local.functionOrNop(shuffle && local.listShuffle)(result);
    // limit
    result = result.slice(0, limit || Infinity);
    return result;
};

local._DbTable.prototype._crudGetOneById = function (idDict) {
/*
 * this function will get the dbRow in the dbTable with given idDict
 */
    var id;
    var result;
    idDict = local.objectSetOverride(idDict);
    result = null;
    this.idIndexList.some(function (idIndex) {
        id = idDict[idIndex.name];
        // optimization - hasOwnProperty
        if (idIndex.dict.hasOwnProperty(id)) {
            result = idIndex.dict[id];
            return result;
        }
    });
    return result;
};

local._DbTable.prototype._crudRemoveOneById = function (idDict, circularSet) {
/*
 * this function will remove the dbRow from the dbTable with given idDict
 */
    var id;
    var result;
    var that;
    if (!idDict) {
        return null;
    }
    that = this;
    circularSet = circularSet || new Set([
        idDict
    ]);
    result = null;
    that.idIndexList.forEach(function (idIndex) {
        id = idDict[idIndex.name];
        // optimization - hasOwnProperty
        if (!idIndex.dict.hasOwnProperty(id)) {
            return;
        }
        result = idIndex.dict[id];
        delete idIndex.dict[id];
        // optimization - soft-delete
        result.$isRemoved = true;
        that.isDirty = true;
        if (circularSet.has(result)) {
            return;
        }
        circularSet.add(result);
        // recurse
        that._crudRemoveOneById(result, circularSet);
    });
    that.save();
    return result;
};

local._DbTable.prototype._crudSetOneById = function (dbRow) {
/*
 * this function will set the dbRow into the dbTable with given dbRow._id
 * WARNING - existing dbRow with conflicting dbRow._id will be removed
 */
    var existing;
    var id;
    var normalize;
    var timeNow;
    normalize = function (dbRow) {
    /*
     * this function will recursively normalize dbRow
     */
        switch (typeof dbRow) {
        case "boolean":
        case "string":
            return dbRow;
        case "number":
            return (
                Number.isFinite(dbRow)
                ? dbRow
                : undefined
            );
        case "object":
            if (!dbRow) {
                return;
            }
            break;
        default:
            return;
        }
        Object.keys(dbRow).forEach(function (key) {
            dbRow[key] = (
                (key[0] === "$" || key.indexOf(".") >= 0)
                // invalid-property
                ? undefined
                // recurse
                : normalize(dbRow[key])
            );
        });
        return dbRow;
    };
    dbRow = local.jsonCopy(local.objectSetOverride(dbRow));
    // update timestamp
    timeNow = new Date().toISOString();
    dbRow._timeCreated = dbRow._timeCreated || timeNow;
    if (!local.modeImport) {
        dbRow._timeUpdated = timeNow;
    }
    // normalize
    dbRow = normalize(dbRow);
    dbRow = local.jsonCopy(dbRow);
    // remove existing dbRow
    existing = this._crudRemoveOneById(dbRow) || dbRow;
    this.idIndexList.forEach(function (idIndex) {
        // auto-set id
        id = local.dbRowSetId(existing, idIndex);
        // copy id from existing to dbRow
        dbRow[idIndex.name] = id;
        // set dbRow
        idIndex.dict[id] = dbRow;
    });
    // update dbRowList
    this.dbRowList.push(dbRow);
    this.save();
    return dbRow;
};

local._DbTable.prototype._crudUpdateOneById = function (dbRow) {
/*
 * this function will update the dbRow in the dbTable,
 * if it exists with given dbRow._id
 * WARNING
 * existing dbRow's with conflicting unique-keys (besides the one being updated)
 * will be removed
 */
    var id;
    var result;
    dbRow = local.jsonCopy(local.objectSetOverride(dbRow));
    result = {};
    this.idIndexList.some(function (idIndex) {
        id = dbRow[idIndex.name];
        // optimization - hasOwnProperty
        if (idIndex.dict.hasOwnProperty(id)) {
            result = idIndex.dict[id];
            return true;
        }
    });
    // remove existing dbRow
    result = local.jsonCopy(this._crudRemoveOneById(result)) || result;
    // update dbRow
    delete dbRow._timeCreated;
    local.objectSetOverride(result, dbRow, 10);
    // replace dbRow
    result = this._crudSetOneById(result);
    return result;
};

local._DbTable.prototype.crudCountAll = function (onError) {
/*
 * this function will count all of dbRow's in dbTable
 */
    this._cleanup();
    return local.setTimeoutOnError(onError, 0, null, this.dbRowList.length);
};

local._DbTable.prototype.crudCountManyByQuery = function (query, onError) {
/*
 * this function will count the number of dbRow's in dbTable with given query
 */
    this._cleanup();
    return local.setTimeoutOnError(
        onError,
        0,
        null,
        this._crudGetManyByQuery(query).length
    );
};

local._DbTable.prototype.crudGetManyById = function (idDictList, onError) {
/*
 * this function will get the dbRow's in the dbTable with given idDictList
 */
    var that;
    this._cleanup();
    that = this;
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        (idDictList || []).map(function (idDict) {
            return that._crudGetOneById(idDict);
        })
    ));
};

local._DbTable.prototype.crudGetManyByQuery = function (opt, onError) {
/*
 * this function will get the dbRow's in the dbTable with given <opt>.query
 */
    this._cleanup();
    opt = local.objectSetOverride(opt);
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        this._crudGetManyByQuery(
            opt.query,
            opt.sort || this.sortDefault,
            opt.skip,
            opt.limit,
            opt.shuffle
        ),
        opt.fieldList
    ));
};

local._DbTable.prototype.crudGetOneById = function (idDict, onError) {
/*
 * this function will get the dbRow in the dbTable with given idDict
 */
    this._cleanup();
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        this._crudGetOneById(idDict)
    ));
};

local._DbTable.prototype.crudGetOneByQuery = function (query, onError) {
/*
 * this function will get the dbRow in the dbTable with given query
 */
    var ii;
    var result;
    this._cleanup();
    // optimization - while-loop
    ii = 0;
    while (ii < this.dbRowList.length) {
        result = local.dbRowListGetManyByQuery([
            this.dbRowList[ii]
        ], query)[0];
        if (result) {
            break;
        }
        ii += 1;
    }
    return local.setTimeoutOnError(
        onError,
        0,
        null,
        local.dbRowProject(result)
    );
};

local._DbTable.prototype.crudGetOneByRandom = function (onError) {
/*
 * this function will get a random dbRow in the dbTable
 */
    this._cleanup();
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        this.dbRowList[Math.floor(Math.random() * this.dbRowList.length)]
    ));
};

local._DbTable.prototype.crudRemoveAll = function (onError) {
/*
 * this function will remove all of the dbRow's from the dbTable
 */
    var idIndexList;
    // save idIndexList
    idIndexList = this.idIndexList;
    // reset dbTable
    local._DbTable.call(this, this);
    // restore idIndexList
    local.dbTableCreateOne({
        name: this.name,
        idIndexCreateList: idIndexList
    }, onError);
};

local._DbTable.prototype.crudRemoveManyById = function (idDictList, onError) {
/*
 * this function will remove the dbRow's from the dbTable with given idDictList
 */
    var that;
    that = this;
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        (idDictList || []).map(function (dbRow) {
            return that._crudRemoveOneById(dbRow);
        })
    ));
};

local._DbTable.prototype.crudRemoveManyByQuery = function (query, onError) {
/*
 * this function will remove the dbRow's from the dbTable with given query
 */
    var that;
    that = this;
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        that._crudGetManyByQuery(query).map(function (dbRow) {
            return that._crudRemoveOneById(dbRow);
        })
    ));
};

local._DbTable.prototype.crudRemoveOneById = function (idDict, onError) {
/*
 * this function will remove the dbRow from the dbTable with given idDict
 */
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        this._crudRemoveOneById(idDict)
    ));
};

local._DbTable.prototype.crudSetManyById = function (dbRowList, onError) {
/*
 * this function will set the dbRowList into the dbTable
 */
    var that;
    that = this;
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        (dbRowList || []).map(function (dbRow) {
            return that._crudSetOneById(dbRow);
        })
    ));
};

local._DbTable.prototype.crudSetOneById = function (dbRow, onError) {
/*
 * this function will set the dbRow into the dbTable with given dbRow._id
 */
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        this._crudSetOneById(dbRow)
    ));
};

local._DbTable.prototype.crudUpdateManyById = function (dbRowList, onError) {
/*
 * this function will update the dbRowList in the dbTable,
 * if they exist with given dbRow._id's
 */
    var that;
    that = this;
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        (dbRowList || []).map(function (dbRow) {
            return that._crudUpdateOneById(dbRow);
        })
    ));
};

local._DbTable.prototype.crudUpdateManyByQuery = function (
    query,
    dbRow,
    onError
) {
/*
 * this function will update the dbRow's in the dbTable with given query
 */
    var result;
    var that;
    var tmp;
    that = this;
    tmp = local.jsonCopy(local.objectSetOverride(dbRow));
    result = that._crudGetManyByQuery(query).map(function (dbRow) {
        tmp._id = dbRow._id;
        return that._crudUpdateOneById(tmp);
    });
    return local.setTimeoutOnError(onError, 0, null, result);
};

local._DbTable.prototype.crudUpdateOneById = function (dbRow, onError) {
/*
 * this function will update the dbRow in the dbTable,
 * if it exists with given dbRow._id
 */
    return local.setTimeoutOnError(onError, 0, null, local.dbRowProject(
        this._crudUpdateOneById(dbRow)
    ));
};

local._DbTable.prototype.drop = function (onError) {
/*
 * this function will drop the dbTable
 */
    console.error("db - dropping dbTable " + this.name + " ...");
    // cancel pending save
    this.timerSave = null;
    while (this.onSaveList.length) {
        this.onSaveList.shift()();
    }
    // reset dbTable
    local._DbTable.call(this, this);
    // clear persistence
    local.storageRemoveItem("dbTable." + this.name + ".json", onError);
};

local._DbTable.prototype.export = function (onError) {
/*
 * this function will export the db
 */
    var result;
    var that;
    this._cleanup();
    that = this;
    result = "";
    that.idIndexList.forEach(function (idIndex) {
        result += that.name + " idIndexCreate " + JSON.stringify({
            isInteger: idIndex.isInteger,
            name: idIndex.name
        }) + "\n";
    });
    result += that.name + " sizeLimit " + that.sizeLimit + "\n";
    result += that.name + " sortDefault " + JSON.stringify(
        that.sortDefault
    ) + "\n";
    that.crudGetManyByQuery({}).forEach(function (dbRow) {
        result += that.name + " dbRowSet " + JSON.stringify(dbRow) + "\n";
    });
    return local.setTimeoutOnError(onError, 0, null, result.trim());
};

local._DbTable.prototype.idIndexCreate = function (opt, onError) {
/*
 * this function will create an idIndex with given <opt>.name
 */
    var dbRow;
    var idIndex;
    var ii;
    var name;
    opt = local.objectSetOverride(opt);
    name = String(opt.name);
    // disallow idIndex with dot-name
    if (name.indexOf(".") >= 0 || name === "_id") {
        return local.setTimeoutOnError(onError);
    }
    // remove existing idIndex
    this.idIndexRemove(opt);
    // init idIndex
    idIndex = {
        dict: {},
        isInteger: Boolean(opt.isInteger),
        name
    };
    this.idIndexList.push(idIndex);
    // populate idIndex with dbRowList
    // optimization - while-loop
    ii = 0;
    while (ii < this.dbRowList.length) {
        dbRow = this.dbRowList[ii];
        // auto-set id
        if (!dbRow.$isRemoved) {
            idIndex.dict[local.dbRowSetId(dbRow, idIndex)] = dbRow;
        }
        ii += 1;
    }
    this.save();
    return local.setTimeoutOnError(onError);
};

local._DbTable.prototype.idIndexRemove = function (opt, onError) {
/*
 * this function will remove the idIndex with given <opt>.name
 */
    var name;
    opt = local.objectSetOverride(opt);
    name = String(opt.name);
    this.idIndexList = this.idIndexList.filter(function (idIndex) {
        return idIndex.name !== name || idIndex.name === "_id";
    });
    this.save();
    return local.setTimeoutOnError(onError);
};

local._DbTable.prototype.save = function (onError) {
/*
 * this function will save the dbTable to storage
 */
    var that;
    that = this;
    if (local.modeImport) {
        return;
    }
    if (onError) {
        that.onSaveList.push(onError);
    }
    // throttle storage-writes to once every 1000 ms
    that.timerSave = that.timerSave || setTimeout(function () {
        that.timerSave = null;
        local.storageSetItem(
            "dbTable." + that.name + ".json",
            that.export(),
            function (err) {
                while (that.onSaveList.length) {
                    that.onSaveList.shift()(err);
                }
            }
        );
    }, 1000);
};

local.dbCrudRemoveAll = function (onError) {
/*
 * this function will remove all dbRow's from the db
 */
    var onParallel;
    onParallel = local.onParallel(function (err) {
        local.setTimeoutOnError(onError, 0, err);
    });
    onParallel.counter += 1;
    Object.keys(local.dbTableDict).forEach(function (key) {
        onParallel.counter += 1;
        local.dbTableDict[key].crudRemoveAll(onParallel);
    });
    onParallel();
};

local.dbDrop = function (onError) {
/*
 * this function will drop the db
 */
    var onParallel;
    console.error("db - dropping database ...");
    onParallel = local.onParallel(function (err) {
        local.setTimeoutOnError(onError, 0, err);
    });
    onParallel.counter += 1;
    onParallel.counter += 1;
    local.storageClear(onParallel);
    Object.keys(local.dbTableDict).forEach(function (key) {
        onParallel.counter += 1;
        local.dbTableDict[key].drop(onParallel);
    });
    onParallel();
};

local.dbExport = function (onError) {
/*
 * this function will export the db as serialized text
 */
    var result;
    result = "";
    Object.keys(local.dbTableDict).forEach(function (key) {
        console.error(
            "db - exporting dbTable " + local.dbTableDict[key].name + " ..."
        );
        result += local.dbTableDict[key].export();
        result += "\n\n";
    });
    return local.setTimeoutOnError(onError, 0, null, result.trim());
};

local.dbImport = function (text, onError) {
/*
 * this function will import the serialized text into the db
 */
    var dbTable;
    var dbTableDict;
    dbTableDict = {};
    local.modeImport = true;
    setTimeout(function () {
        local.modeImport = null;
    });
    text.replace((
        /^(\w\S*?)\u0020(\S+?)\u0020(\S.*?)$/gm
    ), function (match0, match1, match2, match3) {
        switch (match2) {
        case "dbRowSet":
            dbTableDict[match1] = true;
            dbTable = local.dbTableCreateOne({
                isLoaded: true,
                name: match1
            });
            dbTable.crudSetOneById(JSON.parse(match3));
            break;
        case "idIndexCreate":
            dbTableDict[match1] = true;
            dbTable = local.dbTableCreateOne({
                isLoaded: true,
                name: match1
            });
            dbTable.idIndexCreate(JSON.parse(match3));
            break;
        case "sizeLimit":
            dbTableDict[match1] = true;
            dbTable = local.dbTableCreateOne({
                isLoaded: true,
                name: match1
            });
            dbTable.sizeLimit = JSON.parse(match3);
            break;
        case "sortDefault":
            dbTableDict[match1] = true;
            dbTable = local.dbTableCreateOne({
                isLoaded: true,
                name: match1
            });
            dbTable.sortDefault = JSON.parse(match3);
            break;
        default:
            local.onErrorDefault(new Error(
                "db - dbImport - invalid operation - " + match0
            ));
        }
    });
    Object.keys(dbTableDict).forEach(function (name) {
        console.error("db - importing dbTable " + name + " ...");
    });
    local.modeImport = null;
    return local.setTimeoutOnError(onError);
};

local.dbLoad = function (onError) {
/*
 * this function will load the db from storage
 */
    var onParallel;
    onParallel = local.onParallel(function (err) {
        local.setTimeoutOnError(onError, 0, err);
    });
    local.storageKeys(function (err, data) {
        onParallel.counter += 1;
        // validate no err occurred
        onParallel.counter += 1;
        onParallel(err);
        (data || []).forEach(function (key) {
            if (key.indexOf("dbTable.") !== 0) {
                return;
            }
            onParallel.counter += 1;
            local.storageGetItem(key, function (err, data) {
                onParallel.counter += 1;
                onParallel(err);
                local.dbImport(data, onParallel);
            });
        });
        onParallel();
    });
};

local.dbReset = function (dbSeedList, onError) {
/*
 * this function will drop and seed the db with given dbSeedList
 */
    var onParallel;
    onParallel = globalThis.utility2_onReadyBefore || local.onParallel(onError);
    onParallel.counter += 1;
    // drop db
    onParallel.counter += 1;
    local.dbDrop(function (err) {
        local.onErrorDefault(err);
        // seed db
        local.dbSeed(
            dbSeedList,
            !globalThis.utility2_onReadyBefore && onParallel
        );
        local.functionOrNop(globalThis.utility2_onReadyBefore)();
    });
    local.functionOrNop(globalThis.utility2_onReadyAfter)(onError);
    onParallel();
};

local.dbRowGetItem = function (dbRow, key) {
/*
 * this function will get the item with given key from dbRow
 */
    var ii;
    var value;
    value = dbRow;
    key = String(key).split(".");
    // optimization - while-loop
    ii = 0;
    while (ii < key.length && typeof value === "object" && value) {
        value = value[key[ii]];
        ii += 1;
    }
    return (
        value === undefined
        ? null
        : value
    );
};

local.dbRowListGetManyByOperator = function (
    dbRowList,
    fieldName,
    operator,
    bb,
    not
) {
/*
 * this function will get the dbRow's in dbRowList with given operator
 */
    var fieldValue;
    var ii;
    var jj;
    var result;
    var test;
    var typeof2;
    result = [];
    typeof2 = typeof bb;
    if (bb && typeof2 === "object") {
        switch (operator) {
        case "$in":
        case "$nin":
        case "$regex":
            break;
        default:
            return result;
        }
    }
    switch (operator) {
    case "$eq":
        test = function (aa, bb) {
            return aa === bb;
        };
        break;
    case "$exists":
        bb = !bb;
        test = function (aa, bb) {
            return !((aa === null) ^ bb); // jslint ignore:line
        };
        break;
    case "$gt":
        test = function (aa, bb, typeof1, typeof2) {
            return typeof1 === typeof2 && aa > bb;
        };
        break;
    case "$gte":
        test = function (aa, bb, typeof1, typeof2) {
            return typeof1 === typeof2 && aa >= bb;
        };
        break;
    case "$in":
        if (bb && typeof bb.indexOf === "function") {
            if (typeof2 === "string") {
                test = function (aa, bb, typeof1, typeof2) {
                    return typeof1 === typeof2 && bb.indexOf(aa) >= 0;
                };
            } else {
                test = function (aa, bb) {
                    return bb.indexOf(aa) >= 0;
                };
            }
        }
        break;
    case "$lt":
        test = function (aa, bb, typeof1, typeof2) {
            return typeof1 === typeof2 && aa < bb;
        };
        break;
    case "$lte":
        test = function (aa, bb, typeof1, typeof2) {
            return typeof1 === typeof2 && aa <= bb;
        };
        break;
    case "$ne":
        test = function (aa, bb) {
            return aa !== bb;
        };
        break;
    case "$nin":
        if (bb && typeof bb.indexOf === "function") {
            if (typeof2 === "string") {
                test = function (aa, bb, typeof1, typeof2) {
                    return typeof1 === typeof2 && bb.indexOf(aa) < 0;
                };
            } else {
                test = function (aa, bb) {
                    return bb.indexOf(aa) < 0;
                };
            }
        }
        break;
    case "$regex":
        if (bb && typeof bb.test === "function") {
            test = function (aa, bb) {
                return bb.test(aa);
            };
        }
        break;
    case "$typeof":
        test = function (ignore, bb, typeof1) {
            return typeof1 === bb;
        };
        break;
    }
    if (!test) {
        return result;
    }
    // optimization - while-loop
    ii = dbRowList.length;
    while (ii >= 1) {
        ii -= 1;
        fieldValue = local.dbRowGetItem(dbRowList[ii], fieldName);
        // normalize to list
        if (!Array.isArray(fieldValue)) {
            fieldValue = [
                fieldValue
            ];
        }
        // optimization - while-loop
        jj = fieldValue.length;
        while (jj >= 1) {
            jj -= 1;
            if (Boolean(
                not ^ test(fieldValue[jj], bb, typeof fieldValue[jj], typeof2)
            )) {
                result.push(dbRowList[ii]);
                break;
            }
        }
    }
    return result;
};

local.dbRowListGetManyByQuery = function (dbRowList, query, fieldName, not) {
/*
 * this function will get the dbRow's in dbRowList with given query
 */
    var bb;
    var dbRowDict;
    var result;
    // optimization - convert to boolean
    not = Boolean(not);
    result = dbRowList;
    if (!(typeof query === "object" && query)) {
        result = local.dbRowListGetManyByOperator(
            result,
            fieldName,
            "$eq",
            query,
            not
        );
        return result;
    }
    Object.keys(query).some(function (key) {
        bb = query[key];
        switch (key) {
        case "$not":
            key = fieldName;
            not = !not;
            break;
        case "$or":
            if (!Array.isArray(bb)) {
                break;
            }
            dbRowDict = {};
            bb.forEach(function (query) {
                // recurse
                local.dbRowListGetManyByQuery(result, query).forEach(function (
                    dbRow
                ) {
                    dbRowDict[dbRow._id] = dbRow;
                });
            });
            result = Object.keys(dbRowDict).map(function (id) {
                return dbRowDict[id];
            });
            return !result.length;
        }
        if (key[0] === "$") {
            result = local.dbRowListGetManyByOperator(
                result,
                fieldName,
                key,
                bb,
                not
            );
            return !result.length;
        }
        // recurse
        result = local.dbRowListGetManyByQuery(result, bb, key, not);
        return !result.length;
    });
    return result;
};

local.dbRowProject = function (dbRow, fieldList) {
/*
 * this function will deepcopy and project the dbRow with given fieldList
 */
    var result;
    if (!dbRow) {
        return null;
    }
    // handle list-case
    if (Array.isArray(dbRow)) {
        return dbRow.map(function (dbRow) {
            // recurse
            return local.dbRowProject(dbRow, fieldList);
        });
    }
    // normalize to list
    if (!(Array.isArray(fieldList) && fieldList.length)) {
        fieldList = Object.keys(dbRow);
    }
    result = {};
    fieldList.forEach(function (key) {
        if (key[0] !== "$") {
            result[key] = dbRow[key];
        }
    });
    return JSON.parse(local.jsonStringifyOrdered(result));
};

local.dbRowSetId = function (dbRow, idIndex) {
/*
 * this function will if does not exist,
 * then set a random and unique id into dbRow for given idIndex,
 */
    var id;
    id = dbRow[idIndex.name];
    if (typeof id !== "number" && typeof id !== "string") {
        do {
            id = (
                idIndex.isInteger
                ? (1 + Math.random()) * 0x10000000000000
                : "a" + (
                    (1 + Math.random()) * 0x10000000000000
                ).toString(36).slice(1)
            );
        // optimization - hasOwnProperty
        } while (idIndex.dict.hasOwnProperty(id));
        dbRow[idIndex.name] = id;
    }
    return id;
};

local.dbSave = function (onError) {
/*
 * this function will save the db to storage
 */
    var onParallel;
    onParallel = local.onParallel(function (err) {
        local.setTimeoutOnError(onError, 0, err);
    });
    onParallel.counter += 1;
    Object.keys(local.dbTableDict).forEach(function (key) {
        onParallel.counter += 1;
        local.dbTableDict[key].save(onParallel);
    });
    onParallel();
};

local.dbSeed = function (dbSeedList, onError) {
/*
 * this function will seed the db with given dbSeedList
 */
    var dbTableDict;
    var onParallel;
    dbTableDict = {};
    onParallel = globalThis.utility2_onReadyBefore || local.onParallel(onError);
    onParallel.counter += 1;
    // seed db
    onParallel.counter += 1;
    local.dbTableCreateMany(dbSeedList, onParallel);
    (dbSeedList || []).forEach(function (opt) {
        dbTableDict[opt.name] = true;
    });
    Object.keys(dbTableDict).forEach(function (name) {
        console.error("db - seeding dbTable " + name + " ...");
    });
    local.functionOrNop(globalThis.utility2_onReadyAfter)(onError);
    onParallel();
};

local.dbTableCreateMany = function (optionList, onError) {
/*
 * this function will create many dbTables with given optionList
 */
    var onParallel;
    var result;
    onParallel = local.onParallel(function (err) {
        local.setTimeoutOnError(onError, 0, err, result);
    });
    onParallel.counter += 1;
    result = (optionList || []).map(function (opt) {
        onParallel.counter += 1;
        return local.dbTableCreateOne(opt, onParallel);
    });
    return local.setTimeoutOnError(onParallel, 0, null, result);
};

local.dbTableCreateOne = function (opt, onError) {
/*
 * this function will create a dbTable with given <opt>
 */
    var DbTable;
    var that;
    opt = local.objectSetOverride(opt);
    // register dbTable
    DbTable = local._DbTable;
    local.dbTableDict[opt.name] = local.dbTableDict[opt.name] || new DbTable(
        opt
    );
    that = local.dbTableDict[opt.name];
    that.sortDefault = (
        opt.sortDefault
        || that.sortDefault
        || [
            {
                fieldName: "_timeUpdated",
                isDescending: true
            }
        ]
    );
    // remove idIndex
    (opt.idIndexRemoveList || []).forEach(function (idIndex) {
        that.idIndexRemove(idIndex);
    });
    // create idIndex
    (opt.idIndexCreateList || []).forEach(function (idIndex) {
        that.idIndexCreate(idIndex);
    });
    // upsert dbRow
    that.crudSetManyById(opt.dbRowList);
    // restore dbTable from persistent-storage
    that.isLoaded = that.isLoaded || opt.isLoaded;
    if (!that.isLoaded) {
        local.storageGetItem("dbTable." + that.name + ".json", function (
            err,
            data
        ) {
            // validate no err occurred
            local.assertThrow(!err, err);
            if (!that.isLoaded) {
                local.dbImport(data);
            }
            that.isLoaded = true;
            local.setTimeoutOnError(onError, 0, null, that);
        });
        return that;
    }
    return local.setTimeoutOnError(onError, 0, null, that);
};

local.dbTableDict = {};

local.onEventDomDb = function (evt) {
/*
 * this function will handle db dom-events
 */
    var ajaxProgressUpdate;
    var reader;
    var tmp;
    var utility2;
    utility2 = globalThis.utility2 || {};
    ajaxProgressUpdate = utility2.ajaxProgressUpdate || local.nop;
    switch (evt.target.dataset.oneventDb) {
    case "dbExport":
        tmp = URL.createObjectURL(new globalThis.Blob([
            local.dbExport()
        ]));
        document.querySelector(
            "#dbExportA1"
        ).href = tmp;
        document.querySelector(
            "#dbExportA1"
        ).click();
        setTimeout(function () {
            URL.revokeObjectURL(tmp);
        }, 30000);
        break;
    case "dbImport":
        document.querySelector(
            "[data-onevent-db='dbImportInput']"
        ).click();
        break;
    case "dbImportInput":
        if (evt.type !== "change") {
            return;
        }
        ajaxProgressUpdate();
        reader = new FileReader();
        reader.addEventListener("load", function () {
            local.dbImport(reader.result);
            ajaxProgressUpdate();
        });
        reader.readAsText(evt.target.files[0]);
        break;
    case "dbReset":
        ajaxProgressUpdate();
        local.dbReset(globalThis.utility2_dbSeedList, function (err) {
            local.onErrorDefault(err);
            if (
                utility2.uiEventListenerDict
                && typeof utility2.uiEventListenerDict[".onEventUiReload"]
                === "function"
            ) {
                utility2.uiEventListenerDict[".onEventUiReload"]();
            }
        });
        break;
    }
};

local.sortCompare = function (aa, bb, ii, jj) {
/*
 * this function will compare aa vs bb and return:
 * -1 if aa < bb
 *  0 if aa === bb
 *  1 if aa > bb
 * the priority for comparing different typeof's is:
 * null < boolean < number < string < object < undefined
 */
    var typeof1;
    var typeof2;
    if (aa === bb) {
        return (
            ii < jj
            ? -1
            : 1
        );
    }
    if (aa === null) {
        return -1;
    }
    if (bb === null) {
        return 1;
    }
    typeof1 = typeof aa;
    typeof2 = typeof bb;
    if (typeof1 === typeof2) {
        return (
            typeof1 === "object"
            ? 0
            : aa > bb
            ? 1
            : -1
        );
    }
    if (typeof1 === "boolean") {
        return -1;
    }
    if (typeof2 === "boolean") {
        return 1;
    }
    if (typeof1 === "number") {
        return -1;
    }
    if (typeof2 === "number") {
        return 1;
    }
    if (typeof1 === "string") {
        return -1;
    }
    if (typeof2 === "string") {
        return 1;
    }
    return 0;
};
}());



// run node js-env code - init-after
/* istanbul ignore next */
(function () {
if (local.isBrowser) {
    return;
}



local.cliDict = {};

local.cliDict.dbTableCrudGetManyByQuery = function () {
/*
 * <dbTable> <query>
 * will get from <dbTable> with json <query>, <dbRowList>
 */
    local.dbTableCreateOne({
        name: process.argv[3]
    }, function (err, that) {
        // validate no err occurred
        local.assertThrow(!err, err);
        console.log(JSON.stringify(that.crudGetManyByQuery(
            JSON.parse(process.argv[4] || "{}")
        ), null, 4));
    });
};

local.cliDict.dbTableCrudRemoveManyByQuery = function () {
/*
 * <dbTable> <query>
 * will remove from <dbTable> with json <query>, <dbRowList>
 */
    local.dbTableCreateOne({
        name: process.argv[3]
    }, function (err, that) {
        // validate no err occurred
        local.assertThrow(!err, err);
        console.log(JSON.stringify(that.crudRemoveManyByQuery(
            JSON.parse(process.argv[4])
        ), null, 4));
    });
};

local.cliDict.dbTableCrudSetManyById = function () {
/*
 * <dbTable> <dbRowList>
 * will set in <dbTable>, <dbRowList>
 */
    local.dbTableCreateOne({
        name: process.argv[3]
    }, function (err, that) {
        // validate no err occurred
        local.assertThrow(!err, err);
        that.crudSetManyById(JSON.parse(process.argv[4]));
    });
};

local.cliDict.dbTableHeaderDictGet = function () {
/*
 * <dbTable>
 * will get from <dbTable>, <headerDict>
 */
    local.dbTableCreateOne({
        name: process.argv[3]
    }, function (err, that) {
        // validate no err occurred
        local.assertThrow(!err, err);
        var tmp;
        tmp = [];
        that.idIndexList.forEach(function (idIndex) {
            tmp.push({
                isInteger: idIndex.isInteger,
                name: idIndex.name
            });
        });
        console.log(JSON.stringify({
            idIndexList: tmp,
            sizeLimit: that.sizeLimit,
            sortDefault: that.sortDefault
        }, null, 4));
    });
};

local.cliDict.dbTableHeaderDictSet = function () {
/*
 * <dbTable> <headerDict>
 * will set in <dbTable>, <headerDict>
 */
    local.dbTableCreateOne({
        name: process.argv[3]
    }, function (err, that) {
        // validate no err occurred
        local.assertThrow(!err, err);
        local.tmp = JSON.parse(process.argv[4]);
        that.sizeLimit = local.tmp.sizeLimit || that.sizeLimit;
        that.sortDefault = local.tmp.sortDefault || that.sortDefault;
        that.save();
        local.tmp = [];
        that.idIndexList.forEach(function (idIndex) {
            local.tmp.push({
                isInteger: idIndex.isInteger,
                name: idIndex.name
            });
        });
        local.cliDict.dbTableHeaderDictGet();
    });
};

local.cliDict.dbTableIdIndexCreate = function () {
/*
 * <dbTable> <idIndex>
 * will create in <dbTable>, <idIndex>
 */
    local.dbTableCreateOne({
        name: process.argv[3]
    }, function (err, that) {
        // validate no err occurred
        local.assertThrow(!err, err);
        that.idIndexCreate(JSON.parse(process.argv[4]));
        that.save();
        local.tmp = [];
        that.idIndexList.forEach(function (idIndex) {
            local.tmp.push({
                isInteger: idIndex.isInteger,
                name: idIndex.name
            });
        });
        local.cliDict.dbTableHeaderDictGet();
    });
};

local.cliDict.dbTableIdIndexRemove = function () {
/*
 * <dbTable> <idIndex>
 * will remove from <dbTable>, <idIndex>
 */
    local.dbTableCreateOne({
        name: process.argv[3]
    }, function (err, that) {
        // validate no err occurred
        local.assertThrow(!err, err);
        that.idIndexRemove(JSON.parse(process.argv[4]));
        that.save();
        local.cliDict.dbTableHeaderDictGet();
    });
};

local.cliDict.dbTableList = function () {
/*
 *
 * will get from db, <dbTableList>
 */
    local.storageKeys(function (err, data) {
        // validate no err occurred
        local.assertThrow(!err, err);
        console.log(JSON.stringify(data.map(function (element) {
            return element.split(".").slice(1, -1).join(".");
        }), null, 4));
    });
};

local.cliDict.dbTableRemove = function () {
/*
 * <dbTable>
 * will remove from db, <dbTable>
 */
    local.storageRemoveItem("dbTable." + process.argv[3] + ".json", function (
        err
    ) {
        // validate no err occurred
        local.assertThrow(!err, err);
        local.cliDict.dbTableList();
    });
};

// run the cli
if (module === require.main && !globalThis.utility2_rollup) {
    local.cliRun();
}
}());



}());
/* script-end /assets.utility2.lib.db.js */



/* script-begin /assets.utility2.lib.github_crud.js */
// usr/bin/env node
/*
 * lib.github_crud.js (2019.1.21)
 * https://github.com/kaizhu256/node-github-crud
 * this zero-dependency package will provide a simple cli-tool to PUT / GET / DELETE github files
 *
 */



/* istanbul instrument in package github_crud */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_github_crud = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.github_crud = local;



/* validateLineSortedReset */
local.ajax = function (opt, onError) {
/*
 * this function will send an ajax-req
 * with given <opt>.url and callback <onError>
 * with err and timeout handling
 * example usage:
    local.ajax({
        data: "hello world",
        header: {"x-header-hello": "world"},
        method: "POST",
        url: "/index.html"
    }, function (err, xhr) {
        console.log(xhr.statusCode);
        console.log(xhr.responseText);
    });
 */
    var ajaxProgressUpdate;
    var bufferValidateAndCoerce;
    var isDone;
    var local2;
    var onEvent;
    var streamCleanup;
    var timeout;
    var tmp;
    var xhr;
    var xhrInit;
    // init local2
    local2 = opt.local2 || local.utility2 || {};
    // init function
    ajaxProgressUpdate = local2.ajaxProgressUpdate || local.nop;
    bufferValidateAndCoerce = local2.bufferValidateAndCoerce || function (
        bff,
        mode
    ) {
    /*
     * this function will validate and coerce/convert <bff> -> Buffer
     * (or String if <mode> = "string")
     */
        // coerce ArrayBuffer -> Buffer
        if (Object.prototype.toString.call(bff) === "[object ArrayBuffer]") {
            bff = new Uint8Array(bff);
        }
        // convert Buffer -> utf8
        if (mode === "string" && typeof bff !== "string") {
            bff = String(bff);
        }
        return bff;
    };
    onEvent = function (evt) {
    /*
     * this function will handle events
     */
        if (Object.prototype.toString.call(evt) === "[object Error]") {
            xhr.err = xhr.err || evt;
            xhr.onEvent({
                type: "error"
            });
            return;
        }
        // init statusCode
        xhr.statusCode = (xhr.statusCode || xhr.status) | 0;
        switch (evt.type) {
        case "abort":
        case "error":
        case "load":
            if (isDone) {
                return;
            }
            isDone = true;
            // decrement ajaxProgressCounter
            local2.ajaxProgressCounter = Math.max(
                local2.ajaxProgressCounter - 1,
                0
            );
            ajaxProgressUpdate();
            // handle abort or err event
            switch (!xhr.err && evt.type) {
            case "abort":
            case "error":
                xhr.err = new Error("ajax - event " + evt.type);
                break;
            case "load":
                if (xhr.statusCode >= 400) {
                    xhr.err = new Error(
                        "ajax - statusCode " + xhr.statusCode
                    );
                }
                break;
            }
            // debug statusCode / method / url
            if (xhr.err) {
                xhr.statusCode = xhr.statusCode || 500;
                xhr.err.statusCode = xhr.statusCode;
                tmp = (
                    // ternary-operator
                    (
                        local.isBrowser
                        ? "browser"
                        : "node"
                    )
                    + " - " + xhr.statusCode + " " + xhr.method + " " + xhr.url
                    + "\n"
                );
                xhr.err.message = tmp + xhr.err.message;
                xhr.err.stack = tmp + xhr.err.stack;
            }
            // update resHeaders
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getAllResponseHeaders
            if (xhr.getAllResponseHeaders) {
                xhr.getAllResponseHeaders().replace((
                    /(.*?):\u0020*(.*?)\r\n/g
                ), function (ignore, match1, match2) {
                    xhr.resHeaders[match1.toLowerCase()] = match2;
                });
            }
            // debug ajaxResponse
            xhr.resContentLength = (
                xhr.response
                && (xhr.response.byteLength || xhr.response.length)
            ) | 0;
            xhr.timeElapsed = Date.now() - xhr.timeStart;
            if (xhr.modeDebug) {
                console.error("serverLog - " + JSON.stringify({
                    time: new Date(xhr.timeStart).toISOString(),
                    type: "ajaxResponse",
                    method: xhr.method,
                    url: xhr.url,
                    statusCode: xhr.statusCode,
                    timeElapsed: xhr.timeElapsed,
                    // extra
                    resContentLength: xhr.resContentLength
                }));
            }
            // init responseType
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType
            switch (xhr.response && xhr.responseType) {
            // init responseText
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText
            case "":
            case "text":
                if (typeof xhr.responseText === "string") {
                    break;
                }
                xhr.responseText = bufferValidateAndCoerce(
                    xhr.response,
                    "string"
                );
                break;
            case "arraybuffer":
                xhr.responseBuffer = bufferValidateAndCoerce(xhr.response);
                break;
            }
            // cleanup timerTimeout
            clearTimeout(xhr.timerTimeout);
            // cleanup reqStream and resStream
            streamCleanup(xhr.reqStream);
            streamCleanup(xhr.resStream);
            onError(xhr.err, xhr);
            break;
        }
    };
    streamCleanup = function (stream) {
    /*
     * this function will try to end or destroy <stream>
     */
        var err;
        // try to end stream
        try {
            stream.end();
        } catch (errCaught) {
            err = errCaught;
        }
        // if err, then try to destroy stream
        if (err) {
            try {
                stream.destroy();
            } catch (ignore) {}
        }
    };
    xhrInit = function () {
    /*
     * this function will init xhr
     */
        // init opt
        Object.keys(opt).forEach(function (key) {
            if (key[0] !== "_") {
                xhr[key] = opt[key];
            }
        });
        // init timeout
        timeout = xhr.timeout || local2.timeoutDefault || 30000;
        // init default
        local.objectAssignDefault(xhr, {
            corsForwardProxyHost: local2.corsForwardProxyHost,
            headers: {},
            location: (local.isBrowser && location) || {},
            method: "GET",
            responseType: ""
        });
        // init headers
        Object.keys(xhr.headers).forEach(function (key) {
            xhr.headers[key.toLowerCase()] = xhr.headers[key];
        });
        // coerce Uint8Array -> Buffer
        if (
            !local.isBrowser
            && !Buffer.isBuffer(xhr.data)
            && Object.prototype.toString.call(xhr.data)
            === "[object Uint8Array]"
        ) {
            Object.setPrototypeOf(xhr.data, Buffer.prototype);
        }
        // init misc
        local2._debugXhr = xhr;
        xhr.onEvent = onEvent;
        xhr.resHeaders = {};
        xhr.timeStart = xhr.timeStart || Date.now();
    };
    // init onError
    if (local2.onErrorWithStack) {
        onError = local2.onErrorWithStack(onError);
    }
    // init xhr - XMLHttpRequest
    xhr = (
        local.isBrowser
        && !opt.httpReq
        && !(local2.serverLocalUrlTest && local2.serverLocalUrlTest(opt.url))
        && new XMLHttpRequest()
    );
    // init xhr - http.request
    if (!xhr) {
        xhr = local.identity(local2.urlParse || require("url").parse)(opt.url);
        // init xhr
        xhrInit();
        // init xhr - http.request
        xhr = local.identity(
            opt.httpReq
            || (local.isBrowser && local2.http.request)
            || require(xhr.protocol.slice(0, -1)).request
        )(xhr, function (resStream) {
        /*
         * this function will read <resStream>
         */
            var chunkList;
            chunkList = [];
            xhr.resHeaders = resStream.resHeaders || resStream.headers;
            xhr.resStream = resStream;
            xhr.statusCode = resStream.statusCode;
            resStream.dataLength = 0;
            resStream.on("data", function (chunk) {
                chunkList.push(chunk);
            });
            resStream.on("end", function () {
                xhr.response = (
                    local.isBrowser
                    ? chunkList[0]
                    : Buffer.concat(chunkList)
                );
                resStream.dataLength = (
                    xhr.response.byteLength || xhr.response.length
                );
                xhr.onEvent({
                    type: "load"
                });
            });
            resStream.on("error", xhr.onEvent);
        });
        xhr.abort = function () {
        /*
         * this function will abort xhr-req
         * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/abort
         */
            xhr.onEvent({
                type: "abort"
            });
        };
        xhr.addEventListener = local.nop;
        xhr.open = local.nop;
        xhr.reqStream = xhr;
        xhr.send = xhr.end;
        xhr.setRequestHeader = local.nop;
        xhr.on("error", onEvent);
    }
    // init xhr
    xhrInit();
    // init timerTimeout
    xhr.timerTimeout = setTimeout(function () {
        xhr.err = xhr.err || new Error(
            "onTimeout - errTimeout - "
            + timeout + " ms - " + "ajax " + xhr.method + " " + xhr.url
        );
        xhr.abort();
        // cleanup reqStream and resStream
        streamCleanup(xhr.reqStream);
        streamCleanup(xhr.resStream);
    }, timeout);
    // increment ajaxProgressCounter
    local2.ajaxProgressCounter = local2.ajaxProgressCounter || 0;
    local2.ajaxProgressCounter += 1;
    // init event-handling
    xhr.addEventListener("abort", xhr.onEvent);
    xhr.addEventListener("error", xhr.onEvent);
    xhr.addEventListener("load", xhr.onEvent);
    xhr.addEventListener("loadstart", ajaxProgressUpdate);
    xhr.addEventListener("progress", ajaxProgressUpdate);
    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/upload
    if (xhr.upload && xhr.upload.addEventListener) {
        xhr.upload.addEventListener("progress", ajaxProgressUpdate);
    }
    // open url - corsForwardProxyHost
    if (local.functionOrNop(local2.corsForwardProxyHostIfNeeded)(xhr)) {
        xhr.open(xhr.method, local2.corsForwardProxyHostIfNeeded(xhr));
        xhr.setRequestHeader(
            "forward-proxy-headers",
            JSON.stringify(xhr.headers)
        );
        xhr.setRequestHeader("forward-proxy-url", xhr.url);
    // open url - default
    } else {
        xhr.open(xhr.method, xhr.url);
    }
    // send headers
    Object.keys(xhr.headers).forEach(function (key) {
        xhr.setRequestHeader(key, xhr.headers[key]);
    });
    // send data
    switch ((xhr.data && xhr.data.constructor) || true) {
    // Blob
    // https://developer.mozilla.org/en-US/docs/Web/API/Blob
    case local2.Blob:
    // FormData
    // https://developer.mozilla.org/en-US/docs/Web/API/FormData
    case local2.FormData:
        local2.blobRead(xhr.data, function (err, data) {
            if (err) {
                xhr.onEvent(err);
                return;
            }
            // send data
            xhr.send(data);
        });
        break;
    default:
        xhr.send(xhr.data);
    }
    return xhr;
};

local.cliRun = function (opt) {
/*
 * this function will run the cli with given <opt>
 */
    local.cliDict._eval = local.cliDict._eval || function () {
    /*
     * <code>
     * will eval <code>
     */
        globalThis.local = local;
        local.vm.runInThisContext(process.argv[3]);
    };
    local.cliDict["--eval"] = local.cliDict["--eval"] || local.cliDict._eval;
    local.cliDict["-e"] = local.cliDict["-e"] || local.cliDict._eval;
    local.cliDict._help = local.cliDict._help || function () {
    /*
     *
     * will print help
     */
        var commandList;
        var file;
        var packageJson;
        var text;
        var textDict;
        commandList = [
            {
                argList: "<arg2>  ...",
                description: "usage:",
                command: [
                    "<arg1>"
                ]
            }, {
                argList: "'console.log(\"hello world\")'",
                description: "example:",
                command: [
                    "--eval"
                ]
            }
        ];
        file = __filename.replace((
            /.*\//
        ), "");
        opt = Object.assign({}, opt);
        packageJson = require("./package.json");
        // validate comment
        opt.rgxComment = opt.rgxComment || (
            /\)\u0020\{\n(?:|\u0020{4})\/\*\n(?:\u0020|\u0020{5})\*((?:\u0020<[^>]*?>|\u0020\.\.\.)*?)\n(?:\u0020|\u0020{5})\*\u0020(will\u0020.*?\S)\n(?:\u0020|\u0020{5})\*\/\n(?:\u0020{4}|\u0020{8})\S/
        );
        textDict = {};
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {
            if (key[0] === "_" && key !== "_default") {
                return;
            }
            text = String(local.cliDict[key]);
            if (key === "_default") {
                key = "";
            }
            textDict[text] = textDict[text] || (ii + 2);
            ii = textDict[text];
            if (commandList[ii]) {
                commandList[ii].command.push(key);
                return;
            }
            try {
                commandList[ii] = opt.rgxComment.exec(text);
                commandList[ii] = {
                    argList: (commandList[ii][1] || "").trim(),
                    command: [
                        key
                    ],
                    description: commandList[ii][2]
                };
            } catch (ignore) {
                local.assertThrow(null, new Error(
                    "cliRun - cannot parse comment in COMMAND "
                    + key
                    + ":\nnew RegExp("
                    + JSON.stringify(opt.rgxComment.source)
                    + ").exec(" + JSON.stringify(text).replace((
                        /\\\\/g
                    ), "\u0000").replace((
                        /\\n/g
                    ), "\\n\\\n").replace((
                        /\u0000/g
                    ), "\\\\") + ");"
                ));
            }
        });
        text = "";
        text += packageJson.name + " (" + packageJson.version + ")\n\n";
        text += commandList.filter(function (elem) {
            return elem;
        }).map(function (elem, ii) {
            elem.command = elem.command.filter(function (elem) {
                return elem;
            });
            switch (ii) {
            case 0:
            case 1:
                elem.argList = [
                    elem.argList
                ];
                break;
            default:
                elem.argList = elem.argList.split(" ");
                elem.description = (
                    "# COMMAND "
                    + (elem.command[0] || "<none>") + "\n# "
                    + elem.description
                );
            }
            return (
                elem.description + "\n  " + file
                + ("  " + elem.command.sort().join("|") + "  ")
                    .replace((
                    /^\u0020{4}$/
                ), "  ")
                + elem.argList.join("  ")
            );
        })
        .join("\n\n");
        console.log(text);
    };
    local.cliDict["--help"] = local.cliDict["--help"] || local.cliDict._help;
    local.cliDict["-h"] = local.cliDict["-h"] || local.cliDict._help;
    local.cliDict._default = local.cliDict._default || local.cliDict._help;
    local.cliDict.help = local.cliDict.help || local.cliDict._help;
    local.cliDict._interactive = local.cliDict._interactive || function () {
    /*
     *
     * will start interactive-mode
     */
        globalThis.local = local;
        local.identity(local.replStart || require("repl").start)({
            useGlobal: true
        });
    };
    local.cliDict["--interactive"] = (
        local.cliDict["--interactive"]
        || local.cliDict._interactive
    );
    local.cliDict["-i"] = local.cliDict["-i"] || local.cliDict._interactive;
    local.cliDict._version = local.cliDict._version || function () {
    /*
     *
     * will print version
     */
        console.log(require(__dirname + "/package.json").version);
    };
    local.cliDict["--version"] = (
        local.cliDict["--version"]
        || local.cliDict._version
    );
    local.cliDict["-v"] = local.cliDict["-v"] || local.cliDict._version;
    // default to --help command if no arguments are given
    if (process.argv.length <= 2) {
        local.cliDict._help();
        return;
    }
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        return;
    }
    local.cliDict._default();
};

local.onErrorDefault = function (err) {
/*
 * this function will if <err> exists, then print it to stderr
 */
    if (err) {
        console.error(err);
    }
    return err;
};

local.onErrorWithStack = function (onError) {
/*
 * this function will create wrapper around <onError>
 * that will append current-stack to err.stack
 */
    var onError2;
    var stack;
    stack = new Error().stack.replace((
        /(.*?)\n.*?$/m
    ), "$1");
    onError2 = function (err, data, meta) {
        if (
            err
            && typeof err.stack === "string"
            && err !== local.errDefault
            && String(err.stack).indexOf(stack.split("\n")[2]) < 0
        ) {
            // append current-stack to err.stack
            err.stack += "\n" + stack;
        }
        onError(err, data, meta);
    };
    // debug onError
    onError2.toString = function () {
        return String(onError);
    };
    return onError2;
};

local.onNext = function (opt, onError) {
/*
 * this function will wrap onError inside recursive-function <opt>.onNext,
 * and append the current-stack to any err
 */
    opt.onNext = local.onErrorWithStack(function (err, data, meta) {
        try {
            opt.modeNext += (
                (err && !opt.modeErrorIgnore)
                ? 1000
                : 1
            );
            if (opt.modeDebug) {
                console.error("onNext - " + JSON.stringify({
                    modeNext: opt.modeNext,
                    errorMessage: err && err.message
                }));
                if (err && err.stack) {
                    console.error(err.stack);
                }
            }
            onError(err, data, meta);
        } catch (errCaught) {
            // throw errCaught to break infinite recursion-loop
            if (opt.errCaught) {
                local.assertThrow(null, opt.errCaught);
            }
            opt.errCaught = errCaught;
            opt.onNext(errCaught, data, meta);
        }
    });
    return opt;
};

local.onParallel = function (onError, onEach, onRetry) {
/*
 * this function will create a function that will
 * 1. run async tasks in parallel
 * 2. if counter === 0 or err occurred, then call onError(err)
 */
    var onParallel;
    onError = local.onErrorWithStack(onError);
    onEach = onEach || local.nop;
    onRetry = onRetry || local.nop;
    onParallel = function (err, data) {
        if (onRetry(err, data)) {
            return;
        }
        // decrement counter
        onParallel.counter -= 1;
        // validate counter
        if (!(onParallel.counter >= 0 || err || onParallel.err)) {
            err = new Error(
                "invalid onParallel.counter = " + onParallel.counter
            );
        // ensure onError is run only once
        } else if (onParallel.counter < 0) {
            return;
        }
        // handle err
        if (err) {
            onParallel.err = err;
            // ensure counter <= 0
            onParallel.counter = -Math.abs(onParallel.counter);
        }
        // call onError when isDone
        if (onParallel.counter <= 0) {
            onError(err, data);
            return;
        }
        onEach();
    };
    // init counter
    onParallel.counter = 0;
    // return callback
    return onParallel;
};

local.onParallelList = function (opt, onEach, onError) {
/*
 * this function will
 * 1. async-run onEach in parallel,
 *    with given <opt>.rateLimit and <opt>.retryLimit
 * 2. call <onError> when onParallel.ii + 1 === <opt>.list.length
 */
    var isListEnd;
    var onEach2;
    var onParallel;
    opt.list = opt.list || [];
    onEach2 = function () {
        while (true) {
            if (!(onParallel.ii + 1 < opt.list.length)) {
                isListEnd = true;
                return;
            }
            if (!(onParallel.counter < opt.rateLimit + 1)) {
                return;
            }
            onParallel.ii += 1;
            onEach({
                elem: opt.list[onParallel.ii],
                ii: onParallel.ii,
                list: opt.list,
                retry: 0
            }, onParallel);
        }
    };
    onParallel = local.onParallel(onError, onEach2, function (err, data) {
        if (err && data && data.retry < opt.retryLimit) {
            local.onErrorDefault(err);
            data.retry += 1;
            setTimeout(function () {
                onParallel.counter -= 1;
                onEach(data, onParallel);
            }, 1000);
            return true;
        }
        // restart if opt.list has grown
        if (isListEnd && (onParallel.ii + 1 < opt.list.length)) {
            isListEnd = null;
            onEach2();
        }
    });
    onParallel.ii = -1;
    opt.rateLimit = Number(opt.rateLimit) || 6;
    opt.rateLimit = Math.max(opt.rateLimit, 1);
    opt.retryLimit = Number(opt.retryLimit) || 2;
    onParallel.counter += 1;
    onEach2();
    onParallel();
};
}());



// run shared js-env code - function
(function () {
local.githubCrudAjax = function (opt, onError) {
/*
 * this function will make a low-level content-req to github
 * https://developer.github.com/v3/repos/contents/
 */
    // init opt
    opt = {
        content: opt.content,
        headers: Object.assign({
            // github oauth authentication
            Authorization: "token " + (
                typeof process === "object"
                && process && process.env.GITHUB_TOKEN
            ),
            // bug-workaround
            // https://developer.github.com/v3/#user-agent-required
            "User-Agent": "undefined"
        }, opt.headers),
        httpReq: opt.httpReq,
        message: opt.message,
        method: opt.method || "GET",
        responseJson: {},
        sha: opt.sha,
        url: opt.url
    };
    opt.url = opt.url
/* jslint ignore:start */
// parse https://github.com/:owner/:repo/blob/:branch/:path
.replace(
    (/^https:\/\/github.com\/([^\/]+?\/[^\/]+?)\/blob\/([^\/]+?)\/(.+)/),
    'https://api.github.com/repos/$1/contents/$3?branch=$2'
)
// parse https://github.com/:owner/:repo/tree/:branch/:path
.replace(
    (/^https:\/\/github.com\/([^\/]+?\/[^\/]+?)\/tree\/([^\/]+?)\/(.+)/),
    'https://api.github.com/repos/$1/contents/$3?branch=$2'
)
// parse https://raw.githubusercontent.com/:owner/:repo/:branch/:path
.replace(
(/^https:\/\/raw.githubusercontent.com\/([^\/]+?\/[^\/]+?)\/([^\/]+?)\/(.+)/),
    'https://api.github.com/repos/$1/contents/$3?branch=$2'
)
// parse https://:owner.github.io/:repo/:path
.replace(
    (/^https:\/\/([^\.]+?)\.github\.io\/([^\/]+?)\/(.+)/),
    'https://api.github.com/repos/$1/$2/contents/$3?branch=gh-pages'
)
// parse :owner/:repo
.replace(
    (/^([^\/]+?\/[^\/]+?)$/),
    'https://github.com/$1'
)
/* jslint ignore:end */
    .replace((
        /\?branch=(.*)/
    ), function (match0, match1) {
        opt.branch = match1;
        if (opt.method === "GET") {
            match0 = match0.replace("branch", "ref");
        }
        return match0;
    });
    if ((
        /^https:\/\/github\.com\/[^\/]+?\/[^\/]+?$/
    ).test(opt.url)) {
        opt.data = JSON.stringify({
            name: opt.url.split("/")[4]
        });
        switch (opt.method) {
        case "DELETE":
            opt.url = (
                "https://api.github.com/repos/"
                + opt.url.split("/").slice(3).join("/")
            );
            break;
        case "POST_ORG":
            opt.url = (
                "https://api.github.com/orgs/"
                + opt.url.split("/")[3] + "/repos"
            );
            break;
        case "POST_USER":
            opt.url = "https://api.github.com/user/repos";
            break;
        }
        opt.method = opt.method.split("_")[0];
    } else {
        if (opt.url.indexOf("https://api.github.com/repos/") !== 0) {
            console.error("githubCrud - invalid url " + opt.url);
            onError(new Error("invalid url " + opt.url));
            return;
        }
        if (opt.method !== "GET") {
            opt.message = (
                opt.message
                || "[ci skip] " + opt.method + " file "
                + opt.url.replace((
                    /\?.*/
                ), "")
            );
            opt.url += "&message=" + encodeURIComponent(opt.message);
            if (opt.sha) {
                opt.url += "&sha=" + opt.sha;
            }
            opt.data = JSON.stringify({
                branch: opt.branch,
                content: Buffer.from(opt.content || "").toString("base64"),
                message: opt.message,
                sha: opt.sha
            });
        }
    }
    local.ajax(opt, function (err, xhr) {
        console.error("serverLog - " + JSON.stringify({
            time: new Date(xhr.timeStart).toISOString(),
            type: "githubCrudResponse",
            method: xhr.method,
            url: xhr.url,
            statusCode: xhr.statusCode,
            timeElapsed: xhr.timeElapsed
        }));
        local.onErrorDefault(
            err
            && err.statusCode !== 404
            && xhr
            && ("githubCrud - " + xhr.responseText)
        );
        try {
            opt.responseJson = JSON.parse(xhr.responseText);
        } catch (ignore) {}
        onError(
            !(opt.method === "DELETE" && xhr.statusCode === 404) && err,
            opt.responseJson
        );
    });
};

local.githubCrudContentDelete = function (opt, onError) {
/*
 * this function will delete github-file <opt>.url
 * https://developer.github.com/v3/repos/contents/#delete-a-file
 */
    opt = {
        httpReq: opt.httpReq,
        message: opt.message,
        url: opt.url
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            // get sha
            local.githubCrudAjax({
                httpReq: opt.httpReq,
                url: opt.url
            }, opt.onNext);
            break;
        case 2:
            // delete file with sha
            if (!err && data.sha) {
                local.githubCrudAjax({
                    httpReq: opt.httpReq,
                    message: opt.message,
                    method: "DELETE",
                    sha: data.sha,
                    url: opt.url
                }, opt.onNext);
                return;
            }
            // delete tree
            local.onParallelList({
                list: data
            }, function (option2, onParallel) {
                onParallel.counter += 1;
                // recurse
                local.githubCrudContentDelete({
                    httpReq: opt.httpReq,
                    message: opt.message,
                    url: option2.elem.url
                }, onParallel);
            }, opt.onNext);
            break;
        default:
            onError(err, data);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.githubCrudContentGet = function (opt, onError) {
/*
 * this function will get github-file <opt>.url
 * https://developer.github.com/v3/repos/contents/#get-contents
 */
    opt = {
        httpReq: opt.httpReq,
        url: opt.url
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            local.githubCrudAjax({
                httpReq: opt.httpReq,
                url: opt.url
            }, opt.onNext);
            break;
        case 2:
            opt.onNext(null, Buffer.from(data.content || "", "base64"));
            break;
        default:
            onError(err, !err && data);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.githubCrudContentPut = function (opt, onError) {
/*
 * this function will put <opt>.content to github-file <opt>.url
 * https://developer.github.com/v3/repos/contents/#create-a-file
 * https://developer.github.com/v3/repos/contents/#update-a-file
 */
    opt = {
        content: opt.content,
        httpReq: opt.httpReq,
        message: opt.message,
        modeErrorIgnore: true,
        url: opt.url
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            // get sha
            local.githubCrudAjax({
                httpReq: opt.httpReq,
                url: opt.url
            }, opt.onNext);
            break;
        case 2:
            // put file with sha
            local.githubCrudAjax({
                content: opt.content,
                httpReq: opt.httpReq,
                message: opt.message,
                method: "PUT",
                sha: data.sha,
                url: opt.url
            }, opt.onNext);
            break;
        default:
            onError(err, data);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.githubCrudContentPutFile = function (opt, onError) {
/*
 * this function will put opt.file to github-file <opt>.url
 * https://developer.github.com/v3/repos/contents/#update-a-file
 */
    opt = {
        file: opt.file,
        httpReq: opt.httpReq,
        message: opt.message,
        url: opt.url
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            // get file from url
            if ((
                /^(?:http|https):\/\//
            ).test(opt.file)) {
                local.ajax({
                    httpReq: opt.httpReq,
                    url: opt.file
                }, function (err, res) {
                    opt.onNext(err, res && res.data);
                });
                return;
            }
            // get file
            local.fs.readFile(opt.file, opt.onNext);
            break;
        case 2:
            local.githubCrudContentPut({
                content: data,
                httpReq: opt.httpReq,
                message: opt.message,
                // resolve file in url
                url: (
                    // ternary-operator
                    (
                        /\/$/
                    ).test(opt.url)
                    ? opt.url + local.path.basename(opt.file)
                    : opt.url
                )
            }, opt.onNext);
            break;
        default:
            onError(err, data);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.githubCrudContentTouch = function (opt, onError) {
/*
 * this function will touch github-file <opt>.url
 * https://developer.github.com/v3/repos/contents/#update-a-file
 */
    opt = {
        httpReq: opt.httpReq,
        message: opt.message,
        modeErrorIgnore: true,
        url: opt.url
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            // get sha
            local.githubCrudAjax({
                httpReq: opt.httpReq,
                url: opt.url
            }, opt.onNext);
            break;
        case 2:
            // put file with sha
            local.githubCrudAjax({
                content: Buffer.from(data.content || "", "base64"),
                httpReq: opt.httpReq,
                message: opt.message,
                method: "PUT",
                sha: data.sha,
                url: opt.url
            }, opt.onNext);
            break;
        default:
            onError(err, data);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.githubCrudContentTouchList = function (opt, onError) {
/*
 * this function will touch github-files <opt>.urlList in parallel
 * https://developer.github.com/v3/repos/contents/#update-a-file
 */
    local.onParallelList({
        list: opt.urlList
    }, function (option2, onParallel) {
        onParallel.counter += 1;
        local.githubCrudContentTouch({
            httpReq: opt.httpReq,
            message: opt.message,
            url: option2.elem
        }, onParallel);
    }, onError);
};

local.githubCrudRepoCreate = function (opt, onError) {
/*
 * this function will create github-repo <opt>.url
 * https://developer.github.com/v3/repos/#create
 */
    local.githubCrudAjax({
        httpReq: opt.httpReq,
        method: "POST_ORG",
        url: opt.url
    }, function (err, data) {
        if (!(err && err.statusCode === 404)) {
            onError(err, data);
            return;
        }
        local.githubCrudAjax({
            httpReq: opt.httpReq,
            method: "POST_USER",
            url: opt.url
        }, onError);
    });
};

local.githubCrudRepoCreateList = function (opt, onError) {
/*
 * this function will create github-repos <opt>.urlList in parallel
 * https://developer.github.com/v3/repos/#create
 */
    local.onParallelList({
        list: opt.urlList
    }, function (option2, onParallel) {
        onParallel.counter += 1;
        local.githubCrudRepoCreate({
            httpReq: opt.httpReq,
            url: option2.elem
        }, onParallel);
    }, onError);
};

local.githubCrudRepoDelete = function (opt, onError) {
/*
 * this function will delete github-repo <opt>.url
 * https://developer.github.com/v3/repos/#delete-a-repository
 */
    local.githubCrudAjax({
        httpReq: opt.httpReq,
        method: "DELETE",
        url: opt.url
    }, onError);
};

local.githubCrudRepoDeleteList = function (opt, onError) {
/*
 * this function will delete github-repos <opt>.urlList in parallel
 * https://developer.github.com/v3/repos/#delete-a-repository
 */
    local.onParallelList({
        list: opt.urlList
    }, function (option2, onParallel) {
        onParallel.counter += 1;
        local.githubCrudRepoDelete({
            httpReq: opt.httpReq,
            url: option2.elem
        }, onParallel);
    }, onError);
};
}());



// run node js-env code - init-after
/* istanbul ignore next */
(function () {
if (local.isBrowser) {
    return;
}



local.cliDict = {};
local.cliDict.delete = function () {
/*
 * <fileRemote|dirRemote> <commitMessage>
 * will delete from github <fileRemote|dirRemote>
 */
    local.github_crud.githubCrudContentDelete({
        message: process.argv[4],
        url: process.argv[3]
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict.get = function () {
/*
 * <fileRemote>
 * will get from github <fileRemote>
 */
    local.github_crud.githubCrudContentGet({
        url: process.argv[3]
    }, function (err, data) {
        try {
            process.stdout.write(data);
        } catch (ignore) {}
        process.exit(Boolean(err));
    });
};

local.cliDict.put = function () {
/*
 * <fileRemote> <fileLocal> <commitMessage>
 * will put on github <fileRemote> to <fileLocal>
 */
    local.github_crud.githubCrudContentPutFile({
        message: process.argv[5],
        url: process.argv[3],
        file: process.argv[4]
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict.repo_create = function () {
/*
 * <repoList>
 * will create on github in parallel, comma-separated <repoList>
 */
    local.github_crud.githubCrudRepoCreateList({
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict.repo_delete = function () {
/*
 * <repoList>
 * will delete from github in parallel, comma-separated <repoList>
 */
    local.github_crud.githubCrudRepoDeleteList({
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict.touch = function () {
/*
 * <fileRemoteList> <commitMessage>
 * will touch on github in parallel, comma-separated <fileRemoteList>
 */
    local.github_crud.githubCrudContentTouchList({
        message: process.argv[4],
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

// run the cli
if (module === require.main && !globalThis.utility2_rollup) {
    local.cliRun();
}
}());



}());
/* script-end /assets.utility2.lib.github_crud.js */



/* script-begin /assets.utility2.lib.istanbul.js */
// usr/bin/env node
/*
 * lib.istanbul.js (2019.8.9)
 * https://github.com/kaizhu256/node-istanbul-lite
 * this zero-dependency package will provide a browser-compatible version of the istanbul (v0.4.5) coverage-tool, with a working web-demo
 *
 */



/* istanbul instrument in package istanbul */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_istanbul = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.istanbul = local;



/* validateLineSortedReset */
// init custom
if (!local.isBrowser) {
    local._istanbul_module = require("module");
    local.process = process;
    local.require = require;
}

local.cliRun = function (opt) {
/*
 * this function will run the cli with given <opt>
 */
    local.cliDict._eval = local.cliDict._eval || function () {
    /*
     * <code>
     * will eval <code>
     */
        globalThis.local = local;
        local.vm.runInThisContext(process.argv[3]);
    };
    local.cliDict["--eval"] = local.cliDict["--eval"] || local.cliDict._eval;
    local.cliDict["-e"] = local.cliDict["-e"] || local.cliDict._eval;
    local.cliDict._help = local.cliDict._help || function () {
    /*
     *
     * will print help
     */
        var commandList;
        var file;
        var packageJson;
        var text;
        var textDict;
        commandList = [
            {
                argList: "<arg2>  ...",
                description: "usage:",
                command: [
                    "<arg1>"
                ]
            }, {
                argList: "'console.log(\"hello world\")'",
                description: "example:",
                command: [
                    "--eval"
                ]
            }
        ];
        file = __filename.replace((
            /.*\//
        ), "");
        opt = Object.assign({}, opt);
        packageJson = require("./package.json");
        // validate comment
        opt.rgxComment = opt.rgxComment || (
            /\)\u0020\{\n(?:|\u0020{4})\/\*\n(?:\u0020|\u0020{5})\*((?:\u0020<[^>]*?>|\u0020\.\.\.)*?)\n(?:\u0020|\u0020{5})\*\u0020(will\u0020.*?\S)\n(?:\u0020|\u0020{5})\*\/\n(?:\u0020{4}|\u0020{8})\S/
        );
        textDict = {};
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {
            if (key[0] === "_" && key !== "_default") {
                return;
            }
            text = String(local.cliDict[key]);
            if (key === "_default") {
                key = "";
            }
            textDict[text] = textDict[text] || (ii + 2);
            ii = textDict[text];
            if (commandList[ii]) {
                commandList[ii].command.push(key);
                return;
            }
            try {
                commandList[ii] = opt.rgxComment.exec(text);
                commandList[ii] = {
                    argList: (commandList[ii][1] || "").trim(),
                    command: [
                        key
                    ],
                    description: commandList[ii][2]
                };
            } catch (ignore) {
                local.assertThrow(null, new Error(
                    "cliRun - cannot parse comment in COMMAND "
                    + key
                    + ":\nnew RegExp("
                    + JSON.stringify(opt.rgxComment.source)
                    + ").exec(" + JSON.stringify(text).replace((
                        /\\\\/g
                    ), "\u0000").replace((
                        /\\n/g
                    ), "\\n\\\n").replace((
                        /\u0000/g
                    ), "\\\\") + ");"
                ));
            }
        });
        text = "";
        text += packageJson.name + " (" + packageJson.version + ")\n\n";
        text += commandList.filter(function (elem) {
            return elem;
        }).map(function (elem, ii) {
            elem.command = elem.command.filter(function (elem) {
                return elem;
            });
            switch (ii) {
            case 0:
            case 1:
                elem.argList = [
                    elem.argList
                ];
                break;
            default:
                elem.argList = elem.argList.split(" ");
                elem.description = (
                    "# COMMAND "
                    + (elem.command[0] || "<none>") + "\n# "
                    + elem.description
                );
            }
            return (
                elem.description + "\n  " + file
                + ("  " + elem.command.sort().join("|") + "  ")
                    .replace((
                    /^\u0020{4}$/
                ), "  ")
                + elem.argList.join("  ")
            );
        })
        .join("\n\n");
        console.log(text);
    };
    local.cliDict["--help"] = local.cliDict["--help"] || local.cliDict._help;
    local.cliDict["-h"] = local.cliDict["-h"] || local.cliDict._help;
    local.cliDict._default = local.cliDict._default || local.cliDict._help;
    local.cliDict.help = local.cliDict.help || local.cliDict._help;
    local.cliDict._interactive = local.cliDict._interactive || function () {
    /*
     *
     * will start interactive-mode
     */
        globalThis.local = local;
        local.identity(local.replStart || require("repl").start)({
            useGlobal: true
        });
    };
    local.cliDict["--interactive"] = (
        local.cliDict["--interactive"]
        || local.cliDict._interactive
    );
    local.cliDict["-i"] = local.cliDict["-i"] || local.cliDict._interactive;
    local.cliDict._version = local.cliDict._version || function () {
    /*
     *
     * will print version
     */
        console.log(require(__dirname + "/package.json").version);
    };
    local.cliDict["--version"] = (
        local.cliDict["--version"]
        || local.cliDict._version
    );
    local.cliDict["-v"] = local.cliDict["-v"] || local.cliDict._version;
    // default to --help command if no arguments are given
    if (process.argv.length <= 2) {
        local.cliDict._help();
        return;
    }
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        return;
    }
    local.cliDict._default();
};

local.fsWriteFileWithMkdirpSync = function (file, data, mode) {
/*
 * this function will synchronously "mkdir -p" and write <data> to <file>
 */
    try {
        if (
            mode === "noWrite"
            || typeof require("fs").writeFileSync !== "function"
        ) {
            return;
        }
    } catch (ignore) {
        return;
    }
    // try to write to file
    try {
        require("fs").writeFileSync(file, data);
    } catch (ignore) {
        // mkdir -p
        require("child_process").spawnSync(
            "mkdir",
            [
                "-p", require("path").dirname(file)
            ],
            {
                stdio: [
                    "ignore", 1, 2
                ]
            }
        );
        // re-write to file
        require("fs").writeFileSync(file, data);
    }
};
}());



// run shared js-env code - function
(function () {
var __dirname;
var process;
var require;
// jslint-hack
local.nop(__dirname, require);
/* istanbul ignore next */
globalThis.__coverageCodeDict__ = globalThis.__coverageCodeDict__ || {};
// mock builtins
__dirname = "";
process = local.process || {
    cwd: function () {
        return "";
    },
    env: {},
    stdout: {}
};
require = function (key) {
    try {
        return local["_istanbul_" + key] || local[key] || local.require(key);
    } catch (ignore) {}
};
local["./package.json"] = {};
// mock module fs
local._istanbul_fs = {};
local._istanbul_fs.readFileSync = function (file) {
    // return head.txt or foot.txt
    file = local[file.slice(-8)];
    if (local.isBrowser) {
        file = file
        .replace("<!doctype html>\n", "")
        .replace((
            /(<\/?)(?:body|html)/g
        ), "$1div");
    }
    if (!local.isBrowser && process.env.npm_package_homepage) {
        file = file.replace(
            "{{env.npm_package_homepage}}",
            process.env.npm_package_homepage
        ).replace(
            "{{env.npm_package_name}}",
            process.env.npm_package_name
        ).replace(
            "{{env.npm_package_version}}",
            process.env.npm_package_version
        );
    } else {
        file = file.replace((
            /<h1\u0020[\S\s]*<\/h1>/
        ), "");
    }
    return file;
};

local._istanbul_fs.readdirSync = function () {
    return [];
};

// mock module path
local._istanbul_path = local.path || {
    dirname: function (file) {
        return file.replace((
            /\/[\w\-.]+?$/
        ), "");
    },
    resolve: function (aa, bb, cc, dd) {
        return dd || cc || bb || aa;
    }
};

local.coverageMerge = function (coverage1, coverage2) {
/*
 * this function will inplace-merge coverage2 into coverage1
 */
    var dict1;
    var dict2;
    coverage1 = coverage1 || {};
    coverage2 = coverage2 || {};
    Object.keys(coverage2).forEach(function (file) {
        if (!coverage2[file]) {
            return;
        }
        // if file is undefined in coverage1, then add it
        if (!coverage1[file]) {
            coverage1[file] = coverage2[file];
            return;
        }
        // merge file from coverage2 into coverage1
        [
            "b", "f", "s"
        ].forEach(function (key) {
            dict1 = coverage1[file][key];
            dict2 = coverage2[file][key];
            switch (key) {
            // increment coverage for branch lines
            case "b":
                Object.keys(dict2).forEach(function (key) {
                    dict2[key].forEach(function (count, ii) {
                        dict1[key][ii] += count;
                    });
                });
                break;
            // increment coverage for function and statement lines
            case "f":
            case "s":
                Object.keys(dict2).forEach(function (key) {
                    dict1[key] += dict2[key];
                });
                break;
            }
        });
    });
    return coverage1;
};

local.coverageReportCreate = function () {
/*
 * this function will
 * 1. print coverage in text-format to stdout
 * 2. write coverage in html-format to filesystem
 * 3. return coverage in html-format as single document
 */
    var opt;
    /* istanbul ignore next */
    if (!globalThis.__coverage__) {
        return "";
    }
    opt = {};
    opt.dir = process.cwd() + "/tmp/build/coverage.html";
    // merge previous coverage
    if (!local.isBrowser && process.env.npm_config_mode_coverage_merge) {
        console.log("merging file " + opt.dir + "/coverage.json to coverage");
        try {
            local.coverageMerge(globalThis.__coverage__, JSON.parse(
                local.fs.readFileSync(opt.dir + "/coverage.json", "utf8")
            ));
        } catch (ignore) {}
        try {
            opt.coverageCodeDict = JSON.parse(local.fs.readFileSync(
                opt.dir + "/coverage.code-dict.json",
                "utf8"
            ));
            Object.keys(opt.coverageCodeDict).forEach(function (key) {
                globalThis.__coverageCodeDict__[key] = (
                    globalThis.__coverageCodeDict__[key]
                    || opt.coverageCodeDict[key]
                );
            });
        } catch (ignore) {}
    }
    // init writer
    local.coverageReportHtml = "";
    local.coverageReportHtml += (
        "<div class=\"coverageReportDiv\">\n"
        + "<h1>coverage-report</h1>\n"
        + "<div style=\""
        + "background: #fff; border: 1px solid #000; margin 0; padding: 0;"
        + "\">\n"
    );
    local.writerData = "";
    opt.sourceStore = {};
    opt.writer = local.writer;
    // 1. print coverage in text-format to stdout
    new local.TextReport(opt).writeReport(local.collector);
    // 2. write coverage in html-format to filesystem
    new local.HtmlReport(opt).writeReport(local.collector);
    local.writer.writeFile("", local.nop);
    if (!local.isBrowser) {
        // write coverage.json
        local.fsWriteFileWithMkdirpSync(
            opt.dir + "/coverage.json",
            JSON.stringify(globalThis.__coverage__)
        );
        // write coverage.code-dict.json
        local.fsWriteFileWithMkdirpSync(
            opt.dir + "/coverage.code-dict.json",
            JSON.stringify(globalThis.__coverageCodeDict__)
        );
        // write coverage.badge.svg
        opt.pct = local.coverageReportSummary.root.metrics.lines.pct;
        local.fsWriteFileWithMkdirpSync(
            local._istanbul_path.dirname(opt.dir) + "/coverage.badge.svg",
            local.templateCoverageBadgeSvg
            // edit coverage badge percent
            .replace((
                /100.0/g
            ), opt.pct)
            // edit coverage badge color
            .replace((
                /0d0/g
            ), ((
                "0" + Math.round((100 - opt.pct) * 2.21).toString(16)
            ).slice(-2) + (
                "0" + Math.round(opt.pct * 2.21).toString(16)
            ).slice(-2) + "00"))
        );
    }
    console.log("created coverage file " + opt.dir + "/index.html");
    // 3. return coverage in html-format as a single document
    local.coverageReportHtml += "</div>\n</div>\n";
    // write coverage.rollup.html
    if (!local.isBrowser) {
        local.fsWriteFileWithMkdirpSync(
            opt.dir + "/coverage.rollup.html",
            local.coverageReportHtml
        );
    }
    return local.coverageReportHtml;
};

/* istanbul ignore next */
local.instrumentInPackage = function (code, file) {
/*
 * this function will instrument the code
 * only if the macro /\* istanbul instrument in package $npm_package_nameLib *\/
 * exists in the code
 */
    return (
        // ternary-operator
        (
            process.env.npm_config_mode_coverage
            && code.indexOf("/* istanbul ignore all */\n") < 0 && (
                process.env.npm_config_mode_coverage === "all"
                || code.indexOf(
                    "/* istanbul instrument in package "
                    + process.env.npm_package_nameLib + " */\n"
                ) >= 0
                || code.indexOf(
                    "/* istanbul instrument in package "
                    + process.env.npm_config_mode_coverage + " */\n"
                ) >= 0
            )
        )
        ? local.instrumentSync(code, file)
        : code
    );
};

local.instrumentSync = function (code, file) {
/*
 * this function will
 * 1. normalize the file
 * 2. save code to __coverageCodeDict__[file] for future html-report
 * 3. return instrumented code
 */
    // 1. normalize the file
    file = local._istanbul_path.resolve("/", file);
    // 2. save code to __coverageCodeDict__[file] for future html-report
    globalThis.__coverageCodeDict__[file] = code;
    // 3. return instrumented code
    return new local.Instrumenter({
        embedSource: true,
        esModules: true,
        noAutoWrap: true
    }).instrumentSync(code, file).trimLeft();
};

local.util = {
inherits: local.nop
};



/*
file https://github.com/jquery/esprima/blob/2.7.3/esprima.js
*/
/* istanbul ignore next */
/* jslint ignore:start */
(function () { var exports; exports = local.esprima = {};
/*
  Copyright (c) jQuery Foundation, Inc. and Contributors, All Rights Reserved.

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

(function (root, factory) {
    'use strict';

    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js,
    // Rhino, and plain browser loading.

    /* istanbul ignore next */
    if (typeof define === 'function' && define.amd) {
        define(['exports'], factory);
    } else if (typeof exports !== 'undefined') {
        factory(exports);
    } else {
        factory((root.esprima = {}));
    }
}(this, function (exports) {
    'use strict';

    var Token,
        TokenName,
        FnExprTokens,
        Syntax,
        PlaceHolders,
        Messages,
        Regex,
        source,
        strict,
        index,
        lineNumber,
        lineStart,
        hasLineTerminator,
        lastIndex,
        lastLineNumber,
        lastLineStart,
        startIndex,
        startLineNumber,
        startLineStart,
        scanning,
        length,
        lookahead,
        state,
        extra,
        isBindingElement,
        isAssignmentTarget,
        firstCoverInitializedNameError;

    Token = {
        BooleanLiteral: 1,
        EOF: 2,
        Identifier: 3,
        Keyword: 4,
        NullLiteral: 5,
        NumericLiteral: 6,
        Punctuator: 7,
        StringLiteral: 8,
        RegularExpression: 9,
        Template: 10
    };

    TokenName = {};
    TokenName[Token.BooleanLiteral] = 'Boolean';
    TokenName[Token.EOF] = '<end>';
    TokenName[Token.Identifier] = 'Identifier';
    TokenName[Token.Keyword] = 'Keyword';
    TokenName[Token.NullLiteral] = 'Null';
    TokenName[Token.NumericLiteral] = 'Numeric';
    TokenName[Token.Punctuator] = 'Punctuator';
    TokenName[Token.StringLiteral] = 'String';
    TokenName[Token.RegularExpression] = 'RegularExpression';
    TokenName[Token.Template] = 'Template';

    // A function following one of those tokens is an expression.
    FnExprTokens = ['(', '{', '[', 'in', 'typeof', 'instanceof', 'new',
                    'return', 'case', 'delete', 'throw', 'void',
                    // assignment operators
                    '=', '+=', '-=', '*=', '/=', '%=', '<<=', '>>=', '>>>=',
                    '&=', '|=', '^=', ',',
                    // binary/unary operators
                    '+', '-', '*', '/', '%', '++', '--', '<<', '>>', '>>>', '&',
                    '|', '^', '!', '~', '&&', '||', '?', ':', '===', '==', '>=',
                    '<=', '<', '>', '!=', '!=='];

    Syntax = {
        AssignmentExpression: 'AssignmentExpression',
        AssignmentPattern: 'AssignmentPattern',
        ArrayExpression: 'ArrayExpression',
        ArrayPattern: 'ArrayPattern',
        ArrowFunctionExpression: 'ArrowFunctionExpression',
        BlockStatement: 'BlockStatement',
        BinaryExpression: 'BinaryExpression',
        BreakStatement: 'BreakStatement',
        CallExpression: 'CallExpression',
        CatchClause: 'CatchClause',
        ClassBody: 'ClassBody',
        ClassDeclaration: 'ClassDeclaration',
        ClassExpression: 'ClassExpression',
        ConditionalExpression: 'ConditionalExpression',
        ContinueStatement: 'ContinueStatement',
        DoWhileStatement: 'DoWhileStatement',
        DebuggerStatement: 'DebuggerStatement',
        EmptyStatement: 'EmptyStatement',
        ExportAllDeclaration: 'ExportAllDeclaration',
        ExportDefaultDeclaration: 'ExportDefaultDeclaration',
        ExportNamedDeclaration: 'ExportNamedDeclaration',
        ExportSpecifier: 'ExportSpecifier',
        ExpressionStatement: 'ExpressionStatement',
        ForStatement: 'ForStatement',
        ForOfStatement: 'ForOfStatement',
        ForInStatement: 'ForInStatement',
        FunctionDeclaration: 'FunctionDeclaration',
        FunctionExpression: 'FunctionExpression',
        Identifier: 'Identifier',
        IfStatement: 'IfStatement',
        ImportDeclaration: 'ImportDeclaration',
        ImportDefaultSpecifier: 'ImportDefaultSpecifier',
        ImportNamespaceSpecifier: 'ImportNamespaceSpecifier',
        ImportSpecifier: 'ImportSpecifier',
        Literal: 'Literal',
        LabeledStatement: 'LabeledStatement',
        LogicalExpression: 'LogicalExpression',
        MemberExpression: 'MemberExpression',
        MetaProperty: 'MetaProperty',
        MethodDefinition: 'MethodDefinition',
        NewExpression: 'NewExpression',
        ObjectExpression: 'ObjectExpression',
        ObjectPattern: 'ObjectPattern',
        Program: 'Program',
        Property: 'Property',
        RestElement: 'RestElement',
        ReturnStatement: 'ReturnStatement',
        SequenceExpression: 'SequenceExpression',
        SpreadElement: 'SpreadElement',
        Super: 'Super',
        SwitchCase: 'SwitchCase',
        SwitchStatement: 'SwitchStatement',
        TaggedTemplateExpression: 'TaggedTemplateExpression',
        TemplateElement: 'TemplateElement',
        TemplateLiteral: 'TemplateLiteral',
        ThisExpression: 'ThisExpression',
        ThrowStatement: 'ThrowStatement',
        TryStatement: 'TryStatement',
        UnaryExpression: 'UnaryExpression',
        UpdateExpression: 'UpdateExpression',
        VariableDeclaration: 'VariableDeclaration',
        VariableDeclarator: 'VariableDeclarator',
        WhileStatement: 'WhileStatement',
        WithStatement: 'WithStatement',
        YieldExpression: 'YieldExpression'
    };

    PlaceHolders = {
        ArrowParameterPlaceHolder: 'ArrowParameterPlaceHolder'
    };

    // Error messages should be identical to V8.
    Messages = {
        UnexpectedToken: 'Unexpected token %0',
        UnexpectedNumber: 'Unexpected number',
        UnexpectedString: 'Unexpected string',
        UnexpectedIdentifier: 'Unexpected identifier',
        UnexpectedReserved: 'Unexpected reserved word',
        UnexpectedTemplate: 'Unexpected quasi %0',
        UnexpectedEOS: 'Unexpected end of input',
        NewlineAfterThrow: 'Illegal newline after throw',
        InvalidRegExp: 'Invalid regular expression',
        UnterminatedRegExp: 'Invalid regular expression: missing /',
        InvalidLHSInAssignment: 'Invalid left-hand side in assignment',
        InvalidLHSInForIn: 'Invalid left-hand side in for-in',
        InvalidLHSInForLoop: 'Invalid left-hand side in for-loop',
        MultipleDefaultsInSwitch: 'More than one default clause in switch statement',
        NoCatchOrFinally: 'Missing catch or finally after try',
        UnknownLabel: 'Undefined label \'%0\'',
        Redeclaration: '%0 \'%1\' has already been declared',
        IllegalContinue: 'Illegal continue statement',
        IllegalBreak: 'Illegal break statement',
        IllegalReturn: 'Illegal return statement',
        StrictModeWith: 'Strict mode code may not include a with statement',
        StrictCatchVariable: 'Catch variable may not be eval or arguments in strict mode',
        StrictVarName: 'Variable name may not be eval or arguments in strict mode',
        StrictParamName: 'Parameter name eval or arguments is not allowed in strict mode',
        StrictParamDupe: 'Strict mode function may not have duplicate parameter names',
        StrictFunctionName: 'Function name may not be eval or arguments in strict mode',
        StrictOctalLiteral: 'Octal literals are not allowed in strict mode.',
        StrictDelete: 'Delete of an unqualified identifier in strict mode.',
        StrictLHSAssignment: 'Assignment to eval or arguments is not allowed in strict mode',
        StrictLHSPostfix: 'Postfix increment/decrement may not have eval or arguments operand in strict mode',
        StrictLHSPrefix: 'Prefix increment/decrement may not have eval or arguments operand in strict mode',
        StrictReservedWord: 'Use of future reserved word in strict mode',
        TemplateOctalLiteral: 'Octal literals are not allowed in template strings.',
        ParameterAfterRestParameter: 'Rest parameter must be last formal parameter',
        DefaultRestParameter: 'Unexpected token =',
        ObjectPatternAsRestParameter: 'Unexpected token {',
        DuplicateProtoProperty: 'Duplicate __proto__ fields are not allowed in object literals',
        ConstructorSpecialMethod: 'Class constructor may not be an accessor',
        DuplicateConstructor: 'A class may only have one constructor',
        StaticPrototype: 'Classes may not have static property named prototype',
        MissingFromClause: 'Unexpected token',
        NoAsAfterImportNamespace: 'Unexpected token',
        InvalidModuleSpecifier: 'Unexpected token',
        IllegalImportDeclaration: 'Unexpected token',
        IllegalExportDeclaration: 'Unexpected token',
        DuplicateBinding: 'Duplicate binding %0'
    };

    // See also tools/generate-unicode-regex.js.
    Regex = {
        // ECMAScript 6/Unicode v7.0.0 NonAsciiIdentifierStart:
        NonAsciiIdentifierStart: /[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,

        // ECMAScript 6/Unicode v7.0.0 NonAsciiIdentifierPart:
        NonAsciiIdentifierPart: /[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/
    };

    // Ensure the condition is true, otherwise throw an error.
    // This is only to have a better contract semantic, i.e. another safety net
    // to catch a logic error. The condition shall be fulfilled in normal case.
    // Do NOT use this to enforce a certain condition on any user input.

    function assert(condition, message) {
        /* istanbul ignore if */
        if (!condition) {
            throw new Error('ASSERT: ' + message);
        }
    }

    function isDecimalDigit(ch) {
        return (ch >= 0x30 && ch <= 0x39);   // 0..9
    }

    function isHexDigit(ch) {
        return '0123456789abcdefABCDEF'.indexOf(ch) >= 0;
    }

    function isOctalDigit(ch) {
        return '01234567'.indexOf(ch) >= 0;
    }

    function octalToDecimal(ch) {
        // \0 is not octal escape sequence
        var octal = (ch !== '0'), code = '01234567'.indexOf(ch);

        if (index < length && isOctalDigit(source[index])) {
            octal = true;
            code = code * 8 + '01234567'.indexOf(source[index++]);

            // 3 digits are only allowed when string starts
            // with 0, 1, 2, 3
            if ('0123'.indexOf(ch) >= 0 &&
                    index < length &&
                    isOctalDigit(source[index])) {
                code = code * 8 + '01234567'.indexOf(source[index++]);
            }
        }

        return {
            code: code,
            octal: octal
        };
    }

    // ECMA-262 11.2 White Space

    function isWhiteSpace(ch) {
        return (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||
            (ch >= 0x1680 && [0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006, 0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF].indexOf(ch) >= 0);
    }

    // ECMA-262 11.3 Line Terminators

    function isLineTerminator(ch) {
        return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029);
    }

    // ECMA-262 11.6 Identifier Names and Identifiers

    function fromCodePoint(cp) {
        return (cp < 0x10000) ? String.fromCharCode(cp) :
            String.fromCharCode(0xD800 + ((cp - 0x10000) >> 10)) +
            String.fromCharCode(0xDC00 + ((cp - 0x10000) & 1023));
    }

    function isIdentifierStart(ch) {
        return (ch === 0x24) || (ch === 0x5F) ||  // $ (dollar) and _ (underscore)
            (ch >= 0x41 && ch <= 0x5A) ||         // A..Z
            (ch >= 0x61 && ch <= 0x7A) ||         // a..z
            (ch === 0x5C) ||                      // \ (backslash)
            ((ch >= 0x80) && Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch)));
    }

    function isIdentifierPart(ch) {
        return (ch === 0x24) || (ch === 0x5F) ||  // $ (dollar) and _ (underscore)
            (ch >= 0x41 && ch <= 0x5A) ||         // A..Z
            (ch >= 0x61 && ch <= 0x7A) ||         // a..z
            (ch >= 0x30 && ch <= 0x39) ||         // 0..9
            (ch === 0x5C) ||                      // \ (backslash)
            ((ch >= 0x80) && Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch)));
    }

    // ECMA-262 11.6.2.2 Future Reserved Words

    function isFutureReservedWord(id) {
        switch (id) {
        case 'enum':
        case 'export':
        case 'import':
        case 'super':
            return true;
        default:
            return false;
        }
    }

    function isStrictModeReservedWord(id) {
        switch (id) {
        case 'implements':
        case 'interface':
        case 'package':
        case 'private':
        case 'protected':
        case 'public':
        case 'static':
        case 'yield':
        case 'let':
            return true;
        default:
            return false;
        }
    }

    function isRestrictedWord(id) {
        return id === 'eval' || id === 'arguments';
    }

    // ECMA-262 11.6.2.1 Keywords

    function isKeyword(id) {
        switch (id.length) {
        case 2:
            return (id === 'if') || (id === 'in') || (id === 'do');
        case 3:
            return (id === 'var') || (id === 'for') || (id === 'new') ||
                (id === 'try') || (id === 'let');
        case 4:
            return (id === 'this') || (id === 'else') || (id === 'case') ||
                (id === 'void') || (id === 'with') || (id === 'enum');
        case 5:
            return (id === 'while') || (id === 'break') || (id === 'catch') ||
                (id === 'throw') || (id === 'const') || (id === 'yield') ||
                (id === 'class') || (id === 'super');
        case 6:
            return (id === 'return') || (id === 'typeof') || (id === 'delete') ||
                (id === 'switch') || (id === 'export') || (id === 'import');
        case 7:
            return (id === 'default') || (id === 'finally') || (id === 'extends');
        case 8:
            return (id === 'function') || (id === 'continue') || (id === 'debugger');
        case 10:
            return (id === 'instanceof');
        default:
            return false;
        }
    }

    // ECMA-262 11.4 Comments

    function addComment(type, value, start, end, loc) {
        var comment;

        assert(typeof start === 'number', 'Comment must have valid position');

        state.lastCommentStart = start;

        comment = {
            type: type,
            value: value
        };
        if (extra.range) {
            comment.range = [start, end];
        }
        if (extra.loc) {
            comment.loc = loc;
        }
        extra.comments.push(comment);
        if (extra.attachComment) {
            extra.leadingComments.push(comment);
            extra.trailingComments.push(comment);
        }
        if (extra.tokenize) {
            comment.type = comment.type + 'Comment';
            if (extra.delegate) {
                comment = extra.delegate(comment);
            }
            extra.tokens.push(comment);
        }
    }

    function skipSingleLineComment(offset) {
        var start, loc, ch, comment;

        start = index - offset;
        loc = {
            start: {
                line: lineNumber,
                column: index - lineStart - offset
            }
        };

        while (index < length) {
            ch = source.charCodeAt(index);
            ++index;
            if (isLineTerminator(ch)) {
                hasLineTerminator = true;
                if (extra.comments) {
                    comment = source.slice(start + offset, index - 1);
                    loc.end = {
                        line: lineNumber,
                        column: index - lineStart - 1
                    };
                    addComment('Line', comment, start, index - 1, loc);
                }
                if (ch === 13 && source.charCodeAt(index) === 10) {
                    ++index;
                }
                ++lineNumber;
                lineStart = index;
                return;
            }
        }

        if (extra.comments) {
            comment = source.slice(start + offset, index);
            loc.end = {
                line: lineNumber,
                column: index - lineStart
            };
            addComment('Line', comment, start, index, loc);
        }
    }

    function skipMultiLineComment() {
        var start, loc, ch, comment;

        if (extra.comments) {
            start = index - 2;
            loc = {
                start: {
                    line: lineNumber,
                    column: index - lineStart - 2
                }
            };
        }

        while (index < length) {
            ch = source.charCodeAt(index);
            if (isLineTerminator(ch)) {
                if (ch === 0x0D && source.charCodeAt(index + 1) === 0x0A) {
                    ++index;
                }
                hasLineTerminator = true;
                ++lineNumber;
                ++index;
                lineStart = index;
            } else if (ch === 0x2A) {
                // Block comment ends with '*/'.
                if (source.charCodeAt(index + 1) === 0x2F) {
                    ++index;
                    ++index;
                    if (extra.comments) {
                        comment = source.slice(start + 2, index - 2);
                        loc.end = {
                            line: lineNumber,
                            column: index - lineStart
                        };
                        addComment('Block', comment, start, index, loc);
                    }
                    return;
                }
                ++index;
            } else {
                ++index;
            }
        }

        // Ran off the end of the file - the whole thing is a comment
        if (extra.comments) {
            loc.end = {
                line: lineNumber,
                column: index - lineStart
            };
            comment = source.slice(start + 2, index);
            addComment('Block', comment, start, index, loc);
        }
        tolerateUnexpectedToken();
    }

    function skipComment() {
        var ch, start;
        hasLineTerminator = false;

        start = (index === 0);
        while (index < length) {
            ch = source.charCodeAt(index);

            if (isWhiteSpace(ch)) {
                ++index;
            } else if (isLineTerminator(ch)) {
                hasLineTerminator = true;
                ++index;
                if (ch === 0x0D && source.charCodeAt(index) === 0x0A) {
                    ++index;
                }
                ++lineNumber;
                lineStart = index;
                start = true;
            } else if (ch === 0x2F) { // U+002F is '/'
                ch = source.charCodeAt(index + 1);
                if (ch === 0x2F) {
                    ++index;
                    ++index;
                    skipSingleLineComment(2);
                    start = true;
                } else if (ch === 0x2A) {  // U+002A is '*'
                    ++index;
                    ++index;
                    skipMultiLineComment();
                } else {
                    break;
                }
            } else if (start && ch === 0x2D) { // U+002D is '-'
                // U+003E is '>'
                if ((source.charCodeAt(index + 1) === 0x2D) && (source.charCodeAt(index + 2) === 0x3E)) {
                    // '-->' is a single-line comment
                    index += 3;
                    skipSingleLineComment(3);
                } else {
                    break;
                }
            } else if (ch === 0x3C) { // U+003C is '<'
                if (source.slice(index + 1, index + 4) === '!--') {
                    ++index; // `<`
                    ++index; // `!`
                    ++index; // `-`
                    ++index; // `-`
                    skipSingleLineComment(4);
                } else {
                    break;
                }
            } else {
                break;
            }
        }
    }

    function scanHexEscape(prefix) {
        var i, len, ch, code = 0;

        len = (prefix === 'u') ? 4 : 2;
        for (i = 0; i < len; ++i) {
            if (index < length && isHexDigit(source[index])) {
                ch = source[index++];
                code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());
            } else {
                return '';
            }
        }
        return String.fromCharCode(code);
    }

    function scanUnicodeCodePointEscape() {
        var ch, code;

        ch = source[index];
        code = 0;

        // At least, one hex digit is required.
        if (ch === '}') {
            throwUnexpectedToken();
        }

        while (index < length) {
            ch = source[index++];
            if (!isHexDigit(ch)) {
                break;
            }
            code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());
        }

        if (code > 0x10FFFF || ch !== '}') {
            throwUnexpectedToken();
        }

        return fromCodePoint(code);
    }

    function codePointAt(i) {
        var cp, first, second;

        cp = source.charCodeAt(i);
        if (cp >= 0xD800 && cp <= 0xDBFF) {
            second = source.charCodeAt(i + 1);
            if (second >= 0xDC00 && second <= 0xDFFF) {
                first = cp;
                cp = (first - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;
            }
        }

        return cp;
    }

    function getComplexIdentifier() {
        var cp, ch, id;

        cp = codePointAt(index);
        id = fromCodePoint(cp);
        index += id.length;

        // '\u' (U+005C, U+0075) denotes an escaped character.
        if (cp === 0x5C) {
            if (source.charCodeAt(index) !== 0x75) {
                throwUnexpectedToken();
            }
            ++index;
            if (source[index] === '{') {
                ++index;
                ch = scanUnicodeCodePointEscape();
            } else {
                ch = scanHexEscape('u');
                cp = ch.charCodeAt(0);
                if (!ch || ch === '\\' || !isIdentifierStart(cp)) {
                    throwUnexpectedToken();
                }
            }
            id = ch;
        }

        while (index < length) {
            cp = codePointAt(index);
            if (!isIdentifierPart(cp)) {
                break;
            }
            ch = fromCodePoint(cp);
            id += ch;
            index += ch.length;

            // '\u' (U+005C, U+0075) denotes an escaped character.
            if (cp === 0x5C) {
                id = id.substr(0, id.length - 1);
                if (source.charCodeAt(index) !== 0x75) {
                    throwUnexpectedToken();
                }
                ++index;
                if (source[index] === '{') {
                    ++index;
                    ch = scanUnicodeCodePointEscape();
                } else {
                    ch = scanHexEscape('u');
                    cp = ch.charCodeAt(0);
                    if (!ch || ch === '\\' || !isIdentifierPart(cp)) {
                        throwUnexpectedToken();
                    }
                }
                id += ch;
            }
        }

        return id;
    }

    function getIdentifier() {
        var start, ch;

        start = index++;
        while (index < length) {
            ch = source.charCodeAt(index);
            if (ch === 0x5C) {
                // Blackslash (U+005C) marks Unicode escape sequence.
                index = start;
                return getComplexIdentifier();
            } else if (ch >= 0xD800 && ch < 0xDFFF) {
                // Need to handle surrogate pairs.
                index = start;
                return getComplexIdentifier();
            }
            if (isIdentifierPart(ch)) {
                ++index;
            } else {
                break;
            }
        }

        return source.slice(start, index);
    }

    function scanIdentifier() {
        var start, id, type;

        start = index;

        // Backslash (U+005C) starts an escaped character.
        id = (source.charCodeAt(index) === 0x5C) ? getComplexIdentifier() : getIdentifier();

        // There is no keyword or literal with only one character.
        // Thus, it must be an identifier.
        if (id.length === 1) {
            type = Token.Identifier;
        } else if (isKeyword(id)) {
            type = Token.Keyword;
        } else if (id === 'null') {
            type = Token.NullLiteral;
        } else if (id === 'true' || id === 'false') {
            type = Token.BooleanLiteral;
        } else {
            type = Token.Identifier;
        }

        return {
            type: type,
            value: id,
            lineNumber: lineNumber,
            lineStart: lineStart,
            start: start,
            end: index
        };
    }

    // ECMA-262 11.7 Punctuators

    function scanPunctuator() {
        var token, str;

        token = {
            type: Token.Punctuator,
            value: '',
            lineNumber: lineNumber,
            lineStart: lineStart,
            start: index,
            end: index
        };

        // Check for most common single-character punctuators.
        str = source[index];
        switch (str) {

        case '(':
            if (extra.tokenize) {
                extra.openParenToken = extra.tokenValues.length;
            }
            ++index;
            break;

        case '{':
            if (extra.tokenize) {
                extra.openCurlyToken = extra.tokenValues.length;
            }
            state.curlyStack.push('{');
            ++index;
            break;

        case '.':
            ++index;
            if (source[index] === '.' && source[index + 1] === '.') {
                // Spread operator: ...
                index += 2;
                str = '...';
            }
            break;

        case '}':
            ++index;
            state.curlyStack.pop();
            break;
        case ')':
        case ';':
        case ',':
        case '[':
        case ']':
        case ':':
        case '?':
        case '~':
            ++index;
            break;

        default:
            // 4-character punctuator.
            str = source.substr(index, 4);
            if (str === '>>>=') {
                index += 4;
            } else {

                // 3-character punctuators.
                str = str.substr(0, 3);
                if (str === '===' || str === '!==' || str === '>>>' ||
                    str === '<<=' || str === '>>=') {
                    index += 3;
                } else {

                    // 2-character punctuators.
                    str = str.substr(0, 2);
                    if (str === '&&' || str === '||' || str === '==' || str === '!=' ||
                        str === '+=' || str === '-=' || str === '*=' || str === '/=' ||
                        str === '++' || str === '--' || str === '<<' || str === '>>' ||
                        str === '&=' || str === '|=' || str === '^=' || str === '%=' ||
                        str === '<=' || str === '>=' || str === '=>') {
                        index += 2;
                    } else {

                        // 1-character punctuators.
                        str = source[index];
                        if ('<>=!+-*%&|^/'.indexOf(str) >= 0) {
                            ++index;
                        }
                    }
                }
            }
        }

        if (index === token.start) {
            throwUnexpectedToken();
        }

        token.end = index;
        token.value = str;
        return token;
    }

    // ECMA-262 11.8.3 Numeric Literals

    function scanHexLiteral(start) {
        var number = '';

        while (index < length) {
            if (!isHexDigit(source[index])) {
                break;
            }
            number += source[index++];
        }

        if (number.length === 0) {
            throwUnexpectedToken();
        }

        // coverage-hack - bigint
        if (source[index] === 'n') { number += source[index++]; }
        if (isIdentifierStart(source.charCodeAt(index))) {
            throwUnexpectedToken();
        }

        return {
            type: Token.NumericLiteral,
            value: parseInt('0x' + number, 16),
            lineNumber: lineNumber,
            lineStart: lineStart,
            start: start,
            end: index
        };
    }

    function scanBinaryLiteral(start) {
        var ch, number;

        number = '';

        while (index < length) {
            ch = source[index];
            if (ch !== '0' && ch !== '1') {
                break;
            }
            number += source[index++];
        }

        if (number.length === 0) {
            // only 0b or 0B
            throwUnexpectedToken();
        }

        // coverage-hack - bigint
        if (source[index] === 'n') { number += source[index++]; }
        if (index < length) {
            ch = source.charCodeAt(index);
            /* istanbul ignore else */
            if (isIdentifierStart(ch) || isDecimalDigit(ch)) {
                throwUnexpectedToken();
            }
        }

        return {
            type: Token.NumericLiteral,
            value: parseInt(number, 2),
            lineNumber: lineNumber,
            lineStart: lineStart,
            start: start,
            end: index
        };
    }

    function scanOctalLiteral(prefix, start) {
        var number, octal;

        if (isOctalDigit(prefix)) {
            octal = true;
            number = '0' + source[index++];
        } else {
            octal = false;
            ++index;
            number = '';
        }

        while (index < length) {
            if (!isOctalDigit(source[index])) {
                break;
            }
            number += source[index++];
        }

        if (!octal && number.length === 0) {
            // only 0o or 0O
            throwUnexpectedToken();
        }

        // coverage-hack - bigint
        if (source[index] === 'n') { number += source[index++]; }
        if (isIdentifierStart(source.charCodeAt(index)) || isDecimalDigit(source.charCodeAt(index))) {
            throwUnexpectedToken();
        }

        return {
            type: Token.NumericLiteral,
            value: parseInt(number, 8),
            octal: octal,
            lineNumber: lineNumber,
            lineStart: lineStart,
            start: start,
            end: index
        };
    }

    function isImplicitOctalLiteral() {
        var i, ch;

        // Implicit octal, unless there is a non-octal digit.
        // (Annex B.1.1 on Numeric Literals)
        for (i = index + 1; i < length; ++i) {
            ch = source[i];
            if (ch === '8' || ch === '9') {
                return false;
            }
            if (!isOctalDigit(ch)) {
                return true;
            }
        }

        return true;
    }

    function scanNumericLiteral() {
        var number, start, ch;

        ch = source[index];
        assert(isDecimalDigit(ch.charCodeAt(0)) || (ch === '.'),
            'Numeric literal must start with a decimal digit or a decimal point');

        start = index;
        number = '';
        if (ch !== '.') {
            number = source[index++];
            ch = source[index];

            // Hex number starts with '0x'.
            // Octal number starts with '0'.
            // Octal number in ES6 starts with '0o'.
            // Binary number in ES6 starts with '0b'.
            if (number === '0') {
                if (ch === 'x' || ch === 'X') {
                    ++index;
                    return scanHexLiteral(start);
                }
                if (ch === 'b' || ch === 'B') {
                    ++index;
                    return scanBinaryLiteral(start);
                }
                if (ch === 'o' || ch === 'O') {
                    return scanOctalLiteral(ch, start);
                }

                if (isOctalDigit(ch)) {
                    if (isImplicitOctalLiteral()) {
                        return scanOctalLiteral(ch, start);
                    }
                }
            }

            while (isDecimalDigit(source.charCodeAt(index))) {
                number += source[index++];
            }
            ch = source[index];
        }

        if (ch === '.') {
            number += source[index++];
            while (isDecimalDigit(source.charCodeAt(index))) {
                number += source[index++];
            }
            ch = source[index];
        }

        if (ch === 'e' || ch === 'E') {
            number += source[index++];

            ch = source[index];
            if (ch === '+' || ch === '-') {
                number += source[index++];
            }
            if (isDecimalDigit(source.charCodeAt(index))) {
                while (isDecimalDigit(source.charCodeAt(index))) {
                    number += source[index++];
                }
            } else {
                throwUnexpectedToken();
            }
        }

        // coverage-hack - bigint
        if (source[index] === 'n') { number += source[index++]; }
        if (isIdentifierStart(source.charCodeAt(index))) {
            throwUnexpectedToken();
        }

        return {
            type: Token.NumericLiteral,
            value: parseFloat(number),
            lineNumber: lineNumber,
            lineStart: lineStart,
            start: start,
            end: index
        };
    }

    // ECMA-262 11.8.4 String Literals

    function scanStringLiteral() {
        var str = '', quote, start, ch, unescaped, octToDec, octal = false;

        quote = source[index];
        assert((quote === '\'' || quote === '"'),
            'String literal must starts with a quote');

        start = index;
        ++index;

        while (index < length) {
            ch = source[index++];

            if (ch === quote) {
                quote = '';
                break;
            } else if (ch === '\\') {
                ch = source[index++];
                if (!ch || !isLineTerminator(ch.charCodeAt(0))) {
                    switch (ch) {
                    case 'u':
                    case 'x':
                        if (source[index] === '{') {
                            ++index;
                            str += scanUnicodeCodePointEscape();
                        } else {
                            unescaped = scanHexEscape(ch);
                            if (!unescaped) {
                                throw throwUnexpectedToken();
                            }
                            str += unescaped;
                        }
                        break;
                    case 'n':
                        str += '\n';
                        break;
                    case 'r':
                        str += '\r';
                        break;
                    case 't':
                        str += '\t';
                        break;
                    case 'b':
                        str += '\b';
                        break;
                    case 'f':
                        str += '\f';
                        break;
                    case 'v':
                        str += '\x0B';
                        break;
                    case '8':
                    case '9':
                        str += ch;
                        tolerateUnexpectedToken();
                        break;

                    default:
                        if (isOctalDigit(ch)) {
                            octToDec = octalToDecimal(ch);

                            octal = octToDec.octal || octal;
                            str += String.fromCharCode(octToDec.code);
                        } else {
                            str += ch;
                        }
                        break;
                    }
                } else {
                    ++lineNumber;
                    if (ch === '\r' && source[index] === '\n') {
                        ++index;
                    }
                    lineStart = index;
                }
            } else if (isLineTerminator(ch.charCodeAt(0))) {
                break;
            } else {
                str += ch;
            }
        }

        if (quote !== '') {
            index = start;
            throwUnexpectedToken();
        }

        return {
            type: Token.StringLiteral,
            value: str,
            octal: octal,
            lineNumber: startLineNumber,
            lineStart: startLineStart,
            start: start,
            end: index
        };
    }

    // ECMA-262 11.8.6 Template Literal Lexical Components

    function scanTemplate() {
        var cooked = '', ch, start, rawOffset, terminated, head, tail, restore, unescaped;

        terminated = false;
        tail = false;
        start = index;
        head = (source[index] === '`');
        rawOffset = 2;

        ++index;

        while (index < length) {
            ch = source[index++];
            if (ch === '`') {
                rawOffset = 1;
                tail = true;
                terminated = true;
                break;
            } else if (ch === '$') {
                if (source[index] === '{') {
                    state.curlyStack.push('${');
                    ++index;
                    terminated = true;
                    break;
                }
                cooked += ch;
            } else if (ch === '\\') {
                ch = source[index++];
                if (!isLineTerminator(ch.charCodeAt(0))) {
                    switch (ch) {
                    case 'n':
                        cooked += '\n';
                        break;
                    case 'r':
                        cooked += '\r';
                        break;
                    case 't':
                        cooked += '\t';
                        break;
                    case 'u':
                    case 'x':
                        if (source[index] === '{') {
                            ++index;
                            cooked += scanUnicodeCodePointEscape();
                        } else {
                            restore = index;
                            unescaped = scanHexEscape(ch);
                            if (unescaped) {
                                cooked += unescaped;
                            } else {
                                index = restore;
                                cooked += ch;
                            }
                        }
                        break;
                    case 'b':
                        cooked += '\b';
                        break;
                    case 'f':
                        cooked += '\f';
                        break;
                    case 'v':
                        cooked += '\v';
                        break;

                    default:
                        if (ch === '0') {
                            if (isDecimalDigit(source.charCodeAt(index))) {
                                // Illegal: \01 \02 and so on
                                throwError(Messages.TemplateOctalLiteral);
                            }
                            cooked += '\0';
                        } else if (isOctalDigit(ch)) {
                            // Illegal: \1 \2
                            throwError(Messages.TemplateOctalLiteral);
                        } else {
                            cooked += ch;
                        }
                        break;
                    }
                } else {
                    ++lineNumber;
                    if (ch === '\r' && source[index] === '\n') {
                        ++index;
                    }
                    lineStart = index;
                }
            } else if (isLineTerminator(ch.charCodeAt(0))) {
                ++lineNumber;
                if (ch === '\r' && source[index] === '\n') {
                    ++index;
                }
                lineStart = index;
                cooked += '\n';
            } else {
                cooked += ch;
            }
        }

        if (!terminated) {
            throwUnexpectedToken();
        }

        if (!head) {
            state.curlyStack.pop();
        }

        return {
            type: Token.Template,
            value: {
                cooked: cooked,
                raw: source.slice(start + 1, index - rawOffset)
            },
            head: head,
            tail: tail,
            lineNumber: lineNumber,
            lineStart: lineStart,
            start: start,
            end: index
        };
    }

    // ECMA-262 11.8.5 Regular Expression Literals

    function testRegExp(pattern, flags) {
        // The BMP character to use as a replacement for astral symbols when
        // translating an ES6 "u"-flagged pattern to an ES5-compatible
        // approximation.
        // Note: replacing with '\uFFFF' enables false positives in unlikely
        // scenarios. For example, `[\u{1044f}-\u{10440}]` is an invalid
        // pattern that would not be detected by this substitution.
        var astralSubstitute = '\uFFFF',
            tmp = pattern;

        if (flags.indexOf('u') >= 0) {
            tmp = tmp
                // Replace every Unicode escape sequence with the equivalent
                // BMP character or a constant ASCII code point in the case of
                // astral symbols. (See the above note on `astralSubstitute`
                // for more information.)
                .replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g, function ($0, $1, $2) {
                    var codePoint = parseInt($1 || $2, 16);
                    if (codePoint > 0x10FFFF) {
                        throwUnexpectedToken(null, Messages.InvalidRegExp);
                    }
                    if (codePoint <= 0xFFFF) {
                        return String.fromCharCode(codePoint);
                    }
                    return astralSubstitute;
                })
                // Replace each paired surrogate with a single ASCII symbol to
                // avoid throwing on regular expressions that are only valid in
                // combination with the "u" flag.
                .replace(
                    /[\uD800-\uDBFF][\uDC00-\uDFFF]/g,
                    astralSubstitute
                );
        }

        // First, detect invalid regular expressions.
        try {
            RegExp(tmp);
        } catch (e) {
            throwUnexpectedToken(null, Messages.InvalidRegExp);
        }

        // Return a regular expression object for this pattern-flag pair, or
        // `null` in case the current environment doesn't support the flags it
        // uses.
        try {
            return new RegExp(pattern, flags);
        } catch (exception) {
            /* istanbul ignore next */
            return null;
        }
    }

    function scanRegExpBody() {
        var ch, str, classMarker, terminated, body;

        ch = source[index];
        assert(ch === '/', 'Regular expression literal must start with a slash');
        str = source[index++];

        classMarker = false;
        terminated = false;
        while (index < length) {
            ch = source[index++];
            str += ch;
            if (ch === '\\') {
                ch = source[index++];
                // ECMA-262 7.8.5
                if (isLineTerminator(ch.charCodeAt(0))) {
                    throwUnexpectedToken(null, Messages.UnterminatedRegExp);
                }
                str += ch;
            } else if (isLineTerminator(ch.charCodeAt(0))) {
                throwUnexpectedToken(null, Messages.UnterminatedRegExp);
            } else if (classMarker) {
                if (ch === ']') {
                    classMarker = false;
                }
            } else {
                if (ch === '/') {
                    terminated = true;
                    break;
                } else if (ch === '[') {
                    classMarker = true;
                }
            }
        }

        if (!terminated) {
            throwUnexpectedToken(null, Messages.UnterminatedRegExp);
        }

        // Exclude leading and trailing slash.
        body = str.substr(1, str.length - 2);
        return {
            value: body,
            literal: str
        };
    }

    function scanRegExpFlags() {
        var ch, str, flags, restore;

        str = '';
        flags = '';
        while (index < length) {
            ch = source[index];
            if (!isIdentifierPart(ch.charCodeAt(0))) {
                break;
            }

            ++index;
            if (ch === '\\' && index < length) {
                ch = source[index];
                if (ch === 'u') {
                    ++index;
                    restore = index;
                    ch = scanHexEscape('u');
                    if (ch) {
                        flags += ch;
                        for (str += '\\u'; restore < index; ++restore) {
                            str += source[restore];
                        }
                    } else {
                        index = restore;
                        flags += 'u';
                        str += '\\u';
                    }
                    tolerateUnexpectedToken();
                } else {
                    str += '\\';
                    tolerateUnexpectedToken();
                }
            } else {
                flags += ch;
                str += ch;
            }
        }

        return {
            value: flags,
            literal: str
        };
    }

    function scanRegExp() {
        var start, body, flags, value;
        scanning = true;

        lookahead = null;
        skipComment();
        start = index;

        body = scanRegExpBody();
        flags = scanRegExpFlags();
        value = testRegExp(body.value, flags.value);
        scanning = false;
        if (extra.tokenize) {
            return {
                type: Token.RegularExpression,
                value: value,
                regex: {
                    pattern: body.value,
                    flags: flags.value
                },
                lineNumber: lineNumber,
                lineStart: lineStart,
                start: start,
                end: index
            };
        }

        return {
            literal: body.literal + flags.literal,
            value: value,
            regex: {
                pattern: body.value,
                flags: flags.value
            },
            start: start,
            end: index
        };
    }

    function collectRegex() {
        var pos, loc, regex, token;

        skipComment();

        pos = index;
        loc = {
            start: {
                line: lineNumber,
                column: index - lineStart
            }
        };

        regex = scanRegExp();

        loc.end = {
            line: lineNumber,
            column: index - lineStart
        };

        /* istanbul ignore next */
        if (!extra.tokenize) {
            // Pop the previous token, which is likely '/' or '/='
            if (extra.tokens.length > 0) {
                token = extra.tokens[extra.tokens.length - 1];
                if (token.range[0] === pos && token.type === 'Punctuator') {
                    if (token.value === '/' || token.value === '/=') {
                        extra.tokens.pop();
                    }
                }
            }

            extra.tokens.push({
                type: 'RegularExpression',
                value: regex.literal,
                regex: regex.regex,
                range: [pos, index],
                loc: loc
            });
        }

        return regex;
    }

    function isIdentifierName(token) {
        return token.type === Token.Identifier ||
            token.type === Token.Keyword ||
            token.type === Token.BooleanLiteral ||
            token.type === Token.NullLiteral;
    }

    // Using the following algorithm:
    // https://github.com/mozilla/sweet.js/wiki/design

    function advanceSlash() {
        var regex, previous, check;

        function testKeyword(value) {
            return value && (value.length > 1) && (value[0] >= 'a') && (value[0] <= 'z');
        }

        previous = extra.tokenValues[extra.tokenValues.length - 1];
        regex = (previous !== null);

        switch (previous) {
        case 'this':
        case ']':
            regex = false;
            break;

        case ')':
            check = extra.tokenValues[extra.openParenToken - 1];
            regex = (check === 'if' || check === 'while' || check === 'for' || check === 'with');
            break;

        case '}':
            // Dividing a function by anything makes little sense,
            // but we have to check for that.
            regex = false;
            if (testKeyword(extra.tokenValues[extra.openCurlyToken - 3])) {
                // Anonymous function, e.g. function(){} /42
                check = extra.tokenValues[extra.openCurlyToken - 4];
                regex = check ? (FnExprTokens.indexOf(check) < 0) : false;
            } else if (testKeyword(extra.tokenValues[extra.openCurlyToken - 4])) {
                // Named function, e.g. function f(){} /42/
                check = extra.tokenValues[extra.openCurlyToken - 5];
                regex = check ? (FnExprTokens.indexOf(check) < 0) : true;
            }
        }

        return regex ? collectRegex() : scanPunctuator();
    }

    function advance() {
        var cp, token;

        if (index >= length) {
            return {
                type: Token.EOF,
                lineNumber: lineNumber,
                lineStart: lineStart,
                start: index,
                end: index
            };
        }

        cp = source.charCodeAt(index);

        if (isIdentifierStart(cp)) {
            token = scanIdentifier();
            if (strict && isStrictModeReservedWord(token.value)) {
                token.type = Token.Keyword;
            }
            return token;
        }

        // Very common: ( and ) and ;
        if (cp === 0x28 || cp === 0x29 || cp === 0x3B) {
            return scanPunctuator();
        }

        // String literal starts with single quote (U+0027) or double quote (U+0022).
        if (cp === 0x27 || cp === 0x22) {
            return scanStringLiteral();
        }

        // Dot (.) U+002E can also start a floating-point number, hence the need
        // to check the next character.
        if (cp === 0x2E) {
            if (isDecimalDigit(source.charCodeAt(index + 1))) {
                return scanNumericLiteral();
            }
            return scanPunctuator();
        }

        if (isDecimalDigit(cp)) {
            return scanNumericLiteral();
        }

        // Slash (/) U+002F can also start a regex.
        if (extra.tokenize && cp === 0x2F) {
            return advanceSlash();
        }

        // Template literals start with ` (U+0060) for template head
        // or } (U+007D) for template middle or template tail.
        if (cp === 0x60 || (cp === 0x7D && state.curlyStack[state.curlyStack.length - 1] === '${')) {
            return scanTemplate();
        }

        // Possible identifier start in a surrogate pair.
        if (cp >= 0xD800 && cp < 0xDFFF) {
            cp = codePointAt(index);
            if (isIdentifierStart(cp)) {
                return scanIdentifier();
            }
        }

        return scanPunctuator();
    }

    function collectToken() {
        var loc, token, value, entry;

        loc = {
            start: {
                line: lineNumber,
                column: index - lineStart
            }
        };

        token = advance();
        loc.end = {
            line: lineNumber,
            column: index - lineStart
        };

        if (token.type !== Token.EOF) {
            value = source.slice(token.start, token.end);
            entry = {
                type: TokenName[token.type],
                value: value,
                range: [token.start, token.end],
                loc: loc
            };
            if (token.regex) {
                entry.regex = {
                    pattern: token.regex.pattern,
                    flags: token.regex.flags
                };
            }
            if (extra.tokenValues) {
                extra.tokenValues.push((entry.type === 'Punctuator' || entry.type === 'Keyword') ? entry.value : null);
            }
            if (extra.tokenize) {
                if (!extra.range) {
                    delete entry.range;
                }
                if (!extra.loc) {
                    delete entry.loc;
                }
                if (extra.delegate) {
                    entry = extra.delegate(entry);
                }
            }
            extra.tokens.push(entry);
        }

        return token;
    }

    function lex() {
        var token;
        scanning = true;

        lastIndex = index;
        lastLineNumber = lineNumber;
        lastLineStart = lineStart;

        skipComment();

        token = lookahead;

        startIndex = index;
        startLineNumber = lineNumber;
        startLineStart = lineStart;

        lookahead = (typeof extra.tokens !== 'undefined') ? collectToken() : advance();
        scanning = false;
        return token;
    }

    function peek() {
        scanning = true;

        skipComment();

        lastIndex = index;
        lastLineNumber = lineNumber;
        lastLineStart = lineStart;

        startIndex = index;
        startLineNumber = lineNumber;
        startLineStart = lineStart;

        lookahead = (typeof extra.tokens !== 'undefined') ? collectToken() : advance();
        scanning = false;
    }

    function Position() {
        this.line = startLineNumber;
        this.column = startIndex - startLineStart;
    }

    function SourceLocation() {
        this.start = new Position();
        this.end = null;
    }

    function WrappingSourceLocation(startToken) {
        this.start = {
            line: startToken.lineNumber,
            column: startToken.start - startToken.lineStart
        };
        this.end = null;
    }

    function Node() {
        if (extra.range) {
            this.range = [startIndex, 0];
        }
        if (extra.loc) {
            this.loc = new SourceLocation();
        }
    }

    function WrappingNode(startToken) {
        if (extra.range) {
            this.range = [startToken.start, 0];
        }
        if (extra.loc) {
            this.loc = new WrappingSourceLocation(startToken);
        }
    }

    WrappingNode.prototype = Node.prototype = {

        processComment: function () {
            var lastChild,
                innerComments,
                leadingComments,
                trailingComments,
                bottomRight = extra.bottomRightStack,
                i,
                comment,
                last = bottomRight[bottomRight.length - 1];

            if (this.type === Syntax.Program) {
                if (this.body.length > 0) {
                    return;
                }
            }
            /**
             * patch innnerComments for properties empty block
             * `function a() {/** comments **\/}`
             */

            if (this.type === Syntax.BlockStatement && this.body.length === 0) {
                innerComments = [];
                for (i = extra.leadingComments.length - 1; i >= 0; --i) {
                    comment = extra.leadingComments[i];
                    if (this.range[1] >= comment.range[1]) {
                        innerComments.unshift(comment);
                        extra.leadingComments.splice(i, 1);
                        extra.trailingComments.splice(i, 1);
                    }
                }
                if (innerComments.length) {
                    this.innerComments = innerComments;
                    //bottomRight.push(this);
                    return;
                }
            }

            if (extra.trailingComments.length > 0) {
                trailingComments = [];
                for (i = extra.trailingComments.length - 1; i >= 0; --i) {
                    comment = extra.trailingComments[i];
                    if (comment.range[0] >= this.range[1]) {
                        trailingComments.unshift(comment);
                        extra.trailingComments.splice(i, 1);
                    }
                }
                extra.trailingComments = [];
            } else {
                if (last && last.trailingComments && last.trailingComments[0].range[0] >= this.range[1]) {
                    trailingComments = last.trailingComments;
                    delete last.trailingComments;
                }
            }

            // Eating the stack.
            while (last && last.range[0] >= this.range[0]) {
                lastChild = bottomRight.pop();
                last = bottomRight[bottomRight.length - 1];
            }

            if (lastChild) {
                if (lastChild.leadingComments) {
                    leadingComments = [];
                    for (i = lastChild.leadingComments.length - 1; i >= 0; --i) {
                        comment = lastChild.leadingComments[i];
                        if (comment.range[1] <= this.range[0]) {
                            leadingComments.unshift(comment);
                            lastChild.leadingComments.splice(i, 1);
                        }
                    }

                    if (!lastChild.leadingComments.length) {
                        lastChild.leadingComments = undefined;
                    }
                }
            } else if (extra.leadingComments.length > 0) {
                leadingComments = [];
                for (i = extra.leadingComments.length - 1; i >= 0; --i) {
                    comment = extra.leadingComments[i];
                    if (comment.range[1] <= this.range[0]) {
                        leadingComments.unshift(comment);
                        extra.leadingComments.splice(i, 1);
                    }
                }
            }

            if (leadingComments && leadingComments.length > 0) {
                this.leadingComments = leadingComments;
            }
            if (trailingComments && trailingComments.length > 0) {
                this.trailingComments = trailingComments;
            }

            bottomRight.push(this);
        },

        finish: function () {
            if (extra.range) {
                this.range[1] = lastIndex;
            }
            if (extra.loc) {
                this.loc.end = {
                    line: lastLineNumber,
                    column: lastIndex - lastLineStart
                };
                if (extra.source) {
                    this.loc.source = extra.source;
                }
            }

            if (extra.attachComment) {
                this.processComment();
            }
        },

        finishArrayExpression: function (elements) {
            this.type = Syntax.ArrayExpression;
            this.elements = elements;
            this.finish();
            return this;
        },

        finishArrayPattern: function (elements) {
            this.type = Syntax.ArrayPattern;
            this.elements = elements;
            this.finish();
            return this;
        },

        finishArrowFunctionExpression: function (params, defaults, body, expression) {
            this.type = Syntax.ArrowFunctionExpression;
            this.id = null;
            this.params = params;
            this.defaults = defaults;
            this.body = body;
            this.generator = false;
            this.expression = expression;
            this.finish();
            return this;
        },

        finishAssignmentExpression: function (operator, left, right) {
            this.type = Syntax.AssignmentExpression;
            this.operator = operator;
            this.left = left;
            this.right = right;
            this.finish();
            return this;
        },

        finishAssignmentPattern: function (left, right) {
            this.type = Syntax.AssignmentPattern;
            this.left = left;
            this.right = right;
            this.finish();
            return this;
        },

        finishBinaryExpression: function (operator, left, right) {
            this.type = (operator === '||' || operator === '&&') ? Syntax.LogicalExpression : Syntax.BinaryExpression;
            this.operator = operator;
            this.left = left;
            this.right = right;
            this.finish();
            return this;
        },

        finishBlockStatement: function (body) {
            this.type = Syntax.BlockStatement;
            this.body = body;
            this.finish();
            return this;
        },

        finishBreakStatement: function (label) {
            this.type = Syntax.BreakStatement;
            this.label = label;
            this.finish();
            return this;
        },

        finishCallExpression: function (callee, args) {
            this.type = Syntax.CallExpression;
            this.callee = callee;
            this.arguments = args;
            this.finish();
            return this;
        },

        finishCatchClause: function (param, body) {
            this.type = Syntax.CatchClause;
            this.param = param;
            this.body = body;
            this.finish();
            return this;
        },

        finishClassBody: function (body) {
            this.type = Syntax.ClassBody;
            this.body = body;
            this.finish();
            return this;
        },

        finishClassDeclaration: function (id, superClass, body) {
            this.type = Syntax.ClassDeclaration;
            this.id = id;
            this.superClass = superClass;
            this.body = body;
            this.finish();
            return this;
        },

        finishClassExpression: function (id, superClass, body) {
            this.type = Syntax.ClassExpression;
            this.id = id;
            this.superClass = superClass;
            this.body = body;
            this.finish();
            return this;
        },

        finishConditionalExpression: function (test, consequent, alternate) {
            this.type = Syntax.ConditionalExpression;
            this.test = test;
            this.consequent = consequent;
            this.alternate = alternate;
            this.finish();
            return this;
        },

        finishContinueStatement: function (label) {
            this.type = Syntax.ContinueStatement;
            this.label = label;
            this.finish();
            return this;
        },

        finishDebuggerStatement: function () {
            this.type = Syntax.DebuggerStatement;
            this.finish();
            return this;
        },

        finishDoWhileStatement: function (body, test) {
            this.type = Syntax.DoWhileStatement;
            this.body = body;
            this.test = test;
            this.finish();
            return this;
        },

        finishEmptyStatement: function () {
            this.type = Syntax.EmptyStatement;
            this.finish();
            return this;
        },

        finishExpressionStatement: function (expression) {
            this.type = Syntax.ExpressionStatement;
            this.expression = expression;
            this.finish();
            return this;
        },

        finishForStatement: function (init, test, update, body) {
            this.type = Syntax.ForStatement;
            this.init = init;
            this.test = test;
            this.update = update;
            this.body = body;
            this.finish();
            return this;
        },

        finishForOfStatement: function (left, right, body) {
            this.type = Syntax.ForOfStatement;
            this.left = left;
            this.right = right;
            this.body = body;
            this.finish();
            return this;
        },

        finishForInStatement: function (left, right, body) {
            this.type = Syntax.ForInStatement;
            this.left = left;
            this.right = right;
            this.body = body;
            this.each = false;
            this.finish();
            return this;
        },

        finishFunctionDeclaration: function (id, params, defaults, body, generator) {
            this.type = Syntax.FunctionDeclaration;
            this.id = id;
            this.params = params;
            this.defaults = defaults;
            this.body = body;
            this.generator = generator;
            this.expression = false;
            this.finish();
            return this;
        },

        finishFunctionExpression: function (id, params, defaults, body, generator) {
            this.type = Syntax.FunctionExpression;
            this.id = id;
            this.params = params;
            this.defaults = defaults;
            this.body = body;
            this.generator = generator;
            this.expression = false;
            this.finish();
            return this;
        },

        finishIdentifier: function (name) {
            this.type = Syntax.Identifier;
            this.name = name;
            this.finish();
            return this;
        },

        finishIfStatement: function (test, consequent, alternate) {
            this.type = Syntax.IfStatement;
            this.test = test;
            this.consequent = consequent;
            this.alternate = alternate;
            this.finish();
            return this;
        },

        finishLabeledStatement: function (label, body) {
            this.type = Syntax.LabeledStatement;
            this.label = label;
            this.body = body;
            this.finish();
            return this;
        },

        finishLiteral: function (token) {
            this.type = Syntax.Literal;
            this.value = token.value;
            this.raw = source.slice(token.start, token.end);
            if (token.regex) {
                this.regex = token.regex;
            }
            this.finish();
            return this;
        },

        finishMemberExpression: function (accessor, object, property) {
            this.type = Syntax.MemberExpression;
            this.computed = accessor === '[';
            this.object = object;
            this.property = property;
            this.finish();
            return this;
        },

        finishMetaProperty: function (meta, property) {
            this.type = Syntax.MetaProperty;
            this.meta = meta;
            this.property = property;
            this.finish();
            return this;
        },

        finishNewExpression: function (callee, args) {
            this.type = Syntax.NewExpression;
            this.callee = callee;
            this.arguments = args;
            this.finish();
            return this;
        },

        finishObjectExpression: function (properties) {
            this.type = Syntax.ObjectExpression;
            this.properties = properties;
            this.finish();
            return this;
        },

        finishObjectPattern: function (properties) {
            this.type = Syntax.ObjectPattern;
            this.properties = properties;
            this.finish();
            return this;
        },

        finishPostfixExpression: function (operator, argument) {
            this.type = Syntax.UpdateExpression;
            this.operator = operator;
            this.argument = argument;
            this.prefix = false;
            this.finish();
            return this;
        },

        finishProgram: function (body, sourceType) {
            this.type = Syntax.Program;
            this.body = body;
            this.sourceType = sourceType;
            this.finish();
            return this;
        },

        finishProperty: function (kind, key, computed, value, method, shorthand) {
            this.type = Syntax.Property;
            this.key = key;
            this.computed = computed;
            this.value = value;
            this.kind = kind;
            this.method = method;
            this.shorthand = shorthand;
            this.finish();
            return this;
        },

        finishRestElement: function (argument) {
            this.type = Syntax.RestElement;
            this.argument = argument;
            this.finish();
            return this;
        },

        finishReturnStatement: function (argument) {
            this.type = Syntax.ReturnStatement;
            this.argument = argument;
            this.finish();
            return this;
        },

        finishSequenceExpression: function (expressions) {
            this.type = Syntax.SequenceExpression;
            this.expressions = expressions;
            this.finish();
            return this;
        },

        finishSpreadElement: function (argument) {
            this.type = Syntax.SpreadElement;
            this.argument = argument;
            this.finish();
            return this;
        },

        finishSwitchCase: function (test, consequent) {
            this.type = Syntax.SwitchCase;
            this.test = test;
            this.consequent = consequent;
            this.finish();
            return this;
        },

        finishSuper: function () {
            this.type = Syntax.Super;
            this.finish();
            return this;
        },

        finishSwitchStatement: function (discriminant, cases) {
            this.type = Syntax.SwitchStatement;
            this.discriminant = discriminant;
            this.cases = cases;
            this.finish();
            return this;
        },

        finishTaggedTemplateExpression: function (tag, quasi) {
            this.type = Syntax.TaggedTemplateExpression;
            this.tag = tag;
            this.quasi = quasi;
            this.finish();
            return this;
        },

        finishTemplateElement: function (value, tail) {
            this.type = Syntax.TemplateElement;
            this.value = value;
            this.tail = tail;
            this.finish();
            return this;
        },

        finishTemplateLiteral: function (quasis, expressions) {
            this.type = Syntax.TemplateLiteral;
            this.quasis = quasis;
            this.expressions = expressions;
            this.finish();
            return this;
        },

        finishThisExpression: function () {
            this.type = Syntax.ThisExpression;
            this.finish();
            return this;
        },

        finishThrowStatement: function (argument) {
            this.type = Syntax.ThrowStatement;
            this.argument = argument;
            this.finish();
            return this;
        },

        finishTryStatement: function (block, handler, finalizer) {
            this.type = Syntax.TryStatement;
            this.block = block;
            this.guardedHandlers = [];
            this.handlers = handler ? [handler] : [];
            this.handler = handler;
            this.finalizer = finalizer;
            this.finish();
            return this;
        },

        finishUnaryExpression: function (operator, argument) {
            this.type = (operator === '++' || operator === '--') ? Syntax.UpdateExpression : Syntax.UnaryExpression;
            this.operator = operator;
            this.argument = argument;
            this.prefix = true;
            this.finish();
            return this;
        },

        finishVariableDeclaration: function (declarations) {
            this.type = Syntax.VariableDeclaration;
            this.declarations = declarations;
            this.kind = 'var';
            this.finish();
            return this;
        },

        finishLexicalDeclaration: function (declarations, kind) {
            this.type = Syntax.VariableDeclaration;
            this.declarations = declarations;
            this.kind = kind;
            this.finish();
            return this;
        },

        finishVariableDeclarator: function (id, init) {
            this.type = Syntax.VariableDeclarator;
            this.id = id;
            this.init = init;
            this.finish();
            return this;
        },

        finishWhileStatement: function (test, body) {
            this.type = Syntax.WhileStatement;
            this.test = test;
            this.body = body;
            this.finish();
            return this;
        },

        finishWithStatement: function (object, body) {
            this.type = Syntax.WithStatement;
            this.object = object;
            this.body = body;
            this.finish();
            return this;
        },

        finishExportSpecifier: function (local, exported) {
            this.type = Syntax.ExportSpecifier;
            this.exported = exported || local;
            this.local = local;
            this.finish();
            return this;
        },

        finishImportDefaultSpecifier: function (local) {
            this.type = Syntax.ImportDefaultSpecifier;
            this.local = local;
            this.finish();
            return this;
        },

        finishImportNamespaceSpecifier: function (local) {
            this.type = Syntax.ImportNamespaceSpecifier;
            this.local = local;
            this.finish();
            return this;
        },

        finishExportNamedDeclaration: function (declaration, specifiers, src) {
            this.type = Syntax.ExportNamedDeclaration;
            this.declaration = declaration;
            this.specifiers = specifiers;
            this.source = src;
            this.finish();
            return this;
        },

        finishExportDefaultDeclaration: function (declaration) {
            this.type = Syntax.ExportDefaultDeclaration;
            this.declaration = declaration;
            this.finish();
            return this;
        },

        finishExportAllDeclaration: function (src) {
            this.type = Syntax.ExportAllDeclaration;
            this.source = src;
            this.finish();
            return this;
        },

        finishImportSpecifier: function (local, imported) {
            this.type = Syntax.ImportSpecifier;
            this.local = local || imported;
            this.imported = imported;
            this.finish();
            return this;
        },

        finishImportDeclaration: function (specifiers, src) {
            this.type = Syntax.ImportDeclaration;
            this.specifiers = specifiers;
            this.source = src;
            this.finish();
            return this;
        },

        finishYieldExpression: function (argument, delegate) {
            this.type = Syntax.YieldExpression;
            this.argument = argument;
            this.delegate = delegate;
            this.finish();
            return this;
        }
    };

    function recordError(error) {
        var e, existing;

        for (e = 0; e < extra.errors.length; e++) {
            existing = extra.errors[e];
            // Prevent duplicated error.
            /* istanbul ignore next */
            if (existing.index === error.index && existing.message === error.message) {
                return;
            }
        }

        extra.errors.push(error);
    }

    function constructError(msg, column) {
        var error = new Error(msg);
        try {
            throw error;
        } catch (base) {
            /* istanbul ignore else */
            if (Object.create && Object.defineProperty) {
                error = Object.create(base);
                Object.defineProperty(error, 'column', { value: column });
            }
        } finally {
            return error;
        }
    }

    function createError(line, pos, description) {
        var msg, column, error;

        msg = 'Line ' + line + ': ' + description;
        column = pos - (scanning ? lineStart : lastLineStart) + 1;
        error = constructError(msg, column);
        error.lineNumber = line;
        error.description = description;
        error.index = pos;
        return error;
    }

    // Throw an exception

    function throwError(messageFormat) {
        var args, msg;

        args = Array.prototype.slice.call(arguments, 1);
        msg = messageFormat.replace(/%(\d)/g,
            function (whole, idx) {
                assert(idx < args.length, 'Message reference must be in range');
                return args[idx];
            }
        );

        throw createError(lastLineNumber, lastIndex, msg);
    }

    function tolerateError(messageFormat) {
        var args, msg, error;

        args = Array.prototype.slice.call(arguments, 1);
        /* istanbul ignore next */
        msg = messageFormat.replace(/%(\d)/g,
            function (whole, idx) {
                assert(idx < args.length, 'Message reference must be in range');
                return args[idx];
            }
        );

        error = createError(lineNumber, lastIndex, msg);
        if (extra.errors) {
            recordError(error);
        } else {
            throw error;
        }
    }

    // Throw an exception because of the token.

    function unexpectedTokenError(token, message) {
        var value, msg = message || Messages.UnexpectedToken;

        if (token) {
            if (!message) {
                msg = (token.type === Token.EOF) ? Messages.UnexpectedEOS :
                    (token.type === Token.Identifier) ? Messages.UnexpectedIdentifier :
                    (token.type === Token.NumericLiteral) ? Messages.UnexpectedNumber :
                    (token.type === Token.StringLiteral) ? Messages.UnexpectedString :
                    (token.type === Token.Template) ? Messages.UnexpectedTemplate :
                    Messages.UnexpectedToken;

                if (token.type === Token.Keyword) {
                    if (isFutureReservedWord(token.value)) {
                        msg = Messages.UnexpectedReserved;
                    } else if (strict && isStrictModeReservedWord(token.value)) {
                        msg = Messages.StrictReservedWord;
                    }
                }
            }

            value = (token.type === Token.Template) ? token.value.raw : token.value;
        } else {
            value = 'ILLEGAL';
        }

        msg = msg.replace('%0', value);

        return (token && typeof token.lineNumber === 'number') ?
            createError(token.lineNumber, token.start, msg) :
            createError(scanning ? lineNumber : lastLineNumber, scanning ? index : lastIndex, msg);
    }

    function throwUnexpectedToken(token, message) {
        throw unexpectedTokenError(token, message);
    }

    function tolerateUnexpectedToken(token, message) {
        var error = unexpectedTokenError(token, message);
        if (extra.errors) {
            recordError(error);
        } else {
            throw error;
        }
    }

    // Expect the next token to match the specified punctuator.
    // If not, an exception will be thrown.

    function expect(value) {
        var token = lex();
        if (token.type !== Token.Punctuator || token.value !== value) {
            throwUnexpectedToken(token);
        }
    }

    /**
     * @name expectCommaSeparator
     * @description Quietly expect a comma when in tolerant mode, otherwise delegates
     * to <code>expect(value)</code>
     * @since 2.0
     */
    function expectCommaSeparator() {
        var token;

        if (extra.errors) {
            token = lookahead;
            if (token.type === Token.Punctuator && token.value === ',') {
                lex();
            } else if (token.type === Token.Punctuator && token.value === ';') {
                lex();
                tolerateUnexpectedToken(token);
            } else {
                tolerateUnexpectedToken(token, Messages.UnexpectedToken);
            }
        } else {
            expect(',');
        }
    }

    // Expect the next token to match the specified keyword.
    // If not, an exception will be thrown.

    function expectKeyword(keyword) {
        var token = lex();
        if (token.type !== Token.Keyword || token.value !== keyword) {
            throwUnexpectedToken(token);
        }
    }

    // Return true if the next token matches the specified punctuator.

    function match(value) {
        return lookahead.type === Token.Punctuator && lookahead.value === value;
    }

    // Return true if the next token matches the specified keyword

    function matchKeyword(keyword) {
        return lookahead.type === Token.Keyword && lookahead.value === keyword;
    }

    // Return true if the next token matches the specified contextual keyword
    // (where an identifier is sometimes a keyword depending on the context)

    function matchContextualKeyword(keyword) {
        return lookahead.type === Token.Identifier && lookahead.value === keyword;
    }

    // Return true if the next token is an assignment operator

    function matchAssign() {
        var op;

        if (lookahead.type !== Token.Punctuator) {
            return false;
        }
        op = lookahead.value;
        return op === '=' ||
            op === '*=' ||
            op === '/=' ||
            op === '%=' ||
            op === '+=' ||
            op === '-=' ||
            op === '<<=' ||
            op === '>>=' ||
            op === '>>>=' ||
            op === '&=' ||
            op === '^=' ||
            op === '|=';
    }

    function consumeSemicolon() {
        // Catch the very common case first: immediately a semicolon (U+003B).
        if (source.charCodeAt(startIndex) === 0x3B || match(';')) {
            lex();
            return;
        }

        if (hasLineTerminator) {
            return;
        }

        // FIXME(ikarienator): this is seemingly an issue in the previous location info convention.
        lastIndex = startIndex;
        lastLineNumber = startLineNumber;
        lastLineStart = startLineStart;

        if (lookahead.type !== Token.EOF && !match('}')) {
            throwUnexpectedToken(lookahead);
        }
    }

    // Cover grammar support.
    //
    // When an assignment expression position starts with an left parenthesis, the determination of the type
    // of the syntax is to be deferred arbitrarily long until the end of the parentheses pair (plus a lookahead)
    // or the first comma. This situation also defers the determination of all the expressions nested in the pair.
    //
    // There are three productions that can be parsed in a parentheses pair that needs to be determined
    // after the outermost pair is closed. They are:
    //
    //   1. AssignmentExpression
    //   2. BindingElements
    //   3. AssignmentTargets
    //
    // In order to avoid exponential backtracking, we use two flags to denote if the production can be
    // binding element or assignment target.
    //
    // The three productions have the relationship:
    //
    //   BindingElements ⊆ AssignmentTargets ⊆ AssignmentExpression
    //
    // with a single exception that CoverInitializedName when used directly in an Expression, generates
    // an early error. Therefore, we need the third state, firstCoverInitializedNameError, to track the
    // first usage of CoverInitializedName and report it when we reached the end of the parentheses pair.
    //
    // isolateCoverGrammar function runs the given parser function with a new cover grammar context, and it does not
    // effect the current flags. This means the production the parser parses is only used as an expression. Therefore
    // the CoverInitializedName check is conducted.
    //
    // inheritCoverGrammar function runs the given parse function with a new cover grammar context, and it propagates
    // the flags outside of the parser. This means the production the parser parses is used as a part of a potential
    // pattern. The CoverInitializedName check is deferred.
    function isolateCoverGrammar(parser) {
        var oldIsBindingElement = isBindingElement,
            oldIsAssignmentTarget = isAssignmentTarget,
            oldFirstCoverInitializedNameError = firstCoverInitializedNameError,
            result;
        isBindingElement = true;
        isAssignmentTarget = true;
        firstCoverInitializedNameError = null;
        result = parser();
        if (firstCoverInitializedNameError !== null) {
            throwUnexpectedToken(firstCoverInitializedNameError);
        }
        isBindingElement = oldIsBindingElement;
        isAssignmentTarget = oldIsAssignmentTarget;
        firstCoverInitializedNameError = oldFirstCoverInitializedNameError;
        return result;
    }

    function inheritCoverGrammar(parser) {
        var oldIsBindingElement = isBindingElement,
            oldIsAssignmentTarget = isAssignmentTarget,
            oldFirstCoverInitializedNameError = firstCoverInitializedNameError,
            result;
        isBindingElement = true;
        isAssignmentTarget = true;
        firstCoverInitializedNameError = null;
        result = parser();
        isBindingElement = isBindingElement && oldIsBindingElement;
        isAssignmentTarget = isAssignmentTarget && oldIsAssignmentTarget;
        firstCoverInitializedNameError = oldFirstCoverInitializedNameError || firstCoverInitializedNameError;
        return result;
    }

    // ECMA-262 13.3.3 Destructuring Binding Patterns

    function parseArrayPattern(params, kind) {
        var node = new Node(), elements = [], rest, restNode;
        expect('[');

        while (!match(']')) {
            if (match(',')) {
                lex();
                elements.push(null);
            } else {
                if (match('...')) {
                    restNode = new Node();
                    lex();
                    params.push(lookahead);
                    rest = parseVariableIdentifier(kind);
                    elements.push(restNode.finishRestElement(rest));
                    break;
                } else {
                    elements.push(parsePatternWithDefault(params, kind));
                }
                if (!match(']')) {
                    expect(',');
                }
            }
        }

        expect(']');

        return node.finishArrayPattern(elements);
    }

    function parsePropertyPattern(params, kind) {
        var node = new Node(), key, keyToken, computed = match('['), init;
        if (lookahead.type === Token.Identifier) {
            keyToken = lookahead;
            key = parseVariableIdentifier();
            if (match('=')) {
                params.push(keyToken);
                lex();
                init = parseAssignmentExpression();

                return node.finishProperty(
                    'init', key, false,
                    new WrappingNode(keyToken).finishAssignmentPattern(key, init), false, true);
            } else if (!match(':')) {
                params.push(keyToken);
                return node.finishProperty('init', key, false, key, false, true);
            }
        } else {
            key = parseObjectPropertyKey();
        }
        expect(':');
        init = parsePatternWithDefault(params, kind);
        return node.finishProperty('init', key, computed, init, false, false);
    }

    function parseObjectPattern(params, kind) {
        var node = new Node(), properties = [];

        expect('{');

        while (!match('}')) {
            properties.push(parsePropertyPattern(params, kind));
            if (!match('}')) {
                expect(',');
            }
        }

        lex();

        return node.finishObjectPattern(properties);
    }

    function parsePattern(params, kind) {
        if (match('[')) {
            return parseArrayPattern(params, kind);
        } else if (match('{')) {
            return parseObjectPattern(params, kind);
        } else if (matchKeyword('let')) {
            if (kind === 'const' || kind === 'let') {
                tolerateUnexpectedToken(lookahead, Messages.UnexpectedToken);
            }
        }

        params.push(lookahead);
        return parseVariableIdentifier(kind);
    }

    function parsePatternWithDefault(params, kind) {
        var startToken = lookahead, pattern, previousAllowYield, right;
        pattern = parsePattern(params, kind);
        if (match('=')) {
            lex();
            previousAllowYield = state.allowYield;
            state.allowYield = true;
            right = isolateCoverGrammar(parseAssignmentExpression);
            state.allowYield = previousAllowYield;
            pattern = new WrappingNode(startToken).finishAssignmentPattern(pattern, right);
        }
        return pattern;
    }

    // ECMA-262 12.2.5 Array Initializer

    function parseArrayInitializer() {
        var elements = [], node = new Node(), restSpread;

        expect('[');

        while (!match(']')) {
            if (match(',')) {
                lex();
                elements.push(null);
            } else if (match('...')) {
                restSpread = new Node();
                lex();
                restSpread.finishSpreadElement(inheritCoverGrammar(parseAssignmentExpression));

                if (!match(']')) {
                    isAssignmentTarget = isBindingElement = false;
                    expect(',');
                }
                elements.push(restSpread);
            } else {
                elements.push(inheritCoverGrammar(parseAssignmentExpression));

                if (!match(']')) {
                    expect(',');
                }
            }
        }

        lex();

        return node.finishArrayExpression(elements);
    }

    // ECMA-262 12.2.6 Object Initializer

    function parsePropertyFunction(node, paramInfo, isGenerator) {
        var previousStrict, body;

        isAssignmentTarget = isBindingElement = false;

        previousStrict = strict;
        body = isolateCoverGrammar(parseFunctionSourceElements);

        if (strict && paramInfo.firstRestricted) {
            tolerateUnexpectedToken(paramInfo.firstRestricted, paramInfo.message);
        }
        if (strict && paramInfo.stricted) {
            tolerateUnexpectedToken(paramInfo.stricted, paramInfo.message);
        }

        strict = previousStrict;
        return node.finishFunctionExpression(null, paramInfo.params, paramInfo.defaults, body, isGenerator);
    }

    function parsePropertyMethodFunction() {
        var params, method, node = new Node(),
            previousAllowYield = state.allowYield;

        state.allowYield = false;
        params = parseParams();
        state.allowYield = previousAllowYield;

        state.allowYield = false;
        method = parsePropertyFunction(node, params, false);
        state.allowYield = previousAllowYield;

        return method;
    }

    function parseObjectPropertyKey() {
        var token, node = new Node(), expr;

        token = lex();

        // Note: This function is called only from parseObjectProperty(), where
        // EOF and Punctuator tokens are already filtered out.

        switch (token.type) {
        case Token.StringLiteral:
        case Token.NumericLiteral:
            if (strict && token.octal) {
                tolerateUnexpectedToken(token, Messages.StrictOctalLiteral);
            }
            return node.finishLiteral(token);
        case Token.Identifier:
        case Token.BooleanLiteral:
        case Token.NullLiteral:
        case Token.Keyword:
            return node.finishIdentifier(token.value);
        case Token.Punctuator:
            if (token.value === '[') {
                expr = isolateCoverGrammar(parseAssignmentExpression);
                expect(']');
                return expr;
            }
            break;
        }
        throwUnexpectedToken(token);
    }

    function lookaheadPropertyName() {
        switch (lookahead.type) {
        case Token.Identifier:
        case Token.StringLiteral:
        case Token.BooleanLiteral:
        case Token.NullLiteral:
        case Token.NumericLiteral:
        case Token.Keyword:
            return true;
        case Token.Punctuator:
            return lookahead.value === '[';
        }
        return false;
    }

    // This function is to try to parse a MethodDefinition as defined in 14.3. But in the case of object literals,
    // it might be called at a position where there is in fact a short hand identifier pattern or a data property.
    // This can only be determined after we consumed up to the left parentheses.
    //
    // In order to avoid back tracking, it returns `null` if the position is not a MethodDefinition and the caller
    // is responsible to visit other options.
    function tryParseMethodDefinition(token, key, computed, node) {
        var value, options, methodNode, params,
            previousAllowYield = state.allowYield;

        if (token.type === Token.Identifier) {
            // check for `get` and `set`;

            if (token.value === 'get' && lookaheadPropertyName()) {
                computed = match('[');
                key = parseObjectPropertyKey();
                methodNode = new Node();
                expect('(');
                expect(')');

                state.allowYield = false;
                value = parsePropertyFunction(methodNode, {
                    params: [],
                    defaults: [],
                    stricted: null,
                    firstRestricted: null,
                    message: null
                }, false);
                state.allowYield = previousAllowYield;

                return node.finishProperty('get', key, computed, value, false, false);
            } else if (token.value === 'set' && lookaheadPropertyName()) {
                computed = match('[');
                key = parseObjectPropertyKey();
                methodNode = new Node();
                expect('(');

                options = {
                    params: [],
                    defaultCount: 0,
                    defaults: [],
                    firstRestricted: null,
                    paramSet: {}
                };
                if (match(')')) {
                    tolerateUnexpectedToken(lookahead);
                } else {
                    state.allowYield = false;
                    parseParam(options);
                    state.allowYield = previousAllowYield;
                    if (options.defaultCount === 0) {
                        options.defaults = [];
                    }
                }
                expect(')');

                state.allowYield = false;
                value = parsePropertyFunction(methodNode, options, false);
                state.allowYield = previousAllowYield;

                return node.finishProperty('set', key, computed, value, false, false);
            }
        } else if (token.type === Token.Punctuator && token.value === '*' && lookaheadPropertyName()) {
            computed = match('[');
            key = parseObjectPropertyKey();
            methodNode = new Node();

            state.allowYield = true;
            params = parseParams();
            state.allowYield = previousAllowYield;

            state.allowYield = false;
            value = parsePropertyFunction(methodNode, params, true);
            state.allowYield = previousAllowYield;

            return node.finishProperty('init', key, computed, value, true, false);
        }

        if (key && match('(')) {
            value = parsePropertyMethodFunction();
            return node.finishProperty('init', key, computed, value, true, false);
        }

        // Not a MethodDefinition.
        return null;
    }

    function parseObjectProperty(hasProto) {
        var token = lookahead, node = new Node(), computed, key, maybeMethod, proto, value;

        computed = match('[');
        if (match('*')) {
            lex();
        } else {
            key = parseObjectPropertyKey();
        }
        maybeMethod = tryParseMethodDefinition(token, key, computed, node);
        if (maybeMethod) {
            return maybeMethod;
        }

        if (!key) {
            throwUnexpectedToken(lookahead);
        }

        // Check for duplicated __proto__
        if (!computed) {
            proto = (key.type === Syntax.Identifier && key.name === '__proto__') ||
                (key.type === Syntax.Literal && key.value === '__proto__');
            if (hasProto.value && proto) {
                tolerateError(Messages.DuplicateProtoProperty);
            }
            hasProto.value |= proto;
        }

        if (match(':')) {
            lex();
            value = inheritCoverGrammar(parseAssignmentExpression);
            return node.finishProperty('init', key, computed, value, false, false);
        }

        if (token.type === Token.Identifier) {
            if (match('=')) {
                firstCoverInitializedNameError = lookahead;
                lex();
                value = isolateCoverGrammar(parseAssignmentExpression);
                return node.finishProperty('init', key, computed,
                    new WrappingNode(token).finishAssignmentPattern(key, value), false, true);
            }
            return node.finishProperty('init', key, computed, key, false, true);
        }

        throwUnexpectedToken(lookahead);
    }

    function parseObjectInitializer() {
        var properties = [], hasProto = {value: false}, node = new Node();

        expect('{');

        while (!match('}')) {
            properties.push(parseObjectProperty(hasProto));

            if (!match('}')) {
                expectCommaSeparator();
            }
        }

        expect('}');

        return node.finishObjectExpression(properties);
    }

    function reinterpretExpressionAsPattern(expr) {
        var i;
        switch (expr.type) {
        case Syntax.Identifier:
        case Syntax.MemberExpression:
        case Syntax.RestElement:
        case Syntax.AssignmentPattern:
            break;
        case Syntax.SpreadElement:
            expr.type = Syntax.RestElement;
            reinterpretExpressionAsPattern(expr.argument);
            break;
        case Syntax.ArrayExpression:
            expr.type = Syntax.ArrayPattern;
            for (i = 0; i < expr.elements.length; i++) {
                if (expr.elements[i] !== null) {
                    reinterpretExpressionAsPattern(expr.elements[i]);
                }
            }
            break;
        case Syntax.ObjectExpression:
            expr.type = Syntax.ObjectPattern;
            for (i = 0; i < expr.properties.length; i++) {
                reinterpretExpressionAsPattern(expr.properties[i].value);
            }
            break;
        case Syntax.AssignmentExpression:
            expr.type = Syntax.AssignmentPattern;
            reinterpretExpressionAsPattern(expr.left);
            break;
        default:
            // Allow other node type for tolerant parsing.
            break;
        }
    }

    // ECMA-262 12.2.9 Template Literals

    function parseTemplateElement(option) {
        var node, token;

        if (lookahead.type !== Token.Template || (option.head && !lookahead.head)) {
            throwUnexpectedToken();
        }

        node = new Node();
        token = lex();

        return node.finishTemplateElement({ raw: token.value.raw, cooked: token.value.cooked }, token.tail);
    }

    function parseTemplateLiteral() {
        var quasi, quasis, expressions, node = new Node();

        quasi = parseTemplateElement({ head: true });
        quasis = [quasi];
        expressions = [];

        while (!quasi.tail) {
            expressions.push(parseExpression());
            quasi = parseTemplateElement({ head: false });
            quasis.push(quasi);
        }

        return node.finishTemplateLiteral(quasis, expressions);
    }

    // ECMA-262 12.2.10 The Grouping Operator

    function parseGroupExpression() {
        var expr, expressions, startToken, i, params = [];

        expect('(');

        if (match(')')) {
            lex();
            if (!match('=>')) {
                expect('=>');
            }
            return {
                type: PlaceHolders.ArrowParameterPlaceHolder,
                params: [],
                rawParams: []
            };
        }

        startToken = lookahead;
        if (match('...')) {
            expr = parseRestElement(params);
            expect(')');
            if (!match('=>')) {
                expect('=>');
            }
            return {
                type: PlaceHolders.ArrowParameterPlaceHolder,
                params: [expr]
            };
        }

        isBindingElement = true;
        expr = inheritCoverGrammar(parseAssignmentExpression);

        if (match(',')) {
            isAssignmentTarget = false;
            expressions = [expr];

            while (startIndex < length) {
                if (!match(',')) {
                    break;
                }
                lex();

                if (match('...')) {
                    if (!isBindingElement) {
                        throwUnexpectedToken(lookahead);
                    }
                    expressions.push(parseRestElement(params));
                    expect(')');
                    if (!match('=>')) {
                        expect('=>');
                    }
                    isBindingElement = false;
                    for (i = 0; i < expressions.length; i++) {
                        reinterpretExpressionAsPattern(expressions[i]);
                    }
                    return {
                        type: PlaceHolders.ArrowParameterPlaceHolder,
                        params: expressions
                    };
                }

                expressions.push(inheritCoverGrammar(parseAssignmentExpression));
            }

            expr = new WrappingNode(startToken).finishSequenceExpression(expressions);
        }

        expect(')');

        if (match('=>')) {
            if (expr.type === Syntax.Identifier && expr.name === 'yield') {
                return {
                    type: PlaceHolders.ArrowParameterPlaceHolder,
                    params: [expr]
                };
            }

            if (!isBindingElement) {
                throwUnexpectedToken(lookahead);
            }

            if (expr.type === Syntax.SequenceExpression) {
                for (i = 0; i < expr.expressions.length; i++) {
                    reinterpretExpressionAsPattern(expr.expressions[i]);
                }
            } else {
                reinterpretExpressionAsPattern(expr);
            }

            expr = {
                type: PlaceHolders.ArrowParameterPlaceHolder,
                params: expr.type === Syntax.SequenceExpression ? expr.expressions : [expr]
            };
        }
        isBindingElement = false;
        return expr;
    }

    // ECMA-262 12.2 Primary Expressions

    function parsePrimaryExpression() {
        var type, token, expr, node;

        if (match('(')) {
            isBindingElement = false;
            return inheritCoverGrammar(parseGroupExpression);
        }

        if (match('[')) {
            return inheritCoverGrammar(parseArrayInitializer);
        }

        if (match('{')) {
            return inheritCoverGrammar(parseObjectInitializer);
        }

        type = lookahead.type;
        node = new Node();

        if (type === Token.Identifier) {
            if (state.sourceType === 'module' && lookahead.value === 'await') {
                tolerateUnexpectedToken(lookahead);
            }
            expr = node.finishIdentifier(lex().value);
        } else if (type === Token.StringLiteral || type === Token.NumericLiteral) {
            isAssignmentTarget = isBindingElement = false;
            if (strict && lookahead.octal) {
                tolerateUnexpectedToken(lookahead, Messages.StrictOctalLiteral);
            }
            expr = node.finishLiteral(lex());
        } else if (type === Token.Keyword) {
            if (!strict && state.allowYield && matchKeyword('yield')) {
                return parseNonComputedProperty();
            }
            if (!strict && matchKeyword('let')) {
                return node.finishIdentifier(lex().value);
            }
            isAssignmentTarget = isBindingElement = false;
            if (matchKeyword('function')) {
                return parseFunctionExpression();
            }
            if (matchKeyword('this')) {
                lex();
                return node.finishThisExpression();
            }
            if (matchKeyword('class')) {
                return parseClassExpression();
            }
            throwUnexpectedToken(lex());
        } else if (type === Token.BooleanLiteral) {
            isAssignmentTarget = isBindingElement = false;
            token = lex();
            token.value = (token.value === 'true');
            expr = node.finishLiteral(token);
        } else if (type === Token.NullLiteral) {
            isAssignmentTarget = isBindingElement = false;
            token = lex();
            token.value = null;
            expr = node.finishLiteral(token);
        } else if (match('/') || match('/=')) {
            isAssignmentTarget = isBindingElement = false;
            index = startIndex;

            if (typeof extra.tokens !== 'undefined') {
                token = collectRegex();
            } else {
                token = scanRegExp();
            }
            lex();
            expr = node.finishLiteral(token);
        } else if (type === Token.Template) {
            expr = parseTemplateLiteral();
        } else {
            throwUnexpectedToken(lex());
        }

        return expr;
    }

    // ECMA-262 12.3 Left-Hand-Side Expressions

    function parseArguments() {
        var args = [], expr;

        expect('(');

        if (!match(')')) {
            while (startIndex < length) {
                if (match('...')) {
                    expr = new Node();
                    lex();
                    expr.finishSpreadElement(isolateCoverGrammar(parseAssignmentExpression));
                } else {
                    expr = isolateCoverGrammar(parseAssignmentExpression);
                }
                args.push(expr);
                if (match(')')) {
                    break;
                }
                expectCommaSeparator();
            }
        }

        expect(')');

        return args;
    }

    function parseNonComputedProperty() {
        var token, node = new Node();

        token = lex();

        if (!isIdentifierName(token)) {
            throwUnexpectedToken(token);
        }

        return node.finishIdentifier(token.value);
    }

    function parseNonComputedMember() {
        expect('.');

        return parseNonComputedProperty();
    }

    function parseComputedMember() {
        var expr;

        expect('[');

        expr = isolateCoverGrammar(parseExpression);

        expect(']');

        return expr;
    }

    // ECMA-262 12.3.3 The new Operator

    function parseNewExpression() {
        var callee, args, node = new Node();

        expectKeyword('new');

        if (match('.')) {
            lex();
            if (lookahead.type === Token.Identifier && lookahead.value === 'target') {
                if (state.inFunctionBody) {
                    lex();
                    return node.finishMetaProperty('new', 'target');
                }
            }
            throwUnexpectedToken(lookahead);
        }

        callee = isolateCoverGrammar(parseLeftHandSideExpression);
        args = match('(') ? parseArguments() : [];

        isAssignmentTarget = isBindingElement = false;

        return node.finishNewExpression(callee, args);
    }

    // ECMA-262 12.3.4 Function Calls

    function parseLeftHandSideExpressionAllowCall() {
        var quasi, expr, args, property, startToken, previousAllowIn = state.allowIn;

        startToken = lookahead;
        state.allowIn = true;

        if (matchKeyword('super') && state.inFunctionBody) {
            expr = new Node();
            lex();
            expr = expr.finishSuper();
            if (!match('(') && !match('.') && !match('[')) {
                throwUnexpectedToken(lookahead);
            }
        } else {
            expr = inheritCoverGrammar(matchKeyword('new') ? parseNewExpression : parsePrimaryExpression);
        }

        for (;;) {
            if (match('.')) {
                isBindingElement = false;
                isAssignmentTarget = true;
                property = parseNonComputedMember();
                expr = new WrappingNode(startToken).finishMemberExpression('.', expr, property);
            } else if (match('(')) {
                isBindingElement = false;
                isAssignmentTarget = false;
                args = parseArguments();
                expr = new WrappingNode(startToken).finishCallExpression(expr, args);
            } else if (match('[')) {
                isBindingElement = false;
                isAssignmentTarget = true;
                property = parseComputedMember();
                expr = new WrappingNode(startToken).finishMemberExpression('[', expr, property);
            } else if (lookahead.type === Token.Template && lookahead.head) {
                quasi = parseTemplateLiteral();
                expr = new WrappingNode(startToken).finishTaggedTemplateExpression(expr, quasi);
            } else {
                break;
            }
        }
        state.allowIn = previousAllowIn;

        return expr;
    }

    // ECMA-262 12.3 Left-Hand-Side Expressions

    function parseLeftHandSideExpression() {
        var quasi, expr, property, startToken;
        assert(state.allowIn, 'callee of new expression always allow in keyword.');

        startToken = lookahead;

        if (matchKeyword('super') && state.inFunctionBody) {
            expr = new Node();
            lex();
            expr = expr.finishSuper();
            if (!match('[') && !match('.')) {
                throwUnexpectedToken(lookahead);
            }
        } else {
            expr = inheritCoverGrammar(matchKeyword('new') ? parseNewExpression : parsePrimaryExpression);
        }

        for (;;) {
            if (match('[')) {
                isBindingElement = false;
                isAssignmentTarget = true;
                property = parseComputedMember();
                expr = new WrappingNode(startToken).finishMemberExpression('[', expr, property);
            } else if (match('.')) {
                isBindingElement = false;
                isAssignmentTarget = true;
                property = parseNonComputedMember();
                expr = new WrappingNode(startToken).finishMemberExpression('.', expr, property);
            } else if (lookahead.type === Token.Template && lookahead.head) {
                quasi = parseTemplateLiteral();
                expr = new WrappingNode(startToken).finishTaggedTemplateExpression(expr, quasi);
            } else {
                break;
            }
        }
        return expr;
    }

    // ECMA-262 12.4 Postfix Expressions

    function parsePostfixExpression() {
        var expr, token, startToken = lookahead;

        expr = inheritCoverGrammar(parseLeftHandSideExpressionAllowCall);

        if (!hasLineTerminator && lookahead.type === Token.Punctuator) {
            if (match('++') || match('--')) {
                // ECMA-262 11.3.1, 11.3.2
                if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {
                    tolerateError(Messages.StrictLHSPostfix);
                }

                if (!isAssignmentTarget) {
                    tolerateError(Messages.InvalidLHSInAssignment);
                }

                isAssignmentTarget = isBindingElement = false;

                token = lex();
                expr = new WrappingNode(startToken).finishPostfixExpression(token.value, expr);
            }
        }

        return expr;
    }

    // ECMA-262 12.5 Unary Operators

    function parseUnaryExpression() {
        var token, expr, startToken;

        if (lookahead.type !== Token.Punctuator && lookahead.type !== Token.Keyword) {
            expr = parsePostfixExpression();
        } else if (match('++') || match('--')) {
            startToken = lookahead;
            token = lex();
            expr = inheritCoverGrammar(parseUnaryExpression);
            // ECMA-262 11.4.4, 11.4.5
            if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {
                tolerateError(Messages.StrictLHSPrefix);
            }

            if (!isAssignmentTarget) {
                tolerateError(Messages.InvalidLHSInAssignment);
            }
            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);
            isAssignmentTarget = isBindingElement = false;
        } else if (match('+') || match('-') || match('~') || match('!')) {
            startToken = lookahead;
            token = lex();
            expr = inheritCoverGrammar(parseUnaryExpression);
            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);
            isAssignmentTarget = isBindingElement = false;
        } else if (matchKeyword('delete') || matchKeyword('void') || matchKeyword('typeof')) {
            startToken = lookahead;
            token = lex();
            expr = inheritCoverGrammar(parseUnaryExpression);
            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);
            if (strict && expr.operator === 'delete' && expr.argument.type === Syntax.Identifier) {
                tolerateError(Messages.StrictDelete);
            }
            isAssignmentTarget = isBindingElement = false;
        } else {
            expr = parsePostfixExpression();
        }

        return expr;
    }

    function binaryPrecedence(token, allowIn) {
        var prec = 0;

        if (token.type !== Token.Punctuator && token.type !== Token.Keyword) {
            return 0;
        }

        switch (token.value) {
        case '||':
            prec = 1;
            break;

        case '&&':
            prec = 2;
            break;

        case '|':
            prec = 3;
            break;

        case '^':
            prec = 4;
            break;

        case '&':
            prec = 5;
            break;

        case '==':
        case '!=':
        case '===':
        case '!==':
            prec = 6;
            break;

        case '<':
        case '>':
        case '<=':
        case '>=':
        case 'instanceof':
            prec = 7;
            break;

        case 'in':
            prec = allowIn ? 7 : 0;
            break;

        case '<<':
        case '>>':
        case '>>>':
            prec = 8;
            break;

        case '+':
        case '-':
            prec = 9;
            break;

        case '*':
        case '/':
        case '%':
            prec = 11;
            break;

        default:
            break;
        }

        return prec;
    }

    // ECMA-262 12.6 Multiplicative Operators
    // ECMA-262 12.7 Additive Operators
    // ECMA-262 12.8 Bitwise Shift Operators
    // ECMA-262 12.9 Relational Operators
    // ECMA-262 12.10 Equality Operators
    // ECMA-262 12.11 Binary Bitwise Operators
    // ECMA-262 12.12 Binary Logical Operators

    function parseBinaryExpression() {
        var marker, markers, expr, token, prec, stack, right, operator, left, i;

        marker = lookahead;
        left = inheritCoverGrammar(parseUnaryExpression);

        token = lookahead;
        prec = binaryPrecedence(token, state.allowIn);
        if (prec === 0) {
            return left;
        }
        isAssignmentTarget = isBindingElement = false;
        token.prec = prec;
        lex();

        markers = [marker, lookahead];
        right = isolateCoverGrammar(parseUnaryExpression);

        stack = [left, token, right];

        while ((prec = binaryPrecedence(lookahead, state.allowIn)) > 0) {

            // Reduce: make a binary expression from the three topmost entries.
            while ((stack.length > 2) && (prec <= stack[stack.length - 2].prec)) {
                right = stack.pop();
                operator = stack.pop().value;
                left = stack.pop();
                markers.pop();
                expr = new WrappingNode(markers[markers.length - 1]).finishBinaryExpression(operator, left, right);
                stack.push(expr);
            }

            // Shift.
            token = lex();
            token.prec = prec;
            stack.push(token);
            markers.push(lookahead);
            expr = isolateCoverGrammar(parseUnaryExpression);
            stack.push(expr);
        }

        // Final reduce to clean-up the stack.
        i = stack.length - 1;
        expr = stack[i];
        markers.pop();
        while (i > 1) {
            expr = new WrappingNode(markers.pop()).finishBinaryExpression(stack[i - 1].value, stack[i - 2], expr);
            i -= 2;
        }

        return expr;
    }

    // ECMA-262 12.13 Conditional Operator

    function parseConditionalExpression() {
        var expr, previousAllowIn, consequent, alternate, startToken;

        startToken = lookahead;

        expr = inheritCoverGrammar(parseBinaryExpression);
        if (match('?')) {
            lex();
            previousAllowIn = state.allowIn;
            state.allowIn = true;
            consequent = isolateCoverGrammar(parseAssignmentExpression);
            state.allowIn = previousAllowIn;
            expect(':');
            alternate = isolateCoverGrammar(parseAssignmentExpression);

            expr = new WrappingNode(startToken).finishConditionalExpression(expr, consequent, alternate);
            isAssignmentTarget = isBindingElement = false;
        }

        return expr;
    }

    // ECMA-262 14.2 Arrow Function Definitions

    function parseConciseBody() {
        if (match('{')) {
            return parseFunctionSourceElements();
        }
        return isolateCoverGrammar(parseAssignmentExpression);
    }

    function checkPatternParam(options, param) {
        var i;
        switch (param.type) {
        case Syntax.Identifier:
            validateParam(options, param, param.name);
            break;
        case Syntax.RestElement:
            checkPatternParam(options, param.argument);
            break;
        case Syntax.AssignmentPattern:
            checkPatternParam(options, param.left);
            break;
        case Syntax.ArrayPattern:
            for (i = 0; i < param.elements.length; i++) {
                if (param.elements[i] !== null) {
                    checkPatternParam(options, param.elements[i]);
                }
            }
            break;
        case Syntax.YieldExpression:
            break;
        default:
            assert(param.type === Syntax.ObjectPattern, 'Invalid type');
            for (i = 0; i < param.properties.length; i++) {
                checkPatternParam(options, param.properties[i].value);
            }
            break;
        }
    }
    function reinterpretAsCoverFormalsList(expr) {
        var i, len, param, params, defaults, defaultCount, options, token;

        defaults = [];
        defaultCount = 0;
        params = [expr];

        switch (expr.type) {
        case Syntax.Identifier:
            break;
        case PlaceHolders.ArrowParameterPlaceHolder:
            params = expr.params;
            break;
        default:
            return null;
        }

        options = {
            paramSet: {}
        };

        for (i = 0, len = params.length; i < len; i += 1) {
            param = params[i];
            switch (param.type) {
            case Syntax.AssignmentPattern:
                params[i] = param.left;
                if (param.right.type === Syntax.YieldExpression) {
                    if (param.right.argument) {
                        throwUnexpectedToken(lookahead);
                    }
                    param.right.type = Syntax.Identifier;
                    param.right.name = 'yield';
                    delete param.right.argument;
                    delete param.right.delegate;
                }
                defaults.push(param.right);
                ++defaultCount;
                checkPatternParam(options, param.left);
                break;
            default:
                checkPatternParam(options, param);
                params[i] = param;
                defaults.push(null);
                break;
            }
        }

        if (strict || !state.allowYield) {
            for (i = 0, len = params.length; i < len; i += 1) {
                param = params[i];
                if (param.type === Syntax.YieldExpression) {
                    throwUnexpectedToken(lookahead);
                }
            }
        }

        if (options.message === Messages.StrictParamDupe) {
            token = strict ? options.stricted : options.firstRestricted;
            throwUnexpectedToken(token, options.message);
        }

        if (defaultCount === 0) {
            defaults = [];
        }

        return {
            params: params,
            defaults: defaults,
            stricted: options.stricted,
            firstRestricted: options.firstRestricted,
            message: options.message
        };
    }

    function parseArrowFunctionExpression(options, node) {
        var previousStrict, previousAllowYield, body;

        if (hasLineTerminator) {
            tolerateUnexpectedToken(lookahead);
        }
        expect('=>');

        previousStrict = strict;
        previousAllowYield = state.allowYield;
        state.allowYield = true;

        body = parseConciseBody();

        if (strict && options.firstRestricted) {
            throwUnexpectedToken(options.firstRestricted, options.message);
        }
        if (strict && options.stricted) {
            tolerateUnexpectedToken(options.stricted, options.message);
        }

        strict = previousStrict;
        state.allowYield = previousAllowYield;

        return node.finishArrowFunctionExpression(options.params, options.defaults, body, body.type !== Syntax.BlockStatement);
    }

    // ECMA-262 14.4 Yield expression

    function parseYieldExpression() {
        var argument, expr, delegate, previousAllowYield;

        argument = null;
        expr = new Node();
        delegate = false;

        expectKeyword('yield');

        if (!hasLineTerminator) {
            previousAllowYield = state.allowYield;
            state.allowYield = false;
            delegate = match('*');
            if (delegate) {
                lex();
                argument = parseAssignmentExpression();
            } else {
                if (!match(';') && !match('}') && !match(')') && lookahead.type !== Token.EOF) {
                    argument = parseAssignmentExpression();
                }
            }
            state.allowYield = previousAllowYield;
        }

        return expr.finishYieldExpression(argument, delegate);
    }

    // ECMA-262 12.14 Assignment Operators

    function parseAssignmentExpression() {
        var token, expr, right, list, startToken;

        startToken = lookahead;
        token = lookahead;

        if (!state.allowYield && matchKeyword('yield')) {
            return parseYieldExpression();
        }

        expr = parseConditionalExpression();

        if (expr.type === PlaceHolders.ArrowParameterPlaceHolder || match('=>')) {
            isAssignmentTarget = isBindingElement = false;
            list = reinterpretAsCoverFormalsList(expr);

            if (list) {
                firstCoverInitializedNameError = null;
                return parseArrowFunctionExpression(list, new WrappingNode(startToken));
            }

            return expr;
        }

        if (matchAssign()) {
            if (!isAssignmentTarget) {
                tolerateError(Messages.InvalidLHSInAssignment);
            }

            // ECMA-262 12.1.1
            if (strict && expr.type === Syntax.Identifier) {
                if (isRestrictedWord(expr.name)) {
                    tolerateUnexpectedToken(token, Messages.StrictLHSAssignment);
                }
                if (isStrictModeReservedWord(expr.name)) {
                    tolerateUnexpectedToken(token, Messages.StrictReservedWord);
                }
            }

            if (!match('=')) {
                isAssignmentTarget = isBindingElement = false;
            } else {
                reinterpretExpressionAsPattern(expr);
            }

            token = lex();
            right = isolateCoverGrammar(parseAssignmentExpression);
            expr = new WrappingNode(startToken).finishAssignmentExpression(token.value, expr, right);
            firstCoverInitializedNameError = null;
        }

        return expr;
    }

    // ECMA-262 12.15 Comma Operator

    function parseExpression() {
        var expr, startToken = lookahead, expressions;

        expr = isolateCoverGrammar(parseAssignmentExpression);

        if (match(',')) {
            expressions = [expr];

            while (startIndex < length) {
                if (!match(',')) {
                    break;
                }
                lex();
                expressions.push(isolateCoverGrammar(parseAssignmentExpression));
            }

            expr = new WrappingNode(startToken).finishSequenceExpression(expressions);
        }

        return expr;
    }

    // ECMA-262 13.2 Block

    function parseStatementListItem() {
        if (lookahead.type === Token.Keyword) {
            switch (lookahead.value) {
            case 'export':
                if (state.sourceType !== 'module') {
                    tolerateUnexpectedToken(lookahead, Messages.IllegalExportDeclaration);
                }
                return parseExportDeclaration();
            case 'import':
                if (state.sourceType !== 'module') {
                    tolerateUnexpectedToken(lookahead, Messages.IllegalImportDeclaration);
                }
                return parseImportDeclaration();
            case 'const':
                return parseLexicalDeclaration({inFor: false});
            case 'function':
                return parseFunctionDeclaration(new Node());
            case 'class':
                return parseClassDeclaration();
            }
        }

        if (matchKeyword('let') && isLexicalDeclaration()) {
            return parseLexicalDeclaration({inFor: false});
        }

        return parseStatement();
    }

    function parseStatementList() {
        var list = [];
        while (startIndex < length) {
            if (match('}')) {
                break;
            }
            list.push(parseStatementListItem());
        }

        return list;
    }

    function parseBlock() {
        var block, node = new Node();

        expect('{');

        block = parseStatementList();

        expect('}');

        return node.finishBlockStatement(block);
    }

    // ECMA-262 13.3.2 Variable Statement

    function parseVariableIdentifier(kind) {
        var token, node = new Node();

        token = lex();

        if (token.type === Token.Keyword && token.value === 'yield') {
            if (strict) {
                tolerateUnexpectedToken(token, Messages.StrictReservedWord);
            } if (!state.allowYield) {
                throwUnexpectedToken(token);
            }
        } else if (token.type !== Token.Identifier) {
            if (strict && token.type === Token.Keyword && isStrictModeReservedWord(token.value)) {
                tolerateUnexpectedToken(token, Messages.StrictReservedWord);
            } else {
                if (strict || token.value !== 'let' || kind !== 'var') {
                    throwUnexpectedToken(token);
                }
            }
        } else if (state.sourceType === 'module' && token.type === Token.Identifier && token.value === 'await') {
            tolerateUnexpectedToken(token);
        }

        return node.finishIdentifier(token.value);
    }

    function parseVariableDeclaration(options) {
        var init = null, id, node = new Node(), params = [];

        id = parsePattern(params, 'var');

        // ECMA-262 12.2.1
        if (strict && isRestrictedWord(id.name)) {
            tolerateError(Messages.StrictVarName);
        }

        if (match('=')) {
            lex();
            init = isolateCoverGrammar(parseAssignmentExpression);
        } else if (id.type !== Syntax.Identifier && !options.inFor) {
            expect('=');
        }

        return node.finishVariableDeclarator(id, init);
    }

    function parseVariableDeclarationList(options) {
        var opt, list;

        opt = { inFor: options.inFor };
        list = [parseVariableDeclaration(opt)];

        while (match(',')) {
            lex();
            list.push(parseVariableDeclaration(opt));
        }

        return list;
    }

    function parseVariableStatement(node) {
        var declarations;

        expectKeyword('var');

        declarations = parseVariableDeclarationList({ inFor: false });

        consumeSemicolon();

        return node.finishVariableDeclaration(declarations);
    }

    // ECMA-262 13.3.1 Let and Const Declarations

    function parseLexicalBinding(kind, options) {
        var init = null, id, node = new Node(), params = [];

        id = parsePattern(params, kind);

        // ECMA-262 12.2.1
        if (strict && id.type === Syntax.Identifier && isRestrictedWord(id.name)) {
            tolerateError(Messages.StrictVarName);
        }

        if (kind === 'const') {
            if (!matchKeyword('in') && !matchContextualKeyword('of')) {
                expect('=');
                init = isolateCoverGrammar(parseAssignmentExpression);
            }
        } else if ((!options.inFor && id.type !== Syntax.Identifier) || match('=')) {
            expect('=');
            init = isolateCoverGrammar(parseAssignmentExpression);
        }

        return node.finishVariableDeclarator(id, init);
    }

    function parseBindingList(kind, options) {
        var list = [parseLexicalBinding(kind, options)];

        while (match(',')) {
            lex();
            list.push(parseLexicalBinding(kind, options));
        }

        return list;
    }

    function tokenizerState() {
        return {
            index: index,
            lineNumber: lineNumber,
            lineStart: lineStart,
            hasLineTerminator: hasLineTerminator,
            lastIndex: lastIndex,
            lastLineNumber: lastLineNumber,
            lastLineStart: lastLineStart,
            startIndex: startIndex,
            startLineNumber: startLineNumber,
            startLineStart: startLineStart,
            lookahead: lookahead,
            tokenCount: extra.tokens ? extra.tokens.length : 0
        };
    }

    function resetTokenizerState(ts) {
        index = ts.index;
        lineNumber = ts.lineNumber;
        lineStart = ts.lineStart;
        hasLineTerminator = ts.hasLineTerminator;
        lastIndex = ts.lastIndex;
        lastLineNumber = ts.lastLineNumber;
        lastLineStart = ts.lastLineStart;
        startIndex = ts.startIndex;
        startLineNumber = ts.startLineNumber;
        startLineStart = ts.startLineStart;
        lookahead = ts.lookahead;
        if (extra.tokens) {
            extra.tokens.splice(ts.tokenCount, extra.tokens.length);
        }
    }

    function isLexicalDeclaration() {
        var lexical, ts;

        ts = tokenizerState();

        lex();
        lexical = (lookahead.type === Token.Identifier) || match('[') || match('{') ||
            matchKeyword('let') || matchKeyword('yield');

        resetTokenizerState(ts);

        return lexical;
    }

    function parseLexicalDeclaration(options) {
        var kind, declarations, node = new Node();

        kind = lex().value;
        assert(kind === 'let' || kind === 'const', 'Lexical declaration must be either let or const');

        declarations = parseBindingList(kind, options);

        consumeSemicolon();

        return node.finishLexicalDeclaration(declarations, kind);
    }

    function parseRestElement(params) {
        var param, node = new Node();

        lex();

        if (match('{')) {
            throwError(Messages.ObjectPatternAsRestParameter);
        }

        params.push(lookahead);

        param = parseVariableIdentifier();

        if (match('=')) {
            throwError(Messages.DefaultRestParameter);
        }

        if (!match(')')) {
            throwError(Messages.ParameterAfterRestParameter);
        }

        return node.finishRestElement(param);
    }

    // ECMA-262 13.4 Empty Statement

    function parseEmptyStatement(node) {
        expect(';');
        return node.finishEmptyStatement();
    }

    // ECMA-262 12.4 Expression Statement

    function parseExpressionStatement(node) {
        var expr = parseExpression();
        consumeSemicolon();
        return node.finishExpressionStatement(expr);
    }

    // ECMA-262 13.6 If statement

    function parseIfStatement(node) {
        var test, consequent, alternate;

        expectKeyword('if');

        expect('(');

        test = parseExpression();

        expect(')');

        consequent = parseStatement();

        if (matchKeyword('else')) {
            lex();
            alternate = parseStatement();
        } else {
            alternate = null;
        }

        return node.finishIfStatement(test, consequent, alternate);
    }

    // ECMA-262 13.7 Iteration Statements

    function parseDoWhileStatement(node) {
        var body, test, oldInIteration;

        expectKeyword('do');

        oldInIteration = state.inIteration;
        state.inIteration = true;

        body = parseStatement();

        state.inIteration = oldInIteration;

        expectKeyword('while');

        expect('(');

        test = parseExpression();

        expect(')');

        if (match(';')) {
            lex();
        }

        return node.finishDoWhileStatement(body, test);
    }

    function parseWhileStatement(node) {
        var test, body, oldInIteration;

        expectKeyword('while');

        expect('(');

        test = parseExpression();

        expect(')');

        oldInIteration = state.inIteration;
        state.inIteration = true;

        body = parseStatement();

        state.inIteration = oldInIteration;

        return node.finishWhileStatement(test, body);
    }

    function parseForStatement(node) {
        var init, forIn, initSeq, initStartToken, test, update, left, right, kind, declarations,
            body, oldInIteration, previousAllowIn = state.allowIn;

        init = test = update = null;
        forIn = true;

        expectKeyword('for');

        expect('(');

        if (match(';')) {
            lex();
        } else {
            if (matchKeyword('var')) {
                init = new Node();
                lex();

                state.allowIn = false;
                declarations = parseVariableDeclarationList({ inFor: true });
                state.allowIn = previousAllowIn;

                if (declarations.length === 1 && matchKeyword('in')) {
                    init = init.finishVariableDeclaration(declarations);
                    lex();
                    left = init;
                    right = parseExpression();
                    init = null;
                } else if (declarations.length === 1 && declarations[0].init === null && matchContextualKeyword('of')) {
                    init = init.finishVariableDeclaration(declarations);
                    lex();
                    left = init;
                    right = parseAssignmentExpression();
                    init = null;
                    forIn = false;
                } else {
                    init = init.finishVariableDeclaration(declarations);
                    expect(';');
                }
            } else if (matchKeyword('const') || matchKeyword('let')) {
                init = new Node();
                kind = lex().value;

                if (!strict && lookahead.value === 'in') {
                    init = init.finishIdentifier(kind);
                    lex();
                    left = init;
                    right = parseExpression();
                    init = null;
                } else {
                    state.allowIn = false;
                    declarations = parseBindingList(kind, {inFor: true});
                    state.allowIn = previousAllowIn;

                    if (declarations.length === 1 && declarations[0].init === null && matchKeyword('in')) {
                        init = init.finishLexicalDeclaration(declarations, kind);
                        lex();
                        left = init;
                        right = parseExpression();
                        init = null;
                    } else if (declarations.length === 1 && declarations[0].init === null && matchContextualKeyword('of')) {
                        init = init.finishLexicalDeclaration(declarations, kind);
                        lex();
                        left = init;
                        right = parseAssignmentExpression();
                        init = null;
                        forIn = false;
                    } else {
                        consumeSemicolon();
                        init = init.finishLexicalDeclaration(declarations, kind);
                    }
                }
            } else {
                initStartToken = lookahead;
                state.allowIn = false;
                init = inheritCoverGrammar(parseAssignmentExpression);
                state.allowIn = previousAllowIn;

                if (matchKeyword('in')) {
                    if (!isAssignmentTarget) {
                        tolerateError(Messages.InvalidLHSInForIn);
                    }

                    lex();
                    reinterpretExpressionAsPattern(init);
                    left = init;
                    right = parseExpression();
                    init = null;
                } else if (matchContextualKeyword('of')) {
                    if (!isAssignmentTarget) {
                        tolerateError(Messages.InvalidLHSInForLoop);
                    }

                    lex();
                    reinterpretExpressionAsPattern(init);
                    left = init;
                    right = parseAssignmentExpression();
                    init = null;
                    forIn = false;
                } else {
                    if (match(',')) {
                        initSeq = [init];
                        while (match(',')) {
                            lex();
                            initSeq.push(isolateCoverGrammar(parseAssignmentExpression));
                        }
                        init = new WrappingNode(initStartToken).finishSequenceExpression(initSeq);
                    }
                    expect(';');
                }
            }
        }

        if (typeof left === 'undefined') {

            if (!match(';')) {
                test = parseExpression();
            }
            expect(';');

            if (!match(')')) {
                update = parseExpression();
            }
        }

        expect(')');

        oldInIteration = state.inIteration;
        state.inIteration = true;

        body = isolateCoverGrammar(parseStatement);

        state.inIteration = oldInIteration;

        return (typeof left === 'undefined') ?
                node.finishForStatement(init, test, update, body) :
                forIn ? node.finishForInStatement(left, right, body) :
                    node.finishForOfStatement(left, right, body);
    }

    // ECMA-262 13.8 The continue statement

    function parseContinueStatement(node) {
        var label = null, key;

        expectKeyword('continue');

        // Optimize the most common form: 'continue;'.
        if (source.charCodeAt(startIndex) === 0x3B) {
            lex();

            if (!state.inIteration) {
                throwError(Messages.IllegalContinue);
            }

            return node.finishContinueStatement(null);
        }

        if (hasLineTerminator) {
            if (!state.inIteration) {
                throwError(Messages.IllegalContinue);
            }

            return node.finishContinueStatement(null);
        }

        if (lookahead.type === Token.Identifier) {
            label = parseVariableIdentifier();

            key = '$' + label.name;
            if (!Object.prototype.hasOwnProperty.call(state.labelSet, key)) {
                throwError(Messages.UnknownLabel, label.name);
            }
        }

        consumeSemicolon();

        if (label === null && !state.inIteration) {
            throwError(Messages.IllegalContinue);
        }

        return node.finishContinueStatement(label);
    }

    // ECMA-262 13.9 The break statement

    function parseBreakStatement(node) {
        var label = null, key;

        expectKeyword('break');

        // Catch the very common case first: immediately a semicolon (U+003B).
        if (source.charCodeAt(lastIndex) === 0x3B) {
            lex();

            if (!(state.inIteration || state.inSwitch)) {
                throwError(Messages.IllegalBreak);
            }

            return node.finishBreakStatement(null);
        }

        if (hasLineTerminator) {
            if (!(state.inIteration || state.inSwitch)) {
                throwError(Messages.IllegalBreak);
            }
        } else if (lookahead.type === Token.Identifier) {
            label = parseVariableIdentifier();

            key = '$' + label.name;
            if (!Object.prototype.hasOwnProperty.call(state.labelSet, key)) {
                throwError(Messages.UnknownLabel, label.name);
            }
        }

        consumeSemicolon();

        if (label === null && !(state.inIteration || state.inSwitch)) {
            throwError(Messages.IllegalBreak);
        }

        return node.finishBreakStatement(label);
    }

    // ECMA-262 13.10 The return statement

    function parseReturnStatement(node) {
        var argument = null;

        expectKeyword('return');

        if (!state.inFunctionBody) {
            tolerateError(Messages.IllegalReturn);
        }

        // 'return' followed by a space and an identifier is very common.
        if (source.charCodeAt(lastIndex) === 0x20) {
            if (isIdentifierStart(source.charCodeAt(lastIndex + 1))) {
                argument = parseExpression();
                consumeSemicolon();
                return node.finishReturnStatement(argument);
            }
        }

        if (hasLineTerminator) {
            // HACK
            return node.finishReturnStatement(null);
        }

        if (!match(';')) {
            if (!match('}') && lookahead.type !== Token.EOF) {
                argument = parseExpression();
            }
        }

        consumeSemicolon();

        return node.finishReturnStatement(argument);
    }

    // ECMA-262 13.11 The with statement

    function parseWithStatement(node) {
        var object, body;

        if (strict) {
            tolerateError(Messages.StrictModeWith);
        }

        expectKeyword('with');

        expect('(');

        object = parseExpression();

        expect(')');

        body = parseStatement();

        return node.finishWithStatement(object, body);
    }

    // ECMA-262 13.12 The switch statement

    function parseSwitchCase() {
        var test, consequent = [], statement, node = new Node();

        if (matchKeyword('default')) {
            lex();
            test = null;
        } else {
            expectKeyword('case');
            test = parseExpression();
        }
        expect(':');

        while (startIndex < length) {
            if (match('}') || matchKeyword('default') || matchKeyword('case')) {
                break;
            }
            statement = parseStatementListItem();
            consequent.push(statement);
        }

        return node.finishSwitchCase(test, consequent);
    }

    function parseSwitchStatement(node) {
        var discriminant, cases, clause, oldInSwitch, defaultFound;

        expectKeyword('switch');

        expect('(');

        discriminant = parseExpression();

        expect(')');

        expect('{');

        cases = [];

        if (match('}')) {
            lex();
            return node.finishSwitchStatement(discriminant, cases);
        }

        oldInSwitch = state.inSwitch;
        state.inSwitch = true;
        defaultFound = false;

        while (startIndex < length) {
            if (match('}')) {
                break;
            }
            clause = parseSwitchCase();
            if (clause.test === null) {
                if (defaultFound) {
                    throwError(Messages.MultipleDefaultsInSwitch);
                }
                defaultFound = true;
            }
            cases.push(clause);
        }

        state.inSwitch = oldInSwitch;

        expect('}');

        return node.finishSwitchStatement(discriminant, cases);
    }

    // ECMA-262 13.14 The throw statement

    function parseThrowStatement(node) {
        var argument;

        expectKeyword('throw');

        if (hasLineTerminator) {
            throwError(Messages.NewlineAfterThrow);
        }

        argument = parseExpression();

        consumeSemicolon();

        return node.finishThrowStatement(argument);
    }

    // ECMA-262 13.15 The try statement

    function parseCatchClause() {
        var param, params = [], paramMap = {}, key, i, body, node = new Node();

        expectKeyword('catch');

        expect('(');
        if (match(')')) {
            throwUnexpectedToken(lookahead);
        }

        param = parsePattern(params);
        for (i = 0; i < params.length; i++) {
            key = '$' + params[i].value;
            if (Object.prototype.hasOwnProperty.call(paramMap, key)) {
                tolerateError(Messages.DuplicateBinding, params[i].value);
            }
            paramMap[key] = true;
        }

        // ECMA-262 12.14.1
        if (strict && isRestrictedWord(param.name)) {
            tolerateError(Messages.StrictCatchVariable);
        }

        expect(')');
        body = parseBlock();
        return node.finishCatchClause(param, body);
    }

    function parseTryStatement(node) {
        var block, handler = null, finalizer = null;

        expectKeyword('try');

        block = parseBlock();

        if (matchKeyword('catch')) {
            handler = parseCatchClause();
        }

        if (matchKeyword('finally')) {
            lex();
            finalizer = parseBlock();
        }

        if (!handler && !finalizer) {
            throwError(Messages.NoCatchOrFinally);
        }

        return node.finishTryStatement(block, handler, finalizer);
    }

    // ECMA-262 13.16 The debugger statement

    function parseDebuggerStatement(node) {
        expectKeyword('debugger');

        consumeSemicolon();

        return node.finishDebuggerStatement();
    }

    // 13 Statements

    function parseStatement() {
        var type = lookahead.type,
            expr,
            labeledBody,
            key,
            node;

        if (type === Token.EOF) {
            throwUnexpectedToken(lookahead);
        }

        if (type === Token.Punctuator && lookahead.value === '{') {
            return parseBlock();
        }
        isAssignmentTarget = isBindingElement = true;
        node = new Node();

        if (type === Token.Punctuator) {
            switch (lookahead.value) {
            case ';':
                return parseEmptyStatement(node);
            case '(':
                return parseExpressionStatement(node);
            default:
                break;
            }
        } else if (type === Token.Keyword) {
            switch (lookahead.value) {
            case 'break':
                return parseBreakStatement(node);
            case 'continue':
                return parseContinueStatement(node);
            case 'debugger':
                return parseDebuggerStatement(node);
            case 'do':
                return parseDoWhileStatement(node);
            case 'for':
                return parseForStatement(node);
            case 'function':
                return parseFunctionDeclaration(node);
            case 'if':
                return parseIfStatement(node);
            case 'return':
                return parseReturnStatement(node);
            case 'switch':
                return parseSwitchStatement(node);
            case 'throw':
                return parseThrowStatement(node);
            case 'try':
                return parseTryStatement(node);
            case 'var':
                return parseVariableStatement(node);
            case 'while':
                return parseWhileStatement(node);
            case 'with':
                return parseWithStatement(node);
            default:
                break;
            }
        }

        expr = parseExpression();

        // ECMA-262 12.12 Labelled Statements
        if ((expr.type === Syntax.Identifier) && match(':')) {
            lex();

            key = '$' + expr.name;
            if (Object.prototype.hasOwnProperty.call(state.labelSet, key)) {
                throwError(Messages.Redeclaration, 'Label', expr.name);
            }

            state.labelSet[key] = true;
            labeledBody = parseStatement();
            delete state.labelSet[key];
            return node.finishLabeledStatement(expr, labeledBody);
        }

        consumeSemicolon();

        return node.finishExpressionStatement(expr);
    }

    // ECMA-262 14.1 Function Definition

    function parseFunctionSourceElements() {
        var statement, body = [], token, directive, firstRestricted,
            oldLabelSet, oldInIteration, oldInSwitch, oldInFunctionBody,
            node = new Node();

        expect('{');

        while (startIndex < length) {
            if (lookahead.type !== Token.StringLiteral) {
                break;
            }
            token = lookahead;

            statement = parseStatementListItem();
            body.push(statement);
            if (statement.expression.type !== Syntax.Literal) {
                // this is not directive
                break;
            }
            directive = source.slice(token.start + 1, token.end - 1);
            if (directive === 'use strict') {
                strict = true;
                if (firstRestricted) {
                    tolerateUnexpectedToken(firstRestricted, Messages.StrictOctalLiteral);
                }
            } else {
                if (!firstRestricted && token.octal) {
                    firstRestricted = token;
                }
            }
        }

        oldLabelSet = state.labelSet;
        oldInIteration = state.inIteration;
        oldInSwitch = state.inSwitch;
        oldInFunctionBody = state.inFunctionBody;

        state.labelSet = {};
        state.inIteration = false;
        state.inSwitch = false;
        state.inFunctionBody = true;

        while (startIndex < length) {
            if (match('}')) {
                break;
            }
            body.push(parseStatementListItem());
        }

        expect('}');

        state.labelSet = oldLabelSet;
        state.inIteration = oldInIteration;
        state.inSwitch = oldInSwitch;
        state.inFunctionBody = oldInFunctionBody;

        return node.finishBlockStatement(body);
    }

    function validateParam(options, param, name) {
        var key = '$' + name;
        if (strict) {
            if (isRestrictedWord(name)) {
                options.stricted = param;
                options.message = Messages.StrictParamName;
            }
            if (Object.prototype.hasOwnProperty.call(options.paramSet, key)) {
                options.stricted = param;
                options.message = Messages.StrictParamDupe;
            }
        } else if (!options.firstRestricted) {
            if (isRestrictedWord(name)) {
                options.firstRestricted = param;
                options.message = Messages.StrictParamName;
            } else if (isStrictModeReservedWord(name)) {
                options.firstRestricted = param;
                options.message = Messages.StrictReservedWord;
            } else if (Object.prototype.hasOwnProperty.call(options.paramSet, key)) {
                options.stricted = param;
                options.message = Messages.StrictParamDupe;
            }
        }
        options.paramSet[key] = true;
    }

    function parseParam(options) {
        var token, param, params = [], i, def;

        token = lookahead;
        if (token.value === '...') {
            param = parseRestElement(params);
            validateParam(options, param.argument, param.argument.name);
            options.params.push(param);
            options.defaults.push(null);
            return false;
        }

        param = parsePatternWithDefault(params);
        for (i = 0; i < params.length; i++) {
            validateParam(options, params[i], params[i].value);
        }

        if (param.type === Syntax.AssignmentPattern) {
            def = param.right;
            param = param.left;
            ++options.defaultCount;
        }

        options.params.push(param);
        options.defaults.push(def);

        return !match(')');
    }

    function parseParams(firstRestricted) {
        var options;

        options = {
            params: [],
            defaultCount: 0,
            defaults: [],
            firstRestricted: firstRestricted
        };

        expect('(');

        if (!match(')')) {
            options.paramSet = {};
            while (startIndex < length) {
                if (!parseParam(options)) {
                    break;
                }
                expect(',');
            }
        }

        expect(')');

        if (options.defaultCount === 0) {
            options.defaults = [];
        }

        return {
            params: options.params,
            defaults: options.defaults,
            stricted: options.stricted,
            firstRestricted: options.firstRestricted,
            message: options.message
        };
    }

    function parseFunctionDeclaration(node, identifierIsOptional) {
        var id = null, params = [], defaults = [], body, token, stricted, tmp, firstRestricted, message, previousStrict,
            isGenerator, previousAllowYield;

        previousAllowYield = state.allowYield;

        expectKeyword('function');

        isGenerator = match('*');
        if (isGenerator) {
            lex();
        }

        if (!identifierIsOptional || !match('(')) {
            token = lookahead;
            id = parseVariableIdentifier();
            if (strict) {
                if (isRestrictedWord(token.value)) {
                    tolerateUnexpectedToken(token, Messages.StrictFunctionName);
                }
            } else {
                if (isRestrictedWord(token.value)) {
                    firstRestricted = token;
                    message = Messages.StrictFunctionName;
                } else if (isStrictModeReservedWord(token.value)) {
                    firstRestricted = token;
                    message = Messages.StrictReservedWord;
                }
            }
        }

        state.allowYield = !isGenerator;
        tmp = parseParams(firstRestricted);
        params = tmp.params;
        defaults = tmp.defaults;
        stricted = tmp.stricted;
        firstRestricted = tmp.firstRestricted;
        if (tmp.message) {
            message = tmp.message;
        }

        previousStrict = strict;
        body = parseFunctionSourceElements();
        if (strict && firstRestricted) {
            throwUnexpectedToken(firstRestricted, message);
        }
        if (strict && stricted) {
            tolerateUnexpectedToken(stricted, message);
        }

        strict = previousStrict;
        state.allowYield = previousAllowYield;

        return node.finishFunctionDeclaration(id, params, defaults, body, isGenerator);
    }

    function parseFunctionExpression() {
        var token, id = null, stricted, firstRestricted, message, tmp,
            params = [], defaults = [], body, previousStrict, node = new Node(),
            isGenerator, previousAllowYield;

        previousAllowYield = state.allowYield;

        expectKeyword('function');

        isGenerator = match('*');
        if (isGenerator) {
            lex();
        }

        state.allowYield = !isGenerator;
        if (!match('(')) {
            token = lookahead;
            id = (!strict && !isGenerator && matchKeyword('yield')) ? parseNonComputedProperty() : parseVariableIdentifier();
            if (strict) {
                if (isRestrictedWord(token.value)) {
                    tolerateUnexpectedToken(token, Messages.StrictFunctionName);
                }
            } else {
                if (isRestrictedWord(token.value)) {
                    firstRestricted = token;
                    message = Messages.StrictFunctionName;
                } else if (isStrictModeReservedWord(token.value)) {
                    firstRestricted = token;
                    message = Messages.StrictReservedWord;
                }
            }
        }

        tmp = parseParams(firstRestricted);
        params = tmp.params;
        defaults = tmp.defaults;
        stricted = tmp.stricted;
        firstRestricted = tmp.firstRestricted;
        if (tmp.message) {
            message = tmp.message;
        }

        previousStrict = strict;
        body = parseFunctionSourceElements();
        if (strict && firstRestricted) {
            throwUnexpectedToken(firstRestricted, message);
        }
        if (strict && stricted) {
            tolerateUnexpectedToken(stricted, message);
        }
        strict = previousStrict;
        state.allowYield = previousAllowYield;

        return node.finishFunctionExpression(id, params, defaults, body, isGenerator);
    }

    // ECMA-262 14.5 Class Definitions

    function parseClassBody() {
        var classBody, token, isStatic, hasConstructor = false, body, method, computed, key;

        classBody = new Node();

        expect('{');
        body = [];
        while (!match('}')) {
            if (match(';')) {
                lex();
            } else {
                method = new Node();
                token = lookahead;
                isStatic = false;
                computed = match('[');
                if (match('*')) {
                    lex();
                } else {
                    key = parseObjectPropertyKey();
                    if (key.name === 'static' && (lookaheadPropertyName() || match('*'))) {
                        token = lookahead;
                        isStatic = true;
                        computed = match('[');
                        if (match('*')) {
                            lex();
                        } else {
                            key = parseObjectPropertyKey();
                        }
                    }
                }
                method = tryParseMethodDefinition(token, key, computed, method);
                if (method) {
                    method['static'] = isStatic; // jscs:ignore requireDotNotation
                    if (method.kind === 'init') {
                        method.kind = 'method';
                    }
                    if (!isStatic) {
                        if (!method.computed && (method.key.name || method.key.value.toString()) === 'constructor') {
                            if (method.kind !== 'method' || !method.method || method.value.generator) {
                                throwUnexpectedToken(token, Messages.ConstructorSpecialMethod);
                            }
                            if (hasConstructor) {
                                throwUnexpectedToken(token, Messages.DuplicateConstructor);
                            } else {
                                hasConstructor = true;
                            }
                            method.kind = 'constructor';
                        }
                    } else {
                        if (!method.computed && (method.key.name || method.key.value.toString()) === 'prototype') {
                            throwUnexpectedToken(token, Messages.StaticPrototype);
                        }
                    }
                    method.type = Syntax.MethodDefinition;
                    delete method.method;
                    delete method.shorthand;
                    body.push(method);
                } else {
                    throwUnexpectedToken(lookahead);
                }
            }
        }
        lex();
        return classBody.finishClassBody(body);
    }

    function parseClassDeclaration(identifierIsOptional) {
        var id = null, superClass = null, classNode = new Node(), classBody, previousStrict = strict;
        strict = true;

        expectKeyword('class');

        if (!identifierIsOptional || lookahead.type === Token.Identifier) {
            id = parseVariableIdentifier();
        }

        if (matchKeyword('extends')) {
            lex();
            superClass = isolateCoverGrammar(parseLeftHandSideExpressionAllowCall);
        }
        classBody = parseClassBody();
        strict = previousStrict;

        return classNode.finishClassDeclaration(id, superClass, classBody);
    }

    function parseClassExpression() {
        var id = null, superClass = null, classNode = new Node(), classBody, previousStrict = strict;
        strict = true;

        expectKeyword('class');

        if (lookahead.type === Token.Identifier) {
            id = parseVariableIdentifier();
        }

        if (matchKeyword('extends')) {
            lex();
            superClass = isolateCoverGrammar(parseLeftHandSideExpressionAllowCall);
        }
        classBody = parseClassBody();
        strict = previousStrict;

        return classNode.finishClassExpression(id, superClass, classBody);
    }

    // ECMA-262 15.2 Modules

    function parseModuleSpecifier() {
        var node = new Node();

        if (lookahead.type !== Token.StringLiteral) {
            throwError(Messages.InvalidModuleSpecifier);
        }
        return node.finishLiteral(lex());
    }

    // ECMA-262 15.2.3 Exports

    function parseExportSpecifier() {
        var exported, local, node = new Node(), def;
        if (matchKeyword('default')) {
            // export {default} from 'something';
            def = new Node();
            lex();
            local = def.finishIdentifier('default');
        } else {
            local = parseVariableIdentifier();
        }
        if (matchContextualKeyword('as')) {
            lex();
            exported = parseNonComputedProperty();
        }
        return node.finishExportSpecifier(local, exported);
    }

    function parseExportNamedDeclaration(node) {
        var declaration = null,
            isExportFromIdentifier,
            src = null, specifiers = [];

        // non-default export
        if (lookahead.type === Token.Keyword) {
            // covers:
            // export var f = 1;
            switch (lookahead.value) {
                case 'let':
                case 'const':
                    declaration = parseLexicalDeclaration({inFor: false});
                    return node.finishExportNamedDeclaration(declaration, specifiers, null);
                case 'var':
                case 'class':
                case 'function':
                    declaration = parseStatementListItem();
                    return node.finishExportNamedDeclaration(declaration, specifiers, null);
            }
        }

        expect('{');
        while (!match('}')) {
            isExportFromIdentifier = isExportFromIdentifier || matchKeyword('default');
            specifiers.push(parseExportSpecifier());
            if (!match('}')) {
                expect(',');
                if (match('}')) {
                    break;
                }
            }
        }
        expect('}');

        if (matchContextualKeyword('from')) {
            // covering:
            // export {default} from 'foo';
            // export {foo} from 'foo';
            lex();
            src = parseModuleSpecifier();
            consumeSemicolon();
        } else if (isExportFromIdentifier) {
            // covering:
            // export {default}; // missing fromClause
            throwError(lookahead.value ?
                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);
        } else {
            // cover
            // export {foo};
            consumeSemicolon();
        }
        return node.finishExportNamedDeclaration(declaration, specifiers, src);
    }

    function parseExportDefaultDeclaration(node) {
        var declaration = null,
            expression = null;

        // covers:
        // export default ...
        expectKeyword('default');

        if (matchKeyword('function')) {
            // covers:
            // export default function foo () {}
            // export default function () {}
            declaration = parseFunctionDeclaration(new Node(), true);
            return node.finishExportDefaultDeclaration(declaration);
        }
        if (matchKeyword('class')) {
            declaration = parseClassDeclaration(true);
            return node.finishExportDefaultDeclaration(declaration);
        }

        if (matchContextualKeyword('from')) {
            throwError(Messages.UnexpectedToken, lookahead.value);
        }

        // covers:
        // export default {};
        // export default [];
        // export default (1 + 2);
        if (match('{')) {
            expression = parseObjectInitializer();
        } else if (match('[')) {
            expression = parseArrayInitializer();
        } else {
            expression = parseAssignmentExpression();
        }
        consumeSemicolon();
        return node.finishExportDefaultDeclaration(expression);
    }

    function parseExportAllDeclaration(node) {
        var src;

        // covers:
        // export * from 'foo';
        expect('*');
        if (!matchContextualKeyword('from')) {
            throwError(lookahead.value ?
                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);
        }
        lex();
        src = parseModuleSpecifier();
        consumeSemicolon();

        return node.finishExportAllDeclaration(src);
    }

    function parseExportDeclaration() {
        var node = new Node();
        if (state.inFunctionBody) {
            throwError(Messages.IllegalExportDeclaration);
        }

        expectKeyword('export');

        if (matchKeyword('default')) {
            return parseExportDefaultDeclaration(node);
        }
        if (match('*')) {
            return parseExportAllDeclaration(node);
        }
        return parseExportNamedDeclaration(node);
    }

    // ECMA-262 15.2.2 Imports

    function parseImportSpecifier() {
        // import {<foo as bar>} ...;
        var local, imported, node = new Node();

        imported = parseNonComputedProperty();
        if (matchContextualKeyword('as')) {
            lex();
            local = parseVariableIdentifier();
        }

        return node.finishImportSpecifier(local, imported);
    }

    function parseNamedImports() {
        var specifiers = [];
        // {foo, bar as bas}
        expect('{');
        while (!match('}')) {
            specifiers.push(parseImportSpecifier());
            if (!match('}')) {
                expect(',');
                if (match('}')) {
                    break;
                }
            }
        }
        expect('}');
        return specifiers;
    }

    function parseImportDefaultSpecifier() {
        // import <foo> ...;
        var local, node = new Node();

        local = parseNonComputedProperty();

        return node.finishImportDefaultSpecifier(local);
    }

    function parseImportNamespaceSpecifier() {
        // import <* as foo> ...;
        var local, node = new Node();

        expect('*');
        if (!matchContextualKeyword('as')) {
            throwError(Messages.NoAsAfterImportNamespace);
        }
        lex();
        local = parseNonComputedProperty();

        return node.finishImportNamespaceSpecifier(local);
    }

    function parseImportDeclaration() {
        var specifiers = [], src, node = new Node();

        if (state.inFunctionBody) {
            throwError(Messages.IllegalImportDeclaration);
        }

        expectKeyword('import');

        if (lookahead.type === Token.StringLiteral) {
            // import 'foo';
            src = parseModuleSpecifier();
        } else {

            if (match('{')) {
                // import {bar}
                specifiers = specifiers.concat(parseNamedImports());
            } else if (match('*')) {
                // import * as foo
                specifiers.push(parseImportNamespaceSpecifier());
            } else if (isIdentifierName(lookahead) && !matchKeyword('default')) {
                // import foo
                specifiers.push(parseImportDefaultSpecifier());
                if (match(',')) {
                    lex();
                    if (match('*')) {
                        // import foo, * as foo
                        specifiers.push(parseImportNamespaceSpecifier());
                    } else if (match('{')) {
                        // import foo, {bar}
                        specifiers = specifiers.concat(parseNamedImports());
                    } else {
                        throwUnexpectedToken(lookahead);
                    }
                }
            } else {
                throwUnexpectedToken(lex());
            }

            if (!matchContextualKeyword('from')) {
                throwError(lookahead.value ?
                        Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);
            }
            lex();
            src = parseModuleSpecifier();
        }

        consumeSemicolon();
        return node.finishImportDeclaration(specifiers, src);
    }

    // ECMA-262 15.1 Scripts

    function parseScriptBody() {
        var statement, body = [], token, directive, firstRestricted;

        while (startIndex < length) {
            token = lookahead;
            if (token.type !== Token.StringLiteral) {
                break;
            }

            statement = parseStatementListItem();
            body.push(statement);
            if (statement.expression.type !== Syntax.Literal) {
                // this is not directive
                break;
            }
            directive = source.slice(token.start + 1, token.end - 1);
            if (directive === 'use strict') {
                strict = true;
                if (firstRestricted) {
                    tolerateUnexpectedToken(firstRestricted, Messages.StrictOctalLiteral);
                }
            } else {
                if (!firstRestricted && token.octal) {
                    firstRestricted = token;
                }
            }
        }

        while (startIndex < length) {
            statement = parseStatementListItem();
            /* istanbul ignore if */
            if (typeof statement === 'undefined') {
                break;
            }
            body.push(statement);
        }
        return body;
    }

    function parseProgram() {
        var body, node;

        peek();
        node = new Node();

        body = parseScriptBody();
        return node.finishProgram(body, state.sourceType);
    }

    function filterTokenLocation() {
        var i, entry, token, tokens = [];

        for (i = 0; i < extra.tokens.length; ++i) {
            entry = extra.tokens[i];
            token = {
                type: entry.type,
                value: entry.value
            };
            if (entry.regex) {
                token.regex = {
                    pattern: entry.regex.pattern,
                    flags: entry.regex.flags
                };
            }
            if (extra.range) {
                token.range = entry.range;
            }
            if (extra.loc) {
                token.loc = entry.loc;
            }
            tokens.push(token);
        }

        extra.tokens = tokens;
    }

    function tokenize(code, options, delegate) {
        var toString,
            tokens;

        toString = String;
        if (typeof code !== 'string' && !(code instanceof String)) {
            code = toString(code);
        }

        source = code;
        index = 0;
        lineNumber = (source.length > 0) ? 1 : 0;
        lineStart = 0;
        startIndex = index;
        startLineNumber = lineNumber;
        startLineStart = lineStart;
        length = source.length;
        lookahead = null;
        state = {
            allowIn: true,
            allowYield: true,
            labelSet: {},
            inFunctionBody: false,
            inIteration: false,
            inSwitch: false,
            lastCommentStart: -1,
            curlyStack: []
        };

        extra = {};

        // Options matching.
        options = options || {};

        // Of course we collect tokens here.
        options.tokens = true;
        extra.tokens = [];
        extra.tokenValues = [];
        extra.tokenize = true;
        extra.delegate = delegate;

        // The following two fields are necessary to compute the Regex tokens.
        extra.openParenToken = -1;
        extra.openCurlyToken = -1;

        extra.range = (typeof options.range === 'boolean') && options.range;
        extra.loc = (typeof options.loc === 'boolean') && options.loc;

        if (typeof options.comment === 'boolean' && options.comment) {
            extra.comments = [];
        }
        if (typeof options.tolerant === 'boolean' && options.tolerant) {
            extra.errors = [];
        }

        try {
            peek();
            if (lookahead.type === Token.EOF) {
                return extra.tokens;
            }

            lex();
            while (lookahead.type !== Token.EOF) {
                try {
                    lex();
                } catch (lexError) {
                    if (extra.errors) {
                        recordError(lexError);
                        // We have to break on the first error
                        // to avoid infinite loops.
                        break;
                    } else {
                        throw lexError;
                    }
                }
            }

            tokens = extra.tokens;
            if (typeof extra.errors !== 'undefined') {
                tokens.errors = extra.errors;
            }
        } catch (e) {
            throw e;
        } finally {
            extra = {};
        }
        return tokens;
    }

    function parse(code, options) {
        var program, toString;

        toString = String;
        if (typeof code !== 'string' && !(code instanceof String)) {
            code = toString(code);
        }

        source = code;
        index = 0;
        lineNumber = (source.length > 0) ? 1 : 0;
        lineStart = 0;
        startIndex = index;
        startLineNumber = lineNumber;
        startLineStart = lineStart;
        length = source.length;
        lookahead = null;
        state = {
            allowIn: true,
            allowYield: true,
            labelSet: {},
            inFunctionBody: false,
            inIteration: false,
            inSwitch: false,
            lastCommentStart: -1,
            curlyStack: [],
            sourceType: 'script'
        };
        strict = false;

        extra = {};
        if (typeof options !== 'undefined') {
            extra.range = (typeof options.range === 'boolean') && options.range;
            extra.loc = (typeof options.loc === 'boolean') && options.loc;
            extra.attachComment = (typeof options.attachComment === 'boolean') && options.attachComment;

            if (extra.loc && options.source !== null && options.source !== undefined) {
                extra.source = toString(options.source);
            }

            if (typeof options.tokens === 'boolean' && options.tokens) {
                extra.tokens = [];
            }
            if (typeof options.comment === 'boolean' && options.comment) {
                extra.comments = [];
            }
            if (typeof options.tolerant === 'boolean' && options.tolerant) {
                extra.errors = [];
            }
            if (extra.attachComment) {
                extra.range = true;
                extra.comments = [];
                extra.bottomRightStack = [];
                extra.trailingComments = [];
                extra.leadingComments = [];
            }
            if (options.sourceType === 'module') {
                // very restrictive condition for now
                state.sourceType = options.sourceType;
                strict = true;
            }
        }

        try {
            program = parseProgram();
            if (typeof extra.comments !== 'undefined') {
                program.comments = extra.comments;
            }
            if (typeof extra.tokens !== 'undefined') {
                filterTokenLocation();
                program.tokens = extra.tokens;
            }
            if (typeof extra.errors !== 'undefined') {
                program.errors = extra.errors;
            }
        } catch (e) {
            throw e;
        } finally {
            extra = {};
        }

        return program;
    }

    // Sync with *.json manifests.
    exports.version = '2.7.3';

    exports.tokenize = tokenize;

    exports.parse = parse;

    // Deep copy.
    /* istanbul ignore next */
    exports.Syntax = (function () {
        var name, types = {};

        if (typeof Object.create === 'function') {
            types = Object.create(null);
        }

        for (name in Syntax) {
            if (Syntax.hasOwnProperty(name)) {
                types[name] = Syntax[name];
            }
        }

        if (typeof Object.freeze === 'function') {
            Object.freeze(types);
        }

        return types;
    }());
}));
/* vim: set sw=4 ts=4 et tw=80 : */
}());



/*
file https://github.com/estools/estraverse/blob/1.9.3/estraverse.js
*/
/* istanbul ignore next */
(function () { var exports; exports = local.estraverse = {};
/*
  Copyright (C) 2012-2013 Yusuke Suzuki <utatane.tea@gmail.com>
  Copyright (C) 2012 Ariya Hidayat <ariya.hidayat@gmail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
/*jslint vars:false, bitwise:true*/
/*jshint indent:4*/
/*global exports:true*/
(function clone(exports) {
    'use strict';

    var Syntax,
        isArray,
        VisitorOption,
        VisitorKeys,
        objectCreate,
        objectKeys,
        BREAK,
        SKIP,
        REMOVE;

    function ignoreJSHintError() { }

    isArray = Array.isArray;
    if (!isArray) {
        isArray = function isArray(array) {
            return Object.prototype.toString.call(array) === '[object Array]';
        };
    }

    function deepCopy(obj) {
        var ret = {}, key, val;
        for (key in obj) {
            if (obj.hasOwnProperty(key)) {
                val = obj[key];
                if (typeof val === 'object' && val !== null) {
                    ret[key] = deepCopy(val);
                } else {
                    ret[key] = val;
                }
            }
        }
        return ret;
    }

    function shallowCopy(obj) {
        var ret = {}, key;
        for (key in obj) {
            if (obj.hasOwnProperty(key)) {
                ret[key] = obj[key];
            }
        }
        return ret;
    }
    ignoreJSHintError(shallowCopy);

    // based on LLVM libc++ upper_bound / lower_bound
    // MIT License

    function upperBound(array, func) {
        var diff, len, i, current;

        len = array.length;
        i = 0;

        while (len) {
            diff = len >>> 1;
            current = i + diff;
            if (func(array[current])) {
                len = diff;
            } else {
                i = current + 1;
                len -= diff + 1;
            }
        }
        return i;
    }

    function lowerBound(array, func) {
        var diff, len, i, current;

        len = array.length;
        i = 0;

        while (len) {
            diff = len >>> 1;
            current = i + diff;
            if (func(array[current])) {
                i = current + 1;
                len -= diff + 1;
            } else {
                len = diff;
            }
        }
        return i;
    }
    ignoreJSHintError(lowerBound);

    objectCreate = Object.create || (function () {
        function F() { }

        return function (o) {
            F.prototype = o;
            return new F();
        };
    })();

    objectKeys = Object.keys || function (o) {
        var keys = [], key;
        for (key in o) {
            keys.push(key);
        }
        return keys;
    };

    function extend(to, from) {
        var keys = objectKeys(from), key, i, len;
        for (i = 0, len = keys.length; i < len; i += 1) {
            key = keys[i];
            to[key] = from[key];
        }
        return to;
    }

    Syntax = {
        AssignmentExpression: 'AssignmentExpression',
        AssignmentPattern: 'AssignmentPattern',
        ArrayExpression: 'ArrayExpression',
        ArrayPattern: 'ArrayPattern',
        ArrowFunctionExpression: 'ArrowFunctionExpression',
        AwaitExpression: 'AwaitExpression', // CAUTION: It's deferred to ES7.
        BlockStatement: 'BlockStatement',
        BinaryExpression: 'BinaryExpression',
        BreakStatement: 'BreakStatement',
        CallExpression: 'CallExpression',
        CatchClause: 'CatchClause',
        ClassBody: 'ClassBody',
        ClassDeclaration: 'ClassDeclaration',
        ClassExpression: 'ClassExpression',
        ComprehensionBlock: 'ComprehensionBlock',  // CAUTION: It's deferred to ES7.
        ComprehensionExpression: 'ComprehensionExpression',  // CAUTION: It's deferred to ES7.
        ConditionalExpression: 'ConditionalExpression',
        ContinueStatement: 'ContinueStatement',
        DebuggerStatement: 'DebuggerStatement',
        DirectiveStatement: 'DirectiveStatement',
        DoWhileStatement: 'DoWhileStatement',
        EmptyStatement: 'EmptyStatement',
        ExportAllDeclaration: 'ExportAllDeclaration',
        ExportDefaultDeclaration: 'ExportDefaultDeclaration',
        ExportNamedDeclaration: 'ExportNamedDeclaration',
        ExportSpecifier: 'ExportSpecifier',
        ExpressionStatement: 'ExpressionStatement',
        ForStatement: 'ForStatement',
        ForInStatement: 'ForInStatement',
        ForOfStatement: 'ForOfStatement',
        FunctionDeclaration: 'FunctionDeclaration',
        FunctionExpression: 'FunctionExpression',
        GeneratorExpression: 'GeneratorExpression',  // CAUTION: It's deferred to ES7.
        Identifier: 'Identifier',
        IfStatement: 'IfStatement',
        ImportDeclaration: 'ImportDeclaration',
        ImportDefaultSpecifier: 'ImportDefaultSpecifier',
        ImportNamespaceSpecifier: 'ImportNamespaceSpecifier',
        ImportSpecifier: 'ImportSpecifier',
        Literal: 'Literal',
        LabeledStatement: 'LabeledStatement',
        LogicalExpression: 'LogicalExpression',
        MemberExpression: 'MemberExpression',
        MetaProperty: 'MetaProperty',
        MethodDefinition: 'MethodDefinition',
        ModuleSpecifier: 'ModuleSpecifier',
        NewExpression: 'NewExpression',
        ObjectExpression: 'ObjectExpression',
        ObjectPattern: 'ObjectPattern',
        Program: 'Program',
        Property: 'Property',
        RestElement: 'RestElement',
        ReturnStatement: 'ReturnStatement',
        SequenceExpression: 'SequenceExpression',
        SpreadElement: 'SpreadElement',
        Super: 'Super',
        SwitchStatement: 'SwitchStatement',
        SwitchCase: 'SwitchCase',
        TaggedTemplateExpression: 'TaggedTemplateExpression',
        TemplateElement: 'TemplateElement',
        TemplateLiteral: 'TemplateLiteral',
        ThisExpression: 'ThisExpression',
        ThrowStatement: 'ThrowStatement',
        TryStatement: 'TryStatement',
        UnaryExpression: 'UnaryExpression',
        UpdateExpression: 'UpdateExpression',
        VariableDeclaration: 'VariableDeclaration',
        VariableDeclarator: 'VariableDeclarator',
        WhileStatement: 'WhileStatement',
        WithStatement: 'WithStatement',
        YieldExpression: 'YieldExpression'
    };

    VisitorKeys = {
        AssignmentExpression: ['left', 'right'],
        AssignmentPattern: ['left', 'right'],
        ArrayExpression: ['elements'],
        ArrayPattern: ['elements'],
        ArrowFunctionExpression: ['params', 'body'],
        AwaitExpression: ['argument'], // CAUTION: It's deferred to ES7.
        BlockStatement: ['body'],
        BinaryExpression: ['left', 'right'],
        BreakStatement: ['label'],
        CallExpression: ['callee', 'arguments'],
        CatchClause: ['param', 'body'],
        ClassBody: ['body'],
        ClassDeclaration: ['id', 'superClass', 'body'],
        ClassExpression: ['id', 'superClass', 'body'],
        ComprehensionBlock: ['left', 'right'],  // CAUTION: It's deferred to ES7.
        ComprehensionExpression: ['blocks', 'filter', 'body'],  // CAUTION: It's deferred to ES7.
        ConditionalExpression: ['test', 'consequent', 'alternate'],
        ContinueStatement: ['label'],
        DebuggerStatement: [],
        DirectiveStatement: [],
        DoWhileStatement: ['body', 'test'],
        EmptyStatement: [],
        ExportAllDeclaration: ['source'],
        ExportDefaultDeclaration: ['declaration'],
        ExportNamedDeclaration: ['declaration', 'specifiers', 'source'],
        ExportSpecifier: ['exported', 'local'],
        ExpressionStatement: ['expression'],
        ForStatement: ['init', 'test', 'update', 'body'],
        ForInStatement: ['left', 'right', 'body'],
        ForOfStatement: ['left', 'right', 'body'],
        FunctionDeclaration: ['id', 'params', 'body'],
        FunctionExpression: ['id', 'params', 'body'],
        GeneratorExpression: ['blocks', 'filter', 'body'],  // CAUTION: It's deferred to ES7.
        Identifier: [],
        IfStatement: ['test', 'consequent', 'alternate'],
        ImportDeclaration: ['specifiers', 'source'],
        ImportDefaultSpecifier: ['local'],
        ImportNamespaceSpecifier: ['local'],
        ImportSpecifier: ['imported', 'local'],
        Literal: [],
        LabeledStatement: ['label', 'body'],
        LogicalExpression: ['left', 'right'],
        MemberExpression: ['object', 'property'],
        MetaProperty: ['meta', 'property'],
        MethodDefinition: ['key', 'value'],
        ModuleSpecifier: [],
        NewExpression: ['callee', 'arguments'],
        ObjectExpression: ['properties'],
        ObjectPattern: ['properties'],
        Program: ['body'],
        Property: ['key', 'value'],
        RestElement: [ 'argument' ],
        ReturnStatement: ['argument'],
        SequenceExpression: ['expressions'],
        SpreadElement: ['argument'],
        Super: [],
        SwitchStatement: ['discriminant', 'cases'],
        SwitchCase: ['test', 'consequent'],
        TaggedTemplateExpression: ['tag', 'quasi'],
        TemplateElement: [],
        TemplateLiteral: ['quasis', 'expressions'],
        ThisExpression: [],
        ThrowStatement: ['argument'],
        TryStatement: ['block', 'handler', 'finalizer'],
        UnaryExpression: ['argument'],
        UpdateExpression: ['argument'],
        VariableDeclaration: ['declarations'],
        VariableDeclarator: ['id', 'init'],
        WhileStatement: ['test', 'body'],
        WithStatement: ['object', 'body'],
        YieldExpression: ['argument']
    };

    // unique id
    BREAK = {};
    SKIP = {};
    REMOVE = {};

    VisitorOption = {
        Break: BREAK,
        Skip: SKIP,
        Remove: REMOVE
    };

    function Reference(parent, key) {
        this.parent = parent;
        this.key = key;
    }

    Reference.prototype.replace = function replace(node) {
        this.parent[this.key] = node;
    };

    Reference.prototype.remove = function remove() {
        if (isArray(this.parent)) {
            this.parent.splice(this.key, 1);
            return true;
        } else {
            this.replace(null);
            return false;
        }
    };

    function Element(node, path, wrap, ref) {
        this.node = node;
        this.path = path;
        this.wrap = wrap;
        this.ref = ref;
    }

    function Controller() { }

    // API:
    // return property path array from root to current node
    Controller.prototype.path = function path() {
        var i, iz, j, jz, result, element;

        function addToPath(result, path) {
            if (isArray(path)) {
                for (j = 0, jz = path.length; j < jz; ++j) {
                    result.push(path[j]);
                }
            } else {
                result.push(path);
            }
        }

        // root node
        if (!this.__current.path) {
            return null;
        }

        // first node is sentinel, second node is root element
        result = [];
        for (i = 2, iz = this.__leavelist.length; i < iz; ++i) {
            element = this.__leavelist[i];
            addToPath(result, element.path);
        }
        addToPath(result, this.__current.path);
        return result;
    };

    // API:
    // return type of current node
    Controller.prototype.type = function () {
        var node = this.current();
        return node.type || this.__current.wrap;
    };

    // API:
    // return array of parent elements
    Controller.prototype.parents = function parents() {
        var i, iz, result;

        // first node is sentinel
        result = [];
        for (i = 1, iz = this.__leavelist.length; i < iz; ++i) {
            result.push(this.__leavelist[i].node);
        }

        return result;
    };

    // API:
    // return current node
    Controller.prototype.current = function current() {
        return this.__current.node;
    };

    Controller.prototype.__execute = function __execute(callback, element) {
        var previous, result;

        result = undefined;

        previous  = this.__current;
        this.__current = element;
        this.__state = null;
        if (callback) {
            result = callback.call(this, element.node, this.__leavelist[this.__leavelist.length - 1].node);
        }
        this.__current = previous;

        return result;
    };

    // API:
    // notify control skip / break
    Controller.prototype.notify = function notify(flag) {
        this.__state = flag;
    };

    // API:
    // skip child nodes of current node
    Controller.prototype.skip = function () {
        this.notify(SKIP);
    };

    // API:
    // break traversals
    Controller.prototype['break'] = function () {
        this.notify(BREAK);
    };

    // API:
    // remove node
    Controller.prototype.remove = function () {
        this.notify(REMOVE);
    };

    Controller.prototype.__initialize = function(root, visitor) {
        this.visitor = visitor;
        this.root = root;
        this.__worklist = [];
        this.__leavelist = [];
        this.__current = null;
        this.__state = null;
        this.__fallback = null;
        if (visitor.fallback === 'iteration') {
            this.__fallback = objectKeys;
        } else if (typeof visitor.fallback === 'function') {
            this.__fallback = visitor.fallback;
        }

        this.__keys = VisitorKeys;
        if (visitor.keys) {
            this.__keys = extend(objectCreate(this.__keys), visitor.keys);
        }
    };

    function isNode(node) {
        if (node == null) {
            return false;
        }
        return typeof node === 'object' && typeof node.type === 'string';
    }

    function isProperty(nodeType, key) {
        return (nodeType === Syntax.ObjectExpression || nodeType === Syntax.ObjectPattern) && 'properties' === key;
    }

    Controller.prototype.traverse = function traverse(root, visitor) {
        var worklist,
            leavelist,
            element,
            node,
            nodeType,
            ret,
            key,
            current,
            current2,
            candidates,
            candidate,
            sentinel;

        this.__initialize(root, visitor);

        sentinel = {};

        // reference
        worklist = this.__worklist;
        leavelist = this.__leavelist;

        // initialize
        worklist.push(new Element(root, null, null, null));
        leavelist.push(new Element(null, null, null, null));

        while (worklist.length) {
            element = worklist.pop();

            if (element === sentinel) {
                element = leavelist.pop();

                ret = this.__execute(visitor.leave, element);

                if (this.__state === BREAK || ret === BREAK) {
                    return;
                }
                continue;
            }

            if (element.node) {

                ret = this.__execute(visitor.enter, element);

                if (this.__state === BREAK || ret === BREAK) {
                    return;
                }

                worklist.push(sentinel);
                leavelist.push(element);

                if (this.__state === SKIP || ret === SKIP) {
                    continue;
                }

                node = element.node;
                nodeType = node.type || element.wrap;
                candidates = this.__keys[nodeType];
                if (!candidates) {
                    if (this.__fallback) {
                        candidates = this.__fallback(node);
                    } else {
                        throw new Error('Unknown node type ' + nodeType + '.');
                    }
                }

                current = candidates.length;
                while ((current -= 1) >= 0) {
                    key = candidates[current];
                    candidate = node[key];
                    if (!candidate) {
                        continue;
                    }

                    if (isArray(candidate)) {
                        current2 = candidate.length;
                        while ((current2 -= 1) >= 0) {
                            if (!candidate[current2]) {
                                continue;
                            }
                            if (isProperty(nodeType, candidates[current])) {
                                element = new Element(candidate[current2], [key, current2], 'Property', null);
                            } else if (isNode(candidate[current2])) {
                                element = new Element(candidate[current2], [key, current2], null, null);
                            } else {
                                continue;
                            }
                            worklist.push(element);
                        }
                    } else if (isNode(candidate)) {
                        worklist.push(new Element(candidate, key, null, null));
                    }
                }
            }
        }
    };

    Controller.prototype.replace = function replace(root, visitor) {
        var worklist,
            leavelist,
            node,
            nodeType,
            target,
            element,
            current,
            current2,
            candidates,
            candidate,
            sentinel,
            outer,
            key;

        function removeElem(element) {
            var i,
                key,
                nextElem,
                parent;

            if (element.ref.remove()) {
                // When the reference is an element of an array.
                key = element.ref.key;
                parent = element.ref.parent;

                // If removed from array, then decrease following items' keys.
                i = worklist.length;
                while (i--) {
                    nextElem = worklist[i];
                    if (nextElem.ref && nextElem.ref.parent === parent) {
                        if  (nextElem.ref.key < key) {
                            break;
                        }
                        --nextElem.ref.key;
                    }
                }
            }
        }

        this.__initialize(root, visitor);

        sentinel = {};

        // reference
        worklist = this.__worklist;
        leavelist = this.__leavelist;

        // initialize
        outer = {
            root: root
        };
        element = new Element(root, null, null, new Reference(outer, 'root'));
        worklist.push(element);
        leavelist.push(element);

        while (worklist.length) {
            element = worklist.pop();

            if (element === sentinel) {
                element = leavelist.pop();

                target = this.__execute(visitor.leave, element);

                // node may be replaced with null,
                // so distinguish between undefined and null in this place
                if (target !== undefined && target !== BREAK && target !== SKIP && target !== REMOVE) {
                    // replace
                    element.ref.replace(target);
                }

                if (this.__state === REMOVE || target === REMOVE) {
                    removeElem(element);
                }

                if (this.__state === BREAK || target === BREAK) {
                    return outer.root;
                }
                continue;
            }

            target = this.__execute(visitor.enter, element);

            // node may be replaced with null,
            // so distinguish between undefined and null in this place
            if (target !== undefined && target !== BREAK && target !== SKIP && target !== REMOVE) {
                // replace
                element.ref.replace(target);
                element.node = target;
            }

            if (this.__state === REMOVE || target === REMOVE) {
                removeElem(element);
                element.node = null;
            }

            if (this.__state === BREAK || target === BREAK) {
                return outer.root;
            }

            // node may be null
            node = element.node;
            if (!node) {
                continue;
            }

            worklist.push(sentinel);
            leavelist.push(element);

            if (this.__state === SKIP || target === SKIP) {
                continue;
            }

            nodeType = node.type || element.wrap;
            candidates = this.__keys[nodeType];
            if (!candidates) {
                if (this.__fallback) {
                    candidates = this.__fallback(node);
                } else {
                    throw new Error('Unknown node type ' + nodeType + '.');
                }
            }

            current = candidates.length;
            while ((current -= 1) >= 0) {
                key = candidates[current];
                candidate = node[key];
                if (!candidate) {
                    continue;
                }

                if (isArray(candidate)) {
                    current2 = candidate.length;
                    while ((current2 -= 1) >= 0) {
                        if (!candidate[current2]) {
                            continue;
                        }
                        if (isProperty(nodeType, candidates[current])) {
                            element = new Element(candidate[current2], [key, current2], 'Property', new Reference(candidate, current2));
                        } else if (isNode(candidate[current2])) {
                            element = new Element(candidate[current2], [key, current2], null, new Reference(candidate, current2));
                        } else {
                            continue;
                        }
                        worklist.push(element);
                    }
                } else if (isNode(candidate)) {
                    worklist.push(new Element(candidate, key, null, new Reference(node, key)));
                }
            }
        }

        return outer.root;
    };

    function traverse(root, visitor) {
        var controller = new Controller();
        return controller.traverse(root, visitor);
    }

    function replace(root, visitor) {
        var controller = new Controller();
        return controller.replace(root, visitor);
    }

    function extendCommentRange(comment, tokens) {
        var target;

        target = upperBound(tokens, function search(token) {
            return token.range[0] > comment.range[0];
        });

        comment.extendedRange = [comment.range[0], comment.range[1]];

        if (target !== tokens.length) {
            comment.extendedRange[1] = tokens[target].range[0];
        }

        target -= 1;
        if (target >= 0) {
            comment.extendedRange[0] = tokens[target].range[1];
        }

        return comment;
    }

    function attachComments(tree, providedComments, tokens) {
        // At first, we should calculate extended comment ranges.
        var comments = [], comment, len, i, cursor;

        if (!tree.range) {
            throw new Error('attachComments needs range information');
        }

        // tokens array is empty, we attach comments to tree as 'leadingComments'
        if (!tokens.length) {
            if (providedComments.length) {
                for (i = 0, len = providedComments.length; i < len; i += 1) {
                    comment = deepCopy(providedComments[i]);
                    comment.extendedRange = [0, tree.range[0]];
                    comments.push(comment);
                }
                tree.leadingComments = comments;
            }
            return tree;
        }

        for (i = 0, len = providedComments.length; i < len; i += 1) {
            comments.push(extendCommentRange(deepCopy(providedComments[i]), tokens));
        }

        // This is based on John Freeman's implementation.
        cursor = 0;
        traverse(tree, {
            enter: function (node) {
                var comment;

                while (cursor < comments.length) {
                    comment = comments[cursor];
                    if (comment.extendedRange[1] > node.range[0]) {
                        break;
                    }

                    if (comment.extendedRange[1] === node.range[0]) {
                        if (!node.leadingComments) {
                            node.leadingComments = [];
                        }
                        node.leadingComments.push(comment);
                        comments.splice(cursor, 1);
                    } else {
                        cursor += 1;
                    }
                }

                // already out of owned node
                if (cursor === comments.length) {
                    return VisitorOption.Break;
                }

                if (comments[cursor].extendedRange[0] > node.range[1]) {
                    return VisitorOption.Skip;
                }
            }
        });

        cursor = 0;
        traverse(tree, {
            leave: function (node) {
                var comment;

                while (cursor < comments.length) {
                    comment = comments[cursor];
                    if (node.range[1] < comment.extendedRange[0]) {
                        break;
                    }

                    if (node.range[1] === comment.extendedRange[0]) {
                        if (!node.trailingComments) {
                            node.trailingComments = [];
                        }
                        node.trailingComments.push(comment);
                        comments.splice(cursor, 1);
                    } else {
                        cursor += 1;
                    }
                }

                // already out of owned node
                if (cursor === comments.length) {
                    return VisitorOption.Break;
                }

                if (comments[cursor].extendedRange[0] > node.range[1]) {
                    return VisitorOption.Skip;
                }
            }
        });

        return tree;
    }

    exports.version = require('./package.json').version;
    exports.Syntax = Syntax;
    exports.traverse = traverse;
    exports.replace = replace;
    exports.attachComments = attachComments;
    exports.VisitorKeys = VisitorKeys;
    exports.VisitorOption = VisitorOption;
    exports.Controller = Controller;
    exports.cloneEnvironment = function () { return clone({}); };

    return exports;
}(exports));
/* vim: set sw=4 ts=4 et tw=80 : */
}());



/*
file https://github.com/estools/esutils/blob/2.0.2/lib/code.js
*/
/* istanbul ignore next */
(function () { var module; module = {};
/*
  Copyright (C) 2013-2014 Yusuke Suzuki <utatane.tea@gmail.com>
  Copyright (C) 2014 Ivan Nikulin <ifaaan@gmail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

(function () {
    'use strict';

    var ES6Regex, ES5Regex, NON_ASCII_WHITESPACES, IDENTIFIER_START, IDENTIFIER_PART, ch;

    // See `tools/generate-identifier-regex.js`.
    ES5Regex = {
        // ECMAScript 5.1/Unicode v7.0.0 NonAsciiIdentifierStart:
        NonAsciiIdentifierStart: /[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,
        // ECMAScript 5.1/Unicode v7.0.0 NonAsciiIdentifierPart:
        NonAsciiIdentifierPart: /[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/
    };

    ES6Regex = {
        // ECMAScript 6/Unicode v7.0.0 NonAsciiIdentifierStart:
        NonAsciiIdentifierStart: /[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,
        // ECMAScript 6/Unicode v7.0.0 NonAsciiIdentifierPart:
        NonAsciiIdentifierPart: /[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/
    };

    function isDecimalDigit(ch) {
        return 0x30 <= ch && ch <= 0x39;  // 0..9
    }

    function isHexDigit(ch) {
        return 0x30 <= ch && ch <= 0x39 ||  // 0..9
            0x61 <= ch && ch <= 0x66 ||     // a..f
            0x41 <= ch && ch <= 0x46;       // A..F
    }

    function isOctalDigit(ch) {
        return ch >= 0x30 && ch <= 0x37;  // 0..7
    }

    // 7.2 White Space

    NON_ASCII_WHITESPACES = [
        0x1680, 0x180E,
        0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006, 0x2007, 0x2008, 0x2009, 0x200A,
        0x202F, 0x205F,
        0x3000,
        0xFEFF
    ];

    function isWhiteSpace(ch) {
        return ch === 0x20 || ch === 0x09 || ch === 0x0B || ch === 0x0C || ch === 0xA0 ||
            ch >= 0x1680 && NON_ASCII_WHITESPACES.indexOf(ch) >= 0;
    }

    // 7.3 Line Terminators

    function isLineTerminator(ch) {
        return ch === 0x0A || ch === 0x0D || ch === 0x2028 || ch === 0x2029;
    }

    // 7.6 Identifier Names and Identifiers

    function fromCodePoint(cp) {
        if (cp <= 0xFFFF) { return String.fromCharCode(cp); }
        var cu1 = String.fromCharCode(Math.floor((cp - 0x10000) / 0x400) + 0xD800);
        var cu2 = String.fromCharCode(((cp - 0x10000) % 0x400) + 0xDC00);
        return cu1 + cu2;
    }

    IDENTIFIER_START = new Array(0x80);
    for(ch = 0; ch < 0x80; ++ch) {
        IDENTIFIER_START[ch] =
            ch >= 0x61 && ch <= 0x7A ||  // a..z
            ch >= 0x41 && ch <= 0x5A ||  // A..Z
            ch === 0x24 || ch === 0x5F;  // $ (dollar) and _ (underscore)
    }

    IDENTIFIER_PART = new Array(0x80);
    for(ch = 0; ch < 0x80; ++ch) {
        IDENTIFIER_PART[ch] =
            ch >= 0x61 && ch <= 0x7A ||  // a..z
            ch >= 0x41 && ch <= 0x5A ||  // A..Z
            ch >= 0x30 && ch <= 0x39 ||  // 0..9
            ch === 0x24 || ch === 0x5F;  // $ (dollar) and _ (underscore)
    }

    function isIdentifierStartES5(ch) {
        return ch < 0x80 ? IDENTIFIER_START[ch] : ES5Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch));
    }

    function isIdentifierPartES5(ch) {
        return ch < 0x80 ? IDENTIFIER_PART[ch] : ES5Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch));
    }

    function isIdentifierStartES6(ch) {
        return ch < 0x80 ? IDENTIFIER_START[ch] : ES6Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch));
    }

    function isIdentifierPartES6(ch) {
        return ch < 0x80 ? IDENTIFIER_PART[ch] : ES6Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch));
    }

    module.exports = {
        isDecimalDigit: isDecimalDigit,
        isHexDigit: isHexDigit,
        isOctalDigit: isOctalDigit,
        isWhiteSpace: isWhiteSpace,
        isLineTerminator: isLineTerminator,
        isIdentifierStartES5: isIdentifierStartES5,
        isIdentifierPartES5: isIdentifierPartES5,
        isIdentifierStartES6: isIdentifierStartES6,
        isIdentifierPartES6: isIdentifierPartES6
    };
}());
/* vim: set sw=4 ts=4 et tw=80 : */
local.esutils = { code: module.exports }; }());



/*
file https://github.com/estools/escodegen/blob/1.8.1/escodegen.js
*/
/* istanbul ignore next */
(function () { var exports; exports = local.escodegen = {};
/*
  Copyright (C) 2012-2014 Yusuke Suzuki <utatane.tea@gmail.com>
  Copyright (C) 2015 Ingvar Stepanyan <me@rreverser.com>
  Copyright (C) 2014 Ivan Nikulin <ifaaan@gmail.com>
  Copyright (C) 2012-2013 Michael Ficarra <escodegen.copyright@michael.ficarra.me>
  Copyright (C) 2012-2013 Mathias Bynens <mathias@qiwi.be>
  Copyright (C) 2013 Irakli Gozalishvili <rfobic@gmail.com>
  Copyright (C) 2012 Robert Gust-Bardon <donate@robert.gust-bardon.org>
  Copyright (C) 2012 John Freeman <jfreeman08@gmail.com>
  Copyright (C) 2011-2012 Ariya Hidayat <ariya.hidayat@gmail.com>
  Copyright (C) 2012 Joost-Wim Boekesteijn <joost-wim@boekesteijn.nl>
  Copyright (C) 2012 Kris Kowal <kris.kowal@cixar.com>
  Copyright (C) 2012 Arpad Borsos <arpad.borsos@googlemail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

/*global exports:true, require:true, global:true*/
(function () {
    'use strict';

    var Syntax,
        Precedence,
        BinaryPrecedence,
        SourceNode,
        estraverse,
        esutils,
        isArray,
        base,
        indent,
        json,
        renumber,
        hexadecimal,
        quotes,
        escapeless,
        newline,
        space,
        parentheses,
        semicolons,
        safeConcatenation,
        directive,
        extra,
        parse,
        sourceMap,
        sourceCode,
        preserveBlankLines,
        FORMAT_MINIFY,
        FORMAT_DEFAULTS;

    estraverse = require('estraverse');
    esutils = require('esutils');

    Syntax = estraverse.Syntax;

    // Generation is done by generateExpression.
    function isExpression(node) {
        return CodeGenerator.Expression.hasOwnProperty(node.type);
    }

    // Generation is done by generateStatement.
    function isStatement(node) {
        return CodeGenerator.Statement.hasOwnProperty(node.type);
    }

    Precedence = {
        Sequence: 0,
        Yield: 1,
        Await: 1,
        Assignment: 1,
        Conditional: 2,
        ArrowFunction: 2,
        LogicalOR: 3,
        LogicalAND: 4,
        BitwiseOR: 5,
        BitwiseXOR: 6,
        BitwiseAND: 7,
        Equality: 8,
        Relational: 9,
        BitwiseSHIFT: 10,
        Additive: 11,
        Multiplicative: 12,
        Unary: 13,
        Postfix: 14,
        Call: 15,
        New: 16,
        TaggedTemplate: 17,
        Member: 18,
        Primary: 19
    };

    BinaryPrecedence = {
        '||': Precedence.LogicalOR,
        '&&': Precedence.LogicalAND,
        '|': Precedence.BitwiseOR,
        '^': Precedence.BitwiseXOR,
        '&': Precedence.BitwiseAND,
        '==': Precedence.Equality,
        '!=': Precedence.Equality,
        '===': Precedence.Equality,
        '!==': Precedence.Equality,
        'is': Precedence.Equality,
        'isnt': Precedence.Equality,
        '<': Precedence.Relational,
        '>': Precedence.Relational,
        '<=': Precedence.Relational,
        '>=': Precedence.Relational,
        'in': Precedence.Relational,
        'instanceof': Precedence.Relational,
        '<<': Precedence.BitwiseSHIFT,
        '>>': Precedence.BitwiseSHIFT,
        '>>>': Precedence.BitwiseSHIFT,
        '+': Precedence.Additive,
        '-': Precedence.Additive,
        '*': Precedence.Multiplicative,
        '%': Precedence.Multiplicative,
        '/': Precedence.Multiplicative
    };

    //Flags
    var F_ALLOW_IN = 1,
        F_ALLOW_CALL = 1 << 1,
        F_ALLOW_UNPARATH_NEW = 1 << 2,
        F_FUNC_BODY = 1 << 3,
        F_DIRECTIVE_CTX = 1 << 4,
        F_SEMICOLON_OPT = 1 << 5;

    //Expression flag sets
    //NOTE: Flag order:
    // F_ALLOW_IN
    // F_ALLOW_CALL
    // F_ALLOW_UNPARATH_NEW
    var E_FTT = F_ALLOW_CALL | F_ALLOW_UNPARATH_NEW,
        E_TTF = F_ALLOW_IN | F_ALLOW_CALL,
        E_TTT = F_ALLOW_IN | F_ALLOW_CALL | F_ALLOW_UNPARATH_NEW,
        E_TFF = F_ALLOW_IN,
        E_FFT = F_ALLOW_UNPARATH_NEW,
        E_TFT = F_ALLOW_IN | F_ALLOW_UNPARATH_NEW;

    //Statement flag sets
    //NOTE: Flag order:
    // F_ALLOW_IN
    // F_FUNC_BODY
    // F_DIRECTIVE_CTX
    // F_SEMICOLON_OPT
    var S_TFFF = F_ALLOW_IN,
        S_TFFT = F_ALLOW_IN | F_SEMICOLON_OPT,
        S_FFFF = 0x00,
        S_TFTF = F_ALLOW_IN | F_DIRECTIVE_CTX,
        S_TTFF = F_ALLOW_IN | F_FUNC_BODY;

    function getDefaultOptions() {
        // default options
        return {
            indent: null,
            base: null,
            parse: null,
            comment: false,
            format: {
                indent: {
                    style: '    ',
                    base: 0,
                    adjustMultilineComment: false
                },
                newline: '\n',
                space: ' ',
                json: false,
                renumber: false,
                hexadecimal: false,
                quotes: 'single',
                escapeless: false,
                compact: false,
                parentheses: true,
                semicolons: true,
                safeConcatenation: false,
                preserveBlankLines: false
            },
            moz: {
                comprehensionExpressionStartsWithAssignment: false,
                starlessGenerator: false
            },
            sourceMap: null,
            sourceMapRoot: null,
            sourceMapWithCode: false,
            directive: false,
            raw: true,
            verbatim: null,
            sourceCode: null
        };
    }

    function stringRepeat(str, num) {
        var result = '';

        for (num |= 0; num > 0; num >>>= 1, str += str) {
            if (num & 1) {
                result += str;
            }
        }

        return result;
    }

    isArray = Array.isArray;
    if (!isArray) {
        isArray = function isArray(array) {
            return Object.prototype.toString.call(array) === '[object Array]';
        };
    }

    function hasLineTerminator(str) {
        return (/[\r\n]/g).test(str);
    }

    function endsWithLineTerminator(str) {
        var len = str.length;
        return len && esutils.code.isLineTerminator(str.charCodeAt(len - 1));
    }

    function merge(target, override) {
        var key;
        for (key in override) {
            if (override.hasOwnProperty(key)) {
                target[key] = override[key];
            }
        }
        return target;
    }

    function updateDeeply(target, override) {
        var key, val;

        function isHashObject(target) {
            return typeof target === 'object' && target instanceof Object && !(target instanceof RegExp);
        }

        for (key in override) {
            if (override.hasOwnProperty(key)) {
                val = override[key];
                if (isHashObject(val)) {
                    if (isHashObject(target[key])) {
                        updateDeeply(target[key], val);
                    } else {
                        target[key] = updateDeeply({}, val);
                    }
                } else {
                    target[key] = val;
                }
            }
        }
        return target;
    }

    function generateNumber(value) {
        var result, point, temp, exponent, pos;

        if (value !== value) {
            throw new Error('Numeric literal whose value is NaN');
        }
        if (value < 0 || (value === 0 && 1 / value < 0)) {
            throw new Error('Numeric literal whose value is negative');
        }

        if (value === 1 / 0) {
            return json ? 'null' : renumber ? '1e400' : '1e+400';
        }

        result = '' + value;
        if (!renumber || result.length < 3) {
            return result;
        }

        point = result.indexOf('.');
        if (!json && result.charCodeAt(0) === 0x30  /* 0 */ && point === 1) {
            point = 0;
            result = result.slice(1);
        }
        temp = result;
        result = result.replace('e+', 'e');
        exponent = 0;
        if ((pos = temp.indexOf('e')) > 0) {
            exponent = +temp.slice(pos + 1);
            temp = temp.slice(0, pos);
        }
        if (point >= 0) {
            exponent -= temp.length - point - 1;
            temp = +(temp.slice(0, point) + temp.slice(point + 1)) + '';
        }
        pos = 0;
        while (temp.charCodeAt(temp.length + pos - 1) === 0x30  /* 0 */) {
            --pos;
        }
        if (pos !== 0) {
            exponent -= pos;
            temp = temp.slice(0, pos);
        }
        if (exponent !== 0) {
            temp += 'e' + exponent;
        }
        if ((temp.length < result.length ||
                    (hexadecimal && value > 1e12 && Math.floor(value) === value && (temp = '0x' + value.toString(16)).length < result.length)) &&
                +temp === value) {
            result = temp;
        }

        return result;
    }

    // Generate valid RegExp expression.
    // This function is based on https://github.com/Constellation/iv Engine

    function escapeRegExpCharacter(ch, previousIsBackslash) {
        // not handling '\' and handling \u2028 or \u2029 to unicode escape sequence
        if ((ch & ~1) === 0x2028) {
            return (previousIsBackslash ? 'u' : '\\u') + ((ch === 0x2028) ? '2028' : '2029');
        } else if (ch === 10 || ch === 13) {  // \n, \r
            return (previousIsBackslash ? '' : '\\') + ((ch === 10) ? 'n' : 'r');
        }
        return String.fromCharCode(ch);
    }

    function generateRegExp(reg) {
        var match, result, flags, i, iz, ch, characterInBrack, previousIsBackslash;

        result = reg.toString();

        if (reg.source) {
            // extract flag from toString result
            match = result.match(/\/([^/]*)$/);
            if (!match) {
                return result;
            }

            flags = match[1];
            result = '';

            characterInBrack = false;
            previousIsBackslash = false;
            for (i = 0, iz = reg.source.length; i < iz; ++i) {
                ch = reg.source.charCodeAt(i);

                if (!previousIsBackslash) {
                    if (characterInBrack) {
                        if (ch === 93) {  // ]
                            characterInBrack = false;
                        }
                    } else {
                        if (ch === 47) {  // /
                            result += '\\';
                        } else if (ch === 91) {  // [
                            characterInBrack = true;
                        }
                    }
                    result += escapeRegExpCharacter(ch, previousIsBackslash);
                    previousIsBackslash = ch === 92;  // \
                } else {
                    // if new RegExp("\\\n') is provided, create /\n/
                    result += escapeRegExpCharacter(ch, previousIsBackslash);
                    // prevent like /\\[/]/
                    previousIsBackslash = false;
                }
            }

            return '/' + result + '/' + flags;
        }

        return result;
    }

    function escapeAllowedCharacter(code, next) {
        var hex;

        if (code === 0x08  /* \b */) {
            return '\\b';
        }

        if (code === 0x0C  /* \f */) {
            return '\\f';
        }

        if (code === 0x09  /* \t */) {
            return '\\t';
        }

        hex = code.toString(16).toUpperCase();
        if (json || code > 0xFF) {
            return '\\u' + '0000'.slice(hex.length) + hex;
        } else if (code === 0x0000 && !esutils.code.isDecimalDigit(next)) {
            return '\\0';
        } else if (code === 0x000B  /* \v */) { // '\v'
            return '\\x0B';
        } else {
            return '\\x' + '00'.slice(hex.length) + hex;
        }
    }

    function escapeDisallowedCharacter(code) {
        if (code === 0x5C  /* \ */) {
            return '\\\\';
        }

        if (code === 0x0A  /* \n */) {
            return '\\n';
        }

        if (code === 0x0D  /* \r */) {
            return '\\r';
        }

        if (code === 0x2028) {
            return '\\u2028';
        }

        if (code === 0x2029) {
            return '\\u2029';
        }

        throw new Error('Incorrectly classified character');
    }

    function escapeDirective(str) {
        var i, iz, code, quote;

        quote = quotes === 'double' ? '"' : '\'';
        for (i = 0, iz = str.length; i < iz; ++i) {
            code = str.charCodeAt(i);
            if (code === 0x27  /* ' */) {
                quote = '"';
                break;
            } else if (code === 0x22  /* " */) {
                quote = '\'';
                break;
            } else if (code === 0x5C  /* \ */) {
                ++i;
            }
        }

        return quote + str + quote;
    }

    function escapeString(str) {
        var result = '', i, len, code, singleQuotes = 0, doubleQuotes = 0, single, quote;

        for (i = 0, len = str.length; i < len; ++i) {
            code = str.charCodeAt(i);
            if (code === 0x27  /* ' */) {
                ++singleQuotes;
            } else if (code === 0x22  /* " */) {
                ++doubleQuotes;
            } else if (code === 0x2F  /* / */ && json) {
                result += '\\';
            } else if (esutils.code.isLineTerminator(code) || code === 0x5C  /* \ */) {
                result += escapeDisallowedCharacter(code);
                continue;
            } else if (!esutils.code.isIdentifierPartES5(code) && (json && code < 0x20  /* SP */ || !json && !escapeless && (code < 0x20  /* SP */ || code > 0x7E  /* ~ */))) {
                result += escapeAllowedCharacter(code, str.charCodeAt(i + 1));
                continue;
            }
            result += String.fromCharCode(code);
        }

        single = !(quotes === 'double' || (quotes === 'auto' && doubleQuotes < singleQuotes));
        quote = single ? '\'' : '"';

        if (!(single ? singleQuotes : doubleQuotes)) {
            return quote + result + quote;
        }

        str = result;
        result = quote;

        for (i = 0, len = str.length; i < len; ++i) {
            code = str.charCodeAt(i);
            if ((code === 0x27  /* ' */ && single) || (code === 0x22  /* " */ && !single)) {
                result += '\\';
            }
            result += String.fromCharCode(code);
        }

        return result + quote;
    }

    /**
     * flatten an array to a string, where the array can contain
     * either strings or nested arrays
     */
    function flattenToString(arr) {
        var i, iz, elem, result = '';
        for (i = 0, iz = arr.length; i < iz; ++i) {
            elem = arr[i];
            result += isArray(elem) ? flattenToString(elem) : elem;
        }
        return result;
    }

    /**
     * convert generated to a SourceNode when source maps are enabled.
     */
    function toSourceNodeWhenNeeded(generated, node) {
        if (!sourceMap) {
            // with no source maps, generated is either an
            // array or a string.  if an array, flatten it.
            // if a string, just return it
            if (isArray(generated)) {
                return flattenToString(generated);
            } else {
                return generated;
            }
        }
        if (node == null) {
            if (generated instanceof SourceNode) {
                return generated;
            } else {
                node = {};
            }
        }
        if (node.loc == null) {
            return new SourceNode(null, null, sourceMap, generated, node.name || null);
        }
        return new SourceNode(node.loc.start.line, node.loc.start.column, (sourceMap === true ? node.loc.source || null : sourceMap), generated, node.name || null);
    }

    function noEmptySpace() {
        return (space) ? space : ' ';
    }

    function join(left, right) {
        var leftSource,
            rightSource,
            leftCharCode,
            rightCharCode;

        leftSource = toSourceNodeWhenNeeded(left).toString();
        if (leftSource.length === 0) {
            return [right];
        }

        rightSource = toSourceNodeWhenNeeded(right).toString();
        if (rightSource.length === 0) {
            return [left];
        }

        leftCharCode = leftSource.charCodeAt(leftSource.length - 1);
        rightCharCode = rightSource.charCodeAt(0);

        if ((leftCharCode === 0x2B  /* + */ || leftCharCode === 0x2D  /* - */) && leftCharCode === rightCharCode ||
            esutils.code.isIdentifierPartES5(leftCharCode) && esutils.code.isIdentifierPartES5(rightCharCode) ||
            leftCharCode === 0x2F  /* / */ && rightCharCode === 0x69  /* i */) { // infix word operators all start with `i`
            return [left, noEmptySpace(), right];
        } else if (esutils.code.isWhiteSpace(leftCharCode) || esutils.code.isLineTerminator(leftCharCode) ||
                esutils.code.isWhiteSpace(rightCharCode) || esutils.code.isLineTerminator(rightCharCode)) {
            return [left, right];
        }
        return [left, space, right];
    }

    function addIndent(stmt) {
        return [base, stmt];
    }

    function withIndent(fn) {
        var previousBase;
        previousBase = base;
        base += indent;
        fn(base);
        base = previousBase;
    }

    function calculateSpaces(str) {
        var i;
        for (i = str.length - 1; i >= 0; --i) {
            if (esutils.code.isLineTerminator(str.charCodeAt(i))) {
                break;
            }
        }
        return (str.length - 1) - i;
    }

    function adjustMultilineComment(value, specialBase) {
        var array, i, len, line, j, spaces, previousBase, sn;

        array = value.split(/\r\n|[\r\n]/);
        spaces = Number.MAX_VALUE;

        // first line doesn't have indentation
        for (i = 1, len = array.length; i < len; ++i) {
            line = array[i];
            j = 0;
            while (j < line.length && esutils.code.isWhiteSpace(line.charCodeAt(j))) {
                ++j;
            }
            if (spaces > j) {
                spaces = j;
            }
        }

        if (typeof specialBase !== 'undefined') {
            // pattern like
            // {
            //   var t = 20;  /*
            //                 * this is comment
            //                 */
            // }
            previousBase = base;
            if (array[1][spaces] === '*') {
                specialBase += ' ';
            }
            base = specialBase;
        } else {
            if (spaces & 1) {
                // /*
                //  *
                //  */
                // If spaces are odd number, above pattern is considered.
                // We waste 1 space.
                --spaces;
            }
            previousBase = base;
        }

        for (i = 1, len = array.length; i < len; ++i) {
            sn = toSourceNodeWhenNeeded(addIndent(array[i].slice(spaces)));
            array[i] = sourceMap ? sn.join('') : sn;
        }

        base = previousBase;

        return array.join('\n');
    }

    function generateComment(comment, specialBase) {
        if (comment.type === 'Line') {
            if (endsWithLineTerminator(comment.value)) {
                return '//' + comment.value;
            } else {
                // Always use LineTerminator
                var result = '//' + comment.value;
                if (!preserveBlankLines) {
                    result += '\n';
                }
                return result;
            }
        }
        if (extra.format.indent.adjustMultilineComment && /[\n\r]/.test(comment.value)) {
            return adjustMultilineComment('/*' + comment.value + '*/', specialBase);
        }
        return '/*' + comment.value + '*/';
    }

    function addComments(stmt, result) {
        var i, len, comment, save, tailingToStatement, specialBase, fragment,
            extRange, range, prevRange, prefix, infix, suffix, count;

        if (stmt.leadingComments && stmt.leadingComments.length > 0) {
            save = result;

            if (preserveBlankLines) {
                comment = stmt.leadingComments[0];
                result = [];

                extRange = comment.extendedRange;
                range = comment.range;

                prefix = sourceCode.substring(extRange[0], range[0]);
                count = (prefix.match(/\n/g) || []).length;
                if (count > 0) {
                    result.push(stringRepeat('\n', count));
                    result.push(addIndent(generateComment(comment)));
                } else {
                    result.push(prefix);
                    result.push(generateComment(comment));
                }

                prevRange = range;

                for (i = 1, len = stmt.leadingComments.length; i < len; i++) {
                    comment = stmt.leadingComments[i];
                    range = comment.range;

                    infix = sourceCode.substring(prevRange[1], range[0]);
                    count = (infix.match(/\n/g) || []).length;
                    result.push(stringRepeat('\n', count));
                    result.push(addIndent(generateComment(comment)));

                    prevRange = range;
                }

                suffix = sourceCode.substring(range[1], extRange[1]);
                count = (suffix.match(/\n/g) || []).length;
                result.push(stringRepeat('\n', count));
            } else {
                comment = stmt.leadingComments[0];
                result = [];
                if (safeConcatenation && stmt.type === Syntax.Program && stmt.body.length === 0) {
                    result.push('\n');
                }
                result.push(generateComment(comment));
                if (!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                    result.push('\n');
                }

                for (i = 1, len = stmt.leadingComments.length; i < len; ++i) {
                    comment = stmt.leadingComments[i];
                    fragment = [generateComment(comment)];
                    if (!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())) {
                        fragment.push('\n');
                    }
                    result.push(addIndent(fragment));
                }
            }

            result.push(addIndent(save));
        }

        if (stmt.trailingComments) {

            if (preserveBlankLines) {
                comment = stmt.trailingComments[0];
                extRange = comment.extendedRange;
                range = comment.range;

                prefix = sourceCode.substring(extRange[0], range[0]);
                count = (prefix.match(/\n/g) || []).length;

                if (count > 0) {
                    result.push(stringRepeat('\n', count));
                    result.push(addIndent(generateComment(comment)));
                } else {
                    result.push(prefix);
                    result.push(generateComment(comment));
                }
            } else {
                tailingToStatement = !endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());
                specialBase = stringRepeat(' ', calculateSpaces(toSourceNodeWhenNeeded([base, result, indent]).toString()));
                for (i = 0, len = stmt.trailingComments.length; i < len; ++i) {
                    comment = stmt.trailingComments[i];
                    if (tailingToStatement) {
                        // We assume target like following script
                        //
                        // var t = 20;  /**
                        //               * This is comment of t
                        //               */
                        if (i === 0) {
                            // first case
                            result = [result, indent];
                        } else {
                            result = [result, specialBase];
                        }
                        result.push(generateComment(comment, specialBase));
                    } else {
                        result = [result, addIndent(generateComment(comment))];
                    }
                    if (i !== len - 1 && !endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                        result = [result, '\n'];
                    }
                }
            }
        }

        return result;
    }

    function generateBlankLines(start, end, result) {
        var j, newlineCount = 0;

        for (j = start; j < end; j++) {
            if (sourceCode[j] === '\n') {
                newlineCount++;
            }
        }

        for (j = 1; j < newlineCount; j++) {
            result.push(newline);
        }
    }

    function parenthesize(text, current, should) {
        if (current < should) {
            return ['(', text, ')'];
        }
        return text;
    }

    function generateVerbatimString(string) {
        var i, iz, result;
        result = string.split(/\r\n|\n/);
        for (i = 1, iz = result.length; i < iz; i++) {
            result[i] = newline + base + result[i];
        }
        return result;
    }

    function generateVerbatim(expr, precedence) {
        var verbatim, result, prec;
        verbatim = expr[extra.verbatim];

        if (typeof verbatim === 'string') {
            result = parenthesize(generateVerbatimString(verbatim), Precedence.Sequence, precedence);
        } else {
            // verbatim is object
            result = generateVerbatimString(verbatim.content);
            prec = (verbatim.precedence != null) ? verbatim.precedence : Precedence.Sequence;
            result = parenthesize(result, prec, precedence);
        }

        return toSourceNodeWhenNeeded(result, expr);
    }

    function CodeGenerator() {
    }

    // Helpers.

    CodeGenerator.prototype.maybeBlock = function(stmt, flags) {
        var result, noLeadingComment, that = this;

        noLeadingComment = !extra.comment || !stmt.leadingComments;

        if (stmt.type === Syntax.BlockStatement && noLeadingComment) {
            return [space, this.generateStatement(stmt, flags)];
        }

        if (stmt.type === Syntax.EmptyStatement && noLeadingComment) {
            return ';';
        }

        withIndent(function () {
            result = [
                newline,
                addIndent(that.generateStatement(stmt, flags))
            ];
        });

        return result;
    };

    CodeGenerator.prototype.maybeBlockSuffix = function (stmt, result) {
        var ends = endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());
        if (stmt.type === Syntax.BlockStatement && (!extra.comment || !stmt.leadingComments) && !ends) {
            return [result, space];
        }
        if (ends) {
            return [result, base];
        }
        return [result, newline, base];
    };

    function generateIdentifier(node) {
        return toSourceNodeWhenNeeded(node.name, node);
    }

    function generateAsyncPrefix(node, spaceRequired) {
        return node.async ? 'async' + (spaceRequired ? noEmptySpace() : space) : '';
    }

    function generateStarSuffix(node) {
        var isGenerator = node.generator && !extra.moz.starlessGenerator;
        return isGenerator ? '*' + space : '';
    }

    function generateMethodPrefix(prop) {
        var func = prop.value;
        if (func.async) {
            return generateAsyncPrefix(func, !prop.computed);
        } else {
            // avoid space before method name
            return generateStarSuffix(func) ? '*' : '';
        }
    }

    CodeGenerator.prototype.generatePattern = function (node, precedence, flags) {
        if (node.type === Syntax.Identifier) {
            return generateIdentifier(node);
        }
        return this.generateExpression(node, precedence, flags);
    };

    CodeGenerator.prototype.generateFunctionParams = function (node) {
        var i, iz, result, hasDefault;

        hasDefault = false;

        if (node.type === Syntax.ArrowFunctionExpression &&
                !node.rest && (!node.defaults || node.defaults.length === 0) &&
                node.params.length === 1 && node.params[0].type === Syntax.Identifier) {
            // arg => { } case
            result = [generateAsyncPrefix(node, true), generateIdentifier(node.params[0])];
        } else {
            result = node.type === Syntax.ArrowFunctionExpression ? [generateAsyncPrefix(node, false)] : [];
            result.push('(');
            if (node.defaults) {
                hasDefault = true;
            }
            for (i = 0, iz = node.params.length; i < iz; ++i) {
                if (hasDefault && node.defaults[i]) {
                    // Handle default values.
                    result.push(this.generateAssignment(node.params[i], node.defaults[i], '=', Precedence.Assignment, E_TTT));
                } else {
                    result.push(this.generatePattern(node.params[i], Precedence.Assignment, E_TTT));
                }
                if (i + 1 < iz) {
                    result.push(',' + space);
                }
            }

            if (node.rest) {
                if (node.params.length) {
                    result.push(',' + space);
                }
                result.push('...');
                result.push(generateIdentifier(node.rest));
            }

            result.push(')');
        }

        return result;
    };

    CodeGenerator.prototype.generateFunctionBody = function (node) {
        var result, expr;

        result = this.generateFunctionParams(node);

        if (node.type === Syntax.ArrowFunctionExpression) {
            result.push(space);
            result.push('=>');
        }

        if (node.expression) {
            result.push(space);
            expr = this.generateExpression(node.body, Precedence.Assignment, E_TTT);
            if (expr.toString().charAt(0) === '{') {
                expr = ['(', expr, ')'];
            }
            result.push(expr);
        } else {
            result.push(this.maybeBlock(node.body, S_TTFF));
        }

        return result;
    };

    CodeGenerator.prototype.generateIterationForStatement = function (operator, stmt, flags) {
        var result = ['for' + space + '('], that = this;
        withIndent(function () {
            if (stmt.left.type === Syntax.VariableDeclaration) {
                withIndent(function () {
                    result.push(stmt.left.kind + noEmptySpace());
                    result.push(that.generateStatement(stmt.left.declarations[0], S_FFFF));
                });
            } else {
                result.push(that.generateExpression(stmt.left, Precedence.Call, E_TTT));
            }

            result = join(result, operator);
            result = [join(
                result,
                that.generateExpression(stmt.right, Precedence.Sequence, E_TTT)
            ), ')'];
        });
        result.push(this.maybeBlock(stmt.body, flags));
        return result;
    };

    CodeGenerator.prototype.generatePropertyKey = function (expr, computed, value) {
        var result = [];

        if (computed) {
            result.push('[');
        }

        if (value.type === 'AssignmentPattern') {
            result.push(this.AssignmentPattern(value, Precedence.Sequence, E_TTT));
        } else {
            result.push(this.generateExpression(expr, Precedence.Sequence, E_TTT));
        }

        if (computed) {
            result.push(']');
        }

        return result;
    };

    CodeGenerator.prototype.generateAssignment = function (left, right, operator, precedence, flags) {
        if (Precedence.Assignment < precedence) {
            flags |= F_ALLOW_IN;
        }

        return parenthesize(
            [
                this.generateExpression(left, Precedence.Call, flags),
                space + operator + space,
                this.generateExpression(right, Precedence.Assignment, flags)
            ],
            Precedence.Assignment,
            precedence
        );
    };

    CodeGenerator.prototype.semicolon = function (flags) {
        if (!semicolons && flags & F_SEMICOLON_OPT) {
            return '';
        }
        return ';';
    };

    // Statements.

    CodeGenerator.Statement = {

        BlockStatement: function (stmt, flags) {
            var range, content, result = ['{', newline], that = this;

            withIndent(function () {
                // handle functions without any code
                if (stmt.body.length === 0 && preserveBlankLines) {
                    range = stmt.range;
                    if (range[1] - range[0] > 2) {
                        content = sourceCode.substring(range[0] + 1, range[1] - 1);
                        if (content[0] === '\n') {
                            result = ['{'];
                        }
                        result.push(content);
                    }
                }

                var i, iz, fragment, bodyFlags;
                bodyFlags = S_TFFF;
                if (flags & F_FUNC_BODY) {
                    bodyFlags |= F_DIRECTIVE_CTX;
                }

                for (i = 0, iz = stmt.body.length; i < iz; ++i) {
                    if (preserveBlankLines) {
                        // handle spaces before the first line
                        if (i === 0) {
                            if (stmt.body[0].leadingComments) {
                                range = stmt.body[0].leadingComments[0].extendedRange;
                                content = sourceCode.substring(range[0], range[1]);
                                if (content[0] === '\n') {
                                    result = ['{'];
                                }
                            }
                            if (!stmt.body[0].leadingComments) {
                                generateBlankLines(stmt.range[0], stmt.body[0].range[0], result);
                            }
                        }

                        // handle spaces between lines
                        if (i > 0) {
                            if (!stmt.body[i - 1].trailingComments  && !stmt.body[i].leadingComments) {
                                generateBlankLines(stmt.body[i - 1].range[1], stmt.body[i].range[0], result);
                            }
                        }
                    }

                    if (i === iz - 1) {
                        bodyFlags |= F_SEMICOLON_OPT;
                    }

                    if (stmt.body[i].leadingComments && preserveBlankLines) {
                        fragment = that.generateStatement(stmt.body[i], bodyFlags);
                    } else {
                        fragment = addIndent(that.generateStatement(stmt.body[i], bodyFlags));
                    }

                    result.push(fragment);
                    if (!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())) {
                        if (preserveBlankLines && i < iz - 1) {
                            // don't add a new line if there are leading coments
                            // in the next statement
                            if (!stmt.body[i + 1].leadingComments) {
                                result.push(newline);
                            }
                        } else {
                            result.push(newline);
                        }
                    }

                    if (preserveBlankLines) {
                        // handle spaces after the last line
                        if (i === iz - 1) {
                            if (!stmt.body[i].trailingComments) {
                                generateBlankLines(stmt.body[i].range[1], stmt.range[1], result);
                            }
                        }
                    }
                }
            });

            result.push(addIndent('}'));
            return result;
        },

        BreakStatement: function (stmt, flags) {
            if (stmt.label) {
                return 'break ' + stmt.label.name + this.semicolon(flags);
            }
            return 'break' + this.semicolon(flags);
        },

        ContinueStatement: function (stmt, flags) {
            if (stmt.label) {
                return 'continue ' + stmt.label.name + this.semicolon(flags);
            }
            return 'continue' + this.semicolon(flags);
        },

        ClassBody: function (stmt, flags) {
            var result = [ '{', newline], that = this;

            withIndent(function (indent) {
                var i, iz;

                for (i = 0, iz = stmt.body.length; i < iz; ++i) {
                    result.push(indent);
                    result.push(that.generateExpression(stmt.body[i], Precedence.Sequence, E_TTT));
                    if (i + 1 < iz) {
                        result.push(newline);
                    }
                }
            });

            if (!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                result.push(newline);
            }
            result.push(base);
            result.push('}');
            return result;
        },

        ClassDeclaration: function (stmt, flags) {
            var result, fragment;
            result  = ['class'];
            if (stmt.id) {
                result = join(result, this.generateExpression(stmt.id, Precedence.Sequence, E_TTT));
            }
            if (stmt.superClass) {
                fragment = join('extends', this.generateExpression(stmt.superClass, Precedence.Assignment, E_TTT));
                result = join(result, fragment);
            }
            result.push(space);
            result.push(this.generateStatement(stmt.body, S_TFFT));
            return result;
        },

        DirectiveStatement: function (stmt, flags) {
            if (extra.raw && stmt.raw) {
                return stmt.raw + this.semicolon(flags);
            }
            return escapeDirective(stmt.directive) + this.semicolon(flags);
        },

        DoWhileStatement: function (stmt, flags) {
            // Because `do 42 while (cond)` is Syntax Error. We need semicolon.
            var result = join('do', this.maybeBlock(stmt.body, S_TFFF));
            result = this.maybeBlockSuffix(stmt.body, result);
            return join(result, [
                'while' + space + '(',
                this.generateExpression(stmt.test, Precedence.Sequence, E_TTT),
                ')' + this.semicolon(flags)
            ]);
        },

        CatchClause: function (stmt, flags) {
            var result, that = this;
            withIndent(function () {
                var guard;

                result = [
                    'catch' + space + '(',
                    that.generateExpression(stmt.param, Precedence.Sequence, E_TTT),
                    ')'
                ];

                if (stmt.guard) {
                    guard = that.generateExpression(stmt.guard, Precedence.Sequence, E_TTT);
                    result.splice(2, 0, ' if ', guard);
                }
            });
            result.push(this.maybeBlock(stmt.body, S_TFFF));
            return result;
        },

        DebuggerStatement: function (stmt, flags) {
            return 'debugger' + this.semicolon(flags);
        },

        EmptyStatement: function (stmt, flags) {
            return ';';
        },

        ExportDefaultDeclaration: function (stmt, flags) {
            var result = [ 'export' ], bodyFlags;

            bodyFlags = (flags & F_SEMICOLON_OPT) ? S_TFFT : S_TFFF;

            // export default HoistableDeclaration[Default]
            // export default AssignmentExpression[In] ;
            result = join(result, 'default');
            if (isStatement(stmt.declaration)) {
                result = join(result, this.generateStatement(stmt.declaration, bodyFlags));
            } else {
                result = join(result, this.generateExpression(stmt.declaration, Precedence.Assignment, E_TTT) + this.semicolon(flags));
            }
            return result;
        },

        ExportNamedDeclaration: function (stmt, flags) {
            var result = [ 'export' ], bodyFlags, that = this;

            bodyFlags = (flags & F_SEMICOLON_OPT) ? S_TFFT : S_TFFF;

            // export VariableStatement
            // export Declaration[Default]
            if (stmt.declaration) {
                return join(result, this.generateStatement(stmt.declaration, bodyFlags));
            }

            // export ExportClause[NoReference] FromClause ;
            // export ExportClause ;
            if (stmt.specifiers) {
                if (stmt.specifiers.length === 0) {
                    result = join(result, '{' + space + '}');
                } else if (stmt.specifiers[0].type === Syntax.ExportBatchSpecifier) {
                    result = join(result, this.generateExpression(stmt.specifiers[0], Precedence.Sequence, E_TTT));
                } else {
                    result = join(result, '{');
                    withIndent(function (indent) {
                        var i, iz;
                        result.push(newline);
                        for (i = 0, iz = stmt.specifiers.length; i < iz; ++i) {
                            result.push(indent);
                            result.push(that.generateExpression(stmt.specifiers[i], Precedence.Sequence, E_TTT));
                            if (i + 1 < iz) {
                                result.push(',' + newline);
                            }
                        }
                    });
                    if (!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                        result.push(newline);
                    }
                    result.push(base + '}');
                }

                if (stmt.source) {
                    result = join(result, [
                        'from' + space,
                        // ModuleSpecifier
                        this.generateExpression(stmt.source, Precedence.Sequence, E_TTT),
                        this.semicolon(flags)
                    ]);
                } else {
                    result.push(this.semicolon(flags));
                }
            }
            return result;
        },

        ExportAllDeclaration: function (stmt, flags) {
            // export * FromClause ;
            return [
                'export' + space,
                '*' + space,
                'from' + space,
                // ModuleSpecifier
                this.generateExpression(stmt.source, Precedence.Sequence, E_TTT),
                this.semicolon(flags)
            ];
        },

        ExpressionStatement: function (stmt, flags) {
            var result, fragment;

            function isClassPrefixed(fragment) {
                var code;
                if (fragment.slice(0, 5) !== 'class') {
                    return false;
                }
                code = fragment.charCodeAt(5);
                return code === 0x7B  /* '{' */ || esutils.code.isWhiteSpace(code) || esutils.code.isLineTerminator(code);
            }

            function isFunctionPrefixed(fragment) {
                var code;
                if (fragment.slice(0, 8) !== 'function') {
                    return false;
                }
                code = fragment.charCodeAt(8);
                return code === 0x28 /* '(' */ || esutils.code.isWhiteSpace(code) || code === 0x2A  /* '*' */ || esutils.code.isLineTerminator(code);
            }

            function isAsyncPrefixed(fragment) {
                var code, i, iz;
                if (fragment.slice(0, 5) !== 'async') {
                    return false;
                }
                if (!esutils.code.isWhiteSpace(fragment.charCodeAt(5))) {
                    return false;
                }
                for (i = 6, iz = fragment.length; i < iz; ++i) {
                    if (!esutils.code.isWhiteSpace(fragment.charCodeAt(i))) {
                        break;
                    }
                }
                if (i === iz) {
                    return false;
                }
                if (fragment.slice(i, i + 8) !== 'function') {
                    return false;
                }
                code = fragment.charCodeAt(i + 8);
                return code === 0x28 /* '(' */ || esutils.code.isWhiteSpace(code) || code === 0x2A  /* '*' */ || esutils.code.isLineTerminator(code);
            }

            result = [this.generateExpression(stmt.expression, Precedence.Sequence, E_TTT)];
            // 12.4 '{', 'function', 'class' is not allowed in this position.
            // wrap expression with parentheses
            fragment = toSourceNodeWhenNeeded(result).toString();
            if (fragment.charCodeAt(0) === 0x7B  /* '{' */ ||  // ObjectExpression
                    isClassPrefixed(fragment) ||
                    isFunctionPrefixed(fragment) ||
                    isAsyncPrefixed(fragment) ||
                    (directive && (flags & F_DIRECTIVE_CTX) && stmt.expression.type === Syntax.Literal && typeof stmt.expression.value === 'string')) {
                result = ['(', result, ')' + this.semicolon(flags)];
            } else {
                result.push(this.semicolon(flags));
            }
            return result;
        },

        ImportDeclaration: function (stmt, flags) {
            // ES6: 15.2.1 valid import declarations:
            //     - import ImportClause FromClause ;
            //     - import ModuleSpecifier ;
            var result, cursor, that = this;

            // If no ImportClause is present,
            // this should be `import ModuleSpecifier` so skip `from`
            // ModuleSpecifier is StringLiteral.
            if (stmt.specifiers.length === 0) {
                // import ModuleSpecifier ;
                return [
                    'import',
                    space,
                    // ModuleSpecifier
                    this.generateExpression(stmt.source, Precedence.Sequence, E_TTT),
                    this.semicolon(flags)
                ];
            }

            // import ImportClause FromClause ;
            result = [
                'import'
            ];
            cursor = 0;

            // ImportedBinding
            if (stmt.specifiers[cursor].type === Syntax.ImportDefaultSpecifier) {
                result = join(result, [
                        this.generateExpression(stmt.specifiers[cursor], Precedence.Sequence, E_TTT)
                ]);
                ++cursor;
            }

            if (stmt.specifiers[cursor]) {
                if (cursor !== 0) {
                    result.push(',');
                }

                if (stmt.specifiers[cursor].type === Syntax.ImportNamespaceSpecifier) {
                    // NameSpaceImport
                    result = join(result, [
                            space,
                            this.generateExpression(stmt.specifiers[cursor], Precedence.Sequence, E_TTT)
                    ]);
                } else {
                    // NamedImports
                    result.push(space + '{');

                    if ((stmt.specifiers.length - cursor) === 1) {
                        // import { ... } from "...";
                        result.push(space);
                        result.push(this.generateExpression(stmt.specifiers[cursor], Precedence.Sequence, E_TTT));
                        result.push(space + '}' + space);
                    } else {
                        // import {
                        //    ...,
                        //    ...,
                        // } from "...";
                        withIndent(function (indent) {
                            var i, iz;
                            result.push(newline);
                            for (i = cursor, iz = stmt.specifiers.length; i < iz; ++i) {
                                result.push(indent);
                                result.push(that.generateExpression(stmt.specifiers[i], Precedence.Sequence, E_TTT));
                                if (i + 1 < iz) {
                                    result.push(',' + newline);
                                }
                            }
                        });
                        if (!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                            result.push(newline);
                        }
                        result.push(base + '}' + space);
                    }
                }
            }

            result = join(result, [
                'from' + space,
                // ModuleSpecifier
                this.generateExpression(stmt.source, Precedence.Sequence, E_TTT),
                this.semicolon(flags)
            ]);
            return result;
        },

        VariableDeclarator: function (stmt, flags) {
            var itemFlags = (flags & F_ALLOW_IN) ? E_TTT : E_FTT;
            if (stmt.init) {
                return [
                    this.generateExpression(stmt.id, Precedence.Assignment, itemFlags),
                    space,
                    '=',
                    space,
                    this.generateExpression(stmt.init, Precedence.Assignment, itemFlags)
                ];
            }
            return this.generatePattern(stmt.id, Precedence.Assignment, itemFlags);
        },

        VariableDeclaration: function (stmt, flags) {
            // VariableDeclarator is typed as Statement,
            // but joined with comma (not LineTerminator).
            // So if comment is attached to target node, we should specialize.
            var result, i, iz, node, bodyFlags, that = this;

            result = [ stmt.kind ];

            bodyFlags = (flags & F_ALLOW_IN) ? S_TFFF : S_FFFF;

            function block() {
                node = stmt.declarations[0];
                if (extra.comment && node.leadingComments) {
                    result.push('\n');
                    result.push(addIndent(that.generateStatement(node, bodyFlags)));
                } else {
                    result.push(noEmptySpace());
                    result.push(that.generateStatement(node, bodyFlags));
                }

                for (i = 1, iz = stmt.declarations.length; i < iz; ++i) {
                    node = stmt.declarations[i];
                    if (extra.comment && node.leadingComments) {
                        result.push(',' + newline);
                        result.push(addIndent(that.generateStatement(node, bodyFlags)));
                    } else {
                        result.push(',' + space);
                        result.push(that.generateStatement(node, bodyFlags));
                    }
                }
            }

            if (stmt.declarations.length > 1) {
                withIndent(block);
            } else {
                block();
            }

            result.push(this.semicolon(flags));

            return result;
        },

        ThrowStatement: function (stmt, flags) {
            return [join(
                'throw',
                this.generateExpression(stmt.argument, Precedence.Sequence, E_TTT)
            ), this.semicolon(flags)];
        },

        TryStatement: function (stmt, flags) {
            var result, i, iz, guardedHandlers;

            result = ['try', this.maybeBlock(stmt.block, S_TFFF)];
            result = this.maybeBlockSuffix(stmt.block, result);

            if (stmt.handlers) {
                // old interface
                for (i = 0, iz = stmt.handlers.length; i < iz; ++i) {
                    result = join(result, this.generateStatement(stmt.handlers[i], S_TFFF));
                    if (stmt.finalizer || i + 1 !== iz) {
                        result = this.maybeBlockSuffix(stmt.handlers[i].body, result);
                    }
                }
            } else {
                guardedHandlers = stmt.guardedHandlers || [];

                for (i = 0, iz = guardedHandlers.length; i < iz; ++i) {
                    result = join(result, this.generateStatement(guardedHandlers[i], S_TFFF));
                    if (stmt.finalizer || i + 1 !== iz) {
                        result = this.maybeBlockSuffix(guardedHandlers[i].body, result);
                    }
                }

                // new interface
                if (stmt.handler) {
                    if (isArray(stmt.handler)) {
                        for (i = 0, iz = stmt.handler.length; i < iz; ++i) {
                            result = join(result, this.generateStatement(stmt.handler[i], S_TFFF));
                            if (stmt.finalizer || i + 1 !== iz) {
                                result = this.maybeBlockSuffix(stmt.handler[i].body, result);
                            }
                        }
                    } else {
                        result = join(result, this.generateStatement(stmt.handler, S_TFFF));
                        if (stmt.finalizer) {
                            result = this.maybeBlockSuffix(stmt.handler.body, result);
                        }
                    }
                }
            }
            if (stmt.finalizer) {
                result = join(result, ['finally', this.maybeBlock(stmt.finalizer, S_TFFF)]);
            }
            return result;
        },

        SwitchStatement: function (stmt, flags) {
            var result, fragment, i, iz, bodyFlags, that = this;
            withIndent(function () {
                result = [
                    'switch' + space + '(',
                    that.generateExpression(stmt.discriminant, Precedence.Sequence, E_TTT),
                    ')' + space + '{' + newline
                ];
            });
            if (stmt.cases) {
                bodyFlags = S_TFFF;
                for (i = 0, iz = stmt.cases.length; i < iz; ++i) {
                    if (i === iz - 1) {
                        bodyFlags |= F_SEMICOLON_OPT;
                    }
                    fragment = addIndent(this.generateStatement(stmt.cases[i], bodyFlags));
                    result.push(fragment);
                    if (!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())) {
                        result.push(newline);
                    }
                }
            }
            result.push(addIndent('}'));
            return result;
        },

        SwitchCase: function (stmt, flags) {
            var result, fragment, i, iz, bodyFlags, that = this;
            withIndent(function () {
                if (stmt.test) {
                    result = [
                        join('case', that.generateExpression(stmt.test, Precedence.Sequence, E_TTT)),
                        ':'
                    ];
                } else {
                    result = ['default:'];
                }

                i = 0;
                iz = stmt.consequent.length;
                if (iz && stmt.consequent[0].type === Syntax.BlockStatement) {
                    fragment = that.maybeBlock(stmt.consequent[0], S_TFFF);
                    result.push(fragment);
                    i = 1;
                }

                if (i !== iz && !endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                    result.push(newline);
                }

                bodyFlags = S_TFFF;
                for (; i < iz; ++i) {
                    if (i === iz - 1 && flags & F_SEMICOLON_OPT) {
                        bodyFlags |= F_SEMICOLON_OPT;
                    }
                    fragment = addIndent(that.generateStatement(stmt.consequent[i], bodyFlags));
                    result.push(fragment);
                    if (i + 1 !== iz && !endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())) {
                        result.push(newline);
                    }
                }
            });
            return result;
        },

        IfStatement: function (stmt, flags) {
            var result, bodyFlags, semicolonOptional, that = this;
            withIndent(function () {
                result = [
                    'if' + space + '(',
                    that.generateExpression(stmt.test, Precedence.Sequence, E_TTT),
                    ')'
                ];
            });
            semicolonOptional = flags & F_SEMICOLON_OPT;
            bodyFlags = S_TFFF;
            if (semicolonOptional) {
                bodyFlags |= F_SEMICOLON_OPT;
            }
            if (stmt.alternate) {
                result.push(this.maybeBlock(stmt.consequent, S_TFFF));
                result = this.maybeBlockSuffix(stmt.consequent, result);
                if (stmt.alternate.type === Syntax.IfStatement) {
                    result = join(result, ['else ', this.generateStatement(stmt.alternate, bodyFlags)]);
                } else {
                    result = join(result, join('else', this.maybeBlock(stmt.alternate, bodyFlags)));
                }
            } else {
                result.push(this.maybeBlock(stmt.consequent, bodyFlags));
            }
            return result;
        },

        ForStatement: function (stmt, flags) {
            var result, that = this;
            withIndent(function () {
                result = ['for' + space + '('];
                if (stmt.init) {
                    if (stmt.init.type === Syntax.VariableDeclaration) {
                        result.push(that.generateStatement(stmt.init, S_FFFF));
                    } else {
                        // F_ALLOW_IN becomes false.
                        result.push(that.generateExpression(stmt.init, Precedence.Sequence, E_FTT));
                        result.push(';');
                    }
                } else {
                    result.push(';');
                }

                if (stmt.test) {
                    result.push(space);
                    result.push(that.generateExpression(stmt.test, Precedence.Sequence, E_TTT));
                    result.push(';');
                } else {
                    result.push(';');
                }

                if (stmt.update) {
                    result.push(space);
                    result.push(that.generateExpression(stmt.update, Precedence.Sequence, E_TTT));
                    result.push(')');
                } else {
                    result.push(')');
                }
            });

            result.push(this.maybeBlock(stmt.body, flags & F_SEMICOLON_OPT ? S_TFFT : S_TFFF));
            return result;
        },

        ForInStatement: function (stmt, flags) {
            return this.generateIterationForStatement('in', stmt, flags & F_SEMICOLON_OPT ? S_TFFT : S_TFFF);
        },

        ForOfStatement: function (stmt, flags) {
            return this.generateIterationForStatement('of', stmt, flags & F_SEMICOLON_OPT ? S_TFFT : S_TFFF);
        },

        LabeledStatement: function (stmt, flags) {
            return [stmt.label.name + ':', this.maybeBlock(stmt.body, flags & F_SEMICOLON_OPT ? S_TFFT : S_TFFF)];
        },

        Program: function (stmt, flags) {
            var result, fragment, i, iz, bodyFlags;
            iz = stmt.body.length;
            result = [safeConcatenation && iz > 0 ? '\n' : ''];
            bodyFlags = S_TFTF;
            for (i = 0; i < iz; ++i) {
                if (!safeConcatenation && i === iz - 1) {
                    bodyFlags |= F_SEMICOLON_OPT;
                }

                if (preserveBlankLines) {
                    // handle spaces before the first line
                    if (i === 0) {
                        if (!stmt.body[0].leadingComments) {
                            generateBlankLines(stmt.range[0], stmt.body[i].range[0], result);
                        }
                    }

                    // handle spaces between lines
                    if (i > 0) {
                        if (!stmt.body[i - 1].trailingComments && !stmt.body[i].leadingComments) {
                            generateBlankLines(stmt.body[i - 1].range[1], stmt.body[i].range[0], result);
                        }
                    }
                }

                fragment = addIndent(this.generateStatement(stmt.body[i], bodyFlags));
                result.push(fragment);
                if (i + 1 < iz && !endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())) {
                    if (preserveBlankLines) {
                        if (!stmt.body[i + 1].leadingComments) {
                            result.push(newline);
                        }
                    } else {
                        result.push(newline);
                    }
                }

                if (preserveBlankLines) {
                    // handle spaces after the last line
                    if (i === iz - 1) {
                        if (!stmt.body[i].trailingComments) {
                            generateBlankLines(stmt.body[i].range[1], stmt.range[1], result);
                        }
                    }
                }
            }
            return result;
        },

        FunctionDeclaration: function (stmt, flags) {
            return [
                generateAsyncPrefix(stmt, true),
                'function',
                generateStarSuffix(stmt) || noEmptySpace(),
                stmt.id ? generateIdentifier(stmt.id) : '',
                this.generateFunctionBody(stmt)
            ];
        },

        ReturnStatement: function (stmt, flags) {
            if (stmt.argument) {
                return [join(
                    'return',
                    this.generateExpression(stmt.argument, Precedence.Sequence, E_TTT)
                ), this.semicolon(flags)];
            }
            return ['return' + this.semicolon(flags)];
        },

        WhileStatement: function (stmt, flags) {
            var result, that = this;
            withIndent(function () {
                result = [
                    'while' + space + '(',
                    that.generateExpression(stmt.test, Precedence.Sequence, E_TTT),
                    ')'
                ];
            });
            result.push(this.maybeBlock(stmt.body, flags & F_SEMICOLON_OPT ? S_TFFT : S_TFFF));
            return result;
        },

        WithStatement: function (stmt, flags) {
            var result, that = this;
            withIndent(function () {
                result = [
                    'with' + space + '(',
                    that.generateExpression(stmt.object, Precedence.Sequence, E_TTT),
                    ')'
                ];
            });
            result.push(this.maybeBlock(stmt.body, flags & F_SEMICOLON_OPT ? S_TFFT : S_TFFF));
            return result;
        }
    };

    merge(CodeGenerator.prototype, CodeGenerator.Statement);

    // Expressions.

    CodeGenerator.Expression = {

        SequenceExpression: function (expr, precedence, flags) {
            var result, i, iz;
            if (Precedence.Sequence < precedence) {
                flags |= F_ALLOW_IN;
            }
            result = [];
            for (i = 0, iz = expr.expressions.length; i < iz; ++i) {
                result.push(this.generateExpression(expr.expressions[i], Precedence.Assignment, flags));
                if (i + 1 < iz) {
                    result.push(',' + space);
                }
            }
            return parenthesize(result, Precedence.Sequence, precedence);
        },

        AssignmentExpression: function (expr, precedence, flags) {
            return this.generateAssignment(expr.left, expr.right, expr.operator, precedence, flags);
        },

        ArrowFunctionExpression: function (expr, precedence, flags) {
            return parenthesize(this.generateFunctionBody(expr), Precedence.ArrowFunction, precedence);
        },

        ConditionalExpression: function (expr, precedence, flags) {
            if (Precedence.Conditional < precedence) {
                flags |= F_ALLOW_IN;
            }
            return parenthesize(
                [
                    this.generateExpression(expr.test, Precedence.LogicalOR, flags),
                    space + '?' + space,
                    this.generateExpression(expr.consequent, Precedence.Assignment, flags),
                    space + ':' + space,
                    this.generateExpression(expr.alternate, Precedence.Assignment, flags)
                ],
                Precedence.Conditional,
                precedence
            );
        },

        LogicalExpression: function (expr, precedence, flags) {
            return this.BinaryExpression(expr, precedence, flags);
        },

        BinaryExpression: function (expr, precedence, flags) {
            var result, currentPrecedence, fragment, leftSource;
            currentPrecedence = BinaryPrecedence[expr.operator];

            if (currentPrecedence < precedence) {
                flags |= F_ALLOW_IN;
            }

            fragment = this.generateExpression(expr.left, currentPrecedence, flags);

            leftSource = fragment.toString();

            if (leftSource.charCodeAt(leftSource.length - 1) === 0x2F /* / */ && esutils.code.isIdentifierPartES5(expr.operator.charCodeAt(0))) {
                result = [fragment, noEmptySpace(), expr.operator];
            } else {
                result = join(fragment, expr.operator);
            }

            fragment = this.generateExpression(expr.right, currentPrecedence + 1, flags);

            if (expr.operator === '/' && fragment.toString().charAt(0) === '/' ||
            expr.operator.slice(-1) === '<' && fragment.toString().slice(0, 3) === '!--') {
                // If '/' concats with '/' or `<` concats with `!--`, it is interpreted as comment start
                result.push(noEmptySpace());
                result.push(fragment);
            } else {
                result = join(result, fragment);
            }

            if (expr.operator === 'in' && !(flags & F_ALLOW_IN)) {
                return ['(', result, ')'];
            }
            return parenthesize(result, currentPrecedence, precedence);
        },

        CallExpression: function (expr, precedence, flags) {
            var result, i, iz;
            // F_ALLOW_UNPARATH_NEW becomes false.
            result = [this.generateExpression(expr.callee, Precedence.Call, E_TTF)];
            result.push('(');
            for (i = 0, iz = expr['arguments'].length; i < iz; ++i) {
                result.push(this.generateExpression(expr['arguments'][i], Precedence.Assignment, E_TTT));
                if (i + 1 < iz) {
                    result.push(',' + space);
                }
            }
            result.push(')');

            if (!(flags & F_ALLOW_CALL)) {
                return ['(', result, ')'];
            }
            return parenthesize(result, Precedence.Call, precedence);
        },

        NewExpression: function (expr, precedence, flags) {
            var result, length, i, iz, itemFlags;
            length = expr['arguments'].length;

            // F_ALLOW_CALL becomes false.
            // F_ALLOW_UNPARATH_NEW may become false.
            itemFlags = (flags & F_ALLOW_UNPARATH_NEW && !parentheses && length === 0) ? E_TFT : E_TFF;

            result = join(
                'new',
                this.generateExpression(expr.callee, Precedence.New, itemFlags)
            );

            if (!(flags & F_ALLOW_UNPARATH_NEW) || parentheses || length > 0) {
                result.push('(');
                for (i = 0, iz = length; i < iz; ++i) {
                    result.push(this.generateExpression(expr['arguments'][i], Precedence.Assignment, E_TTT));
                    if (i + 1 < iz) {
                        result.push(',' + space);
                    }
                }
                result.push(')');
            }

            return parenthesize(result, Precedence.New, precedence);
        },

        MemberExpression: function (expr, precedence, flags) {
            var result, fragment;

            // F_ALLOW_UNPARATH_NEW becomes false.
            result = [this.generateExpression(expr.object, Precedence.Call, (flags & F_ALLOW_CALL) ? E_TTF : E_TFF)];

            if (expr.computed) {
                result.push('[');
                result.push(this.generateExpression(expr.property, Precedence.Sequence, flags & F_ALLOW_CALL ? E_TTT : E_TFT));
                result.push(']');
            } else {
                if (expr.object.type === Syntax.Literal && typeof expr.object.value === 'number') {
                    fragment = toSourceNodeWhenNeeded(result).toString();
                    // When the following conditions are all true,
                    //   1. No floating point
                    //   2. Don't have exponents
                    //   3. The last character is a decimal digit
                    //   4. Not hexadecimal OR octal number literal
                    // we should add a floating point.
                    if (
                            fragment.indexOf('.') < 0 &&
                            !/[eExX]/.test(fragment) &&
                            esutils.code.isDecimalDigit(fragment.charCodeAt(fragment.length - 1)) &&
                            !(fragment.length >= 2 && fragment.charCodeAt(0) === 48)  // '0'
                            ) {
                        result.push('.');
                    }
                }
                result.push('.');
                result.push(generateIdentifier(expr.property));
            }

            return parenthesize(result, Precedence.Member, precedence);
        },

        MetaProperty: function (expr, precedence, flags) {
            var result;
            result = [];
            result.push(expr.meta);
            result.push('.');
            result.push(expr.property);
            return parenthesize(result, Precedence.Member, precedence);
        },

        UnaryExpression: function (expr, precedence, flags) {
            var result, fragment, rightCharCode, leftSource, leftCharCode;
            fragment = this.generateExpression(expr.argument, Precedence.Unary, E_TTT);

            if (space === '') {
                result = join(expr.operator, fragment);
            } else {
                result = [expr.operator];
                if (expr.operator.length > 2) {
                    // delete, void, typeof
                    // get `typeof []`, not `typeof[]`
                    result = join(result, fragment);
                } else {
                    // Prevent inserting spaces between operator and argument if it is unnecessary
                    // like, `!cond`
                    leftSource = toSourceNodeWhenNeeded(result).toString();
                    leftCharCode = leftSource.charCodeAt(leftSource.length - 1);
                    rightCharCode = fragment.toString().charCodeAt(0);

                    if (((leftCharCode === 0x2B  /* + */ || leftCharCode === 0x2D  /* - */) && leftCharCode === rightCharCode) ||
                            (esutils.code.isIdentifierPartES5(leftCharCode) && esutils.code.isIdentifierPartES5(rightCharCode))) {
                        result.push(noEmptySpace());
                        result.push(fragment);
                    } else {
                        result.push(fragment);
                    }
                }
            }
            return parenthesize(result, Precedence.Unary, precedence);
        },

        YieldExpression: function (expr, precedence, flags) {
            var result;
            if (expr.delegate) {
                result = 'yield*';
            } else {
                result = 'yield';
            }
            if (expr.argument) {
                result = join(
                    result,
                    this.generateExpression(expr.argument, Precedence.Yield, E_TTT)
                );
            }
            return parenthesize(result, Precedence.Yield, precedence);
        },

        AwaitExpression: function (expr, precedence, flags) {
            var result = join(
                expr.all ? 'await*' : 'await',
                this.generateExpression(expr.argument, Precedence.Await, E_TTT)
            );
            return parenthesize(result, Precedence.Await, precedence);
        },

        UpdateExpression: function (expr, precedence, flags) {
            if (expr.prefix) {
                return parenthesize(
                    [
                        expr.operator,
                        this.generateExpression(expr.argument, Precedence.Unary, E_TTT)
                    ],
                    Precedence.Unary,
                    precedence
                );
            }
            return parenthesize(
                [
                    this.generateExpression(expr.argument, Precedence.Postfix, E_TTT),
                    expr.operator
                ],
                Precedence.Postfix,
                precedence
            );
        },

        FunctionExpression: function (expr, precedence, flags) {
            var result = [
                generateAsyncPrefix(expr, true),
                'function'
            ];
            if (expr.id) {
                result.push(generateStarSuffix(expr) || noEmptySpace());
                result.push(generateIdentifier(expr.id));
            } else {
                result.push(generateStarSuffix(expr) || space);
            }
            result.push(this.generateFunctionBody(expr));
            return result;
        },

        ArrayPattern: function (expr, precedence, flags) {
            return this.ArrayExpression(expr, precedence, flags, true);
        },

        ArrayExpression: function (expr, precedence, flags, isPattern) {
            var result, multiline, that = this;
            if (!expr.elements.length) {
                return '[]';
            }
            multiline = isPattern ? false : expr.elements.length > 1;
            result = ['[', multiline ? newline : ''];
            withIndent(function (indent) {
                var i, iz;
                for (i = 0, iz = expr.elements.length; i < iz; ++i) {
                    if (!expr.elements[i]) {
                        if (multiline) {
                            result.push(indent);
                        }
                        if (i + 1 === iz) {
                            result.push(',');
                        }
                    } else {
                        result.push(multiline ? indent : '');
                        result.push(that.generateExpression(expr.elements[i], Precedence.Assignment, E_TTT));
                    }
                    if (i + 1 < iz) {
                        result.push(',' + (multiline ? newline : space));
                    }
                }
            });
            if (multiline && !endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                result.push(newline);
            }
            result.push(multiline ? base : '');
            result.push(']');
            return result;
        },

        RestElement: function(expr, precedence, flags) {
            return '...' + this.generatePattern(expr.argument);
        },

        ClassExpression: function (expr, precedence, flags) {
            var result, fragment;
            result = ['class'];
            if (expr.id) {
                result = join(result, this.generateExpression(expr.id, Precedence.Sequence, E_TTT));
            }
            if (expr.superClass) {
                fragment = join('extends', this.generateExpression(expr.superClass, Precedence.Assignment, E_TTT));
                result = join(result, fragment);
            }
            result.push(space);
            result.push(this.generateStatement(expr.body, S_TFFT));
            return result;
        },

        MethodDefinition: function (expr, precedence, flags) {
            var result, fragment;
            if (expr['static']) {
                result = ['static' + space];
            } else {
                result = [];
            }
            if (expr.kind === 'get' || expr.kind === 'set') {
                fragment = [
                    join(expr.kind, this.generatePropertyKey(expr.key, expr.computed, expr.value)),
                    this.generateFunctionBody(expr.value)
                ];
            } else {
                fragment = [
                    generateMethodPrefix(expr),
                    this.generatePropertyKey(expr.key, expr.computed, expr.value),
                    this.generateFunctionBody(expr.value)
                ];
            }
            return join(result, fragment);
        },

        Property: function (expr, precedence, flags) {
            if (expr.kind === 'get' || expr.kind === 'set') {
                return [
                    expr.kind, noEmptySpace(),
                    this.generatePropertyKey(expr.key, expr.computed, expr.value),
                    this.generateFunctionBody(expr.value)
                ];
            }

            if (expr.shorthand) {
                return this.generatePropertyKey(expr.key, expr.computed, expr.value);
            }

            if (expr.method) {
                return [
                    generateMethodPrefix(expr),
                    this.generatePropertyKey(expr.key, expr.computed, expr.value),
                    this.generateFunctionBody(expr.value)
                ];
            }

            return [
                this.generatePropertyKey(expr.key, expr.computed, expr.value),
                ':' + space,
                this.generateExpression(expr.value, Precedence.Assignment, E_TTT)
            ];
        },

        ObjectExpression: function (expr, precedence, flags) {
            var multiline, result, fragment, that = this;

            if (!expr.properties.length) {
                return '{}';
            }
            multiline = expr.properties.length > 1;

            withIndent(function () {
                fragment = that.generateExpression(expr.properties[0], Precedence.Sequence, E_TTT);
            });

            if (!multiline) {
                // issues 4
                // Do not transform from
                //   dejavu.Class.declare({
                //       method2: function () {}
                //   });
                // to
                //   dejavu.Class.declare({method2: function () {
                //       }});
                if (!hasLineTerminator(toSourceNodeWhenNeeded(fragment).toString())) {
                    return [ '{', space, fragment, space, '}' ];
                }
            }

            withIndent(function (indent) {
                var i, iz;
                result = [ '{', newline, indent, fragment ];

                if (multiline) {
                    result.push(',' + newline);
                    for (i = 1, iz = expr.properties.length; i < iz; ++i) {
                        result.push(indent);
                        result.push(that.generateExpression(expr.properties[i], Precedence.Sequence, E_TTT));
                        if (i + 1 < iz) {
                            result.push(',' + newline);
                        }
                    }
                }
            });

            if (!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                result.push(newline);
            }
            result.push(base);
            result.push('}');
            return result;
        },

        AssignmentPattern: function(expr, precedence, flags) {
            return this.generateAssignment(expr.left, expr.right, '=', precedence, flags);
        },

        ObjectPattern: function (expr, precedence, flags) {
            var result, i, iz, multiline, property, that = this;
            if (!expr.properties.length) {
                return '{}';
            }

            multiline = false;
            if (expr.properties.length === 1) {
                property = expr.properties[0];
                if (property.value.type !== Syntax.Identifier) {
                    multiline = true;
                }
            } else {
                for (i = 0, iz = expr.properties.length; i < iz; ++i) {
                    property = expr.properties[i];
                    if (!property.shorthand) {
                        multiline = true;
                        break;
                    }
                }
            }
            result = ['{', multiline ? newline : '' ];

            withIndent(function (indent) {
                var i, iz;
                for (i = 0, iz = expr.properties.length; i < iz; ++i) {
                    result.push(multiline ? indent : '');
                    result.push(that.generateExpression(expr.properties[i], Precedence.Sequence, E_TTT));
                    if (i + 1 < iz) {
                        result.push(',' + (multiline ? newline : space));
                    }
                }
            });

            if (multiline && !endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())) {
                result.push(newline);
            }
            result.push(multiline ? base : '');
            result.push('}');
            return result;
        },

        ThisExpression: function (expr, precedence, flags) {
            return 'this';
        },

        Super: function (expr, precedence, flags) {
            return 'super';
        },

        Identifier: function (expr, precedence, flags) {
            return generateIdentifier(expr);
        },

        ImportDefaultSpecifier: function (expr, precedence, flags) {
            return generateIdentifier(expr.id || expr.local);
        },

        ImportNamespaceSpecifier: function (expr, precedence, flags) {
            var result = ['*'];
            var id = expr.id || expr.local;
            if (id) {
                result.push(space + 'as' + noEmptySpace() + generateIdentifier(id));
            }
            return result;
        },

        ImportSpecifier: function (expr, precedence, flags) {
            var imported = expr.imported;
            var result = [ imported.name ];
            var local = expr.local;
            if (local && local.name !== imported.name) {
                result.push(noEmptySpace() + 'as' + noEmptySpace() + generateIdentifier(local));
            }
            return result;
        },

        ExportSpecifier: function (expr, precedence, flags) {
            var local = expr.local;
            var result = [ local.name ];
            var exported = expr.exported;
            if (exported && exported.name !== local.name) {
                result.push(noEmptySpace() + 'as' + noEmptySpace() + generateIdentifier(exported));
            }
            return result;
        },

        Literal: function (expr, precedence, flags) {
            var raw;
            if (expr.hasOwnProperty('raw') && parse && extra.raw) {
                try {
                    raw = parse(expr.raw).body[0].expression;
                    if (raw.type === Syntax.Literal) {
                        if (raw.value === expr.value) {
                            return expr.raw;
                        }
                    }
                } catch (e) {
                    // not use raw property
                }
            }

            if (expr.value === null) {
                return 'null';
            }

            if (typeof expr.value === 'string') {
                return escapeString(expr.value);
            }

            if (typeof expr.value === 'number') {
                return generateNumber(expr.value);
            }

            if (typeof expr.value === 'boolean') {
                return expr.value ? 'true' : 'false';
            }

            return generateRegExp(expr.value);
        },

        GeneratorExpression: function (expr, precedence, flags) {
            return this.ComprehensionExpression(expr, precedence, flags);
        },

        ComprehensionExpression: function (expr, precedence, flags) {
            // GeneratorExpression should be parenthesized with (...), ComprehensionExpression with [...]
            // Due to https://bugzilla.mozilla.org/show_bug.cgi?id=883468 position of expr.body can differ in Spidermonkey and ES6

            var result, i, iz, fragment, that = this;
            result = (expr.type === Syntax.GeneratorExpression) ? ['('] : ['['];

            if (extra.moz.comprehensionExpressionStartsWithAssignment) {
                fragment = this.generateExpression(expr.body, Precedence.Assignment, E_TTT);
                result.push(fragment);
            }

            if (expr.blocks) {
                withIndent(function () {
                    for (i = 0, iz = expr.blocks.length; i < iz; ++i) {
                        fragment = that.generateExpression(expr.blocks[i], Precedence.Sequence, E_TTT);
                        if (i > 0 || extra.moz.comprehensionExpressionStartsWithAssignment) {
                            result = join(result, fragment);
                        } else {
                            result.push(fragment);
                        }
                    }
                });
            }

            if (expr.filter) {
                result = join(result, 'if' + space);
                fragment = this.generateExpression(expr.filter, Precedence.Sequence, E_TTT);
                result = join(result, [ '(', fragment, ')' ]);
            }

            if (!extra.moz.comprehensionExpressionStartsWithAssignment) {
                fragment = this.generateExpression(expr.body, Precedence.Assignment, E_TTT);

                result = join(result, fragment);
            }

            result.push((expr.type === Syntax.GeneratorExpression) ? ')' : ']');
            return result;
        },

        ComprehensionBlock: function (expr, precedence, flags) {
            var fragment;
            if (expr.left.type === Syntax.VariableDeclaration) {
                fragment = [
                    expr.left.kind, noEmptySpace(),
                    this.generateStatement(expr.left.declarations[0], S_FFFF)
                ];
            } else {
                fragment = this.generateExpression(expr.left, Precedence.Call, E_TTT);
            }

            fragment = join(fragment, expr.of ? 'of' : 'in');
            fragment = join(fragment, this.generateExpression(expr.right, Precedence.Sequence, E_TTT));

            return [ 'for' + space + '(', fragment, ')' ];
        },

        SpreadElement: function (expr, precedence, flags) {
            return [
                '...',
                this.generateExpression(expr.argument, Precedence.Assignment, E_TTT)
            ];
        },

        TaggedTemplateExpression: function (expr, precedence, flags) {
            var itemFlags = E_TTF;
            if (!(flags & F_ALLOW_CALL)) {
                itemFlags = E_TFF;
            }
            var result = [
                this.generateExpression(expr.tag, Precedence.Call, itemFlags),
                this.generateExpression(expr.quasi, Precedence.Primary, E_FFT)
            ];
            return parenthesize(result, Precedence.TaggedTemplate, precedence);
        },

        TemplateElement: function (expr, precedence, flags) {
            // Don't use "cooked". Since tagged template can use raw template
            // representation. So if we do so, it breaks the script semantics.
            return expr.value.raw;
        },

        TemplateLiteral: function (expr, precedence, flags) {
            var result, i, iz;
            result = [ '`' ];
            for (i = 0, iz = expr.quasis.length; i < iz; ++i) {
                result.push(this.generateExpression(expr.quasis[i], Precedence.Primary, E_TTT));
                if (i + 1 < iz) {
                    result.push('${' + space);
                    result.push(this.generateExpression(expr.expressions[i], Precedence.Sequence, E_TTT));
                    result.push(space + '}');
                }
            }
            result.push('`');
            return result;
        },

        ModuleSpecifier: function (expr, precedence, flags) {
            return this.Literal(expr, precedence, flags);
        }
    };

    merge(CodeGenerator.prototype, CodeGenerator.Expression);

    CodeGenerator.prototype.generateExpression = function (expr, precedence, flags) {
        var result, type;

        type = expr.type || Syntax.Property;

        if (extra.verbatim && expr.hasOwnProperty(extra.verbatim)) {
            return generateVerbatim(expr, precedence);
        }

        result = this[type](expr, precedence, flags);

        if (extra.comment) {
            result = addComments(expr, result);
        }
        return toSourceNodeWhenNeeded(result, expr);
    };

    CodeGenerator.prototype.generateStatement = function (stmt, flags) {
        var result,
            fragment;

        result = this[stmt.type](stmt, flags);

        // Attach comments

        if (extra.comment) {
            result = addComments(stmt, result);
        }

        fragment = toSourceNodeWhenNeeded(result).toString();
        if (stmt.type === Syntax.Program && !safeConcatenation && newline === '' &&  fragment.charAt(fragment.length - 1) === '\n') {
            result = sourceMap ? toSourceNodeWhenNeeded(result).replaceRight(/\s+$/, '') : fragment.replace(/\s+$/, '');
        }

        return toSourceNodeWhenNeeded(result, stmt);
    };

    function generateInternal(node) {
        var codegen;

        codegen = new CodeGenerator();
        if (isStatement(node)) {
            return codegen.generateStatement(node, S_TFFF);
        }

        if (isExpression(node)) {
            return codegen.generateExpression(node, Precedence.Sequence, E_TTT);
        }

        throw new Error('Unknown node type: ' + node.type);
    }

    function generate(node, options) {
        var defaultOptions = getDefaultOptions(), result, pair;

        if (options != null) {
            // Obsolete options
            //
            //   `options.indent`
            //   `options.base`
            //
            // Instead of them, we can use `option.format.indent`.
            if (typeof options.indent === 'string') {
                defaultOptions.format.indent.style = options.indent;
            }
            if (typeof options.base === 'number') {
                defaultOptions.format.indent.base = options.base;
            }
            options = updateDeeply(defaultOptions, options);
            indent = options.format.indent.style;
            if (typeof options.base === 'string') {
                base = options.base;
            } else {
                base = stringRepeat(indent, options.format.indent.base);
            }
        } else {
            options = defaultOptions;
            indent = options.format.indent.style;
            base = stringRepeat(indent, options.format.indent.base);
        }
        json = options.format.json;
        renumber = options.format.renumber;
        hexadecimal = json ? false : options.format.hexadecimal;
        quotes = json ? 'double' : options.format.quotes;
        escapeless = options.format.escapeless;
        newline = options.format.newline;
        space = options.format.space;
        if (options.format.compact) {
            newline = space = indent = base = '';
        }
        parentheses = options.format.parentheses;
        semicolons = options.format.semicolons;
        safeConcatenation = options.format.safeConcatenation;
        directive = options.directive;
        parse = json ? null : options.parse;
        sourceMap = options.sourceMap;
        sourceCode = options.sourceCode;
        preserveBlankLines = options.format.preserveBlankLines && sourceCode !== null;
        extra = options;

        if (sourceMap) {
            if (!exports.browser) {
                // We assume environment is node.js
                // And prevent from including source-map by browserify
                SourceNode = require('source-map').SourceNode;
            } else {
                SourceNode = global.sourceMap.SourceNode;
            }
        }

        result = generateInternal(node);

        if (!sourceMap) {
            pair = {code: result.toString(), map: null};
            return options.sourceMapWithCode ? pair : pair.code;
        }

        pair = result.toStringWithSourceMap({
            file: options.file,
            sourceRoot: options.sourceMapRoot
        });

        if (options.sourceContent) {
            pair.map.setSourceContent(options.sourceMap,
                                      options.sourceContent);
        }

        if (options.sourceMapWithCode) {
            return pair;
        }

        return pair.map.toString();
    }

    FORMAT_MINIFY = {
        indent: {
            style: '',
            base: 0
        },
        renumber: true,
        hexadecimal: true,
        quotes: 'auto',
        escapeless: true,
        compact: true,
        parentheses: false,
        semicolons: false
    };

    FORMAT_DEFAULTS = getDefaultOptions().format;

    exports.version = require('./package.json').version;
    exports.generate = generate;
    exports.attachComments = estraverse.attachComments;
    exports.Precedence = updateDeeply({}, Precedence);
    exports.browser = false;
    exports.FORMAT_MINIFY = FORMAT_MINIFY;
    exports.FORMAT_DEFAULTS = FORMAT_DEFAULTS;
}());
/* vim: set sw=4 ts=4 et tw=80 : */
}());
/* jslint ignore:end */



/*
file https://github.com/components/handlebars.js/blob/v1.2.1/handlebars.js
*/
/* validateLineSortedReset */
local.handlebars = {};
local.handlebars.compile = function (template) {
/*
 * this function will return a function
 * that will render <template> with given <dict>
 */
    return function (dict) {
        var result;
        result = template;
        // render triple-curly-brace
        result = result.replace((
            /\{\{\{/g
        ), "{{").replace((
            /\}\}\}/g
        ), "}}");
        // render with-statement
        result = result.replace((
            /\{\{#with\u0020(.+?)\}\}([\S\s]+?)\{\{\/with\}\}/g
        ), function (ignore, match1, match2) {
            return local.handlebars.replace(match2, dict, match1 + ".");
        });
        // render helper
        result = result.replace(
            "{{#show_ignores metrics}}{{/show_ignores}}",
            function () {
                return local.handlebars.show_ignores(dict.metrics);
            }
        );
        result = result.replace((
            "{{#show_line_execution_counts fileCoverage}}"
            + "{{maxLines}}{{/show_line_execution_counts}}"
        ), function () {
            return local.handlebars.show_line_execution_counts(
                dict.fileCoverage,
                {
                    fn: function () {
                        return dict.maxLines;
                    }
                }
            );
        });
        result = result.replace(
            "{{#show_lines}}{{maxLines}}{{/show_lines}}",
            function () {
                return local.handlebars.show_lines({
                    fn: function () {
                        return dict.maxLines;
                    }
                });
            }
        );
        result = result.replace(
            "{{#show_picture}}{{metrics.statements.pct}}{{/show_picture}}",
            function () {
                return local.handlebars.show_picture({
                    fn: function () {
                        return dict.metrics.statements.pct;
                    }
                });
            }
        );
        result = local.handlebars.replace(result, dict, "");
        // show code last
        result = result.replace(
            "{{#show_code structured}}{{/show_code}}",
            function () {
                return local.handlebars.show_code(dict.structured);
            }
        );
        return result;
    };
};

local.handlebars.registerHelper = function (key, helper) {
/*
 * this function will register the helper-function
 */
    local.handlebars[key] = function (aa, bb) {
        try {
            return helper(aa, bb);
        } catch (ignore) {}
    };
};

local.handlebars.replace = function (template, dict, withPrefix) {
/*
 * this function will render <template> with given <dict>
 */
    var value;
    // search for keys in the template
    return template.replace((
        /\{\{.+?\}\}/g
    ), function (match0) {
        value = dict;
        // iteratively lookup nested values in the dict
        (withPrefix + match0.slice(2, -2)).split(".").forEach(function (key) {
            value = value && value[key];
        });
        return (
            value === undefined
            ? match0
            : String(value)
        );
    });
};

/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/collector.js
*/
/* validateLineSortedReset */
local.collector = {
    fileCoverageFor: function (file) {
        return globalThis.__coverage__[file];
    },
    files: function () {
        return Object.keys(globalThis.__coverage__).filter(function (key) {
            if (
                globalThis.__coverage__[key]
                && globalThis.__coverageCodeDict__[key]
            ) {
                // reset derived info
                globalThis.__coverage__[key].l = null;
                return true;
            }
        });
    }
};



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/util/insertion-text.js
*/
/* istanbul ignore next */
/* jslint ignore:start */
(function () { var module; module = {};
/*
 Copyright (c) 2012, Yahoo! Inc.  All rights reserved.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */

function InsertionText(text, consumeBlanks) {
    this.text = text;
    this.origLength = text.length;
    this.offsets = [];
    this.consumeBlanks = consumeBlanks;
    this.startPos = this.findFirstNonBlank();
    this.endPos = this.findLastNonBlank();
}

var WHITE_RE = /[ \f\n\r\t\v\u00A0\u2028\u2029]/;

InsertionText.prototype = {

    findFirstNonBlank: function () {
        var pos = -1,
            text = this.text,
            len = text.length,
            i;
        for (i = 0; i < len; i += 1) {
            if (!text.charAt(i).match(WHITE_RE)) {
                pos = i;
                break;
            }
        }
        return pos;
    },
    findLastNonBlank: function () {
        var text = this.text,
            len = text.length,
            pos = text.length + 1,
            i;
        for (i = len - 1; i >= 0; i -= 1) {
            if (!text.charAt(i).match(WHITE_RE)) {
                pos = i;
                break;
            }
        }
        return pos;
    },
    originalLength: function () {
        return this.origLength;
    },

    insertAt: function (col, str, insertBefore, consumeBlanks) {
        consumeBlanks = typeof consumeBlanks === 'undefined' ? this.consumeBlanks : consumeBlanks;
        col = col > this.originalLength() ? this.originalLength() : col;
        col = col < 0 ? 0 : col;

        if (consumeBlanks) {
            if (col <= this.startPos) {
                col = 0;
            }
            if (col > this.endPos) {
                col = this.origLength;
            }
        }

        var len = str.length,
            offset = this.findOffset(col, len, insertBefore),
            realPos = col + offset,
            text = this.text;
        this.text = text.substring(0, realPos) + str + text.substring(realPos);
        return this;
    },

    findOffset: function (pos, len, insertBefore) {
        var offsets = this.offsets,
            offsetObj,
            cumulativeOffset = 0,
            i;

        for (i = 0; i < offsets.length; i += 1) {
            offsetObj = offsets[i];
            if (offsetObj.pos < pos || (offsetObj.pos === pos && !insertBefore)) {
                cumulativeOffset += offsetObj.len;
            }
            if (offsetObj.pos >= pos) {
                break;
            }
        }
        if (offsetObj && offsetObj.pos === pos) {
            offsetObj.len += len;
        } else {
            offsets.splice(i, 0, { pos: pos, len: len });
        }
        return cumulativeOffset;
    },

    wrap: function (startPos, startText, endPos, endText, consumeBlanks) {
        this.insertAt(startPos, startText, true, consumeBlanks);
        this.insertAt(endPos, endText, false, consumeBlanks);
        return this;
    },

    wrapLine: function (startText, endText) {
        this.wrap(0, startText, this.originalLength(), endText);
    },

    toString: function () {
        return this.text;
    }
};

module.exports = InsertionText;
local["../util/insertion-text"] = module.exports; }());



/*
file https://github.com/gotwarlost/istanbul/blob/v0.4.5/lib/instrumenter.js
*/
/* istanbul ignore next */
(function () { var escodegen, esprima, module, window; escodegen = local.escodegen; esprima = local.esprima; module = undefined; window = local;
/*
 Copyright (c) 2012, Yahoo! Inc.  All rights reserved.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */

/*global esprima, escodegen, window */
(function (isNode) {
    "use strict";
    var SYNTAX,
        nodeType,
        ESP = isNode ? require('esprima') : esprima,
        ESPGEN = isNode ? require('escodegen') : escodegen,  //TODO - package as dependency
        crypto = isNode ? require('crypto') : null,
        LEADER_WRAP = '(function () { ',
        TRAILER_WRAP = '\n}());',
        COMMENT_RE = /^\s*istanbul\s+ignore\s+(if|else|next)(?=\W|$)/,
        astgen,
        preconditions,
        cond,
        isArray = Array.isArray;

    /* istanbul ignore if: untestable */
    if (!isArray) {
        isArray = function (thing) { return thing &&  Object.prototype.toString.call(thing) === '[object Array]'; };
    }

    if (!isNode) {
        preconditions = {
            'Could not find esprima': ESP,
            'Could not find escodegen': ESPGEN,
            'JSON object not in scope': JSON,
            'Array does not implement push': [].push,
            'Array does not implement unshift': [].unshift
        };
        /* istanbul ignore next: untestable */
        for (cond in preconditions) {
            if (preconditions.hasOwnProperty(cond)) {
                if (!preconditions[cond]) { throw new Error(cond); }
            }
        }
    }

    function generateTrackerVar(filename, omitSuffix) {
        var hash, suffix;
        if (crypto !== null) {
            hash = crypto.createHash('md5');
            hash.update(filename);
            suffix = hash.digest('base64');
            //trim trailing equal signs, turn identifier unsafe chars to safe ones + => _ and / => $
            suffix = suffix.replace(new RegExp('=', 'g'), '')
                .replace(new RegExp('\\+', 'g'), '_')
                .replace(new RegExp('/', 'g'), '$');
        } else {
            window.__cov_seq = window.__cov_seq || 0;
            window.__cov_seq += 1;
            suffix = window.__cov_seq;
        }
        // coverage-hack - pseudorandom coverage-identifier
        return '__cov_' + Math.random().toString(16).slice(2);
    }

    function pushAll(ary, thing) {
        if (!isArray(thing)) {
            thing = [ thing ];
        }
        Array.prototype.push.apply(ary, thing);
    }

    SYNTAX = {
        // keep in sync with estraverse's VisitorKeys
        AssignmentExpression: ['left', 'right'],
        AssignmentPattern: ['left', 'right'],
        ArrayExpression: ['elements'],
        ArrayPattern: ['elements'],
        ArrowFunctionExpression: ['params', 'body'],
        AwaitExpression: ['argument'], // CAUTION: It's deferred to ES7.
        BlockStatement: ['body'],
        BinaryExpression: ['left', 'right'],
        BreakStatement: ['label'],
        CallExpression: ['callee', 'arguments'],
        CatchClause: ['param', 'body'],
        ClassBody: ['body'],
        ClassDeclaration: ['id', 'superClass', 'body'],
        ClassExpression: ['id', 'superClass', 'body'],
        ComprehensionBlock: ['left', 'right'],  // CAUTION: It's deferred to ES7.
        ComprehensionExpression: ['blocks', 'filter', 'body'],  // CAUTION: It's deferred to ES7.
        ConditionalExpression: ['test', 'consequent', 'alternate'],
        ContinueStatement: ['label'],
        DebuggerStatement: [],
        DirectiveStatement: [],
        DoWhileStatement: ['body', 'test'],
        EmptyStatement: [],
        ExportAllDeclaration: ['source'],
        ExportDefaultDeclaration: ['declaration'],
        ExportNamedDeclaration: ['declaration', 'specifiers', 'source'],
        ExportSpecifier: ['exported', 'local'],
        ExpressionStatement: ['expression'],
        ForStatement: ['init', 'test', 'update', 'body'],
        ForInStatement: ['left', 'right', 'body'],
        ForOfStatement: ['left', 'right', 'body'],
        FunctionDeclaration: ['id', 'params', 'body'],
        FunctionExpression: ['id', 'params', 'body'],
        GeneratorExpression: ['blocks', 'filter', 'body'],  // CAUTION: It's deferred to ES7.
        Identifier: [],
        IfStatement: ['test', 'consequent', 'alternate'],
        ImportDeclaration: ['specifiers', 'source'],
        ImportDefaultSpecifier: ['local'],
        ImportNamespaceSpecifier: ['local'],
        ImportSpecifier: ['imported', 'local'],
        Literal: [],
        LabeledStatement: ['label', 'body'],
        LogicalExpression: ['left', 'right'],
        MetaProperty: ['meta', 'property'],
        MemberExpression: ['object', 'property'],
        MethodDefinition: ['key', 'value'],
        ModuleSpecifier: [],
        NewExpression: ['callee', 'arguments'],
        ObjectExpression: ['properties'],
        ObjectPattern: ['properties'],
        Program: ['body'],
        Property: ['key', 'value'],
        RestElement: [ 'argument' ],
        ReturnStatement: ['argument'],
        SequenceExpression: ['expressions'],
        SpreadElement: ['argument'],
        Super: [],
        SwitchStatement: ['discriminant', 'cases'],
        SwitchCase: ['test', 'consequent'],
        TaggedTemplateExpression: ['tag', 'quasi'],
        TemplateElement: [],
        TemplateLiteral: ['quasis', 'expressions'],
        ThisExpression: [],
        ThrowStatement: ['argument'],
        TryStatement: ['block', 'handler', 'finalizer'],
        UnaryExpression: ['argument'],
        UpdateExpression: ['argument'],
        VariableDeclaration: ['declarations'],
        VariableDeclarator: ['id', 'init'],
        WhileStatement: ['test', 'body'],
        WithStatement: ['object', 'body'],
        YieldExpression: ['argument']
    };

    for (nodeType in SYNTAX) {
        /* istanbul ignore else: has own property */
        if (SYNTAX.hasOwnProperty(nodeType)) {
            SYNTAX[nodeType] = { name: nodeType, children: SYNTAX[nodeType] };
        }
    }

    astgen = {
        variable: function (name) { return { type: SYNTAX.Identifier.name, name: name }; },
        stringLiteral: function (str) { return { type: SYNTAX.Literal.name, value: String(str) }; },
        numericLiteral: function (num) { return { type: SYNTAX.Literal.name, value: Number(num) }; },
        statement: function (contents) { return { type: SYNTAX.ExpressionStatement.name, expression: contents }; },
        dot: function (obj, field) { return { type: SYNTAX.MemberExpression.name, computed: false, object: obj, property: field }; },
        subscript: function (obj, sub) { return { type: SYNTAX.MemberExpression.name, computed: true, object: obj, property: sub }; },
        postIncrement: function (obj) { return { type: SYNTAX.UpdateExpression.name, operator: '++', prefix: false, argument: obj }; },
        sequence: function (one, two) { return { type: SYNTAX.SequenceExpression.name, expressions: [one, two] }; },
        returnStatement: function (expr) { return { type: SYNTAX.ReturnStatement.name, argument: expr }; }
    };

    function Walker(walkMap, preprocessor, scope, debug) {
        this.walkMap = walkMap;
        this.preprocessor = preprocessor;
        this.scope = scope;
        this.debug = debug;
        if (this.debug) {
            this.level = 0;
            this.seq = true;
        }
    }

    function defaultWalker(node, walker) {

        var type = node.type,
            preprocessor,
            postprocessor,
            children = SYNTAX[type],
            // don't run generated nodes thru custom walks otherwise we will attempt to instrument the instrumentation code :)
            applyCustomWalker = !!node.loc || node.type === SYNTAX.Program.name,
            walkerFn = applyCustomWalker ? walker.walkMap[type] : null,
            i,
            j,
            walkFnIndex,
            childType,
            childNode,
            ret,
            childArray,
            childElement,
            pathElement,
            assignNode,
            isLast;

        if (!SYNTAX[type]) {
            console.error(node);
            console.error('Unsupported node type:' + type);
            return;
        }
        children = SYNTAX[type].children;
        /* istanbul ignore if: guard */
        if (node.walking) { throw new Error('Infinite regress: Custom walkers may NOT call walker.apply(node)'); }
        node.walking = true;

        ret = walker.apply(node, walker.preprocessor);

        preprocessor = ret.preprocessor;
        if (preprocessor) {
            delete ret.preprocessor;
            ret = walker.apply(node, preprocessor);
        }

        if (isArray(walkerFn)) {
            for (walkFnIndex = 0; walkFnIndex < walkerFn.length; walkFnIndex += 1) {
                isLast = walkFnIndex === walkerFn.length - 1;
                ret = walker.apply(ret, walkerFn[walkFnIndex]);
                /*istanbul ignore next: paranoid check */
                if (ret.type !== type && !isLast) {
                    throw new Error('Only the last walker is allowed to change the node type: [type was: ' + type + ' ]');
                }
            }
        } else {
            if (walkerFn) {
                ret = walker.apply(node, walkerFn);
            }
        }

        if (node.skipSelf) {
            return;
        }

        for (i = 0; i < children.length; i += 1) {
            childType = children[i];
            childNode = node[childType];
            if (childNode && !childNode.skipWalk) {
                pathElement = { node: node, property: childType };
                if (isArray(childNode)) {
                    childArray = [];
                    for (j = 0; j < childNode.length; j += 1) {
                        childElement = childNode[j];
                        pathElement.index = j;
                        if (childElement) {
                          assignNode = walker.apply(childElement, null, pathElement);
                          if (isArray(assignNode.prepend)) {
                              pushAll(childArray, assignNode.prepend);
                              delete assignNode.prepend;
                          }
                        } else {
                            assignNode = undefined;
                        }
                        pushAll(childArray, assignNode);
                    }
                    node[childType] = childArray;
                } else {
                    assignNode = walker.apply(childNode, null, pathElement);
                    /*istanbul ignore if: paranoid check */
                    if (isArray(assignNode.prepend)) {
                        throw new Error('Internal error: attempt to prepend statements in disallowed (non-array) context');
                        /* if this should be allowed, this is how to solve it
                        tmpNode = { type: 'BlockStatement', body: [] };
                        pushAll(tmpNode.body, assignNode.prepend);
                        pushAll(tmpNode.body, assignNode);
                        node[childType] = tmpNode;
                        delete assignNode.prepend;
                        */
                    } else {
                        node[childType] = assignNode;
                    }
                }
            }
        }

        postprocessor = ret.postprocessor;
        if (postprocessor) {
            delete ret.postprocessor;
            ret = walker.apply(ret, postprocessor);
        }

        delete node.walking;

        return ret;
    }

    Walker.prototype = {
        startWalk: function (node) {
            this.path = [];
            this.apply(node);
        },

        apply: function (node, walkFn, pathElement) {
            var ret, i, seq, prefix;

            walkFn = walkFn || defaultWalker;
            if (this.debug) {
                this.seq += 1;
                this.level += 1;
                seq = this.seq;
                prefix = '';
                for (i = 0; i < this.level; i += 1) { prefix += '    '; }
                console.log(prefix + 'Enter (' + seq + '):' + node.type);
            }
            if (pathElement) { this.path.push(pathElement); }
            ret = walkFn.call(this.scope, node, this);
            if (pathElement) { this.path.pop(); }
            if (this.debug) {
                this.level -= 1;
                console.log(prefix + 'Return (' + seq + '):' + node.type);
            }
            return ret || node;
        },

        startLineForNode: function (node) {
            return node && node.loc && node.loc.start ? node.loc.start.line : /* istanbul ignore next: guard */ null;
        },

        ancestor: function (n) {
            return this.path.length > n - 1 ? this.path[this.path.length - n] : /* istanbul ignore next: guard */ null;
        },

        parent: function () {
            return this.ancestor(1);
        },

        isLabeled: function () {
            var el = this.parent();
            return el && el.node.type === SYNTAX.LabeledStatement.name;
        }
    };

    /**
     * mechanism to instrument code for coverage. It uses the `esprima` and
     * `escodegen` libraries for JS parsing and code generation respectively.
     *
     * Works on `node` as well as the browser.
     *
     * Usage on nodejs
     * ---------------
     *
     *      var instrumenter = new require('istanbul').Instrumenter(),
     *          changed = instrumenter.instrumentSync('function meaningOfLife() { return 42; }', 'filename.js');
     *
     * Usage in a browser
     * ------------------
     *
     * Load `esprima.js`, `escodegen.js` and `instrumenter.js` (this file) using `script` tags or other means.
     *
     * Create an instrumenter object as:
     *
     *      var instrumenter = new Instrumenter(),
     *          changed = instrumenter.instrumentSync('function meaningOfLife() { return 42; }', 'filename.js');
     *
     * Aside from demonstration purposes, it is unclear why you would want to instrument code in a browser.
     *
     * @class Instrumenter
     * @constructor
     * @param {Object} options Optional. Configuration options.
     * @param {String} [options.coverageVariable] the global variable name to use for
     *      tracking coverage. Defaults to `__coverage__`
     * @param {Boolean} [options.embedSource] whether to embed the source code of every
     *      file as an array in the file coverage object for that file. Defaults to `false`
     * @param {Boolean} [options.preserveComments] whether comments should be preserved in the output. Defaults to `false`
     * @param {Boolean} [options.noCompact] emit readable code when set. Defaults to `false`
     * @param {Boolean} [options.esModules] whether the code to instrument contains uses es
     *      imports or exports.
     * @param {Boolean} [options.noAutoWrap] do not automatically wrap the source in
     *      an anonymous function before covering it. By default, code is wrapped in
     *      an anonymous function before it is parsed. This is done because
     *      some nodejs libraries have `return` statements outside of
     *      a function which is technically invalid Javascript and causes the parser to fail.
     *      This construct, however, works correctly in node since module loading
     *      is done in the context of an anonymous function.
     *
     * Note that the semantics of the code *returned* by the instrumenter does not change in any way.
     * The function wrapper is "unwrapped" before the instrumented code is generated.
     * @param {Object} [options.codeGenerationOptions] an object that is directly passed to the `escodegen`
     *      library as configuration for code generation. The `noCompact` setting is not honored when this
     *      option is specified
     * @param {Boolean} [options.debug] assist in debugging. Currently, the only effect of
     *      setting this option is a pretty-print of the coverage variable. Defaults to `false`
     * @param {Boolean} [options.walkDebug] assist in debugging of the AST walker used by this class.
     *
     */
    function Instrumenter(options) {
        this.opts = options || {
            debug: false,
            walkDebug: false,
            coverageVariable: '__coverage__',
            codeGenerationOptions: undefined,
            noAutoWrap: false,
            noCompact: false,
            embedSource: false,
            preserveComments: false,
            esModules: false
        };

        if (this.opts.esModules && !this.opts.noAutoWrap) {
            this.opts.noAutoWrap = true;
            if (this.opts.debug) {
                console.log('Setting noAutoWrap to true as required by esModules');
            }
        }

        this.walker = new Walker({
            ArrowFunctionExpression: [ this.arrowBlockConverter ],
            ExpressionStatement: this.coverStatement,
            ExportNamedDeclaration: this.coverExport,
            BreakStatement: this.coverStatement,
            ContinueStatement: this.coverStatement,
            DebuggerStatement: this.coverStatement,
            ReturnStatement: this.coverStatement,
            ThrowStatement: this.coverStatement,
            TryStatement: [ this.paranoidHandlerCheck, this.coverStatement],
            VariableDeclaration: this.coverStatement,
            IfStatement: [ this.ifBlockConverter, this.coverStatement, this.ifBranchInjector ],
            ForStatement: [ this.skipInit, this.loopBlockConverter, this.coverStatement ],
            ForInStatement: [ this.skipLeft, this.loopBlockConverter, this.coverStatement ],
            ForOfStatement: [ this.skipLeft, this.loopBlockConverter, this.coverStatement ],
            WhileStatement: [ this.loopBlockConverter, this.coverStatement ],
            DoWhileStatement: [ this.loopBlockConverter, this.coverStatement ],
            SwitchStatement: [ this.coverStatement, this.switchBranchInjector ],
            SwitchCase: [ this.switchCaseInjector ],
            WithStatement: [ this.withBlockConverter, this.coverStatement ],
            FunctionDeclaration: [ this.coverFunction, this.coverStatement ],
            FunctionExpression: this.coverFunction,
            LabeledStatement: this.coverStatement,
            ConditionalExpression: this.conditionalBranchInjector,
            LogicalExpression: this.logicalExpressionBranchInjector,
            ObjectExpression: this.maybeAddType,
            MetaProperty: this.coverMetaProperty,
        }, this.extractCurrentHint, this, this.opts.walkDebug);

        //unit testing purposes only
        if (this.opts.backdoor && this.opts.backdoor.omitTrackerSuffix) {
            this.omitTrackerSuffix = true;
        }
    }

    Instrumenter.prototype = {
        /**
         * synchronous instrumentation method. Throws when illegal code is passed to it
         * @method instrumentSync
         * @param {String} code the code to be instrumented as a String
         * @param {String} filename Optional. The name of the file from which
         *  the code was read. A temporary filename is generated when not specified.
         *  Not specifying a filename is only useful for unit tests and demonstrations
         *  of this library.
         */
        instrumentSync: function (code, filename) {
            var program;

            //protect from users accidentally passing in a Buffer object instead
            if (typeof code !== 'string') { throw new Error('Code must be string'); }
            if (code.charAt(0) === '#') { //shebang, 'comment' it out, won't affect syntax tree locations for things we care about
                code = '//' + code;
            }
            if (!this.opts.noAutoWrap) {
                code = LEADER_WRAP + code + TRAILER_WRAP;
            }
            try {
                program = ESP.parse(code, {
                    loc: true,
                    range: true,
                    tokens: this.opts.preserveComments,
                    comment: true,
                    sourceType: this.opts.esModules ? 'module' : 'script'
                });
            } catch (e) {
                console.log('Failed to parse file: ' + filename);
                throw e;
            }
            if (this.opts.preserveComments) {
                program = ESPGEN.attachComments(program, program.comments, program.tokens);
            }
            if (!this.opts.noAutoWrap) {
                program = {
                    type: SYNTAX.Program.name,
                    body: program.body[0].expression.callee.body.body,
                    comments: program.comments
                };
            }
            return this.instrumentASTSync(program, filename, code);
        },
        filterHints: function (comments) {
            var ret = [],
                i,
                comment,
                groups;
            if (!(comments && isArray(comments))) {
                return ret;
            }
            for (i = 0; i < comments.length; i += 1) {
                comment = comments[i];
                /* istanbul ignore else: paranoid check */
                if (comment && comment.value && comment.range && isArray(comment.range)) {
                    groups = String(comment.value).match(COMMENT_RE);
                    if (groups) {
                        ret.push({ type: groups[1], start: comment.range[0], end: comment.range[1] });
                    }
                }
            }
            return ret;
        },
        extractCurrentHint: function (node) {
            if (!node.range) { return; }
            var i = this.currentState.lastHintPosition + 1,
                hints = this.currentState.hints,
                nodeStart = node.range[0],
                hint;
            this.currentState.currentHint = null;
            // coverage-hack - allow top-level istanbul-ignore-next
            if (node.type === "Program") { return; }
            while (i < hints.length) {
                hint = hints[i];
                if (hint.end < nodeStart) {
                    this.currentState.currentHint = hint;
                    this.currentState.lastHintPosition = i;
                    i += 1;
                } else {
                    break;
                }
            }
        },
        /**
         * synchronous instrumentation method that instruments an AST instead.
         * @method instrumentASTSync
         * @param {String} program the AST to be instrumented
         * @param {String} filename Optional. The name of the file from which
         *  the code was read. A temporary filename is generated when not specified.
         *  Not specifying a filename is only useful for unit tests and demonstrations
         *  of this library.
         *  @param {String} originalCode the original code corresponding to the AST,
         *  used for embedding the source into the coverage object
         */
        instrumentASTSync: function (program, filename, originalCode) {
            var usingStrict = false,
                codegenOptions,
                generated,
                preamble,
                lineCount,
                i;
            filename = filename || String(new Date().getTime()) + '.js';
            this.sourceMap = null;
            this.coverState = {
                path: filename,
                s: {},
                b: {},
                f: {},
                fnMap: {},
                statementMap: {},
                branchMap: {}
            };
            this.currentState = {
                trackerVar: generateTrackerVar(filename, this.omitTrackerSuffix),
                func: 0,
                branch: 0,
                variable: 0,
                statement: 0,
                hints: this.filterHints(program.comments),
                currentHint: null,
                lastHintPosition: -1,
                ignoring: 0
            };
            if (program.body && program.body.length > 0 && this.isUseStrictExpression(program.body[0])) {
                //nuke it
                program.body.shift();
                //and add it back at code generation time
                usingStrict = true;
            }
            this.walker.startWalk(program);
            codegenOptions = this.opts.codeGenerationOptions || { format: { compact: !this.opts.noCompact }};
            codegenOptions.comment = this.opts.preserveComments;
            //console.log(JSON.stringify(program, undefined, 2));

            generated = ESPGEN.generate(program, codegenOptions);
            preamble = this.getPreamble(originalCode || '', usingStrict);

            if (generated.map && generated.code) {
                lineCount = preamble.split(/\r\n|\r|\n/).length;
                // offset all the generated line numbers by the number of lines in the preamble
                for (i = 0; i < generated.map._mappings._array.length; i += 1) {
                    generated.map._mappings._array[i].generatedLine += lineCount;
                }
                this.sourceMap = generated.map;
                generated = generated.code;
            }

            return preamble + '\n' + generated + '\n';
        },
        /**
         * Callback based instrumentation. Note that this still executes synchronously in the same process tick
         * and calls back immediately. It only provides the options for callback style error handling as
         * opposed to a `try-catch` style and nothing more. Implemented as a wrapper over `instrumentSync`
         *
         * @method instrument
         * @param {String} code the code to be instrumented as a String
         * @param {String} filename Optional. The name of the file from which
         *  the code was read. A temporary filename is generated when not specified.
         *  Not specifying a filename is only useful for unit tests and demonstrations
         *  of this library.
         * @param {Function(err, instrumentedCode)} callback - the callback function
         */
        instrument: function (code, filename, callback) {

            if (!callback && typeof filename === 'function') {
                callback = filename;
                filename = null;
            }
            try {
                callback(null, this.instrumentSync(code, filename));
            } catch (ex) {
                callback(ex);
            }
        },
        /**
         * returns the file coverage object for the code that was instrumented
         * just before calling this method. Note that this represents a
         * "zero-coverage" object which is not even representative of the code
         * being loaded in node or a browser (which would increase the statement
         * counts for mainline code).
         * @method lastFileCoverage
         * @return {Object} a "zero-coverage" file coverage object for the code last instrumented
         * by this instrumenter
         */
        lastFileCoverage: function () {
            return this.coverState;
        },
        /**
         * returns the source map object for the code that was instrumented
         * just before calling this method.
         * @method lastSourceMap
         * @return {Object} a source map object for the code last instrumented
         * by this instrumenter
         */
        lastSourceMap: function () {
            return this.sourceMap;
        },
        fixColumnPositions: function (coverState) {
            var offset = LEADER_WRAP.length,
                fixer = function (loc) {
                    if (loc.start.line === 1) {
                        loc.start.column -= offset;
                    }
                    if (loc.end.line === 1) {
                        loc.end.column -= offset;
                    }
                },
                k,
                obj,
                i,
                locations;

            obj = coverState.statementMap;
            for (k in obj) {
                /* istanbul ignore else: has own property */
                if (obj.hasOwnProperty(k)) { fixer(obj[k]); }
            }
            obj = coverState.fnMap;
            for (k in obj) {
                /* istanbul ignore else: has own property */
                if (obj.hasOwnProperty(k)) { fixer(obj[k].loc); }
            }
            obj = coverState.branchMap;
            for (k in obj) {
                /* istanbul ignore else: has own property */
                if (obj.hasOwnProperty(k)) {
                    locations = obj[k].locations;
                    for (i = 0; i < locations.length; i += 1) {
                        fixer(locations[i]);
                    }
                }
            }
        },

        getPreamble: function (sourceCode, emitUseStrict) {
            var varName = this.opts.coverageVariable || '__coverage__',
                file = this.coverState.path.replace(/\\/g, '\\\\'),
                tracker = this.currentState.trackerVar,
                coverState,
                strictLine = emitUseStrict ? '"use strict";' : '',
                // return replacements using the function to ensure that the replacement is
                // treated like a dumb string and not as a string with RE replacement patterns
                replacer = function (s) {
                    return function () { return s; };
                },
                code;
            if (!this.opts.noAutoWrap) {
                this.fixColumnPositions(this.coverState);
            }
            if (this.opts.embedSource) {
                this.coverState.code = sourceCode.split(/(?:\r?\n)|\r/);
            }
            coverState = this.opts.debug ? JSON.stringify(this.coverState, undefined, 4) : JSON.stringify(this.coverState);
            code = [
                "%STRICT%",
                "var %VAR% = (Function('return this'))();",
                "if (!%VAR%.%GLOBAL%) { %VAR%.%GLOBAL% = {}; }",
                "%VAR% = %VAR%.%GLOBAL%;",
                "if (!(%VAR%['%FILE%'])) {",
                "   %VAR%['%FILE%'] = %OBJECT%;",
                "}",
                "%VAR% = %VAR%['%FILE%'];"
            ].join("\n")
                .replace(/%STRICT%/g, replacer(strictLine))
                .replace(/%VAR%/g, replacer(tracker))
                .replace(/%GLOBAL%/g, replacer(varName))
                .replace(/%FILE%/g, replacer(file))
                .replace(/%OBJECT%/g, replacer(coverState));
            return code;
        },

        startIgnore: function () {
            this.currentState.ignoring += 1;
        },

        endIgnore: function () {
            this.currentState.ignoring -= 1;
        },

        convertToBlock: function (node) {
            if (!node) {
                return { type: 'BlockStatement', body: [] };
            } else if (node.type === 'BlockStatement') {
                return node;
            } else {
                return { type: 'BlockStatement', body: [ node ] };
            }
        },

        arrowBlockConverter: function (node) {
            var retStatement;
            if (node.expression) { // turn expression nodes into a block with a return statement
                retStatement = astgen.returnStatement(node.body);
                // ensure the generated return statement is covered
                retStatement.loc = node.body.loc;
                node.body = this.convertToBlock(retStatement);
                node.expression = false;
            }
        },

        paranoidHandlerCheck: function (node) {
            // if someone is using an older esprima on the browser
            // convert handlers array to single handler attribute
            // containing its first element
            /* istanbul ignore next */
            if (!node.handler && node.handlers) {
                node.handler = node.handlers[0];
            }
        },

        ifBlockConverter: function (node) {
            node.consequent = this.convertToBlock(node.consequent);
            node.alternate = this.convertToBlock(node.alternate);
        },

        loopBlockConverter: function (node) {
            node.body = this.convertToBlock(node.body);
        },

        withBlockConverter: function (node) {
            node.body = this.convertToBlock(node.body);
        },

        statementName: function (location, initValue) {
            var sName,
                ignoring = !!this.currentState.ignoring;

            location.skip = ignoring || undefined;
            initValue = initValue || 0;
            this.currentState.statement += 1;
            sName = this.currentState.statement;
            this.coverState.statementMap[sName] = location;
            this.coverState.s[sName] = initValue;
            return sName;
        },

        skipInit: function (node /*, walker */) {
            if (node.init) {
                node.init.skipWalk = true;
            }
        },

        skipLeft: function (node /*, walker */) {
            node.left.skipWalk = true;
        },

        isUseStrictExpression: function (node) {
            return node && node.type === SYNTAX.ExpressionStatement.name &&
                node.expression  && node.expression.type === SYNTAX.Literal.name &&
                node.expression.value === 'use strict';
        },

        maybeSkipNode: function (node, type) {
            var alreadyIgnoring = !!this.currentState.ignoring,
                hint = this.currentState.currentHint,
                ignoreThis = !alreadyIgnoring && hint && hint.type === type;

            if (ignoreThis) {
                this.startIgnore();
                node.postprocessor = this.endIgnore;
                return true;
            }
            return false;
        },

        coverMetaProperty: function(node /* , walker */) {
           node.skipSelf = true;
        },

        coverStatement: function (node, walker) {
            var sName,
                incrStatementCount,
                parent,
                grandParent;

            this.maybeSkipNode(node, 'next');

            if (this.isUseStrictExpression(node)) {
                grandParent = walker.ancestor(2);
                /* istanbul ignore else: difficult to test */
                if (grandParent) {
                    if ((grandParent.node.type === SYNTAX.FunctionExpression.name ||
                        grandParent.node.type === SYNTAX.FunctionDeclaration.name)  &&
                        walker.parent().node.body[0] === node) {
                        return;
                    }
                }
            }

            if (node.type === SYNTAX.FunctionDeclaration.name) {
                // Called for the side-effect of setting the function's statement count to 1.
                this.statementName(node.loc, 1);
            } else {
                // We let `coverExport` handle ExportNamedDeclarations.
                parent = walker.parent();
                if (parent && parent.node.type === SYNTAX.ExportNamedDeclaration.name) {
                    return;
                }

                sName = this.statementName(node.loc);

                incrStatementCount = astgen.statement(
                    astgen.postIncrement(
                        astgen.subscript(
                            astgen.dot(astgen.variable(this.currentState.trackerVar), astgen.variable('s')),
                            astgen.stringLiteral(sName)
                        )
                    )
                );

                this.splice(incrStatementCount, node, walker);
            }
        },

        coverExport: function (node, walker) {
            var sName, incrStatementCount;

            if ( !node.declaration || !node.declaration.declarations ) { return; }

            this.maybeSkipNode(node, 'next');

            sName = this.statementName(node.declaration.loc);
            incrStatementCount = astgen.statement(
                astgen.postIncrement(
                    astgen.subscript(
                        astgen.dot(astgen.variable(this.currentState.trackerVar), astgen.variable('s')),
                        astgen.stringLiteral(sName)
                    )
                )
            );

            this.splice(incrStatementCount, node, walker);
        },

        splice: function (statements, node, walker) {
            var targetNode = walker.isLabeled() ? walker.parent().node : node;
            targetNode.prepend = targetNode.prepend || [];
            pushAll(targetNode.prepend, statements);
        },

        functionName: function (node, line, location) {
            this.currentState.func += 1;
            var id = this.currentState.func,
                ignoring = !!this.currentState.ignoring,
                name = node.id ? node.id.name : '(anonymous_' + id + ')',
                clone = function (attr) {
                    var obj = location[attr] || /* istanbul ignore next */ {};
                    return { line: obj.line, column: obj.column };
                };
            this.coverState.fnMap[id] = {
                name: name, line: line,
                loc: {
                    start: clone('start'),
                    end: clone('end')
                },
                skip: ignoring || undefined
            };
            this.coverState.f[id] = 0;
            return id;
        },

        coverFunction: function (node, walker) {
            var id,
                body = node.body,
                blockBody = body.body,
                popped;

            this.maybeSkipNode(node, 'next');

            id = this.functionName(node, walker.startLineForNode(node), {
                start: node.loc.start,
                end: { line: node.body.loc.start.line, column: node.body.loc.start.column }
            });

            if (blockBody.length > 0 && this.isUseStrictExpression(blockBody[0])) {
                popped = blockBody.shift();
            }
            blockBody.unshift(
                astgen.statement(
                    astgen.postIncrement(
                        astgen.subscript(
                            astgen.dot(astgen.variable(this.currentState.trackerVar), astgen.variable('f')),
                            astgen.stringLiteral(id)
                        )
                    )
                )
            );
            if (popped) {
                blockBody.unshift(popped);
            }
        },

        branchName: function (type, startLine, pathLocations) {
            var bName,
                paths = [],
                locations = [],
                i,
                ignoring = !!this.currentState.ignoring;
            this.currentState.branch += 1;
            bName = this.currentState.branch;
            for (i = 0; i < pathLocations.length; i += 1) {
                pathLocations[i].skip = pathLocations[i].skip || ignoring || undefined;
                locations.push(pathLocations[i]);
                paths.push(0);
            }
            this.coverState.b[bName] = paths;
            this.coverState.branchMap[bName] = { line: startLine, type: type, locations: locations };
            return bName;
        },

        branchIncrementExprAst: function (varName, branchIndex, down) {
            var ret = astgen.postIncrement(
                astgen.subscript(
                    astgen.subscript(
                        astgen.dot(astgen.variable(this.currentState.trackerVar), astgen.variable('b')),
                        astgen.stringLiteral(varName)
                    ),
                    astgen.numericLiteral(branchIndex)
                ),
                down
            );
            return ret;
        },

        locationsForNodes: function (nodes) {
            var ret = [],
                i;
            for (i = 0; i < nodes.length; i += 1) {
                ret.push(nodes[i].loc);
            }
            return ret;
        },

        ifBranchInjector: function (node, walker) {
            var alreadyIgnoring = !!this.currentState.ignoring,
                hint = this.currentState.currentHint,
                ignoreThen = !alreadyIgnoring && hint && hint.type === 'if',
                ignoreElse = !alreadyIgnoring && hint && hint.type === 'else',
                line = node.loc.start.line,
                col = node.loc.start.column,
                makeLoc = function () { return  { line: line, column: col }; },
                bName = this.branchName('if', walker.startLineForNode(node), [
                    { start: makeLoc(), end: makeLoc(), skip: ignoreThen || undefined },
                    { start: makeLoc(), end: makeLoc(), skip: ignoreElse || undefined }
                ]),
                thenBody = node.consequent.body,
                elseBody = node.alternate.body,
                child;
            thenBody.unshift(astgen.statement(this.branchIncrementExprAst(bName, 0)));
            elseBody.unshift(astgen.statement(this.branchIncrementExprAst(bName, 1)));
            if (ignoreThen) { child = node.consequent; child.preprocessor = this.startIgnore; child.postprocessor = this.endIgnore; }
            if (ignoreElse) { child = node.alternate; child.preprocessor = this.startIgnore; child.postprocessor = this.endIgnore; }
        },

        branchLocationFor: function (name, index) {
            return this.coverState.branchMap[name].locations[index];
        },

        switchBranchInjector: function (node, walker) {
            var cases = node.cases,
                bName,
                i;

            if (!(cases && cases.length > 0)) {
                return;
            }
            bName = this.branchName('switch', walker.startLineForNode(node), this.locationsForNodes(cases));
            for (i = 0; i < cases.length; i += 1) {
                cases[i].branchLocation = this.branchLocationFor(bName, i);
                cases[i].consequent.unshift(astgen.statement(this.branchIncrementExprAst(bName, i)));
            }
        },

        switchCaseInjector: function (node) {
            var location = node.branchLocation;
            delete node.branchLocation;
            if (this.maybeSkipNode(node, 'next')) {
                location.skip = true;
            }
        },

        conditionalBranchInjector: function (node, walker) {
            var bName = this.branchName('cond-expr', walker.startLineForNode(node), this.locationsForNodes([ node.consequent, node.alternate ])),
                ast1 = this.branchIncrementExprAst(bName, 0),
                ast2 = this.branchIncrementExprAst(bName, 1);

            node.consequent.preprocessor = this.maybeAddSkip(this.branchLocationFor(bName, 0));
            node.alternate.preprocessor = this.maybeAddSkip(this.branchLocationFor(bName, 1));
            node.consequent = astgen.sequence(ast1, node.consequent);
            node.alternate = astgen.sequence(ast2, node.alternate);
        },

        maybeAddSkip: function (branchLocation) {
            return function (node) {
                var alreadyIgnoring = !!this.currentState.ignoring,
                    hint = this.currentState.currentHint,
                    ignoreThis = !alreadyIgnoring && hint && hint.type === 'next';
                if (ignoreThis) {
                    this.startIgnore();
                    node.postprocessor = this.endIgnore;
                }
                if (ignoreThis || alreadyIgnoring) {
                    branchLocation.skip = true;
                }
            };
        },

        logicalExpressionBranchInjector: function (node, walker) {
            var parent = walker.parent(),
                leaves = [],
                bName,
                tuple,
                i;

            this.maybeSkipNode(node, 'next');

            if (parent && parent.node.type === SYNTAX.LogicalExpression.name) {
                //already covered
                return;
            }

            this.findLeaves(node, leaves);
            bName = this.branchName('binary-expr',
                walker.startLineForNode(node),
                this.locationsForNodes(leaves.map(function (item) { return item.node; }))
            );
            for (i = 0; i < leaves.length; i += 1) {
                tuple = leaves[i];
                tuple.parent[tuple.property] = astgen.sequence(this.branchIncrementExprAst(bName, i), tuple.node);
                tuple.node.preprocessor = this.maybeAddSkip(this.branchLocationFor(bName, i));
            }
        },

        findLeaves: function (node, accumulator, parent, property) {
            if (node.type === SYNTAX.LogicalExpression.name) {
                this.findLeaves(node.left, accumulator, node, 'left');
                this.findLeaves(node.right, accumulator, node, 'right');
            } else {
                accumulator.push({ node: node, parent: parent, property: property });
            }
        },
        maybeAddType: function (node /*, walker */) {
            var props = node.properties,
                i,
                child;
            for (i = 0; i < props.length; i += 1) {
                child = props[i];
                if (!child.type) {
                    child.type = SYNTAX.Property.name;
                }
            }
        },
    };

    if (isNode) {
        module.exports = Instrumenter;
    } else {
        window.Instrumenter = Instrumenter;
    }
}(typeof module !== 'undefined' && typeof module.exports !== 'undefined' && typeof exports !== 'undefined'));
}());



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/object-utils.js
*/
/* istanbul ignore next */
(function () { var module, window; module = undefined; window = local;
/*
 Copyright (c) 2012, Yahoo! Inc.  All rights reserved.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */

/**
 * utility methods to process coverage objects. A coverage object has the following
 * format.
 *
 *      {
 *          "/path/to/file1.js": { file1 coverage },
 *          "/path/to/file2.js": { file2 coverage }
 *      }
 *
 *  The internals of the file coverage object are intentionally not documented since
 *  it is not a public interface.
 *
 *  *Note:* When a method of this module has the word `File` in it, it will accept
 *  one of the sub-objects of the main coverage object as an argument. Other
 *  methods accept the higher level coverage object with multiple keys.
 *
 * Works on `node` as well as the browser.
 *
 * Usage on nodejs
 * ---------------
 *
 *      var objectUtils = require('istanbul').utils;
 *
 * Usage in a browser
 * ------------------
 *
 * Load this file using a `script` tag or other means. This will set `window.coverageUtils`
 * to this module's exports.
 *
 * @class ObjectUtils
 * @static
 */
(function (isNode) {
    /**
     * adds line coverage information to a file coverage object, reverse-engineering
     * it from statement coverage. The object passed in is updated in place.
     *
     * Note that if line coverage information is already present in the object,
     * it is not recomputed.
     *
     * @method addDerivedInfoForFile
     * @static
     * @param {Object} fileCoverage the coverage object for a single file
     */
    function addDerivedInfoForFile(fileCoverage) {
        var statementMap = fileCoverage.statementMap,
            statements = fileCoverage.s,
            lineMap;

        if (!fileCoverage.l) {
            fileCoverage.l = lineMap = {};
            Object.keys(statements).forEach(function (st) {
                var line = statementMap[st].start.line,
                    count = statements[st],
                    prevVal = lineMap[line];
                if (count === 0 && statementMap[st].skip) { count = 1; }
                if (typeof prevVal === 'undefined' || prevVal < count) {
                    lineMap[line] = count;
                }
            });
        }
    }
    /**
     * adds line coverage information to all file coverage objects.
     *
     * @method addDerivedInfo
     * @static
     * @param {Object} coverage the coverage object
     */
    function addDerivedInfo(coverage) {
        Object.keys(coverage).forEach(function (k) {
            addDerivedInfoForFile(coverage[k]);
        });
    }
    /**
     * removes line coverage information from all file coverage objects
     * @method removeDerivedInfo
     * @static
     * @param {Object} coverage the coverage object
     */
    function removeDerivedInfo(coverage) {
        Object.keys(coverage).forEach(function (k) {
            delete coverage[k].l;
        });
    }

    function percent(covered, total) {
        var tmp;
        if (total > 0) {
            tmp = 1000 * 100 * covered / total + 5;
            return Math.floor(tmp / 10) / 100;
        } else {
            return 100.00;
        }
    }

    function computeSimpleTotals(fileCoverage, property, mapProperty) {
        var stats = fileCoverage[property],
            map = mapProperty ? fileCoverage[mapProperty] : null,
            ret = { total: 0, covered: 0, skipped: 0 };

        Object.keys(stats).forEach(function (key) {
            var covered = !!stats[key],
                skipped = map && map[key].skip;
            ret.total += 1;
            if (covered || skipped) {
                ret.covered += 1;
            }
            if (!covered && skipped) {
                ret.skipped += 1;
            }
        });
        ret.pct = percent(ret.covered, ret.total);
        return ret;
    }

    function computeBranchTotals(fileCoverage) {
        var stats = fileCoverage.b,
            branchMap = fileCoverage.branchMap,
            ret = { total: 0, covered: 0, skipped: 0 };

        Object.keys(stats).forEach(function (key) {
            var branches = stats[key],
                map = branchMap[key],
                covered,
                skipped,
                i;
            for (i = 0; i < branches.length; i += 1) {
                covered = branches[i] > 0;
                skipped = map.locations && map.locations[i] && map.locations[i].skip;
                if (covered || skipped) {
                    ret.covered += 1;
                }
                if (!covered && skipped) {
                    ret.skipped += 1;
                }
            }
            ret.total += branches.length;
        });
        ret.pct = percent(ret.covered, ret.total);
        return ret;
    }
    /**
     * returns a blank summary metrics object. A metrics object has the following
     * format.
     *
     *      {
     *          lines: lineMetrics,
     *          statements: statementMetrics,
     *          functions: functionMetrics,
     *          branches: branchMetrics
     *      }
     *
     *  Each individual metric object looks as follows:
     *
     *      {
     *          total: n,
     *          covered: m,
     *          pct: percent
     *      }
     *
     * @method blankSummary
     * @static
     * @return {Object} a blank metrics object
     */
    function blankSummary() {
        return {
            lines: {
                total: 0,
                covered: 0,
                skipped: 0,
                pct: 'Unknown'
            },
            statements: {
                total: 0,
                covered: 0,
                skipped: 0,
                pct: 'Unknown'
            },
            functions: {
                total: 0,
                covered: 0,
                skipped: 0,
                pct: 'Unknown'
            },
            branches: {
                total: 0,
                covered: 0,
                skipped: 0,
                pct: 'Unknown'
            }
        };
    }
    /**
     * returns the summary metrics given the coverage object for a single file. See `blankSummary()`
     * to understand the format of the returned object.
     *
     * @method summarizeFileCoverage
     * @static
     * @param {Object} fileCoverage the coverage object for a single file.
     * @return {Object} the summary metrics for the file
     */
    function summarizeFileCoverage(fileCoverage) {
        var ret = blankSummary();
        addDerivedInfoForFile(fileCoverage);
        ret.lines = computeSimpleTotals(fileCoverage, 'l');
        ret.functions = computeSimpleTotals(fileCoverage, 'f', 'fnMap');
        ret.statements = computeSimpleTotals(fileCoverage, 's', 'statementMap');
        ret.branches = computeBranchTotals(fileCoverage);
        return ret;
    }
    /**
     * merges two instances of file coverage objects *for the same file*
     * such that the execution counts are correct.
     *
     * @method mergeFileCoverage
     * @static
     * @param {Object} first the first file coverage object for a given file
     * @param {Object} second the second file coverage object for the same file
     * @return {Object} an object that is a result of merging the two. Note that
     *      the input objects are not changed in any way.
     */
    function mergeFileCoverage(first, second) {
        var ret = JSON.parse(JSON.stringify(first)),
            i;

        delete ret.l; //remove derived info

        Object.keys(second.s).forEach(function (k) {
            ret.s[k] += second.s[k];
        });
        Object.keys(second.f).forEach(function (k) {
            ret.f[k] += second.f[k];
        });
        Object.keys(second.b).forEach(function (k) {
            var retArray = ret.b[k],
                secondArray = second.b[k];
            for (i = 0; i < retArray.length; i += 1) {
                retArray[i] += secondArray[i];
            }
        });

        return ret;
    }
    /**
     * merges multiple summary metrics objects by summing up the `totals` and
     * `covered` fields and recomputing the percentages. This function is generic
     * and can accept any number of arguments.
     *
     * @method mergeSummaryObjects
     * @static
     * @param {Object} summary... multiple summary metrics objects
     * @return {Object} the merged summary metrics
     */
    function mergeSummaryObjects() {
        var ret = blankSummary(),
            args = Array.prototype.slice.call(arguments),
            keys = ['lines', 'statements', 'branches', 'functions'],
            increment = function (obj) {
                if (obj) {
                    keys.forEach(function (key) {
                        ret[key].total += obj[key].total;
                        ret[key].covered += obj[key].covered;
                        ret[key].skipped += obj[key].skipped;
                    });
                }
            };
        args.forEach(function (arg) {
            increment(arg);
        });
        keys.forEach(function (key) {
            ret[key].pct = percent(ret[key].covered, ret[key].total);
        });

        return ret;
    }
    /**
     * returns the coverage summary for a single coverage object. This is
     * wrapper over `summarizeFileCoverage` and `mergeSummaryObjects` for
     * the common case of a single coverage object
     * @method summarizeCoverage
     * @static
     * @param {Object} coverage  the coverage object
     * @return {Object} summary coverage metrics across all files in the coverage object
     */
    function summarizeCoverage(coverage) {
        var fileSummary = [];
        Object.keys(coverage).forEach(function (key) {
            fileSummary.push(summarizeFileCoverage(coverage[key]));
        });
        return mergeSummaryObjects.apply(null, fileSummary);
    }

    /**
     * makes the coverage object generated by this library yuitest_coverage compatible.
     * Note that this transformation is lossy since the returned object will not have
     * statement and branch coverage.
     *
     * @method toYUICoverage
     * @static
     * @param {Object} coverage The `istanbul` coverage object
     * @return {Object} a coverage object in `yuitest_coverage` format.
     */
    function toYUICoverage(coverage) {
        var ret = {};

        addDerivedInfo(coverage);

        Object.keys(coverage).forEach(function (k) {
            var fileCoverage = coverage[k],
                lines = fileCoverage.l,
                functions = fileCoverage.f,
                fnMap = fileCoverage.fnMap,
                o;

            o = ret[k] = {
                lines: {},
                calledLines: 0,
                coveredLines: 0,
                functions: {},
                calledFunctions: 0,
                coveredFunctions: 0
            };
            Object.keys(lines).forEach(function (k) {
                o.lines[k] = lines[k];
                o.coveredLines += 1;
                if (lines[k] > 0) {
                    o.calledLines += 1;
                }
            });
            Object.keys(functions).forEach(function (k) {
                var name = fnMap[k].name + ':' + fnMap[k].line;
                o.functions[name] = functions[k];
                o.coveredFunctions += 1;
                if (functions[k] > 0) {
                    o.calledFunctions += 1;
                }
            });
        });
        return ret;
    }

    var exportables = {
        addDerivedInfo: addDerivedInfo,
        addDerivedInfoForFile: addDerivedInfoForFile,
        removeDerivedInfo: removeDerivedInfo,
        blankSummary: blankSummary,
        summarizeFileCoverage: summarizeFileCoverage,
        summarizeCoverage: summarizeCoverage,
        mergeFileCoverage: mergeFileCoverage,
        mergeSummaryObjects: mergeSummaryObjects,
        toYUICoverage: toYUICoverage
    };

    /* istanbul ignore else: windows */
    if (isNode) {
        module.exports = exportables;
    } else {
        window.coverageUtils = exportables;
    }
}(typeof module !== 'undefined' && typeof module.exports !== 'undefined' && typeof exports !== 'undefined'));
local["../object-utils"] = window.coverageUtils; }());



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/report/common/defaults.js
*/
/* istanbul ignore next */
(function () { var module; module = {};
/*
 Copyright (c) 2013, Yahoo! Inc.  All rights reserved.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */
module.exports = {
    watermarks: function () {
        return {
            statements: [ 50, 80 ],
            lines: [ 50, 80 ],
            functions: [ 50, 80],
            branches: [ 50, 80 ]
        };
    },

    classFor: function (type, metrics, watermarks) {
        var mark = watermarks[type],
            value = metrics[type].pct;
        return value >= mark[1] ? 'high' : value >= mark[0] ? 'medium' : 'low';
    },

    colorize: function (str, clazz) {
        /* istanbul ignore if: untestable in batch mode */
        if (process.stdout.isTTY) {
            switch (clazz) {
                // coverage-hack - Octal escape sequences are not allowed in strict mode.
                case 'low' : str = '\0x1b[91m' + str + '\0x1b[0m'; break;
                case 'medium': str = '\0x1b[93m' + str + '\0x1b[0m'; break;
                case 'high': str = '\0x1b[92m' + str + '\0x1b[0m'; break;
            }
        }
        return str;
    }
};
local["./common/defaults"] = module.exports; }());
/* jslint ignore:end */



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/report/index.js
*/
local["./index"] = {
    call: local.nop,
    mix: function (klass, prototype) {
        klass.prototype = prototype;
    }
};



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/report/templates/foot.txt
*/
/* jslint ignore:start */
local["foot.txt"] = '\
</div>\n\
<div class="footer">\n\
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at {{datetime}}</div>\n\
</div>\n\
</body>\n\
</html>\n\
';



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/report/templates/head.txt
*/
local["head.txt"] = '\
<!doctype html>\n\
<html lang="en" class="x-istanbul">\n\
<head>\n\
    <title>Code coverage report for {{entity}}</title>\n\
    <meta charset="utf-8">\n\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
    box-model: false,\n\
    important: false,\n\
    qualified-headings: false,\n\
*/\n\
/* csslint ignore:start */\n\
*,\n\
*:after,\n\
*:before {\n\
    box-sizing: border-box;\n\
}\n\
/* csslint ignore:end */\n\
.x-istanbul {\n\
    font-family: Helvetica Neue, Helvetica,Arial;\n\
    font-size: 10pt;\n\
    margin: 0;\n\
    padding: 0;\n\
}\n\
.x-istanbul h1 {\n\
    font-size: large;\n\
}\n\
.x-istanbul pre {\n\
    font-family: Consolas, Menlo, Monaco, monospace;\n\
    font-size: 14px;\n\
    margin: 0;\n\
    padding: 0;\n\
    tab-size: 2;\n\
}\n\
.x-istanbul .cbranch-no {\n\
    background: yellow !important;\n\
    color: #111;\n\
}\n\
.x-istanbul .cbranch-skip {\n\
    background: #ddd !important;\n\
    color: #111;\n\
}\n\
.x-istanbul .com {\n\
    color: #999 !important;\n\
}\n\
.x-istanbul .cover-empty,\n\
.x-istanbul .cover-fill {\n\
    background: white;\n\
    border: 1px solid #444;\n\
    display: inline-block;\n\
    height: 12px;\n\
}\n\
.x-istanbul .cover-empty {\n\
    background: white;\n\
    border-left: none;\n\
}\n\
.x-istanbul .cover-fill {\n\
    background: #ccc;\n\
    border-right: 1px solid #444;\n\
}\n\
.x-istanbul .cover-full {\n\
    border-right: none !important;\n\
}\n\
.x-istanbul .coverage {\n\
    border-collapse: collapse;\n\
    margin: 0;\n\
    padding: 0\n\
}\n\
.x-istanbul .coverage td {\n\
    color: #111;\n\
    margin: 0;\n\
    padding: 0;\n\
    vertical-align: top;\n\
}\n\
.x-istanbul .coverage td .cline-any {\n\
    display: inline-block;\n\
    padding: 0 5px;\n\
    width: 60px;\n\
}\n\
.x-istanbul .coverage td .cline-neutral {\n\
    background: #eee;\n\
}\n\
.x-istanbul .coverage td .cline-no {\n\
    background: #fc8c84;\n\
}\n\
.x-istanbul .coverage td .cline-yes {\n\
    background: #b5d592;\n\
    color: #999;\n\
}\n\
.x-istanbul .coverage .line-count {\n\
    padding-right: 5px;\n\
    text-align: right;\n\
    width: 50px;\n\
}\n\
.x-istanbul .coverage .line-count a {\n\
    text-decoration: none;\n\
}\n\
.x-istanbul .coverage .line-coverage {\n\
    border-left: 1px solid #666;\n\
    border-right: 1px solid #666;\n\
    color: #777 !important;\n\
    text-align: right;\n\
}\n\
.x-istanbul .coverage-summary {\n\
    padding: 20px;\n\
}\n\
.x-istanbul .coverage-summary table {\n\
    border-collapse: collapse;\n\
    margin: auto;\n\
    table-layout: fixed;\n\
    text-align: left;\n\
    width: 100%\n\
}\n\
.x-istanbul .coverage-summary td {\n\
    border: 1px solid #666;\n\
    margin: 0;\n\
    padding: 5px;\n\
    white-space: nowrap;\n\
}\n\
.x-istanbul .coverage-summary th {\n\
    margin: 0;\n\
    padding: 0 0 2px 0;\n\
}\n\
.x-istanbul .cstat-no {\n\
    background: #fc8c84;\n\
    color: #111;\n\
}\n\
.x-istanbul .cstat-skip {\n\
    background: #ddd;\n\
    color: #111;\n\
}\n\
.x-istanbul .cstat-yes {\n\
    color: #111;\n\
}\n\
.x-istanbul .entity,\n\
.x-istanbul .metric {\n\
    font-weight: bold;\n\
}\n\
.x-istanbul .footer,\n\
.x-istanbul .header {\n\
    background: #eee;\n\
    padding: 20px;\n\
}\n\
.x-istanbul .footer {\n\
    border-top: 1px solid #666;\n\
}\n\
.x-istanbul .fstat-no {\n\
    background: #ffc520;\n\
    color: #111 !important;\n\
}\n\
.x-istanbul .fstat-skip {\n\
    background: #ddd;\n\
    color: #111 !important;\n\
}\n\
.x-istanbul .header {\n\
    border-bottom: 1px solid #666;\n\
    top: 0;\n\
    width: 100%;\n\
}\n\
.x-istanbul .high {\n\
    background: #b5d592 !important;\n\
}\n\
.x-istanbul .ignore-none {\n\
    color: #999;\n\
    font-weight: normal;\n\
}\n\
.x-istanbul .low {\n\
    background: #fc8c84 !important;\n\
}\n\
.x-istanbul .medium {\n\
    background: #ffe87c !important;\n\
}\n\
.x-istanbul .meta {\n\
    text-align: center;\n\
}\n\
.x-istanbul .metric {\n\
    background: white;\n\
    border: 1px solid #333;\n\
    display: inline-block;\n\
    padding: .3em;\n\
}\n\
.x-istanbul .missing-if-branch {\n\
    background: black;\n\
    color: yellow;\n\
    display: inline-block;\n\
    margin-right: 10px;\n\
    padding: 0 4px;\n\
    position: relative;\n\
}\n\
.x-istanbul .missing-if-branch .typ,\n\
.x-istanbul .skip-if-branch .typ {\n\
    color: inherit !important;\n\
}\n\
.x-istanbul .prettyprint {\n\
    border: none !important;\n\
    margin: 0 !important;\n\
    padding: 0 !important;\n\
}\n\
.x-istanbul .skip-if-branch {\n\
    background: #ccc;\n\
    color: white;\n\
    display: none;\n\
    margin-right: 10px;\n\
    padding: 0 4px;\n\
    position: relative;\n\
}\n\
/* validateLineSortedReset */\n\
.x-istanbul a {\n\
    color: #00d;\n\
    text-decoration: underline;\n\
}\n\
.x-istanbul pre {\n\
    overflow: visible;\n\
    white-space: pre\n\
}\n\
.x-istanbul .file div {\n\
    margin-bottom: 2px;\n\
    overflow-wrap: break-word;\n\
    white-space: normal;\n\
    width: 100%;\n\
}\n\
.x-istanbul .tableHeader {\n\
    border-collapse: collapse;\n\
    margin: 0 auto 10px auto;\n\
    table-layout: fixed;\n\
    text-align: left;\n\
    width: 100%;\n\
}\n\
.x-istanbul .tableHeader td {\n\
    background: #fff;\n\
    border: 1px solid #666;\n\
    padding: 5px;\n\
}\n\
.x-istanbul .tableHeader th {\n\
    padding: 0 0 2px 0;\n\
}\n\
</style>\n\
</head>\n\
<body class="x-istanbul">\n\
<script>\n\
// init domOnEventSelectAllWithinPre\n\
(function () {\n\
/*\n\
 * this function will limit select-all within <pre tabIndex="0"> elements\n\
 * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n\
 */\n\
    "use strict";\n\
    if (window.domOnEventSelectAllWithinPre) {\n\
        return;\n\
    }\n\
    window.domOnEventSelectAllWithinPre = function (evt) {\n\
        var range;\n\
        var selection;\n\
        if (\n\
            evt\n\
            && evt.key === "a"\n\
            && (evt.ctrlKey || evt.metaKey)\n\
            && evt.target.closest(\n\
                "pre"\n\
            )\n\
        ) {\n\
            range = document.createRange();\n\
            range.selectNodeContents(evt.target.closest(\n\
                "pre"\n\
            ));\n\
            selection = window.getSelection();\n\
            selection.removeAllRanges();\n\
            selection.addRange(range);\n\
            evt.preventDefault();\n\
        }\n\
    };\n\
    // init event-handling\n\
    document.addEventListener(\n\
        "keydown",\n\
        window.domOnEventSelectAllWithinPre\n\
    );\n\
}());\n\
</script>\n\
<div class="header {{reportClass}}">\n\
    <h1 style="font-weight: bold;">\n\
        <a href="{{env.npm_package_homepage}}">{{env.npm_package_name}} ({{env.npm_package_version}})</a>\n\
    </h1>\n\
    <h1>Code coverage report for <span class="entity">{{entity}}</span></h1>\n\
    <table class="tableHeader">\n\
    <thead>\n\
    <tr>\n\
        <th>Ignored</th>\n\
        <th>Statements</th>\n\
        <th>Branches</th>\n\
        <th>Functions</th>\n\
        <th>Lines</th>\n\
    </tr>\n\
    </thead>\n\
    <tbody>\n\
        <td>{{#show_ignores metrics}}{{/show_ignores}}</td>\n\
        <td>{{#with metrics.statements}}{{pct}}%<br>({{covered}} / {{total}}){{/with}}</td>\n\
        <td>{{#with metrics.branches}}{{pct}}%<br>({{covered}} / {{total}}){{/with}}</td>\n\
        <td>{{#with metrics.functions}}{{pct}}%<br>({{covered}} / {{total}}){{/with}}</td>\n\
        <td>{{#with metrics.lines}}{{pct}}%<br>({{covered}} / {{total}}){{/with}}</td>\n\
    </tbody>\n\
    </table>\n\
    {{{pathHtml}}}\n\
</div>\n\
<div class="body">\n\
';
/* jslint ignore:end */



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/util/file-writer.js
*/
local.writer = {
    write: function (data) {
        local.writerData += data;
    },
    writeFile: function (file, onError) {
        local.coverageReportHtml += local.writerData + "\n\n";
        if (!local.isBrowser && local.writerFile) {
            local.fsWriteFileWithMkdirpSync(local.writerFile, local.writerData);
        }
        local.writerData = "";
        local.writerFile = file;
        onError(local.writer);
    }
};



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/util/tree-summarizer.js
*/
/* istanbul ignore next */
(function () {
    var module;
    module = {};
/* jslint ignore:start */
/*
 Copyright (c) 2012, Yahoo! Inc.  All rights reserved.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */

var path = require('path'),
    SEP = path.sep || '/',
    utils = require('../object-utils');

function commonArrayPrefix(first, second) {
    var len = first.length < second.length ? first.length : second.length,
        i,
        ret = [];
    for (i = 0; i < len; i += 1) {
        if (first[i] === second[i]) {
            ret.push(first[i]);
        } else {
            break;
        }
    }
    return ret;
}

function findCommonArrayPrefix(args) {
    if (args.length === 0) {
        return [];
    }

    var separated = args.map(function (arg) { return arg.split(SEP); }),
        ret = separated.pop();

    if (separated.length === 0) {
        return ret.slice(0, ret.length - 1);
    } else {
        return separated.reduce(commonArrayPrefix, ret);
    }
}

function Node(fullName, kind, metrics) {
    this.name = fullName;
    this.fullName = fullName;
    this.kind = kind;
    this.metrics = metrics || null;
    this.parent = null;
    this.children = [];
}

Node.prototype = {
    displayShortName: function () {
        return this.relativeName;
    },
    fullPath: function () {
        return this.fullName;
    },
    addChild: function (child) {
        this.children.push(child);
        child.parent = this;
    },
    toJSON: function () {
        return {
            name: this.name,
            relativeName: this.relativeName,
            fullName: this.fullName,
            kind: this.kind,
            metrics: this.metrics,
            parent: this.parent === null ? null : this.parent.name,
            children: this.children.map(function (node) { return node.toJSON(); })
        };
    }
};

function TreeSummary(summaryMap, commonPrefix) {
    this.prefix = commonPrefix;
    this.convertToTree(summaryMap, commonPrefix);
}

TreeSummary.prototype = {
    getNode: function (shortName) {
        return this.map[shortName];
    },
    convertToTree: function (summaryMap, arrayPrefix) {
        var nodes = [],
            rootPath = arrayPrefix.join(SEP) + SEP,
            root = new Node(rootPath, 'dir'),
            tmp,
            tmpChildren,
            seen = {},
            filesUnderRoot = false;

        seen[rootPath] = root;
        Object.keys(summaryMap).forEach(function (key) {
            var metrics = summaryMap[key],
                node,
                parentPath,
                parent;
            node = new Node(key, 'file', metrics);
            seen[key] = node;
            nodes.push(node);
            parentPath = path.dirname(key) + SEP;
            if (parentPath === SEP + SEP) {
                parentPath = SEP + '__root__' + SEP;
            }
            parent = seen[parentPath];
            if (!parent) {
                parent = new Node(parentPath, 'dir');
                root.addChild(parent);
                seen[parentPath] = parent;
            }
            parent.addChild(node);
            if (parent === root) { filesUnderRoot = true; }
        });

        if (filesUnderRoot && arrayPrefix.length > 0) {
            arrayPrefix.pop(); //start at one level above
            tmp = root;
            tmpChildren = tmp.children;
            tmp.children = [];
            root = new Node(arrayPrefix.join(SEP) + SEP, 'dir');
            root.addChild(tmp);
            tmpChildren.forEach(function (child) {
                if (child.kind === 'dir') {
                    root.addChild(child);
                } else {
                    tmp.addChild(child);
                }
            });
        }
        this.fixupNodes(root, arrayPrefix.join(SEP) + SEP);
        this.calculateMetrics(root);
        this.root = root;
        this.map = {};
        this.indexAndSortTree(root, this.map);
    },

    fixupNodes: function (node, prefix, parent) {
        var that = this;
        if (node.name.indexOf(prefix) === 0) {
            node.name = node.name.substring(prefix.length);
        }
        if (node.name.charAt(0) === SEP) {
            node.name = node.name.substring(1);
        }
        if (parent) {
            if (parent.name !== '__root__/') {
                node.relativeName = node.name.substring(parent.name.length);
            } else {
                node.relativeName = node.name;
            }
        } else {
            node.relativeName = node.name.substring(prefix.length);
        }
        node.children.forEach(function (child) {
            that.fixupNodes(child, prefix, node);
        });
    },
    calculateMetrics: function (entry) {
        var that = this,
            fileChildren;
        if (entry.kind !== 'dir') {return; }
        entry.children.forEach(function (child) {
            that.calculateMetrics(child);
        });
        entry.metrics = utils.mergeSummaryObjects.apply(
            null,
            entry.children.map(function (child) { return child.metrics; })
        );
        // calclulate "java-style" package metrics where there is no hierarchy
        // across packages
        fileChildren = entry.children.filter(function (n) { return n.kind !== 'dir'; });
        if (fileChildren.length > 0) {
            entry.packageMetrics = utils.mergeSummaryObjects.apply(
                null,
                fileChildren.map(function (child) { return child.metrics; })
            );
        } else {
            entry.packageMetrics = null;
        }
    },
    indexAndSortTree: function (node, map) {
        var that = this;
        map[node.name] = node;
        node.children.sort(function (a, b) {
            a = a.relativeName;
            b = b.relativeName;
            return a < b ? -1 : a > b ? 1 : 0;
        });
        node.children.forEach(function (child) {
            that.indexAndSortTree(child, map);
        });
    },
    toJSON: function () {
        return {
            prefix: this.prefix,
            root: this.root.toJSON()
        };
    }
};

function TreeSummarizer() {
    this.summaryMap = {};
}

TreeSummarizer.prototype = {
    addFileCoverageSummary: function (filePath, metrics) {
        this.summaryMap[filePath] = metrics;
    },
    getTreeSummary: function () {
        var commonArrayPrefix = findCommonArrayPrefix(Object.keys(this.summaryMap));
        return new TreeSummary(this.summaryMap, commonArrayPrefix);
    }
};

module.exports = TreeSummarizer;
/* jslint ignore:end */
    local["../util/tree-summarizer"] = module.exports;
    module.exports.prototype._getTreeSummary = (
        module.exports.prototype.getTreeSummary
    );
    module.exports.prototype.getTreeSummary = function () {
        local.coverageReportSummary = this._getTreeSummary();
        return local.coverageReportSummary;
    };
}());



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/report/html.js
*/
/* istanbul ignore next */
/* jslint ignore:start */
(function () { var module; module = {};
/*
 Copyright (c) 2012, Yahoo! Inc.  All rights reserved.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */

/*jshint maxlen: 300 */
var handlebars = require('handlebars'),
    defaults = require('./common/defaults'),
    path = require('path'),
    SEP = path.sep || '/',
    fs = require('fs'),
    util = require('util'),
    FileWriter = require('../util/file-writer'),
    Report = require('./index'),
    Store = require('../store'),
    InsertionText = require('../util/insertion-text'),
    TreeSummarizer = require('../util/tree-summarizer'),
    utils = require('../object-utils'),
    templateFor = function (name) { return handlebars.compile(fs.readFileSync(path.resolve(__dirname, 'templates', name + '.txt'), 'utf8')); },
    headerTemplate = templateFor('head'),
    footerTemplate = templateFor('foot'),
    pathTemplate = handlebars.compile('<div class="path">{{{html}}}</div>'),
    detailTemplate = handlebars.compile([
        '<tr>',
        '<td class="line-count">{{#show_lines}}{{maxLines}}{{/show_lines}}</td>',
        '<td class="line-coverage">{{#show_line_execution_counts fileCoverage}}{{maxLines}}{{/show_line_execution_counts}}</td>',
        // coverage-hack - domOnEventSelectAllWithinPre
        '<td class="text"><pre class="prettyprint lang-js" tabIndex="0">{{#show_code structured}}{{/show_code}}</pre></td>',
        '</tr>\n'
    ].join('')),
    summaryTableHeader = [
        '<div class="coverage-summary">',
        '<table>',
        '<thead>',
        '<tr>',
        // coverage-hack - compact summary
        '   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>',
        '   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>',
        '   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>',
        '   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>',
        '   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>',
        '</tr>',
        '</thead>',
        '<tbody>'
    ].join('\n'),
    summaryLineTemplate = handlebars.compile([
        '<tr>',
        // coverage-hack - compact summary
        '<td class="file {{reportClasses.statements}}" data-value="{{file}}"><a href="{{output}}"><div>{{file}}</div>{{#show_picture}}{{metrics.statements.pct}}{{/show_picture}}</a></td>',
        '<td data-value="{{metrics.statements.pct}}" class="pct {{reportClasses.statements}}">{{metrics.statements.pct}}%<br>({{metrics.statements.covered}} / {{metrics.statements.total}})</td>',
        '<td data-value="{{metrics.branches.pct}}" class="pct {{reportClasses.branches}}">{{metrics.branches.pct}}%<br>({{metrics.branches.covered}} / {{metrics.branches.total}})</td>',
        '<td data-value="{{metrics.functions.pct}}" class="pct {{reportClasses.functions}}">{{metrics.functions.pct}}%<br>({{metrics.functions.covered}} / {{metrics.functions.total}})</td>',
        '<td data-value="{{metrics.lines.pct}}" class="pct {{reportClasses.lines}}">{{metrics.lines.pct}}%<br>({{metrics.lines.covered}} / {{metrics.lines.total}})</td>',
        '</tr>\n'
    ].join('\n\t')),
    summaryTableFooter = [
        '</tbody>',
        '</table>',
        '</div>'
    ].join('\n'),
    lt = '\u0001',
    gt = '\u0002',
    RE_LT = /</g,
    RE_GT = />/g,
    RE_AMP = /&/g,
    RE_lt = /\u0001/g,
    RE_gt = /\u0002/g;

handlebars.registerHelper('show_picture', function (opts) {
    var num = Number(opts.fn(this)),
        rest,
        cls = '';
    if (isFinite(num)) {
        if (num === 100) {
            cls = ' cover-full';
        }
        num = Math.floor(num);
        rest = 100 - num;
        return '<span class="cover-fill' + cls + '" style="width: ' + num + 'px;"></span>' +
            '<span class="cover-empty" style="width:' + rest + 'px;"></span>';
    } else {
        return '';
    }
});

handlebars.registerHelper('show_ignores', function (metrics) {
    var statements = metrics.statements.skipped,
        functions = metrics.functions.skipped,
        branches = metrics.branches.skipped,
        result;

    if (statements === 0 && functions === 0 && branches === 0) {
        return '<span class="ignore-none">none</span>';
    }

    result = [];
    // coverage-hack - compact summary
    if (statements >0) { result.push('statements: ' + statements); }
    if (branches >0) { result.push('branches: ' + branches); }
    if (functions >0) { result.push('functions: ' + functions); }

    return result.join('<br>');
});

// coverage-hack - hashtag lineno
handlebars.registerHelper('show_lines', function (opts) {
    var maxLines = Number(opts.fn(this)),
        i,
        array = "";

    for (i = 1; i <= maxLines; i += 1) {
        array += '<a href="#L' + i + '" id="L' + i + '">' + i + '</a>\n';
    }
    return array;
});

handlebars.registerHelper('show_line_execution_counts', function (context, opts) {
    var lines = context.l,
        maxLines = Number(opts.fn(this)),
        i,
        lineNumber,
        array = [],
        covered,
        value = '';

    for (i = 0; i < maxLines; i += 1) {
        lineNumber = i + 1;
        value = '&nbsp;';
        covered = 'neutral';
        if (lines.hasOwnProperty(lineNumber)) {
            if (lines[lineNumber] > 0) {
                covered = 'yes';
                value = lines[lineNumber];
            } else {
                covered = 'no';
            }
        }
        array.push('<span class="cline-any cline-' + covered + '">' + value + '</span>');
    }
    return array.join('\n');
});

function customEscape(text) {
    text = text.toString();
    return text.replace(RE_AMP, '&amp;')
        .replace(RE_LT, '&lt;')
        .replace(RE_GT, '&gt;')
        .replace(RE_lt, '<')
        .replace(RE_gt, '>');
}

handlebars.registerHelper('show_code', function (context /*, opts */) {
    var array = [];

    context.forEach(function (item) {
        array.push(customEscape(item.text) || '&nbsp;');
    });
    return array.join('\n');
});

function title(str) {
    return ' title="' + str + '" ';
}

function annotateLines(fileCoverage, structuredText) {
    var lineStats = fileCoverage.l;
    if (!lineStats) { return; }
    Object.keys(lineStats).forEach(function (lineNumber) {
        var count = lineStats[lineNumber];
        structuredText[lineNumber].covered = count > 0 ? 'yes' : 'no';
    });
    structuredText.forEach(function (item) {
        if (item.covered === null) {
            item.covered = 'neutral';
        }
    });
}

function annotateStatements(fileCoverage, structuredText) {
    var statementStats = fileCoverage.s,
        statementMeta = fileCoverage.statementMap;
    Object.keys(statementStats).forEach(function (stName) {
        var count = statementStats[stName],
            meta = statementMeta[stName],
            type = count > 0 ? 'yes' : 'no',
            startCol = meta.start.column,
            endCol = meta.end.column + 1,
            startLine = meta.start.line,
            endLine = meta.end.line,
            openSpan = lt + 'span class="' + (meta.skip ? 'cstat-skip' : 'cstat-no') + '"' + title('statement not covered') + gt,
            closeSpan = lt + '/span' + gt,
            text;

        if (type === 'no') {
            if (endLine !== startLine) {
                endLine = startLine;
                endCol = structuredText[startLine].text.originalLength();
            }
            text = structuredText[startLine].text;
            text.wrap(startCol,
                openSpan,
                startLine === endLine ? endCol : text.originalLength(),
                closeSpan);
        }
    });
}

function annotateFunctions(fileCoverage, structuredText) {

    var fnStats = fileCoverage.f,
        fnMeta = fileCoverage.fnMap;
    if (!fnStats) { return; }
    Object.keys(fnStats).forEach(function (fName) {
        var count = fnStats[fName],
            meta = fnMeta[fName],
            type = count > 0 ? 'yes' : 'no',
            startCol = meta.loc.start.column,
            endCol = meta.loc.end.column + 1,
            startLine = meta.loc.start.line,
            endLine = meta.loc.end.line,
            openSpan = lt + 'span class="' + (meta.skip ? 'fstat-skip' : 'fstat-no') + '"' + title('function not covered') + gt,
            closeSpan = lt + '/span' + gt,
            text;

        if (type === 'no') {
            if (endLine !== startLine) {
                endLine = startLine;
                endCol = structuredText[startLine].text.originalLength();
            }
            text = structuredText[startLine].text;
            text.wrap(startCol,
                openSpan,
                startLine === endLine ? endCol : text.originalLength(),
                closeSpan);
        }
    });
}

function annotateBranches(fileCoverage, structuredText) {
    var branchStats = fileCoverage.b,
        branchMeta = fileCoverage.branchMap;
    if (!branchStats) { return; }

    Object.keys(branchStats).forEach(function (branchName) {
        var branchArray = branchStats[branchName],
            sumCount = branchArray.reduce(function (p, n) { return p + n; }, 0),
            metaArray = branchMeta[branchName].locations,
            i,
            count,
            meta,
            type,
            startCol,
            endCol,
            startLine,
            endLine,
            openSpan,
            closeSpan,
            text;

        if (sumCount > 0) { //only highlight if partial branches are missing
            for (i = 0; i < branchArray.length; i += 1) {
                count = branchArray[i];
                meta = metaArray[i];
                type = count > 0 ? 'yes' : 'no';
                startCol = meta.start.column;
                endCol = meta.end.column + 1;
                startLine = meta.start.line;
                endLine = meta.end.line;
                openSpan = lt + 'span class="branch-' + i + ' ' + (meta.skip ? 'cbranch-skip' : 'cbranch-no') + '"' + title('branch not covered') + gt;
                closeSpan = lt + '/span' + gt;

                if (count === 0) { //skip branches taken
                    if (endLine !== startLine) {
                        endLine = startLine;
                        endCol = structuredText[startLine].text.originalLength();
                    }
                    text = structuredText[startLine].text;
                    if (branchMeta[branchName].type === 'if') { // and 'if' is a special case since the else branch might not be visible, being non-existent
                        text.insertAt(startCol, lt + 'span class="' + (meta.skip ? 'skip-if-branch' : 'missing-if-branch') + '"' +
                            title((i === 0 ? 'if' : 'else') + ' path not taken') + gt +
                            (i === 0 ? 'I' : 'E')  + lt + '/span' + gt, true, false);
                    } else {
                        text.wrap(startCol,
                            openSpan,
                            startLine === endLine ? endCol : text.originalLength(),
                            closeSpan);
                    }
                }
            }
        }
    });
}

function getReportClass(stats, watermark) {
    var coveragePct = stats.pct,
        identity  = 1;
    if (coveragePct * identity === coveragePct) {
        return coveragePct >= watermark[1] ? 'high' : coveragePct >= watermark[0] ? 'medium' : 'low';
    } else {
        return '';
    }
}

/**
 * a `Report` implementation that produces HTML coverage reports.
 *
 * Usage
 * -----
 *
 *      var report = require('istanbul').Report.create('html');
 *
 *
 * @class HtmlReport
 * @extends Report
 * @constructor
 * @param {Object} opts optional
 * @param {String} [opts.dir] the directory in which to generate reports. Defaults to `./html-report`
 */
function HtmlReport(opts) {
    Report.call(this);
    this.opts = opts || {};
    this.opts.dir = this.opts.dir || path.resolve(process.cwd(), 'html-report');
    this.opts.sourceStore = this.opts.sourceStore || Store.create('fslookup');
    this.opts.linkMapper = this.opts.linkMapper || this.standardLinkMapper();
    this.opts.writer = this.opts.writer || null;
    // coverage-hack - new Date() bugfix
    this.opts.templateData = { datetime: new Date().toGMTString() };
    this.opts.watermarks = this.opts.watermarks || defaults.watermarks();
}

HtmlReport.TYPE = 'html';
util.inherits(HtmlReport, Report);

Report.mix(HtmlReport, {

    getPathHtml: function (node, linkMapper) {
        var parent = node.parent,
            nodePath = [],
            linkPath = [],
            i;

        while (parent) {
            nodePath.push(parent);
            parent = parent.parent;
        }

        for (i = 0; i < nodePath.length; i += 1) {
            linkPath.push('<a href="' + linkMapper.ancestor(node, i + 1) + '">' +
                (nodePath[i].relativeName || 'All files') + '</a>');
        }
        linkPath.reverse();
        return linkPath.length > 0 ? linkPath.join(' &#187; ') + ' &#187; ' +
            node.displayShortName() : '';
    },

    fillTemplate: function (node, templateData) {
        var opts = this.opts,
            linkMapper = opts.linkMapper;

        templateData.entity = node.name || 'All files';
        templateData.metrics = node.metrics;
        templateData.reportClass = getReportClass(node.metrics.statements, opts.watermarks.statements);
        templateData.pathHtml = pathTemplate({ html: this.getPathHtml(node, linkMapper) });
        templateData.prettify = {
            js: linkMapper.asset(node, 'prettify.js'),
            css: linkMapper.asset(node, 'prettify.css')
        };
    },
    writeDetailPage: function (writer, node, fileCoverage) {
        var opts = this.opts,
            sourceStore = opts.sourceStore,
            templateData = opts.templateData,
            sourceText = fileCoverage.code && Array.isArray(fileCoverage.code) ?
                fileCoverage.code.join('\n') + '\n' : sourceStore.get(fileCoverage.path),
            code = sourceText.split(/(?:\r?\n)|\r/),
            count = 0,
            structured = code.map(function (str) { count += 1; return { line: count, covered: null, text: new InsertionText(str, true) }; }),
            context;

        structured.unshift({ line: 0, covered: null, text: new InsertionText("") });

        this.fillTemplate(node, templateData);
        writer.write(headerTemplate(templateData));
        writer.write('<pre><table class="coverage">\n');

        annotateLines(fileCoverage, structured);
        //note: order is important, since statements typically result in spanning the whole line and doing branches late
        //causes mismatched tags
        annotateBranches(fileCoverage, structured);
        annotateFunctions(fileCoverage, structured);
        annotateStatements(fileCoverage, structured);

        structured.shift();
        context = {
            structured: structured,
            maxLines: structured.length,
            fileCoverage: fileCoverage
        };
        writer.write(detailTemplate(context));
        writer.write('</table></pre>\n');
        writer.write(footerTemplate(templateData));
    },

    writeIndexPage: function (writer, node) {
        var linkMapper = this.opts.linkMapper,
            templateData = this.opts.templateData,
            children = Array.prototype.slice.apply(node.children),
            watermarks = this.opts.watermarks;

        children.sort(function (a, b) {
            return a.name < b.name ? -1 : 1;
        });

        this.fillTemplate(node, templateData);
        writer.write(headerTemplate(templateData));
        writer.write(summaryTableHeader);
        children.forEach(function (child) {
            var metrics = child.metrics,
                reportClasses = {
                    statements: getReportClass(metrics.statements, watermarks.statements),
                    lines: getReportClass(metrics.lines, watermarks.lines),
                    functions: getReportClass(metrics.functions, watermarks.functions),
                    branches: getReportClass(metrics.branches, watermarks.branches)
                },
                data = {
                    metrics: metrics,
                    reportClasses: reportClasses,
                    file: child.displayShortName(),
                    output: linkMapper.fromParent(child)
                };
            writer.write(summaryLineTemplate(data) + '\n');
        });
        writer.write(summaryTableFooter);
        writer.write(footerTemplate(templateData));
    },

    writeFiles: function (writer, node, dir, collector) {
        var that = this,
            indexFile = path.resolve(dir, 'index.html'),
            childFile;
        if (this.opts.verbose) { console.error('Writing ' + indexFile); }
        writer.writeFile(indexFile, function (contentWriter) {
            that.writeIndexPage(contentWriter, node);
        });
        node.children.forEach(function (child) {
            if (child.kind === 'dir') {
                that.writeFiles(writer, child, path.resolve(dir, child.relativeName), collector);
            } else {
                childFile = path.resolve(dir, child.relativeName + '.html');
                if (that.opts.verbose) { console.error('Writing ' + childFile); }
                writer.writeFile(childFile, function (contentWriter) {
                    that.writeDetailPage(contentWriter, child, collector.fileCoverageFor(child.fullPath()));
                });
            }
        });
    },

    standardLinkMapper: function () {
        return {
            fromParent: function (node) {
                var i = 0,
                    relativeName = node.relativeName,
                    ch;
                if (SEP !== '/') {
                    relativeName = '';
                    for (i = 0; i < node.relativeName.length; i += 1) {
                        ch = node.relativeName.charAt(i);
                        if (ch === SEP) {
                            relativeName += '/';
                        } else {
                            relativeName += ch;
                        }
                    }
                }
                return node.kind === 'dir' ? relativeName + 'index.html' : relativeName + '.html';
            },
            ancestorHref: function (node, num) {
                var href = '',
                    separated,
                    levels,
                    i,
                    j;
                for (i = 0; i < num; i += 1) {
                    separated = node.relativeName.split(SEP);
                    levels = separated.length - 1;
                    for (j = 0; j < levels; j += 1) {
                        href += '../';
                    }
                    node = node.parent;
                }
                return href;
            },
            ancestor: function (node, num) {
                return this.ancestorHref(node, num) + 'index.html';
            },
            asset: function (node, name) {
                var i = 0,
                    parent = node.parent;
                while (parent) { i += 1; parent = parent.parent; }
                return this.ancestorHref(node, i) + name;
            }
        };
    },

    writeReport: function (collector, sync) {
        var opts = this.opts,
            dir = opts.dir,
            summarizer = new TreeSummarizer(),
            writer = opts.writer || new FileWriter(sync),
            tree;

        collector.files().forEach(function (key) {
            summarizer.addFileCoverageSummary(key, utils.summarizeFileCoverage(collector.fileCoverageFor(key)));
        });
        tree = summarizer.getTreeSummary();
        fs.readdirSync(path.resolve(__dirname, '..', 'vendor')).forEach(function (f) {
            var resolvedSource = path.resolve(__dirname, '..', 'vendor', f),
                resolvedDestination = path.resolve(dir, f),
                stat = fs.statSync(resolvedSource);

            if (stat.isFile()) {
                if (opts.verbose) {
                    console.log('Write asset: ' + resolvedDestination);
                }
                writer.copyFile(resolvedSource, resolvedDestination);
            }
        });
        //console.log(JSON.stringify(tree.root, undefined, 4));
        this.writeFiles(writer, tree.root, dir, collector);
    }
});

module.exports = HtmlReport;
local.HtmlReport = module.exports; }());



/*
file https://github.com/gotwarlost/istanbul/blob/v0.2.16/lib/report/text.js
*/
/* istanbul ignore next */
(function () { var module; module = {};
/*
 Copyright (c) 2012, Yahoo! Inc.  All rights reserved.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */

var path = require('path'),
    mkdirp = require('mkdirp'),
    fs = require('fs'),
    defaults = require('./common/defaults'),
    Report = require('./index'),
    TreeSummarizer = require('../util/tree-summarizer'),
    utils = require('../object-utils'),
    PCT_COLS = 10,
    TAB_SIZE = 3,
    DELIM = ' |',
    COL_DELIM = '-|';

/**
 * a `Report` implementation that produces text output in a detailed table.
 *
 * Usage
 * -----
 *
 *      var report = require('istanbul').Report.create('text');
 *
 * @class TextReport
 * @extends Report
 * @constructor
 * @param {Object} opts optional
 * @param {String} [opts.dir] the directory in which to the text coverage report will be written, when writing to a file
 * @param {String} [opts.file] the filename for the report. When omitted, the report is written to console
 * @param {Number} [opts.maxcols] the max column width of the report. By default, the width of the report is adjusted based on the length of the paths
 *              to be reported.
 */
function TextReport(opts) {
    Report.call(this);
    opts = opts || {};
    this.dir = opts.dir || process.cwd();
    this.file = opts.file;
    this.summary = opts.summary;
    this.maxCols = opts.maxCols || 0;
    this.watermarks = opts.watermarks || defaults.watermarks();
}

TextReport.TYPE = 'text';

function padding(num, ch) {
    var str = '',
        i;
    ch = ch || ' ';
    for (i = 0; i < num; i += 1) {
        str += ch;
    }
    return str;
}

function fill(str, width, right, tabs, clazz) {
    tabs = tabs || 0;
    str = String(str);

    var leadingSpaces = tabs * TAB_SIZE,
        remaining = width - leadingSpaces,
        leader = padding(leadingSpaces),
        fmtStr = '',
        fillStr,
        strlen = str.length;

    if (remaining > 0) {
        if (remaining >= strlen) {
            fillStr = padding(remaining - strlen);
            fmtStr = right ? fillStr + str : str + fillStr;
        } else {
            fmtStr = str.substring(strlen - remaining);
            fmtStr = '... ' + fmtStr.substring(4);
        }
    }

    fmtStr = defaults.colorize(fmtStr, clazz);
    return leader + fmtStr;
}

function formatName(name, maxCols, level, clazz) {
    return fill(name, maxCols, false, level, clazz);
}

function formatPct(pct, clazz) {
    return fill(pct, PCT_COLS, true, 0, clazz);
}

function nodeName(node) {
    return node.displayShortName() || 'All files';
}

function tableHeader(maxNameCols) {
    var elements = [];
    elements.push(formatName('File', maxNameCols, 0));
    elements.push(formatPct('% Stmts'));
    elements.push(formatPct('% Branches'));
    elements.push(formatPct('% Funcs'));
    elements.push(formatPct('% Lines'));
    return elements.join(' |') + ' |';
}

function tableRow(node, maxNameCols, level, watermarks) {
    var name = nodeName(node),
        statements = node.metrics.statements.pct,
        branches = node.metrics.branches.pct,
        functions = node.metrics.functions.pct,
        lines = node.metrics.lines.pct,
        elements = [];

    elements.push(formatName(name, maxNameCols, level, defaults.classFor('statements', node.metrics, watermarks)));
    elements.push(formatPct(statements, defaults.classFor('statements', node.metrics, watermarks)));
    elements.push(formatPct(branches, defaults.classFor('branches', node.metrics, watermarks)));
    elements.push(formatPct(functions, defaults.classFor('functions', node.metrics, watermarks)));
    elements.push(formatPct(lines, defaults.classFor('lines', node.metrics, watermarks)));

    return elements.join(DELIM) + DELIM;
}

function findNameWidth(node, level, last) {
    last = last || 0;
    level = level || 0;
    var idealWidth = TAB_SIZE * level + nodeName(node).length;
    if (idealWidth > last) {
        last = idealWidth;
    }
    node.children.forEach(function (child) {
        last = findNameWidth(child, level + 1, last);
    });
    return last;
}

function makeLine(nameWidth) {
    var name = padding(nameWidth, '-'),
        pct = padding(PCT_COLS, '-'),
        elements = [];

    elements.push(name);
    elements.push(pct);
    elements.push(pct);
    elements.push(pct);
    elements.push(pct);
    return elements.join(COL_DELIM) + COL_DELIM;
}

function walk(node, nameWidth, array, level, watermarks) {
    var line;
    if (level === 0) {
        line = makeLine(nameWidth);
        array.push(line);
        array.push(tableHeader(nameWidth));
        array.push(line);
    } else {
        array.push(tableRow(node, nameWidth, level, watermarks));
    }
    node.children.forEach(function (child) {
        walk(child, nameWidth, array, level + 1, watermarks);
    });
    if (level === 0) {
        array.push(line);
        array.push(tableRow(node, nameWidth, level, watermarks));
        array.push(line);
    }
}

Report.mix(TextReport, {
    writeReport: function (collector /*, sync */) {
        var summarizer = new TreeSummarizer(),
            tree,
            root,
            nameWidth,
            statsWidth = 4 * ( PCT_COLS + 2),
            maxRemaining,
            strings = [],
            text;

        collector.files().forEach(function (key) {
            summarizer.addFileCoverageSummary(key, utils.summarizeFileCoverage(collector.fileCoverageFor(key)));
        });
        tree = summarizer.getTreeSummary();
        root = tree.root;
        nameWidth = findNameWidth(root);
        if (this.maxCols > 0) {
            maxRemaining = this.maxCols - statsWidth - 2;
            if (nameWidth > maxRemaining) {
                nameWidth = maxRemaining;
            }
        }
        walk(root, nameWidth, strings, 0, this.watermarks);
        text = strings.join('\n') + '\n';
        if (this.file) {
            mkdirp.sync(this.dir);
            fs.writeFileSync(path.join(this.dir, this.file), text, 'utf8');
        } else {
            console.log(text);
        }
    }
});

module.exports = TextReport;
local.TextReport = module.exports; }());



/*
file https://img.shields.io/badge/coverage-100.0%-00dd00.svg?style=flat
*/
local.templateCoverageBadgeSvg =
'<svg xmlns="http://www.w3.org/2000/svg" width="117" height="20"><linearGradient id="a" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><rect rx="0" width="117" height="20" fill="#555"/><rect rx="0" x="63" width="54" height="20" fill="#0d0"/><path fill="#0d0" d="M63 0h4v20h-4z"/><rect rx="0" width="117" height="20" fill="url(#a)"/><g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11"><text x="32.5" y="15" fill="#010101" fill-opacity=".3">coverage</text><text x="32.5" y="14">coverage</text><text x="89" y="15" fill="#010101" fill-opacity=".3">100.0%</text><text x="89" y="14">100.0%</text></g></svg>';



/*
file none
*/
/* jslint ignore:end */
}());



// run node js-env code - init-after
/* istanbul ignore next */
(function () {
if (local.isBrowser) {
    return;
}



local.cliDict = {};
local.cliDict.cover = function () {
/*
 * <script>
 * will run and cover <script>
 */
    var tmp;
    try {
        tmp = JSON.parse(local.fs.readFileSync("package.json", "utf8"));
        process.env.npm_package_nameLib = (
            process.env.npm_package_nameLib
            || tmp.nameLib
            || tmp.name.replace((
                /-/g
            ), "_")
        );
    } catch (ignore) {}
    process.env.npm_config_mode_coverage = (
        process.env.npm_config_mode_coverage
        || process.env.npm_package_nameLib
        || "all"
    );
    // add coverage hook to require
    local._istanbul_moduleExtensionsJs = (
        local._istanbul_module._extensions[".js"]
    );
    local._istanbul_module._extensions[".js"] = function (module, file) {
        if (typeof file === "string" && (
            file.indexOf(process.env.npm_config_mode_coverage_dir) === 0 || (
                file.indexOf(process.cwd()) === 0
                && file.indexOf(process.cwd() + "/node_modules/") !== 0
            )
        )) {
            module._compile(local.instrumentInPackage(
                local.fs.readFileSync(file, "utf8"),
                file
            ), file);
            return;
        }
        local._istanbul_moduleExtensionsJs(module, file);
    };
    // init process.argv
    process.argv.splice(1, 2);
    process.argv[1] = local.path.resolve(process.cwd(), process.argv[1]);
    console.log("\ncovering $ " + process.argv.join(" "));
    // create coverage on exit
    process.on("exit", function () {
        local.coverageReportCreate({
            coverage: globalThis.__coverage__
        });
    });
    // re-init cli
    local._istanbul_module.runMain();
};

local.cliDict.instrument = function () {
/*
 * <script>
 * will instrument <script> and print result to stdout
 */
    process.argv[3] = local.path.resolve(process.cwd(), process.argv[3]);
    process.stdout.write(local.instrumentSync(
        local.fs.readFileSync(process.argv[3], "utf8"),
        process.argv[3]
    ));
};

//
local.cliDict.test = function () {
/*
 * <script>
 * will run and cover <script> if env var $npm_config_mode_coverage is set
 */
    if (process.env.npm_config_mode_coverage) {
        process.argv[2] = "cover";
        // re-init cli
        local.cliDict[process.argv[2]]();
        return;
    }
    // restart node with __filename removed from process.argv
    process.argv.splice(1, 2);
    process.argv[1] = local.path.resolve(process.cwd(), process.argv[1]);
    // re-init cli
    local._istanbul_module.runMain();
};

// run the cli
if (module === require.main && !globalThis.utility2_rollup) {
    local.cliRun();
}
}());



}());
/* script-end /assets.utility2.lib.istanbul.js */



/* script-begin /assets.utility2.lib.jslint.js */
// usr/bin/env node
/*
 * lib.jslint.js (2019.8.10)
 * https://github.com/kaizhu256/node-jslint-lite
 * this zero-dependency package will provide browser-compatible versions of jslint (v2018.10.26) and csslint (v1.0.5), with a working web-demo
 *
 */



/* istanbul instrument in package jslint */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_jslint = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.jslint = local;



/* validateLineSortedReset */
local.cliRun = function (opt) {
/*
 * this function will run the cli with given <opt>
 */
    local.cliDict._eval = local.cliDict._eval || function () {
    /*
     * <code>
     * will eval <code>
     */
        globalThis.local = local;
        local.vm.runInThisContext(process.argv[3]);
    };
    local.cliDict["--eval"] = local.cliDict["--eval"] || local.cliDict._eval;
    local.cliDict["-e"] = local.cliDict["-e"] || local.cliDict._eval;
    local.cliDict._help = local.cliDict._help || function () {
    /*
     *
     * will print help
     */
        var commandList;
        var file;
        var packageJson;
        var text;
        var textDict;
        commandList = [
            {
                argList: "<arg2>  ...",
                description: "usage:",
                command: [
                    "<arg1>"
                ]
            }, {
                argList: "'console.log(\"hello world\")'",
                description: "example:",
                command: [
                    "--eval"
                ]
            }
        ];
        file = __filename.replace((
            /.*\//
        ), "");
        opt = Object.assign({}, opt);
        packageJson = require("./package.json");
        // validate comment
        opt.rgxComment = opt.rgxComment || (
            /\)\u0020\{\n(?:|\u0020{4})\/\*\n(?:\u0020|\u0020{5})\*((?:\u0020<[^>]*?>|\u0020\.\.\.)*?)\n(?:\u0020|\u0020{5})\*\u0020(will\u0020.*?\S)\n(?:\u0020|\u0020{5})\*\/\n(?:\u0020{4}|\u0020{8})\S/
        );
        textDict = {};
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {
            if (key[0] === "_" && key !== "_default") {
                return;
            }
            text = String(local.cliDict[key]);
            if (key === "_default") {
                key = "";
            }
            textDict[text] = textDict[text] || (ii + 2);
            ii = textDict[text];
            if (commandList[ii]) {
                commandList[ii].command.push(key);
                return;
            }
            try {
                commandList[ii] = opt.rgxComment.exec(text);
                commandList[ii] = {
                    argList: (commandList[ii][1] || "").trim(),
                    command: [
                        key
                    ],
                    description: commandList[ii][2]
                };
            } catch (ignore) {
                local.assertThrow(null, new Error(
                    "cliRun - cannot parse comment in COMMAND "
                    + key
                    + ":\nnew RegExp("
                    + JSON.stringify(opt.rgxComment.source)
                    + ").exec(" + JSON.stringify(text).replace((
                        /\\\\/g
                    ), "\u0000").replace((
                        /\\n/g
                    ), "\\n\\\n").replace((
                        /\u0000/g
                    ), "\\\\") + ");"
                ));
            }
        });
        text = "";
        text += packageJson.name + " (" + packageJson.version + ")\n\n";
        text += commandList.filter(function (elem) {
            return elem;
        }).map(function (elem, ii) {
            elem.command = elem.command.filter(function (elem) {
                return elem;
            });
            switch (ii) {
            case 0:
            case 1:
                elem.argList = [
                    elem.argList
                ];
                break;
            default:
                elem.argList = elem.argList.split(" ");
                elem.description = (
                    "# COMMAND "
                    + (elem.command[0] || "<none>") + "\n# "
                    + elem.description
                );
            }
            return (
                elem.description + "\n  " + file
                + ("  " + elem.command.sort().join("|") + "  ")
                    .replace((
                    /^\u0020{4}$/
                ), "  ")
                + elem.argList.join("  ")
            );
        })
        .join("\n\n");
        console.log(text);
    };
    local.cliDict["--help"] = local.cliDict["--help"] || local.cliDict._help;
    local.cliDict["-h"] = local.cliDict["-h"] || local.cliDict._help;
    local.cliDict._default = local.cliDict._default || local.cliDict._help;
    local.cliDict.help = local.cliDict.help || local.cliDict._help;
    local.cliDict._interactive = local.cliDict._interactive || function () {
    /*
     *
     * will start interactive-mode
     */
        globalThis.local = local;
        local.identity(local.replStart || require("repl").start)({
            useGlobal: true
        });
    };
    local.cliDict["--interactive"] = (
        local.cliDict["--interactive"]
        || local.cliDict._interactive
    );
    local.cliDict["-i"] = local.cliDict["-i"] || local.cliDict._interactive;
    local.cliDict._version = local.cliDict._version || function () {
    /*
     *
     * will print version
     */
        console.log(require(__dirname + "/package.json").version);
    };
    local.cliDict["--version"] = (
        local.cliDict["--version"]
        || local.cliDict._version
    );
    local.cliDict["-v"] = local.cliDict["-v"] || local.cliDict._version;
    // default to --help command if no arguments are given
    if (process.argv.length <= 2) {
        local.cliDict._help();
        return;
    }
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        return;
    }
    local.cliDict._default();
};

local.jsonStringifyOrdered = function (obj, replacer, space) {
/*
 * this function will JSON.stringify <obj>,
 * with object-keys sorted and circular-references removed
 * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Syntax
 */
    var circularSet;
    var stringify;
    var tmp;
    stringify = function (obj) {
    /*
     * this function will recursively JSON.stringify obj,
     * with object-keys sorted and circular-references removed
     */
        // if obj is not an object or function, then JSON.stringify as normal
        if (!(
            obj
            && typeof obj === "object"
            && typeof obj.toJSON !== "function"
        )) {
            return JSON.stringify(obj);
        }
        // ignore circular-reference
        if (circularSet.has(obj)) {
            return;
        }
        circularSet.add(obj);
        // if obj is an array, then recurse its items
        if (Array.isArray(obj)) {
            tmp = "[" + obj.map(function (obj) {
                // recurse
                tmp = stringify(obj);
                return (
                    typeof tmp === "string"
                    ? tmp
                    : "null"
                );
            }).join(",") + "]";
            circularSet.delete(obj);
            return tmp;
        }
        // if obj is not an array,
        // then recurse its items with object-keys sorted
        tmp = "{" + Object.keys(obj).sort().map(function (key) {
            // recurse
            tmp = stringify(obj[key]);
            if (typeof tmp === "string") {
                return JSON.stringify(key) + ":" + tmp;
            }
        }).filter(function (obj) {
            return typeof obj === "string";
        }).join(",") + "}";
        circularSet.delete(obj);
        return tmp;
    };
    circularSet = new Set();
    return JSON.stringify((
        (typeof obj === "object" && obj)
        // recurse
        ? JSON.parse(stringify(obj))
        : obj
    ), replacer, space);
};

local.onErrorWithStack = function (onError) {
/*
 * this function will create wrapper around <onError>
 * that will append current-stack to err.stack
 */
    var onError2;
    var stack;
    stack = new Error().stack.replace((
        /(.*?)\n.*?$/m
    ), "$1");
    onError2 = function (err, data, meta) {
        if (
            err
            && typeof err.stack === "string"
            && err !== local.errDefault
            && String(err.stack).indexOf(stack.split("\n")[2]) < 0
        ) {
            // append current-stack to err.stack
            err.stack += "\n" + stack;
        }
        onError(err, data, meta);
    };
    // debug onError
    onError2.toString = function () {
        return String(onError);
    };
    return onError2;
};

local.onParallel = function (onError, onEach, onRetry) {
/*
 * this function will create a function that will
 * 1. run async tasks in parallel
 * 2. if counter === 0 or err occurred, then call onError(err)
 */
    var onParallel;
    onError = local.onErrorWithStack(onError);
    onEach = onEach || local.nop;
    onRetry = onRetry || local.nop;
    onParallel = function (err, data) {
        if (onRetry(err, data)) {
            return;
        }
        // decrement counter
        onParallel.counter -= 1;
        // validate counter
        if (!(onParallel.counter >= 0 || err || onParallel.err)) {
            err = new Error(
                "invalid onParallel.counter = " + onParallel.counter
            );
        // ensure onError is run only once
        } else if (onParallel.counter < 0) {
            return;
        }
        // handle err
        if (err) {
            onParallel.err = err;
            // ensure counter <= 0
            onParallel.counter = -Math.abs(onParallel.counter);
        }
        // call onError when isDone
        if (onParallel.counter <= 0) {
            onError(err, data);
            return;
        }
        onEach();
    };
    // init counter
    onParallel.counter = 0;
    // return callback
    return onParallel;
};
}());



/* istanbul ignore next */
// run shared js-env code - function
(function () {
/*
file https://github.com/CSSLint/csslint/blob/v1.0.5/dist/csslint.js
*/
/* jslint ignore:start */
/*!
CSSLint v1.0.4
Copyright (c) 2016 Nicole Sullivan and Nicholas C. Zakas. All rights reserved.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the 'Software'), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/

var CSSLint = (function(){
  var module = module || {},
      exports = exports || {};

/*!
Parser-Lib
Copyright (c) 2009-2016 Nicholas C. Zakas. All rights reserved.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
/* Version v1.1.0, Build time: 6-December-2016 10:31:29 */
var parserlib = (function () {
var require;
require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

/* exported Colors */

var Colors = module.exports = {
    __proto__       :null,
    aliceblue       :"#f0f8ff",
    antiquewhite    :"#faebd7",
    aqua            :"#00ffff",
    aquamarine      :"#7fffd4",
    azure           :"#f0ffff",
    beige           :"#f5f5dc",
    bisque          :"#ffe4c4",
    black           :"#000000",
    blanchedalmond  :"#ffebcd",
    blue            :"#0000ff",
    blueviolet      :"#8a2be2",
    brown           :"#a52a2a",
    burlywood       :"#deb887",
    cadetblue       :"#5f9ea0",
    chartreuse      :"#7fff00",
    chocolate       :"#d2691e",
    coral           :"#ff7f50",
    cornflowerblue  :"#6495ed",
    cornsilk        :"#fff8dc",
    crimson         :"#dc143c",
    cyan            :"#00ffff",
    darkblue        :"#00008b",
    darkcyan        :"#008b8b",
    darkgoldenrod   :"#b8860b",
    darkgray        :"#a9a9a9",
    darkgrey        :"#a9a9a9",
    darkgreen       :"#006400",
    darkkhaki       :"#bdb76b",
    darkmagenta     :"#8b008b",
    darkolivegreen  :"#556b2f",
    darkorange      :"#ff8c00",
    darkorchid      :"#9932cc",
    darkred         :"#8b0000",
    darksalmon      :"#e9967a",
    darkseagreen    :"#8fbc8f",
    darkslateblue   :"#483d8b",
    darkslategray   :"#2f4f4f",
    darkslategrey   :"#2f4f4f",
    darkturquoise   :"#00ced1",
    darkviolet      :"#9400d3",
    deeppink        :"#ff1493",
    deepskyblue     :"#00bfff",
    dimgray         :"#696969",
    dimgrey         :"#696969",
    dodgerblue      :"#1e90ff",
    firebrick       :"#b22222",
    floralwhite     :"#fffaf0",
    forestgreen     :"#228b22",
    fuchsia         :"#ff00ff",
    gainsboro       :"#dcdcdc",
    ghostwhite      :"#f8f8ff",
    gold            :"#ffd700",
    goldenrod       :"#daa520",
    gray            :"#808080",
    grey            :"#808080",
    green           :"#008000",
    greenyellow     :"#adff2f",
    honeydew        :"#f0fff0",
    hotpink         :"#ff69b4",
    indianred       :"#cd5c5c",
    indigo          :"#4b0082",
    ivory           :"#fffff0",
    khaki           :"#f0e68c",
    lavender        :"#e6e6fa",
    lavenderblush   :"#fff0f5",
    lawngreen       :"#7cfc00",
    lemonchiffon    :"#fffacd",
    lightblue       :"#add8e6",
    lightcoral      :"#f08080",
    lightcyan       :"#e0ffff",
    lightgoldenrodyellow  :"#fafad2",
    lightgray       :"#d3d3d3",
    lightgrey       :"#d3d3d3",
    lightgreen      :"#90ee90",
    lightpink       :"#ffb6c1",
    lightsalmon     :"#ffa07a",
    lightseagreen   :"#20b2aa",
    lightskyblue    :"#87cefa",
    lightslategray  :"#778899",
    lightslategrey  :"#778899",
    lightsteelblue  :"#b0c4de",
    lightyellow     :"#ffffe0",
    lime            :"#00ff00",
    limegreen       :"#32cd32",
    linen           :"#faf0e6",
    magenta         :"#ff00ff",
    maroon          :"#800000",
    mediumaquamarine:"#66cdaa",
    mediumblue      :"#0000cd",
    mediumorchid    :"#ba55d3",
    mediumpurple    :"#9370d8",
    mediumseagreen  :"#3cb371",
    mediumslateblue :"#7b68ee",
    mediumspringgreen   :"#00fa9a",
    mediumturquoise :"#48d1cc",
    mediumvioletred :"#c71585",
    midnightblue    :"#191970",
    mintcream       :"#f5fffa",
    mistyrose       :"#ffe4e1",
    moccasin        :"#ffe4b5",
    navajowhite     :"#ffdead",
    navy            :"#000080",
    oldlace         :"#fdf5e6",
    olive           :"#808000",
    olivedrab       :"#6b8e23",
    orange          :"#ffa500",
    orangered       :"#ff4500",
    orchid          :"#da70d6",
    palegoldenrod   :"#eee8aa",
    palegreen       :"#98fb98",
    paleturquoise   :"#afeeee",
    palevioletred   :"#d87093",
    papayawhip      :"#ffefd5",
    peachpuff       :"#ffdab9",
    peru            :"#cd853f",
    pink            :"#ffc0cb",
    plum            :"#dda0dd",
    powderblue      :"#b0e0e6",
    purple          :"#800080",
    red             :"#ff0000",
    rosybrown       :"#bc8f8f",
    royalblue       :"#4169e1",
    saddlebrown     :"#8b4513",
    salmon          :"#fa8072",
    sandybrown      :"#f4a460",
    seagreen        :"#2e8b57",
    seashell        :"#fff5ee",
    sienna          :"#a0522d",
    silver          :"#c0c0c0",
    skyblue         :"#87ceeb",
    slateblue       :"#6a5acd",
    slategray       :"#708090",
    slategrey       :"#708090",
    snow            :"#fffafa",
    springgreen     :"#00ff7f",
    steelblue       :"#4682b4",
    tan             :"#d2b48c",
    teal            :"#008080",
    thistle         :"#d8bfd8",
    tomato          :"#ff6347",
    turquoise       :"#40e0d0",
    violet          :"#ee82ee",
    wheat           :"#f5deb3",
    white           :"#ffffff",
    whitesmoke      :"#f5f5f5",
    yellow          :"#ffff00",
    yellowgreen     :"#9acd32",
    //'currentColor' color keyword https://www.w3.org/TR/css3-color/#currentcolor
    currentColor        :"The value of the 'color' property.",
    //CSS2 system colors https://www.w3.org/TR/css3-color/#css2-system
    activeBorder        :"Active window border.",
    activecaption       :"Active window caption.",
    appworkspace        :"Background color of multiple document interface.",
    background          :"Desktop background.",
    buttonface          :"The face background color for 3-D elements that appear 3-D due to one layer of surrounding border.",
    buttonhighlight     :"The color of the border facing the light source for 3-D elements that appear 3-D due to one layer of surrounding border.",
    buttonshadow        :"The color of the border away from the light source for 3-D elements that appear 3-D due to one layer of surrounding border.",
    buttontext          :"Text on push buttons.",
    captiontext         :"Text in caption, size box, and scrollbar arrow box.",
    graytext            :"Grayed (disabled) text. This color is set to #000 if the current display driver does not support a solid gray color.",
    greytext            :"Greyed (disabled) text. This color is set to #000 if the current display driver does not support a solid grey color.",
    highlight           :"Item(s) selected in a control.",
    highlighttext       :"Text of item(s) selected in a control.",
    inactiveborder      :"Inactive window border.",
    inactivecaption     :"Inactive window caption.",
    inactivecaptiontext :"Color of text in an inactive caption.",
    infobackground      :"Background color for tooltip controls.",
    infotext            :"Text color for tooltip controls.",
    menu                :"Menu background.",
    menutext            :"Text in menus.",
    scrollbar           :"Scroll bar gray area.",
    threeddarkshadow    :"The color of the darker (generally outer) of the two borders away from the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",
    threedface          :"The face background color for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",
    threedhighlight     :"The color of the lighter (generally outer) of the two borders facing the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",
    threedlightshadow   :"The color of the darker (generally inner) of the two borders facing the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",
    threedshadow        :"The color of the lighter (generally inner) of the two borders away from the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",
    window              :"Window background.",
    windowframe         :"Window frame.",
    windowtext          :"Text in windows."
};
},{}],2:[function(require,module,exports){
"use strict";

module.exports = Combinator;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");

/**
 * Represents a selector combinator (whitespace, +, >).
 * @namespace parserlib.css
 * @class Combinator
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 * @param {String} text The text representation of the unit.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 */
function Combinator(text, line, col) {

    SyntaxUnit.call(this, text, line, col, Parser.COMBINATOR_TYPE);

    /**
     * The type of modifier.
     * @type String
     * @property type
     */
    this.type = "unknown";

    //pretty simple
    if (/^\s+$/.test(text)) {
        this.type = "descendant";
    } else if (text === ">") {
        this.type = "child";
    } else if (text === "+") {
        this.type = "adjacent-sibling";
    } else if (text === "~") {
        this.type = "sibling";
    }
}

Combinator.prototype = new SyntaxUnit();
Combinator.prototype.constructor = Combinator;
},{"../util/SyntaxUnit":26,"./Parser":6}],3:[function(require,module,exports){
"use strict";

module.exports = Matcher;

var StringReader = require("../util/StringReader");
var SyntaxError = require("../util/SyntaxError");

/**
 * This class implements a combinator library for matcher functions.
 * The combinators are described at:
 * https://developer.mozilla.org/en-US/docs/Web/CSS/Value_definition_syntax#Component_value_combinators
 */
function Matcher(matchFunc, toString) {
    this.match = function(expression) {
        // Save/restore marks to ensure that failed matches always restore
        // the original location in the expression.
        var result;
        expression.mark();
        result = matchFunc(expression);
        if (result) {
            expression.drop();
        } else {
            expression.restore();
        }
        return result;
    };
    this.toString = typeof toString === "function" ? toString : function() {
        return toString;
    };
}

/** Precedence table of combinators. */
Matcher.prec = {
    MOD:    5,
    SEQ:    4,
    ANDAND: 3,
    OROR:   2,
    ALT:    1
};

/** Simple recursive-descent grammar to build matchers from strings. */
Matcher.parse = function(str) {
    var reader, eat, expr, oror, andand, seq, mod, term, result;
    reader = new StringReader(str);
    eat = function(matcher) {
        var result = reader.readMatch(matcher);
        if (result === null) {
            throw new SyntaxError(
                "Expected "+matcher, reader.getLine(), reader.getCol());
        }
        return result;
    };
    expr = function() {
        // expr = oror (" | " oror)*
        var m = [ oror() ];
        while (reader.readMatch(" | ") !== null) {
            m.push(oror());
        }
        return m.length === 1 ? m[0] : Matcher.alt.apply(Matcher, m);
    };
    oror = function() {
        // oror = andand ( " || " andand)*
        var m = [ andand() ];
        while (reader.readMatch(" || ") !== null) {
            m.push(andand());
        }
        return m.length === 1 ? m[0] : Matcher.oror.apply(Matcher, m);
    };
    andand = function() {
        // andand = seq ( " && " seq)*
        var m = [ seq() ];
        while (reader.readMatch(" && ") !== null) {
            m.push(seq());
        }
        return m.length === 1 ? m[0] : Matcher.andand.apply(Matcher, m);
    };
    seq = function() {
        // seq = mod ( " " mod)*
        var m = [ mod() ];
        while (reader.readMatch(/^ (?![&|\]])/) !== null) {
            m.push(mod());
        }
        return m.length === 1 ? m[0] : Matcher.seq.apply(Matcher, m);
    };
    mod = function() {
        // mod = term ( "?" | "*" | "+" | "#" | "{<num>,<num>}" )?
        var m = term();
        if (reader.readMatch("?") !== null) {
            return m.question();
        } else if (reader.readMatch("*") !== null) {
            return m.star();
        } else if (reader.readMatch("+") !== null) {
            return m.plus();
        } else if (reader.readMatch("#") !== null) {
            return m.hash();
        } else if (reader.readMatch(/^\{\s*/) !== null) {
            var min = eat(/^\d+/);
            eat(/^\s*,\s*/);
            var max = eat(/^\d+/);
            eat(/^\s*\}/);
            return m.braces(+min, +max);
        }
        return m;
    };
    term = function() {
        // term = <nt> | literal | "[ " expression " ]"
        if (reader.readMatch("[ ") !== null) {
            var m = expr();
            eat(" ]");
            return m;
        }
        return Matcher.fromType(eat(/^[^ ?*+#{]+/));
    };
    result = expr();
    if (!reader.eof()) {
        throw new SyntaxError(
            "Expected end of string", reader.getLine(), reader.getCol());
    }
    return result;
};

/**
 * Convert a string to a matcher (parsing simple alternations),
 * or do nothing if the argument is already a matcher.
 */
Matcher.cast = function(m) {
    if (m instanceof Matcher) {
        return m;
    }
    return Matcher.parse(m);
};

/**
 * Create a matcher for a single type.
 */
Matcher.fromType = function(type) {
    // Late require of ValidationTypes to break a dependency cycle.
    var ValidationTypes = require("./ValidationTypes");
    return new Matcher(function(expression) {
        return expression.hasNext() && ValidationTypes.isType(expression, type);
    }, type);
};

/**
 * Create a matcher for one or more juxtaposed words, which all must
 * occur, in the given order.
 */
Matcher.seq = function() {
    var ms = Array.prototype.slice.call(arguments).map(Matcher.cast);
    if (ms.length === 1) {
        return ms[0];
    }
    return new Matcher(function(expression) {
        var i, result = true;
        for (i = 0; result && i < ms.length; i++) {
            result = ms[i].match(expression);
        }
        return result;
    }, function(prec) {
        var p = Matcher.prec.SEQ;
        var s = ms.map(function(m) {
            return m.toString(p);
        }).join(" ");
        if (prec > p) {
            s = "[ " + s + " ]";
        }
        return s;
    });
};

/**
 * Create a matcher for one or more alternatives, where exactly one
 * must occur.
 */
Matcher.alt = function() {
    var ms = Array.prototype.slice.call(arguments).map(Matcher.cast);
    if (ms.length === 1) {
        return ms[0];
    }
    return new Matcher(function(expression) {
        var i, result = false;
        for (i = 0; !result && i < ms.length; i++) {
            result = ms[i].match(expression);
        }
        return result;
    }, function(prec) {
        var p = Matcher.prec.ALT;
        var s = ms.map(function(m) {
            return m.toString(p);
        }).join(" | ");
        if (prec > p) {
            s = "[ " + s + " ]";
        }
        return s;
    });
};

/**
 * Create a matcher for two or more options.  This implements the
 * double bar (||) and double ampersand (&&) operators, as well as
 * variants of && where some of the alternatives are optional.
 * This will backtrack through even successful matches to try to
 * maximize the number of items matched.
 */
Matcher.many = function(required) {
    var ms = Array.prototype.slice.call(arguments, 1).reduce(function(acc, v) {
        if (v.expand) {
            // Insert all of the options for the given complex rule as
            // individual options.
            var ValidationTypes = require("./ValidationTypes");
            acc.push.apply(acc, ValidationTypes.complex[v.expand].options);
        } else {
            acc.push(Matcher.cast(v));
        }
        return acc;
    }, []);

    if (required === true) {
        required = ms.map(function() {
            return true;
        });
    }

    var result = new Matcher(function(expression) {
        var seen = [], max = 0, pass = 0;
        var success = function(matchCount) {
            if (pass === 0) {
                max = Math.max(matchCount, max);
                return matchCount === ms.length;
            } else {
                return matchCount === max;
            }
        };
        var tryMatch = function(matchCount) {
            for (var i = 0; i < ms.length; i++) {
                if (seen[i]) {
                    continue;
                }
                expression.mark();
                if (ms[i].match(expression)) {
                    seen[i] = true;
                    // Increase matchCount iff this was a required element
                    // (or if all the elements are optional)
                    if (tryMatch(matchCount + ((required === false || required[i]) ? 1 : 0))) {
                        expression.drop();
                        return true;
                    }
                    // Backtrack: try *not* matching using this rule, and
                    // let's see if it leads to a better overall match.
                    expression.restore();
                    seen[i] = false;
                } else {
                    expression.drop();
                }
            }
            return success(matchCount);
        };
        if (!tryMatch(0)) {
            // Couldn't get a complete match, retrace our steps to make the
            // match with the maximum # of required elements.
            pass++;
            tryMatch(0);
        }

        if (required === false) {
            return max > 0;
        }
        // Use finer-grained specification of which matchers are required.
        for (var i = 0; i < ms.length; i++) {
            if (required[i] && !seen[i]) {
                return false;
            }
        }
        return true;
    }, function(prec) {
        var p = required === false ? Matcher.prec.OROR : Matcher.prec.ANDAND;
        var s = ms.map(function(m, i) {
            if (required !== false && !required[i]) {
                return m.toString(Matcher.prec.MOD) + "?";
            }
            return m.toString(p);
        }).join(required === false ? " || " : " && ");
        if (prec > p) {
            s = "[ " + s + " ]";
        }
        return s;
    });
    result.options = ms;
    return result;
};

/**
 * Create a matcher for two or more options, where all options are
 * mandatory but they may appear in any order.
 */
Matcher.andand = function() {
    var args = Array.prototype.slice.call(arguments);
    args.unshift(true);
    return Matcher.many.apply(Matcher, args);
};

/**
 * Create a matcher for two or more options, where options are
 * optional and may appear in any order, but at least one must be
 * present.
 */
Matcher.oror = function() {
    var args = Array.prototype.slice.call(arguments);
    args.unshift(false);
    return Matcher.many.apply(Matcher, args);
};

/** Instance methods on Matchers. */
Matcher.prototype = {
    constructor: Matcher,
    // These are expected to be overridden in every instance.
    match: function() { throw new Error("unimplemented"); },
    toString: function() { throw new Error("unimplemented"); },
    // This returns a standalone function to do the matching.
    func: function() { return this.match.bind(this); },
    // Basic combinators
    then: function(m) { return Matcher.seq(this, m); },
    or: function(m) { return Matcher.alt(this, m); },
    andand: function(m) { return Matcher.many(true, this, m); },
    oror: function(m) { return Matcher.many(false, this, m); },
    // Component value multipliers
    star: function() { return this.braces(0, Infinity, "*"); },
    plus: function() { return this.braces(1, Infinity, "+"); },
    question: function() { return this.braces(0, 1, "?"); },
    hash: function() {
        return this.braces(1, Infinity, "#", Matcher.cast(","));
    },
    braces: function(min, max, marker, optSep) {
        var m1 = this, m2 = optSep ? optSep.then(this) : this;
        if (!marker) {
            marker = "{" + min + "," + max + "}";
        }
        return new Matcher(function(expression) {
            var result = true, i;
            for (i = 0; i < max; i++) {
                if (i > 0 && optSep) {
                    result = m2.match(expression);
                } else {
                    result = m1.match(expression);
                }
                if (!result) {
                    break;
                }
            }
            return i >= min;
        }, function() {
            return m1.toString(Matcher.prec.MOD) + marker;
        });
    }
};
},{"../util/StringReader":24,"../util/SyntaxError":25,"./ValidationTypes":21}],4:[function(require,module,exports){
"use strict";

module.exports = MediaFeature;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");

/**
 * Represents a media feature, such as max-width:500.
 * @namespace parserlib.css
 * @class MediaFeature
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 * @param {SyntaxUnit} name The name of the feature.
 * @param {SyntaxUnit} value The value of the feature or null if none.
 */
function MediaFeature(name, value) {

    SyntaxUnit.call(this, "(" + name + (value !== null ? ":" + value : "") + ")", name.startLine, name.startCol, Parser.MEDIA_FEATURE_TYPE);

    /**
     * The name of the media feature
     * @type String
     * @property name
     */
    this.name = name;

    /**
     * The value for the feature or null if there is none.
     * @type SyntaxUnit
     * @property value
     */
    this.value = value;
}

MediaFeature.prototype = new SyntaxUnit();
MediaFeature.prototype.constructor = MediaFeature;
},{"../util/SyntaxUnit":26,"./Parser":6}],5:[function(require,module,exports){
"use strict";

module.exports = MediaQuery;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");

/**
 * Represents an individual media query.
 * @namespace parserlib.css
 * @class MediaQuery
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 * @param {String} modifier The modifier "not" or "only" (or null).
 * @param {String} mediaType The type of media (i.e., "print").
 * @param {Array} parts Array of selectors parts making up this selector.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 */
function MediaQuery(modifier, mediaType, features, line, col) {

    SyntaxUnit.call(this, (modifier ? modifier + " ": "") + (mediaType ? mediaType : "") + (mediaType && features.length > 0 ? " and " : "") + features.join(" and "), line, col, Parser.MEDIA_QUERY_TYPE);

    /**
     * The media modifier ("not" or "only")
     * @type String
     * @property modifier
     */
    this.modifier = modifier;

    /**
     * The mediaType (i.e., "print")
     * @type String
     * @property mediaType
     */
    this.mediaType = mediaType;

    /**
     * The parts that make up the selector.
     * @type Array
     * @property features
     */
    this.features = features;
}

MediaQuery.prototype = new SyntaxUnit();
MediaQuery.prototype.constructor = MediaQuery;
},{"../util/SyntaxUnit":26,"./Parser":6}],6:[function(require,module,exports){
"use strict";

module.exports = Parser;

var EventTarget = require("../util/EventTarget");
var SyntaxError = require("../util/SyntaxError");
var SyntaxUnit = require("../util/SyntaxUnit");

var Combinator = require("./Combinator");
var MediaFeature = require("./MediaFeature");
var MediaQuery = require("./MediaQuery");
var PropertyName = require("./PropertyName");
var PropertyValue = require("./PropertyValue");
var PropertyValuePart = require("./PropertyValuePart");
var Selector = require("./Selector");
var SelectorPart = require("./SelectorPart");
var SelectorSubPart = require("./SelectorSubPart");
var TokenStream = require("./TokenStream");
var Tokens = require("./Tokens");
var Validation = require("./Validation");

/**
 * A CSS3 parser.
 * @namespace parserlib.css
 * @class Parser
 * @constructor
 * @param {Object} options (Optional) Various options for the parser:
 *      starHack (true|false) to allow IE6 star hack as valid,
 *      underscoreHack (true|false) to interpret leading underscores
 *      as IE6-7 targeting for known properties, ieFilters (true|false)
 *      to indicate that IE < 8 filters should be accepted and not throw
 *      syntax errors.
 */
function Parser(options) {

    //inherit event functionality
    EventTarget.call(this);

    this.options = options || {};

    this._tokenStream = null;
}

//Static constants
Parser.DEFAULT_TYPE = 0;
Parser.COMBINATOR_TYPE = 1;
Parser.MEDIA_FEATURE_TYPE = 2;
Parser.MEDIA_QUERY_TYPE = 3;
Parser.PROPERTY_NAME_TYPE = 4;
Parser.PROPERTY_VALUE_TYPE = 5;
Parser.PROPERTY_VALUE_PART_TYPE = 6;
Parser.SELECTOR_TYPE = 7;
Parser.SELECTOR_PART_TYPE = 8;
Parser.SELECTOR_SUB_PART_TYPE = 9;

Parser.prototype = function() {

    var proto = new EventTarget(),  //new prototype
        prop,
        additions =  {
            __proto__: null,

            //restore constructor
            constructor: Parser,

            //instance constants - yuck
            DEFAULT_TYPE : 0,
            COMBINATOR_TYPE : 1,
            MEDIA_FEATURE_TYPE : 2,
            MEDIA_QUERY_TYPE : 3,
            PROPERTY_NAME_TYPE : 4,
            PROPERTY_VALUE_TYPE : 5,
            PROPERTY_VALUE_PART_TYPE : 6,
            SELECTOR_TYPE : 7,
            SELECTOR_PART_TYPE : 8,
            SELECTOR_SUB_PART_TYPE : 9,

            //-----------------------------------------------------------------
            // Grammar
            //-----------------------------------------------------------------

            _stylesheet: function() {

                /*
                 * stylesheet
                 *  : [ CHARSET_SYM S* STRING S* ';' ]?
                 *    [S|CDO|CDC]* [ import [S|CDO|CDC]* ]*
                 *    [ namespace [S|CDO|CDC]* ]*
                 *    [ [ ruleset | media | page | font_face | keyframes_rule | supports_rule ] [S|CDO|CDC]* ]*
                 *  ;
                 */

                var tokenStream = this._tokenStream,
                    count,
                    token,
                    tt;

                this.fire("startstylesheet");

                //try to read character set
                this._charset();

                this._skipCruft();

                //try to read imports - may be more than one
                while (tokenStream.peek() === Tokens.IMPORT_SYM) {
                    this._import();
                    this._skipCruft();
                }

                //try to read namespaces - may be more than one
                while (tokenStream.peek() === Tokens.NAMESPACE_SYM) {
                    this._namespace();
                    this._skipCruft();
                }

                //get the next token
                tt = tokenStream.peek();

                //try to read the rest
                while (tt > Tokens.EOF) {

                    try {

                        switch (tt) {
                            case Tokens.MEDIA_SYM:
                                this._media();
                                this._skipCruft();
                                break;
                            case Tokens.PAGE_SYM:
                                this._page();
                                this._skipCruft();
                                break;
                            case Tokens.FONT_FACE_SYM:
                                this._font_face();
                                this._skipCruft();
                                break;
                            case Tokens.KEYFRAMES_SYM:
                                this._keyframes();
                                this._skipCruft();
                                break;
                            case Tokens.VIEWPORT_SYM:
                                this._viewport();
                                this._skipCruft();
                                break;
                            case Tokens.DOCUMENT_SYM:
                                this._document();
                                this._skipCruft();
                                break;
                            case Tokens.SUPPORTS_SYM:
                                this._supports();
                                this._skipCruft();
                                break;
                            case Tokens.UNKNOWN_SYM:  //unknown @ rule
                                tokenStream.get();
                                if (!this.options.strict) {

                                    //fire error event
                                    this.fire({
                                        type:       "error",
                                        error:      null,
                                        message:    "Unknown @ rule: " + tokenStream.LT(0).value + ".",
                                        line:       tokenStream.LT(0).startLine,
                                        col:        tokenStream.LT(0).startCol
                                    });

                                    //skip braces
                                    count=0;
                                    while (tokenStream.advance([Tokens.LBRACE, Tokens.RBRACE]) === Tokens.LBRACE) {
                                        count++;    //keep track of nesting depth
                                    }

                                    while (count) {
                                        tokenStream.advance([Tokens.RBRACE]);
                                        count--;
                                    }
                                } else {
                                    //not a syntax error, rethrow it
                                    throw new SyntaxError("Unknown @ rule.", tokenStream.LT(0).startLine, tokenStream.LT(0).startCol);
                                }
                                break;
                            case Tokens.S:
                                this._readWhitespace();
                                break;
                            default:
                                if (!this._ruleset()) {

                                    //error handling for known issues
                                    switch (tt) {
                                        case Tokens.CHARSET_SYM:
                                            token = tokenStream.LT(1);
                                            this._charset(false);
                                            throw new SyntaxError("@charset not allowed here.", token.startLine, token.startCol);
                                        case Tokens.IMPORT_SYM:
                                            token = tokenStream.LT(1);
                                            this._import(false);
                                            throw new SyntaxError("@import not allowed here.", token.startLine, token.startCol);
                                        case Tokens.NAMESPACE_SYM:
                                            token = tokenStream.LT(1);
                                            this._namespace(false);
                                            throw new SyntaxError("@namespace not allowed here.", token.startLine, token.startCol);
                                        default:
                                            tokenStream.get();  //get the last token
                                            this._unexpectedToken(tokenStream.token());
                                    }
                                }
                        }
                    } catch (ex) {
                        if (ex instanceof SyntaxError && !this.options.strict) {
                            this.fire({
                                type:       "error",
                                error:      ex,
                                message:    ex.message,
                                line:       ex.line,
                                col:        ex.col
                            });
                        } else {
                            throw ex;
                        }
                    }

                    tt = tokenStream.peek();
                }

                if (tt !== Tokens.EOF) {
                    this._unexpectedToken(tokenStream.token());
                }

                this.fire("endstylesheet");
            },

            _charset: function(emit) {
                var tokenStream = this._tokenStream,
                    charset,
                    token,
                    line,
                    col;

                if (tokenStream.match(Tokens.CHARSET_SYM)) {
                    line = tokenStream.token().startLine;
                    col = tokenStream.token().startCol;

                    this._readWhitespace();
                    tokenStream.mustMatch(Tokens.STRING);

                    token = tokenStream.token();
                    charset = token.value;

                    this._readWhitespace();
                    tokenStream.mustMatch(Tokens.SEMICOLON);

                    if (emit !== false) {
                        this.fire({
                            type:   "charset",
                            charset:charset,
                            line:   line,
                            col:    col
                        });
                    }
                }
            },

            _import: function(emit) {
                /*
                 * import
                 *   : IMPORT_SYM S*
                 *    [STRING|URI] S* media_query_list? ';' S*
                 */

                var tokenStream = this._tokenStream,
                    uri,
                    importToken,
                    mediaList   = [];

                //read import symbol
                tokenStream.mustMatch(Tokens.IMPORT_SYM);
                importToken = tokenStream.token();
                this._readWhitespace();

                tokenStream.mustMatch([Tokens.STRING, Tokens.URI]);

                //grab the URI value
                uri = tokenStream.token().value.replace(/^(?:url\()?["']?([^"']+?)["']?\)?$/, "$1");

                this._readWhitespace();

                mediaList = this._media_query_list();

                //must end with a semicolon
                tokenStream.mustMatch(Tokens.SEMICOLON);
                this._readWhitespace();

                if (emit !== false) {
                    this.fire({
                        type:   "import",
                        uri:    uri,
                        media:  mediaList,
                        line:   importToken.startLine,
                        col:    importToken.startCol
                    });
                }
            },

            _namespace: function(emit) {
                /*
                 * namespace
                 *   : NAMESPACE_SYM S* [namespace_prefix S*]? [STRING|URI] S* ';' S*
                 */

                var tokenStream = this._tokenStream,
                    line,
                    col,
                    prefix,
                    uri;

                //read import symbol
                tokenStream.mustMatch(Tokens.NAMESPACE_SYM);
                line = tokenStream.token().startLine;
                col = tokenStream.token().startCol;
                this._readWhitespace();

                //it's a namespace prefix - no _namespace_prefix() method because it's just an IDENT
                if (tokenStream.match(Tokens.IDENT)) {
                    prefix = tokenStream.token().value;
                    this._readWhitespace();
                }

                tokenStream.mustMatch([Tokens.STRING, Tokens.URI]);
                /*if (!tokenStream.match(Tokens.STRING)){
                    tokenStream.mustMatch(Tokens.URI);
                }*/

                //grab the URI value
                uri = tokenStream.token().value.replace(/(?:url\()?["']([^"']+)["']\)?/, "$1");

                this._readWhitespace();

                //must end with a semicolon
                tokenStream.mustMatch(Tokens.SEMICOLON);
                this._readWhitespace();

                if (emit !== false) {
                    this.fire({
                        type:   "namespace",
                        prefix: prefix,
                        uri:    uri,
                        line:   line,
                        col:    col
                    });
                }
            },

            _supports: function(emit) {
                /*
                 * supports_rule
                 *  : SUPPORTS_SYM S* supports_condition S* group_rule_body
                 *  ;
                 */
                var tokenStream = this._tokenStream,
                    line,
                    col;

                if (tokenStream.match(Tokens.SUPPORTS_SYM)) {
                    line = tokenStream.token().startLine;
                    col = tokenStream.token().startCol;

                    this._readWhitespace();
                    this._supports_condition();
                    this._readWhitespace();

                    tokenStream.mustMatch(Tokens.LBRACE);
                    this._readWhitespace();

                    if (emit !== false) {
                        this.fire({
                            type:   "startsupports",
                            line:   line,
                            col:    col
                        });
                    }

                    while (true) {
                        if (!this._ruleset()) {
                            break;
                        }
                    }

                    tokenStream.mustMatch(Tokens.RBRACE);
                    this._readWhitespace();

                    this.fire({
                        type:   "endsupports",
                        line:   line,
                        col:    col
                    });
                }
            },

            _supports_condition: function() {
                /*
                 * supports_condition
                 *  : supports_negation | supports_conjunction | supports_disjunction |
                 *    supports_condition_in_parens
                 *  ;
                 */
                var tokenStream = this._tokenStream,
                    ident;

                if (tokenStream.match(Tokens.IDENT)) {
                    ident = tokenStream.token().value.toLowerCase();

                    if (ident === "not") {
                        tokenStream.mustMatch(Tokens.S);
                        this._supports_condition_in_parens();
                    } else {
                        tokenStream.unget();
                    }
                } else {
                    this._supports_condition_in_parens();
                    this._readWhitespace();

                    while (tokenStream.peek() === Tokens.IDENT) {
                        ident = tokenStream.LT(1).value.toLowerCase();
                        if (ident === "and" || ident === "or") {
                            tokenStream.mustMatch(Tokens.IDENT);
                            this._readWhitespace();
                            this._supports_condition_in_parens();
                            this._readWhitespace();
                        }
                    }
                }
            },

            _supports_condition_in_parens: function() {
                /*
                 * supports_condition_in_parens
                 *  : ( '(' S* supports_condition S* ')' ) | supports_declaration_condition |
                 *    general_enclosed
                 *  ;
                 */
                var tokenStream = this._tokenStream,
                    ident;

                if (tokenStream.match(Tokens.LPAREN)) {
                    this._readWhitespace();
                    if (tokenStream.match(Tokens.IDENT)) {
                        // look ahead for not keyword, if not given, continue with declaration condition.
                        ident = tokenStream.token().value.toLowerCase();
                        if (ident === "not") {
                            this._readWhitespace();
                            this._supports_condition();
                            this._readWhitespace();
                            tokenStream.mustMatch(Tokens.RPAREN);
                        } else {
                            tokenStream.unget();
                            this._supports_declaration_condition(false);
                        }
                    } else {
                        this._supports_condition();
                        this._readWhitespace();
                        tokenStream.mustMatch(Tokens.RPAREN);
                    }
                } else {
                    this._supports_declaration_condition();
                }
            },

            _supports_declaration_condition: function(requireStartParen) {
                /*
                 * supports_declaration_condition
                 *  : '(' S* declaration ')'
                 *  ;
                 */
                var tokenStream = this._tokenStream;

                if (requireStartParen !== false) {
                    tokenStream.mustMatch(Tokens.LPAREN);
                }
                this._readWhitespace();
                this._declaration();
                tokenStream.mustMatch(Tokens.RPAREN);
            },

            _media: function() {
                /*
                 * media
                 *   : MEDIA_SYM S* media_query_list S* '{' S* ruleset* '}' S*
                 *   ;
                 */
                var tokenStream     = this._tokenStream,
                    line,
                    col,
                    mediaList;//       = [];

                //look for @media
                tokenStream.mustMatch(Tokens.MEDIA_SYM);
                line = tokenStream.token().startLine;
                col = tokenStream.token().startCol;

                this._readWhitespace();

                mediaList = this._media_query_list();

                tokenStream.mustMatch(Tokens.LBRACE);
                this._readWhitespace();

                this.fire({
                    type:   "startmedia",
                    media:  mediaList,
                    line:   line,
                    col:    col
                });

                while (true) {
                    if (tokenStream.peek() === Tokens.PAGE_SYM) {
                        this._page();
                    } else if (tokenStream.peek() === Tokens.FONT_FACE_SYM) {
                        this._font_face();
                    } else if (tokenStream.peek() === Tokens.VIEWPORT_SYM) {
                        this._viewport();
                    } else if (tokenStream.peek() === Tokens.DOCUMENT_SYM) {
                        this._document();
                    } else if (tokenStream.peek() === Tokens.SUPPORTS_SYM) {
                        this._supports();
                    } else if (tokenStream.peek() === Tokens.MEDIA_SYM) {
                        this._media();
                    } else if (!this._ruleset()) {
                        break;
                    }
                }

                tokenStream.mustMatch(Tokens.RBRACE);
                this._readWhitespace();

                this.fire({
                    type:   "endmedia",
                    media:  mediaList,
                    line:   line,
                    col:    col
                });
            },

            //CSS3 Media Queries
            _media_query_list: function() {
                /*
                 * media_query_list
                 *   : S* [media_query [ ',' S* media_query ]* ]?
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    mediaList   = [];

                this._readWhitespace();

                if (tokenStream.peek() === Tokens.IDENT || tokenStream.peek() === Tokens.LPAREN) {
                    mediaList.push(this._media_query());
                }

                while (tokenStream.match(Tokens.COMMA)) {
                    this._readWhitespace();
                    mediaList.push(this._media_query());
                }

                return mediaList;
            },

            /*
             * Note: "expression" in the grammar maps to the _media_expression
             * method.

             */
            _media_query: function() {
                /*
                 * media_query
                 *   : [ONLY | NOT]? S* media_type S* [ AND S* expression ]*
                 *   | expression [ AND S* expression ]*
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    type        = null,
                    ident       = null,
                    token       = null,
                    expressions = [];

                if (tokenStream.match(Tokens.IDENT)) {
                    ident = tokenStream.token().value.toLowerCase();

                    //since there's no custom tokens for these, need to manually check
                    if (ident !== "only" && ident !== "not") {
                        tokenStream.unget();
                        ident = null;
                    } else {
                        token = tokenStream.token();
                    }
                }

                this._readWhitespace();

                if (tokenStream.peek() === Tokens.IDENT) {
                    type = this._media_type();
                    if (token === null) {
                        token = tokenStream.token();
                    }
                } else if (tokenStream.peek() === Tokens.LPAREN) {
                    if (token === null) {
                        token = tokenStream.LT(1);
                    }
                    expressions.push(this._media_expression());
                }

                if (type === null && expressions.length === 0) {
                    return null;
                } else {
                    this._readWhitespace();
                    while (tokenStream.match(Tokens.IDENT)) {
                        if (tokenStream.token().value.toLowerCase() !== "and") {
                            this._unexpectedToken(tokenStream.token());
                        }

                        this._readWhitespace();
                        expressions.push(this._media_expression());
                    }
                }

                return new MediaQuery(ident, type, expressions, token.startLine, token.startCol);
            },

            //CSS3 Media Queries
            _media_type: function() {
                /*
                 * media_type
                 *   : IDENT
                 *   ;
                 */
                return this._media_feature();
            },

            /**
             * Note: in CSS3 Media Queries, this is called "expression".
             * Renamed here to avoid conflict with CSS3 Selectors
             * definition of "expression". Also note that "expr" in the
             * grammar now maps to "expression" from CSS3 selectors.
             * @method _media_expression
             * @private
             */
            _media_expression: function() {
                /*
                 * expression
                 *  : '(' S* media_feature S* [ ':' S* expr ]? ')' S*
                 *  ;
                 */
                var tokenStream = this._tokenStream,
                    feature     = null,
                    token,
                    expression  = null;

                tokenStream.mustMatch(Tokens.LPAREN);

                feature = this._media_feature();
                this._readWhitespace();

                if (tokenStream.match(Tokens.COLON)) {
                    this._readWhitespace();
                    token = tokenStream.LT(1);
                    expression = this._expression();
                }

                tokenStream.mustMatch(Tokens.RPAREN);
                this._readWhitespace();

                return new MediaFeature(feature, expression ? new SyntaxUnit(expression, token.startLine, token.startCol) : null);
            },

            //CSS3 Media Queries
            _media_feature: function() {
                /*
                 * media_feature
                 *   : IDENT
                 *   ;
                 */
                var tokenStream = this._tokenStream;

                this._readWhitespace();

                tokenStream.mustMatch(Tokens.IDENT);

                return SyntaxUnit.fromToken(tokenStream.token());
            },

            //CSS3 Paged Media
            _page: function() {
                /*
                 * page:
                 *    PAGE_SYM S* IDENT? pseudo_page? S*
                 *    '{' S* [ declaration | margin ]? [ ';' S* [ declaration | margin ]? ]* '}' S*
                 *    ;
                 */
                var tokenStream = this._tokenStream,
                    line,
                    col,
                    identifier  = null,
                    pseudoPage  = null;

                //look for @page
                tokenStream.mustMatch(Tokens.PAGE_SYM);
                line = tokenStream.token().startLine;
                col = tokenStream.token().startCol;

                this._readWhitespace();

                if (tokenStream.match(Tokens.IDENT)) {
                    identifier = tokenStream.token().value;

                    //The value 'auto' may not be used as a page name and MUST be treated as a syntax error.
                    if (identifier.toLowerCase() === "auto") {
                        this._unexpectedToken(tokenStream.token());
                    }
                }

                //see if there's a colon upcoming
                if (tokenStream.peek() === Tokens.COLON) {
                    pseudoPage = this._pseudo_page();
                }

                this._readWhitespace();

                this.fire({
                    type:   "startpage",
                    id:     identifier,
                    pseudo: pseudoPage,
                    line:   line,
                    col:    col
                });

                this._readDeclarations(true, true);

                this.fire({
                    type:   "endpage",
                    id:     identifier,
                    pseudo: pseudoPage,
                    line:   line,
                    col:    col
                });
            },

            //CSS3 Paged Media
            _margin: function() {
                /*
                 * margin :
                 *    margin_sym S* '{' declaration [ ';' S* declaration? ]* '}' S*
                 *    ;
                 */
                var tokenStream = this._tokenStream,
                    line,
                    col,
                    marginSym   = this._margin_sym();

                if (marginSym) {
                    line = tokenStream.token().startLine;
                    col = tokenStream.token().startCol;

                    this.fire({
                        type: "startpagemargin",
                        margin: marginSym,
                        line:   line,
                        col:    col
                    });

                    this._readDeclarations(true);

                    this.fire({
                        type: "endpagemargin",
                        margin: marginSym,
                        line:   line,
                        col:    col
                    });
                    return true;
                } else {
                    return false;
                }
            },

            //CSS3 Paged Media
            _margin_sym: function() {

                /*
                 * margin_sym :
                 *    TOPLEFTCORNER_SYM |
                 *    TOPLEFT_SYM |
                 *    TOPCENTER_SYM |
                 *    TOPRIGHT_SYM |
                 *    TOPRIGHTCORNER_SYM |
                 *    BOTTOMLEFTCORNER_SYM |
                 *    BOTTOMLEFT_SYM |
                 *    BOTTOMCENTER_SYM |
                 *    BOTTOMRIGHT_SYM |
                 *    BOTTOMRIGHTCORNER_SYM |
                 *    LEFTTOP_SYM |
                 *    LEFTMIDDLE_SYM |
                 *    LEFTBOTTOM_SYM |
                 *    RIGHTTOP_SYM |
                 *    RIGHTMIDDLE_SYM |
                 *    RIGHTBOTTOM_SYM
                 *    ;
                 */

                var tokenStream = this._tokenStream;

                if (tokenStream.match([Tokens.TOPLEFTCORNER_SYM, Tokens.TOPLEFT_SYM,
                        Tokens.TOPCENTER_SYM, Tokens.TOPRIGHT_SYM, Tokens.TOPRIGHTCORNER_SYM,
                        Tokens.BOTTOMLEFTCORNER_SYM, Tokens.BOTTOMLEFT_SYM,
                        Tokens.BOTTOMCENTER_SYM, Tokens.BOTTOMRIGHT_SYM,
                        Tokens.BOTTOMRIGHTCORNER_SYM, Tokens.LEFTTOP_SYM,
                        Tokens.LEFTMIDDLE_SYM, Tokens.LEFTBOTTOM_SYM, Tokens.RIGHTTOP_SYM,
                        Tokens.RIGHTMIDDLE_SYM, Tokens.RIGHTBOTTOM_SYM])) {
                    return SyntaxUnit.fromToken(tokenStream.token());
                } else {
                    return null;
                }
            },

            _pseudo_page: function() {
                /*
                 * pseudo_page
                 *   : ':' IDENT
                 *   ;
                 */

                var tokenStream = this._tokenStream;

                tokenStream.mustMatch(Tokens.COLON);
                tokenStream.mustMatch(Tokens.IDENT);

                //TODO: CSS3 Paged Media says only "left", "center", and "right" are allowed

                return tokenStream.token().value;
            },

            _font_face: function() {
                /*
                 * font_face
                 *   : FONT_FACE_SYM S*
                 *     '{' S* declaration [ ';' S* declaration ]* '}' S*
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    line,
                    col;

                //look for @page
                tokenStream.mustMatch(Tokens.FONT_FACE_SYM);
                line = tokenStream.token().startLine;
                col = tokenStream.token().startCol;

                this._readWhitespace();

                this.fire({
                    type:   "startfontface",
                    line:   line,
                    col:    col
                });

                this._readDeclarations(true);

                this.fire({
                    type:   "endfontface",
                    line:   line,
                    col:    col
                });
            },

            _viewport: function() {
                /*
                 * viewport
                 *   : VIEWPORT_SYM S*
                 *     '{' S* declaration? [ ';' S* declaration? ]* '}' S*
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    line,
                    col;

                tokenStream.mustMatch(Tokens.VIEWPORT_SYM);
                line = tokenStream.token().startLine;
                col = tokenStream.token().startCol;

                this._readWhitespace();

                this.fire({
                    type:   "startviewport",
                    line:   line,
                    col:    col
                });

                this._readDeclarations(true);

                this.fire({
                    type:   "endviewport",
                    line:   line,
                    col:    col
                });
            },

            _document: function() {
                /*
                 * document
                 *   : DOCUMENT_SYM S*
                 *     _document_function [ ',' S* _document_function ]* S*
                 *     '{' S* ruleset* '}'
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    token,
                    functions = [],
                    prefix = "";

                tokenStream.mustMatch(Tokens.DOCUMENT_SYM);
                token = tokenStream.token();
                if (/^@\-([^\-]+)\-/.test(token.value)) {
                    prefix = RegExp.$1;
                }

                this._readWhitespace();
                functions.push(this._document_function());

                while (tokenStream.match(Tokens.COMMA)) {
                    this._readWhitespace();
                    functions.push(this._document_function());
                }

                tokenStream.mustMatch(Tokens.LBRACE);
                this._readWhitespace();

                this.fire({
                    type:      "startdocument",
                    functions: functions,
                    prefix:    prefix,
                    line:      token.startLine,
                    col:       token.startCol
                });

                var ok = true;
                while (ok) {
                    switch (tokenStream.peek()) {
                        case Tokens.PAGE_SYM:
                            this._page();
                            break;
                        case Tokens.FONT_FACE_SYM:
                            this._font_face();
                            break;
                        case Tokens.VIEWPORT_SYM:
                            this._viewport();
                            break;
                        case Tokens.MEDIA_SYM:
                            this._media();
                            break;
                        case Tokens.KEYFRAMES_SYM:
                            this._keyframes();
                            break;
                        case Tokens.DOCUMENT_SYM:
                            this._document();
                            break;
                        default:
                            ok = Boolean(this._ruleset());
                    }
                }

                tokenStream.mustMatch(Tokens.RBRACE);
                token = tokenStream.token();
                this._readWhitespace();

                this.fire({
                    type:      "enddocument",
                    functions: functions,
                    prefix:    prefix,
                    line:      token.startLine,
                    col:       token.startCol
                });
            },

            _document_function: function() {
                /*
                 * document_function
                 *   : function | URI S*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    value;

                if (tokenStream.match(Tokens.URI)) {
                    value = tokenStream.token().value;
                    this._readWhitespace();
                } else {
                    value = this._function();
                }

                return value;
            },

            _operator: function(inFunction) {

                /*
                 * operator (outside function)
                 *  : '/' S* | ',' S* | /( empty )/
                 * operator (inside function)
                 *  : '/' S* | '+' S* | '*' S* | '-' S* /( empty )/
                 *  ;
                 */

                var tokenStream = this._tokenStream,
                    token       = null;

                if (tokenStream.match([Tokens.SLASH, Tokens.COMMA]) ||
                    (inFunction && tokenStream.match([Tokens.PLUS, Tokens.STAR, Tokens.MINUS]))) {
                    token =  tokenStream.token();
                    this._readWhitespace();
                }
                return token ? PropertyValuePart.fromToken(token) : null;
            },

            _combinator: function() {

                /*
                 * combinator
                 *  : PLUS S* | GREATER S* | TILDE S* | S+
                 *  ;
                 */

                var tokenStream = this._tokenStream,
                    value       = null,
                    token;

                if (tokenStream.match([Tokens.PLUS, Tokens.GREATER, Tokens.TILDE])) {
                    token = tokenStream.token();
                    value = new Combinator(token.value, token.startLine, token.startCol);
                    this._readWhitespace();
                }

                return value;
            },

            _unary_operator: function() {

                /*
                 * unary_operator
                 *  : '-' | '+'
                 *  ;
                 */

                var tokenStream = this._tokenStream;

                if (tokenStream.match([Tokens.MINUS, Tokens.PLUS])) {
                    return tokenStream.token().value;
                } else {
                    return null;
                }
            },

            _property: function() {

                /*
                 * property
                 *   : IDENT S*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    value       = null,
                    hack        = null,
                    tokenValue,
                    token,
                    line,
                    col;

                //check for star hack - throws error if not allowed
                if (tokenStream.peek() === Tokens.STAR && this.options.starHack) {
                    tokenStream.get();
                    token = tokenStream.token();
                    hack = token.value;
                    line = token.startLine;
                    col = token.startCol;
                }

                if (tokenStream.match(Tokens.IDENT)) {
                    token = tokenStream.token();
                    tokenValue = token.value;

                    //check for underscore hack - no error if not allowed because it's valid CSS syntax
                    if (tokenValue.charAt(0) === "_" && this.options.underscoreHack) {
                        hack = "_";
                        tokenValue = tokenValue.substring(1);
                    }

                    value = new PropertyName(tokenValue, hack, (line||token.startLine), (col||token.startCol));
                    this._readWhitespace();
                }

                return value;
            },

            //Augmented with CSS3 Selectors
            _ruleset: function() {
                /*
                 * ruleset
                 *   : selectors_group
                 *     '{' S* declaration? [ ';' S* declaration? ]* '}' S*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    tt,
                    selectors;

                /*
                 * Error Recovery: If even a single selector fails to parse,
                 * then the entire ruleset should be thrown away.
                 */
                try {
                    selectors = this._selectors_group();
                } catch (ex) {
                    if (ex instanceof SyntaxError && !this.options.strict) {

                        //fire error event
                        this.fire({
                            type:       "error",
                            error:      ex,
                            message:    ex.message,
                            line:       ex.line,
                            col:        ex.col
                        });

                        //skip over everything until closing brace
                        tt = tokenStream.advance([Tokens.RBRACE]);
                        if (tt === Tokens.RBRACE) {
                            //if there's a right brace, the rule is finished so don't do anything
                        } else {
                            //otherwise, rethrow the error because it wasn't handled properly
                            throw ex;
                        }
                    } else {
                        //not a syntax error, rethrow it
                        throw ex;
                    }

                    //trigger parser to continue
                    return true;
                }

                //if it got here, all selectors parsed
                if (selectors) {

                    this.fire({
                        type:       "startrule",
                        selectors:  selectors,
                        line:       selectors[0].line,
                        col:        selectors[0].col
                    });

                    this._readDeclarations(true);

                    this.fire({
                        type:       "endrule",
                        selectors:  selectors,
                        line:       selectors[0].line,
                        col:        selectors[0].col
                    });
                }

                return selectors;
            },

            //CSS3 Selectors
            _selectors_group: function() {

                /*
                 * selectors_group
                 *   : selector [ COMMA S* selector ]*
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    selectors   = [],
                    selector;

                selector = this._selector();
                if (selector !== null) {

                    selectors.push(selector);
                    while (tokenStream.match(Tokens.COMMA)) {
                        this._readWhitespace();
                        selector = this._selector();
                        if (selector !== null) {
                            selectors.push(selector);
                        } else {
                            this._unexpectedToken(tokenStream.LT(1));
                        }
                    }
                }

                return selectors.length ? selectors : null;
            },

            //CSS3 Selectors
            _selector: function() {
                /*
                 * selector
                 *   : simple_selector_sequence [ combinator simple_selector_sequence ]*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    selector    = [],
                    nextSelector = null,
                    combinator  = null,
                    ws          = null;

                //if there's no simple selector, then there's no selector
                nextSelector = this._simple_selector_sequence();
                if (nextSelector === null) {
                    return null;
                }

                selector.push(nextSelector);

                do {

                    //look for a combinator
                    combinator = this._combinator();

                    if (combinator !== null) {
                        selector.push(combinator);
                        nextSelector = this._simple_selector_sequence();

                        //there must be a next selector
                        if (nextSelector === null) {
                            this._unexpectedToken(tokenStream.LT(1));
                        } else {

                            //nextSelector is an instance of SelectorPart
                            selector.push(nextSelector);
                        }
                    } else {

                        //if there's not whitespace, we're done
                        if (this._readWhitespace()) {

                            //add whitespace separator
                            ws = new Combinator(tokenStream.token().value, tokenStream.token().startLine, tokenStream.token().startCol);

                            //combinator is not required
                            combinator = this._combinator();

                            //selector is required if there's a combinator
                            nextSelector = this._simple_selector_sequence();
                            if (nextSelector === null) {
                                if (combinator !== null) {
                                    this._unexpectedToken(tokenStream.LT(1));
                                }
                            } else {

                                if (combinator !== null) {
                                    selector.push(combinator);
                                } else {
                                    selector.push(ws);
                                }

                                selector.push(nextSelector);
                            }
                        } else {
                            break;
                        }
                    }
                } while (true);

                return new Selector(selector, selector[0].line, selector[0].col);
            },

            //CSS3 Selectors
            _simple_selector_sequence: function() {
                /*
                 * simple_selector_sequence
                 *   : [ type_selector | universal ]
                 *     [ HASH | class | attrib | pseudo | negation ]*
                 *   | [ HASH | class | attrib | pseudo | negation ]+
                 *   ;
                 */

                var tokenStream = this._tokenStream,

                    //parts of a simple selector
                    elementName = null,
                    modifiers   = [],

                    //complete selector text
                    selectorText= "",

                    //the different parts after the element name to search for
                    components  = [
                        //HASH
                        function() {
                            return tokenStream.match(Tokens.HASH) ?
                                    new SelectorSubPart(tokenStream.token().value, "id", tokenStream.token().startLine, tokenStream.token().startCol) :
                                    null;
                        },
                        this._class,
                        this._attrib,
                        this._pseudo,
                        this._negation
                    ],
                    i           = 0,
                    len         = components.length,
                    component   = null,
                    line,
                    col;

                //get starting line and column for the selector
                line = tokenStream.LT(1).startLine;
                col = tokenStream.LT(1).startCol;

                elementName = this._type_selector();
                if (!elementName) {
                    elementName = this._universal();
                }

                if (elementName !== null) {
                    selectorText += elementName;
                }

                while (true) {

                    //whitespace means we're done
                    if (tokenStream.peek() === Tokens.S) {
                        break;
                    }

                    //check for each component
                    while (i < len && component === null) {
                        component = components[i++].call(this);
                    }

                    if (component === null) {

                        //we don't have a selector
                        if (selectorText === "") {
                            return null;
                        } else {
                            break;
                        }
                    } else {
                        i = 0;
                        modifiers.push(component);
                        selectorText += component.toString();
                        component = null;
                    }
                }

                return selectorText !== "" ?
                        new SelectorPart(elementName, modifiers, selectorText, line, col) :
                        null;
            },

            //CSS3 Selectors
            _type_selector: function() {
                /*
                 * type_selector
                 *   : [ namespace_prefix ]? element_name
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    ns          = this._namespace_prefix(),
                    elementName = this._element_name();

                if (!elementName) {
                    /*
                     * Need to back out the namespace that was read due to both
                     * type_selector and universal reading namespace_prefix
                     * first. Kind of hacky, but only way I can figure out
                     * right now how to not change the grammar.
                     */
                    if (ns) {
                        tokenStream.unget();
                        if (ns.length > 1) {
                            tokenStream.unget();
                        }
                    }

                    return null;
                } else {
                    if (ns) {
                        elementName.text = ns + elementName.text;
                        elementName.col -= ns.length;
                    }
                    return elementName;
                }
            },

            //CSS3 Selectors
            _class: function() {
                /*
                 * class
                 *   : '.' IDENT
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    token;

                if (tokenStream.match(Tokens.DOT)) {
                    tokenStream.mustMatch(Tokens.IDENT);
                    token = tokenStream.token();
                    return new SelectorSubPart("." + token.value, "class", token.startLine, token.startCol - 1);
                } else {
                    return null;
                }
            },

            //CSS3 Selectors
            _element_name: function() {
                /*
                 * element_name
                 *   : IDENT
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    token;

                if (tokenStream.match(Tokens.IDENT)) {
                    token = tokenStream.token();
                    return new SelectorSubPart(token.value, "elementName", token.startLine, token.startCol);
                } else {
                    return null;
                }
            },

            //CSS3 Selectors
            _namespace_prefix: function() {
                /*
                 * namespace_prefix
                 *   : [ IDENT | '*' ]? '|'
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    value       = "";

                //verify that this is a namespace prefix
                if (tokenStream.LA(1) === Tokens.PIPE || tokenStream.LA(2) === Tokens.PIPE) {

                    if (tokenStream.match([Tokens.IDENT, Tokens.STAR])) {
                        value += tokenStream.token().value;
                    }

                    tokenStream.mustMatch(Tokens.PIPE);
                    value += "|";
                }

                return value.length ? value : null;
            },

            //CSS3 Selectors
            _universal: function() {
                /*
                 * universal
                 *   : [ namespace_prefix ]? '*'
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    value       = "",
                    ns;

                ns = this._namespace_prefix();
                if (ns) {
                    value += ns;
                }

                if (tokenStream.match(Tokens.STAR)) {
                    value += "*";
                }

                return value.length ? value : null;
            },

            //CSS3 Selectors
            _attrib: function() {
                /*
                 * attrib
                 *   : '[' S* [ namespace_prefix ]? IDENT S*
                 *         [ [ PREFIXMATCH |
                 *             SUFFIXMATCH |
                 *             SUBSTRINGMATCH |
                 *             '=' |
                 *             INCLUDES |
                 *             DASHMATCH ] S* [ IDENT | STRING ] S*
                 *         ]? ']'
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    value       = null,
                    ns,
                    token;

                if (tokenStream.match(Tokens.LBRACKET)) {
                    token = tokenStream.token();
                    value = token.value;
                    value += this._readWhitespace();

                    ns = this._namespace_prefix();

                    if (ns) {
                        value += ns;
                    }

                    tokenStream.mustMatch(Tokens.IDENT);
                    value += tokenStream.token().value;
                    value += this._readWhitespace();

                    if (tokenStream.match([Tokens.PREFIXMATCH, Tokens.SUFFIXMATCH, Tokens.SUBSTRINGMATCH,
                            Tokens.EQUALS, Tokens.INCLUDES, Tokens.DASHMATCH])) {

                        value += tokenStream.token().value;
                        value += this._readWhitespace();

                        tokenStream.mustMatch([Tokens.IDENT, Tokens.STRING]);
                        value += tokenStream.token().value;
                        value += this._readWhitespace();
                    }

                    tokenStream.mustMatch(Tokens.RBRACKET);

                    return new SelectorSubPart(value + "]", "attribute", token.startLine, token.startCol);
                } else {
                    return null;
                }
            },

            //CSS3 Selectors
            _pseudo: function() {

                /*
                 * pseudo
                 *   : ':' ':'? [ IDENT | functional_pseudo ]
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    pseudo      = null,
                    colons      = ":",
                    line,
                    col;

                if (tokenStream.match(Tokens.COLON)) {

                    if (tokenStream.match(Tokens.COLON)) {
                        colons += ":";
                    }

                    if (tokenStream.match(Tokens.IDENT)) {
                        pseudo = tokenStream.token().value;
                        line = tokenStream.token().startLine;
                        col = tokenStream.token().startCol - colons.length;
                    } else if (tokenStream.peek() === Tokens.FUNCTION) {
                        line = tokenStream.LT(1).startLine;
                        col = tokenStream.LT(1).startCol - colons.length;
                        pseudo = this._functional_pseudo();
                    }

                    if (pseudo) {
                        pseudo = new SelectorSubPart(colons + pseudo, "pseudo", line, col);
                    } else {
                        var startLine = tokenStream.LT(1).startLine,
                            startCol  = tokenStream.LT(0).startCol;
                        throw new SyntaxError("Expected a `FUNCTION` or `IDENT` after colon at line " + startLine + ", col " + startCol + ".", startLine, startCol);
                    }
                }

                return pseudo;
            },

            //CSS3 Selectors
            _functional_pseudo: function() {
                /*
                 * functional_pseudo
                 *   : FUNCTION S* expression ')'
                 *   ;
                */

                var tokenStream = this._tokenStream,
                    value = null;

                if (tokenStream.match(Tokens.FUNCTION)) {
                    value = tokenStream.token().value;
                    value += this._readWhitespace();
                    value += this._expression();
                    tokenStream.mustMatch(Tokens.RPAREN);
                    value += ")";
                }

                return value;
            },

            //CSS3 Selectors
            _expression: function() {
                /*
                 * expression
                 *   : [ [ PLUS | '-' | DIMENSION | NUMBER | STRING | IDENT ] S* ]+
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    value       = "";

                while (tokenStream.match([Tokens.PLUS, Tokens.MINUS, Tokens.DIMENSION,
                        Tokens.NUMBER, Tokens.STRING, Tokens.IDENT, Tokens.LENGTH,
                        Tokens.FREQ, Tokens.ANGLE, Tokens.TIME,
                        Tokens.RESOLUTION, Tokens.SLASH])) {

                    value += tokenStream.token().value;
                    value += this._readWhitespace();
                }

                return value.length ? value : null;
            },

            //CSS3 Selectors
            _negation: function() {
                /*
                 * negation
                 *   : NOT S* negation_arg S* ')'
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    line,
                    col,
                    value       = "",
                    arg,
                    subpart     = null;

                if (tokenStream.match(Tokens.NOT)) {
                    value = tokenStream.token().value;
                    line = tokenStream.token().startLine;
                    col = tokenStream.token().startCol;
                    value += this._readWhitespace();
                    arg = this._negation_arg();
                    value += arg;
                    value += this._readWhitespace();
                    tokenStream.match(Tokens.RPAREN);
                    value += tokenStream.token().value;

                    subpart = new SelectorSubPart(value, "not", line, col);
                    subpart.args.push(arg);
                }

                return subpart;
            },

            //CSS3 Selectors
            _negation_arg: function() {
                /*
                 * negation_arg
                 *   : type_selector | universal | HASH | class | attrib | pseudo
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    args        = [
                        this._type_selector,
                        this._universal,
                        function() {
                            return tokenStream.match(Tokens.HASH) ?
                                    new SelectorSubPart(tokenStream.token().value, "id", tokenStream.token().startLine, tokenStream.token().startCol) :
                                    null;
                        },
                        this._class,
                        this._attrib,
                        this._pseudo
                    ],
                    arg         = null,
                    i           = 0,
                    len         = args.length,
                    line,
                    col,
                    part;

                line = tokenStream.LT(1).startLine;
                col = tokenStream.LT(1).startCol;

                while (i < len && arg === null) {

                    arg = args[i].call(this);
                    i++;
                }

                //must be a negation arg
                if (arg === null) {
                    this._unexpectedToken(tokenStream.LT(1));
                }

                //it's an element name
                if (arg.type === "elementName") {
                    part = new SelectorPart(arg, [], arg.toString(), line, col);
                } else {
                    part = new SelectorPart(null, [arg], arg.toString(), line, col);
                }

                return part;
            },

            _declaration: function() {

                /*
                 * declaration
                 *   : property ':' S* expr prio?
                 *   | /( empty )/
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    property    = null,
                    expr        = null,
                    prio        = null,
                    invalid     = null,
                    propertyName= "";

                property = this._property();
                if (property !== null) {

                    tokenStream.mustMatch(Tokens.COLON);
                    this._readWhitespace();

                    expr = this._expr();

                    //if there's no parts for the value, it's an error
                    if (!expr || expr.length === 0) {
                        this._unexpectedToken(tokenStream.LT(1));
                    }

                    prio = this._prio();

                    /*
                     * If hacks should be allowed, then only check the root
                     * property. If hacks should not be allowed, treat
                     * _property or *property as invalid properties.
                     */
                    propertyName = property.toString();
                    if (this.options.starHack && property.hack === "*" ||
                            this.options.underscoreHack && property.hack === "_") {

                        propertyName = property.text;
                    }

                    try {
                        this._validateProperty(propertyName, expr);
                    } catch (ex) {
                        invalid = ex;
                    }

                    this.fire({
                        type:       "property",
                        property:   property,
                        value:      expr,
                        important:  prio,
                        line:       property.line,
                        col:        property.col,
                        invalid:    invalid
                    });

                    return true;
                } else {
                    return false;
                }
            },

            _prio: function() {
                /*
                 * prio
                 *   : IMPORTANT_SYM S*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    result      = tokenStream.match(Tokens.IMPORTANT_SYM);

                this._readWhitespace();
                return result;
            },

            _expr: function(inFunction) {
                /*
                 * expr
                 *   : term [ operator term ]*
                 *   ;
                 */

                var values      = [],
                    //valueParts    = [],
                    value       = null,
                    operator    = null;

                value = this._term(inFunction);
                if (value !== null) {

                    values.push(value);

                    do {
                        operator = this._operator(inFunction);

                        //if there's an operator, keep building up the value parts
                        if (operator) {
                            values.push(operator);
                        } /*else {
                            //if there's not an operator, you have a full value
                            values.push(new PropertyValue(valueParts, valueParts[0].line, valueParts[0].col));
                            valueParts = [];
                        }*/

                        value = this._term(inFunction);

                        if (value === null) {
                            break;
                        } else {
                            values.push(value);
                        }
                    } while (true);
                }

                //cleanup
                /*if (valueParts.length) {
                    values.push(new PropertyValue(valueParts, valueParts[0].line, valueParts[0].col));
                }*/

                return values.length > 0 ? new PropertyValue(values, values[0].line, values[0].col) : null;
            },

            _term: function(inFunction) {

                /*
                 * term
                 *   : unary_operator?
                 *     [ NUMBER S* | PERCENTAGE S* | LENGTH S* | ANGLE S* |
                 *       TIME S* | FREQ S* | function | ie_function ]
                 *   | STRING S* | IDENT S* | URI S* | UNICODERANGE S* | hexcolor
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    unary       = null,
                    value       = null,
                    endChar     = null,
                    part        = null,
                    token,
                    line,
                    col;

                //returns the operator or null
                unary = this._unary_operator();
                if (unary !== null) {
                    line = tokenStream.token().startLine;
                    col = tokenStream.token().startCol;
                }

                //exception for IE filters
                if (tokenStream.peek() === Tokens.IE_FUNCTION && this.options.ieFilters) {

                    value = this._ie_function();
                    if (unary === null) {
                        line = tokenStream.token().startLine;
                        col = tokenStream.token().startCol;
                    }

                //see if it's a simple block
                } else if (inFunction && tokenStream.match([Tokens.LPAREN, Tokens.LBRACE, Tokens.LBRACKET])) {

                    token = tokenStream.token();
                    endChar = token.endChar;
                    value = token.value + this._expr(inFunction).text;
                    if (unary === null) {
                        line = tokenStream.token().startLine;
                        col = tokenStream.token().startCol;
                    }
                    tokenStream.mustMatch(Tokens.type(endChar));
                    value += endChar;
                    this._readWhitespace();

                //see if there's a simple match
                } else if (tokenStream.match([Tokens.NUMBER, Tokens.PERCENTAGE, Tokens.LENGTH,
                        Tokens.ANGLE, Tokens.TIME,
                        Tokens.FREQ, Tokens.STRING, Tokens.IDENT, Tokens.URI, Tokens.UNICODE_RANGE])) {

                    value = tokenStream.token().value;
                    if (unary === null) {
                        line = tokenStream.token().startLine;
                        col = tokenStream.token().startCol;
                        // Correct potentially-inaccurate IDENT parsing in
                        // PropertyValuePart constructor.
                        part = PropertyValuePart.fromToken(tokenStream.token());
                    }
                    this._readWhitespace();
                } else {

                    //see if it's a color
                    token = this._hexcolor();
                    if (token === null) {

                        //if there's no unary, get the start of the next token for line/col info
                        if (unary === null) {
                            line = tokenStream.LT(1).startLine;
                            col = tokenStream.LT(1).startCol;
                        }

                        //has to be a function
                        if (value === null) {

                            /*
                             * This checks for alpha(opacity=0) style of IE
                             * functions. IE_FUNCTION only presents progid: style.
                             */
                            if (tokenStream.LA(3) === Tokens.EQUALS && this.options.ieFilters) {
                                value = this._ie_function();
                            } else {
                                value = this._function();
                            }
                        }

                        /*if (value === null) {
                            return null;
                            //throw new Error("Expected identifier at line " + tokenStream.token().startLine + ", character " +  tokenStream.token().startCol + ".");
                        }*/
                    } else {
                        value = token.value;
                        if (unary === null) {
                            line = token.startLine;
                            col = token.startCol;
                        }
                    }
                }

                return part !== null ? part : value !== null ?
                        new PropertyValuePart(unary !== null ? unary + value : value, line, col) :
                        null;
            },

            _function: function() {

                /*
                 * function
                 *   : FUNCTION S* expr ')' S*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    functionText = null,
                    expr        = null,
                    lt;

                if (tokenStream.match(Tokens.FUNCTION)) {
                    functionText = tokenStream.token().value;
                    this._readWhitespace();
                    expr = this._expr(true);
                    functionText += expr;

                    //START: Horrible hack in case it's an IE filter
                    if (this.options.ieFilters && tokenStream.peek() === Tokens.EQUALS) {
                        do {

                            if (this._readWhitespace()) {
                                functionText += tokenStream.token().value;
                            }

                            //might be second time in the loop
                            if (tokenStream.LA(0) === Tokens.COMMA) {
                                functionText += tokenStream.token().value;
                            }

                            tokenStream.match(Tokens.IDENT);
                            functionText += tokenStream.token().value;

                            tokenStream.match(Tokens.EQUALS);
                            functionText += tokenStream.token().value;

                            //functionText += this._term();
                            lt = tokenStream.peek();
                            while (lt !== Tokens.COMMA && lt !== Tokens.S && lt !== Tokens.RPAREN) {
                                tokenStream.get();
                                functionText += tokenStream.token().value;
                                lt = tokenStream.peek();
                            }
                        } while (tokenStream.match([Tokens.COMMA, Tokens.S]));
                    }

                    //END: Horrible Hack

                    tokenStream.match(Tokens.RPAREN);
                    functionText += ")";
                    this._readWhitespace();
                }

                return functionText;
            },

            _ie_function: function() {

                /* (My own extension)
                 * ie_function
                 *   : IE_FUNCTION S* IDENT '=' term [S* ','? IDENT '=' term]+ ')' S*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    functionText = null,
                    lt;

                //IE function can begin like a regular function, too
                if (tokenStream.match([Tokens.IE_FUNCTION, Tokens.FUNCTION])) {
                    functionText = tokenStream.token().value;

                    do {

                        if (this._readWhitespace()) {
                            functionText += tokenStream.token().value;
                        }

                        //might be second time in the loop
                        if (tokenStream.LA(0) === Tokens.COMMA) {
                            functionText += tokenStream.token().value;
                        }

                        tokenStream.match(Tokens.IDENT);
                        functionText += tokenStream.token().value;

                        tokenStream.match(Tokens.EQUALS);
                        functionText += tokenStream.token().value;

                        //functionText += this._term();
                        lt = tokenStream.peek();
                        while (lt !== Tokens.COMMA && lt !== Tokens.S && lt !== Tokens.RPAREN) {
                            tokenStream.get();
                            functionText += tokenStream.token().value;
                            lt = tokenStream.peek();
                        }
                    } while (tokenStream.match([Tokens.COMMA, Tokens.S]));

                    tokenStream.match(Tokens.RPAREN);
                    functionText += ")";
                    this._readWhitespace();
                }

                return functionText;
            },

            _hexcolor: function() {
                /*
                 * There is a constraint on the color that it must
                 * have either 3 or 6 hex-digits (i.e., [0-9a-fA-F])
                 * after the "#"; e.g., "#000" is OK, but "#abcd" is not.
                 *
                 * hexcolor
                 *   : HASH S*
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    token = null,
                    color;

                if (tokenStream.match(Tokens.HASH)) {

                    //need to do some validation here

                    token = tokenStream.token();
                    color = token.value;
                    if (!/#[a-f0-9]{3,6}/i.test(color)) {
                        throw new SyntaxError("Expected a hex color but found '" + color + "' at line " + token.startLine + ", col " + token.startCol + ".", token.startLine, token.startCol);
                    }
                    this._readWhitespace();
                }

                return token;
            },

            //-----------------------------------------------------------------
            // Animations methods
            //-----------------------------------------------------------------

            _keyframes: function() {

                /*
                 * keyframes:
                 *   : KEYFRAMES_SYM S* keyframe_name S* '{' S* keyframe_rule* '}' {
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    token,
                    tt,
                    name,
                    prefix = "";

                tokenStream.mustMatch(Tokens.KEYFRAMES_SYM);
                token = tokenStream.token();
                if (/^@\-([^\-]+)\-/.test(token.value)) {
                    prefix = RegExp.$1;
                }

                this._readWhitespace();
                name = this._keyframe_name();

                this._readWhitespace();
                tokenStream.mustMatch(Tokens.LBRACE);

                this.fire({
                    type:   "startkeyframes",
                    name:   name,
                    prefix: prefix,
                    line:   token.startLine,
                    col:    token.startCol
                });

                this._readWhitespace();
                tt = tokenStream.peek();

                //check for key
                while (tt === Tokens.IDENT || tt === Tokens.PERCENTAGE) {
                    this._keyframe_rule();
                    this._readWhitespace();
                    tt = tokenStream.peek();
                }

                this.fire({
                    type:   "endkeyframes",
                    name:   name,
                    prefix: prefix,
                    line:   token.startLine,
                    col:    token.startCol
                });

                this._readWhitespace();
                tokenStream.mustMatch(Tokens.RBRACE);
                this._readWhitespace();
            },

            _keyframe_name: function() {

                /*
                 * keyframe_name:
                 *   : IDENT
                 *   | STRING
                 *   ;
                 */
                var tokenStream = this._tokenStream;

                tokenStream.mustMatch([Tokens.IDENT, Tokens.STRING]);
                return SyntaxUnit.fromToken(tokenStream.token());
            },

            _keyframe_rule: function() {

                /*
                 * keyframe_rule:
                 *   : key_list S*
                 *     '{' S* declaration [ ';' S* declaration ]* '}' S*
                 *   ;
                 */
                var keyList = this._key_list();

                this.fire({
                    type:   "startkeyframerule",
                    keys:   keyList,
                    line:   keyList[0].line,
                    col:    keyList[0].col
                });

                this._readDeclarations(true);

                this.fire({
                    type:   "endkeyframerule",
                    keys:   keyList,
                    line:   keyList[0].line,
                    col:    keyList[0].col
                });
            },

            _key_list: function() {

                /*
                 * key_list:
                 *   : key [ S* ',' S* key]*
                 *   ;
                 */
                var tokenStream = this._tokenStream,
                    keyList = [];

                //must be least one key
                keyList.push(this._key());

                this._readWhitespace();

                while (tokenStream.match(Tokens.COMMA)) {
                    this._readWhitespace();
                    keyList.push(this._key());
                    this._readWhitespace();
                }

                return keyList;
            },

            _key: function() {
                /*
                 * There is a restriction that IDENT can be only "from" or "to".
                 *
                 * key
                 *   : PERCENTAGE
                 *   | IDENT
                 *   ;
                 */

                var tokenStream = this._tokenStream,
                    token;

                if (tokenStream.match(Tokens.PERCENTAGE)) {
                    return SyntaxUnit.fromToken(tokenStream.token());
                } else if (tokenStream.match(Tokens.IDENT)) {
                    token = tokenStream.token();

                    if (/from|to/i.test(token.value)) {
                        return SyntaxUnit.fromToken(token);
                    }

                    tokenStream.unget();
                }

                //if it gets here, there wasn't a valid token, so time to explode
                this._unexpectedToken(tokenStream.LT(1));
            },

            //-----------------------------------------------------------------
            // Helper methods
            //-----------------------------------------------------------------

            /**
             * Not part of CSS grammar, but useful for skipping over
             * combination of white space and HTML-style comments.
             * @return {void}
             * @method _skipCruft
             * @private
             */
            _skipCruft: function() {
                while (this._tokenStream.match([Tokens.S, Tokens.CDO, Tokens.CDC])) {
                    //noop
                }
            },

            /**
             * Not part of CSS grammar, but this pattern occurs frequently
             * in the official CSS grammar. Split out here to eliminate
             * duplicate code.
             * @param {Boolean} checkStart Indicates if the rule should check
             *      for the left brace at the beginning.
             * @param {Boolean} readMargins Indicates if the rule should check
             *      for margin patterns.
             * @return {void}
             * @method _readDeclarations
             * @private
             */
            _readDeclarations: function(checkStart, readMargins) {
                /*
                 * Reads the pattern
                 * S* '{' S* declaration [ ';' S* declaration ]* '}' S*
                 * or
                 * S* '{' S* [ declaration | margin ]? [ ';' S* [ declaration | margin ]? ]* '}' S*
                 * Note that this is how it is described in CSS3 Paged Media, but is actually incorrect.
                 * A semicolon is only necessary following a declaration if there's another declaration
                 * or margin afterwards.
                 */
                var tokenStream = this._tokenStream,
                    tt;

                this._readWhitespace();

                if (checkStart) {
                    tokenStream.mustMatch(Tokens.LBRACE);
                }

                this._readWhitespace();

                try {

                    while (true) {

                        if (tokenStream.match(Tokens.SEMICOLON) || (readMargins && this._margin())) {
                            //noop
                        } else if (this._declaration()) {
                            if (!tokenStream.match(Tokens.SEMICOLON)) {
                                break;
                            }
                        } else {
                            break;
                        }

                        //if ((!this._margin() && !this._declaration()) || !tokenStream.match(Tokens.SEMICOLON)){
                        //    break;
                        //}
                        this._readWhitespace();
                    }

                    tokenStream.mustMatch(Tokens.RBRACE);
                    this._readWhitespace();
                } catch (ex) {
                    if (ex instanceof SyntaxError && !this.options.strict) {

                        //fire error event
                        this.fire({
                            type:       "error",
                            error:      ex,
                            message:    ex.message,
                            line:       ex.line,
                            col:        ex.col
                        });

                        //see if there's another declaration
                        tt = tokenStream.advance([Tokens.SEMICOLON, Tokens.RBRACE]);
                        if (tt === Tokens.SEMICOLON) {
                            //if there's a semicolon, then there might be another declaration
                            this._readDeclarations(false, readMargins);
                        } else if (tt !== Tokens.RBRACE) {
                            //if there's a right brace, the rule is finished so don't do anything
                            //otherwise, rethrow the error because it wasn't handled properly
                            throw ex;
                        }
                    } else {
                        //not a syntax error, rethrow it
                        throw ex;
                    }
                }
            },

            /**
             * In some cases, you can end up with two white space tokens in a
             * row. Instead of making a change in every function that looks for
             * white space, this function is used to match as much white space
             * as necessary.
             * @method _readWhitespace
             * @return {String} The white space if found, empty string if not.
             * @private
             */
            _readWhitespace: function() {

                var tokenStream = this._tokenStream,
                    ws = "";

                while (tokenStream.match(Tokens.S)) {
                    ws += tokenStream.token().value;
                }

                return ws;
            },

            /**
             * Throws an error when an unexpected token is found.
             * @param {Object} token The token that was found.
             * @method _unexpectedToken
             * @return {void}
             * @private
             */
            _unexpectedToken: function(token) {
                throw new SyntaxError("Unexpected token '" + token.value + "' at line " + token.startLine + ", col " + token.startCol + ".", token.startLine, token.startCol);
            },

            /**
             * Helper method used for parsing subparts of a style sheet.
             * @return {void}
             * @method _verifyEnd
             * @private
             */
            _verifyEnd: function() {
                if (this._tokenStream.LA(1) !== Tokens.EOF) {
                    this._unexpectedToken(this._tokenStream.LT(1));
                }
            },

            //-----------------------------------------------------------------
            // Validation methods
            //-----------------------------------------------------------------
            _validateProperty: function(property, value) {
                Validation.validate(property, value);
            },

            //-----------------------------------------------------------------
            // Parsing methods
            //-----------------------------------------------------------------

            parse: function(input) {
                this._tokenStream = new TokenStream(input, Tokens);
                this._stylesheet();
            },

            parseStyleSheet: function(input) {
                //just passthrough
                return this.parse(input);
            },

            parseMediaQuery: function(input) {
                this._tokenStream = new TokenStream(input, Tokens);
                var result = this._media_query();

                //if there's anything more, then it's an invalid selector
                this._verifyEnd();

                //otherwise return result
                return result;
            },

            /**
             * Parses a property value (everything after the semicolon).
             * @return {parserlib.css.PropertyValue} The property value.
             * @throws parserlib.util.SyntaxError If an unexpected token is found.
             * @method parserPropertyValue
             */
            parsePropertyValue: function(input) {

                this._tokenStream = new TokenStream(input, Tokens);
                this._readWhitespace();

                var result = this._expr();

                //okay to have a trailing white space
                this._readWhitespace();

                //if there's anything more, then it's an invalid selector
                this._verifyEnd();

                //otherwise return result
                return result;
            },

            /**
             * Parses a complete CSS rule, including selectors and
             * properties.
             * @param {String} input The text to parser.
             * @return {Boolean} True if the parse completed successfully, false if not.
             * @method parseRule
             */
            parseRule: function(input) {
                this._tokenStream = new TokenStream(input, Tokens);

                //skip any leading white space
                this._readWhitespace();

                var result = this._ruleset();

                //skip any trailing white space
                this._readWhitespace();

                //if there's anything more, then it's an invalid selector
                this._verifyEnd();

                //otherwise return result
                return result;
            },

            /**
             * Parses a single CSS selector (no comma)
             * @param {String} input The text to parse as a CSS selector.
             * @return {Selector} An object representing the selector.
             * @throws parserlib.util.SyntaxError If an unexpected token is found.
             * @method parseSelector
             */
            parseSelector: function(input) {

                this._tokenStream = new TokenStream(input, Tokens);

                //skip any leading white space
                this._readWhitespace();

                var result = this._selector();

                //skip any trailing white space
                this._readWhitespace();

                //if there's anything more, then it's an invalid selector
                this._verifyEnd();

                //otherwise return result
                return result;
            },

            /**
             * Parses an HTML style attribute: a set of CSS declarations
             * separated by semicolons.
             * @param {String} input The text to parse as a style attribute
             * @return {void}
             * @method parseStyleAttribute
             */
            parseStyleAttribute: function(input) {
                input += "}"; // for error recovery in _readDeclarations()
                this._tokenStream = new TokenStream(input, Tokens);
                this._readDeclarations();
            }
        };

    //copy over onto prototype
    for (prop in additions) {
        if (Object.prototype.hasOwnProperty.call(additions, prop)) {
            proto[prop] = additions[prop];
        }
    }

    return proto;
}();

/*
nth
  : S* [ ['-'|'+']? INTEGER? {N} [ S* ['-'|'+'] S* INTEGER ]? |
         ['-'|'+']? INTEGER | {O}{D}{D} | {E}{V}{E}{N} ] S*
  ;
*/
},{"../util/EventTarget":23,"../util/SyntaxError":25,"../util/SyntaxUnit":26,"./Combinator":2,"./MediaFeature":4,"./MediaQuery":5,"./PropertyName":8,"./PropertyValue":9,"./PropertyValuePart":11,"./Selector":13,"./SelectorPart":14,"./SelectorSubPart":15,"./TokenStream":17,"./Tokens":18,"./Validation":19}],7:[function(require,module,exports){
"use strict";

/* exported Properties */

var Properties = module.exports = {
    __proto__: null,

    //A
    "align-items"                   : "flex-start | flex-end | center | baseline | stretch",
    "align-content"                 : "flex-start | flex-end | center | space-between | space-around | stretch",
    "align-self"                    : "auto | flex-start | flex-end | center | baseline | stretch",
    "all"                           : "initial | inherit | unset",
    "-webkit-align-items"           : "flex-start | flex-end | center | baseline | stretch",
    "-webkit-align-content"         : "flex-start | flex-end | center | space-between | space-around | stretch",
    "-webkit-align-self"            : "auto | flex-start | flex-end | center | baseline | stretch",
    "alignment-adjust"              : "auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical | <percentage> | <length>",
    "alignment-baseline"            : "auto | baseline | use-script | before-edge | text-before-edge | after-edge | text-after-edge | central | middle | ideographic | alphabetic | hanging | mathematical",
    "animation"                     : 1,
    "animation-delay"               : "<time>#",
    "animation-direction"           : "<single-animation-direction>#",
    "animation-duration"            : "<time>#",
    "animation-fill-mode"           : "[ none | forwards | backwards | both ]#",
    "animation-iteration-count"     : "[ <number> | infinite ]#",
    "animation-name"                : "[ none | <single-animation-name> ]#",
    "animation-play-state"          : "[ running | paused ]#",
    "animation-timing-function"     : 1,

    //vendor prefixed
    "-moz-animation-delay"               : "<time>#",
    "-moz-animation-direction"           : "[ normal | alternate ]#",
    "-moz-animation-duration"            : "<time>#",
    "-moz-animation-iteration-count"     : "[ <number> | infinite ]#",
    "-moz-animation-name"                : "[ none | <single-animation-name> ]#",
    "-moz-animation-play-state"          : "[ running | paused ]#",

    "-ms-animation-delay"               : "<time>#",
    "-ms-animation-direction"           : "[ normal | alternate ]#",
    "-ms-animation-duration"            : "<time>#",
    "-ms-animation-iteration-count"     : "[ <number> | infinite ]#",
    "-ms-animation-name"                : "[ none | <single-animation-name> ]#",
    "-ms-animation-play-state"          : "[ running | paused ]#",

    "-webkit-animation-delay"               : "<time>#",
    "-webkit-animation-direction"           : "[ normal | alternate ]#",
    "-webkit-animation-duration"            : "<time>#",
    "-webkit-animation-fill-mode"           : "[ none | forwards | backwards | both ]#",
    "-webkit-animation-iteration-count"     : "[ <number> | infinite ]#",
    "-webkit-animation-name"                : "[ none | <single-animation-name> ]#",
    "-webkit-animation-play-state"          : "[ running | paused ]#",

    "-o-animation-delay"               : "<time>#",
    "-o-animation-direction"           : "[ normal | alternate ]#",
    "-o-animation-duration"            : "<time>#",
    "-o-animation-iteration-count"     : "[ <number> | infinite ]#",
    "-o-animation-name"                : "[ none | <single-animation-name> ]#",
    "-o-animation-play-state"          : "[ running | paused ]#",

    "appearance"                    : "none | auto",
    "-moz-appearance"               : "none | button | button-arrow-down | button-arrow-next | button-arrow-previous | button-arrow-up | button-bevel | button-focus | caret | checkbox | checkbox-container | checkbox-label | checkmenuitem | dualbutton | groupbox | listbox | listitem | menuarrow | menubar | menucheckbox | menuimage | menuitem | menuitemtext | menulist | menulist-button | menulist-text | menulist-textfield | menupopup | menuradio | menuseparator | meterbar | meterchunk | progressbar | progressbar-vertical | progresschunk | progresschunk-vertical | radio | radio-container | radio-label | radiomenuitem | range | range-thumb | resizer | resizerpanel | scale-horizontal | scalethumbend | scalethumb-horizontal | scalethumbstart | scalethumbtick | scalethumb-vertical | scale-vertical | scrollbarbutton-down | scrollbarbutton-left | scrollbarbutton-right | scrollbarbutton-up | scrollbarthumb-horizontal | scrollbarthumb-vertical | scrollbartrack-horizontal | scrollbartrack-vertical | searchfield | separator | sheet | spinner | spinner-downbutton | spinner-textfield | spinner-upbutton | splitter | statusbar | statusbarpanel | tab | tabpanel | tabpanels | tab-scroll-arrow-back | tab-scroll-arrow-forward | textfield | textfield-multiline | toolbar | toolbarbutton | toolbarbutton-dropdown | toolbargripper | toolbox | tooltip | treeheader | treeheadercell | treeheadersortarrow | treeitem | treeline | treetwisty | treetwistyopen | treeview | -moz-mac-unified-toolbar | -moz-win-borderless-glass | -moz-win-browsertabbar-toolbox | -moz-win-communicationstext | -moz-win-communications-toolbox | -moz-win-exclude-glass | -moz-win-glass | -moz-win-mediatext | -moz-win-media-toolbox | -moz-window-button-box | -moz-window-button-box-maximized | -moz-window-button-close | -moz-window-button-maximize | -moz-window-button-minimize | -moz-window-button-restore | -moz-window-frame-bottom | -moz-window-frame-left | -moz-window-frame-right | -moz-window-titlebar | -moz-window-titlebar-maximized",
    "-ms-appearance"                : "none | icon | window | desktop | workspace | document | tooltip | dialog | button | push-button | hyperlink | radio | radio-button | checkbox | menu-item | tab | menu | menubar | pull-down-menu | pop-up-menu | list-menu | radio-group | checkbox-group | outline-tree | range | field | combo-box | signature | password | normal",
    "-webkit-appearance"            : "none | button | button-bevel | caps-lock-indicator | caret | checkbox | default-button | listbox | listitem | media-fullscreen-button | media-mute-button | media-play-button | media-seek-back-button | media-seek-forward-button | media-slider | media-sliderthumb | menulist | menulist-button | menulist-text | menulist-textfield | push-button | radio | searchfield | searchfield-cancel-button | searchfield-decoration | searchfield-results-button | searchfield-results-decoration | slider-horizontal | slider-vertical | sliderthumb-horizontal | sliderthumb-vertical | square-button | textarea | textfield | scrollbarbutton-down | scrollbarbutton-left | scrollbarbutton-right | scrollbarbutton-up | scrollbargripper-horizontal | scrollbargripper-vertical | scrollbarthumb-horizontal | scrollbarthumb-vertical | scrollbartrack-horizontal | scrollbartrack-vertical",
    "-o-appearance"                 : "none | window | desktop | workspace | document | tooltip | dialog | button | push-button | hyperlink | radio | radio-button | checkbox | menu-item | tab | menu | menubar | pull-down-menu | pop-up-menu | list-menu | radio-group | checkbox-group | outline-tree | range | field | combo-box | signature | password | normal",

    "azimuth"                       : "<azimuth>",

    //B
    "backface-visibility"           : "visible | hidden",
    "background"                    : 1,
    "background-attachment"         : "<attachment>#",
    "background-clip"               : "<box>#",
    "background-color"              : "<color>",
    "background-image"              : "<bg-image>#",
    "background-origin"             : "<box>#",
    "background-position"           : "<bg-position>",
    "background-repeat"             : "<repeat-style>#",
    "background-size"               : "<bg-size>#",
    "baseline-shift"                : "baseline | sub | super | <percentage> | <length>",
    "behavior"                      : 1,
    "binding"                       : 1,
    "bleed"                         : "<length>",
    "bookmark-label"                : "<content> | <attr> | <string>",
    "bookmark-level"                : "none | <integer>",
    "bookmark-state"                : "open | closed",
    "bookmark-target"               : "none | <uri> | <attr>",
    "border"                        : "<border-width> || <border-style> || <color>",
    "border-bottom"                 : "<border-width> || <border-style> || <color>",
    "border-bottom-color"           : "<color>",
    "border-bottom-left-radius"     :  "<x-one-radius>",
    "border-bottom-right-radius"    :  "<x-one-radius>",
    "border-bottom-style"           : "<border-style>",
    "border-bottom-width"           : "<border-width>",
    "border-collapse"               : "collapse | separate",
    "border-color"                  : "<color>{1,4}",
    "border-image"                  : 1,
    "border-image-outset"           : "[ <length> | <number> ]{1,4}",
    "border-image-repeat"           : "[ stretch | repeat | round ]{1,2}",
    "border-image-slice"            : "<border-image-slice>",
    "border-image-source"           : "<image> | none",
    "border-image-width"            : "[ <length> | <percentage> | <number> | auto ]{1,4}",
    "border-left"                   : "<border-width> || <border-style> || <color>",
    "border-left-color"             : "<color>",
    "border-left-style"             : "<border-style>",
    "border-left-width"             : "<border-width>",
    "border-radius"                 : "<border-radius>",
    "border-right"                  : "<border-width> || <border-style> || <color>",
    "border-right-color"            : "<color>",
    "border-right-style"            : "<border-style>",
    "border-right-width"            : "<border-width>",
    "border-spacing"                : "<length>{1,2}",
    "border-style"                  : "<border-style>{1,4}",
    "border-top"                    : "<border-width> || <border-style> || <color>",
    "border-top-color"              : "<color>",
    "border-top-left-radius"        : "<x-one-radius>",
    "border-top-right-radius"       : "<x-one-radius>",
    "border-top-style"              : "<border-style>",
    "border-top-width"              : "<border-width>",
    "border-width"                  : "<border-width>{1,4}",
    "bottom"                        : "<margin-width>",
    "-moz-box-align"                : "start | end | center | baseline | stretch",
    "-moz-box-decoration-break"     : "slice | clone",
    "-moz-box-direction"            : "normal | reverse",
    "-moz-box-flex"                 : "<number>",
    "-moz-box-flex-group"           : "<integer>",
    "-moz-box-lines"                : "single | multiple",
    "-moz-box-ordinal-group"        : "<integer>",
    "-moz-box-orient"               : "horizontal | vertical | inline-axis | block-axis",
    "-moz-box-pack"                 : "start | end | center | justify",
    "-o-box-decoration-break"       : "slice | clone",
    "-webkit-box-align"             : "start | end | center | baseline | stretch",
    "-webkit-box-decoration-break"  : "slice | clone",
    "-webkit-box-direction"         : "normal | reverse",
    "-webkit-box-flex"              : "<number>",
    "-webkit-box-flex-group"        : "<integer>",
    "-webkit-box-lines"             : "single | multiple",
    "-webkit-box-ordinal-group"     : "<integer>",
    "-webkit-box-orient"            : "horizontal | vertical | inline-axis | block-axis",
    "-webkit-box-pack"              : "start | end | center | justify",
    "box-decoration-break"          : "slice | clone",
    "box-shadow"                    : "<box-shadow>",
    "box-sizing"                    : "content-box | border-box",
    "break-after"                   : "auto | always | avoid | left | right | page | column | avoid-page | avoid-column",
    "break-before"                  : "auto | always | avoid | left | right | page | column | avoid-page | avoid-column",
    "break-inside"                  : "auto | avoid | avoid-page | avoid-column",

    //C
    "caption-side"                  : "top | bottom",
    "clear"                         : "none | right | left | both",
    "clip"                          : "<shape> | auto",
    "-webkit-clip-path"             : "<clip-source> | <clip-path> | none",
    "clip-path"                     : "<clip-source> | <clip-path> | none",
    "clip-rule"                     : "nonzero | evenodd",
    "color"                         : "<color>",
    "color-interpolation"           : "auto | sRGB | linearRGB",
    "color-interpolation-filters"   : "auto | sRGB | linearRGB",
    "color-profile"                 : 1,
    "color-rendering"               : "auto | optimizeSpeed | optimizeQuality",
    "column-count"                  : "<integer> | auto",                      //https://www.w3.org/TR/css3-multicol/
    "column-fill"                   : "auto | balance",
    "column-gap"                    : "<length> | normal",
    "column-rule"                   : "<border-width> || <border-style> || <color>",
    "column-rule-color"             : "<color>",
    "column-rule-style"             : "<border-style>",
    "column-rule-width"             : "<border-width>",
    "column-span"                   : "none | all",
    "column-width"                  : "<length> | auto",
    "columns"                       : 1,
    "content"                       : 1,
    "counter-increment"             : 1,
    "counter-reset"                 : 1,
    "crop"                          : "<shape> | auto",
    "cue"                           : "cue-after | cue-before",
    "cue-after"                     : 1,
    "cue-before"                    : 1,
    "cursor"                        : 1,

    //D
    "direction"                     : "ltr | rtl",
    "display"                       : "inline | block | list-item | inline-block | table | inline-table | table-row-group | table-header-group | table-footer-group | table-row | table-column-group | table-column | table-cell | table-caption | grid | inline-grid | run-in | ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | contents | none | -moz-box | -moz-inline-block | -moz-inline-box | -moz-inline-grid | -moz-inline-stack | -moz-inline-table | -moz-grid | -moz-grid-group | -moz-grid-line | -moz-groupbox | -moz-deck | -moz-popup | -moz-stack | -moz-marker | -webkit-box | -webkit-inline-box | -ms-flexbox | -ms-inline-flexbox | flex | -webkit-flex | inline-flex | -webkit-inline-flex",
    "dominant-baseline"             : "auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge",
    "drop-initial-after-adjust"     : "central | middle | after-edge | text-after-edge | ideographic | alphabetic | mathematical | <percentage> | <length>",
    "drop-initial-after-align"      : "baseline | use-script | before-edge | text-before-edge | after-edge | text-after-edge | central | middle | ideographic | alphabetic | hanging | mathematical",
    "drop-initial-before-adjust"    : "before-edge | text-before-edge | central | middle | hanging | mathematical | <percentage> | <length>",
    "drop-initial-before-align"     : "caps-height | baseline | use-script | before-edge | text-before-edge | after-edge | text-after-edge | central | middle | ideographic | alphabetic | hanging | mathematical",
    "drop-initial-size"             : "auto | line | <length> | <percentage>",
    "drop-initial-value"            : "<integer>",

    //E
    "elevation"                     : "<angle> | below | level | above | higher | lower",
    "empty-cells"                   : "show | hide",
    "enable-background"             : 1,

    //F
    "fill"                          : "<paint>",
    "fill-opacity"                  : "<opacity-value>",
    "fill-rule"                     : "nonzero | evenodd",
    "filter"                        : "<filter-function-list> | none",
    "fit"                           : "fill | hidden | meet | slice",
    "fit-position"                  : 1,
    "flex"                          : "<flex>",
    "flex-basis"                    : "<width>",
    "flex-direction"                : "row | row-reverse | column | column-reverse",
    "flex-flow"                     : "<flex-direction> || <flex-wrap>",
    "flex-grow"                     : "<number>",
    "flex-shrink"                   : "<number>",
    "flex-wrap"                     : "nowrap | wrap | wrap-reverse",
    "-webkit-flex"                  : "<flex>",
    "-webkit-flex-basis"            : "<width>",
    "-webkit-flex-direction"        : "row | row-reverse | column | column-reverse",
    "-webkit-flex-flow"             : "<flex-direction> || <flex-wrap>",
    "-webkit-flex-grow"             : "<number>",
    "-webkit-flex-shrink"           : "<number>",
    "-webkit-flex-wrap"             : "nowrap | wrap | wrap-reverse",
    "-ms-flex"                      : "<flex>",
    "-ms-flex-align"                : "start | end | center | stretch | baseline",
    "-ms-flex-direction"            : "row | row-reverse | column | column-reverse",
    "-ms-flex-order"                : "<number>",
    "-ms-flex-pack"                 : "start | end | center | justify",
    "-ms-flex-wrap"                 : "nowrap | wrap | wrap-reverse",
    "float"                         : "left | right | none",
    "float-offset"                  : 1,
    "flood-color"                   : 1,
    "flood-opacity"                 : "<opacity-value>",
    "font"                          : "<font-shorthand> | caption | icon | menu | message-box | small-caption | status-bar",
    "font-family"                   : "<font-family>",
    "font-feature-settings"         : "<feature-tag-value> | normal",
    "font-kerning"                  : "auto | normal | none",
    "font-size"                     : "<font-size>",
    "font-size-adjust"              : "<number> | none",
    "font-stretch"                  : "<font-stretch>",
    "font-style"                    : "<font-style>",
    "font-variant"                  : "<font-variant> | normal | none",
    "font-variant-alternates"       : "<font-variant-alternates> | normal",
    "font-variant-caps"             : "<font-variant-caps> | normal",
    "font-variant-east-asian"       : "<font-variant-east-asian> | normal",
    "font-variant-ligatures"        : "<font-variant-ligatures> | normal | none",
    "font-variant-numeric"          : "<font-variant-numeric> | normal",
    "font-variant-position"         : "normal | sub | super",
    "font-weight"                   : "<font-weight>",

    //G
    "glyph-orientation-horizontal"  : "<glyph-angle>",
    "glyph-orientation-vertical"    : "auto | <glyph-angle>",
    "grid"                          : 1,
    "grid-area"                     : 1,
    "grid-auto-columns"             : 1,
    "grid-auto-flow"                : 1,
    "grid-auto-position"            : 1,
    "grid-auto-rows"                : 1,
    "grid-cell-stacking"            : "columns | rows | layer",
    "grid-column"                   : 1,
    "grid-columns"                  : 1,
    "grid-column-align"             : "start | end | center | stretch",
    "grid-column-sizing"            : 1,
    "grid-column-start"             : 1,
    "grid-column-end"               : 1,
    "grid-column-span"              : "<integer>",
    "grid-flow"                     : "none | rows | columns",
    "grid-layer"                    : "<integer>",
    "grid-row"                      : 1,
    "grid-rows"                     : 1,
    "grid-row-align"                : "start | end | center | stretch",
    "grid-row-start"                : 1,
    "grid-row-end"                  : 1,
    "grid-row-span"                 : "<integer>",
    "grid-row-sizing"               : 1,
    "grid-template"                 : 1,
    "grid-template-areas"           : 1,
    "grid-template-columns"         : 1,
    "grid-template-rows"            : 1,

    //H
    "hanging-punctuation"           : 1,
    "height"                        : "<margin-width> | <content-sizing>",
    "hyphenate-after"               : "<integer> | auto",
    "hyphenate-before"              : "<integer> | auto",
    "hyphenate-character"           : "<string> | auto",
    "hyphenate-lines"               : "no-limit | <integer>",
    "hyphenate-resource"            : 1,
    "hyphens"                       : "none | manual | auto",

    //I
    "icon"                          : 1,
    "image-orientation"             : "angle | auto",
    "image-rendering"               : "auto | optimizeSpeed | optimizeQuality",
    "image-resolution"              : 1,
    "ime-mode"                      : "auto | normal | active | inactive | disabled",
    "inline-box-align"              : "last | <integer>",

    //J
    "justify-content"               : "flex-start | flex-end | center | space-between | space-around",
    "-webkit-justify-content"       : "flex-start | flex-end | center | space-between | space-around",

    //K
    "kerning"                       : "auto | <length>",

    //L
    "left"                          : "<margin-width>",
    "letter-spacing"                : "<length> | normal",
    "line-height"                   : "<line-height>",
    "line-break"                    : "auto | loose | normal | strict",
    "line-stacking"                 : 1,
    "line-stacking-ruby"            : "exclude-ruby | include-ruby",
    "line-stacking-shift"           : "consider-shifts | disregard-shifts",
    "line-stacking-strategy"        : "inline-line-height | block-line-height | max-height | grid-height",
    "list-style"                    : 1,
    "list-style-image"              : "<uri> | none",
    "list-style-position"           : "inside | outside",
    "list-style-type"               : "disc | circle | square | decimal | decimal-leading-zero | lower-roman | upper-roman | lower-greek | lower-latin | upper-latin | armenian | georgian | lower-alpha | upper-alpha | none",

    //M
    "margin"                        : "<margin-width>{1,4}",
    "margin-bottom"                 : "<margin-width>",
    "margin-left"                   : "<margin-width>",
    "margin-right"                  : "<margin-width>",
    "margin-top"                    : "<margin-width>",
    "mark"                          : 1,
    "mark-after"                    : 1,
    "mark-before"                   : 1,
    "marker"                        : 1,
    "marker-end"                    : 1,
    "marker-mid"                    : 1,
    "marker-start"                  : 1,
    "marks"                         : 1,
    "marquee-direction"             : 1,
    "marquee-play-count"            : 1,
    "marquee-speed"                 : 1,
    "marquee-style"                 : 1,
    "mask"                          : 1,
    "max-height"                    : "<length> | <percentage> | <content-sizing> | none",
    "max-width"                     : "<length> | <percentage> | <content-sizing> | none",
    "min-height"                    : "<length> | <percentage> | <content-sizing> | contain-floats | -moz-contain-floats | -webkit-contain-floats",
    "min-width"                     : "<length> | <percentage> | <content-sizing> | contain-floats | -moz-contain-floats | -webkit-contain-floats",
    "move-to"                       : 1,

    //N
    "nav-down"                      : 1,
    "nav-index"                     : 1,
    "nav-left"                      : 1,
    "nav-right"                     : 1,
    "nav-up"                        : 1,

    //O
    "object-fit"                    : "fill | contain | cover | none | scale-down",
    "object-position"               : "<position>",
    "opacity"                       : "<opacity-value>",
    "order"                         : "<integer>",
    "-webkit-order"                 : "<integer>",
    "orphans"                       : "<integer>",
    "outline"                       : 1,
    "outline-color"                 : "<color> | invert",
    "outline-offset"                : 1,
    "outline-style"                 : "<border-style>",
    "outline-width"                 : "<border-width>",
    "overflow"                      : "visible | hidden | scroll | auto",
    "overflow-style"                : 1,
    "overflow-wrap"                 : "normal | break-word",
    "overflow-x"                    : 1,
    "overflow-y"                    : 1,

    //P
    "padding"                       : "<padding-width>{1,4}",
    "padding-bottom"                : "<padding-width>",
    "padding-left"                  : "<padding-width>",
    "padding-right"                 : "<padding-width>",
    "padding-top"                   : "<padding-width>",
    "page"                          : 1,
    "page-break-after"              : "auto | always | avoid | left | right",
    "page-break-before"             : "auto | always | avoid | left | right",
    "page-break-inside"             : "auto | avoid",
    "page-policy"                   : 1,
    "pause"                         : 1,
    "pause-after"                   : 1,
    "pause-before"                  : 1,
    "perspective"                   : 1,
    "perspective-origin"            : 1,
    "phonemes"                      : 1,
    "pitch"                         : 1,
    "pitch-range"                   : 1,
    "play-during"                   : 1,
    "pointer-events"                : "auto | none | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all",
    "position"                      : "static | relative | absolute | fixed",
    "presentation-level"            : 1,
    "punctuation-trim"              : 1,

    //Q
    "quotes"                        : 1,

    //R
    "rendering-intent"              : 1,
    "resize"                        : 1,
    "rest"                          : 1,
    "rest-after"                    : 1,
    "rest-before"                   : 1,
    "richness"                      : 1,
    "right"                         : "<margin-width>",
    "rotation"                      : 1,
    "rotation-point"                : 1,
    "ruby-align"                    : 1,
    "ruby-overhang"                 : 1,
    "ruby-position"                 : 1,
    "ruby-span"                     : 1,

    //S
    "shape-rendering"               : "auto | optimizeSpeed | crispEdges | geometricPrecision",
    "size"                          : 1,
    "speak"                         : "normal | none | spell-out",
    "speak-header"                  : "once | always",
    "speak-numeral"                 : "digits | continuous",
    "speak-punctuation"             : "code | none",
    "speech-rate"                   : 1,
    "src"                           : 1,
    "stop-color"                    : 1,
    "stop-opacity"                  : "<opacity-value>",
    "stress"                        : 1,
    "string-set"                    : 1,
    "stroke"                        : "<paint>",
    "stroke-dasharray"              : "none | <dasharray>",
    "stroke-dashoffset"             : "<percentage> | <length>",
    "stroke-linecap"                : "butt | round | square",
    "stroke-linejoin"               : "miter | round | bevel",
    "stroke-miterlimit"             : "<miterlimit>",
    "stroke-opacity"                : "<opacity-value>",
    "stroke-width"                  : "<percentage> | <length>",

    "table-layout"                  : "auto | fixed",
    "tab-size"                      : "<integer> | <length>",
    "target"                        : 1,
    "target-name"                   : 1,
    "target-new"                    : 1,
    "target-position"               : 1,
    "text-align"                    : "left | right | center | justify | match-parent | start | end",
    "text-align-last"               : 1,
    "text-anchor"                   : "start | middle | end",
    "text-decoration"               : "<text-decoration-line> || <text-decoration-style> || <text-decoration-color>",
    "text-decoration-color"         : "<text-decoration-color>",
    "text-decoration-line"          : "<text-decoration-line>",
    "text-decoration-style"         : "<text-decoration-style>",
    "text-emphasis"                 : 1,
    "text-height"                   : 1,
    "text-indent"                   : "<length> | <percentage>",
    "text-justify"                  : "auto | none | inter-word | inter-ideograph | inter-cluster | distribute | kashida",
    "text-outline"                  : 1,
    "text-overflow"                 : 1,
    "text-rendering"                : "auto | optimizeSpeed | optimizeLegibility | geometricPrecision",
    "text-shadow"                   : 1,
    "text-transform"                : "capitalize | uppercase | lowercase | none",
    "text-wrap"                     : "normal | none | avoid",
    "top"                           : "<margin-width>",
    "-ms-touch-action"              : "auto | none | pan-x | pan-y | pan-left | pan-right | pan-up | pan-down | manipulation",
    "touch-action"                  : "auto | none | pan-x | pan-y | pan-left | pan-right | pan-up | pan-down | manipulation",
    "transform"                     : 1,
    "transform-origin"              : 1,
    "transform-style"               : 1,
    "transition"                    : 1,
    "transition-delay"              : 1,
    "transition-duration"           : 1,
    "transition-property"           : 1,
    "transition-timing-function"    : 1,

    //U
    "unicode-bidi"                  : "normal | embed | isolate | bidi-override | isolate-override | plaintext",
    "user-modify"                   : "read-only | read-write | write-only",
    "user-select"                   : "none | text | toggle | element | elements | all",

    //V
    "vertical-align"                : "auto | use-script | baseline | sub | super | top | text-top | central | middle | bottom | text-bottom | <percentage> | <length>",
    "visibility"                    : "visible | hidden | collapse",
    "voice-balance"                 : 1,
    "voice-duration"                : 1,
    "voice-family"                  : 1,
    "voice-pitch"                   : 1,
    "voice-pitch-range"             : 1,
    "voice-rate"                    : 1,
    "voice-stress"                  : 1,
    "voice-volume"                  : 1,
    "volume"                        : 1,

    //W
    "white-space"                   : "normal | pre | nowrap | pre-wrap | pre-line | -pre-wrap | -o-pre-wrap | -moz-pre-wrap | -hp-pre-wrap",   // https://perishablepress.com/wrapping-content/
    "white-space-collapse"          : 1,
    "widows"                        : "<integer>",
    "width"                         : "<length> | <percentage> | <content-sizing> | auto",
    "will-change"                   : "<will-change>",
    "word-break"                    : "normal | keep-all | break-all",
    "word-spacing"                  : "<length> | normal",
    "word-wrap"                     : "normal | break-word",
    "writing-mode"                  : "horizontal-tb | vertical-rl | vertical-lr | lr-tb | rl-tb | tb-rl | bt-rl | tb-lr | bt-lr | lr-bt | rl-bt | lr | rl | tb",

    //Z
    "z-index"                       : "<integer> | auto",
    "zoom"                          : "<number> | <percentage> | normal"
};
},{}],8:[function(require,module,exports){
"use strict";

module.exports = PropertyName;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");

/**
 * Represents a selector combinator (whitespace, +, >).
 * @namespace parserlib.css
 * @class PropertyName
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 * @param {String} text The text representation of the unit.
 * @param {String} hack The type of IE hack applied ("*", "_", or null).
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 */
function PropertyName(text, hack, line, col) {

    SyntaxUnit.call(this, text, line, col, Parser.PROPERTY_NAME_TYPE);

    /**
     * The type of IE hack applied ("*", "_", or null).
     * @type String
     * @property hack
     */
    this.hack = hack;
}

PropertyName.prototype = new SyntaxUnit();
PropertyName.prototype.constructor = PropertyName;
PropertyName.prototype.toString = function() {
    return (this.hack ? this.hack : "") + this.text;
};
},{"../util/SyntaxUnit":26,"./Parser":6}],9:[function(require,module,exports){
"use strict";

module.exports = PropertyValue;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");

/**
 * Represents a single part of a CSS property value, meaning that it represents
 * just everything single part between ":" and ";". If there are multiple values
 * separated by commas, this type represents just one of the values.
 * @param {String[]} parts An array of value parts making up this value.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 * @namespace parserlib.css
 * @class PropertyValue
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 */
function PropertyValue(parts, line, col) {

    SyntaxUnit.call(this, parts.join(" "), line, col, Parser.PROPERTY_VALUE_TYPE);

    /**
     * The parts that make up the selector.
     * @type Array
     * @property parts
     */
    this.parts = parts;
}

PropertyValue.prototype = new SyntaxUnit();
PropertyValue.prototype.constructor = PropertyValue;
},{"../util/SyntaxUnit":26,"./Parser":6}],10:[function(require,module,exports){
"use strict";

module.exports = PropertyValueIterator;

/**
 * A utility class that allows for easy iteration over the various parts of a
 * property value.
 * @param {parserlib.css.PropertyValue} value The property value to iterate over.
 * @namespace parserlib.css
 * @class PropertyValueIterator
 * @constructor
 */
function PropertyValueIterator(value) {

    /**
     * Iterator value
     * @type int
     * @property _i
     * @private
     */
    this._i = 0;

    /**
     * The parts that make up the value.
     * @type Array
     * @property _parts
     * @private
     */
    this._parts = value.parts;

    /**
     * Keeps track of bookmarks along the way.
     * @type Array
     * @property _marks
     * @private
     */
    this._marks = [];

    /**
     * Holds the original property value.
     * @type parserlib.css.PropertyValue
     * @property value
     */
    this.value = value;
}

/**
 * Returns the total number of parts in the value.
 * @return {int} The total number of parts in the value.
 * @method count
 */
PropertyValueIterator.prototype.count = function() {
    return this._parts.length;
};

/**
 * Indicates if the iterator is positioned at the first item.
 * @return {Boolean} True if positioned at first item, false if not.
 * @method isFirst
 */
PropertyValueIterator.prototype.isFirst = function() {
    return this._i === 0;
};

/**
 * Indicates if there are more parts of the property value.
 * @return {Boolean} True if there are more parts, false if not.
 * @method hasNext
 */
PropertyValueIterator.prototype.hasNext = function() {
    return this._i < this._parts.length;
};

/**
 * Marks the current spot in the iteration so it can be restored to
 * later on.
 * @return {void}
 * @method mark
 */
PropertyValueIterator.prototype.mark = function() {
    this._marks.push(this._i);
};

/**
 * Returns the next part of the property value or null if there is no next
 * part. Does not move the internal counter forward.
 * @return {parserlib.css.PropertyValuePart} The next part of the property value or null if there is no next
 * part.
 * @method peek
 */
PropertyValueIterator.prototype.peek = function(count) {
    return this.hasNext() ? this._parts[this._i + (count || 0)] : null;
};

/**
 * Returns the next part of the property value or null if there is no next
 * part.
 * @return {parserlib.css.PropertyValuePart} The next part of the property value or null if there is no next
 * part.
 * @method next
 */
PropertyValueIterator.prototype.next = function() {
    return this.hasNext() ? this._parts[this._i++] : null;
};

/**
 * Returns the previous part of the property value or null if there is no
 * previous part.
 * @return {parserlib.css.PropertyValuePart} The previous part of the
 * property value or null if there is no previous part.
 * @method previous
 */
PropertyValueIterator.prototype.previous = function() {
    return this._i > 0 ? this._parts[--this._i] : null;
};

/**
 * Restores the last saved bookmark.
 * @return {void}
 * @method restore
 */
PropertyValueIterator.prototype.restore = function() {
    if (this._marks.length) {
        this._i = this._marks.pop();
    }
};

/**
 * Drops the last saved bookmark.
 * @return {void}
 * @method drop
 */
PropertyValueIterator.prototype.drop = function() {
    this._marks.pop();
};
},{}],11:[function(require,module,exports){
"use strict";

module.exports = PropertyValuePart;

var SyntaxUnit = require("../util/SyntaxUnit");

var Colors = require("./Colors");
var Parser = require("./Parser");
var Tokens = require("./Tokens");

/**
 * Represents a single part of a CSS property value, meaning that it represents
 * just one part of the data between ":" and ";".
 * @param {String} text The text representation of the unit.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 * @namespace parserlib.css
 * @class PropertyValuePart
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 */
function PropertyValuePart(text, line, col, optionalHint) {
    var hint = optionalHint || {};

    SyntaxUnit.call(this, text, line, col, Parser.PROPERTY_VALUE_PART_TYPE);

    /**
     * Indicates the type of value unit.
     * @type String
     * @property type
     */
    this.type = "unknown";

    //figure out what type of data it is

    var temp;

    //it is a measurement?
    if (/^([+\-]?[\d\.]+)([a-z]+)$/i.test(text)) {  //dimension
        this.type = "dimension";
        this.value = +RegExp.$1;
        this.units = RegExp.$2;

        //try to narrow down
        switch (this.units.toLowerCase()) {

            case "em":
            case "rem":
            case "ex":
            case "px":
            case "cm":
            case "mm":
            case "in":
            case "pt":
            case "pc":
            case "ch":
            case "vh":
            case "vw":
            case "vmax":
            case "vmin":
                this.type = "length";
                break;

            case "fr":
                this.type = "grid";
                break;

            case "deg":
            case "rad":
            case "grad":
            case "turn":
                this.type = "angle";
                break;

            case "ms":
            case "s":
                this.type = "time";
                break;

            case "hz":
            case "khz":
                this.type = "frequency";
                break;

            case "dpi":
            case "dpcm":
                this.type = "resolution";
                break;

            //default
        }
    } else if (/^([+\-]?[\d\.]+)%$/i.test(text)) {  //percentage
        this.type = "percentage";
        this.value = +RegExp.$1;
    } else if (/^([+\-]?\d+)$/i.test(text)) {  //integer
        this.type = "integer";
        this.value = +RegExp.$1;
    } else if (/^([+\-]?[\d\.]+)$/i.test(text)) {  //number
        this.type = "number";
        this.value = +RegExp.$1;
    } else if (/^#([a-f0-9]{3,6})/i.test(text)) {  //hexcolor
        this.type = "color";
        temp = RegExp.$1;
        if (temp.length === 3) {
            this.red    = parseInt(temp.charAt(0)+temp.charAt(0), 16);
            this.green  = parseInt(temp.charAt(1)+temp.charAt(1), 16);
            this.blue   = parseInt(temp.charAt(2)+temp.charAt(2), 16);
        } else {
            this.red    = parseInt(temp.substring(0, 2), 16);
            this.green  = parseInt(temp.substring(2, 4), 16);
            this.blue   = parseInt(temp.substring(4, 6), 16);
        }
    } else if (/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i.test(text)) { //rgb() color with absolute numbers
        this.type   = "color";
        this.red    = +RegExp.$1;
        this.green  = +RegExp.$2;
        this.blue   = +RegExp.$3;
    } else if (/^rgb\(\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)/i.test(text)) { //rgb() color with percentages
        this.type   = "color";
        this.red    = +RegExp.$1 * 255 / 100;
        this.green  = +RegExp.$2 * 255 / 100;
        this.blue   = +RegExp.$3 * 255 / 100;
    } else if (/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d\.]+)\s*\)/i.test(text)) { //rgba() color with absolute numbers
        this.type   = "color";
        this.red    = +RegExp.$1;
        this.green  = +RegExp.$2;
        this.blue   = +RegExp.$3;
        this.alpha  = +RegExp.$4;
    } else if (/^rgba\(\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*,\s*([\d\.]+)\s*\)/i.test(text)) { //rgba() color with percentages
        this.type   = "color";
        this.red    = +RegExp.$1 * 255 / 100;
        this.green  = +RegExp.$2 * 255 / 100;
        this.blue   = +RegExp.$3 * 255 / 100;
        this.alpha  = +RegExp.$4;
    } else if (/^hsl\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)/i.test(text)) { //hsl()
        this.type   = "color";
        this.hue    = +RegExp.$1;
        this.saturation = +RegExp.$2 / 100;
        this.lightness  = +RegExp.$3 / 100;
    } else if (/^hsla\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*,\s*([\d\.]+)\s*\)/i.test(text)) { //hsla() color with percentages
        this.type   = "color";
        this.hue    = +RegExp.$1;
        this.saturation = +RegExp.$2 / 100;
        this.lightness  = +RegExp.$3 / 100;
        this.alpha  = +RegExp.$4;
    } else if (/^url\(("([^\\"]|\\.)*")\)/i.test(text)) { //URI
        // generated by TokenStream.readURI, so always double-quoted.
        this.type   = "uri";
        this.uri    = PropertyValuePart.parseString(RegExp.$1);
    } else if (/^([^\(]+)\(/i.test(text)) {
        this.type   = "function";
        this.name   = RegExp.$1;
        this.value  = text;
    } else if (/^"([^\n\r\f\\"]|\\\r\n|\\[^\r0-9a-f]|\\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?)*"/i.test(text)) {    //double-quoted string
        this.type   = "string";
        this.value  = PropertyValuePart.parseString(text);
    } else if (/^'([^\n\r\f\\']|\\\r\n|\\[^\r0-9a-f]|\\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?)*'/i.test(text)) {    //single-quoted string
        this.type   = "string";
        this.value  = PropertyValuePart.parseString(text);
    } else if (Colors[text.toLowerCase()]) {  //named color
        this.type   = "color";
        temp        = Colors[text.toLowerCase()].substring(1);
        this.red    = parseInt(temp.substring(0, 2), 16);
        this.green  = parseInt(temp.substring(2, 4), 16);
        this.blue   = parseInt(temp.substring(4, 6), 16);
    } else if (/^[,\/]$/.test(text)) {
        this.type   = "operator";
        this.value  = text;
    } else if (/^-?[a-z_\u00A0-\uFFFF][a-z0-9\-_\u00A0-\uFFFF]*$/i.test(text)) {
        this.type   = "identifier";
        this.value  = text;
    }

    // There can be ambiguity with escape sequences in identifiers, as
    // well as with "color" parts which are also "identifiers", so record
    // an explicit hint when the token generating this PropertyValuePart
    // was an identifier.
    this.wasIdent = Boolean(hint.ident);
}

PropertyValuePart.prototype = new SyntaxUnit();
PropertyValuePart.prototype.constructor = PropertyValuePart;

/**
 * Helper method to parse a CSS string.
 */
PropertyValuePart.parseString = function(str) {
    str = str.slice(1, -1); // Strip surrounding single/double quotes
    var replacer = function(match, esc) {
        if (/^(\n|\r\n|\r|\f)$/.test(esc)) {
            return "";
        }
        var m = /^[0-9a-f]{1,6}/i.exec(esc);
        if (m) {
            var codePoint = parseInt(m[0], 16);
            if (String.fromCodePoint) {
                return String.fromCodePoint(codePoint);
            } else {
                // XXX No support for surrogates on old JavaScript engines.
                return String.fromCharCode(codePoint);
            }
        }
        return esc;
    };
    return str.replace(/\\(\r\n|[^\r0-9a-f]|[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?)/ig,
                       replacer);
};

/**
 * Helper method to serialize a CSS string.
 */
PropertyValuePart.serializeString = function(value) {
    var replacer = function(match, c) {
        if (c === "\"") {
            return "\\" + c;
        }
        var cp = String.codePointAt ? String.codePointAt(0) :
            // We only escape non-surrogate chars, so using charCodeAt
            // is harmless here.
            String.charCodeAt(0);
        return "\\" + cp.toString(16) + " ";
    };
    return "\"" + value.replace(/["\r\n\f]/g, replacer) + "\"";
};

/**
 * Create a new syntax unit based solely on the given token.
 * Convenience method for creating a new syntax unit when
 * it represents a single token instead of multiple.
 * @param {Object} token The token object to represent.
 * @return {parserlib.css.PropertyValuePart} The object representing the token.
 * @static
 * @method fromToken
 */
PropertyValuePart.fromToken = function(token) {
    var part = new PropertyValuePart(token.value, token.startLine, token.startCol, {
        // Tokens can have escaped characters that would fool the type
        // identification in the PropertyValuePart constructor, so pass
        // in a hint if this was an identifier.
        ident: token.type === Tokens.IDENT
    });
    return part;
};
},{"../util/SyntaxUnit":26,"./Colors":1,"./Parser":6,"./Tokens":18}],12:[function(require,module,exports){
"use strict";

var Pseudos = module.exports = {
    __proto__:       null,
    ":first-letter": 1,
    ":first-line":   1,
    ":before":       1,
    ":after":        1
};

Pseudos.ELEMENT = 1;
Pseudos.CLASS = 2;

Pseudos.isElement = function(pseudo) {
    return pseudo.indexOf("::") === 0 || Pseudos[pseudo.toLowerCase()] === Pseudos.ELEMENT;
};
},{}],13:[function(require,module,exports){
"use strict";

module.exports = Selector;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");
var Specificity = require("./Specificity");

/**
 * Represents an entire single selector, including all parts but not
 * including multiple selectors (those separated by commas).
 * @namespace parserlib.css
 * @class Selector
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 * @param {Array} parts Array of selectors parts making up this selector.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 */
function Selector(parts, line, col) {

    SyntaxUnit.call(this, parts.join(" "), line, col, Parser.SELECTOR_TYPE);

    /**
     * The parts that make up the selector.
     * @type Array
     * @property parts
     */
    this.parts = parts;

    /**
     * The specificity of the selector.
     * @type parserlib.css.Specificity
     * @property specificity
     */
    this.specificity = Specificity.calculate(this);
}

Selector.prototype = new SyntaxUnit();
Selector.prototype.constructor = Selector;
},{"../util/SyntaxUnit":26,"./Parser":6,"./Specificity":16}],14:[function(require,module,exports){
"use strict";

module.exports = SelectorPart;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");

/**
 * Represents a single part of a selector string, meaning a single set of
 * element name and modifiers. This does not include combinators such as
 * spaces, +, >, etc.
 * @namespace parserlib.css
 * @class SelectorPart
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 * @param {String} elementName The element name in the selector or null
 *      if there is no element name.
 * @param {Array} modifiers Array of individual modifiers for the element.
 *      May be empty if there are none.
 * @param {String} text The text representation of the unit.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 */
function SelectorPart(elementName, modifiers, text, line, col) {

    SyntaxUnit.call(this, text, line, col, Parser.SELECTOR_PART_TYPE);

    /**
     * The tag name of the element to which this part
     * of the selector affects.
     * @type String
     * @property elementName
     */
    this.elementName = elementName;

    /**
     * The parts that come after the element name, such as class names, IDs,
     * pseudo classes/elements, etc.
     * @type Array
     * @property modifiers
     */
    this.modifiers = modifiers;
}

SelectorPart.prototype = new SyntaxUnit();
SelectorPart.prototype.constructor = SelectorPart;
},{"../util/SyntaxUnit":26,"./Parser":6}],15:[function(require,module,exports){
"use strict";

module.exports = SelectorSubPart;

var SyntaxUnit = require("../util/SyntaxUnit");

var Parser = require("./Parser");

/**
 * Represents a selector modifier string, meaning a class name, element name,
 * element ID, pseudo rule, etc.
 * @namespace parserlib.css
 * @class SelectorSubPart
 * @extends parserlib.util.SyntaxUnit
 * @constructor
 * @param {String} text The text representation of the unit.
 * @param {String} type The type of selector modifier.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 */
function SelectorSubPart(text, type, line, col) {

    SyntaxUnit.call(this, text, line, col, Parser.SELECTOR_SUB_PART_TYPE);

    /**
     * The type of modifier.
     * @type String
     * @property type
     */
    this.type = type;

    /**
     * Some subparts have arguments, this represents them.
     * @type Array
     * @property args
     */
    this.args = [];
}

SelectorSubPart.prototype = new SyntaxUnit();
SelectorSubPart.prototype.constructor = SelectorSubPart;
},{"../util/SyntaxUnit":26,"./Parser":6}],16:[function(require,module,exports){
"use strict";

module.exports = Specificity;

var Pseudos = require("./Pseudos");
var SelectorPart = require("./SelectorPart");

/**
 * Represents a selector's specificity.
 * @namespace parserlib.css
 * @class Specificity
 * @constructor
 * @param {int} a Should be 1 for inline styles, zero for stylesheet styles
 * @param {int} b Number of ID selectors
 * @param {int} c Number of classes and pseudo classes
 * @param {int} d Number of element names and pseudo elements
 */
function Specificity(a, b, c, d) {
    this.a = a;
    this.b = b;
    this.c = c;
    this.d = d;
}

Specificity.prototype = {
    constructor: Specificity,

    /**
     * Compare this specificity to another.
     * @param {Specificity} other The other specificity to compare to.
     * @return {int} -1 if the other specificity is larger, 1 if smaller, 0 if equal.
     * @method compare
     */
    compare: function(other) {
        var comps = ["a", "b", "c", "d"],
            i, len;

        for (i=0, len=comps.length; i < len; i++) {
            if (this[comps[i]] < other[comps[i]]) {
                return -1;
            } else if (this[comps[i]] > other[comps[i]]) {
                return 1;
            }
        }

        return 0;
    },

    /**
     * Creates a numeric value for the specificity.
     * @return {int} The numeric value for the specificity.
     * @method valueOf
     */
    valueOf: function() {
        return (this.a * 1000) + (this.b * 100) + (this.c * 10) + this.d;
    },

    /**
     * Returns a string representation for specificity.
     * @return {String} The string representation of specificity.
     * @method toString
     */
    toString: function() {
        return this.a + "," + this.b + "," + this.c + "," + this.d;
    }
};

/**
 * Calculates the specificity of the given selector.
 * @param {parserlib.css.Selector} The selector to calculate specificity for.
 * @return {parserlib.css.Specificity} The specificity of the selector.
 * @static
 * @method calculate
 */
Specificity.calculate = function(selector) {

    var i, len,
        part,
        b=0, c=0, d=0;

    function updateValues(part) {

        var i, j, len, num,
            elementName = part.elementName ? part.elementName.text : "",
            modifier;

        if (elementName && elementName.charAt(elementName.length-1) !== "*") {
            d++;
        }

        for (i=0, len=part.modifiers.length; i < len; i++) {
            modifier = part.modifiers[i];
            switch (modifier.type) {
                case "class":
                case "attribute":
                    c++;
                    break;

                case "id":
                    b++;
                    break;

                case "pseudo":
                    if (Pseudos.isElement(modifier.text)) {
                        d++;
                    } else {
                        c++;
                    }
                    break;

                case "not":
                    for (j=0, num=modifier.args.length; j < num; j++) {
                        updateValues(modifier.args[j]);
                    }
            }
        }
    }

    for (i=0, len=selector.parts.length; i < len; i++) {
        part = selector.parts[i];

        if (part instanceof SelectorPart) {
            updateValues(part);
        }
    }

    return new Specificity(0, b, c, d);
};
},{"./Pseudos":12,"./SelectorPart":14}],17:[function(require,module,exports){
"use strict";

module.exports = TokenStream;

var TokenStreamBase = require("../util/TokenStreamBase");

var PropertyValuePart = require("./PropertyValuePart");
var Tokens = require("./Tokens");

var h = /^[0-9a-fA-F]$/,
    nonascii = /^[\u00A0-\uFFFF]$/,
    nl = /\n|\r\n|\r|\f/,
    whitespace = /\u0009|\u000a|\u000c|\u000d|\u0020/;

//-----------------------------------------------------------------------------
// Helper functions
//-----------------------------------------------------------------------------

function isHexDigit(c) {
    return c !== null && h.test(c);
}

function isDigit(c) {
    return c !== null && /\d/.test(c);
}

function isWhitespace(c) {
    return c !== null && whitespace.test(c);
}

function isNewLine(c) {
    return c !== null && nl.test(c);
}

function isNameStart(c) {
    return c !== null && /[a-z_\u00A0-\uFFFF\\]/i.test(c);
}

function isNameChar(c) {
    return c !== null && (isNameStart(c) || /[0-9\-\\]/.test(c));
}

function isIdentStart(c) {
    return c !== null && (isNameStart(c) || /\-\\/.test(c));
}

function mix(receiver, supplier) {
    for (var prop in supplier) {
        if (Object.prototype.hasOwnProperty.call(supplier, prop)) {
            receiver[prop] = supplier[prop];
        }
    }
    return receiver;
}

//-----------------------------------------------------------------------------
// CSS Token Stream
//-----------------------------------------------------------------------------

/**
 * A token stream that produces CSS tokens.
 * @param {String|Reader} input The source of text to tokenize.
 * @constructor
 * @class TokenStream
 * @namespace parserlib.css
 */
function TokenStream(input) {
    TokenStreamBase.call(this, input, Tokens);
}

TokenStream.prototype = mix(new TokenStreamBase(), {

    /**
     * Overrides the TokenStreamBase method of the same name
     * to produce CSS tokens.
     * @return {Object} A token object representing the next token.
     * @method _getToken
     * @private
     */
    _getToken: function() {

        var c,
            reader = this._reader,
            token   = null,
            startLine   = reader.getLine(),
            startCol    = reader.getCol();

        c = reader.read();

        while (c) {
            switch (c) {

                /*
                 * Potential tokens:
                 * - COMMENT
                 * - SLASH
                 * - CHAR
                 */
                case "/":

                    if (reader.peek() === "*") {
                        token = this.commentToken(c, startLine, startCol);
                    } else {
                        token = this.charToken(c, startLine, startCol);
                    }
                    break;

                /*
                 * Potential tokens:
                 * - DASHMATCH
                 * - INCLUDES
                 * - PREFIXMATCH
                 * - SUFFIXMATCH
                 * - SUBSTRINGMATCH
                 * - CHAR
                 */
                case "|":
                case "~":
                case "^":
                case "$":
                case "*":
                    if (reader.peek() === "=") {
                        token = this.comparisonToken(c, startLine, startCol);
                    } else {
                        token = this.charToken(c, startLine, startCol);
                    }
                    break;

                /*
                 * Potential tokens:
                 * - STRING
                 * - INVALID
                 */
                case "\"":
                case "'":
                    token = this.stringToken(c, startLine, startCol);
                    break;

                /*
                 * Potential tokens:
                 * - HASH
                 * - CHAR
                 */
                case "#":
                    if (isNameChar(reader.peek())) {
                        token = this.hashToken(c, startLine, startCol);
                    } else {
                        token = this.charToken(c, startLine, startCol);
                    }
                    break;

                /*
                 * Potential tokens:
                 * - DOT
                 * - NUMBER
                 * - DIMENSION
                 * - PERCENTAGE
                 */
                case ".":
                    if (isDigit(reader.peek())) {
                        token = this.numberToken(c, startLine, startCol);
                    } else {
                        token = this.charToken(c, startLine, startCol);
                    }
                    break;

                /*
                 * Potential tokens:
                 * - CDC
                 * - MINUS
                 * - NUMBER
                 * - DIMENSION
                 * - PERCENTAGE
                 */
                case "-":
                    if (reader.peek() === "-") {  //could be closing HTML-style comment
                        token = this.htmlCommentEndToken(c, startLine, startCol);
                    } else if (isNameStart(reader.peek())) {
                        token = this.identOrFunctionToken(c, startLine, startCol);
                    } else {
                        token = this.charToken(c, startLine, startCol);
                    }
                    break;

                /*
                 * Potential tokens:
                 * - IMPORTANT_SYM
                 * - CHAR
                 */
                case "!":
                    token = this.importantToken(c, startLine, startCol);
                    break;

                /*
                 * Any at-keyword or CHAR
                 */
                case "@":
                    token = this.atRuleToken(c, startLine, startCol);
                    break;

                /*
                 * Potential tokens:
                 * - NOT
                 * - CHAR
                 */
                case ":":
                    token = this.notToken(c, startLine, startCol);
                    break;

                /*
                 * Potential tokens:
                 * - CDO
                 * - CHAR
                 */
                case "<":
                    token = this.htmlCommentStartToken(c, startLine, startCol);
                    break;

                /*
                 * Potential tokens:
                 * - IDENT
                 * - CHAR
                 */
                case "\\":
                    if (/[^\r\n\f]/.test(reader.peek())) {
                        token = this.identOrFunctionToken(this.readEscape(c, true), startLine, startCol);
                    } else {
                        token = this.charToken(c, startLine, startCol);
                    }
                    break;

                /*
                 * Potential tokens:
                 * - UNICODE_RANGE
                 * - URL
                 * - CHAR
                 */
                case "U":
                case "u":
                    if (reader.peek() === "+") {
                        token = this.unicodeRangeToken(c, startLine, startCol);
                        break;
                    }
                    /* falls through */
                default:

                    /*
                     * Potential tokens:
                     * - NUMBER
                     * - DIMENSION
                     * - LENGTH
                     * - FREQ
                     * - TIME
                     * - EMS
                     * - EXS
                     * - ANGLE
                     */
                    if (isDigit(c)) {
                        token = this.numberToken(c, startLine, startCol);
                    } else

                    /*
                     * Potential tokens:
                     * - S
                     */
                    if (isWhitespace(c)) {
                        token = this.whitespaceToken(c, startLine, startCol);
                    } else

                    /*
                     * Potential tokens:
                     * - IDENT
                     */
                    if (isIdentStart(c)) {
                        token = this.identOrFunctionToken(c, startLine, startCol);
                    } else {
                       /*
                        * Potential tokens:
                        * - CHAR
                        * - PLUS
                        */
                        token = this.charToken(c, startLine, startCol);
                    }
            }

            //make sure this token is wanted
            //TODO: check channel
            break;
        }

        if (!token && c === null) {
            token = this.createToken(Tokens.EOF, null, startLine, startCol);
        }

        return token;
    },

    //-------------------------------------------------------------------------
    // Methods to create tokens
    //-------------------------------------------------------------------------

    /**
     * Produces a token based on available data and the current
     * reader position information. This method is called by other
     * private methods to create tokens and is never called directly.
     * @param {int} tt The token type.
     * @param {String} value The text value of the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @param {Object} options (Optional) Specifies a channel property
     *      to indicate that a different channel should be scanned
     *      and/or a hide property indicating that the token should
     *      be hidden.
     * @return {Object} A token object.
     * @method createToken
     */
    createToken: function(tt, value, startLine, startCol, options) {
        var reader = this._reader;
        options = options || {};

        return {
            value:      value,
            type:       tt,
            channel:    options.channel,
            endChar:    options.endChar,
            hide:       options.hide || false,
            startLine:  startLine,
            startCol:   startCol,
            endLine:    reader.getLine(),
            endCol:     reader.getCol()
        };
    },

    //-------------------------------------------------------------------------
    // Methods to create specific tokens
    //-------------------------------------------------------------------------

    /**
     * Produces a token for any at-rule. If the at-rule is unknown, then
     * the token is for a single "@" character.
     * @param {String} first The first character for the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method atRuleToken
     */
    atRuleToken: function(first, startLine, startCol) {
        var rule    = first,
            reader  = this._reader,
            tt      = Tokens.CHAR,
            ident;

        /*
         * First, mark where we are. There are only four @ rules,
         * so anything else is really just an invalid token.
         * Basically, if this doesn't match one of the known @
         * rules, just return '@' as an unknown token and allow
         * parsing to continue after that point.
         */
        reader.mark();

        //try to find the at-keyword
        ident = this.readName();
        rule = first + ident;
        tt = Tokens.type(rule.toLowerCase());

        //if it's not valid, use the first character only and reset the reader
        if (tt === Tokens.CHAR || tt === Tokens.UNKNOWN) {
            if (rule.length > 1) {
                tt = Tokens.UNKNOWN_SYM;
            } else {
                tt = Tokens.CHAR;
                rule = first;
                reader.reset();
            }
        }

        return this.createToken(tt, rule, startLine, startCol);
    },

    /**
     * Produces a character token based on the given character
     * and location in the stream. If there's a special (non-standard)
     * token name, this is used; otherwise CHAR is used.
     * @param {String} c The character for the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method charToken
     */
    charToken: function(c, startLine, startCol) {
        var tt = Tokens.type(c);
        var opts = {};

        if (tt === -1) {
            tt = Tokens.CHAR;
        } else {
            opts.endChar = Tokens[tt].endChar;
        }

        return this.createToken(tt, c, startLine, startCol, opts);
    },

    /**
     * Produces a character token based on the given character
     * and location in the stream. If there's a special (non-standard)
     * token name, this is used; otherwise CHAR is used.
     * @param {String} first The first character for the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method commentToken
     */
    commentToken: function(first, startLine, startCol) {
        var comment = this.readComment(first);

        return this.createToken(Tokens.COMMENT, comment, startLine, startCol);
    },

    /**
     * Produces a comparison token based on the given character
     * and location in the stream. The next character must be
     * read and is already known to be an equals sign.
     * @param {String} c The character for the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method comparisonToken
     */
    comparisonToken: function(c, startLine, startCol) {
        var reader  = this._reader,
            comparison  = c + reader.read(),
            tt      = Tokens.type(comparison) || Tokens.CHAR;

        return this.createToken(tt, comparison, startLine, startCol);
    },

    /**
     * Produces a hash token based on the specified information. The
     * first character provided is the pound sign (#) and then this
     * method reads a name afterward.
     * @param {String} first The first character (#) in the hash name.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method hashToken
     */
    hashToken: function(first, startLine, startCol) {
        var name    = this.readName(first);

        return this.createToken(Tokens.HASH, name, startLine, startCol);
    },

    /**
     * Produces a CDO or CHAR token based on the specified information. The
     * first character is provided and the rest is read by the function to determine
     * the correct token to create.
     * @param {String} first The first character in the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method htmlCommentStartToken
     */
    htmlCommentStartToken: function(first, startLine, startCol) {
        var reader      = this._reader,
            text        = first;

        reader.mark();
        text += reader.readCount(3);

        if (text === "<!--") {
            return this.createToken(Tokens.CDO, text, startLine, startCol);
        } else {
            reader.reset();
            return this.charToken(first, startLine, startCol);
        }
    },

    /**
     * Produces a CDC or CHAR token based on the specified information. The
     * first character is provided and the rest is read by the function to determine
     * the correct token to create.
     * @param {String} first The first character in the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method htmlCommentEndToken
     */
    htmlCommentEndToken: function(first, startLine, startCol) {
        var reader      = this._reader,
            text        = first;

        reader.mark();
        text += reader.readCount(2);

        if (text === "-->") {
            return this.createToken(Tokens.CDC, text, startLine, startCol);
        } else {
            reader.reset();
            return this.charToken(first, startLine, startCol);
        }
    },

    /**
     * Produces an IDENT or FUNCTION token based on the specified information. The
     * first character is provided and the rest is read by the function to determine
     * the correct token to create.
     * @param {String} first The first character in the identifier.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method identOrFunctionToken
     */
    identOrFunctionToken: function(first, startLine, startCol) {
        var reader  = this._reader,
            ident   = this.readName(first),
            tt      = Tokens.IDENT,
            uriFns  = ["url(", "url-prefix(", "domain("],
            uri;

        //if there's a left paren immediately after, it's a URI or function
        if (reader.peek() === "(") {
            ident += reader.read();
            if (uriFns.indexOf(ident.toLowerCase()) > -1) {
                reader.mark();
                uri = this.readURI(ident);
                if (uri === null) {
                    //didn't find a valid URL or there's no closing paren
                    reader.reset();
                    tt = Tokens.FUNCTION;
                } else {
                    tt = Tokens.URI;
                    ident = uri;
                }
            } else {
                tt = Tokens.FUNCTION;
            }
        } else if (reader.peek() === ":") {  //might be an IE function

            //IE-specific functions always being with progid:
            if (ident.toLowerCase() === "progid") {
                ident += reader.readTo("(");
                tt = Tokens.IE_FUNCTION;
            }
        }

        return this.createToken(tt, ident, startLine, startCol);
    },

    /**
     * Produces an IMPORTANT_SYM or CHAR token based on the specified information. The
     * first character is provided and the rest is read by the function to determine
     * the correct token to create.
     * @param {String} first The first character in the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method importantToken
     */
    importantToken: function(first, startLine, startCol) {
        var reader      = this._reader,
            important   = first,
            tt          = Tokens.CHAR,
            temp,
            c;

        reader.mark();
        c = reader.read();

        while (c) {

            //there can be a comment in here
            if (c === "/") {

                //if the next character isn't a star, then this isn't a valid !important token
                if (reader.peek() !== "*") {
                    break;
                } else {
                    temp = this.readComment(c);
                    if (temp === "") {    //broken!
                        break;
                    }
                }
            } else if (isWhitespace(c)) {
                important += c + this.readWhitespace();
            } else if (/i/i.test(c)) {
                temp = reader.readCount(8);
                if (/mportant/i.test(temp)) {
                    important += c + temp;
                    tt = Tokens.IMPORTANT_SYM;
                }
                break;  //we're done
            } else {
                break;
            }

            c = reader.read();
        }

        if (tt === Tokens.CHAR) {
            reader.reset();
            return this.charToken(first, startLine, startCol);
        } else {
            return this.createToken(tt, important, startLine, startCol);
        }
    },

    /**
     * Produces a NOT or CHAR token based on the specified information. The
     * first character is provided and the rest is read by the function to determine
     * the correct token to create.
     * @param {String} first The first character in the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method notToken
     */
    notToken: function(first, startLine, startCol) {
        var reader      = this._reader,
            text        = first;

        reader.mark();
        text += reader.readCount(4);

        if (text.toLowerCase() === ":not(") {
            return this.createToken(Tokens.NOT, text, startLine, startCol);
        } else {
            reader.reset();
            return this.charToken(first, startLine, startCol);
        }
    },

    /**
     * Produces a number token based on the given character
     * and location in the stream. This may return a token of
     * NUMBER, EMS, EXS, LENGTH, ANGLE, TIME, FREQ, DIMENSION,
     * or PERCENTAGE.
     * @param {String} first The first character for the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method numberToken
     */
    numberToken: function(first, startLine, startCol) {
        var reader  = this._reader,
            value   = this.readNumber(first),
            ident,
            tt      = Tokens.NUMBER,
            c       = reader.peek();

        if (isIdentStart(c)) {
            ident = this.readName(reader.read());
            value += ident;

            if (/^em$|^ex$|^px$|^gd$|^rem$|^vw$|^vh$|^vmax$|^vmin$|^ch$|^cm$|^mm$|^in$|^pt$|^pc$/i.test(ident)) {
                tt = Tokens.LENGTH;
            } else if (/^deg|^rad$|^grad$|^turn$/i.test(ident)) {
                tt = Tokens.ANGLE;
            } else if (/^ms$|^s$/i.test(ident)) {
                tt = Tokens.TIME;
            } else if (/^hz$|^khz$/i.test(ident)) {
                tt = Tokens.FREQ;
            } else if (/^dpi$|^dpcm$/i.test(ident)) {
                tt = Tokens.RESOLUTION;
            } else {
                tt = Tokens.DIMENSION;
            }
        } else if (c === "%") {
            value += reader.read();
            tt = Tokens.PERCENTAGE;
        }

        return this.createToken(tt, value, startLine, startCol);
    },

    /**
     * Produces a string token based on the given character
     * and location in the stream. Since strings may be indicated
     * by single or double quotes, a failure to match starting
     * and ending quotes results in an INVALID token being generated.
     * The first character in the string is passed in and then
     * the rest are read up to and including the final quotation mark.
     * @param {String} first The first character in the string.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method stringToken
     */
    stringToken: function(first, startLine, startCol) {
        var delim   = first,
            string  = first,
            reader  = this._reader,
            tt      = Tokens.STRING,
            c       = reader.read(),
            i;

        while (c) {
            string += c;

            if (c === "\\") {
                c = reader.read();
                if (c === null) {
                    break; // premature EOF after backslash
                } else if (/[^\r\n\f0-9a-f]/i.test(c)) {
                    // single-character escape
                    string += c;
                } else {
                    // read up to six hex digits
                    for (i=0; isHexDigit(c) && i<6; i++) {
                        string += c;
                        c = reader.read();
                    }
                    // swallow trailing newline or space
                    if (c === "\r" && reader.peek() === "\n") {
                        string += c;
                        c = reader.read();
                    }
                    if (isWhitespace(c)) {
                        string += c;
                    } else {
                        // This character is null or not part of the escape;
                        // jump back to the top to process it.
                        continue;
                    }
                }
            } else if (c === delim) {
                break; // delimiter found.
            } else if (isNewLine(reader.peek())) {
                // newline without an escapement: it's an invalid string
                tt = Tokens.INVALID;
                break;
            }
            c = reader.read();
        }

        //if c is null, that means we're out of input and the string was never closed
        if (c === null) {
            tt = Tokens.INVALID;
        }

        return this.createToken(tt, string, startLine, startCol);
    },

    unicodeRangeToken: function(first, startLine, startCol) {
        var reader  = this._reader,
            value   = first,
            temp,
            tt      = Tokens.CHAR;

        //then it should be a unicode range
        if (reader.peek() === "+") {
            reader.mark();
            value += reader.read();
            value += this.readUnicodeRangePart(true);

            //ensure there's an actual unicode range here
            if (value.length === 2) {
                reader.reset();
            } else {

                tt = Tokens.UNICODE_RANGE;

                //if there's a ? in the first part, there can't be a second part
                if (value.indexOf("?") === -1) {

                    if (reader.peek() === "-") {
                        reader.mark();
                        temp = reader.read();
                        temp += this.readUnicodeRangePart(false);

                        //if there's not another value, back up and just take the first
                        if (temp.length === 1) {
                            reader.reset();
                        } else {
                            value += temp;
                        }
                    }
                }
            }
        }

        return this.createToken(tt, value, startLine, startCol);
    },

    /**
     * Produces a S token based on the specified information. Since whitespace
     * may have multiple characters, this consumes all whitespace characters
     * into a single token.
     * @param {String} first The first character in the token.
     * @param {int} startLine The beginning line for the character.
     * @param {int} startCol The beginning column for the character.
     * @return {Object} A token object.
     * @method whitespaceToken
     */
    whitespaceToken: function(first, startLine, startCol) {
        var value   = first + this.readWhitespace();
        return this.createToken(Tokens.S, value, startLine, startCol);
    },

    //-------------------------------------------------------------------------
    // Methods to read values from the string stream
    //-------------------------------------------------------------------------

    readUnicodeRangePart: function(allowQuestionMark) {
        var reader  = this._reader,
            part = "",
            c       = reader.peek();

        //first read hex digits
        while (isHexDigit(c) && part.length < 6) {
            reader.read();
            part += c;
            c = reader.peek();
        }

        //then read question marks if allowed
        if (allowQuestionMark) {
            while (c === "?" && part.length < 6) {
                reader.read();
                part += c;
                c = reader.peek();
            }
        }

        //there can't be any other characters after this point

        return part;
    },

    readWhitespace: function() {
        var reader  = this._reader,
            whitespace = "",
            c       = reader.peek();

        while (isWhitespace(c)) {
            reader.read();
            whitespace += c;
            c = reader.peek();
        }

        return whitespace;
    },
    readNumber: function(first) {
        var reader  = this._reader,
            number  = first,
            hasDot  = (first === "."),
            c       = reader.peek();

        while (c) {
            if (isDigit(c)) {
                number += reader.read();
            } else if (c === ".") {
                if (hasDot) {
                    break;
                } else {
                    hasDot = true;
                    number += reader.read();
                }
            } else {
                break;
            }

            c = reader.peek();
        }

        return number;
    },

    // returns null w/o resetting reader if string is invalid.
    readString: function() {
        var token = this.stringToken(this._reader.read(), 0, 0);
        return token.type === Tokens.INVALID ? null : token.value;
    },

    // returns null w/o resetting reader if URI is invalid.
    readURI: function(first) {
        var reader  = this._reader,
            uri     = first,
            inner   = "",
            c       = reader.peek();

        //skip whitespace before
        while (c && isWhitespace(c)) {
            reader.read();
            c = reader.peek();
        }

        //it's a string
        if (c === "'" || c === "\"") {
            inner = this.readString();
            if (inner !== null) {
                inner = PropertyValuePart.parseString(inner);
            }
        } else {
            inner = this.readUnquotedURL();
        }

        c = reader.peek();

        //skip whitespace after
        while (c && isWhitespace(c)) {
            reader.read();
            c = reader.peek();
        }

        //if there was no inner value or the next character isn't closing paren, it's not a URI
        if (inner === null || c !== ")") {
            uri = null;
        } else {
            // Ensure argument to URL is always double-quoted
            // (This simplifies later processing in PropertyValuePart.)
            uri += PropertyValuePart.serializeString(inner) + reader.read();
        }

        return uri;
    },
    // This method never fails, although it may return an empty string.
    readUnquotedURL: function(first) {
        var reader  = this._reader,
            url     = first || "",
            c;

        for (c = reader.peek(); c; c = reader.peek()) {
            // Note that the grammar at
            // https://www.w3.org/TR/CSS2/grammar.html#scanner
            // incorrectly includes the backslash character in the
            // `url` production, although it is correctly omitted in
            // the `baduri1` production.
            if (nonascii.test(c) || /^[\-!#$%&*-\[\]-~]$/.test(c)) {
                url += c;
                reader.read();
            } else if (c === "\\") {
                if (/^[^\r\n\f]$/.test(reader.peek(2))) {
                    url += this.readEscape(reader.read(), true);
                } else {
                    break; // bad escape sequence.
                }
            } else {
                break; // bad character
            }
        }

        return url;
    },

    readName: function(first) {
        var reader  = this._reader,
            ident   = first || "",
            c;

        for (c = reader.peek(); c; c = reader.peek()) {
            if (c === "\\") {
                if (/^[^\r\n\f]$/.test(reader.peek(2))) {
                    ident += this.readEscape(reader.read(), true);
                } else {
                    // Bad escape sequence.
                    break;
                }
            } else if (isNameChar(c)) {
                ident += reader.read();
            } else {
                break;
            }
        }

        return ident;
    },

    readEscape: function(first, unescape) {
        var reader  = this._reader,
            cssEscape = first || "",
            i       = 0,
            c       = reader.peek();

        if (isHexDigit(c)) {
            do {
                cssEscape += reader.read();
                c = reader.peek();
            } while (c && isHexDigit(c) && ++i < 6);
        }

        if (cssEscape.length === 1) {
            if (/^[^\r\n\f0-9a-f]$/.test(c)) {
                reader.read();
                if (unescape) {
                    return c;
                }
            } else {
                // We should never get here (readName won't call readEscape
                // if the escape sequence is bad).
                throw new Error("Bad escape sequence.");
            }
        } else if (c === "\r") {
            reader.read();
            if (reader.peek() === "\n") {
                c += reader.read();
            }
        } else if (/^[ \t\n\f]$/.test(c)) {
            reader.read();
        } else {
            c = "";
        }

        if (unescape) {
            var cp = parseInt(cssEscape.slice(first.length), 16);
            return String.fromCodePoint ? String.fromCodePoint(cp) :
                String.fromCharCode(cp);
        }
        return cssEscape + c;
    },

    readComment: function(first) {
        var reader  = this._reader,
            comment = first || "",
            c       = reader.read();

        if (c === "*") {
            while (c) {
                comment += c;

                //look for end of comment
                if (comment.length > 2 && c === "*" && reader.peek() === "/") {
                    comment += reader.read();
                    break;
                }

                c = reader.read();
            }

            return comment;
        } else {
            return "";
        }
    }
});
},{"../util/TokenStreamBase":27,"./PropertyValuePart":11,"./Tokens":18}],18:[function(require,module,exports){
"use strict";

var Tokens = module.exports = [

    /*
     * The following token names are defined in CSS3 Grammar: https://www.w3.org/TR/css3-syntax/#lexical
     */

    // HTML-style comments
    { name: "CDO" },
    { name: "CDC" },

    // ignorables
    { name: "S", whitespace: true/*, channel: "ws"*/ },
    { name: "COMMENT", comment: true, hide: true, channel: "comment" },

    // attribute equality
    { name: "INCLUDES", text: "~=" },
    { name: "DASHMATCH", text: "|=" },
    { name: "PREFIXMATCH", text: "^=" },
    { name: "SUFFIXMATCH", text: "$=" },
    { name: "SUBSTRINGMATCH", text: "*=" },

    // identifier types
    { name: "STRING" },
    { name: "IDENT" },
    { name: "HASH" },

    // at-keywords
    { name: "IMPORT_SYM", text: "@import" },
    { name: "PAGE_SYM", text: "@page" },
    { name: "MEDIA_SYM", text: "@media" },
    { name: "FONT_FACE_SYM", text: "@font-face" },
    { name: "CHARSET_SYM", text: "@charset" },
    { name: "NAMESPACE_SYM", text: "@namespace" },
    { name: "SUPPORTS_SYM", text: "@supports" },
    { name: "VIEWPORT_SYM", text: ["@viewport", "@-ms-viewport", "@-o-viewport"] },
    { name: "DOCUMENT_SYM", text: ["@document", "@-moz-document"] },
    { name: "UNKNOWN_SYM" },
    //{ name: "ATKEYWORD"},

    // CSS3 animations
    { name: "KEYFRAMES_SYM", text: [ "@keyframes", "@-webkit-keyframes", "@-moz-keyframes", "@-o-keyframes" ] },

    // important symbol
    { name: "IMPORTANT_SYM" },

    // measurements
    { name: "LENGTH" },
    { name: "ANGLE" },
    { name: "TIME" },
    { name: "FREQ" },
    { name: "DIMENSION" },
    { name: "PERCENTAGE" },
    { name: "NUMBER" },

    // functions
    { name: "URI" },
    { name: "FUNCTION" },

    // Unicode ranges
    { name: "UNICODE_RANGE" },

    /*
     * The following token names are defined in CSS3 Selectors: https://www.w3.org/TR/css3-selectors/#selector-syntax
     */

    // invalid string
    { name: "INVALID" },

    // combinators
    { name: "PLUS", text: "+" },
    { name: "GREATER", text: ">" },
    { name: "COMMA", text: "," },
    { name: "TILDE", text: "~" },

    // modifier
    { name: "NOT" },

    /*
     * Defined in CSS3 Paged Media
     */
    { name: "TOPLEFTCORNER_SYM", text: "@top-left-corner" },
    { name: "TOPLEFT_SYM", text: "@top-left" },
    { name: "TOPCENTER_SYM", text: "@top-center" },
    { name: "TOPRIGHT_SYM", text: "@top-right" },
    { name: "TOPRIGHTCORNER_SYM", text: "@top-right-corner" },
    { name: "BOTTOMLEFTCORNER_SYM", text: "@bottom-left-corner" },
    { name: "BOTTOMLEFT_SYM", text: "@bottom-left" },
    { name: "BOTTOMCENTER_SYM", text: "@bottom-center" },
    { name: "BOTTOMRIGHT_SYM", text: "@bottom-right" },
    { name: "BOTTOMRIGHTCORNER_SYM", text: "@bottom-right-corner" },
    { name: "LEFTTOP_SYM", text: "@left-top" },
    { name: "LEFTMIDDLE_SYM", text: "@left-middle" },
    { name: "LEFTBOTTOM_SYM", text: "@left-bottom" },
    { name: "RIGHTTOP_SYM", text: "@right-top" },
    { name: "RIGHTMIDDLE_SYM", text: "@right-middle" },
    { name: "RIGHTBOTTOM_SYM", text: "@right-bottom" },

    /*
     * The following token names are defined in CSS3 Media Queries: https://www.w3.org/TR/css3-mediaqueries/#syntax
     */
    /*{ name: "MEDIA_ONLY", state: "media"},
    { name: "MEDIA_NOT", state: "media"},
    { name: "MEDIA_AND", state: "media"},*/
    { name: "RESOLUTION", state: "media" },

    /*
     * The following token names are not defined in any CSS specification but are used by the lexer.
     */

    // not a real token, but useful for stupid IE filters
    { name: "IE_FUNCTION" },

    // part of CSS3 grammar but not the Flex code
    { name: "CHAR" },

    // TODO: Needed?
    // Not defined as tokens, but might as well be
    {
        name: "PIPE",
        text: "|"
    },
    {
        name: "SLASH",
        text: "/"
    },
    {
        name: "MINUS",
        text: "-"
    },
    {
        name: "STAR",
        text: "*"
    },

    {
        name: "LBRACE",
        endChar: "}",
        text: "{"
    },
    {
        name: "RBRACE",
        text: "}"
    },
    {
        name: "LBRACKET",
        endChar: "]",
        text: "["
    },
    {
        name: "RBRACKET",
        text: "]"
    },
    {
        name: "EQUALS",
        text: "="
    },
    {
        name: "COLON",
        text: ":"
    },
    {
        name: "SEMICOLON",
        text: ";"
    },
    {
        name: "LPAREN",
        endChar: ")",
        text: "("
    },
    {
        name: "RPAREN",
        text: ")"
    },
    {
        name: "DOT",
        text: "."
    }
];

(function() {
    var nameMap = [],
        typeMap = Object.create(null);

    Tokens.UNKNOWN = -1;
    Tokens.unshift({ name:"EOF" });
    for (var i=0, len = Tokens.length; i < len; i++) {
        nameMap.push(Tokens[i].name);
        Tokens[Tokens[i].name] = i;
        if (Tokens[i].text) {
            if (Tokens[i].text instanceof Array) {
                for (var j=0; j < Tokens[i].text.length; j++) {
                    typeMap[Tokens[i].text[j]] = i;
                }
            } else {
                typeMap[Tokens[i].text] = i;
            }
        }
    }

    Tokens.name = function(tt) {
        return nameMap[tt];
    };

    Tokens.type = function(c) {
        return typeMap[c] || -1;
    };
})();
},{}],19:[function(require,module,exports){
"use strict";

/* exported Validation */

var Matcher = require("./Matcher");
var Properties = require("./Properties");
var ValidationTypes = require("./ValidationTypes");
var ValidationError = require("./ValidationError");
var PropertyValueIterator = require("./PropertyValueIterator");

var Validation = module.exports = {

    validate: function(property, value) {

        //normalize name
        var name        = property.toString().toLowerCase(),
            expression  = new PropertyValueIterator(value),
            spec        = Properties[name],
            part;

        if (!spec) {
            if (name.indexOf("-") !== 0) {    //vendor prefixed are ok
                throw new ValidationError("Unknown property '" + property + "'.", property.line, property.col);
            }
        } else if (typeof spec !== "number") {

            // All properties accept some CSS-wide values.
            // https://drafts.csswg.org/css-values-3/#common-keywords
            if (ValidationTypes.isAny(expression, "inherit | initial | unset")) {
                if (expression.hasNext()) {
                    part = expression.next();
                    throw new ValidationError("Expected end of value but found '" + part + "'.", part.line, part.col);
                }
                return;
            }

            // Property-specific validation.
            this.singleProperty(spec, expression);
        }
    },

    singleProperty: function(types, expression) {

        var result      = false,
            value       = expression.value,
            part;

        result = Matcher.parse(types).match(expression);

        if (!result) {
            if (expression.hasNext() && !expression.isFirst()) {
                part = expression.peek();
                throw new ValidationError("Expected end of value but found '" + part + "'.", part.line, part.col);
            } else {
                throw new ValidationError("Expected (" + ValidationTypes.describe(types) + ") but found '" + value + "'.", value.line, value.col);
            }
        } else if (expression.hasNext()) {
            part = expression.next();
            throw new ValidationError("Expected end of value but found '" + part + "'.", part.line, part.col);
        }
    }
};
},{"./Matcher":3,"./Properties":7,"./PropertyValueIterator":10,"./ValidationError":20,"./ValidationTypes":21}],20:[function(require,module,exports){
"use strict";

module.exports = ValidationError;

/**
 * Type to use when a validation error occurs.
 * @class ValidationError
 * @namespace parserlib.util
 * @constructor
 * @param {String} message The error message.
 * @param {int} line The line at which the error occurred.
 * @param {int} col The column at which the error occurred.
 */
function ValidationError(message, line, col) {

    /**
     * The column at which the error occurred.
     * @type int
     * @property col
     */
    this.col = col;

    /**
     * The line at which the error occurred.
     * @type int
     * @property line
     */
    this.line = line;

    /**
     * The text representation of the unit.
     * @type String
     * @property text
     */
    this.message = message;
}

//inherit from Error
ValidationError.prototype = new Error();
},{}],21:[function(require,module,exports){
"use strict";

var ValidationTypes = module.exports;

var Matcher = require("./Matcher");

function copy(to, from) {
    Object.keys(from).forEach(function(prop) {
        to[prop] = from[prop];
    });
}
copy(ValidationTypes, {

    isLiteral: function (part, literals) {
        var text = part.text.toString().toLowerCase(),
            args = literals.split(" | "),
            i, len, found = false;

        for (i=0, len=args.length; i < len && !found; i++) {
            if (args[i].charAt(0) === "<") {
                found = this.simple[args[i]](part);
            } else if (args[i].slice(-2) === "()") {
                found = (part.type === "function" &&
                         part.name === args[i].slice(0, -2));
            } else if (text === args[i].toLowerCase()) {
                found = true;
            }
        }

        return found;
    },

    isSimple: function(type) {
        return Boolean(this.simple[type]);
    },

    isComplex: function(type) {
        return Boolean(this.complex[type]);
    },

    describe: function(type) {
        if (this.complex[type] instanceof Matcher) {
            return this.complex[type].toString(0);
        }
        return type;
    },

    /**
     * Determines if the next part(s) of the given expression
     * are any of the given types.
     */
    isAny: function (expression, types) {
        var args = types.split(" | "),
            i, len, found = false;

        for (i=0, len=args.length; i < len && !found && expression.hasNext(); i++) {
            found = this.isType(expression, args[i]);
        }

        return found;
    },

    /**
     * Determines if the next part(s) of the given expression
     * are one of a group.
     */
    isAnyOfGroup: function(expression, types) {
        var args = types.split(" || "),
            i, len, found = false;

        for (i=0, len=args.length; i < len && !found; i++) {
            found = this.isType(expression, args[i]);
        }

        return found ? args[i-1] : false;
    },

    /**
     * Determines if the next part(s) of the given expression
     * are of a given type.
     */
    isType: function (expression, type) {
        var part = expression.peek(),
            result = false;

        if (type.charAt(0) !== "<") {
            result = this.isLiteral(part, type);
            if (result) {
                expression.next();
            }
        } else if (this.simple[type]) {
            result = this.simple[type](part);
            if (result) {
                expression.next();
            }
        } else if (this.complex[type] instanceof Matcher) {
            result = this.complex[type].match(expression);
        } else {
            result = this.complex[type](expression);
        }

        return result;
    },

    simple: {
        __proto__: null,

        "<absolute-size>":
            "xx-small | x-small | small | medium | large | x-large | xx-large",

        "<animateable-feature>":
            "scroll-position | contents | <animateable-feature-name>",

        "<animateable-feature-name>": function(part) {
            return this["<ident>"](part) &&
                !/^(unset|initial|inherit|will-change|auto|scroll-position|contents)$/i.test(part);
        },

        "<angle>": function(part) {
            return part.type === "angle";
        },

        "<attachment>": "scroll | fixed | local",

        "<attr>": "attr()",

        // inset() = inset( <shape-arg>{1,4} [round <border-radius>]? )
        // circle() = circle( [<shape-radius>]? [at <position>]? )
        // ellipse() = ellipse( [<shape-radius>{2}]? [at <position>]? )
        // polygon() = polygon( [<fill-rule>,]? [<shape-arg> <shape-arg>]# )
        "<basic-shape>": "inset() | circle() | ellipse() | polygon()",

        "<bg-image>": "<image> | <gradient> | none",

        "<border-style>":
            "none | hidden | dotted | dashed | solid | double | groove | " +
            "ridge | inset | outset",

        "<border-width>": "<length> | thin | medium | thick",

        "<box>": "padding-box | border-box | content-box",

        "<clip-source>": "<uri>",

        "<color>": function(part) {
            return part.type === "color" || String(part) === "transparent" || String(part) === "currentColor";
        },

        // The SVG <color> spec doesn't include "currentColor" or "transparent" as a color.
        "<color-svg>": function(part) {
            return part.type === "color";
        },

        "<content>": "content()",

        // https://www.w3.org/TR/css3-sizing/#width-height-keywords
        "<content-sizing>":
            "fill-available | -moz-available | -webkit-fill-available | " +
            "max-content | -moz-max-content | -webkit-max-content | " +
            "min-content | -moz-min-content | -webkit-min-content | " +
            "fit-content | -moz-fit-content | -webkit-fit-content",

        "<feature-tag-value>": function(part) {
            return part.type === "function" && /^[A-Z0-9]{4}$/i.test(part);
        },

        // custom() isn't actually in the spec
        "<filter-function>":
            "blur() | brightness() | contrast() | custom() | " +
            "drop-shadow() | grayscale() | hue-rotate() | invert() | " +
            "opacity() | saturate() | sepia()",

        "<flex-basis>": "<width>",

        "<flex-direction>": "row | row-reverse | column | column-reverse",

        "<flex-grow>": "<number>",

        "<flex-shrink>": "<number>",

        "<flex-wrap>": "nowrap | wrap | wrap-reverse",

        "<font-size>":
            "<absolute-size> | <relative-size> | <length> | <percentage>",

        "<font-stretch>":
            "normal | ultra-condensed | extra-condensed | condensed | " +
            "semi-condensed | semi-expanded | expanded | extra-expanded | " +
            "ultra-expanded",

        "<font-style>": "normal | italic | oblique",

        "<font-variant-caps>":
            "small-caps | all-small-caps | petite-caps | all-petite-caps | " +
            "unicase | titling-caps",

        "<font-variant-css21>": "normal | small-caps",

        "<font-weight>":
            "normal | bold | bolder | lighter | " +
            "100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900",

        "<generic-family>":
            "serif | sans-serif | cursive | fantasy | monospace",

        "<geometry-box>": "<shape-box> | fill-box | stroke-box | view-box",

        "<glyph-angle>": function(part) {
            return part.type === "angle" && part.units === "deg";
        },

        "<gradient>": function(part) {
            return part.type === "function" && /^(?:\-(?:ms|moz|o|webkit)\-)?(?:repeating\-)?(?:radial\-|linear\-)?gradient/i.test(part);
        },

        "<icccolor>":
            "cielab() | cielch() | cielchab() | " +
            "icc-color() | icc-named-color()",

        //any identifier
        "<ident>": function(part) {
            return part.type === "identifier" || part.wasIdent;
        },

        "<ident-not-generic-family>": function(part) {
            return this["<ident>"](part) && !this["<generic-family>"](part);
        },

        "<image>": "<uri>",

        "<integer>": function(part) {
            return part.type === "integer";
        },

        "<length>": function(part) {
            if (part.type === "function" && /^(?:\-(?:ms|moz|o|webkit)\-)?calc/i.test(part)) {
                return true;
            } else {
                return part.type === "length" || part.type === "number" || part.type === "integer" || String(part) === "0";
            }
        },

        "<line>": function(part) {
            return part.type === "integer";
        },

        "<line-height>": "<number> | <length> | <percentage> | normal",

        "<margin-width>": "<length> | <percentage> | auto",

        "<miterlimit>": function(part) {
            return this["<number>"](part) && part.value >= 1;
        },

        "<nonnegative-length-or-percentage>": function(part) {
            return (this["<length>"](part) || this["<percentage>"](part)) &&
                (String(part) === "0" || part.type === "function" || (part.value) >= 0);
        },

        "<nonnegative-number-or-percentage>": function(part) {
            return (this["<number>"](part) || this["<percentage>"](part)) &&
                (String(part) === "0" || part.type === "function" || (part.value) >= 0);
        },

        "<number>": function(part) {
            return part.type === "number" || this["<integer>"](part);
        },

        "<opacity-value>": function(part) {
            return this["<number>"](part) && part.value >= 0 && part.value <= 1;
        },

        "<padding-width>": "<nonnegative-length-or-percentage>",

        "<percentage>": function(part) {
            return part.type === "percentage" || String(part) === "0";
        },

        "<relative-size>": "smaller | larger",

        "<shape>": "rect() | inset-rect()",

        "<shape-box>": "<box> | margin-box",

        "<single-animation-direction>":
            "normal | reverse | alternate | alternate-reverse",

        "<single-animation-name>": function(part) {
            return this["<ident>"](part) &&
                /^-?[a-z_][-a-z0-9_]+$/i.test(part) &&
                !/^(none|unset|initial|inherit)$/i.test(part);
        },

        "<string>": function(part) {
            return part.type === "string";
        },

        "<time>": function(part) {
            return part.type === "time";
        },

        "<uri>": function(part) {
            return part.type === "uri";
        },

        "<width>": "<margin-width>"
    },

    complex: {
        __proto__: null,

        "<azimuth>":
            "<angle>" +
            " | " +
            "[ [ left-side | far-left | left | center-left | center | " +
            "center-right | right | far-right | right-side ] || behind ]" +
            " | "+
            "leftwards | rightwards",

        "<bg-position>": "<position>#",

        "<bg-size>":
            "[ <length> | <percentage> | auto ]{1,2} | cover | contain",

        "<border-image-slice>":
        // [<number> | <percentage>]{1,4} && fill?
        // *but* fill can appear between any of the numbers
        Matcher.many([true /* first element is required */],
                     Matcher.cast("<nonnegative-number-or-percentage>"),
                     Matcher.cast("<nonnegative-number-or-percentage>"),
                     Matcher.cast("<nonnegative-number-or-percentage>"),
                     Matcher.cast("<nonnegative-number-or-percentage>"),
                     "fill"),

        "<border-radius>":
            "<nonnegative-length-or-percentage>{1,4} " +
            "[ / <nonnegative-length-or-percentage>{1,4} ]?",

        "<box-shadow>": "none | <shadow>#",

        "<clip-path>": "<basic-shape> || <geometry-box>",

        "<dasharray>":
        // "list of comma and/or white space separated <length>s and
        // <percentage>s".  There is a non-negative constraint.
        Matcher.cast("<nonnegative-length-or-percentage>")
            .braces(1, Infinity, "#", Matcher.cast(",").question()),

        "<family-name>":
            // <string> | <IDENT>+
            "<string> | <ident-not-generic-family> <ident>*",

        "<filter-function-list>": "[ <filter-function> | <uri> ]+",

        // https://www.w3.org/TR/2014/WD-css-flexbox-1-20140325/#flex-property
        "<flex>":
            "none | [ <flex-grow> <flex-shrink>? || <flex-basis> ]",

        "<font-family>": "[ <generic-family> | <family-name> ]#",

        "<font-shorthand>":
            "[ <font-style> || <font-variant-css21> || " +
            "<font-weight> || <font-stretch> ]? <font-size> " +
            "[ / <line-height> ]? <font-family>",

        "<font-variant-alternates>":
            // stylistic(<feature-value-name>)
            "stylistic() || " +
            "historical-forms || " +
            // styleset(<feature-value-name> #)
            "styleset() || " +
            // character-variant(<feature-value-name> #)
            "character-variant() || " +
            // swash(<feature-value-name>)
            "swash() || " +
            // ornaments(<feature-value-name>)
            "ornaments() || " +
            // annotation(<feature-value-name>)
            "annotation()",

        "<font-variant-ligatures>":
            // <common-lig-values>
            "[ common-ligatures | no-common-ligatures ] || " +
            // <discretionary-lig-values>
            "[ discretionary-ligatures | no-discretionary-ligatures ] || " +
            // <historical-lig-values>
            "[ historical-ligatures | no-historical-ligatures ] || " +
            // <contextual-alt-values>
            "[ contextual | no-contextual ]",

        "<font-variant-numeric>":
            // <numeric-figure-values>
            "[ lining-nums | oldstyle-nums ] || " +
            // <numeric-spacing-values>
            "[ proportional-nums | tabular-nums ] || " +
            // <numeric-fraction-values>
            "[ diagonal-fractions | stacked-fractions ] || " +
            "ordinal || slashed-zero",

        "<font-variant-east-asian>":
            // <east-asian-variant-values>
            "[ jis78 | jis83 | jis90 | jis04 | simplified | traditional ] || " +
            // <east-asian-width-values>
            "[ full-width | proportional-width ] || " +
            "ruby",

        // Note that <color> here is "as defined in the SVG spec", which
        // is more restrictive that the <color> defined in the CSS spec.
        // none | currentColor | <color> [<icccolor>]? |
        // <funciri> [ none | currentColor | <color> [<icccolor>]? ]?
        "<paint>": "<paint-basic> | <uri> <paint-basic>?",

        // Helper definition for <paint> above.
        "<paint-basic>": "none | currentColor | <color-svg> <icccolor>?",

        "<position>":
            // Because our `alt` combinator is ordered, we need to test these
            // in order from longest possible match to shortest.
            "[ center | [ left | right ] [ <percentage> | <length> ]? ] && " +
            "[ center | [ top | bottom ] [ <percentage> | <length> ]? ]" +
            " | " +
            "[ left | center | right | <percentage> | <length> ] " +
            "[ top | center | bottom | <percentage> | <length> ]" +
            " | " +
            "[ left | center | right | top | bottom | <percentage> | <length> ]",

        "<repeat-style>":
            "repeat-x | repeat-y | [ repeat | space | round | no-repeat ]{1,2}",

        "<shadow>":
        //inset? && [ <length>{2,4} && <color>? ]
        Matcher.many([true /* length is required */],
                     Matcher.cast("<length>").braces(2, 4), "inset", "<color>"),

        "<text-decoration-color>":
           "<color>",

        "<text-decoration-line>":
            "none | [ underline || overline || line-through || blink ]",

        "<text-decoration-style>":
            "solid | double | dotted | dashed | wavy",

        "<will-change>":
            "auto | <animateable-feature>#",

        "<x-one-radius>":
            //[ <length> | <percentage> ] [ <length> | <percentage> ]?
            "[ <length> | <percentage> ]{1,2}"
    }
});

Object.keys(ValidationTypes.simple).forEach(function(nt) {
    var rule = ValidationTypes.simple[nt];
    if (typeof rule === "string") {
        ValidationTypes.simple[nt] = function(part) {
            return ValidationTypes.isLiteral(part, rule);
        };
    }
});

Object.keys(ValidationTypes.complex).forEach(function(nt) {
    var rule = ValidationTypes.complex[nt];
    if (typeof rule === "string") {
        ValidationTypes.complex[nt] = Matcher.parse(rule);
    }
});

// Because this is defined relative to other complex validation types,
// we need to define it *after* the rest of the types are initialized.
ValidationTypes.complex["<font-variant>"] =
    Matcher.oror({ expand: "<font-variant-ligatures>" },
                 { expand: "<font-variant-alternates>" },
                 "<font-variant-caps>",
                 { expand: "<font-variant-numeric>" },
                 { expand: "<font-variant-east-asian>" });
},{"./Matcher":3}],22:[function(require,module,exports){
"use strict";

module.exports = {
    Colors            : require("./Colors"),
    Combinator        : require("./Combinator"),
    Parser            : require("./Parser"),
    PropertyName      : require("./PropertyName"),
    PropertyValue     : require("./PropertyValue"),
    PropertyValuePart : require("./PropertyValuePart"),
    Matcher           : require("./Matcher"),
    MediaFeature      : require("./MediaFeature"),
    MediaQuery        : require("./MediaQuery"),
    Selector          : require("./Selector"),
    SelectorPart      : require("./SelectorPart"),
    SelectorSubPart   : require("./SelectorSubPart"),
    Specificity       : require("./Specificity"),
    TokenStream       : require("./TokenStream"),
    Tokens            : require("./Tokens"),
    ValidationError   : require("./ValidationError")
};
},{"./Colors":1,"./Combinator":2,"./Matcher":3,"./MediaFeature":4,"./MediaQuery":5,"./Parser":6,"./PropertyName":8,"./PropertyValue":9,"./PropertyValuePart":11,"./Selector":13,"./SelectorPart":14,"./SelectorSubPart":15,"./Specificity":16,"./TokenStream":17,"./Tokens":18,"./ValidationError":20}],23:[function(require,module,exports){
"use strict";

module.exports = EventTarget;

/**
 * A generic base to inherit from for any object
 * that needs event handling.
 * @class EventTarget
 * @constructor
 */
function EventTarget() {

    /**
     * The array of listeners for various events.
     * @type Object
     * @property _listeners
     * @private
     */
    this._listeners = Object.create(null);
}

EventTarget.prototype = {

    //restore constructor
    constructor: EventTarget,

    /**
     * Adds a listener for a given event type.
     * @param {String} type The type of event to add a listener for.
     * @param {Function} listener The function to call when the event occurs.
     * @return {void}
     * @method addListener
     */
    addListener: function(type, listener) {
        if (!this._listeners[type]) {
            this._listeners[type] = [];
        }

        this._listeners[type].push(listener);
    },

    /**
     * Fires an event based on the passed-in object.
     * @param {Object|String} event An object with at least a 'type' attribute
     *      or a string indicating the event name.
     * @return {void}
     * @method fire
     */
    fire: function(event) {
        if (typeof event === "string") {
            event = { type: event };
        }
        if (typeof event.target !== "undefined") {
            event.target = this;
        }

        if (typeof event.type === "undefined") {
            throw new Error("Event object missing 'type' property.");
        }

        if (this._listeners[event.type]) {

            //create a copy of the array and use that so listeners can't chane
            var listeners = this._listeners[event.type].concat();
            for (var i=0, len=listeners.length; i < len; i++) {
                listeners[i].call(this, event);
            }
        }
    },

    /**
     * Removes a listener for a given event type.
     * @param {String} type The type of event to remove a listener from.
     * @param {Function} listener The function to remove from the event.
     * @return {void}
     * @method removeListener
     */
    removeListener: function(type, listener) {
        if (this._listeners[type]) {
            var listeners = this._listeners[type];
            for (var i=0, len=listeners.length; i < len; i++) {
                if (listeners[i] === listener) {
                    listeners.splice(i, 1);
                    break;
                }
            }
        }
    }
};
},{}],24:[function(require,module,exports){
"use strict";

module.exports = StringReader;

/**
 * Convenient way to read through strings.
 * @namespace parserlib.util
 * @class StringReader
 * @constructor
 * @param {String} text The text to read.
 */
function StringReader(text) {

    /**
     * The input text with line endings normalized.
     * @property _input
     * @type String
     * @private
     */
    this._input = text.replace(/(\r\n?|\n)/g, "\n");

    /**
     * The row for the character to be read next.
     * @property _line
     * @type int
     * @private
     */
    this._line = 1;

    /**
     * The column for the character to be read next.
     * @property _col
     * @type int
     * @private
     */
    this._col = 1;

    /**
     * The index of the character in the input to be read next.
     * @property _cursor
     * @type int
     * @private
     */
    this._cursor = 0;
}

StringReader.prototype = {

    // restore constructor
    constructor: StringReader,

    //-------------------------------------------------------------------------
    // Position info
    //-------------------------------------------------------------------------

    /**
     * Returns the column of the character to be read next.
     * @return {int} The column of the character to be read next.
     * @method getCol
     */
    getCol: function() {
        return this._col;
    },

    /**
     * Returns the row of the character to be read next.
     * @return {int} The row of the character to be read next.
     * @method getLine
     */
    getLine: function() {
        return this._line;
    },

    /**
     * Determines if you're at the end of the input.
     * @return {Boolean} True if there's no more input, false otherwise.
     * @method eof
     */
    eof: function() {
        return this._cursor === this._input.length;
    },

    //-------------------------------------------------------------------------
    // Basic reading
    //-------------------------------------------------------------------------

    /**
     * Reads the next character without advancing the cursor.
     * @param {int} count How many characters to look ahead (default is 1).
     * @return {String} The next character or null if there is no next character.
     * @method peek
     */
    peek: function(count) {
        var c = null;
        count = typeof count === "undefined" ? 1 : count;

        // if we're not at the end of the input...
        if (this._cursor < this._input.length) {

            // get character and increment cursor and column
            c = this._input.charAt(this._cursor + count - 1);
        }

        return c;
    },

    /**
     * Reads the next character from the input and adjusts the row and column
     * accordingly.
     * @return {String} The next character or null if there is no next character.
     * @method read
     */
    read: function() {
        var c = null;

        // if we're not at the end of the input...
        if (this._cursor < this._input.length) {

            // if the last character was a newline, increment row count
            // and reset column count
            if (this._input.charAt(this._cursor) === "\n") {
                this._line++;
                this._col=1;
            } else {
                this._col++;
            }

            // get character and increment cursor and column
            c = this._input.charAt(this._cursor++);
        }

        return c;
    },

    //-------------------------------------------------------------------------
    // Misc
    //-------------------------------------------------------------------------

    /**
     * Saves the current location so it can be returned to later.
     * @method mark
     * @return {void}
     */
    mark: function() {
        this._bookmark = {
            cursor: this._cursor,
            line:   this._line,
            col:    this._col
        };
    },

    reset: function() {
        if (this._bookmark) {
            this._cursor = this._bookmark.cursor;
            this._line = this._bookmark.line;
            this._col = this._bookmark.col;
            delete this._bookmark;
        }
    },

    //-------------------------------------------------------------------------
    // Advanced reading
    //-------------------------------------------------------------------------

    /**
     * Reads up to and including the given string. Throws an error if that
     * string is not found.
     * @param {String} pattern The string to read.
     * @return {String} The string when it is found.
     * @throws Error when the string pattern is not found.
     * @method readTo
     */
    readTo: function(pattern) {

        var buffer = "",
            c;

        /*
         * First, buffer must be the same length as the pattern.
         * Then, buffer must end with the pattern or else reach the
         * end of the input.
         */
        while (buffer.length < pattern.length || buffer.lastIndexOf(pattern) !== buffer.length - pattern.length) {
            c = this.read();
            if (c) {
                buffer += c;
            } else {
                throw new Error("Expected \"" + pattern + "\" at line " + this._line  + ", col " + this._col + ".");
            }
        }

        return buffer;
    },

    /**
     * Reads characters while each character causes the given
     * filter function to return true. The function is passed
     * in each character and either returns true to continue
     * reading or false to stop.
     * @param {Function} filter The function to read on each character.
     * @return {String} The string made up of all characters that passed the
     *      filter check.
     * @method readWhile
     */
    readWhile: function(filter) {

        var buffer = "",
            c = this.peek();

        while (c !== null && filter(c)) {
            buffer += this.read();
            c = this.peek();
        }

        return buffer;
    },

    /**
     * Reads characters that match either text or a regular expression and
     * returns those characters. If a match is found, the row and column
     * are adjusted; if no match is found, the reader's state is unchanged.
     * reading or false to stop.
     * @param {String|RegExp} matcher If a string, then the literal string
     *      value is searched for. If a regular expression, then any string
     *      matching the pattern is search for.
     * @return {String} The string made up of all characters that matched or
     *      null if there was no match.
     * @method readMatch
     */
    readMatch: function(matcher) {

        var source = this._input.substring(this._cursor),
            value = null;

        // if it's a string, just do a straight match
        if (typeof matcher === "string") {
            if (source.slice(0, matcher.length) === matcher) {
                value = this.readCount(matcher.length);
            }
        } else if (matcher instanceof RegExp) {
            if (matcher.test(source)) {
                value = this.readCount(RegExp.lastMatch.length);
            }
        }

        return value;
    },

    /**
     * Reads a given number of characters. If the end of the input is reached,
     * it reads only the remaining characters and does not throw an error.
     * @param {int} count The number of characters to read.
     * @return {String} The string made up the read characters.
     * @method readCount
     */
    readCount: function(count) {
        var buffer = "";

        while (count--) {
            buffer += this.read();
        }

        return buffer;
    }
};
},{}],25:[function(require,module,exports){
"use strict";

module.exports = SyntaxError;

/**
 * Type to use when a syntax error occurs.
 * @class SyntaxError
 * @namespace parserlib.util
 * @constructor
 * @param {String} message The error message.
 * @param {int} line The line at which the error occurred.
 * @param {int} col The column at which the error occurred.
 */
function SyntaxError(message, line, col) {
    Error.call(this);
    this.name = this.constructor.name;

    /**
     * The column at which the error occurred.
     * @type int
     * @property col
     */
    this.col = col;

    /**
     * The line at which the error occurred.
     * @type int
     * @property line
     */
    this.line = line;

    /**
     * The text representation of the unit.
     * @type String
     * @property text
     */
    this.message = message;
}

//inherit from Error
SyntaxError.prototype = Object.create(Error.prototype); // jshint ignore:line
SyntaxError.prototype.constructor = SyntaxError; // jshint ignore:line
},{}],26:[function(require,module,exports){
"use strict";

module.exports = SyntaxUnit;

/**
 * Base type to represent a single syntactic unit.
 * @class SyntaxUnit
 * @namespace parserlib.util
 * @constructor
 * @param {String} text The text of the unit.
 * @param {int} line The line of text on which the unit resides.
 * @param {int} col The column of text on which the unit resides.
 */
function SyntaxUnit(text, line, col, type) {

    /**
     * The column of text on which the unit resides.
     * @type int
     * @property col
     */
    this.col = col;

    /**
     * The line of text on which the unit resides.
     * @type int
     * @property line
     */
    this.line = line;

    /**
     * The text representation of the unit.
     * @type String
     * @property text
     */
    this.text = text;

    /**
     * The type of syntax unit.
     * @type int
     * @property type
     */
    this.type = type;
}

/**
 * Create a new syntax unit based solely on the given token.
 * Convenience method for creating a new syntax unit when
 * it represents a single token instead of multiple.
 * @param {Object} token The token object to represent.
 * @return {parserlib.util.SyntaxUnit} The object representing the token.
 * @static
 * @method fromToken
 */
SyntaxUnit.fromToken = function(token) {
    return new SyntaxUnit(token.value, token.startLine, token.startCol);
};

SyntaxUnit.prototype = {

    //restore constructor
    constructor: SyntaxUnit,

    /**
     * Returns the text representation of the unit.
     * @return {String} The text representation of the unit.
     * @method valueOf
     */
    valueOf: function() {
        return this.toString();
    },

    /**
     * Returns the text representation of the unit.
     * @return {String} The text representation of the unit.
     * @method toString
     */
    toString: function() {
        return this.text;
    }
};
},{}],27:[function(require,module,exports){
"use strict";

module.exports = TokenStreamBase;

var StringReader = require("./StringReader");
var SyntaxError = require("./SyntaxError");

/**
 * Generic TokenStream providing base functionality.
 * @class TokenStreamBase
 * @namespace parserlib.util
 * @constructor
 * @param {String|StringReader} input The text to tokenize or a reader from
 *      which to read the input.
 */
function TokenStreamBase(input, tokenData) {

    /**
     * The string reader for easy access to the text.
     * @type StringReader
     * @property _reader
     * @private
     */
    this._reader = new StringReader(input ? input.toString() : "");

    /**
     * Token object for the last consumed token.
     * @type Token
     * @property _token
     * @private
     */
    this._token = null;

    /**
     * The array of token information.
     * @type Array
     * @property _tokenData
     * @private
     */
    this._tokenData = tokenData;

    /**
     * Lookahead token buffer.
     * @type Array
     * @property _lt
     * @private
     */
    this._lt = [];

    /**
     * Lookahead token buffer index.
     * @type int
     * @property _ltIndex
     * @private
     */
    this._ltIndex = 0;

    this._ltIndexCache = [];
}

/**
 * Accepts an array of token information and outputs
 * an array of token data containing key-value mappings
 * and matching functions that the TokenStream needs.
 * @param {Array} tokens An array of token descriptors.
 * @return {Array} An array of processed token data.
 * @method createTokenData
 * @static
 */
TokenStreamBase.createTokenData = function(tokens) {

    var nameMap     = [],
        typeMap     = Object.create(null),
        tokenData     = tokens.concat([]),
        i            = 0,
        len            = tokenData.length+1;

    tokenData.UNKNOWN = -1;
    tokenData.unshift({ name:"EOF" });

    for (; i < len; i++) {
        nameMap.push(tokenData[i].name);
        tokenData[tokenData[i].name] = i;
        if (tokenData[i].text) {
            typeMap[tokenData[i].text] = i;
        }
    }

    tokenData.name = function(tt) {
        return nameMap[tt];
    };

    tokenData.type = function(c) {
        return typeMap[c];
    };

    return tokenData;
};

TokenStreamBase.prototype = {

    //restore constructor
    constructor: TokenStreamBase,

    //-------------------------------------------------------------------------
    // Matching methods
    //-------------------------------------------------------------------------

    /**
     * Determines if the next token matches the given token type.
     * If so, that token is consumed; if not, the token is placed
     * back onto the token stream. You can pass in any number of
     * token types and this will return true if any of the token
     * types is found.
     * @param {int|int[]} tokenTypes Either a single token type or an array of
     *      token types that the next token might be. If an array is passed,
     *      it's assumed that the token can be any of these.
     * @param {variant} channel (Optional) The channel to read from. If not
     *      provided, reads from the default (unnamed) channel.
     * @return {Boolean} True if the token type matches, false if not.
     * @method match
     */
    match: function(tokenTypes, channel) {

        //always convert to an array, makes things easier
        if (!(tokenTypes instanceof Array)) {
            tokenTypes = [tokenTypes];
        }

        var tt  = this.get(channel),
            i   = 0,
            len = tokenTypes.length;

        while (i < len) {
            if (tt === tokenTypes[i++]) {
                return true;
            }
        }

        //no match found, put the token back
        this.unget();
        return false;
    },

    /**
     * Determines if the next token matches the given token type.
     * If so, that token is consumed; if not, an error is thrown.
     * @param {int|int[]} tokenTypes Either a single token type or an array of
     *      token types that the next token should be. If an array is passed,
     *      it's assumed that the token must be one of these.
     * @return {void}
     * @method mustMatch
     */
    mustMatch: function(tokenTypes) {

        var token;

        //always convert to an array, makes things easier
        if (!(tokenTypes instanceof Array)) {
            tokenTypes = [tokenTypes];
        }

        if (!this.match.apply(this, arguments)) {
            token = this.LT(1);
            throw new SyntaxError("Expected " + this._tokenData[tokenTypes[0]].name +
                " at line " + token.startLine + ", col " + token.startCol + ".", token.startLine, token.startCol);
        }
    },

    //-------------------------------------------------------------------------
    // Consuming methods
    //-------------------------------------------------------------------------

    /**
     * Keeps reading from the token stream until either one of the specified
     * token types is found or until the end of the input is reached.
     * @param {int|int[]} tokenTypes Either a single token type or an array of
     *      token types that the next token should be. If an array is passed,
     *      it's assumed that the token must be one of these.
     * @param {variant} channel (Optional) The channel to read from. If not
     *      provided, reads from the default (unnamed) channel.
     * @return {void}
     * @method advance
     */
    advance: function(tokenTypes, channel) {

        while (this.LA(0) !== 0 && !this.match(tokenTypes, channel)) {
            this.get();
        }

        return this.LA(0);
    },

    /**
     * Consumes the next token from the token stream.
     * @return {int} The token type of the token that was just consumed.
     * @method get
     */
    get: function(channel) {

        var tokenInfo   = this._tokenData,
            i           =0,
            token,
            info;

        //check the lookahead buffer first
        if (this._lt.length && this._ltIndex >= 0 && this._ltIndex < this._lt.length) {

            i++;
            this._token = this._lt[this._ltIndex++];
            info = tokenInfo[this._token.type];

            //obey channels logic
            while ((info.channel !== undefined && channel !== info.channel) &&
                    this._ltIndex < this._lt.length) {
                this._token = this._lt[this._ltIndex++];
                info = tokenInfo[this._token.type];
                i++;
            }

            //here be dragons
            if ((info.channel === undefined || channel === info.channel) &&
                    this._ltIndex <= this._lt.length) {
                this._ltIndexCache.push(i);
                return this._token.type;
            }
        }

        //call token retriever method
        token = this._getToken();

        //if it should be hidden, don't save a token
        if (token.type > -1 && !tokenInfo[token.type].hide) {

            //apply token channel
            token.channel = tokenInfo[token.type].channel;

            //save for later
            this._token = token;
            this._lt.push(token);

            //save space that will be moved (must be done before array is truncated)
            this._ltIndexCache.push(this._lt.length - this._ltIndex + i);

            //keep the buffer under 5 items
            if (this._lt.length > 5) {
                this._lt.shift();
            }

            //also keep the shift buffer under 5 items
            if (this._ltIndexCache.length > 5) {
                this._ltIndexCache.shift();
            }

            //update lookahead index
            this._ltIndex = this._lt.length;
        }

        /*
         * Skip to the next token if:
         * 1. The token type is marked as hidden.
         * 2. The token type has a channel specified and it isn't the current channel.
         */
        info = tokenInfo[token.type];
        if (info &&
                (info.hide ||
                (info.channel !== undefined && channel !== info.channel))) {
            return this.get(channel);
        } else {
            //return just the type
            return token.type;
        }
    },

    /**
     * Looks ahead a certain number of tokens and returns the token type at
     * that position. This will throw an error if you lookahead past the
     * end of input, past the size of the lookahead buffer, or back past
     * the first token in the lookahead buffer.
     * @param {int} The index of the token type to retrieve. 0 for the
     *      current token, 1 for the next, -1 for the previous, etc.
     * @return {int} The token type of the token in the given position.
     * @method LA
     */
    LA: function(index) {
        var total = index,
            tt;
        if (index > 0) {
            //TODO: Store 5 somewhere
            if (index > 5) {
                throw new Error("Too much lookahead.");
            }

            //get all those tokens
            while (total) {
                tt = this.get();
                total--;
            }

            //unget all those tokens
            while (total < index) {
                this.unget();
                total++;
            }
        } else if (index < 0) {

            if (this._lt[this._ltIndex+index]) {
                tt = this._lt[this._ltIndex+index].type;
            } else {
                throw new Error("Too much lookbehind.");
            }
        } else {
            tt = this._token.type;
        }

        return tt;
    },

    /**
     * Looks ahead a certain number of tokens and returns the token at
     * that position. This will throw an error if you lookahead past the
     * end of input, past the size of the lookahead buffer, or back past
     * the first token in the lookahead buffer.
     * @param {int} The index of the token type to retrieve. 0 for the
     *      current token, 1 for the next, -1 for the previous, etc.
     * @return {Object} The token of the token in the given position.
     * @method LA
     */
    LT: function(index) {

        //lookahead first to prime the token buffer
        this.LA(index);

        //now find the token, subtract one because _ltIndex is already at the next index
        return this._lt[this._ltIndex+index-1];
    },

    /**
     * Returns the token type for the next token in the stream without
     * consuming it.
     * @return {int} The token type of the next token in the stream.
     * @method peek
     */
    peek: function() {
        return this.LA(1);
    },

    /**
     * Returns the actual token object for the last consumed token.
     * @return {Token} The token object for the last consumed token.
     * @method token
     */
    token: function() {
        return this._token;
    },

    /**
     * Returns the name of the token for the given token type.
     * @param {int} tokenType The type of token to get the name of.
     * @return {String} The name of the token or "UNKNOWN_TOKEN" for any
     *      invalid token type.
     * @method tokenName
     */
    tokenName: function(tokenType) {
        if (tokenType < 0 || tokenType > this._tokenData.length) {
            return "UNKNOWN_TOKEN";
        } else {
            return this._tokenData[tokenType].name;
        }
    },

    /**
     * Returns the token type value for the given token name.
     * @param {String} tokenName The name of the token whose value should be returned.
     * @return {int} The token type value for the given token name or -1
     *      for an unknown token.
     * @method tokenName
     */
    tokenType: function(tokenName) {
        return this._tokenData[tokenName] || -1;
    },

    /**
     * Returns the last consumed token to the token stream.
     * @method unget
     */
    unget: function() {
        //if (this._ltIndex > -1) {
        if (this._ltIndexCache.length) {
            this._ltIndex -= this._ltIndexCache.pop();//--;
            this._token = this._lt[this._ltIndex - 1];
        } else {
            throw new Error("Too much lookahead.");
        }
    }
};
},{"./StringReader":24,"./SyntaxError":25}],28:[function(require,module,exports){
"use strict";

module.exports = {
    StringReader    : require("./StringReader"),
    SyntaxError     : require("./SyntaxError"),
    SyntaxUnit      : require("./SyntaxUnit"),
    EventTarget     : require("./EventTarget"),
    TokenStreamBase : require("./TokenStreamBase")
};
},{"./EventTarget":23,"./StringReader":24,"./SyntaxError":25,"./SyntaxUnit":26,"./TokenStreamBase":27}],"parserlib":[function(require,module,exports){
"use strict";

module.exports = {
    css  : require("./css"),
    util : require("./util")
};
},{"./css":22,"./util":28}]},{},[]);

return require('parserlib');
})();
var clone = (function() {
'use strict';

var nativeMap;
try {
  nativeMap = Map;
} catch(_) {
  // maybe a reference error because no `Map`. Give it a dummy value that no
  // value will ever be an instanceof.
  nativeMap = function() {};
}

var nativeSet;
try {
  nativeSet = Set;
} catch(_) {
  nativeSet = function() {};
}

var nativePromise;
try {
  nativePromise = Promise;
} catch(_) {
  nativePromise = function() {};
}

/**
 * Clones (copies) an Object using deep copying.
 *
 * This function supports circular references by default, but if you are certain
 * there are no circular references in your object, you can save some CPU time
 * by calling clone(obj, false).
 *
 * Caution: if `circular` is false and `parent` contains circular references,
 * your program may enter an infinite loop and crash.
 *
 * @param `parent` - the object to be cloned
 * @param `circular` - set to true if the object to be cloned may contain
 *    circular references. (optional - true by default)
 * @param `depth` - set to a number if the object is only to be cloned to
 *    a particular depth. (optional - defaults to Infinity)
 * @param `prototype` - sets the prototype to be used when cloning an object.
 *    (optional - defaults to parent prototype).
 * @param `includeNonEnumerable` - set to true if the non-enumerable properties
 *    should be cloned as well. Non-enumerable properties on the prototype
 *    chain will be ignored. (optional - false by default)
*/
function clone(parent, circular, depth, prototype, includeNonEnumerable) {
  if (typeof circular === 'object') {
    depth = circular.depth;
    prototype = circular.prototype;
    includeNonEnumerable = circular.includeNonEnumerable;
    circular = circular.circular;
  }
  // maintain two arrays for circular references, where corresponding parents
  // and children have the same index
  var allParents = [];
  var allChildren = [];

  var useBuffer = typeof Buffer != 'undefined';

  if (typeof circular == 'undefined')
    circular = true;

  if (typeof depth == 'undefined')
    depth = Infinity;

  // recurse this function so we don't reset allParents and allChildren
  function _clone(parent, depth) {
    // cloning null always returns null
    if (parent === null)
      return null;

    if (depth === 0)
      return parent;

    var child;
    var proto;
    if (typeof parent != 'object') {
      return parent;
    }

    if (parent instanceof nativeMap) {
      child = new nativeMap();
    } else if (parent instanceof nativeSet) {
      child = new nativeSet();
    } else if (parent instanceof nativePromise) {
      child = new nativePromise(function (resolve, reject) {
        parent.then(function(value) {
          resolve(_clone(value, depth - 1));
        }, function(err) {
          reject(_clone(err, depth - 1));
        });
      });
    } else if (clone.__isArray(parent)) {
      child = [];
    } else if (clone.__isRegExp(parent)) {
      child = new RegExp(parent.source, __getRegExpFlags(parent));
      if (parent.lastIndex) child.lastIndex = parent.lastIndex;
    } else if (clone.__isDate(parent)) {
      child = new Date(parent.getTime());
    } else if (useBuffer && Buffer.isBuffer(parent)) {
      child = new Buffer(parent.length);
      parent.copy(child);
      return child;
    } else if (parent instanceof Error) {
      child = Object.create(parent);
    } else {
      if (typeof prototype == 'undefined') {
        proto = Object.getPrototypeOf(parent);
        child = Object.create(proto);
      }
      else {
        child = Object.create(prototype);
        proto = prototype;
      }
    }

    if (circular) {
      var index = allParents.indexOf(parent);

      if (index != -1) {
        return allChildren[index];
      }
      allParents.push(parent);
      allChildren.push(child);
    }

    if (parent instanceof nativeMap) {
      var keyIterator = parent.keys();
      while(true) {
        var next = keyIterator.next();
        if (next.done) {
          break;
        }
        var keyChild = _clone(next.value, depth - 1);
        var valueChild = _clone(parent.get(next.value), depth - 1);
        child.set(keyChild, valueChild);
      }
    }
    if (parent instanceof nativeSet) {
      var iterator = parent.keys();
      while(true) {
        var next = iterator.next();
        if (next.done) {
          break;
        }
        var entryChild = _clone(next.value, depth - 1);
        child.add(entryChild);
      }
    }

    for (var i in parent) {
      var attrs;
      if (proto) {
        attrs = Object.getOwnPropertyDescriptor(proto, i);
      }

      if (attrs && attrs.set == null) {
        continue;
      }
      child[i] = _clone(parent[i], depth - 1);
    }

    if (Object.getOwnPropertySymbols) {
      var symbols = Object.getOwnPropertySymbols(parent);
      for (var i = 0; i < symbols.length; i++) {
        // Don't need to worry about cloning a symbol because it is a primitive,
        // like a number or string.
        var symbol = symbols[i];
        var descriptor = Object.getOwnPropertyDescriptor(parent, symbol);
        if (descriptor && !descriptor.enumerable && !includeNonEnumerable) {
          continue;
        }
        child[symbol] = _clone(parent[symbol], depth - 1);
        if (!descriptor.enumerable) {
          Object.defineProperty(child, symbol, {
            enumerable: false
          });
        }
      }
    }

    if (includeNonEnumerable) {
      var allPropertyNames = Object.getOwnPropertyNames(parent);
      for (var i = 0; i < allPropertyNames.length; i++) {
        var propertyName = allPropertyNames[i];
        var descriptor = Object.getOwnPropertyDescriptor(parent, propertyName);
        if (descriptor && descriptor.enumerable) {
          continue;
        }
        child[propertyName] = _clone(parent[propertyName], depth - 1);
        Object.defineProperty(child, propertyName, {
          enumerable: false
        });
      }
    }

    return child;
  }

  return _clone(parent, depth);
}

/**
 * Simple flat clone using prototype, accepts only objects, usefull for property
 * override on FLAT configuration object (no nested props).
 *
 * USE WITH CAUTION! This may not behave as you wish if you do not know how this
 * works.
 */
clone.clonePrototype = function clonePrototype(parent) {
  if (parent === null)
    return null;

  var c = function () {};
  c.prototype = parent;
  return new c();
};

// private utility functions

function __objToStr(o) {
  return Object.prototype.toString.call(o);
}
clone.__objToStr = __objToStr;

function __isDate(o) {
  return typeof o === 'object' && __objToStr(o) === '[object Date]';
}
clone.__isDate = __isDate;

function __isArray(o) {
  return typeof o === 'object' && __objToStr(o) === '[object Array]';
}
clone.__isArray = __isArray;

function __isRegExp(o) {
  return typeof o === 'object' && __objToStr(o) === '[object RegExp]';
}
clone.__isRegExp = __isRegExp;

function __getRegExpFlags(re) {
  var flags = '';
  if (re.global) flags += 'g';
  if (re.ignoreCase) flags += 'i';
  if (re.multiline) flags += 'm';
  return flags;
}
clone.__getRegExpFlags = __getRegExpFlags;

return clone;
})();

if (typeof module === 'object' && module.exports) {
  module.exports = clone;
}

/**
 * Main CSSLint object.
 * @class CSSLint
 * @static
 * @extends parserlib.util.EventTarget
 */

/* global parserlib, clone, Reporter */
/* exported CSSLint */

var CSSLint = (function() {
    "use strict";

    var rules           = [],
        formatters      = [],
        embeddedRuleset = /\/\*\s*csslint([^\*]*)\*\//,
        api             = new parserlib.util.EventTarget();

    api.version = "1.0.4";

    //-------------------------------------------------------------------------
    // Rule Management
    //-------------------------------------------------------------------------

    /**
     * Adds a new rule to the engine.
     * @param {Object} rule The rule to add.
     * @method addRule
     */
    api.addRule = function(rule) {
        rules.push(rule);
        rules[rule.id] = rule;
    };

    /**
     * Clears all rule from the engine.
     * @method clearRules
     */
    api.clearRules = function() {
        rules = [];
    };

    /**
     * Returns the rule objects.
     * @return An array of rule objects.
     * @method getRules
     */
    api.getRules = function() {
        return [].concat(rules).sort(function(a, b) {
            return a.id > b.id ? 1 : 0;
        });
    };

    /**
     * Returns a ruleset configuration object with all current rules.
     * @return A ruleset object.
     * @method getRuleset
     */
    api.getRuleset = function() {
        var ruleset = {},
            i = 0,
            len = rules.length;

        while (i < len) {
            ruleset[rules[i++].id] = 1;    // by default, everything is a warning
        }

        return ruleset;
    };

    /**
     * Returns a ruleset object based on embedded rules.
     * @param {String} text A string of css containing embedded rules.
     * @param {Object} ruleset A ruleset object to modify.
     * @return {Object} A ruleset object.
     * @method getEmbeddedRuleset
     */
    function applyEmbeddedRuleset(text, ruleset) {
        var valueMap,
            embedded = text && text.match(embeddedRuleset),
            rules = embedded && embedded[1];

        if (rules) {
            valueMap = {
                "true": 2,  // true is error
                "": 1,      // blank is warning
                "false": 0, // false is ignore

                "2": 2,     // explicit error
                "1": 1,     // explicit warning
                "0": 0      // explicit ignore
            };

            rules.toLowerCase().split(",").forEach(function(rule) {
                var pair = rule.split(":"),
                    property = pair[0] || "",
                    value = pair[1] || "";

                ruleset[property.trim()] = valueMap[value.trim()];
            });
        }

        return ruleset;
    }

    //-------------------------------------------------------------------------
    // Formatters
    //-------------------------------------------------------------------------

    /**
     * Adds a new formatter to the engine.
     * @param {Object} formatter The formatter to add.
     * @method addFormatter
     */
    api.addFormatter = function(formatter) {
        // formatters.push(formatter);
        formatters[formatter.id] = formatter;
    };

    /**
     * Retrieves a formatter for use.
     * @param {String} formatId The name of the format to retrieve.
     * @return {Object} The formatter or undefined.
     * @method getFormatter
     */
    api.getFormatter = function(formatId) {
        return formatters[formatId];
    };

    /**
     * Formats the results in a particular format for a single file.
     * @param {Object} result The results returned from CSSLint.verify().
     * @param {String} filename The filename for which the results apply.
     * @param {String} formatId The name of the formatter to use.
     * @param {Object} options (Optional) for special output handling.
     * @return {String} A formatted string for the results.
     * @method format
     */
    api.format = function(results, filename, formatId, options) {
        var formatter = this.getFormatter(formatId),
            result = null;

        if (formatter) {
            result = formatter.startFormat();
            result += formatter.formatResults(results, filename, options || {});
            result += formatter.endFormat();
        }

        return result;
    };

    /**
     * Indicates if the given format is supported.
     * @param {String} formatId The ID of the format to check.
     * @return {Boolean} True if the format exists, false if not.
     * @method hasFormat
     */
    api.hasFormat = function(formatId) {
        return formatters.hasOwnProperty(formatId);
    };

    //-------------------------------------------------------------------------
    // Verification
    //-------------------------------------------------------------------------

    /**
     * Starts the verification process for the given CSS text.
     * @param {String} text The CSS text to verify.
     * @param {Object} ruleset (Optional) List of rules to apply. If null, then
     *      all rules are used. If a rule has a value of 1 then it's a warning,
     *      a value of 2 means it's an error.
     * @return {Object} Results of the verification.
     * @method verify
     */
    api.verify = function(text, ruleset) {

        var i = 0,
            reporter,
            lines,
            allow = {},
            ignore = [],
            report,
            parser = new parserlib.css.Parser({
                starHack: true,
                ieFilters: true,
                underscoreHack: true,
                strict: false
            });

        // normalize line endings
        lines = text.replace(/\n\r?/g, "$split$").split("$split$");

        // find 'allow' comments
        CSSLint.Util.forEach(lines, function (line, lineno) {
            var allowLine = line && line.match(/\/\*[ \t]*csslint[ \t]+allow:[ \t]*([^\*]*)\*\//i),
                allowRules = allowLine && allowLine[1],
                allowRuleset = {};

            if (allowRules) {
                allowRules.toLowerCase().split(",").forEach(function(allowRule) {
                    allowRuleset[allowRule.trim()] = true;
                });
                if (Object.keys(allowRuleset).length > 0) {
                    allow[lineno + 1] = allowRuleset;
                }
            }
        });

        var ignoreStart = null,
            ignoreEnd = null;
        CSSLint.Util.forEach(lines, function (line, lineno) {
            // Keep oldest, "unclosest" ignore:start
            if (ignoreStart === null && line.match(/\/\*[ \t]*csslint[ \t]+ignore:start[ \t]*\*\//i)) {
                ignoreStart = lineno;
            }

            if (line.match(/\/\*[ \t]*csslint[ \t]+ignore:end[ \t]*\*\//i)) {
                ignoreEnd = lineno;
            }

            if (ignoreStart !== null && ignoreEnd !== null) {
                ignore.push([ignoreStart, ignoreEnd]);
                ignoreStart = ignoreEnd = null;
            }
        });

        // Close remaining ignore block, if any
        if (ignoreStart !== null) {
            ignore.push([ignoreStart, lines.length]);
        }

        if (!ruleset) {
            ruleset = this.getRuleset();
        }

        if (embeddedRuleset.test(text)) {
            // defensively copy so that caller's version does not get modified
            ruleset = clone(ruleset);
            ruleset = applyEmbeddedRuleset(text, ruleset);
        }

        reporter = new Reporter(lines, ruleset, allow, ignore);

        ruleset.errors = 2;       // always report parsing errors as errors
        for (i in ruleset) {
            if (ruleset.hasOwnProperty(i) && ruleset[i]) {
                if (rules[i]) {
                    rules[i].init(parser, reporter);
                }
            }
        }

        // capture most horrible error type
        try {
            parser.parse(text);
        } catch (ex) {
            reporter.error("Fatal error, cannot continue: " + ex.message, ex.line, ex.col, {});
        }

        report = {
            messages    : reporter.messages,
            stats       : reporter.stats,
            ruleset     : reporter.ruleset,
            allow       : reporter.allow,
            ignore      : reporter.ignore
        };

        // sort by line numbers, rollups at the bottom
        report.messages.sort(function (a, b) {
            if (a.rollup && !b.rollup) {
                return 1;
            } else if (!a.rollup && b.rollup) {
                return -1;
            } else {
                return a.line - b.line;
            }
        });

        return report;
    };

    //-------------------------------------------------------------------------
    // Publish the API
    //-------------------------------------------------------------------------

    return api;
})();

/**
 * An instance of Report is used to report results of the
 * verification back to the main API.
 * @class Reporter
 * @constructor
 * @param {String[]} lines The text lines of the source.
 * @param {Object} ruleset The set of rules to work with, including if
 *      they are errors or warnings.
 * @param {Object} explicitly allowed lines
 * @param {[][]} ingore list of line ranges to be ignored
 */
function Reporter(lines, ruleset, allow, ignore) {
    "use strict";

    /**
     * List of messages being reported.
     * @property messages
     * @type String[]
     */
    this.messages = [];

    /**
     * List of statistics being reported.
     * @property stats
     * @type String[]
     */
    this.stats = [];

    /**
     * Lines of code being reported on. Used to provide contextual information
     * for messages.
     * @property lines
     * @type String[]
     */
    this.lines = lines;

    /**
     * Information about the rules. Used to determine whether an issue is an
     * error or warning.
     * @property ruleset
     * @type Object
     */
    this.ruleset = ruleset;

    /**
     * Lines with specific rule messages to leave out of the report.
     * @property allow
     * @type Object
     */
    this.allow = allow;
    if (!this.allow) {
        this.allow = {};
    }

    /**
     * Linesets not to include in the report.
     * @property ignore
     * @type [][]
     */
    this.ignore = ignore;
    if (!this.ignore) {
        this.ignore = [];
    }
}

Reporter.prototype = {

    // restore constructor
    constructor: Reporter,

    /**
     * Report an error.
     * @param {String} message The message to store.
     * @param {int} line The line number.
     * @param {int} col The column number.
     * @param {Object} rule The rule this message relates to.
     * @method error
     */
    error: function(message, line, col, rule) {
        "use strict";
        this.messages.push({
            type    : "error",
            line    : line,
            col     : col,
            message : message,
            evidence: this.lines[line-1],
            rule    : rule || {}
        });
    },

    /**
     * Report an warning.
     * @param {String} message The message to store.
     * @param {int} line The line number.
     * @param {int} col The column number.
     * @param {Object} rule The rule this message relates to.
     * @method warn
     * @deprecated Use report instead.
     */
    warn: function(message, line, col, rule) {
        "use strict";
        this.report(message, line, col, rule);
    },

    /**
     * Report an issue.
     * @param {String} message The message to store.
     * @param {int} line The line number.
     * @param {int} col The column number.
     * @param {Object} rule The rule this message relates to.
     * @method report
     */
    report: function(message, line, col, rule) {
        "use strict";

        // Check if rule violation should be allowed
        if (this.allow.hasOwnProperty(line) && this.allow[line].hasOwnProperty(rule.id)) {
            return;
        }

        var ignore = false;
        CSSLint.Util.forEach(this.ignore, function (range) {
            if (range[0] <= line && line <= range[1]) {
                ignore = true;
            }
        });
        if (ignore) {
            return;
        }

        this.messages.push({
            type    : this.ruleset[rule.id] === 2 ? "error" : "warning",
            line    : line,
            col     : col,
            message : message,
            evidence: this.lines[line-1],
            rule    : rule
        });
    },

    /**
     * Report some informational text.
     * @param {String} message The message to store.
     * @param {int} line The line number.
     * @param {int} col The column number.
     * @param {Object} rule The rule this message relates to.
     * @method info
     */
    info: function(message, line, col, rule) {
        "use strict";
        this.messages.push({
            type    : "info",
            line    : line,
            col     : col,
            message : message,
            evidence: this.lines[line-1],
            rule    : rule
        });
    },

    /**
     * Report some rollup error information.
     * @param {String} message The message to store.
     * @param {Object} rule The rule this message relates to.
     * @method rollupError
     */
    rollupError: function(message, rule) {
        "use strict";
        this.messages.push({
            type    : "error",
            rollup  : true,
            message : message,
            rule    : rule
        });
    },

    /**
     * Report some rollup warning information.
     * @param {String} message The message to store.
     * @param {Object} rule The rule this message relates to.
     * @method rollupWarn
     */
    rollupWarn: function(message, rule) {
        "use strict";
        this.messages.push({
            type    : "warning",
            rollup  : true,
            message : message,
            rule    : rule
        });
    },

    /**
     * Report a statistic.
     * @param {String} name The name of the stat to store.
     * @param {Variant} value The value of the stat.
     * @method stat
     */
    stat: function(name, value) {
        "use strict";
        this.stats[name] = value;
    }
};

// expose for testing purposes
CSSLint._Reporter = Reporter;

/*
 * Utility functions that make life easier.
 */
CSSLint.Util = {
    /*
     * Adds all properties from supplier onto receiver,
     * overwriting if the same name already exists on
     * receiver.
     * @param {Object} The object to receive the properties.
     * @param {Object} The object to provide the properties.
     * @return {Object} The receiver
     */
    mix: function(receiver, supplier) {
        "use strict";
        var prop;

        for (prop in supplier) {
            if (supplier.hasOwnProperty(prop)) {
                receiver[prop] = supplier[prop];
            }
        }

        return prop;
    },

    /*
     * Polyfill for array indexOf() method.
     * @param {Array} values The array to search.
     * @param {Variant} value The value to search for.
     * @return {int} The index of the value if found, -1 if not.
     */
    indexOf: function(values, value) {
        "use strict";
        if (values.indexOf) {
            return values.indexOf(value);
        } else {
            for (var i=0, len=values.length; i < len; i++) {
                if (values[i] === value) {
                    return i;
                }
            }
            return -1;
        }
    },

    /*
     * Polyfill for array forEach() method.
     * @param {Array} values The array to operate on.
     * @param {Function} func The function to call on each item.
     * @return {void}
     */
    forEach: function(values, func) {
        "use strict";
        if (values.forEach) {
            return values.forEach(func);
        } else {
            for (var i=0, len=values.length; i < len; i++) {
                func(values[i], i, values);
            }
        }
    }
};

/*
 * Rule: Don't use adjoining classes (.foo.bar).
 */

CSSLint.addRule({

    // rule information
    id: "adjoining-classes",
    name: "Disallow adjoining classes",
    desc: "Don't use adjoining classes.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-adjoining-classes",
    browsers: "IE6",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;
        parser.addListener("startrule", function(event) {
            var selectors = event.selectors,
                selector,
                part,
                modifier,
                classCount,
                i, j, k;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];
                for (j=0; j < selector.parts.length; j++) {
                    part = selector.parts[j];
                    if (part.type === parser.SELECTOR_PART_TYPE) {
                        classCount = 0;
                        for (k=0; k < part.modifiers.length; k++) {
                            modifier = part.modifiers[k];
                            if (modifier.type === "class") {
                                classCount++;
                            }
                            if (classCount > 1){
                                reporter.report("Adjoining classes: "+selectors[i].text, part.line, part.col, rule);
                            }
                        }
                    }
                }
            }
        });
    }
});

/*
 * Rule: Don't use width or height when using padding or border.
 */
CSSLint.addRule({

    // rule information
    id: "box-model",
    name: "Beware of broken box size",
    desc: "Don't use width or height when using padding or border.",
    url: "https://github.com/CSSLint/csslint/wiki/Beware-of-box-model-size",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            widthProperties = {
                border: 1,
                "border-left": 1,
                "border-right": 1,
                padding: 1,
                "padding-left": 1,
                "padding-right": 1
            },
            heightProperties = {
                border: 1,
                "border-bottom": 1,
                "border-top": 1,
                padding: 1,
                "padding-bottom": 1,
                "padding-top": 1
            },
            properties,
            boxSizing = false;

        function startRule() {
            properties = {};
            boxSizing = false;
        }

        function endRule() {
            var prop, value;

            if (!boxSizing) {
                if (properties.height) {
                    for (prop in heightProperties) {
                        if (heightProperties.hasOwnProperty(prop) && properties[prop]) {
                            value = properties[prop].value;
                            // special case for padding
                            if (!(prop === "padding" && value.parts.length === 2 && value.parts[0].value === 0)) {
                                reporter.report("Using height with " + prop + " can sometimes make elements larger than you expect.", properties[prop].line, properties[prop].col, rule);
                            }
                        }
                    }
                }

                if (properties.width) {
                    for (prop in widthProperties) {
                        if (widthProperties.hasOwnProperty(prop) && properties[prop]) {
                            value = properties[prop].value;

                            if (!(prop === "padding" && value.parts.length === 2 && value.parts[1].value === 0)) {
                                reporter.report("Using width with " + prop + " can sometimes make elements larger than you expect.", properties[prop].line, properties[prop].col, rule);
                            }
                        }
                    }
                }
            }
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);
        parser.addListener("startpage", startRule);
        parser.addListener("startpagemargin", startRule);
        parser.addListener("startkeyframerule", startRule);
        parser.addListener("startviewport", startRule);

        parser.addListener("property", function(event) {
            var name = event.property.text.toLowerCase();

            if (heightProperties[name] || widthProperties[name]) {
                if (!/^0\S*$/.test(event.value) && !(name === "border" && event.value.toString() === "none")) {
                    properties[name] = {
                        line: event.property.line,
                        col: event.property.col,
                        value: event.value
                    };
                }
            } else {
                if (/^(width|height)/i.test(name) && /^(length|percentage)/.test(event.value.parts[0].type)) {
                    properties[name] = 1;
                } else if (name === "box-sizing") {
                    boxSizing = true;
                }
            }
        });

        parser.addListener("endrule", endRule);
        parser.addListener("endfontface", endRule);
        parser.addListener("endpage", endRule);
        parser.addListener("endpagemargin", endRule);
        parser.addListener("endkeyframerule", endRule);
        parser.addListener("endviewport", endRule);
    }
});

/*
 * Rule: box-sizing doesn't work in IE6 and IE7.
 */

CSSLint.addRule({

    // rule information
    id: "box-sizing",
    name: "Disallow use of box-sizing",
    desc: "The box-sizing properties isn't supported in IE6 and IE7.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-box-sizing",
    browsers: "IE6, IE7",
    tags: ["Compatibility"],

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        parser.addListener("property", function(event) {
            var name = event.property.text.toLowerCase();

            if (name === "box-sizing") {
                reporter.report("The box-sizing property isn't supported in IE6 and IE7.", event.line, event.col, rule);
            }
        });
    }
});

/*
 * Rule: Use the bulletproof @font-face syntax to avoid 404's in old IE
 * (http://www.fontspring.com/blog/the-new-bulletproof-font-face-syntax)
 */

CSSLint.addRule({

    // rule information
    id: "bulletproof-font-face",
    name: "Use the bulletproof @font-face syntax",
    desc: "Use the bulletproof @font-face syntax to avoid 404's in old IE (http://www.fontspring.com/blog/the-new-bulletproof-font-face-syntax).",
    url: "https://github.com/CSSLint/csslint/wiki/Bulletproof-font-face",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            fontFaceRule = false,
            firstSrc = true,
            ruleFailed = false,
            line, col;

        // Mark the start of a @font-face declaration so we only test properties inside it
        parser.addListener("startfontface", function() {
            fontFaceRule = true;
        });

        parser.addListener("property", function(event) {
            // If we aren't inside an @font-face declaration then just return
            if (!fontFaceRule) {
                return;
            }

            var propertyName = event.property.toString().toLowerCase(),
                value = event.value.toString();

            // Set the line and col numbers for use in the endfontface listener
            line = event.line;
            col = event.col;

            // This is the property that we care about, we can ignore the rest
            if (propertyName === "src") {
                var regex = /^\s?url\(['"].+\.eot\?.*['"]\)\s*format\(['"]embedded-opentype['"]\).*$/i;

                // We need to handle the advanced syntax with two src properties
                if (!value.match(regex) && firstSrc) {
                    ruleFailed = true;
                    firstSrc = false;
                } else if (value.match(regex) && !firstSrc) {
                    ruleFailed = false;
                }
            }
        });

        // Back to normal rules that we don't need to test
        parser.addListener("endfontface", function() {
            fontFaceRule = false;

            if (ruleFailed) {
                reporter.report("@font-face declaration doesn't follow the fontspring bulletproof syntax.", line, col, rule);
            }
        });
    }
});

/*
 * Rule: Include all compatible vendor prefixes to reach a wider
 * range of users.
 */

CSSLint.addRule({

    // rule information
    id: "compatible-vendor-prefixes",
    name: "Require compatible vendor prefixes",
    desc: "Include all compatible vendor prefixes to reach a wider range of users.",
    url: "https://github.com/CSSLint/csslint/wiki/Require-compatible-vendor-prefixes",
    browsers: "All",

    // initialization
    init: function (parser, reporter) {
        "use strict";
        var rule = this,
            compatiblePrefixes,
            properties,
            prop,
            variations,
            prefixed,
            i,
            len,
            inKeyFrame = false,
            arrayPush = Array.prototype.push,
            applyTo = [];

        // See http://peter.sh/experiments/vendor-prefixed-css-property-overview/ for details
        compatiblePrefixes = {
            "animation"                  : "webkit",
            "animation-delay"            : "webkit",
            "animation-direction"        : "webkit",
            "animation-duration"         : "webkit",
            "animation-fill-mode"        : "webkit",
            "animation-iteration-count"  : "webkit",
            "animation-name"             : "webkit",
            "animation-play-state"       : "webkit",
            "animation-timing-function"  : "webkit",
            "appearance"                 : "webkit moz",
            "border-end"                 : "webkit moz",
            "border-end-color"           : "webkit moz",
            "border-end-style"           : "webkit moz",
            "border-end-width"           : "webkit moz",
            "border-image"               : "webkit moz o",
            "border-radius"              : "webkit",
            "border-start"               : "webkit moz",
            "border-start-color"         : "webkit moz",
            "border-start-style"         : "webkit moz",
            "border-start-width"         : "webkit moz",
            "box-align"                  : "webkit moz ms",
            "box-direction"              : "webkit moz ms",
            "box-flex"                   : "webkit moz ms",
            "box-lines"                  : "webkit ms",
            "box-ordinal-group"          : "webkit moz ms",
            "box-orient"                 : "webkit moz ms",
            "box-pack"                   : "webkit moz ms",
            "box-sizing"                 : "",
            "box-shadow"                 : "",
            "column-count"               : "webkit moz ms",
            "column-gap"                 : "webkit moz ms",
            "column-rule"                : "webkit moz ms",
            "column-rule-color"          : "webkit moz ms",
            "column-rule-style"          : "webkit moz ms",
            "column-rule-width"          : "webkit moz ms",
            "column-width"               : "webkit moz ms",
            "hyphens"                    : "epub moz",
            "line-break"                 : "webkit ms",
            "margin-end"                 : "webkit moz",
            "margin-start"               : "webkit moz",
            "marquee-speed"              : "webkit wap",
            "marquee-style"              : "webkit wap",
            "padding-end"                : "webkit moz",
            "padding-start"              : "webkit moz",
            "tab-size"                   : "moz o",
            "text-size-adjust"           : "webkit ms",
            "transform"                  : "webkit ms",
            "transform-origin"           : "webkit ms",
            "transition"                 : "",
            "transition-delay"           : "",
            "transition-duration"        : "",
            "transition-property"        : "",
            "transition-timing-function" : "",
            "user-modify"                : "webkit moz",
            "user-select"                : "webkit moz ms",
            "word-break"                 : "epub ms",
            "writing-mode"               : "epub ms"
        };

        for (prop in compatiblePrefixes) {
            if (compatiblePrefixes.hasOwnProperty(prop)) {
                variations = [];
                prefixed = compatiblePrefixes[prop].split(" ");
                for (i = 0, len = prefixed.length; i < len; i++) {
                    variations.push("-" + prefixed[i] + "-" + prop);
                }
                compatiblePrefixes[prop] = variations;
                arrayPush.apply(applyTo, variations);
            }
        }

        parser.addListener("startrule", function () {
            properties = [];
        });

        parser.addListener("startkeyframes", function (event) {
            inKeyFrame = event.prefix || true;
        });

        parser.addListener("endkeyframes", function () {
            inKeyFrame = false;
        });

        parser.addListener("property", function (event) {
            var name = event.property;
            if (CSSLint.Util.indexOf(applyTo, name.text) > -1) {

                // e.g., -moz-transform is okay to be alone in @-moz-keyframes
                if (!inKeyFrame || typeof inKeyFrame !== "string" ||
                        name.text.indexOf("-" + inKeyFrame + "-") !== 0) {
                    properties.push(name);
                }
            }
        });

        parser.addListener("endrule", function () {
            if (!properties.length) {
                return;
            }

            var propertyGroups = {},
                i,
                len,
                name,
                prop,
                variations,
                value,
                full,
                actual,
                item,
                propertiesSpecified;

            for (i = 0, len = properties.length; i < len; i++) {
                name = properties[i];

                for (prop in compatiblePrefixes) {
                    if (compatiblePrefixes.hasOwnProperty(prop)) {
                        variations = compatiblePrefixes[prop];
                        if (CSSLint.Util.indexOf(variations, name.text) > -1) {
                            if (!propertyGroups[prop]) {
                                propertyGroups[prop] = {
                                    full: variations.slice(0),
                                    actual: [],
                                    actualNodes: []
                                };
                            }
                            if (CSSLint.Util.indexOf(propertyGroups[prop].actual, name.text) === -1) {
                                propertyGroups[prop].actual.push(name.text);
                                propertyGroups[prop].actualNodes.push(name);
                            }
                        }
                    }
                }
            }

            for (prop in propertyGroups) {
                if (propertyGroups.hasOwnProperty(prop)) {
                    value = propertyGroups[prop];
                    full = value.full;
                    actual = value.actual;

                    if (full.length > actual.length) {
                        for (i = 0, len = full.length; i < len; i++) {
                            item = full[i];
                            if (CSSLint.Util.indexOf(actual, item) === -1) {
                                propertiesSpecified = (actual.length === 1) ? actual[0] : (actual.length === 2) ? actual.join(" and ") : actual.join(", ");
                                reporter.report("The property " + item + " is compatible with " + propertiesSpecified + " and should be included as well.", value.actualNodes[0].line, value.actualNodes[0].col, rule);
                            }
                        }
                    }
                }
            }
        });
    }
});

/*
 * Rule: Certain properties don't play well with certain display values.
 * - float should not be used with inline-block
 * - height, width, margin-top, margin-bottom, float should not be used with inline
 * - vertical-align should not be used with block
 * - margin, float should not be used with table-*
 */

CSSLint.addRule({

    // rule information
    id: "display-property-grouping",
    name: "Require properties appropriate for display",
    desc: "Certain properties shouldn't be used with certain display property values.",
    url: "https://github.com/CSSLint/csslint/wiki/Require-properties-appropriate-for-display",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        var propertiesToCheck = {
                display: 1,
                "float": "none",
                height: 1,
                width: 1,
                margin: 1,
                "margin-left": 1,
                "margin-right": 1,
                "margin-bottom": 1,
                "margin-top": 1,
                padding: 1,
                "padding-left": 1,
                "padding-right": 1,
                "padding-bottom": 1,
                "padding-top": 1,
                "vertical-align": 1
            },
            properties;

        function reportProperty(name, display, msg) {
            if (properties[name]) {
                if (typeof propertiesToCheck[name] !== "string" || properties[name].value.toLowerCase() !== propertiesToCheck[name]) {
                    reporter.report(msg || name + " can't be used with display: " + display + ".", properties[name].line, properties[name].col, rule);
                }
            }
        }

        function startRule() {
            properties = {};
        }

        function endRule() {

            var display = properties.display ? properties.display.value : null;
            if (display) {
                switch (display) {

                    case "inline":
                        // height, width, margin-top, margin-bottom, float should not be used with inline
                        reportProperty("height", display);
                        reportProperty("width", display);
                        reportProperty("margin", display);
                        reportProperty("margin-top", display);
                        reportProperty("margin-bottom", display);
                        reportProperty("float", display, "display:inline has no effect on floated elements (but may be used to fix the IE6 double-margin bug).");
                        break;

                    case "block":
                        // vertical-align should not be used with block
                        reportProperty("vertical-align", display);
                        break;

                    case "inline-block":
                        // float should not be used with inline-block
                        reportProperty("float", display);
                        break;

                    default:
                        // margin, float should not be used with table
                        if (display.indexOf("table-") === 0) {
                            reportProperty("margin", display);
                            reportProperty("margin-left", display);
                            reportProperty("margin-right", display);
                            reportProperty("margin-top", display);
                            reportProperty("margin-bottom", display);
                            reportProperty("float", display);
                        }

                        // otherwise do nothing
                }
            }
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);
        parser.addListener("startkeyframerule", startRule);
        parser.addListener("startpagemargin", startRule);
        parser.addListener("startpage", startRule);
        parser.addListener("startviewport", startRule);

        parser.addListener("property", function(event) {
            var name = event.property.text.toLowerCase();

            if (propertiesToCheck[name]) {
                properties[name] = {
                    value: event.value.text,
                    line: event.property.line,
                    col: event.property.col
                };
            }
        });

        parser.addListener("endrule", endRule);
        parser.addListener("endfontface", endRule);
        parser.addListener("endkeyframerule", endRule);
        parser.addListener("endpagemargin", endRule);
        parser.addListener("endpage", endRule);
        parser.addListener("endviewport", endRule);
    }
});

/*
 * Rule: Disallow duplicate background-images (using url).
 */

CSSLint.addRule({

    // rule information
    id: "duplicate-background-images",
    name: "Disallow duplicate background images",
    desc: "Every background-image should be unique. Use a common class for e.g. sprites.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-duplicate-background-images",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            stack = {};

        parser.addListener("property", function(event) {
            var name = event.property.text,
                value = event.value,
                i, len;

            if (name.match(/background/i)) {
                for (i=0, len=value.parts.length; i < len; i++) {
                    if (value.parts[i].type === "uri") {
                        if (typeof stack[value.parts[i].uri] === "undefined") {
                            stack[value.parts[i].uri] = event;
                        } else {
                            reporter.report("Background image '" + value.parts[i].uri + "' was used multiple times, first declared at line " + stack[value.parts[i].uri].line + ", col " + stack[value.parts[i].uri].col + ".", event.line, event.col, rule);
                        }
                    }
                }
            }
        });
    }
});

/*
 * Rule: Duplicate properties must appear one after the other. If an already-defined
 * property appears somewhere else in the rule, then it's likely an error.
 */

CSSLint.addRule({

    // rule information
    id: "duplicate-properties",
    name: "Disallow duplicate properties",
    desc: "Duplicate properties must appear one after the other.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-duplicate-properties",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            properties,
            lastProperty;

        function startRule() {
            properties = {};
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);
        parser.addListener("startpage", startRule);
        parser.addListener("startpagemargin", startRule);
        parser.addListener("startkeyframerule", startRule);
        parser.addListener("startviewport", startRule);

        parser.addListener("property", function(event) {
            var property = event.property,
                name = property.text.toLowerCase();

            if (properties[name] && (lastProperty !== name || properties[name] === event.value.text)) {
                reporter.report("Duplicate property '" + event.property + "' found.", event.line, event.col, rule);
            }

            properties[name] = event.value.text;
            lastProperty = name;
        });
    }
});

/*
 * Rule: Style rules without any properties defined should be removed.
 */

CSSLint.addRule({

    // rule information
    id: "empty-rules",
    name: "Disallow empty rules",
    desc: "Rules without any properties specified should be removed.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-empty-rules",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            count = 0;

        parser.addListener("startrule", function() {
            count=0;
        });

        parser.addListener("property", function() {
            count++;
        });

        parser.addListener("endrule", function(event) {
            var selectors = event.selectors;
            if (count === 0) {
                reporter.report("Rule is empty.", selectors[0].line, selectors[0].col, rule);
            }
        });
    }
});

/*
 * Rule: There should be no syntax errors. (Duh.)
 */

CSSLint.addRule({

    // rule information
    id: "errors",
    name: "Parsing Errors",
    desc: "This rule looks for recoverable syntax errors.",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        parser.addListener("error", function(event) {
            reporter.error(event.message, event.line, event.col, rule);
        });
    }
});

CSSLint.addRule({

    // rule information
    id: "fallback-colors",
    name: "Require fallback colors",
    desc: "For older browsers that don't support RGBA, HSL, or HSLA, provide a fallback color.",
    url: "https://github.com/CSSLint/csslint/wiki/Require-fallback-colors",
    browsers: "IE6,IE7,IE8",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            lastProperty,
            propertiesToCheck = {
                color: 1,
                background: 1,
                "border-color": 1,
                "border-top-color": 1,
                "border-right-color": 1,
                "border-bottom-color": 1,
                "border-left-color": 1,
                border: 1,
                "border-top": 1,
                "border-right": 1,
                "border-bottom": 1,
                "border-left": 1,
                "background-color": 1
            };

        function startRule() {
            lastProperty = null;
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);
        parser.addListener("startpage", startRule);
        parser.addListener("startpagemargin", startRule);
        parser.addListener("startkeyframerule", startRule);
        parser.addListener("startviewport", startRule);

        parser.addListener("property", function(event) {
            var property = event.property,
                name = property.text.toLowerCase(),
                parts = event.value.parts,
                i = 0,
                colorType = "",
                len = parts.length;

            if (propertiesToCheck[name]) {
                while (i < len) {
                    if (parts[i].type === "color") {
                        if ("alpha" in parts[i] || "hue" in parts[i]) {

                            if (/([^\)]+)\(/.test(parts[i])) {
                                colorType = RegExp.$1.toUpperCase();
                            }

                            if (!lastProperty || (lastProperty.property.text.toLowerCase() !== name || lastProperty.colorType !== "compat")) {
                                reporter.report("Fallback " + name + " (hex or RGB) should precede " + colorType + " " + name + ".", event.line, event.col, rule);
                            }
                        } else {
                            event.colorType = "compat";
                        }
                    }

                    i++;
                }
            }

            lastProperty = event;
        });
    }
});

/*
 * Rule: You shouldn't use more than 10 floats. If you do, there's probably
 * room for some abstraction.
 */

CSSLint.addRule({

    // rule information
    id: "floats",
    name: "Disallow too many floats",
    desc: "This rule tests if the float property is used too many times",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-too-many-floats",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;
        var count = 0;

        // count how many times "float" is used
        parser.addListener("property", function(event) {
            if (event.property.text.toLowerCase() === "float" &&
                    event.value.text.toLowerCase() !== "none") {
                count++;
            }
        });

        // report the results
        parser.addListener("endstylesheet", function() {
            reporter.stat("floats", count);
            if (count >= 10) {
                reporter.rollupWarn("Too many floats (" + count + "), you're probably using them for layout. Consider using a grid system instead.", rule);
            }
        });
    }
});

/*
 * Rule: Avoid too many @font-face declarations in the same stylesheet.
 */

CSSLint.addRule({

    // rule information
    id: "font-faces",
    name: "Don't use too many web fonts",
    desc: "Too many different web fonts in the same stylesheet.",
    url: "https://github.com/CSSLint/csslint/wiki/Don%27t-use-too-many-web-fonts",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            count = 0;

        parser.addListener("startfontface", function() {
            count++;
        });

        parser.addListener("endstylesheet", function() {
            if (count > 5) {
                reporter.rollupWarn("Too many @font-face declarations (" + count + ").", rule);
            }
        });
    }
});

/*
 * Rule: You shouldn't need more than 9 font-size declarations.
 */

CSSLint.addRule({

    // rule information
    id: "font-sizes",
    name: "Disallow too many font sizes",
    desc: "Checks the number of font-size declarations.",
    url: "https://github.com/CSSLint/csslint/wiki/Don%27t-use-too-many-font-size-declarations",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            count = 0;

        // check for use of "font-size"
        parser.addListener("property", function(event) {
            if (event.property.toString() === "font-size") {
                count++;
            }
        });

        // report the results
        parser.addListener("endstylesheet", function() {
            reporter.stat("font-sizes", count);
            if (count >= 10) {
                reporter.rollupWarn("Too many font-size declarations (" + count + "), abstraction needed.", rule);
            }
        });
    }
});

/*
 * Rule: When using a vendor-prefixed gradient, make sure to use them all.
 */

CSSLint.addRule({

    // rule information
    id: "gradients",
    name: "Require all gradient definitions",
    desc: "When using a vendor-prefixed gradient, make sure to use them all.",
    url: "https://github.com/CSSLint/csslint/wiki/Require-all-gradient-definitions",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            gradients;

        parser.addListener("startrule", function() {
            gradients = {
                moz: 0,
                webkit: 0,
                oldWebkit: 0,
                o: 0
            };
        });

        parser.addListener("property", function(event) {

            if (/\-(moz|o|webkit)(?:\-(?:linear|radial))\-gradient/i.test(event.value)) {
                gradients[RegExp.$1] = 1;
            } else if (/\-webkit\-gradient/i.test(event.value)) {
                gradients.oldWebkit = 1;
            }
        });

        parser.addListener("endrule", function(event) {
            var missing = [];

            if (!gradients.moz) {
                missing.push("Firefox 3.6+");
            }

            if (!gradients.webkit) {
                missing.push("Webkit (Safari 5+, Chrome)");
            }

            if (!gradients.oldWebkit) {
                missing.push("Old Webkit (Safari 4+, Chrome)");
            }

            if (!gradients.o) {
                missing.push("Opera 11.1+");
            }

            if (missing.length && missing.length < 4) {
                reporter.report("Missing vendor-prefixed CSS gradients for " + missing.join(", ") + ".", event.selectors[0].line, event.selectors[0].col, rule);
            }
        });
    }
});

/*
 * Rule: Don't use IDs for selectors.
 */

CSSLint.addRule({

    // rule information
    id: "ids",
    name: "Disallow IDs in selectors",
    desc: "Selectors should not contain IDs.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-IDs-in-selectors",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;
        parser.addListener("startrule", function(event) {
            var selectors = event.selectors,
                selector,
                part,
                modifier,
                idCount,
                i, j, k;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];
                idCount = 0;

                for (j=0; j < selector.parts.length; j++) {
                    part = selector.parts[j];
                    if (part.type === parser.SELECTOR_PART_TYPE) {
                        for (k=0; k < part.modifiers.length; k++) {
                            modifier = part.modifiers[k];
                            if (modifier.type === "id") {
                                idCount++;
                            }
                        }
                    }
                }

                if (idCount === 1) {
                    reporter.report("Don't use IDs in selectors.", selector.line, selector.col, rule);
                } else if (idCount > 1) {
                    reporter.report(idCount + " IDs in the selector, really?", selector.line, selector.col, rule);
                }
            }
        });
    }
});

/*
 * Rule: IE6-9 supports up to 31 stylesheet import.
 * Reference:
 * http://blogs.msdn.com/b/ieinternals/archive/2011/05/14/internet-explorer-stylesheet-rule-selector-import-sheet-limit-maximum.aspx
 */

CSSLint.addRule({

    // rule information
    id: "import-ie-limit",
    name: "@import limit on IE6-IE9",
    desc: "IE6-9 supports up to 31 @import per stylesheet",
    browsers: "IE6, IE7, IE8, IE9",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            MAX_IMPORT_COUNT = 31,
            count = 0;

        function startPage() {
            count = 0;
        }

        parser.addListener("startpage", startPage);

        parser.addListener("import", function() {
            count++;
        });

        parser.addListener("endstylesheet", function() {
            if (count > MAX_IMPORT_COUNT) {
                reporter.rollupError(
                    "Too many @import rules (" + count + "). IE6-9 supports up to 31 import per stylesheet.",
                    rule
                );
            }
        });
    }
});

/*
 * Rule: Don't use @import, use <link> instead.
 */

CSSLint.addRule({

    // rule information
    id: "import",
    name: "Disallow @import",
    desc: "Don't use @import, use <link> instead.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-%40import",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        parser.addListener("import", function(event) {
            reporter.report("@import prevents parallel downloads, use <link> instead.", event.line, event.col, rule);
        });
    }
});

/*
 * Rule: Make sure !important is not overused, this could lead to specificity
 * war. Display a warning on !important declarations, an error if it's
 * used more at least 10 times.
 */

CSSLint.addRule({

    // rule information
    id: "important",
    name: "Disallow !important",
    desc: "Be careful when using !important declaration",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-%21important",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            count = 0;

        // warn that important is used and increment the declaration counter
        parser.addListener("property", function(event) {
            if (event.important === true) {
                count++;
                reporter.report("Use of !important", event.line, event.col, rule);
            }
        });

        // if there are more than 10, show an error
        parser.addListener("endstylesheet", function() {
            reporter.stat("important", count);
            if (count >= 10) {
                reporter.rollupWarn("Too many !important declarations (" + count + "), try to use less than 10 to avoid specificity issues.", rule);
            }
        });
    }
});

/*
 * Rule: Properties should be known (listed in CSS3 specification) or
 * be a vendor-prefixed property.
 */

CSSLint.addRule({

    // rule information
    id: "known-properties",
    name: "Require use of known properties",
    desc: "Properties should be known (listed in CSS3 specification) or be a vendor-prefixed property.",
    url: "https://github.com/CSSLint/csslint/wiki/Require-use-of-known-properties",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        parser.addListener("property", function(event) {

            // the check is handled entirely by the parser-lib (https://github.com/nzakas/parser-lib)
            if (event.invalid) {
                reporter.report(event.invalid.message, event.line, event.col, rule);
            }
        });
    }
});

/*
 * Rule: All properties should be in alphabetical order.
 */

CSSLint.addRule({

    // rule information
    id: "order-alphabetical",
    name: "Alphabetical order",
    desc: "Assure properties are in alphabetical order",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            properties;

        var startRule = function () {
            properties = [];
        };

        var endRule = function(event) {
            var currentProperties = properties.join(","),
                expectedProperties = properties.sort().join(",");

            if (currentProperties !== expectedProperties) {
                reporter.report("Rule doesn't have all its properties in alphabetical order.", event.line, event.col, rule);
            }
        };

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);
        parser.addListener("startpage", startRule);
        parser.addListener("startpagemargin", startRule);
        parser.addListener("startkeyframerule", startRule);
        parser.addListener("startviewport", startRule);

        parser.addListener("property", function(event) {
            var name = event.property.text,
                lowerCasePrefixLessName = name.toLowerCase().replace(/^-.*?-/, "");

            properties.push(lowerCasePrefixLessName);
        });

        parser.addListener("endrule", endRule);
        parser.addListener("endfontface", endRule);
        parser.addListener("endpage", endRule);
        parser.addListener("endpagemargin", endRule);
        parser.addListener("endkeyframerule", endRule);
        parser.addListener("endviewport", endRule);
    }
});

/*
 * Rule: outline: none or outline: 0 should only be used in a :focus rule
 *       and only if there are other properties in the same rule.
 */

CSSLint.addRule({

    // rule information
    id: "outline-none",
    name: "Disallow outline: none",
    desc: "Use of outline: none or outline: 0 should be limited to :focus rules.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-outline%3Anone",
    browsers: "All",
    tags: ["Accessibility"],

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            lastRule;

        function startRule(event) {
            if (event.selectors) {
                lastRule = {
                    line: event.line,
                    col: event.col,
                    selectors: event.selectors,
                    propCount: 0,
                    outline: false
                };
            } else {
                lastRule = null;
            }
        }

        function endRule() {
            if (lastRule) {
                if (lastRule.outline) {
                    if (lastRule.selectors.toString().toLowerCase().indexOf(":focus") === -1) {
                        reporter.report("Outlines should only be modified using :focus.", lastRule.line, lastRule.col, rule);
                    } else if (lastRule.propCount === 1) {
                        reporter.report("Outlines shouldn't be hidden unless other visual changes are made.", lastRule.line, lastRule.col, rule);
                    }
                }
            }
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);
        parser.addListener("startpage", startRule);
        parser.addListener("startpagemargin", startRule);
        parser.addListener("startkeyframerule", startRule);
        parser.addListener("startviewport", startRule);

        parser.addListener("property", function(event) {
            var name = event.property.text.toLowerCase(),
                value = event.value;

            if (lastRule) {
                lastRule.propCount++;
                if (name === "outline" && (value.toString() === "none" || value.toString() === "0")) {
                    lastRule.outline = true;
                }
            }
        });

        parser.addListener("endrule", endRule);
        parser.addListener("endfontface", endRule);
        parser.addListener("endpage", endRule);
        parser.addListener("endpagemargin", endRule);
        parser.addListener("endkeyframerule", endRule);
        parser.addListener("endviewport", endRule);
    }
});

/*
 * Rule: Don't use classes or IDs with elements (a.foo or a#foo).
 */

CSSLint.addRule({

    // rule information
    id: "overqualified-elements",
    name: "Disallow overqualified elements",
    desc: "Don't use classes or IDs with elements (a.foo or a#foo).",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-overqualified-elements",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            classes = {};

        parser.addListener("startrule", function(event) {
            var selectors = event.selectors,
                selector,
                part,
                modifier,
                i, j, k;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];

                for (j=0; j < selector.parts.length; j++) {
                    part = selector.parts[j];
                    if (part.type === parser.SELECTOR_PART_TYPE) {
                        for (k=0; k < part.modifiers.length; k++) {
                            modifier = part.modifiers[k];
                            if (part.elementName && modifier.type === "id") {
                                reporter.report("Element (" + part + ") is overqualified, just use " + modifier + " without element name.", part.line, part.col, rule);
                            } else if (modifier.type === "class") {

                                if (!classes[modifier]) {
                                    classes[modifier] = [];
                                }
                                classes[modifier].push({
                                    modifier: modifier,
                                    part: part
                                });
                            }
                        }
                    }
                }
            }
        });

        parser.addListener("endstylesheet", function() {

            var prop;
            for (prop in classes) {
                if (classes.hasOwnProperty(prop)) {

                    // one use means that this is overqualified
                    if (classes[prop].length === 1 && classes[prop][0].part.elementName) {
                        reporter.report("Element (" + classes[prop][0].part + ") is overqualified, just use " + classes[prop][0].modifier + " without element name.", classes[prop][0].part.line, classes[prop][0].part.col, rule);
                    }
                }
            }
        });
    }
});

/*
 * Rule: Headings (h1-h6) should not be qualified (namespaced).
 */

CSSLint.addRule({

    // rule information
    id: "qualified-headings",
    name: "Disallow qualified headings",
    desc: "Headings should not be qualified (namespaced).",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-qualified-headings",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        parser.addListener("startrule", function(event) {
            var selectors = event.selectors,
                selector,
                part,
                i, j;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];

                for (j=0; j < selector.parts.length; j++) {
                    part = selector.parts[j];
                    if (part.type === parser.SELECTOR_PART_TYPE) {
                        if (part.elementName && /h[1-6]/.test(part.elementName.toString()) && j > 0) {
                            reporter.report("Heading (" + part.elementName + ") should not be qualified.", part.line, part.col, rule);
                        }
                    }
                }
            }
        });
    }
});

/*
 * Rule: Selectors that look like regular expressions are slow and should be avoided.
 */

CSSLint.addRule({

    // rule information
    id: "regex-selectors",
    name: "Disallow selectors that look like regexs",
    desc: "Selectors that look like regular expressions are slow and should be avoided.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-selectors-that-look-like-regular-expressions",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        parser.addListener("startrule", function(event) {
            var selectors = event.selectors,
                selector,
                part,
                modifier,
                i, j, k;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];
                for (j=0; j < selector.parts.length; j++) {
                    part = selector.parts[j];
                    if (part.type === parser.SELECTOR_PART_TYPE) {
                        for (k=0; k < part.modifiers.length; k++) {
                            modifier = part.modifiers[k];
                            if (modifier.type === "attribute") {
                                if (/([~\|\^\$\*]=)/.test(modifier)) {
                                    reporter.report("Attribute selectors with " + RegExp.$1 + " are slow!", modifier.line, modifier.col, rule);
                                }
                            }
                        }
                    }
                }
            }
        });
    }
});

/*
 * Rule: Total number of rules should not exceed x.
 */

CSSLint.addRule({

    // rule information
    id: "rules-count",
    name: "Rules Count",
    desc: "Track how many rules there are.",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var count = 0;

        // count each rule
        parser.addListener("startrule", function() {
            count++;
        });

        parser.addListener("endstylesheet", function() {
            reporter.stat("rule-count", count);
        });
    }
});

/*
 * Rule: Warn people with approaching the IE 4095 limit
 */

CSSLint.addRule({

    // rule information
    id: "selector-max-approaching",
    name: "Warn when approaching the 4095 selector limit for IE",
    desc: "Will warn when selector count is >= 3800 selectors.",
    browsers: "IE",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this, count = 0;

        parser.addListener("startrule", function(event) {
            count += event.selectors.length;
        });

        parser.addListener("endstylesheet", function() {
            if (count >= 3800) {
                reporter.report("You have " + count + " selectors. Internet Explorer supports a maximum of 4095 selectors per stylesheet. Consider refactoring.", 0, 0, rule);
            }
        });
    }
});

/*
 * Rule: Warn people past the IE 4095 limit
 */

CSSLint.addRule({

    // rule information
    id: "selector-max",
    name: "Error when past the 4095 selector limit for IE",
    desc: "Will error when selector count is > 4095.",
    browsers: "IE",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this, count = 0;

        parser.addListener("startrule", function(event) {
            count += event.selectors.length;
        });

        parser.addListener("endstylesheet", function() {
            if (count > 4095) {
                reporter.report("You have " + count + " selectors. Internet Explorer supports a maximum of 4095 selectors per stylesheet. Consider refactoring.", 0, 0, rule);
            }
        });
    }
});

/*
 * Rule: Avoid new-line characters in selectors.
 */

CSSLint.addRule({

    // rule information
    id: "selector-newline",
    name: "Disallow new-line characters in selectors",
    desc: "New-line characters in selectors are usually a forgotten comma and not a descendant combinator.",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        function startRule(event) {
            var i, len, selector, p, n, pLen, part, part2, type, currentLine, nextLine,
                selectors = event.selectors;

            for (i = 0, len = selectors.length; i < len; i++) {
                selector = selectors[i];
                for (p = 0, pLen = selector.parts.length; p < pLen; p++) {
                    for (n = p + 1; n < pLen; n++) {
                        part = selector.parts[p];
                        part2 = selector.parts[n];
                        type = part.type;
                        currentLine = part.line;
                        nextLine = part2.line;

                        if (type === "descendant" && nextLine > currentLine) {
                            reporter.report("newline character found in selector (forgot a comma?)", currentLine, selectors[i].parts[0].col, rule);
                        }
                    }
                }
            }
        }

        parser.addListener("startrule", startRule);
    }
});

/*
 * Rule: Use shorthand properties where possible.
 *
 */

CSSLint.addRule({

    // rule information
    id: "shorthand",
    name: "Require shorthand properties",
    desc: "Use shorthand properties where possible.",
    url: "https://github.com/CSSLint/csslint/wiki/Require-shorthand-properties",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            prop, i, len,
            propertiesToCheck = {},
            properties,
            mapping = {
                "margin": [
                    "margin-top",
                    "margin-bottom",
                    "margin-left",
                    "margin-right"
                ],
                "padding": [
                    "padding-top",
                    "padding-bottom",
                    "padding-left",
                    "padding-right"
                ]
            };

        // initialize propertiesToCheck
        for (prop in mapping) {
            if (mapping.hasOwnProperty(prop)) {
                for (i=0, len=mapping[prop].length; i < len; i++) {
                    propertiesToCheck[mapping[prop][i]] = prop;
                }
            }
        }

        function startRule() {
            properties = {};
        }

        // event handler for end of rules
        function endRule(event) {

            var prop, i, len, total;

            // check which properties this rule has
            for (prop in mapping) {
                if (mapping.hasOwnProperty(prop)) {
                    total=0;

                    for (i=0, len=mapping[prop].length; i < len; i++) {
                        total += properties[mapping[prop][i]] ? 1 : 0;
                    }

                    if (total === mapping[prop].length) {
                        reporter.report("The properties " + mapping[prop].join(", ") + " can be replaced by " + prop + ".", event.line, event.col, rule);
                    }
                }
            }
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);

        // check for use of "font-size"
        parser.addListener("property", function(event) {
            var name = event.property.toString().toLowerCase();

            if (propertiesToCheck[name]) {
                properties[name] = 1;
            }
        });

        parser.addListener("endrule", endRule);
        parser.addListener("endfontface", endRule);
    }
});

/*
 * Rule: Don't use properties with a star prefix.
 *
 */

CSSLint.addRule({

    // rule information
    id: "star-property-hack",
    name: "Disallow properties with a star prefix",
    desc: "Checks for the star property hack (targets IE6/7)",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-star-hack",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        // check if property name starts with "*"
        parser.addListener("property", function(event) {
            var property = event.property;

            if (property.hack === "*") {
                reporter.report("Property with star prefix found.", event.property.line, event.property.col, rule);
            }
        });
    }
});

/*
 * Rule: Don't use text-indent for image replacement if you need to support rtl.
 *
 */

CSSLint.addRule({

    // rule information
    id: "text-indent",
    name: "Disallow negative text-indent",
    desc: "Checks for text indent less than -99px",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-negative-text-indent",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            textIndent,
            direction;

        function startRule() {
            textIndent = false;
            direction = "inherit";
        }

        // event handler for end of rules
        function endRule() {
            if (textIndent && direction !== "ltr") {
                reporter.report("Negative text-indent doesn't work well with RTL. If you use text-indent for image replacement explicitly set direction for that item to ltr.", textIndent.line, textIndent.col, rule);
            }
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);

        // check for use of "font-size"
        parser.addListener("property", function(event) {
            var name = event.property.toString().toLowerCase(),
                value = event.value;

            if (name === "text-indent" && value.parts[0].value < -99) {
                textIndent = event.property;
            } else if (name === "direction" && value.toString() === "ltr") {
                direction = "ltr";
            }
        });

        parser.addListener("endrule", endRule);
        parser.addListener("endfontface", endRule);
    }
});

/*
 * Rule: Don't use properties with a underscore prefix.
 *
 */

CSSLint.addRule({

    // rule information
    id: "underscore-property-hack",
    name: "Disallow properties with an underscore prefix",
    desc: "Checks for the underscore property hack (targets IE6)",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-underscore-hack",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        // check if property name starts with "_"
        parser.addListener("property", function(event) {
            var property = event.property;

            if (property.hack === "_") {
                reporter.report("Property with underscore prefix found.", event.property.line, event.property.col, rule);
            }
        });
    }
});

/*
 * Rule: Headings (h1-h6) should be defined only once.
 */

CSSLint.addRule({

    // rule information
    id: "unique-headings",
    name: "Headings should only be defined once",
    desc: "Headings should be defined only once.",
    url: "https://github.com/CSSLint/csslint/wiki/Headings-should-only-be-defined-once",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        var headings = {
            h1: 0,
            h2: 0,
            h3: 0,
            h4: 0,
            h5: 0,
            h6: 0
        };

        parser.addListener("startrule", function(event) {
            var selectors = event.selectors,
                selector,
                part,
                pseudo,
                i, j;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];
                part = selector.parts[selector.parts.length-1];

                if (part.elementName && /(h[1-6])/i.test(part.elementName.toString())) {

                    for (j=0; j < part.modifiers.length; j++) {
                        if (part.modifiers[j].type === "pseudo") {
                            pseudo = true;
                            break;
                        }
                    }

                    if (!pseudo) {
                        headings[RegExp.$1]++;
                        if (headings[RegExp.$1] > 1) {
                            reporter.report("Heading (" + part.elementName + ") has already been defined.", part.line, part.col, rule);
                        }
                    }
                }
            }
        });

        parser.addListener("endstylesheet", function() {
            var prop,
                messages = [];

            for (prop in headings) {
                if (headings.hasOwnProperty(prop)) {
                    if (headings[prop] > 1) {
                        messages.push(headings[prop] + " " + prop + "s");
                    }
                }
            }

            if (messages.length) {
                reporter.rollupWarn("You have " + messages.join(", ") + " defined in this stylesheet.", rule);
            }
        });
    }
});

/*
 * Rule: Don't use universal selector because it's slow.
 */

CSSLint.addRule({

    // rule information
    id: "universal-selector",
    name: "Disallow universal selector",
    desc: "The universal selector (*) is known to be slow.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-universal-selector",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        parser.addListener("startrule", function(event) {
            var selectors = event.selectors,
                selector,
                part,
                i;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];

                part = selector.parts[selector.parts.length-1];
                if (part.elementName === "*") {
                    reporter.report(rule.desc, part.line, part.col, rule);
                }
            }
        });
    }
});

/*
 * Rule: Don't use unqualified attribute selectors because they're just like universal selectors.
 */

CSSLint.addRule({

    // rule information
    id: "unqualified-attributes",
    name: "Disallow unqualified attribute selectors",
    desc: "Unqualified attribute selectors are known to be slow.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-unqualified-attribute-selectors",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";

        var rule = this;

        parser.addListener("startrule", function(event) {

            var selectors = event.selectors,
                selectorContainsClassOrId = false,
                selector,
                part,
                modifier,
                i, k;

            for (i=0; i < selectors.length; i++) {
                selector = selectors[i];

                part = selector.parts[selector.parts.length-1];
                if (part.type === parser.SELECTOR_PART_TYPE) {
                    for (k=0; k < part.modifiers.length; k++) {
                        modifier = part.modifiers[k];

                        if (modifier.type === "class" || modifier.type === "id") {
                            selectorContainsClassOrId = true;
                            break;
                        }
                    }

                    if (!selectorContainsClassOrId) {
                        for (k=0; k < part.modifiers.length; k++) {
                            modifier = part.modifiers[k];
                            if (modifier.type === "attribute" && (!part.elementName || part.elementName === "*")) {
                                reporter.report(rule.desc, part.line, part.col, rule);
                            }
                        }
                    }
                }
            }
        });
    }
});

/*
 * Rule: When using a vendor-prefixed property, make sure to
 * include the standard one.
 */

CSSLint.addRule({

    // rule information
    id: "vendor-prefix",
    name: "Require standard property with vendor prefix",
    desc: "When using a vendor-prefixed property, make sure to include the standard one.",
    url: "https://github.com/CSSLint/csslint/wiki/Require-standard-property-with-vendor-prefix",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this,
            properties,
            num,
            propertiesToCheck = {
                "-webkit-border-radius": "border-radius",
                "-webkit-border-top-left-radius": "border-top-left-radius",
                "-webkit-border-top-right-radius": "border-top-right-radius",
                "-webkit-border-bottom-left-radius": "border-bottom-left-radius",
                "-webkit-border-bottom-right-radius": "border-bottom-right-radius",

                "-o-border-radius": "border-radius",
                "-o-border-top-left-radius": "border-top-left-radius",
                "-o-border-top-right-radius": "border-top-right-radius",
                "-o-border-bottom-left-radius": "border-bottom-left-radius",
                "-o-border-bottom-right-radius": "border-bottom-right-radius",

                "-moz-border-radius": "border-radius",
                "-moz-border-radius-topleft": "border-top-left-radius",
                "-moz-border-radius-topright": "border-top-right-radius",
                "-moz-border-radius-bottomleft": "border-bottom-left-radius",
                "-moz-border-radius-bottomright": "border-bottom-right-radius",

                "-moz-column-count": "column-count",
                "-webkit-column-count": "column-count",

                "-moz-column-gap": "column-gap",
                "-webkit-column-gap": "column-gap",

                "-moz-column-rule": "column-rule",
                "-webkit-column-rule": "column-rule",

                "-moz-column-rule-style": "column-rule-style",
                "-webkit-column-rule-style": "column-rule-style",

                "-moz-column-rule-color": "column-rule-color",
                "-webkit-column-rule-color": "column-rule-color",

                "-moz-column-rule-width": "column-rule-width",
                "-webkit-column-rule-width": "column-rule-width",

                "-moz-column-width": "column-width",
                "-webkit-column-width": "column-width",

                "-webkit-column-span": "column-span",
                "-webkit-columns": "columns",

                "-moz-box-shadow": "box-shadow",
                "-webkit-box-shadow": "box-shadow",

                "-moz-transform": "transform",
                "-webkit-transform": "transform",
                "-o-transform": "transform",
                "-ms-transform": "transform",

                "-moz-transform-origin": "transform-origin",
                "-webkit-transform-origin": "transform-origin",
                "-o-transform-origin": "transform-origin",
                "-ms-transform-origin": "transform-origin",

                "-moz-box-sizing": "box-sizing",
                "-webkit-box-sizing": "box-sizing"
            };

        // event handler for beginning of rules
        function startRule() {
            properties = {};
            num = 1;
        }

        // event handler for end of rules
        function endRule() {
            var prop,
                i,
                len,
                needed,
                actual,
                needsStandard = [];

            for (prop in properties) {
                if (propertiesToCheck[prop]) {
                    needsStandard.push({
                        actual: prop,
                        needed: propertiesToCheck[prop]
                    });
                }
            }

            for (i=0, len=needsStandard.length; i < len; i++) {
                needed = needsStandard[i].needed;
                actual = needsStandard[i].actual;

                if (!properties[needed]) {
                    reporter.report("Missing standard property '" + needed + "' to go along with '" + actual + "'.", properties[actual][0].name.line, properties[actual][0].name.col, rule);
                } else {
                    // make sure standard property is last
                    if (properties[needed][0].pos < properties[actual][0].pos) {
                        reporter.report("Standard property '" + needed + "' should come after vendor-prefixed property '" + actual + "'.", properties[actual][0].name.line, properties[actual][0].name.col, rule);
                    }
                }
            }
        }

        parser.addListener("startrule", startRule);
        parser.addListener("startfontface", startRule);
        parser.addListener("startpage", startRule);
        parser.addListener("startpagemargin", startRule);
        parser.addListener("startkeyframerule", startRule);
        parser.addListener("startviewport", startRule);

        parser.addListener("property", function(event) {
            var name = event.property.text.toLowerCase();

            if (!properties[name]) {
                properties[name] = [];
            }

            properties[name].push({
                name: event.property,
                value: event.value,
                pos: num++
            });
        });

        parser.addListener("endrule", endRule);
        parser.addListener("endfontface", endRule);
        parser.addListener("endpage", endRule);
        parser.addListener("endpagemargin", endRule);
        parser.addListener("endkeyframerule", endRule);
        parser.addListener("endviewport", endRule);
    }
});

/*
 * Rule: You don't need to specify units when a value is 0.
 */

CSSLint.addRule({

    // rule information
    id: "zero-units",
    name: "Disallow units for 0 values",
    desc: "You don't need to specify units when a value is 0.",
    url: "https://github.com/CSSLint/csslint/wiki/Disallow-units-for-zero-values",
    browsers: "All",

    // initialization
    init: function(parser, reporter) {
        "use strict";
        var rule = this;

        // count how many times "float" is used
        parser.addListener("property", function(event) {
            var parts = event.value.parts,
                i = 0,
                len = parts.length;

            while (i < len) {
                if ((parts[i].units || parts[i].type === "percentage") && parts[i].value === 0 && parts[i].type !== "time") {
                    reporter.report("Values of 0 shouldn't have units specified.", parts[i].line, parts[i].col, rule);
                }
                i++;
            }
        });
    }
});

(function() {
    "use strict";

    /**
     * Replace special characters before write to output.
     *
     * Rules:
     *  - single quotes is the escape sequence for double-quotes
     *  - &amp; is the escape sequence for &
     *  - &lt; is the escape sequence for <
     *  - &gt; is the escape sequence for >
     *
     * @param {String} message to escape
     * @return escaped message as {String}
     */
    var xmlEscape = function(str) {
        if (!str || str.constructor !== String) {
            return "";
        }

        return str.replace(/["&><]/g, function(match) {
            switch (match) {
                case "\"":
                    return "&quot;";
                case "&":
                    return "&amp;";
                case "<":
                    return "&lt;";
                case ">":
                    return "&gt;";
            }
        });
    };

    CSSLint.addFormatter({
        // format information
        id: "checkstyle-xml",
        name: "Checkstyle XML format",

        /**
         * Return opening root XML tag.
         * @return {String} to prepend before all results
         */
        startFormat: function() {
            return "<?xml version=\"1.0\" encoding=\"utf-8\"?><checkstyle>";
        },

        /**
         * Return closing root XML tag.
         * @return {String} to append after all results
         */
        endFormat: function() {
            return "</checkstyle>";
        },

        /**
         * Returns message when there is a file read error.
         * @param {String} filename The name of the file that caused the error.
         * @param {String} message The error message
         * @return {String} The error message.
         */
        readError: function(filename, message) {
            return "<file name=\"" + xmlEscape(filename) + "\"><error line=\"0\" column=\"0\" severty=\"error\" message=\"" + xmlEscape(message) + "\"></error></file>";
        },

        /**
         * Given CSS Lint results for a file, return output for this format.
         * @param results {Object} with error and warning messages
         * @param filename {String} relative file path
         * @param options {Object} (UNUSED for now) specifies special handling of output
         * @return {String} output for results
         */
        formatResults: function(results, filename/*, options*/) {
            var messages = results.messages,
                output = [];

            /**
             * Generate a source string for a rule.
             * Checkstyle source strings usually resemble Java class names e.g
             * net.csslint.SomeRuleName
             * @param {Object} rule
             * @return rule source as {String}
             */
            var generateSource = function(rule) {
                if (!rule || !("name" in rule)) {
                    return "";
                }
                return "net.csslint." + rule.name.replace(/\s/g, "");
            };

            if (messages.length > 0) {
                output.push("<file name=\""+filename+"\">");
                CSSLint.Util.forEach(messages, function (message) {
                    // ignore rollups for now
                    if (!message.rollup) {
                        output.push("<error line=\"" + message.line + "\" column=\"" + message.col + "\" severity=\"" + message.type + "\"" +
                          " message=\"" + xmlEscape(message.message) + "\" source=\"" + generateSource(message.rule) +"\"/>");
                    }
                });
                output.push("</file>");
            }

            return output.join("");
        }
    });
}());

CSSLint.addFormatter({
    // format information
    id: "compact",
    name: "Compact, 'porcelain' format",

    /**
     * Return content to be printed before all file results.
     * @return {String} to prepend before all results
     */
    startFormat: function() {
        "use strict";
        return "";
    },

    /**
     * Return content to be printed after all file results.
     * @return {String} to append after all results
     */
    endFormat: function() {
        "use strict";
        return "";
    },

    /**
     * Given CSS Lint results for a file, return output for this format.
     * @param results {Object} with error and warning messages
     * @param filename {String} relative file path
     * @param options {Object} (Optional) specifies special handling of output
     * @return {String} output for results
     */
    formatResults: function(results, filename, options) {
        "use strict";
        var messages = results.messages,
            output = "";
        options = options || {};

        /**
         * Capitalize and return given string.
         * @param str {String} to capitalize
         * @return {String} capitalized
         */
        var capitalize = function(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        };

        if (messages.length === 0) {
            return options.quiet ? "" : filename + ": Lint Free!";
        }

        CSSLint.Util.forEach(messages, function(message) {
            if (message.rollup) {
                output += filename + ": " + capitalize(message.type) + " - " + message.message + " (" + message.rule.id + ")\n";
            } else {
                output += filename + ": line " + message.line +
                    ", col " + message.col + ", " + capitalize(message.type) + " - " + message.message + " (" + message.rule.id + ")\n";
            }
        });

        return output;
    }
});

CSSLint.addFormatter({
    // format information
    id: "csslint-xml",
    name: "CSSLint XML format",

    /**
     * Return opening root XML tag.
     * @return {String} to prepend before all results
     */
    startFormat: function() {
        "use strict";
        return "<?xml version=\"1.0\" encoding=\"utf-8\"?><csslint>";
    },

    /**
     * Return closing root XML tag.
     * @return {String} to append after all results
     */
    endFormat: function() {
        "use strict";
        return "</csslint>";
    },

    /**
     * Given CSS Lint results for a file, return output for this format.
     * @param results {Object} with error and warning messages
     * @param filename {String} relative file path
     * @param options {Object} (UNUSED for now) specifies special handling of output
     * @return {String} output for results
     */
    formatResults: function(results, filename/*, options*/) {
        "use strict";
        var messages = results.messages,
            output = [];

        /**
         * Replace special characters before write to output.
         *
         * Rules:
         *  - single quotes is the escape sequence for double-quotes
         *  - &amp; is the escape sequence for &
         *  - &lt; is the escape sequence for <
         *  - &gt; is the escape sequence for >
         *
         * @param {String} message to escape
         * @return escaped message as {String}
         */
        var escapeSpecialCharacters = function(str) {
            if (!str || str.constructor !== String) {
                return "";
            }
            return str.replace(/"/g, "'").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        };

        if (messages.length > 0) {
            output.push("<file name=\""+filename+"\">");
            CSSLint.Util.forEach(messages, function (message) {
                if (message.rollup) {
                    output.push("<issue severity=\"" + message.type + "\" reason=\"" + escapeSpecialCharacters(message.message) + "\" evidence=\"" + escapeSpecialCharacters(message.evidence) + "\"/>");
                } else {
                    output.push("<issue line=\"" + message.line + "\" char=\"" + message.col + "\" severity=\"" + message.type + "\"" +
                        " reason=\"" + escapeSpecialCharacters(message.message) + "\" evidence=\"" + escapeSpecialCharacters(message.evidence) + "\"/>");
                }
            });
            output.push("</file>");
        }

        return output.join("");
    }
});

/* globals JSON: true */

CSSLint.addFormatter({
    // format information
    id: "json",
    name: "JSON",

    /**
     * Return content to be printed before all file results.
     * @return {String} to prepend before all results
     */
    startFormat: function() {
        "use strict";
        this.json = [];
        return "";
    },

    /**
     * Return content to be printed after all file results.
     * @return {String} to append after all results
     */
    endFormat: function() {
        "use strict";
        var ret = "";
        if (this.json.length > 0) {
            if (this.json.length === 1) {
                ret = JSON.stringify(this.json[0]);
            } else {
                ret = JSON.stringify(this.json);
            }
        }
        return ret;
    },

    /**
     * Given CSS Lint results for a file, return output for this format.
     * @param results {Object} with error and warning messages
     * @param filename {String} relative file path (Unused)
     * @return {String} output for results
     */
    formatResults: function(results, filename, options) {
        "use strict";
        if (results.messages.length > 0 || !options.quiet) {
            this.json.push({
                filename: filename,
                messages: results.messages,
                stats: results.stats
            });
        }
        return "";
    }
});

CSSLint.addFormatter({
    // format information
    id: "junit-xml",
    name: "JUNIT XML format",

    /**
     * Return opening root XML tag.
     * @return {String} to prepend before all results
     */
    startFormat: function() {
        "use strict";
        return "<?xml version=\"1.0\" encoding=\"utf-8\"?><testsuites>";
    },

    /**
     * Return closing root XML tag.
     * @return {String} to append after all results
     */
    endFormat: function() {
        "use strict";
        return "</testsuites>";
    },

    /**
     * Given CSS Lint results for a file, return output for this format.
     * @param results {Object} with error and warning messages
     * @param filename {String} relative file path
     * @param options {Object} (UNUSED for now) specifies special handling of output
     * @return {String} output for results
     */
    formatResults: function(results, filename/*, options*/) {
        "use strict";

        var messages = results.messages,
            output = [],
            tests = {
                "error": 0,
                "failure": 0
            };

        /**
         * Generate a source string for a rule.
         * JUNIT source strings usually resemble Java class names e.g
         * net.csslint.SomeRuleName
         * @param {Object} rule
         * @return rule source as {String}
         */
        var generateSource = function(rule) {
            if (!rule || !("name" in rule)) {
                return "";
            }
            return "net.csslint." + rule.name.replace(/\s/g, "");
        };

        /**
         * Replace special characters before write to output.
         *
         * Rules:
         *  - single quotes is the escape sequence for double-quotes
         *  - &lt; is the escape sequence for <
         *  - &gt; is the escape sequence for >
         *
         * @param {String} message to escape
         * @return escaped message as {String}
         */
        var escapeSpecialCharacters = function(str) {

            if (!str || str.constructor !== String) {
                return "";
            }

            return str.replace(/"/g, "'").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        };

        if (messages.length > 0) {

            messages.forEach(function (message) {

                // since junit has no warning class
                // all issues as errors
                var type = message.type === "warning" ? "error" : message.type;

                // ignore rollups for now
                if (!message.rollup) {

                    // build the test case separately, once joined
                    // we'll add it to a custom array filtered by type
                    output.push("<testcase time=\"0\" name=\"" + generateSource(message.rule) + "\">");
                    output.push("<" + type + " message=\"" + escapeSpecialCharacters(message.message) + "\"><![CDATA[" + message.line + ":" + message.col + ":" + escapeSpecialCharacters(message.evidence) + "]]></" + type + ">");
                    output.push("</testcase>");

                    tests[type] += 1;
                }
            });

            output.unshift("<testsuite time=\"0\" tests=\"" + messages.length + "\" skipped=\"0\" errors=\"" + tests.error + "\" failures=\"" + tests.failure + "\" package=\"net.csslint\" name=\"" + filename + "\">");
            output.push("</testsuite>");
        }

        return output.join("");
    }
});

CSSLint.addFormatter({
    // format information
    id: "lint-xml",
    name: "Lint XML format",

    /**
     * Return opening root XML tag.
     * @return {String} to prepend before all results
     */
    startFormat: function() {
        "use strict";
        return "<?xml version=\"1.0\" encoding=\"utf-8\"?><lint>";
    },

    /**
     * Return closing root XML tag.
     * @return {String} to append after all results
     */
    endFormat: function() {
        "use strict";
        return "</lint>";
    },

    /**
     * Given CSS Lint results for a file, return output for this format.
     * @param results {Object} with error and warning messages
     * @param filename {String} relative file path
     * @param options {Object} (UNUSED for now) specifies special handling of output
     * @return {String} output for results
     */
    formatResults: function(results, filename/*, options*/) {
        "use strict";
        var messages = results.messages,
            output = [];

        /**
         * Replace special characters before write to output.
         *
         * Rules:
         *  - single quotes is the escape sequence for double-quotes
         *  - &amp; is the escape sequence for &
         *  - &lt; is the escape sequence for <
         *  - &gt; is the escape sequence for >
         *
         * @param {String} message to escape
         * @return escaped message as {String}
         */
        var escapeSpecialCharacters = function(str) {
            if (!str || str.constructor !== String) {
                return "";
            }
            return str.replace(/"/g, "'").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        };

        if (messages.length > 0) {

            output.push("<file name=\""+filename+"\">");
            CSSLint.Util.forEach(messages, function (message) {
                if (message.rollup) {
                    output.push("<issue severity=\"" + message.type + "\" reason=\"" + escapeSpecialCharacters(message.message) + "\" evidence=\"" + escapeSpecialCharacters(message.evidence) + "\"/>");
                } else {
                    var rule = "";
                    if (message.rule && message.rule.id) {
                        rule = "rule=\"" + escapeSpecialCharacters(message.rule.id) + "\" ";
                    }
                    output.push("<issue " + rule + "line=\"" + message.line + "\" char=\"" + message.col + "\" severity=\"" + message.type + "\"" +
                        " reason=\"" + escapeSpecialCharacters(message.message) + "\" evidence=\"" + escapeSpecialCharacters(message.evidence) + "\"/>");
                }
            });
            output.push("</file>");
        }

        return output.join("");
    }
});

CSSLint.addFormatter({
    // format information
    id: "text",
    name: "Plain Text",

    /**
     * Return content to be printed before all file results.
     * @return {String} to prepend before all results
     */
    startFormat: function() {
        "use strict";
        return "";
    },

    /**
     * Return content to be printed after all file results.
     * @return {String} to append after all results
     */
    endFormat: function() {
        "use strict";
        return "";
    },

    /**
     * Given CSS Lint results for a file, return output for this format.
     * @param results {Object} with error and warning messages
     * @param filename {String} relative file path
     * @param options {Object} (Optional) specifies special handling of output
     * @return {String} output for results
     */
    formatResults: function(results, filename, options) {
        "use strict";
        var messages = results.messages,
            output = "";
        options = options || {};

        if (messages.length === 0) {
            return options.quiet ? "" : "\n\ncsslint: No errors in " + filename + ".";
        }

        output = "\n\ncsslint: There ";
        if (messages.length === 1) {
            output += "is 1 problem";
        } else {
            output += "are " + messages.length + " problems";
        }
        output += " in " + filename + ".";

        var pos = filename.lastIndexOf("/"),
            shortFilename = filename;

        if (pos === -1) {
            pos = filename.lastIndexOf("\\");
        }
        if (pos > -1) {
            shortFilename = filename.substring(pos+1);
        }

        CSSLint.Util.forEach(messages, function (message, i) {
            output = output + "\n\n" + shortFilename;
            if (message.rollup) {
                output += "\n" + (i+1) + ": " + message.type;
                output += "\n" + message.message;
            } else {
                output += "\n" + (i+1) + ": " + message.type + " at line " + message.line + ", col " + message.col;
                output += "\n" + message.message;
                output += "\n" + message.evidence;
            }
        });

        return output;
    }
});

return CSSLint;
})();
local.CSSLint = CSSLint;
/* jslint ignore:end */



// jslint-hack - var
var jslint_extra;
var jslint_result;
var line_ignore;
var lines_extra;
/*
file https://github.com/douglascrockford/JSLint/blob/ea8401c6a72e21d66f49766af692b09e81d7a79f/jslint.js
*/
/* jslint utility2:true */
var next_line_extra = null;
var warn_at_extra = null;
// jslint.js
// 2019-01-31
// Copyright (c) 2015 Douglas Crockford  (www.JSLint.com)

// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:

// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.

// The Software shall be used for Good, not Evil.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.

// jslint(source, option_object, global_array) is a function that takes 3
// arguments. The second two arguments are optional.

//      source          A text to analyze, a string or an array of strings.
//      option_object   An object whose keys correspond to option names.
//      global_array    An array of strings containing global variables that
//                      the file is allowed readonly access.

// jslint returns an object containing its results. The object contains a lot
// of valuable information. It can be used to generate reports. The object
// contains:

//      directives: an array of directive comment tokens.
//      edition: the version of JSLint that did the analysis.
//      exports: the names exported from the module.
//      froms: an array of strings representing each of the imports.
//      functions: an array of objects that represent all of the functions
//              declared in the file.
//      global: an object representing the global object. Its .context property
//              is an object containing a property for each global variable.
//      id: "(JSLint)"
//      json: true if the file is a JSON text.
//      lines: an array of strings, the source.
//      module: true if an import or export statement was used.
//      ok: true if no warnings were generated. This is what you want.
//      option: the option argument.
//      property: a property object.
//      stop: true if JSLint was unable to finish. You don't want this.
//      tokens: an array of objects representing the tokens in the file.
//      tree: the token objects arranged in a tree.
//      warnings: an array of warning objects. A warning object can contain:
//          name: "JSLintError"
//          column: A column number in the file.
//          line: A line number in the file.
//          code: A warning code string.
//          message: The warning message string.
//          a: Exhibit A.
//          b: Exhibit B.
//          c: Exhibit C.
//          d: Exhibit D.

// jslint works in several phases. In any of these phases, errors might be
// found. Sometimes JSLint is able to recover from an error and continue
// parsing. In some cases, it cannot and will stop early. If that should happen,
// repair your code and try again.

// Phases:

//      1. If the source is a single string, split it into an array of strings.
//      2. Turn the source into an array of tokens.
//      3. Furcate the tokens into a parse tree.
//      4. Walk the tree, traversing all of the nodes of the tree. It is a
//          recursive traversal. Each node may be processed on the way down
//          (preaction) and on the way up (postaction).
//      5. Check the whitespace between the tokens.

// jslint can also examine JSON text. It decides that a file is JSON text if
// the first token is "[" or "{". Processing of JSON text is much simpler than
// the processing of JavaScript programs. Only the first three phases are
// required.

// WARNING: JSLint will hurt your feelings.

// jslint-hack - property
/*\property
    a, and, arity, assign, b, bad_assignment_a, bad_directive_a, bad_get,
    bad_module_name_a, bad_option_a, bad_property_a, bad_set, bitwise, block,
    body, browser, c, calls, catch, charCodeAt, closer, closure, code, column,
    concat, constant, context, convert, couch, create, d, dead, default, devel,
    directive, directives, disrupt, dot, duplicate_a, edition, ellipsis, else,
    empty_block, escape_mega, eval, every, expected_a, expected_a_at_b_c,
    expected_a_b, expected_a_b_from_c_d, expected_a_before_b,
    expected_a_next_at_b, expected_digits_after_a, expected_four_digits,
    expected_identifier_a, expected_line_break_a_b, expected_regexp_factor_a,
    expected_space_a_b, expected_statements_a, expected_string_a,
    expected_type_string_a, exports, expression, extra, finally, flag, for,
    forEach, free, freeze, freeze_exports, from, froms, fud, fudge,
    function_in_loop, functions, g, getset, global, i, id, identifier, import,
    inc, indexOf, infix_in, init, initial, isArray, isNaN, join, json, keys,
    label, label_a, lbp, led, length, level, line, lines, live, long, loop, m,
    margin, match, message, misplaced_a, misplaced_directive_a, missing_browser,
    missing_m, module, naked_block, name, names, nested_comment, new, node,
    not_label_a, nr, nud, number_isNaN, ok, open, opening, option,
    out_of_scope_a, parameters, parent, pop, property, push, quote,
    redefinition_a_b, replace, required_a_optional_b, reserved_a, role, search,
    shebang, signature, single, slice, some, sort, split, startsWith, statement,
    stop, subscript_a, switch, test, this, thru, toString, todo_comment,
    tokens, too_long, too_many_digits, tree, try, type, u, unclosed_comment,
    unclosed_mega, unclosed_string, undeclared_a, unexpected_a,
    unexpected_a_after_b, unexpected_a_before_b, unexpected_at_top_level_a,
    unexpected_char_a, unexpected_comment, unexpected_directive_a,
    unexpected_expression_a, unexpected_label_a, unexpected_parens,
    unexpected_space_a_b, unexpected_statement_a, unexpected_trailing_space,
    unexpected_typeof_a, uninitialized_a, unreachable_a,
    unregistered_property_a, unsafe, unused_a, use_double, use_open, use_spaces,
    used, value, var_loop, var_switch, variable, warning, warnings,
    weird_condition_a, weird_expression_a, weird_loop, weird_relation_a, white,
    wrap_condition, wrap_immediate, wrap_parameter, wrap_regexp, wrap_unary,
    wrapped, writable, y
*/

function empty() {

// The empty function produces a new empty object that inherits nothing. This is
// much better than '{}' because confusions around accidental method names like
// 'constructor' are completely avoided.

    return Object.create(null);
}

function populate(array, object = empty(), value = true) {

// Augment an object by taking property names from an array of strings.

    array.forEach(function (name) {
        object[name] = value;
    });
    return object;
}

var allowed_option = {

// These are the options that are recognized in the option object or that may
// appear in a /*jslint*/ directive. Most options will have a boolean value,
// usually true. Some options will also predefine some number of global
// variables.

    bitwise: true,
    browser: [
        "caches", "clearInterval", "clearTimeout", "document", "DOMException",
        "Element", "Event", "event", "FileReader", "FormData", "history",
        "localStorage", "location", "MutationObserver", "name", "navigator",
        "screen", "sessionStorage", "setInterval", "setTimeout", "Storage",
        "TextDecoder", "TextEncoder", "URL", "window", "Worker",
        "XMLHttpRequest"
    ],
    couch: [
        "emit", "getRow", "isArray", "log", "provides", "registerType",
        "require", "send", "start", "sum", "toJSON"
    ],
    convert: true,
    devel: [
        "alert", "confirm", "console", "prompt"
    ],
    eval: true,
    for: true,
    fudge: true,
    getset: true,
    long: true,
    node: [
        "Buffer", "clearImmediate", "clearInterval", "clearTimeout",
        "console", "exports", "module", "process", "require",
        "setImmediate", "setInterval", "setTimeout", "TextDecoder",
        "TextEncoder", "URL", "URLSearchParams", "__dirname", "__filename"
    ],
    single: true,
    this: true,
    white: true
};

var anticondition = populate([
    "?", "~", "&", "|", "^", "<<", ">>", ">>>", "+", "-", "*", "/", "%",
    "typeof", "(number)", "(string)"
]);

// These are the bitwise operators.

var bitwiseop = populate([
    "~", "^", "^=", "&", "&=", "|", "|=", "<<", "<<=", ">>", ">>=",
    ">>>", ">>>="
]);

var escapeable = populate([
    "\\", "/", "`", "b", "f", "n", "r", "t"
]);

var opener = {

// The open and close pairs.

    "(": ")", // paren
    "[": "]", // bracket
    "{": "}", // brace
    "${": "}" // mega
};

// The relational operators.

var relationop = populate([
    "!=", "!==", "==", "===", "<", "<=", ">", ">="
]);

// This is the set of infix operators that require a space on each side.

var spaceop = populate([
    "!=", "!==", "%", "%=", "&", "&=", "&&", "*", "*=", "+=", "-=", "/",
    "/=", "<", "<=", "<<", "<<=", "=", "==", "===", "=>", ">", ">=",
    ">>", ">>=", ">>>", ">>>=", "^", "^=", "|", "|=", "||"
]);

var standard = [

// These are the globals that are provided by the language standard.

    "Array", "ArrayBuffer", "Boolean", "DataView", "Date", "decodeURI",
    "decodeURIComponent", "encodeURI", "encodeURIComponent", "Error",
    "EvalError", "Float32Array", "Float64Array", "Generator",
    "GeneratorFunction", "Int8Array", "Int16Array", "Int32Array", "Intl",
    "JSON", "Map", "Math", "Number", "Object", "parseInt", "parseFloat",
    "Promise", "Proxy", "RangeError", "ReferenceError", "Reflect", "RegExp",
    "Set", "String", "Symbol", "SyntaxError", "System", "TypeError",
    "Uint8Array", "Uint8ClampedArray", "Uint16Array", "Uint32Array",
    "URIError", "WeakMap", "WeakSet"
];

var bundle = {

// The bundle contains the raw text messages that are generated by jslint. It
// seems that they are all error messages and warnings. There are no "Atta
// boy!" or "You are so awesome!" messages. There is no positive reinforcement
// or encouragement. This relentless negativity can undermine self-esteem and
// wound the inner child. But if you accept it as sound advice rather than as
// personal criticism, it can make your programs better.

    and: "The '&&' subexpression should be wrapped in parens.",
    bad_assignment_a: "Bad assignment to '{a}'.",
    bad_directive_a: "Bad directive '{a}'.",
    bad_get: "A get function takes no parameters.",
    bad_module_name_a: "Bad module name '{a}'.",
    bad_option_a: "Bad option '{a}'.",
    bad_property_a: "Bad property name '{a}'.",
    bad_set: "A set function takes one parameter.",
    duplicate_a: "Duplicate '{a}'.",
    empty_block: "Empty block.",
    escape_mega: "Unexpected escapement in mega literal.",
    expected_a: "Expected '{a}'.",
    expected_a_at_b_c: "Expected '{a}' at column {b}, not column {c}.",
    expected_a_b: "Expected '{a}' and instead saw '{b}'.",
    expected_a_b_from_c_d: (
        "Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'."
    ),
    expected_a_before_b: "Expected '{a}' before '{b}'.",
    expected_a_next_at_b: "Expected '{a}' at column {b} on the next line.",
    expected_digits_after_a: "Expected digits after '{a}'.",
    expected_four_digits: "Expected four digits after '\\u'.",
    expected_identifier_a: "Expected an identifier and instead saw '{a}'.",
    expected_line_break_a_b: "Expected a line break between '{a}' and '{b}'.",
    expected_regexp_factor_a: "Expected a regexp factor and instead saw '{a}'.",
    expected_space_a_b: "Expected one space between '{a}' and '{b}'.",
    expected_statements_a: "Expected statements before '{a}'.",
    expected_string_a: "Expected a string and instead saw '{a}'.",
    expected_type_string_a: "Expected a type string and instead saw '{a}'.",
    freeze_exports: (
        "Expected 'Object.freeze('. All export values should be frozen."
    ),
    function_in_loop: "Don't make functions within a loop.",
    infix_in: (
        "Unexpected 'in'. Compare with undefined, "
        + "or use the hasOwnProperty method instead."
    ),
    label_a: "'{a}' is a statement label.",
    misplaced_a: "Place '{a}' at the outermost level.",
    misplaced_directive_a: (
        "Place the '/*{a}*/' directive before the first statement."
    ),
    missing_browser: "/*global*/ requires the Assume a browser option.",
    missing_m: "Expected 'm' flag on a multiline regular expression.",
    naked_block: "Naked block.",
    nested_comment: "Nested comment.",
    not_label_a: "'{a}' is not a label.",
    number_isNaN: "Use Number.isNaN function to compare with NaN.",
    out_of_scope_a: "'{a}' is out of scope.",
    redefinition_a_b: "Redefinition of '{a}' from line {b}.",
    required_a_optional_b: (
        "Required parameter '{a}' after optional parameter '{b}'."
    ),
    reserved_a: "Reserved name '{a}'.",
    subscript_a: "['{a}'] is better written in dot notation.",
    todo_comment: "Unexpected TODO comment.",
    too_long: "Line is longer than 80 characters.",
    too_many_digits: "Too many digits.",
    unclosed_comment: "Unclosed comment.",
    unclosed_mega: "Unclosed mega literal.",
    unclosed_string: "Unclosed string.",
    undeclared_a: "Undeclared '{a}'.",
    unexpected_a: "Unexpected '{a}'.",
    unexpected_a_after_b: "Unexpected '{a}' after '{b}'.",
    unexpected_a_before_b: "Unexpected '{a}' before '{b}'.",
    unexpected_at_top_level_a: "Expected '{a}' to be in a function.",
    unexpected_char_a: "Unexpected character '{a}'.",
    unexpected_comment: "Unexpected comment.",
    unexpected_directive_a: "When using modules, don't use directive '/*{a}'.",
    unexpected_expression_a: (
        "Unexpected expression '{a}' in statement position."
    ),
    unexpected_label_a: "Unexpected label '{a}'.",
    unexpected_parens: "Don't wrap function literals in parens.",
    unexpected_space_a_b: "Unexpected space between '{a}' and '{b}'.",
    unexpected_statement_a: (
        "Unexpected statement '{a}' in expression position."
    ),
    unexpected_trailing_space: "Unexpected trailing space.",
    unexpected_typeof_a: (
        "Unexpected 'typeof'. Use '===' to compare directly with {a}."
    ),
    uninitialized_a: "Uninitialized '{a}'.",
    unreachable_a: "Unreachable '{a}'.",
    unregistered_property_a: "Unregistered property name '{a}'.",
    unsafe: "Unsafe character '{a}'.",
    unused_a: "Unused '{a}'.",
    use_double: "Use double quotes, not single quotes.",
    use_open: (
        "Wrap a ternary expression in parens, "
        + "with a line break after the left paren."
    ),
    use_spaces: "Use spaces, not tabs.",
    var_loop: "Don't declare variables in a loop.",
    var_switch: "Don't declare variables in a switch.",
    weird_condition_a: "Weird condition '{a}'.",
    weird_expression_a: "Weird expression '{a}'.",
    weird_loop: "Weird loop.",
    weird_relation_a: "Weird relation '{a}'.",
    wrap_condition: "Wrap the condition in parens.",
    wrap_immediate: (
        "Wrap an immediate function invocation in parentheses to assist "
        + "the reader in understanding that the expression is the result "
        + "of a function, and not the function itself."
    ),
    wrap_parameter: "Wrap the parameter in parens.",
    wrap_regexp: "Wrap this regexp in parens to avoid confusion.",
    wrap_unary: "Wrap the unary expression in parens."
};

// Regular expression literals:

// supplant {variables}
var rx_supplant = (
    /\{([^{}]*)\}/g
);
// carriage return, carriage return linefeed, or linefeed
var rx_crlf = (
    /\n|\r\n?/
);
// unsafe characters that are silently deleted by one or more browsers
var rx_unsafe = (
    /[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/
);
// identifier
var rx_identifier = (
    /^([a-zA-Z_$][a-zA-Z0-9_$]*)$/
);
var rx_module = (
    /^[a-zA-Z0-9_$:.@\-\/]+$/
);
var rx_bad_property = (
    /^_|\$|Sync\$|_$/
);
// star slash
var rx_star_slash = (
    /\*\//
);
// slash star
var rx_slash_star = (
    /\/\*/
);
// slash star or ending slash
var rx_slash_star_or_slash = (
    /\/\*|\/$/
);
// uncompleted work comment
var rx_todo = (
    /\b(?:todo|TO\s?DO|HACK)\b/
);
// tab
var rx_tab = (
    /\t/g
);
// directive
var rx_directive = (
    /^(jslint|property|global)\s+(.*)$/
);
var rx_directive_part = (
    /^([a-zA-Z$_][a-zA-Z0-9$_]*)(?::\s*(true|false))?,?\s*(.*)$/
);
// token (sorry it is so long)
var rx_token = (
    /^((\s+)|([a-zA-Z_$][a-zA-Z0-9_$]*)|[(){}\[\],:;'"~`]|\?\.?|=(?:==?|>)?|\.+|[*\/][*\/=]?|\+[=+]?|-[=\-]?|[\^%]=?|&[&=]?|\|[|=]?|>{1,3}=?|<<?=?|!(?:!|==?)?|(0|[1-9][0-9]*))(.*)$/
);
var rx_digits = (
    /^([0-9]+)(.*)$/
);
var rx_hexs = (
    /^([0-9a-fA-F]+)(.*)$/
);
var rx_octals = (
    /^([0-7]+)(.*)$/
);
var rx_bits = (
    /^([01]+)(.*)$/
);
// mega
var rx_mega = (
    /[`\\]|\$\{/
);
// JSON number
var rx_JSON_number = (
    /^-?\d+(?:\.\d*)?(?:e[\-+]?\d+)?$/i
);
// initial cap
var rx_cap = (
    /^[A-Z]/
);

function is_letter(string) {
    return (
        (string >= "a" && string <= "z\uffff")
        || (string >= "A" && string <= "Z\uffff")
    );
}

function supplant(string, object) {
    return string.replace(rx_supplant, function (found, filling) {
        var replacement = object[filling];
        return (
            replacement !== undefined
            ? replacement
            : found
        );
    });
}

var anon; // The guessed name for anonymous functions.
var block_stack; // The stack of blocks.
var blockage; // The current block.
var declared_globals; // The object containing the global declarations.
var directive_mode; // true if directives are still allowed.
var directives; // The directive comments.
var early_stop; // true if JSLint cannot finish.
var exports; // The exported names and values.
var froms; // The array collecting all import-from strings.
var fudge; // true if the natural numbers start with 1.
var functionage; // The current function.
var functions; // The array containing all of the functions.
var global; // The global object; the outermost context.
var json_mode; // true if parsing JSON.
var lines; // The array containing source lines.
var mega_mode; // true if currently parsing a megastring literal.
var module_mode; // true if import or export was used.
var next_token; // The next token to be examined in the parse.
var option; // The options parameter.
var property; // The object containing the tallied property names.
var shebang; // true if a #! was seen on the first line.
var stack; // The stack of functions.
var syntax; // The object containing the parser.
var tenure; // The predefined property registry.
var token; // The current token being examined in the parse.
var token_nr; // The number of the next token.
var tokens; // The array of tokens.
var tree; // The abstract parse tree.
var var_mode; // "var" if using var; "let" if using let.
var warnings; // The array collecting all generated warnings.

// Error reportage functions:

function artifact(the_token) {

// Return a string representing an artifact.

    if (the_token === undefined) {
        the_token = next_token;
    }
    return (
        (the_token.id === "(string)" || the_token.id === "(number)")
        ? String(the_token.value)
        : the_token.id
    );
}

function artifact_line(the_token) {

// Return the fudged line number of an artifact.

    if (the_token === undefined) {
        the_token = next_token;
    }
    return the_token.line + fudge;
}

function artifact_column(the_token) {

// Return the fudged column number of an artifact.

    if (the_token === undefined) {
        the_token = next_token;
    }
    return the_token.from + fudge;
}

function warn_at(code, line, column, a, b, c, d) {

// Report an error at some line and column of the program. The warning object
// resembles an exception.

    var warning = {
        // ~~
        name: "JSLintError",
        column,
        line,
        code
    };
    if (a !== undefined) {
        warning.a = a;
    }
    if (b !== undefined) {
        warning.b = b;
    }
    if (c !== undefined) {
        warning.c = c;
    }
    if (d !== undefined) {
        warning.d = d;
    }
    warning.message = supplant(bundle[code] || code, warning);
    // jslint-hack - warn_at_extra
    warn_at_extra(warning, warnings);
    return warning;
}

function stop_at(code, line, column, a, b, c, d) {

// Same as warn_at, except that it stops the analysis.

    // jslint-hack - early_stop = true
    early_stop = true;
    throw warn_at(code, line, column, a, b, c, d);
}

function warn(code, the_token, a, b, c, d) {

// Same as warn_at, except the warning will be associated with a specific token.
// If there is already a warning on this token, suppress the new one. It is
// likely that the first warning will be the most meaningful.

    if (the_token === undefined) {
        the_token = next_token;
    }
    if (the_token.warning === undefined) {
        the_token.warning = warn_at(
            code,
            the_token.line,
            the_token.from,
            a || artifact(the_token),
            b,
            c,
            // jslint-hack - the_token
            d || the_token
        );
        return the_token.warning;
    }
}

function stop(code, the_token, a, b, c, d) {

// Similar to warn and stop_at. If the token already had a warning, that
// warning will be replaced with this new one. It is likely that the stopping
// warning will be the more meaningful.

    if (the_token === undefined) {
        the_token = next_token;
    }
    delete the_token.warning;
    // jslint-hack - early_stop = true
    early_stop = true;
    throw warn(code, the_token, a, b, c, d);
}

// Tokenize:

function tokenize(source) {

// tokenize takes a source and produces from it an array of token objects.
// JavaScript is notoriously difficult to tokenize because of the horrible
// interactions between automatic semicolon insertion, regular expression
// literals, and now megastring literals. JSLint benefits from eliminating
// automatic semicolon insertion and nested megastring literals, which allows
// full tokenization to precede parsing.

// If the source is not an array, then it is split into lines at the
// carriage return/linefeed.

    lines = (
        Array.isArray(source)
        ? source
        : source.split(rx_crlf)
    );
    tokens = [];

    var char; // a popular character
    var column = 0; // the column number of the next character
    var first; // the first token
    var from; // the starting column number of the token
    var line = -1; // the line number of the next character
    var nr = 0; // the next token number
    var previous = global; // the previous token including comments
    var prior = global; // the previous token excluding comments
    var mega_from; // the starting column of megastring
    var mega_line; // the starting line of megastring
    var regexp_seen; // regular expression literal seen on this line
    var snippet; // a piece of string
    var source_line = ""; // the remaining line source string
    var whole_line = ""; // the whole line source string

    if (lines[0].startsWith("#!")) {
        line = 0;
        shebang = true;
    }

    function next_line() {

// Put the next line of source in source_line. If the line contains tabs,
// replace them with spaces and give a warning. Also warn if the line contains
// unsafe characters or is too damn long.

        var at;
        if (
            !option.long
            && whole_line.length > 80
            && !json_mode
            && first
            && !regexp_seen
        ) {
            warn_at("too_long", line, 80);
        }
        column = 0;
        line += 1;
        regexp_seen = false;
        source_line = lines[line];
        whole_line = source_line || "";
        if (source_line !== undefined) {
            // jslint-hack - next_line_extra
            source_line = next_line_extra(source_line, line);
            at = source_line.search(rx_tab);
            if (at >= 0) {
                if (!option.white) {
                    warn_at("use_spaces", line, at + 1);
                }
                source_line = source_line.replace(rx_tab, " ");
            }
            at = source_line.search(rx_unsafe);
            if (at >= 0) {
                warn_at(
                    "unsafe",
                    line,
                    column + at,
                    "U+" + source_line.charCodeAt(at).toString(16)
                );
            }
            if (!option.white && source_line.slice(-1) === " ") {
                warn_at(
                    "unexpected_trailing_space",
                    line,
                    source_line.length - 1
                );
            }
        }
        return source_line;
    }

// Most tokens, including the identifiers, operators, and punctuators, can be
// found with a regular expression. Regular expressions cannot correctly match
// regular expression literals, so we will match those the hard way. String
// literals and number literals can be matched by regular expressions, but they
// don't provide good warnings. The functions snip, next_char, prev_char,
// some_digits, and escape help in the parsing of literals.

    function snip() {

// Remove the last character from snippet.

        snippet = snippet.slice(0, -1);
    }

    function next_char(match) {

// Get the next character from the source line. Remove it from the source_line,
// and append it to the snippet. Optionally check that the previous character
// matched an expected value.

        if (match !== undefined && char !== match) {
            return stop_at((
                char === ""
                ? "expected_a"
                : "expected_a_b"
            ), line, column - 1, match, char);
        }
        if (source_line) {
            char = source_line[0];
            source_line = source_line.slice(1);
            snippet += char;
        } else {
            char = "";
            snippet += " ";
        }
        column += 1;
        return char;
    }

    function back_char() {

// Back up one character by moving a character from the end of the snippet to
// the front of the source_line.

        if (snippet) {
            char = snippet.slice(-1);
            source_line = char + source_line;
            column -= 1;
            snip();
        } else {
            char = "";
        }
        return char;
    }

    function some_digits(rx, quiet) {
        var result = source_line.match(rx);
        if (result) {
            char = result[1];
            column += char.length;
            source_line = result[2];
            snippet += char;
        } else {
            char = "";
            if (!quiet) {
                warn_at(
                    "expected_digits_after_a",
                    line,
                    column,
                    snippet
                );
            }
        }
        return char.length;
    }

    function escape(extra) {
        next_char("\\");
        if (escapeable[char] === true) {
            return next_char();
        }
        if (char === "") {
            return stop_at("unclosed_string", line, column);
        }
        if (char === "u") {
            if (next_char("u") === "{") {
                if (json_mode) {
                    warn_at("unexpected_a", line, column - 1, char);
                }
                if (some_digits(rx_hexs) > 5) {
                    warn_at("too_many_digits", line, column - 1);
                }
                if (next_char() !== "}") {
                    stop_at("expected_a_before_b", line, column, "}", char);
                }
                return next_char();
            }
            back_char();
            if (some_digits(rx_hexs, true) < 4) {
                warn_at("expected_four_digits", line, column - 1);
            }
            return;
        }
        if (extra && extra.indexOf(char) >= 0) {
            return next_char();
        }
        warn_at("unexpected_a_before_b", line, column - 2, "\\", char);
    }

    function make(id, value, identifier) {

// Make the token object and append it to the tokens list.

        var the_token = {
            from,
            id,
            identifier: Boolean(identifier),
            line,
            nr,
            thru: column
        };
        tokens[nr] = the_token;
        nr += 1;

// Directives must appear before the first statement.

        if (id !== "(comment)" && id !== ";") {
            directive_mode = false;
        }

// If the token is to have a value, give it one.

        if (value !== undefined) {
            the_token.value = value;
        }

// If this token is an identifier that touches a preceding number, or
// a "/", comment, or regular expression literal that touches a preceding
// comment or regular expression literal, then give a missing space warning.
// This warning is not suppressed by option.white.

        if (
            previous.line === line
            && previous.thru === from
            && (id === "(comment)" || id === "(regexp)" || id === "/")
            && (previous.id === "(comment)" || previous.id === "(regexp)")
        ) {
            warn(
                "expected_space_a_b",
                the_token,
                artifact(previous),
                artifact(the_token)
            );
        }
        if (previous.id === "." && id === "(number)") {
            warn("expected_a_before_b", previous, "0", ".");
        }
        if (prior.id === "." && the_token.identifier) {
            the_token.dot = true;
        }

// The previous token is used to detect adjacency problems.

        previous = the_token;

// The prior token is a previous token that was not a comment. The prior token
// is used to disambiguate "/", which can mean division or regular expression
// literal.

        if (previous.id !== "(comment)") {
            prior = previous;
        }
        return the_token;
    }

    function parse_directive(the_comment, body) {

// JSLint recognizes three directives that can be encoded in comments. This
// function processes one item, and calls itself recursively to process the
// next one.

        var result = body.match(rx_directive_part);
        if (result) {
            var allowed;
            var name = result[1];
            var value = result[2];
            if (the_comment.directive === "jslint") {
                allowed = allowed_option[name];
                if (
                    typeof allowed === "boolean"
                    || typeof allowed === "object"
                ) {
                    if (
                        value === ""
                        || value === "true"
                        || value === undefined
                    ) {
                        option[name] = true;
                        if (Array.isArray(allowed)) {
                            populate(allowed, declared_globals, false);
                        }
                    } else if (value === "false") {
                        option[name] = false;
                    } else {
                        warn("bad_option_a", the_comment, name + ":" + value);
                    }
                } else {
                    warn("bad_option_a", the_comment, name);
                }
            } else if (the_comment.directive === "property") {
                if (tenure === undefined) {
                    tenure = empty();
                }
                tenure[name] = true;
            } else if (the_comment.directive === "global") {
                if (value) {
                    warn("bad_option_a", the_comment, name + ":" + value);
                }
                declared_globals[name] = false;
                module_mode = the_comment;
            }
            return parse_directive(the_comment, result[3]);
        }
        if (body) {
            return stop("bad_directive_a", the_comment, body);
        }
    }

    function comment(snippet) {

// Make a comment object. Comments are not allowed in JSON text. Comments can
// include directives and notices of incompletion.

        var the_comment = make("(comment)", snippet);
        if (Array.isArray(snippet)) {
            snippet = snippet.join(" ");
        }
        if (!option.devel && rx_todo.test(snippet)) {
            warn("todo_comment", the_comment);
        }
        var result = snippet.match(rx_directive);
        if (result) {
            if (!directive_mode) {
                warn_at("misplaced_directive_a", line, from, result[1]);
            } else {
                the_comment.directive = result[1];
                parse_directive(the_comment, result[2]);
            }
            directives.push(the_comment);
        }
        return the_comment;
    }

    function regexp() {

// Parse a regular expression literal.

        var multi_mode = false;
        var result;
        var value;
        regexp_seen = true;

        function quantifier() {

// Match an optional quantifier.

            if (char === "?" || char === "*" || char === "+") {
                next_char();
            } else if (char === "{") {
                if (some_digits(rx_digits, true) === 0) {
                    warn_at("expected_a", line, column, "0");
                }
                if (next_char() === ",") {
                    some_digits(rx_digits, true);
                    next_char();
                }
                next_char("}");
            } else {
                return;
            }
            if (char === "?") {
                next_char("?");
            }
        }

        function subklass() {

// Match a character in a character class.

            if (char === "\\") {
                escape("BbDdSsWw-[]^");
                return true;
            }
            if (
                char === ""
                || char === "["
                || char === "]"
                || char === "/"
                || char === "^"
                || char === "-"
            ) {
                return false;
            }
            if (char === " ") {
                warn_at("expected_a_b", line, column, "\\u0020", " ");
            } else if (char === "`" && mega_mode) {
                warn_at("unexpected_a", line, column, "`");
            }
            next_char();
            return true;
        }

        function ranges() {

// Match a range of subclasses.

            if (subklass()) {
                if (char === "-") {
                    next_char("-");
                    if (!subklass()) {
                        return stop_at(
                            "unexpected_a",
                            line,
                            column - 1,
                            "-"
                        );
                    }
                }
                return ranges();
            }
        }

        function klass() {

// Match a class.

            next_char("[");
            if (char === "^") {
                next_char("^");
            }
            (function classy() {
                ranges();
                if (char !== "]" && char !== "") {
                    warn_at(
                        "expected_a_before_b",
                        line,
                        column,
                        "\\",
                        char
                    );
                    next_char();
                    return classy();
                }
            }());
            next_char("]");
        }

        function choice() {

            function group() {

// Match a group that starts with left paren.

                next_char("(");
                if (char === "?") {
                    next_char("?");
                    if (char === "=" || char === "!") {
                        next_char();
                    } else {
                        next_char(":");
                    }
                } else if (char === ":") {
                    warn_at("expected_a_before_b", line, column, "?", ":");
                }
                choice();
                next_char(")");
            }

            function factor() {
                if (
                    char === ""
                    || char === "/"
                    || char === "]"
                    || char === ")"
                ) {
                    return false;
                }
                if (char === "(") {
                    group();
                    return true;
                }
                if (char === "[") {
                    klass();
                    return true;
                }
                if (char === "\\") {
                    escape("BbDdSsWw^${}[]():=!.-|*+?");
                    return true;
                }
                if (
                    char === "?"
                    || char === "+"
                    || char === "*"
                    || char === "}"
                    || char === "{"
                ) {
                    warn_at(
                        "expected_a_before_b",
                        line,
                        column - 1,
                        "\\",
                        char
                    );
                } else if (char === "`") {
                    if (mega_mode) {
                        warn_at("unexpected_a", line, column - 1, "`");
                    }
                } else if (char === " ") {
                    warn_at(
                        "expected_a_b",
                        line,
                        column - 1,
                        "\\s",
                        " "
                    );
                } else if (char === "$") {
                    if (source_line[0] !== "/") {
                        multi_mode = true;
                    }
                } else if (char === "^") {
                    if (snippet !== "^") {
                        multi_mode = true;
                    }
                }
                next_char();
                return true;
            }

            function sequence(follow) {
                if (factor()) {
                    quantifier();
                    return sequence(true);
                }
                if (!follow) {
                    warn_at("expected_regexp_factor_a", line, column, char);
                }
            }

// Match a choice (a sequence that can be followed by | and another choice).

            sequence();
            if (char === "|") {
                next_char("|");
                return choice();
            }
        }

// Scan the regexp literal. Give a warning if the first character is = because
// /= looks like a division assignment operator.

        snippet = "";
        next_char();
        if (char === "=") {
            warn_at("expected_a_before_b", line, column, "\\", "=");
        }
        choice();

// Make sure there is a closing slash.

        snip();
        value = snippet;
        next_char("/");

// Process dangling flag letters.

        var allowed = {
            g: true,
            i: true,
            m: true,
            u: true,
            y: true
        };
        var flag = empty();
        (function make_flag() {
            if (is_letter(char)) {
                if (allowed[char] !== true) {
                    warn_at("unexpected_a", line, column, char);
                }
                allowed[char] = false;
                flag[char] = true;
                next_char();
                return make_flag();
            }
        }());
        back_char();
        if (char === "/" || char === "*") {
            return stop_at("unexpected_a", line, from, char);
        }
        result = make("(regexp)", char);
        result.flag = flag;
        result.value = value;
        if (multi_mode && !flag.m) {
            warn_at("missing_m", line, column);
        }
        return result;
    }

    function string(quote) {

// Make a string token.

        var the_token;
        snippet = "";
        next_char();

        return (function next() {
            if (char === quote) {
                snip();
                the_token = make("(string)", snippet);
                the_token.quote = quote;
                return the_token;
            }
            if (char === "") {
                return stop_at("unclosed_string", line, column);
            }
            if (char === "\\") {
                escape(quote);
            } else if (char === "`") {
                if (mega_mode) {
                    warn_at("unexpected_a", line, column, "`");
                }
                next_char("`");
            } else {
                next_char();
            }
            return next();
        }());
    }

    function frack() {
        if (char === ".") {
            some_digits(rx_digits);
            next_char();
        }
        if (char === "E" || char === "e") {
            next_char();
            if (char !== "+" && char !== "-") {
                back_char();
            }
            some_digits(rx_digits);
            next_char();
        }
    }

    function number() {
        if (snippet === "0") {
            next_char();
            if (char === ".") {
                frack();
            } else if (char === "b") {
                some_digits(rx_bits);
                next_char();
            } else if (char === "o") {
                some_digits(rx_octals);
                next_char();
            } else if (char === "x") {
                some_digits(rx_hexs);
                next_char();
            }
        } else {
            next_char();
            frack();
        }

// If the next character after a number is a digit or letter, then something
// unexpected is going on.

        if (
            (char >= "0" && char <= "9")
            || (char >= "a" && char <= "z")
            || (char >= "A" && char <= "Z")
        ) {
            return stop_at(
                "unexpected_a_after_b",
                line,
                column - 1,
                snippet.slice(-1),
                snippet.slice(0, -1)
            );
        }
        back_char();
        return make("(number)", snippet);
    }

    function lex() {
        var array;
        var i = 0;
        var j = 0;
        var last;
        var result;
        var the_token;
        // jslint-hack - un-recurse
        while (!source_line) {
            source_line = next_line();
            from = 0;
            if (source_line === undefined) {
                return (
                    mega_mode
                    ? stop_at("unclosed_mega", mega_line, mega_from)
                    : make("(end)")
                );
            }
        }
        from = column;
        result = source_line.match(rx_token);

// result[1] token
// result[2] whitespace
// result[3] identifier
// result[4] number
// result[5] rest

        if (!result) {
            return stop_at(
                "unexpected_char_a",
                line,
                column,
                source_line[0]
            );
        }

        snippet = result[1];
        column += snippet.length;
        source_line = result[5];

// Whitespace was matched. Call lex again to get more.

        if (result[2]) {
            return lex();
        }

// The token is an identifier.

        if (result[3]) {
            return make(snippet, undefined, true);
        }

// The token is a number.

        if (result[4]) {
            return number(snippet);
        }

// The token is a string.

        if (snippet === "\"") {
            return string(snippet);
        }
        if (snippet === "'") {
            if (!option.single) {
                warn_at("use_double", line, column);
            }
            return string(snippet);
        }

// The token is a megastring. We don't allow any kind of mega nesting.

        if (snippet === "`") {
            if (mega_mode) {
                return stop_at("expected_a_b", line, column, "}", "`");
            }
            snippet = "";
            mega_from = from;
            mega_line = line;
            mega_mode = true;

// Parsing a mega literal is tricky. First make a ` token.

            make("`");
            from += 1;

// Then loop, building up a string, possibly from many lines, until seeing
// the end of file, a closing `, or a ${ indicting an expression within the
// string.

            (function part() {
                var at = source_line.search(rx_mega);

// If neither ` nor ${ is seen, then the whole line joins the snippet.

                if (at < 0) {
                    snippet += source_line + "\n";
                    return (
                        next_line() === undefined
                        ? stop_at("unclosed_mega", mega_line, mega_from)
                        : part()
                    );
                }

// if either ` or ${ was found, then the preceding joins the snippet to become
// a string token.

                snippet += source_line.slice(0, at);
                column += at;
                source_line = source_line.slice(at);
                if (source_line[0] === "\\") {
                    stop_at("escape_mega", line, at);
                }
                make("(string)", snippet).quote = "`";
                snippet = "";

// If ${, then make tokens that will become part of an expression until
// a } token is made.

                if (source_line[0] === "$") {
                    column += 2;
                    make("${");
                    source_line = source_line.slice(2);
                    (function expr() {
                        var id = lex().id;
                        if (id === "{") {
                            return stop_at(
                                "expected_a_b",
                                line,
                                column,
                                "}",
                                "{"
                            );
                        }
                        if (id !== "}") {
                            return expr();
                        }
                    }());
                    return part();
                }
            }());
            source_line = source_line.slice(1);
            column += 1;
            mega_mode = false;
            return make("`");
        }

// The token is a // comment.

        if (snippet === "//") {
            // jslint-hack - too_long
            if (option.utility2 && (
                /^!!\u0020|^\u0020https:\/\//m
            ).test(source_line)) {
                regexp_seen = true;
            }
            snippet = source_line;
            source_line = "";
            the_token = comment(snippet);
            if (mega_mode) {
                warn("unexpected_comment", the_token, "`");
            }
            return the_token;
        }

// The token is a /* comment.

        if (snippet === "/*") {
            array = [];
            if (source_line[0] === "/") {
                warn_at("unexpected_a", line, column + i, "/");
            }
            (function next() {
                if (source_line > "") {
                    i = source_line.search(rx_star_slash);
                    if (i >= 0) {
                        return;
                    }
                    j = source_line.search(rx_slash_star);
                    if (j >= 0) {
                        warn_at("nested_comment", line, column + j);
                    }
                }
                array.push(source_line);
                // jslint-hack - too_long
                if (option.utility2 && (
                    /^\S|^\u0020{2}|\u0020https:\/\/|\u0020this\u0020.*?\u0020package\u0020will\u0020/m
                ).test(source_line)) {
                    regexp_seen = true;
                }
                source_line = next_line();
                if (source_line === undefined) {
                    return stop_at("unclosed_comment", line, column);
                }
                return next();
            }());
            snippet = source_line.slice(0, i);
            j = snippet.search(rx_slash_star_or_slash);
            if (j >= 0) {
                warn_at("nested_comment", line, column + j);
            }
            array.push(snippet);
            column += i + 2;
            source_line = source_line.slice(i + 2);
            return comment(array);
        }

// The token is a slash.

        if (snippet === "/") {

// The / can be a division operator or the beginning of a regular expression
// literal. It is not possible to know which without doing a complete parse.
// We want to complete the tokenization before we begin to parse, so we will
// estimate. This estimator can fail in some cases. For example, it cannot
// know if "}" is ending a block or ending an object literal, so it can
// behave incorrectly in that case; it is not meaningful to divide an
// object, so it is likely that we can get away with it. We avoided the worst
// cases by eliminating automatic semicolon insertion.

            if (prior.identifier) {
                if (!prior.dot) {
                    if (prior.id === "return") {
                        return regexp();
                    }
                    if (
                        prior.id === "(begin)"
                        || prior.id === "case"
                        || prior.id === "delete"
                        || prior.id === "in"
                        || prior.id === "instanceof"
                        || prior.id === "new"
                        || prior.id === "typeof"
                        || prior.id === "void"
                        || prior.id === "yield"
                    ) {
                        the_token = regexp();
                        return stop("unexpected_a", the_token);
                    }
                }
            } else {
                last = prior.id[prior.id.length - 1];
                if ("(,=:?[".indexOf(last) >= 0) {
                    return regexp();
                }
                if ("!&|{};~+-*%/^<>".indexOf(last) >= 0) {
                    the_token = regexp();
                    warn("wrap_regexp", the_token);
                    return the_token;
                }
            }
            if (source_line[0] === "/") {
                column += 1;
                source_line = source_line.slice(1);
                snippet = "/=";
                warn_at("unexpected_a", line, column, "/=");
            }
        }
        return make(snippet);
    }

    first = lex();
    json_mode = first.id === "{" || first.id === "[";

// This is the only loop in JSLint. It will turn into a recursive call to lex
// when ES6 has been finished and widely deployed and adopted.

    while (true) {
        if (lex().id === "(end)") {
            break;
        }
    }
}

// Parsing:

// Parsing weaves the tokens into an abstract syntax tree. During that process,
// a token may be given any of these properties:

//      arity       string
//      label       identifier
//      name        identifier
//      expression  expressions
//      block       statements
//      else        statements (else, default, catch)

// Specialized tokens may have additional properties.

function survey(name) {
    var id = name.id;

// Tally the property name. If it is a string, only tally strings that conform
// to the identifier rules.

    if (id === "(string)") {
        id = name.value;
        if (!rx_identifier.test(id)) {
            return id;
        }
    } else if (id === "`") {
        if (name.value.length === 1) {
            id = name.value[0].value;
            if (!rx_identifier.test(id)) {
                return id;
            }
        }
    } else if (!name.identifier) {
        return stop("expected_identifier_a", name);
    }

// If we have seen this name before, increment its count.

    if (typeof property[id] === "number") {
        property[id] += 1;

// If this is the first time seeing this property name, and if there is a
// tenure list, then it must be on the list. Otherwise, it must conform to
// the rules for good property names.
    } else {
        if (tenure !== undefined) {
            if (tenure[id] !== true) {
                warn("unregistered_property_a", name);
            }
        } else {
            if (name.identifier && rx_bad_property.test(id)) {
                warn("bad_property_a", name);
            }
        }
        property[id] = 1;
    }
    return id;
}

function dispense() {

// Deliver the next token, skipping the comments.

    var cadet = tokens[token_nr];
    token_nr += 1;
    if (cadet.id === "(comment)") {
        if (json_mode) {
            warn("unexpected_a", cadet);
        }
        return dispense();
    } else {
        return cadet;
    }
}

function lookahead() {

// Look ahead one token without advancing.

    var old_token_nr = token_nr;
    var cadet = dispense(true);
    token_nr = old_token_nr;
    return cadet;
}

function advance(id, match) {

// Produce the next token.

// Attempt to give helpful names to anonymous functions.

    if (token.identifier && token.id !== "function") {
        anon = token.id;
    } else if (token.id === "(string)" && rx_identifier.test(token.value)) {
        anon = token.value;
    }

// Attempt to match next_token with an expected id.

    if (id !== undefined && next_token.id !== id) {
        return (
            match === undefined
            ? stop("expected_a_b", next_token, id, artifact())
            : stop(
                "expected_a_b_from_c_d",
                next_token,
                id,
                artifact(match),
                artifact_line(match),
                artifact(next_token)
            )
        );
    }

// Promote the tokens, skipping comments.

    token = next_token;
    next_token = dispense();
    if (next_token.id === "(end)") {
        token_nr -= 1;
    }
}

// Parsing of JSON is simple:

function json_value() {
    var negative;
    if (next_token.id === "{") {
        return (function json_object() {
            var brace = next_token;
            var object = empty();
            var properties = [];
            brace.expression = properties;
            advance("{");
            if (next_token.id !== "}") {
                (function next() {
                    var name;
                    var value;
                    if (next_token.quote !== "\"") {
                        warn(
                            "unexpected_a",
                            next_token,
                            next_token.quote
                        );
                    }
                    name = next_token;
                    advance("(string)");
                    if (object[token.value] !== undefined) {
                        warn("duplicate_a", token);
                    } else if (token.value === "__proto__") {
                        warn("bad_property_a", token);
                    } else {
                        object[token.value] = token;
                    }
                    advance(":");
                    value = json_value();
                    value.label = name;
                    properties.push(value);
                    if (next_token.id === ",") {
                        advance(",");
                        return next();
                    }
                }());
            }
            advance("}", brace);
            return brace;
        }());
    }
    if (next_token.id === "[") {
        return (function json_array() {
            var bracket = next_token;
            var elements = [];
            bracket.expression = elements;
            advance("[");
            if (next_token.id !== "]") {
                (function next() {
                    elements.push(json_value());
                    if (next_token.id === ",") {
                        advance(",");
                        return next();
                    }
                }());
            }
            advance("]", bracket);
            return bracket;
        }());
    }
    if (
        next_token.id === "true"
        || next_token.id === "false"
        || next_token.id === "null"
    ) {
        advance();
        return token;
    }
    if (next_token.id === "(number)") {
        if (!rx_JSON_number.test(next_token.value)) {
            warn("unexpected_a");
        }
        advance();
        return token;
    }
    if (next_token.id === "(string)") {
        if (next_token.quote !== "\"") {
            warn("unexpected_a", next_token, next_token.quote);
        }
        advance();
        return token;
    }
    if (next_token.id === "-") {
        negative = next_token;
        negative.arity = "unary";
        advance("-");
        advance("(number)");
        negative.expression = token;
        return negative;
    }
    stop("unexpected_a");
}

// Now we parse JavaScript.

function enroll(name, role, readonly) {

// Enroll a name into the current function context. The role can be exception,
// function, label, parameter, or variable. We look for variable redefinition
// because it causes confusion.

    var id = name.id;

// Reserved words may not be enrolled.

    if (syntax[id] !== undefined && id !== "ignore") {
        warn("reserved_a", name);
    } else {

// Has the name been enrolled in this context?

        var earlier = functionage.context[id];
        if (earlier) {
            warn(
                "redefinition_a_b",
                name,
                name.id,
                earlier.line + fudge
            );

// Has the name been enrolled in an outer context?
        } else {
            stack.forEach(function (value) {
                var item = value.context[id];
                if (item !== undefined) {
                    earlier = item;
                }
            });
            if (earlier) {
                if (id === "ignore") {
                    if (earlier.role === "variable") {
                        warn("unexpected_a", name);
                    }
                } else {
                    if ((
                        role !== "exception"
                        || earlier.role !== "exception"
                    ) && role !== "parameter" && role !== "function") {
                        warn(
                            "redefinition_a_b",
                            name,
                            name.id,
                            earlier.line + fudge
                        );
                    }
                }
            }

// Enroll it.

            functionage.context[id] = name;
            name.dead = true;
            name.parent = functionage;
            name.init = false;
            name.role = role;
            name.used = 0;
            name.writable = !readonly;
        }
    }
}

function expression(rbp, initial) {

// This is the heart of the Pratt parser. I retained Pratt's nomenclature.
// They are elements of the parsing method called Top Down Operator Precedence.

// nud     Null denotation
// led     Left denotation
// lbp     Left binding power
// rbp     Right binding power

// It processes a nud (variable, constant, prefix operator). It will then
// process leds (infix operators) until the bind powers cause it to stop. It
// returns the expression's parse tree.

    var left;
    var the_symbol;

// Statements will have already advanced, so advance now only if the token is
// not the first of a statement,

    if (!initial) {
        advance();
    }
    the_symbol = syntax[token.id];
    if (the_symbol !== undefined && the_symbol.nud !== undefined) {
        left = the_symbol.nud();
    } else if (token.identifier) {
        left = token;
        left.arity = "variable";
    } else {
        return stop("unexpected_a", token);
    }
    (function right() {
        the_symbol = syntax[next_token.id];
        if (
            the_symbol !== undefined
            && the_symbol.led !== undefined
            && rbp < the_symbol.lbp
        ) {
            advance();
            left = the_symbol.led(left);
            return right();
        }
    }());
    return left;
}

function condition() {

// Parse the condition part of a do, if, while.

    var the_paren = next_token;
    var the_value;
    the_paren.free = true;
    advance("(");
    the_value = expression(0);
    advance(")");
    if (the_value.wrapped === true) {
        warn("unexpected_a", the_paren);
    }
    if (anticondition[the_value.id] === true) {
        warn("unexpected_a", the_value);
    }
    return the_value;
}

function is_weird(thing) {
    return (
        thing.id === "(regexp)"
        || thing.id === "{"
        || thing.id === "=>"
        || thing.id === "function"
        || (thing.id === "[" && thing.arity === "unary")
    );
}

function are_similar(a, b) {
    if (a === b) {
        return true;
    }
    if (Array.isArray(a)) {
        return (
            Array.isArray(b)
            && a.length === b.length
            && a.every(function (value, index) {
                return are_similar(value, b[index]);
            })
        );
    }
    if (Array.isArray(b)) {
        return false;
    }
    if (a.id === "(number)" && b.id === "(number)") {
        return a.value === b.value;
    }
    var a_string;
    var b_string;
    if (a.id === "(string)") {
        a_string = a.value;
    } else if (a.id === "`" && a.constant) {
        a_string = a.value[0];
    }
    if (b.id === "(string)") {
        b_string = b.value;
    } else if (b.id === "`" && b.constant) {
        b_string = b.value[0];
    }
    if (typeof a_string === "string") {
        return a_string === b_string;
    }
    if (is_weird(a) || is_weird(b)) {
        return false;
    }
    if (a.arity === b.arity && a.id === b.id) {
        if (a.id === ".") {
            return (
                are_similar(a.expression, b.expression)
                && are_similar(a.name, b.name)
            );
        }
        if (a.arity === "unary") {
            return are_similar(a.expression, b.expression);
        }
        if (a.arity === "binary") {
            return (
                a.id !== "("
                && are_similar(a.expression[0], b.expression[0])
                && are_similar(a.expression[1], b.expression[1])
            );
        }
        if (a.arity === "ternary") {
            return (
                are_similar(a.expression[0], b.expression[0])
                && are_similar(a.expression[1], b.expression[1])
                && are_similar(a.expression[2], b.expression[2])
            );
        }
        if (a.arity === "function" && a.arity === "regexp") {
            return false;
        }
        return true;
    }
    return false;
}

function semicolon() {

// Try to match a semicolon.

    if (next_token.id === ";") {
        advance(";");
    } else {
        warn_at(
            "expected_a_b",
            token.line,
            token.thru,
            ";",
            artifact(next_token)
        );
    }
    anon = "anonymous";
}

function statement() {

// Parse a statement. Any statement may have a label, but only four statements
// have use for one. A statement can be one of the standard statements, or
// an assignment expression, or an invocation expression.

    var first;
    var the_label;
    var the_statement;
    var the_symbol;
    advance();
    if (token.identifier && next_token.id === ":") {
        the_label = token;
        if (the_label.id === "ignore") {
            warn("unexpected_a", the_label);
        }
        advance(":");
        if (
            next_token.id === "do"
            || next_token.id === "for"
            || next_token.id === "switch"
            || next_token.id === "while"
        ) {
            enroll(the_label, "label", true);
            the_label.init = true;
            the_label.dead = false;
            the_statement = statement();
            the_statement.label = the_label;
            the_statement.statement = true;
            return the_statement;
        }
        advance();
        warn("unexpected_label_a", the_label);
    }

// Parse the statement.

    first = token;
    first.statement = true;
    the_symbol = syntax[first.id];
    if (the_symbol !== undefined && the_symbol.fud !== undefined) {
        the_symbol.disrupt = false;
        the_symbol.statement = true;
        the_statement = the_symbol.fud();
    } else {

// It is an expression statement.

        the_statement = expression(0, true);
        if (the_statement.wrapped && the_statement.id !== "(") {
            warn("unexpected_a", first);
        }
        semicolon();
    }
    if (the_label !== undefined) {
        the_label.dead = true;
    }
    return the_statement;
}

function statements() {

// Parse a list of statements. Give a warning if an unreachable statement
// follows a disruptive statement.

    var array = [];
    (function next(disrupt) {
        if (
            next_token.id !== "}"
            && next_token.id !== "case"
            && next_token.id !== "default"
            && next_token.id !== "else"
            && next_token.id !== "(end)"
        ) {
            var a_statement = statement();
            array.push(a_statement);
            if (disrupt) {
                warn("unreachable_a", a_statement);
            }
            return next(a_statement.disrupt);
        }
    }(false));
    return array;
}

function not_top_level(thing) {

// Some features should not be at the outermost level.

    if (functionage === global) {
        warn("unexpected_at_top_level_a", thing);
    }
}

function top_level_only(the_thing) {

// Some features must be at the most outermost level.

    if (blockage !== global) {
        warn("misplaced_a", the_thing);
    }
}

function block(special) {

// Parse a block, a sequence of statements wrapped in braces.
//  special "body"      The block is a function body.
//          "ignore"    No warning on an empty block.
//          "naked"     No advance.
//          undefined   An ordinary block.

    var stmts;
    var the_block;
    if (special !== "naked") {
        advance("{");
    }
    the_block = token;
    the_block.arity = "statement";
    the_block.body = special === "body";

// Top level function bodies may include the "use strict" pragma.

    if (
        special === "body"
        && stack.length === 1
        && next_token.value === "use strict"
    ) {
        next_token.statement = true;
        advance("(string)");
        advance(";");
    }
    stmts = statements();
    the_block.block = stmts;
    if (stmts.length === 0) {
        if (!option.devel && special !== "ignore") {
            warn("empty_block", the_block);
        }
        the_block.disrupt = false;
    } else {
        the_block.disrupt = stmts[stmts.length - 1].disrupt;
    }
    advance("}");
    return the_block;
}

function mutation_check(the_thing) {

// The only expressions that may be assigned to are
//      e.b
//      e[b]
//      v
//      [destructure]
//      {destructure}

    if (
        the_thing.arity !== "variable"
        && the_thing.id !== "."
        && the_thing.id !== "["
        && the_thing.id !== "{"
    ) {
        warn("bad_assignment_a", the_thing);
        return false;
    }
    return true;
}

function left_check(left, right) {

// Warn if the left is not one of these:
//      e.b
//      e[b]
//      e()
//      ?:
//      identifier

    var id = left.id;
    if (
        !left.identifier
        && (
            left.arity !== "ternary"
            || (
                !left_check(left.expression[1])
                && !left_check(left.expression[2])
            )
        )
        && (
            left.arity !== "binary"
            || (id !== "." && id !== "(" && id !== "[")
        )
    ) {
        // jslint-hack - unexpected_a
        warn("unexpected_a", right, null, null, left, right);
        return false;
    }
    return true;
}

// These functions are used to specify the grammar of our language:

function symbol(id, bp) {

// Make a symbol if it does not already exist in the language's syntax.

    var the_symbol = syntax[id];
    if (the_symbol === undefined) {
        the_symbol = empty();
        the_symbol.id = id;
        the_symbol.lbp = bp || 0;
        syntax[id] = the_symbol;
    }
    return the_symbol;
}

function assignment(id) {

// Make an assignment operator. The one true assignment is different because
// its left side, when it is a variable, is not treated as an expression.
// That case is special because that is when a variable gets initialized. The
// other assignment operators can modify, but they cannot initialize.

    var the_symbol = symbol(id, 20);
    the_symbol.led = function (left) {
        var the_token = token;
        var right;
        the_token.arity = "assignment";
        right = expression(20 - 1);
        if (id === "=" && left.arity === "variable") {
            the_token.names = left;
            the_token.expression = right;
        } else {
            the_token.expression = [
                left, right
            ];
        }
        if (
            right.arity === "assignment"
            || right.arity === "pre"
            || right.arity === "post"
        ) {
            warn("unexpected_a", right);
        }
        mutation_check(left);
        return the_token;
    };
    return the_symbol;
}

function constant(id, type, value) {

// Make a constant symbol.

    var the_symbol = symbol(id);
    the_symbol.constant = true;
    the_symbol.nud = (
        typeof value === "function"
        ? value
        : function () {
            token.constant = true;
            if (value !== undefined) {
                token.value = value;
            }
            return token;
        }
    );
    the_symbol.type = type;
    the_symbol.value = value;
    return the_symbol;
}

function infix(id, bp, f) {

// Make an infix operator.

    var the_symbol = symbol(id, bp);
    the_symbol.led = function (left) {
        var the_token = token;
        the_token.arity = "binary";
        if (f !== undefined) {
            return f(left);
        }
        the_token.expression = [
            left, expression(bp)
        ];
        return the_token;
    };
    return the_symbol;
}

function infixr(id, bp) {

// Make a right associative infix operator.

    var the_symbol = symbol(id, bp);
    the_symbol.led = function (left) {
        var the_token = token;
        the_token.arity = "binary";
        the_token.expression = [
            left, expression(bp - 1)
        ];
        return the_token;
    };
    return the_symbol;
}

function post(id) {

// Make one of the post operators.

    var the_symbol = symbol(id, 150);
    the_symbol.led = function (left) {
        token.expression = left;
        token.arity = "post";
        mutation_check(token.expression);
        return token;
    };
    return the_symbol;
}

function pre(id) {

// Make one of the pre operators.

    var the_symbol = symbol(id);
    the_symbol.nud = function () {
        var the_token = token;
        the_token.arity = "pre";
        the_token.expression = expression(150);
        mutation_check(the_token.expression);
        return the_token;
    };
    return the_symbol;
}

function prefix(id, f) {

// Make a prefix operator.

    var the_symbol = symbol(id);
    the_symbol.nud = function () {
        var the_token = token;
        the_token.arity = "unary";
        if (typeof f === "function") {
            return f();
        }
        the_token.expression = expression(150);
        return the_token;
    };
    return the_symbol;
}

function stmt(id, f) {

// Make a statement.

    var the_symbol = symbol(id);
    the_symbol.fud = function () {
        token.arity = "statement";
        return f();
    };
    return the_symbol;
}

function ternary(id1, id2) {

// Make a ternary operator.

    var the_symbol = symbol(id1, 30);
    the_symbol.led = function (left) {
        var the_token = token;
        var second = expression(20);
        advance(id2);
        token.arity = "ternary";
        the_token.arity = "ternary";
        the_token.expression = [
            left, second, expression(10)
        ];
        if (next_token.id !== ")") {
            warn("use_open", the_token);
        }
        return the_token;
    };
    return the_symbol;
}

// Begin defining the language.

syntax = empty();

symbol("}");
symbol(")");
symbol("]");
symbol(",");
symbol(";");
symbol(":");
symbol("*/");
symbol("await");
symbol("case");
symbol("catch");
symbol("class");
symbol("default");
symbol("else");
symbol("enum");
symbol("finally");
symbol("implements");
symbol("interface");
symbol("package");
symbol("private");
symbol("protected");
symbol("public");
symbol("static");
symbol("super");
symbol("void");
symbol("yield");

constant("(number)", "number");
constant("(regexp)", "regexp");
constant("(string)", "string");
constant("arguments", "object", function () {
    warn("unexpected_a", token);
    return token;
});
constant("eval", "function", function () {
    if (!option.eval) {
        warn("unexpected_a", token);
    } else if (next_token.id !== "(") {
        warn("expected_a_before_b", next_token, "(", artifact());
    }
    return token;
});
constant("false", "boolean", false);
constant("Function", "function", function () {
    if (!option.eval) {
        warn("unexpected_a", token);
    } else if (next_token.id !== "(") {
        warn("expected_a_before_b", next_token, "(", artifact());
    }
    return token;
});
constant("ignore", "undefined", function () {
    warn("unexpected_a", token);
    return token;
});
constant("Infinity", "number", Infinity);
constant("isFinite", "function", function () {
    warn("expected_a_b", token, "Number.isFinite", "isFinite");
    return token;
});
constant("isNaN", "function", function () {
    warn("number_isNaN", token);
    return token;
});
constant("NaN", "number", NaN);
constant("null", "null", null);
constant("this", "object", function () {
    if (!option.this) {
        warn("unexpected_a", token);
    }
    return token;
});
constant("true", "boolean", true);
constant("undefined", "undefined");

assignment("=");
assignment("+=");
assignment("-=");
assignment("*=");
assignment("/=");
assignment("%=");
assignment("&=");
assignment("|=");
assignment("^=");
assignment("<<=");
assignment(">>=");
assignment(">>>=");

infix("||", 40);
infix("&&", 50);
infix("|", 70);
infix("^", 80);
infix("&", 90);
infix("==", 100);
infix("===", 100);
infix("!=", 100);
infix("!==", 100);
infix("<", 110);
infix(">", 110);
infix("<=", 110);
infix(">=", 110);
infix("in", 110);
infix("instanceof", 110);
infix("<<", 120);
infix(">>", 120);
infix(">>>", 120);
infix("+", 130);
infix("-", 130);
infix("*", 140);
infix("/", 140);
infix("%", 140);
infixr("**", 150);
infix("(", 160, function (left) {
    var the_paren = token;
    var the_argument;
    if (left.id !== "function") {
        left_check(left, the_paren);
    }
    if (functionage.arity === "statement" && left.identifier) {
        functionage.name.calls[left.id] = left;
    }
    the_paren.expression = [
        left
    ];
    if (next_token.id !== ")") {
        (function next() {
            var ellipsis;
            if (next_token.id === "...") {
                ellipsis = true;
                advance("...");
            }
            the_argument = expression(10);
            if (ellipsis) {
                the_argument.ellipsis = true;
            }
            the_paren.expression.push(the_argument);
            if (next_token.id === ",") {
                advance(",");
                return next();
            }
        }());
    }
    advance(")", the_paren);
    if (the_paren.expression.length === 2) {
        the_paren.free = true;
        if (the_argument.wrapped === true) {
            warn("unexpected_a", the_paren);
        }
        if (the_argument.id === "(") {
            the_argument.wrapped = true;
        }
    } else {
        the_paren.free = false;
    }
    return the_paren;
});
infix(".", 170, function (left) {
    var the_token = token;
    var name = next_token;
    if ((
        left.id !== "(string)"
        || (name.id !== "indexOf" && name.id !== "repeat")
    ) && (
        left.id !== "["
        || (
            name.id !== "concat"
            && name.id !== "forEach"
            && name.id !== "join"
            && name.id !== "map"
        )
    ) && (left.id !== "+" || name.id !== "slice") && (
        left.id !== "(regexp)"
        || (name.id !== "exec" && name.id !== "test")
    )) {
        left_check(left, the_token);
    }
    if (!name.identifier) {
        stop("expected_identifier_a");
    }
    advance();
    survey(name);

// The property name is not an expression.

    the_token.name = name;
    the_token.expression = left;
    return the_token;
});
infix("?.", 170, function (left) {
    var the_token = token;
    var name = next_token;
    if ((
        left.id !== "(string)"
        || (name.id !== "indexOf" && name.id !== "repeat")
    ) && (
        left.id !== "["
        || (
            name.id !== "concat"
            && name.id !== "forEach"
            && name.id !== "join"
            && name.id !== "map"
        )
    ) && (left.id !== "+" || name.id !== "slice") && (
        left.id !== "(regexp)"
        || (name.id !== "exec" && name.id !== "test")
    )) {
        left_check(left, the_token);
    }
    if (!name.identifier) {
        stop("expected_identifier_a");
    }
    advance();
    survey(name);

// The property name is not an expression.

    the_token.name = name;
    the_token.expression = left;
    return the_token;
});
infix("[", 170, function (left) {
    var the_token = token;
    var the_subscript = expression(0);
    if (the_subscript.id === "(string)" || the_subscript.id === "`") {
        var name = survey(the_subscript);
        if (rx_identifier.test(name)) {
            warn("subscript_a", the_subscript, name);
        }
    }
    left_check(left, the_token);
    the_token.expression = [
        left, the_subscript
    ];
    advance("]");
    return the_token;
});
infix("=>", 170, function (left) {
    return stop("wrap_parameter", left);
});

function do_tick() {
    var the_tick = token;
    the_tick.value = [];
    the_tick.expression = [];
    if (next_token.id !== "`") {
        (function part() {
            advance("(string)");
            the_tick.value.push(token);
            if (next_token.id === "${") {
                advance("${");
                the_tick.expression.push(expression(0));
                advance("}");
                return part();
            }
        }());
    }
    advance("`");
    return the_tick;
}

infix("`", 160, function (left) {
    var the_tick = do_tick();
    left_check(left, the_tick);
    the_tick.expression = [
        left
    ].concat(the_tick.expression);
    return the_tick;
});

post("++");
post("--");
pre("++");
pre("--");

prefix("+");
prefix("-");
prefix("~");
prefix("!");
prefix("!!");
prefix("[", function () {
    var the_token = token;
    the_token.expression = [];
    if (next_token.id !== "]") {
        (function next() {
            var element;
            var ellipsis = false;
            if (next_token.id === "...") {
                ellipsis = true;
                advance("...");
            }
            element = expression(10);
            if (ellipsis) {
                element.ellipsis = true;
            }
            the_token.expression.push(element);
            if (next_token.id === ",") {
                advance(",");
                return next();
            }
        }());
    }
    advance("]");
    return the_token;
});
prefix("/=", function () {
    stop("expected_a_b", token, "/\\=", "/=");
});
prefix("=>", function () {
    return stop("expected_a_before_b", token, "()", "=>");
});
prefix("new", function () {
    var the_new = token;
    var right = expression(160);
    if (next_token.id !== "(") {
        warn("expected_a_before_b", next_token, "()", artifact(next_token));
    }
    the_new.expression = right;
    return the_new;
});
prefix("typeof");
prefix("void", function () {
    var the_void = token;
    warn("unexpected_a", the_void);
    the_void.expression = expression(0);
    return the_void;
});

function parameter_list() {
    var list = [];
    var optional;
    var signature = [
        "("
    ];
    if (next_token.id !== ")" && next_token.id !== "(end)") {
        (function parameter() {
            var ellipsis = false;
            var param;
            if (next_token.id === "{") {
                if (optional !== undefined) {
                    warn(
                        "required_a_optional_b",
                        next_token,
                        next_token.id,
                        optional.id
                    );
                }
                param = next_token;
                param.names = [];
                advance("{");
                signature.push("{");
                (function subparameter() {
                    var subparam = next_token;
                    if (!subparam.identifier) {
                        return stop("expected_identifier_a");
                    }
                    survey(subparam);
                    advance();
                    signature.push(subparam.id);
                    if (next_token.id === ":") {
                        advance(":");
                        advance();
                        token.label = subparam;
                        subparam = token;
                        if (!subparam.identifier) {
                            return stop("expected_identifier_a");
                        }
                    }
                    if (next_token.id === "=") {
                        advance("=");
                        subparam.expression = expression();
                        param.open = true;
                    }
                    param.names.push(subparam);
                    if (next_token.id === ",") {
                        advance(",");
                        signature.push(", ");
                        return subparameter();
                    }
                }());
                list.push(param);
                advance("}");
                signature.push("}");
                if (next_token.id === ",") {
                    advance(",");
                    signature.push(", ");
                    return parameter();
                }
            } else if (next_token.id === "[") {
                if (optional !== undefined) {
                    warn(
                        "required_a_optional_b",
                        next_token,
                        next_token.id,
                        optional.id
                    );
                }
                param = next_token;
                param.names = [];
                advance("[");
                signature.push("[]");
                (function subparameter() {
                    var subparam = next_token;
                    if (!subparam.identifier) {
                        return stop("expected_identifier_a");
                    }
                    advance();
                    param.names.push(subparam);
                    if (next_token.id === "=") {
                        advance("=");
                        subparam.expression = expression();
                        param.open = true;
                    }
                    if (next_token.id === ",") {
                        advance(",");
                        return subparameter();
                    }
                }());
                list.push(param);
                advance("]");
                if (next_token.id === ",") {
                    advance(",");
                    signature.push(", ");
                    return parameter();
                }
            } else {
                if (next_token.id === "...") {
                    ellipsis = true;
                    signature.push("...");
                    advance("...");
                    if (optional !== undefined) {
                        warn(
                            "required_a_optional_b",
                            next_token,
                            next_token.id,
                            optional.id
                        );
                    }
                }
                if (!next_token.identifier) {
                    return stop("expected_identifier_a");
                }
                param = next_token;
                list.push(param);
                advance();
                signature.push(param.id);
                if (ellipsis) {
                    param.ellipsis = true;
                } else {
                    if (next_token.id === "=") {
                        optional = param;
                        advance("=");
                        param.expression = expression(0);
                    } else {
                        if (optional !== undefined) {
                            warn(
                                "required_a_optional_b",
                                param,
                                param.id,
                                optional.id
                            );
                        }
                    }
                    if (next_token.id === ",") {
                        advance(",");
                        signature.push(", ");
                        return parameter();
                    }
                }
            }
        }());
    }
    advance(")");
    signature.push(")");
    return [
        list, signature.join("")
    ];
}

function do_function(the_function) {
    var name;
    if (the_function === undefined) {
        the_function = token;

// A function statement must have a name that will be in the parent's scope.

        if (the_function.arity === "statement") {
            if (!next_token.identifier) {
                return stop("expected_identifier_a", next_token);
            }
            name = next_token;
            enroll(name, "variable", true);
            the_function.name = name;
            name.init = true;
            name.calls = empty();
            advance();
        } else if (name === undefined) {

// A function expression may have an optional name.

            if (next_token.identifier) {
                name = next_token;
                the_function.name = name;
                advance();
            } else {
                the_function.name = anon;
            }
        }
    } else {
        name = the_function.name;
    }
    the_function.level = functionage.level + 1;
    if (mega_mode) {
        warn("unexpected_a", the_function);
    }

// Don't make functions in loops. It is inefficient, and it can lead to scoping
// errors.

    if (functionage.loop > 0) {
        warn("function_in_loop", the_function);
    }

// Give the function properties for storing its names and for observing the
// depth of loops and switches.

    the_function.context = empty();
    the_function.finally = 0;
    the_function.loop = 0;
    the_function.switch = 0;
    the_function.try = 0;

// Push the current function context and establish a new one.

    stack.push(functionage);
    functions.push(the_function);
    functionage = the_function;
    if (the_function.arity !== "statement" && typeof name === "object") {
        enroll(name, "function", true);
        name.dead = false;
        name.init = true;
        name.used = 1;
    }

// Parse the parameter list.

    advance("(");
    token.free = false;
    token.arity = "function";
    [
        functionage.parameters, functionage.signature
    ] = parameter_list();
    functionage.parameters.forEach(function enroll_parameter(name) {
        if (name.identifier) {
            enroll(name, "parameter", false);
        } else {
            name.names.forEach(enroll_parameter);
        }
    });

// The function's body is a block.

    the_function.block = block("body");
    if (
        the_function.arity === "statement"
        && next_token.line === token.line
    ) {
        return stop("unexpected_a", next_token);
    }
    if (
        next_token.id === "."
        || next_token.id === "?."
        || next_token.id === "["
    ) {
        warn("unexpected_a");
    }

// Restore the previous context.

    functionage = stack.pop();
    return the_function;
}

prefix("function", do_function);

function fart(pl) {
    advance("=>");
    var the_fart = token;
    the_fart.arity = "binary";
    the_fart.name = "=>";
    the_fart.level = functionage.level + 1;
    functions.push(the_fart);
    if (functionage.loop > 0) {
        warn("function_in_loop", the_fart);
    }

// Give the function properties storing its names and for observing the depth
// of loops and switches.

    the_fart.context = empty();
    the_fart.finally = 0;
    the_fart.loop = 0;
    the_fart.switch = 0;
    the_fart.try = 0;

// Push the current function context and establish a new one.

    stack.push(functionage);
    functionage = the_fart;
    the_fart.parameters = pl[0];
    the_fart.signature = pl[1];
    the_fart.parameters.forEach(function (name) {
        enroll(name, "parameter", true);
    });
    if (next_token.id === "{") {
        warn("expected_a_b", the_fart, "function", "=>");
        the_fart.block = block("body");
    } else {
        the_fart.expression = expression(0);
    }
    functionage = stack.pop();
    return the_fart;
}

prefix("(", function () {
    var the_paren = token;
    var the_value;
    var cadet = lookahead().id;

// We can distinguish between a parameter list for => and a wrapped expression
// with one token of lookahead.

    if (
        next_token.id === ")"
        || next_token.id === "..."
        || (next_token.identifier && (cadet === "," || cadet === "="))
    ) {
        the_paren.free = false;
        return fart(parameter_list());
    }
    the_paren.free = true;
    the_value = expression(0);
    if (the_value.wrapped === true) {
        warn("unexpected_a", the_paren);
    }
    the_value.wrapped = true;
    advance(")", the_paren);
    if (next_token.id === "=>") {
        if (the_value.arity !== "variable") {
            if (the_value.id === "{" || the_value.id === "[") {
                warn("expected_a_before_b", the_paren, "function", "(");
                return stop("expected_a_b", next_token, "{", "=>");
            }
            return stop("expected_identifier_a", the_value);
        }
        the_paren.expression = [
            the_value
        ];
        return fart([
            the_paren.expression, "(" + the_value.id + ")"
        ]);
    }
    return the_value;
});
prefix("`", do_tick);
prefix("{", function () {
    var the_brace = token;
    var seen = empty();
    the_brace.expression = [];
    if (next_token.id !== "}") {
        (function member() {
            var extra;
            var full;
            var id;
            var name = next_token;
            var value;
            advance();
            if (
                (name.id === "get" || name.id === "set")
                && next_token.identifier
            ) {
                if (!option.getset) {
                    warn("unexpected_a", name);
                }
                extra = name.id;
                full = extra + " " + next_token.id;
                name = next_token;
                advance();
                id = survey(name);
                if (seen[full] === true || seen[id] === true) {
                    warn("duplicate_a", name);
                }
                seen[id] = false;
                seen[full] = true;
            } else {
                id = survey(name);
                if (typeof seen[id] === "boolean") {
                    warn("duplicate_a", name);
                }
                seen[id] = true;
            }
            if (name.identifier) {
                if (next_token.id === "}" || next_token.id === ",") {
                    if (typeof extra === "string") {
                        advance("(");
                    }
                    value = expression(Infinity, true);
                } else if (next_token.id === "(") {
                    value = do_function({
                        arity: "unary",
                        from: name.from,
                        id: "function",
                        line: name.line,
                        name: (
                            typeof extra === "string"
                            ? extra
                            : id
                        ),
                        thru: name.from
                    });
                } else {
                    if (typeof extra === "string") {
                        advance("(");
                    }
                    var the_colon = next_token;
                    advance(":");
                    value = expression(0);
                    if (value.id === name.id) {
                        warn("unexpected_a", the_colon, ": " + name.id);
                    }
                }
                value.label = name;
                if (typeof extra === "string") {
                    value.extra = extra;
                }
                the_brace.expression.push(value);
            } else {
                advance(":");
                value = expression(0);
                value.label = name;
                the_brace.expression.push(value);
            }
            if (next_token.id === ",") {
                advance(",");
                return member();
            }
        }());
    }
    advance("}");
    return the_brace;
});

stmt(";", function () {
    warn("unexpected_a", token);
    return token;
});
stmt("{", function () {
    warn("naked_block", token);
    return block("naked");
});
stmt("break", function () {
    var the_break = token;
    var the_label;
    if (
        (functionage.loop < 1 && functionage.switch < 1)
        || functionage.finally > 0
    ) {
        warn("unexpected_a", the_break);
    }
    the_break.disrupt = true;
    if (next_token.identifier && token.line === next_token.line) {
        the_label = functionage.context[next_token.id];
        if (
            the_label === undefined
            || the_label.role !== "label"
            || the_label.dead
        ) {
            warn(
                (the_label !== undefined && the_label.dead)
                ? "out_of_scope_a"
                : "not_label_a"
            );
        } else {
            the_label.used += 1;
        }
        the_break.label = next_token;
        advance();
    }
    advance(";");
    return the_break;
});

function do_var() {
    var the_statement = token;
    var is_const = the_statement.id === "const";
    the_statement.names = [];

// A program may use var or let, but not both.

    if (!is_const) {
        if (var_mode === undefined) {
            var_mode = the_statement.id;
        } else if (the_statement.id !== var_mode) {
            warn(
                "expected_a_b",
                the_statement,
                var_mode,
                the_statement.id
            );
        }
    }

// We don't expect to see variables created in switch statements.

    if (functionage.switch > 0) {
        warn("var_switch", the_statement);
    }
    if (functionage.loop > 0 && the_statement.id === "var") {
        warn("var_loop", the_statement);
    }
    (function next() {
        if (next_token.id === "{" && the_statement.id !== "var") {
            var the_brace = next_token;
            advance("{");
            (function pair() {
                if (!next_token.identifier) {
                    return stop("expected_identifier_a", next_token);
                }
                var name = next_token;
                survey(name);
                advance();
                if (next_token.id === ":") {
                    advance(":");
                    if (!next_token.identifier) {
                        return stop("expected_identifier_a", next_token);
                    }
                    next_token.label = name;
                    the_statement.names.push(next_token);
                    enroll(next_token, "variable", is_const);
                    advance();
                    the_brace.open = true;
                } else {
                    the_statement.names.push(name);
                    enroll(name, "variable", is_const);
                }
                name.dead = false;
                name.init = true;
                if (next_token.id === "=") {
                    advance("=");
                    name.expression = expression();
                    the_brace.open = true;
                }
                if (next_token.id === ",") {
                    advance(",");
                    return pair();
                }
            }());
            advance("}");
            advance("=");
            the_statement.expression = expression(0);
        } else if (next_token.id === "[" && the_statement.id !== "var") {
            var the_bracket = next_token;
            advance("[");
            (function element() {
                var ellipsis;
                if (next_token.id === "...") {
                    ellipsis = true;
                    advance("...");
                }
                if (!next_token.identifier) {
                    return stop("expected_identifier_a", next_token);
                }
                var name = next_token;
                advance();
                the_statement.names.push(name);
                enroll(name, "variable", is_const);
                name.dead = false;
                name.init = true;
                if (ellipsis) {
                    name.ellipsis = true;
                } else {
                    if (next_token.id === "=") {
                        advance("=");
                        name.expression = expression();
                        the_bracket.open = true;
                    }
                    if (next_token.id === ",") {
                        advance(",");
                        return element();
                    }
                }
            }());
            advance("]");
            advance("=");
            the_statement.expression = expression(0);
        } else if (next_token.identifier) {
            var name = next_token;
            advance();
            if (name.id === "ignore") {
                warn("unexpected_a", name);
            }
            enroll(name, "variable", is_const);
            if (next_token.id === "=" || is_const) {
                advance("=");
                name.dead = false;
                name.init = true;
                name.expression = expression(0);
            }
            the_statement.names.push(name);
        } else {
            return stop("expected_identifier_a", next_token);
        }
    }());
    semicolon();
    return the_statement;
}

stmt("const", do_var);
stmt("continue", function () {
    var the_continue = token;
    if (functionage.loop < 1 || functionage.finally > 0) {
        warn("unexpected_a", the_continue);
    }
    not_top_level(the_continue);
    the_continue.disrupt = true;
    warn("unexpected_a", the_continue);
    advance(";");
    return the_continue;
});
stmt("debugger", function () {
    var the_debug = token;
    if (!option.devel) {
        warn("unexpected_a", the_debug);
    }
    semicolon();
    return the_debug;
});
stmt("delete", function () {
    var the_token = token;
    var the_value = expression(0);
    if (
        (the_value.id !== "." && the_value.id !== "[")
        || the_value.arity !== "binary"
    ) {
        stop("expected_a_b", the_value, ".", artifact(the_value));
    }
    the_token.expression = the_value;
    semicolon();
    return the_token;
});
stmt("do", function () {
    var the_do = token;
    not_top_level(the_do);
    functionage.loop += 1;
    the_do.block = block();
    advance("while");
    the_do.expression = condition();
    semicolon();
    if (the_do.block.disrupt === true) {
        warn("weird_loop", the_do);
    }
    functionage.loop -= 1;
    return the_do;
});
stmt("export", function () {
    var the_export = token;
    var the_id;
    var the_name;
    var the_thing;

    function export_id() {
        if (!next_token.identifier) {
            stop("expected_identifier_a");
        }
        the_id = next_token.id;
        the_name = global.context[the_id];
        if (the_name === undefined) {
            warn("unexpected_a");
        } else {
            the_name.used += 1;
            if (exports[the_id] !== undefined) {
                warn("duplicate_a");
            }
            exports[the_id] = the_name;
        }
        advance();
        the_export.expression.push(the_thing);
    }

    the_export.expression = [];
    if (next_token.id === "default") {
        if (exports.default !== undefined) {
            warn("duplicate_a");
        }
        advance("default");
        the_thing = expression(0);
        if (
            the_thing.id !== "("
            || the_thing.expression[0].id !== "."
            || the_thing.expression[0].expression.id !== "Object"
            || the_thing.expression[0].name.id !== "freeze"
        ) {
            warn("freeze_exports", the_thing);
        }
        if (next_token.id === ";") {
            semicolon();
        }
        exports.default = the_thing;
        the_export.expression.push(the_thing);
    } else {
        if (next_token.id === "function") {
            warn("freeze_exports");
            the_thing = statement();
            the_name = the_thing.name;
            the_id = the_name.id;
            the_name.used += 1;
            if (exports[the_id] !== undefined) {
                warn("duplicate_a", the_name);
            }
            exports[the_id] = the_thing;
            the_export.expression.push(the_thing);
            the_thing.statement = false;
            the_thing.arity = "unary";
        } else if (
            next_token.id === "var"
            || next_token.id === "let"
            || next_token.id === "const"
        ) {
            warn("unexpected_a", next_token);
            statement();
        } else if (next_token.id === "{") {
            advance("{");
            (function loop() {
                export_id();
                if (next_token.id === ",") {
                    advance(",");
                    return loop();
                }
            }());
            advance("}");
            semicolon();
        } else {
            stop("unexpected_a");
        }
    }
    module_mode = true;
    return the_export;
});
stmt("for", function () {
    var first;
    var the_for = token;
    if (!option.for) {
        warn("unexpected_a", the_for);
    }
    not_top_level(the_for);
    functionage.loop += 1;
    advance("(");
    token.free = true;
    if (next_token.id === ";") {
        return stop("expected_a_b", the_for, "while (", "for (;");
    }
    if (
        next_token.id === "var"
        || next_token.id === "let"
        || next_token.id === "const"
    ) {
        return stop("unexpected_a");
    }
    first = expression(0);
    if (first.id === "in") {
        if (first.expression[0].arity !== "variable") {
            warn("bad_assignment_a", first.expression[0]);
        }
        the_for.name = first.expression[0];
        the_for.expression = first.expression[1];
        warn("expected_a_b", the_for, "Object.keys", "for in");
    } else {
        the_for.initial = first;
        advance(";");
        the_for.expression = expression(0);
        advance(";");
        the_for.inc = expression(0);
        if (the_for.inc.id === "++") {
            warn("expected_a_b", the_for.inc, "+= 1", "++");
        }
    }
    advance(")");
    the_for.block = block();
    if (the_for.block.disrupt === true) {
        warn("weird_loop", the_for);
    }
    functionage.loop -= 1;
    return the_for;
});
stmt("function", do_function);
stmt("if", function () {
    var the_else;
    var the_if = token;
    the_if.expression = condition();
    the_if.block = block();
    if (next_token.id === "else") {
        advance("else");
        the_else = token;
        the_if.else = (
            next_token.id === "if"
            ? statement()
            : block()
        );
        if (the_if.block.disrupt === true) {
            if (the_if.else.disrupt === true) {
                the_if.disrupt = true;
            } else {
                warn("unexpected_a", the_else);
            }
        }
    }
    return the_if;
});
stmt("import", function () {
    var the_import = token;
    var name;
    if (typeof module_mode === "object") {
        warn("unexpected_directive_a", module_mode, module_mode.directive);
    }
    module_mode = true;
    if (next_token.identifier) {
        name = next_token;
        advance();
        if (name.id === "ignore") {
            warn("unexpected_a", name);
        }
        enroll(name, "variable", true);
        the_import.name = name;
    } else {
        var names = [];
        advance("{");
        if (next_token.id !== "}") {
            while (true) {
                if (!next_token.identifier) {
                    stop("expected_identifier_a");
                }
                name = next_token;
                advance();
                if (name.id === "ignore") {
                    warn("unexpected_a", name);
                }
                enroll(name, "variable", true);
                names.push(name);
                if (next_token.id !== ",") {
                    break;
                }
                advance(",");
            }
        }
        advance("}");
        the_import.name = names;
    }
    advance("from");
    advance("(string)");
    the_import.import = token;
    if (!rx_module.test(token.value)) {
        warn("bad_module_name_a", token);
    }
    froms.push(token.value);
    semicolon();
    return the_import;
});
stmt("let", do_var);
stmt("return", function () {
    var the_return = token;
    not_top_level(the_return);
    if (functionage.finally > 0) {
        warn("unexpected_a", the_return);
    }
    the_return.disrupt = true;
    if (next_token.id !== ";" && the_return.line === next_token.line) {
        the_return.expression = expression(10);
    }
    advance(";");
    return the_return;
});
stmt("switch", function () {
    var dups = [];
    var last;
    var stmts;
    var the_cases = [];
    var the_disrupt = true;
    var the_switch = token;
    not_top_level(the_switch);
    if (functionage.finally > 0) {
        warn("unexpected_a", the_switch);
    }
    functionage.switch += 1;
    advance("(");
    token.free = true;
    the_switch.expression = expression(0);
    the_switch.block = the_cases;
    advance(")");
    advance("{");
    (function major() {
        var the_case = next_token;
        the_case.arity = "statement";
        the_case.expression = [];
        (function minor() {
            advance("case");
            token.switch = true;
            var exp = expression(0);
            if (dups.some(function (thing) {
                return are_similar(thing, exp);
            })) {
                warn("unexpected_a", exp);
            }
            dups.push(exp);
            the_case.expression.push(exp);
            advance(":");
            if (next_token.id === "case") {
                return minor();
            }
        }());
        stmts = statements();
        if (stmts.length < 1) {
            warn("expected_statements_a");
            return;
        }
        the_case.block = stmts;
        the_cases.push(the_case);
        last = stmts[stmts.length - 1];
        if (last.disrupt) {
            if (last.id === "break" && last.label === undefined) {
                the_disrupt = false;
            }
        } else {
            warn(
                "expected_a_before_b",
                next_token,
                "break;",
                artifact(next_token)
            );
        }
        if (next_token.id === "case") {
            return major();
        }
    }());
    dups = undefined;
    if (next_token.id === "default") {
        var the_default = next_token;
        advance("default");
        token.switch = true;
        advance(":");
        the_switch.else = statements();
        if (the_switch.else.length < 1) {
            warn("unexpected_a", the_default);
            the_disrupt = false;
        } else {
            var the_last = the_switch.else[the_switch.else.length - 1];
            if (the_last.id === "break" && the_last.label === undefined) {
                warn("unexpected_a", the_last);
                the_last.disrupt = false;
            }
            the_disrupt = the_disrupt && the_last.disrupt;
        }
    } else {
        the_disrupt = false;
    }
    advance("}", the_switch);
    functionage.switch -= 1;
    the_switch.disrupt = the_disrupt;
    return the_switch;
});
stmt("throw", function () {
    var the_throw = token;
    the_throw.disrupt = true;
    the_throw.expression = expression(10);
    semicolon();
    if (functionage.try > 0) {
        warn("unexpected_a", the_throw);
    }
    return the_throw;
});
stmt("try", function () {
    var the_catch;
    var the_disrupt;
    var the_try = token;
    if (functionage.try > 0) {
        warn("unexpected_a", the_try);
    }
    functionage.try += 1;
    the_try.block = block();
    the_disrupt = the_try.block.disrupt;
    if (next_token.id === "catch") {
        var ignored = "ignore";
        the_catch = next_token;
        the_try.catch = the_catch;
        advance("catch");
        if (next_token.id === "(") {
            advance("(");
            if (!next_token.identifier) {
                return stop("expected_identifier_a", next_token);
            }
            if (next_token.id !== "ignore") {
                ignored = undefined;
                the_catch.name = next_token;
                enroll(next_token, "exception", true);
            }
            advance();
            advance(")");
        }
        the_catch.block = block(ignored);
        if (the_catch.block.disrupt !== true) {
            the_disrupt = false;
        }
    } else {
        warn(
            "expected_a_before_b",
            next_token,
            "catch",
            artifact(next_token)
        );
    }
    if (next_token.id === "finally") {
        functionage.finally += 1;
        advance("finally");
        the_try.else = block();
        the_disrupt = the_try.else.disrupt;
        functionage.finally -= 1;
    }
    the_try.disrupt = the_disrupt;
    functionage.try -= 1;
    return the_try;
});
stmt("var", do_var);
stmt("while", function () {
    var the_while = token;
    not_top_level(the_while);
    functionage.loop += 1;
    the_while.expression = condition();
    the_while.block = block();
    if (the_while.block.disrupt === true) {
        warn("weird_loop", the_while);
    }
    functionage.loop -= 1;
    return the_while;
});
stmt("with", function () {
    stop("unexpected_a", token);
});

ternary("?", ":");

// Ambulation of the parse tree.

function action(when) {

// Produce a function that will register task functions that will be called as
// the tree is traversed.

    return function (arity, id, task) {
        var a_set = when[arity];
        var i_set;

// The id parameter is optional. If excluded, the task will be applied to all
// ids.

        if (typeof id !== "string") {
            task = id;
            id = "(all)";
        }

// If this arity has no registrations yet, then create a set object to hold
// them.

        if (a_set === undefined) {
            a_set = empty();
            when[arity] = a_set;
        }

// If this id has no registrations yet, then create a set array to hold them.

        i_set = a_set[id];
        if (i_set === undefined) {
            i_set = [];
            a_set[id] = i_set;
        }

// Register the task with the arity and the id.

        i_set.push(task);
    };
}

function amble(when) {

// Produce a function that will act on the tasks registered by an action
// function while walking the tree.

    return function (the_token) {

// Given a task set that was built by an action function, run all of the
// relevant tasks on the token.

        var a_set = when[the_token.arity];
        var i_set;

// If there are tasks associated with the token's arity...

        if (a_set !== undefined) {

// If there are tasks associated with the token's id...

            i_set = a_set[the_token.id];
            if (i_set !== undefined) {
                i_set.forEach(function (task) {
                    return task(the_token);
                });
            }

// If there are tasks for all ids.

            i_set = a_set["(all)"];
            if (i_set !== undefined) {
                i_set.forEach(function (task) {
                    return task(the_token);
                });
            }
        }
    };
}

var posts = empty();
var pres = empty();
var preaction = action(pres);
var postaction = action(posts);
var preamble = amble(pres);
var postamble = amble(posts);

function walk_expression(thing) {
    if (thing) {
        if (Array.isArray(thing)) {
            thing.forEach(walk_expression);
        } else {
            preamble(thing);
            walk_expression(thing.expression);
            if (thing.id === "function") {
                walk_statement(thing.block);
            }
            if (thing.arity === "pre" || thing.arity === "post") {
                warn("unexpected_a", thing);
            } else if (
                thing.arity === "statement"
                || thing.arity === "assignment"
            ) {
                warn("unexpected_statement_a", thing);
            }
            postamble(thing);
        }
    }
}

function walk_statement(thing) {
    if (thing) {
        if (Array.isArray(thing)) {
            thing.forEach(walk_statement);
        } else {
            preamble(thing);
            walk_expression(thing.expression);
            if (thing.arity === "binary") {
                if (thing.id !== "(") {
                    warn("unexpected_expression_a", thing);
                }
            } else if (
                thing.arity !== "statement"
                && thing.arity !== "assignment"
            ) {
                warn("unexpected_expression_a", thing);
            }
            walk_statement(thing.block);
            walk_statement(thing.else);
            postamble(thing);
        }
    }
}

function lookup(thing) {
    if (thing.arity === "variable") {

// Look up the variable in the current context.

        var the_variable = functionage.context[thing.id];

// If it isn't local, search all the other contexts. If there are name
// collisions, take the most recent.

        if (the_variable === undefined) {
            stack.forEach(function (outer) {
                var a_variable = outer.context[thing.id];
                if (
                    a_variable !== undefined
                    && a_variable.role !== "label"
                ) {
                    the_variable = a_variable;
                }
            });

// If it isn't in any of those either, perhaps it is a predefined global.
// If so, add it to the global context.

            if (the_variable === undefined) {
                if (declared_globals[thing.id] === undefined) {
                    warn("undeclared_a", thing);
                    return;
                }
                the_variable = {
                    dead: false,
                    parent: global,
                    id: thing.id,
                    init: true,
                    role: "variable",
                    used: 0,
                    writable: false
                };
                global.context[thing.id] = the_variable;
            }
            the_variable.closure = true;
            functionage.context[thing.id] = the_variable;
        } else if (the_variable.role === "label") {
            warn("label_a", thing);
        }
        if (
            the_variable.dead
            && (
                the_variable.calls === undefined
                || the_variable.calls[functionage.name.id] === undefined
            )
        ) {
            warn("out_of_scope_a", thing);
        }
        return the_variable;
    }
}

function subactivate(name) {
    name.init = true;
    name.dead = false;
    blockage.live.push(name);
}

function preaction_function(thing) {
    if (thing.arity === "statement" && blockage.body !== true) {
        warn("unexpected_a", thing);
    }
    stack.push(functionage);
    block_stack.push(blockage);
    functionage = thing;
    blockage = thing;
    thing.live = [];
    if (typeof thing.name === "object") {
        thing.name.dead = false;
        thing.name.init = true;
    }
    if (thing.extra === "get") {
        if (thing.parameters.length !== 0) {
            warn("bad_get", thing);
        }
    } else if (thing.extra === "set") {
        if (thing.parameters.length !== 1) {
            warn("bad_set", thing);
        }
    }
    thing.parameters.forEach(function (name) {
        walk_expression(name.expression);
        if (name.id === "{" || name.id === "[") {
            name.names.forEach(subactivate);
        } else {
            name.dead = false;
            name.init = true;
        }
    });
}

function bitwise_check(thing) {
    if (!option.bitwise && bitwiseop[thing.id] === true) {
        warn("unexpected_a", thing);
    }
    if (
        thing.id !== "("
        && thing.id !== "&&"
        && thing.id !== "||"
        && thing.id !== "="
        && Array.isArray(thing.expression)
        && thing.expression.length === 2
        && (
            relationop[thing.expression[0].id] === true
            || relationop[thing.expression[1].id] === true
        )
    ) {
        warn("unexpected_a", thing);
    }
}

function pop_block() {
    blockage.live.forEach(function (name) {
        name.dead = true;
    });
    delete blockage.live;
    blockage = block_stack.pop();
}

function activate(name) {
    name.dead = false;
    if (name.expression !== undefined) {
        walk_expression(name.expression);
        if (name.id === "{" || name.id === "[") {
            name.names.forEach(subactivate);
        } else {
            name.init = true;
        }
    }
    blockage.live.push(name);
}

function action_var(thing) {
    thing.names.forEach(activate);
}

preaction("assignment", bitwise_check);
preaction("binary", bitwise_check);
preaction("binary", function (thing) {
    if (relationop[thing.id] === true) {
        var left = thing.expression[0];
        var right = thing.expression[1];
        if (left.id === "NaN" || right.id === "NaN") {
            warn("number_isNaN", thing);
        } else if (left.id === "typeof") {
            if (right.id !== "(string)") {
                if (right.id !== "typeof") {
                    warn("expected_string_a", right);
                }
            } else {
                var value = right.value;
                if (value === "null" || value === "undefined") {
                    warn("unexpected_typeof_a", right, value);
                } else if (
                    value !== "boolean"
                    && value !== "function"
                    && value !== "number"
                    && value !== "object"
                    && value !== "string"
                    && value !== "symbol"
                ) {
                    warn("expected_type_string_a", right, value);
                }
            }
        }
    }
});
preaction("binary", "==", function (thing) {
    warn("expected_a_b", thing, "===", "==");
});
preaction("binary", "!=", function (thing) {
    warn("expected_a_b", thing, "!==", "!=");
});
preaction("binary", "=>", preaction_function);
preaction("binary", "||", function (thing) {
    thing.expression.forEach(function (thang) {
        if (thang.id === "&&" && !thang.wrapped) {
            warn("and", thang);
        }
    });
});
preaction("binary", "(", function (thing) {
    var left = thing.expression[0];
    if (
        left.identifier
        && functionage.context[left.id] === undefined
        && typeof functionage.name === "object"
    ) {
        var parent = functionage.name.parent;
        if (parent) {
            var left_variable = parent.context[left.id];
            if (
                left_variable !== undefined
                && left_variable.dead
                && left_variable.parent === parent
                && left_variable.calls !== undefined
                && left_variable.calls[functionage.name.id] !== undefined
            ) {
                left_variable.dead = false;
            }
        }
    }
});
preaction("binary", "in", function (thing) {
    warn("infix_in", thing);
});
preaction("binary", "instanceof", function (thing) {
    warn("unexpected_a", thing);
});
preaction("binary", ".", function (thing) {
    if (thing.expression.new) {
        thing.new = true;
    }
});
preaction("statement", "{", function (thing) {
    block_stack.push(blockage);
    blockage = thing;
    thing.live = [];
});
preaction("statement", "for", function (thing) {
    if (thing.name !== undefined) {
        var the_variable = lookup(thing.name);
        if (the_variable !== undefined) {
            the_variable.init = true;
            if (!the_variable.writable) {
                warn("bad_assignment_a", thing.name);
            }
        }
    }
    walk_statement(thing.initial);
});
preaction("statement", "function", preaction_function);
preaction("unary", "~", bitwise_check);
preaction("unary", "function", preaction_function);
preaction("variable", function (thing) {
    var the_variable = lookup(thing);
    if (the_variable !== undefined) {
        thing.variable = the_variable;
        the_variable.used += 1;
    }
});

function init_variable(name) {
    var the_variable = lookup(name);
    if (the_variable !== undefined) {
        if (the_variable.writable) {
            the_variable.init = true;
            return;
        }
    }
    warn("bad_assignment_a", name);
}

postaction("assignment", "+=", function (thing) {
    var right = thing.expression[1];
    if (right.constant) {
        if (
            right.value === ""
            || (right.id === "(number)" && right.value === "0")
            || right.id === "(boolean)"
            || right.id === "null"
            || right.id === "undefined"
            || Number.isNaN(right.value)
        ) {
            warn("unexpected_a", right);
        }
    }
});
postaction("assignment", function (thing) {

// Assignment using = sets the init property of a variable. No other assignment
// operator can do this. A = token keeps that variable (or array of variables
// in case of destructuring) in its name property.

    var lvalue = thing.expression[0];
    if (thing.id === "=") {
        if (thing.names !== undefined) {
            if (Array.isArray(thing.names)) {
                thing.names.forEach(init_variable);
            } else {
                init_variable(thing.names);
            }
        } else {
            if (lvalue.id === "[" || lvalue.id === "{") {
                lvalue.expression.forEach(function (thing) {
                    if (thing.variable) {
                        thing.variable.init = true;
                    }
                });
            } else if (
                lvalue.id === "."
                && thing.expression[1].id === "undefined"
            ) {
                warn(
                    "expected_a_b",
                    lvalue.expression,
                    "delete",
                    "undefined"
                );
            }
        }
    } else {
        if (lvalue.arity === "variable") {
            if (!lvalue.variable || lvalue.variable.writable !== true) {
                warn("bad_assignment_a", lvalue);
            }
        }
        var right = syntax[thing.expression[1].id];
        if (
            right !== undefined
            && (
                right.id === "function"
                || right.id === "=>"
                || (
                    right.constant
                    && right.id !== "(number)"
                    && (right.id !== "(string)" || thing.id !== "+=")
                )
            )
        ) {
            warn("unexpected_a", thing.expression[1]);
        }
    }
});

function postaction_function(thing) {
    delete functionage.finally;
    delete functionage.loop;
    delete functionage.switch;
    delete functionage.try;
    functionage = stack.pop();
    if (thing.wrapped) {
        warn("unexpected_parens", thing);
    }
    return pop_block();
}

postaction("binary", function (thing) {
    var right;
    if (relationop[thing.id]) {
        if (
            is_weird(thing.expression[0])
            || is_weird(thing.expression[1])
            || are_similar(thing.expression[0], thing.expression[1])
            || (
                thing.expression[0].constant === true
                && thing.expression[1].constant === true
            )
        ) {
            warn("weird_relation_a", thing);
        }
    }
    if (thing.id === "+") {
        if (!option.convert) {
            if (thing.expression[0].value === "") {
                warn("expected_a_b", thing, "String(...)", "\"\" +");
            } else if (thing.expression[1].value === "") {
                warn("expected_a_b", thing, "String(...)", "+ \"\"");
            }
        }
    } else if (thing.id === "[") {
        if (thing.expression[0].id === "window") {
            warn("weird_expression_a", thing, "window[...]");
        }
        if (thing.expression[0].id === "self") {
            warn("weird_expression_a", thing, "self[...]");
        }
    } else if (thing.id === "." || thing.id === "?.") {
        if (thing.expression.id === "RegExp") {
            warn("weird_expression_a", thing);
        }
    } else if (thing.id !== "=>" && thing.id !== "(") {
        right = thing.expression[1];
        if (
            (thing.id === "+" || thing.id === "-")
            && right.id === thing.id
            && right.arity === "unary"
            && !right.wrapped
        ) {
            warn("wrap_unary", right);
        }
        if (
            thing.expression[0].constant === true
            && right.constant === true
        ) {
            thing.constant = true;
        }
    }
});
postaction("binary", "&&", function (thing) {
    if (
        is_weird(thing.expression[0])
        || are_similar(thing.expression[0], thing.expression[1])
        || thing.expression[0].constant === true
        || thing.expression[1].constant === true
    ) {
        warn("weird_condition_a", thing);
    }
});
postaction("binary", "||", function (thing) {
    if (
        is_weird(thing.expression[0])
        || are_similar(thing.expression[0], thing.expression[1])
        || thing.expression[0].constant === true
    ) {
        warn("weird_condition_a", thing);
    }
});
postaction("binary", "=>", postaction_function);
postaction("binary", "(", function (thing) {
    var left = thing.expression[0];
    var arg;
    var the_new;
    if (left.id === "new") {
        the_new = left;
        left = left.expression;
    }
    if (left.id === "function") {
        if (!thing.wrapped) {
            warn("wrap_immediate", thing);
        }
    } else if (left.identifier) {
        if (the_new !== undefined) {
            if (
                left.id[0] > "Z"
                || left.id === "Boolean"
                || left.id === "Number"
                || left.id === "String"
                || left.id === "Symbol"
            ) {
                warn("unexpected_a", the_new);
            } else if (left.id === "Function") {
                if (!option.eval) {
                    warn("unexpected_a", left, "new Function");
                }
            } else if (left.id === "Array") {
                arg = thing.expression;
                if (arg.length !== 2 || arg[1].id === "(string)") {
                    warn("expected_a_b", left, "[]", "new Array");
                }
            } else if (left.id === "Object") {
                warn(
                    "expected_a_b",
                    left,
                    "Object.create(null)",
                    "new Object"
                );
            }
        } else {
            if (
                left.id[0] >= "A"
                && left.id[0] <= "Z"
                && left.id !== "Boolean"
                && left.id !== "Number"
                && left.id !== "String"
                && left.id !== "Symbol"
            ) {
                warn(
                    "expected_a_before_b",
                    left,
                    "new",
                    artifact(left)
                );
            }
        }
    } else if (left.id === ".") {
        var cack = the_new !== undefined;
        if (left.expression.id === "Date" && left.name.id === "UTC") {
            cack = !cack;
        }
        if (rx_cap.test(left.name.id) !== cack) {
            if (the_new !== undefined) {
                warn("unexpected_a", the_new);
            } else {
                warn(
                    "expected_a_before_b",
                    left.expression,
                    "new",
                    left.name.id
                );
            }
        }
        if (left.name.id === "getTime") {
            var paren = left.expression;
            if (paren.id === "(") {
                var array = paren.expression;
                if (array.length === 1) {
                    var new_date = array[0];
                    if (
                        new_date.id === "new"
                        && new_date.expression.id === "Date"
                    ) {
                        warn(
                            "expected_a_b",
                            new_date,
                            "Date.now()",
                            "new Date().getTime()"
                        );
                    }
                }
            }
        }
    }
});
postaction("binary", "[", function (thing) {
    if (thing.expression[0].id === "RegExp") {
        warn("weird_expression_a", thing);
    }
    if (is_weird(thing.expression[1])) {
        warn("weird_expression_a", thing.expression[1]);
    }
});
postaction("statement", "{", pop_block);
postaction("statement", "const", action_var);
postaction("statement", "export", top_level_only);
postaction("statement", "for", function (thing) {
    walk_statement(thing.inc);
});
postaction("statement", "function", postaction_function);
postaction("statement", "import", function (the_thing) {
    var name = the_thing.name;
    if (Array.isArray(name)) {
        name.forEach(function (name) {
            name.dead = false;
            name.init = true;
            blockage.live.push(name);
        });
    } else {
        name.dead = false;
        name.init = true;
        blockage.live.push(name);
    }
    return top_level_only(the_thing);
});
postaction("statement", "let", action_var);
postaction("statement", "try", function (thing) {
    if (thing.catch !== undefined) {
        var the_name = thing.catch.name;
        if (the_name !== undefined) {
            var the_variable = functionage.context[the_name.id];
            the_variable.dead = false;
            the_variable.init = true;
        }
        walk_statement(thing.catch.block);
    }
});
postaction("statement", "var", action_var);
postaction("ternary", function (thing) {
    if (
        is_weird(thing.expression[0])
        || thing.expression[0].constant === true
        || are_similar(thing.expression[1], thing.expression[2])
    ) {
        warn("unexpected_a", thing);
    } else if (are_similar(thing.expression[0], thing.expression[1])) {
        warn("expected_a_b", thing, "||", "?");
    } else if (are_similar(thing.expression[0], thing.expression[2])) {
        warn("expected_a_b", thing, "&&", "?");
    } else if (
        thing.expression[1].id === "true"
        && thing.expression[2].id === "false"
    ) {
        warn("expected_a_b", thing, "!!", "?");
    } else if (
        thing.expression[1].id === "false"
        && thing.expression[2].id === "true"
    ) {
        warn("expected_a_b", thing, "!", "?");
    } else if (
        thing.expression[0].wrapped !== true
        && (
            thing.expression[0].id === "||"
            || thing.expression[0].id === "&&"
        )
    ) {
        warn("wrap_condition", thing.expression[0]);
    }
});
postaction("unary", function (thing) {
    if (thing.id === "`") {
        if (thing.expression.every(function (thing) {
            return thing.constant;
        })) {
            thing.constant = true;
        }
    } else if (thing.id === "!") {
        if (thing.expression.constant === true) {
            warn("unexpected_a", thing);
        }
    } else if (thing.id === "!!") {
        if (!option.convert) {
            warn("expected_a_b", thing, "Boolean(...)", "!!");
        }
    } else if (
        thing.id !== "["
        && thing.id !== "{"
        && thing.id !== "function"
        && thing.id !== "new"
    ) {
        if (thing.expression.constant === true) {
            thing.constant = true;
        }
    }
});
postaction("unary", "function", postaction_function);
postaction("unary", "+", function (thing) {
    if (!option.convert) {
        warn("expected_a_b", thing, "Number(...)", "+");
    }
    var right = thing.expression;
    if (right.id === "(" && right.expression[0].id === "new") {
        warn("unexpected_a_before_b", thing, "+", "new");
    } else if (
        right.constant
        || right.id === "{"
        || (right.id === "[" && right.arity !== "binary")
    ) {
        warn("unexpected_a", thing, "+");
    }
});

function delve(the_function) {
    Object.keys(the_function.context).forEach(function (id) {
        if (id !== "ignore") {
            var name = the_function.context[id];
            if (name.parent === the_function) {
                if (
                    name.used === 0
                    && (
                        name.role !== "function"
                        || name.parent.arity !== "unary"
                    )
                ) {
                    warn("unused_a", name);
                } else if (!name.init) {
                    warn("uninitialized_a", name);
                }
            }
        }
    });
}

function uninitialized_and_unused() {

// Delve into the functions looking for variables that were not initialized
// or used. If the file imports or exports, then its global object is also
// delved.

    if (module_mode === true || option.node) {
        delve(global);
    }
    functions.forEach(delve);
}

// Go through the token list, looking at usage of whitespace.

function whitage() {
    var closer = "(end)";
    var free = false;
    var left = global;
    var margin = 0;
    var nr_comments_skipped = 0;
    var open = true;
    var opening = true;
    var right;

    function pop() {
        var previous = stack.pop();
        closer = previous.closer;
        free = previous.free;
        margin = previous.margin;
        open = previous.open;
        opening = previous.opening;
    }

    function push() {
        stack.push({
            closer,
            free,
            margin,
            open,
            opening
        });
    }

    function expected_at(at) {
        warn(
            "expected_a_at_b_c",
            right,
            artifact(right),
            fudge + at,
            artifact_column(right)
        );
    }

    function at_margin(fit) {
        var at = margin + fit;
        // jslint-hack - expected_at
        if (right.from !== at) {
            return expected_at(at);
        }
    }

    function no_space_only() {
        if (
            left.id !== "(global)"
            && left.nr + 1 === right.nr
            && (
                left.line !== right.line
                || left.thru !== right.from
            )
        ) {
            warn(
                "unexpected_space_a_b",
                right,
                artifact(left),
                artifact(right)
            );
        }
    }

    function no_space() {
        if (left.line === right.line) {
            if (left.thru !== right.from && nr_comments_skipped === 0) {
                warn(
                    "unexpected_space_a_b",
                    right,
                    artifact(left),
                    artifact(right)
                );
            }
        } else {
            if (open) {
                var at = (
                    free
                    ? margin
                    : margin + 8
                );
                // jslint-hack - expected_at
                if (right.from !== at) {
                    expected_at(at);
                }
            } else {
                // jslint-hack - expected_at
                if (right.from !== margin + 8) {
                    expected_at(margin + 8);
                }
            }
        }
    }

    function one_space_only() {
        if (left.line !== right.line || left.thru + 1 !== right.from) {
            warn(
                "expected_space_a_b",
                right,
                artifact(left),
                artifact(right)
            );
        }
    }

    function one_space() {
        if (left.line === right.line || !open) {
            if (left.thru + 1 !== right.from && nr_comments_skipped === 0) {
                warn(
                    "expected_space_a_b",
                    right,
                    artifact(left),
                    artifact(right)
                );
            }
        } else {
            // jslint-hack - expected_at
            if (right.from !== margin) {
                expected_at(margin);
            }
        }
    }

    stack = [];
    tokens.forEach(function (the_token) {
        right = the_token;
        if (right.id === "(comment)" || right.id === "(end)") {
            nr_comments_skipped += 1;
        } else {

// If left is an opener and right is not the closer, then push the previous
// state. If the token following the opener is on the next line, then this is
// an open form. If the tokens are on the same line, then it is a closed form.
// Open form is more readable, with each item (statement, argument, parameter,
// etc) starting on its own line. Closed form is more compact. Statement blocks
// are always in open form.

            var new_closer = opener[left.id];
            if (typeof new_closer === "string") {
                if (new_closer !== right.id) {
                    opening = left.open || (left.line !== right.line);
                    push();
                    closer = new_closer;
                    if (opening) {
                        free = closer === ")" && left.free;
                        open = true;
                        // jslint-hack - conditional-margin
                        if (
                            !option.utility2
                            || lines[right.line].startsWith(" ")
                        ) {
                            margin += 4;
                        }
                        if (right.role === "label") {
                            // jslint-hack - expected_at
                            if (right.from !== 0) {
                                expected_at(0);
                            }
                        } else if (right.switch) {
                            at_margin(-4);
                        } else {
                            at_margin(0);
                        }
                    } else {
                        if (right.statement || right.role === "label") {
                            warn(
                                "expected_line_break_a_b",
                                right,
                                artifact(left),
                                artifact(right)
                            );
                        }
                        free = false;
                        open = false;
                        no_space_only();
                    }
                } else {

// If left and right are opener and closer, then the placement of right depends
// on the openness. Illegal pairs (like '{]') have already been detected.

                    if (left.line === right.line) {
                        no_space();
                    } else {
                        at_margin(0);
                    }
                }
            } else {
                if (right.statement === true) {
                    if (left.id === "else") {
                        one_space_only();
                    } else {
                        at_margin(0);
                        open = false;
                    }

// If right is a closer, then pop the previous state.
                } else if (right.id === closer) {
                    pop();
                    if (opening && right.id !== ";") {
                        at_margin(0);
                    } else {
                        no_space_only();
                    }
                } else {

// Left is not an opener, and right is not a closer.
// The nature of left and right will determine the space between them.

// If left is ',' or ';' or right is a statement then if open,
// right must go at the margin, or if closed, a space between.

                    if (right.switch) {
                        at_margin(-4);
                    } else if (right.role === "label") {
                        // jslint-hack - expected_at
                        if (right.from !== 0) {
                            expected_at(0);
                        }
                    } else if (left.id === ",") {
                        if (!open || (
                            (free || closer === "]")
                            && left.line === right.line
                        )) {
                            one_space();
                        } else {
                            at_margin(0);
                        }

// If right is a ternary operator, line it up on the margin.
                    } else if (right.arity === "ternary") {
                        if (open) {
                            at_margin(0);
                        } else {
                            warn("use_open", right);
                        }
                    } else if (
                        right.arity === "binary"
                        && right.id === "("
                        && free
                    ) {
                        no_space();
                    } else if (
                        left.id === "."
                        || left.id === "?."
                        || left.id === "..."
                        || right.id === ","
                        || right.id === ";"
                        || right.id === ":"
                        || (
                            right.arity === "binary"
                            && (right.id === "(" || right.id === "[")
                        )
                        || (
                            right.arity === "function"
                            && left.id !== "function"
                        )
                    ) {
                        no_space_only();
                    } else if (right.id === "." || right.id === "?.") {
                        // jslint-hack - method-chain
                        // https://github.com/douglascrockford/JSLint/commit/752c82d860ac14d35d492dc5c6ad0a0ed8227e76#diff-01d3d81a6eb6d82af3c377b55dc4fa28L4692
                        if (left.line === right.line) {
                            no_space();
                        } else {
                            at_margin(0);
                        }
                    } else if (left.id === ";") {
                        if (open) {
                            at_margin(0);
                        } else {
                            one_space();
                        }
                    } else if (
                        left.arity === "ternary"
                        || left.id === "case"
                        || left.id === "catch"
                        || left.id === "else"
                        || left.id === "finally"
                        || left.id === "while"
                        || right.id === "catch"
                        || right.id === "else"
                        || right.id === "finally"
                        || (right.id === "while" && !right.statement)
                        || (left.id === ")" && right.id === "{")
                    ) {
                        one_space_only();
                    } else if (
                        left.id === "var"
                        || left.id === "const"
                        || left.id === "let"
                    ) {
                        push();
                        closer = ";";
                        free = false;
                        open = left.open;
                        if (open) {
                            margin = margin + 4;
                            at_margin(0);
                        } else {
                            one_space_only();
                        }
                    } else if (

// There is a space between left and right.

                        spaceop[left.id] === true
                        || spaceop[right.id] === true
                        || (
                            left.arity === "binary"
                            && (left.id === "+" || left.id === "-")
                        )
                        || (
                            right.arity === "binary"
                            && (right.id === "+" || right.id === "-")
                        )
                        || left.id === "function"
                        || left.id === ":"
                        || ((
                            left.identifier
                            || left.id === "(string)"
                            || left.id === "(number)"
                        ) && (
                            right.identifier
                            || right.id === "(string)"
                            || right.id === "(number)"
                        ))
                        || (left.arity === "statement" && right.id !== ";")
                    ) {
                        one_space();
                    } else if (left.arity === "unary" && left.id !== "`") {
                        no_space_only();
                    }
                }
            }
            nr_comments_skipped = 0;
            delete left.calls;
            delete left.dead;
            delete left.free;
            delete left.init;
            delete left.open;
            delete left.used;
            left = right;
        }
    });
}

// The jslint function itself.

// jslint-hack - jslint0
var jslint0 = Object.freeze(function (
    source = "",
    option_object = empty(),
    global_array = []
) {
    try {
        warnings = [];
        option = Object.assign(empty(), option_object);
        anon = "anonymous";
        block_stack = [];
        declared_globals = empty();
        directive_mode = true;
        directives = [];
        // jslint-hack - early_stop = false
        early_stop = false;
        exports = empty();
        froms = [];
        fudge = (
            option.fudge
            ? 1
            : 0
        );
        functions = [];
        global = {
            id: "(global)",
            body: true,
            context: empty(),
            from: 0,
            level: 0,
            line: 0,
            live: [],
            loop: 0,
            switch: 0,
            thru: 0
        };
        blockage = global;
        functionage = global;
        json_mode = false;
        mega_mode = false;
        module_mode = false;
        next_token = global;
        property = empty();
        shebang = false;
        stack = [];
        tenure = undefined;
        token = global;
        token_nr = 0;
        var_mode = undefined;
        populate(standard, declared_globals, false);
        populate(global_array, declared_globals, false);
        Object.keys(option).forEach(function (name) {
            if (option[name] === true) {
                var allowed = allowed_option[name];
                if (Array.isArray(allowed)) {
                    populate(allowed, declared_globals, false);
                }
            }
        });
        tokenize(source);
        advance();
        if (json_mode) {
            tree = json_value();
            advance("(end)");
        } else {

// Because browsers encourage combining of script files, the first token might
// be a semicolon to defend against a missing semicolon in the preceding file.

            if (option.browser) {
                if (next_token.id === ";") {
                    advance(";");
                }
            } else {

// If we are not in a browser, then the file form of strict pragma may be used.

                if (
                    next_token.value === "use strict"
                ) {
                    advance("(string)");
                    advance(";");
                }
            }
            tree = statements();
            advance("(end)");
            functionage = global;
            walk_statement(tree);
            // jslint-hack - !early_stop
            if (!early_stop) {
                uninitialized_and_unused();
                if (!option.white) {
                    whitage();
                }
            }
        }
        if (!option.browser) {
            directives.forEach(function (comment) {
                if (comment.directive === "global") {
                    warn("missing_browser", comment);
                }
            });
        }
        early_stop = false;
    } catch (e) {
        // jslint-hack - e.early_stop = true
        e.early_stop = true;
        if (e.name !== "JSLintError") {
            warnings.push(e);
        }
    }
    return {
        directives,
        edition: "2019-01-31",
        exports,
        froms,
        functions,
        global,
        id: "(JSLint)",
        json: json_mode,
        lines,
        module: module_mode === true,
        ok: warnings.length === 0 && !early_stop,
        option,
        property,
        shebang: (
            shebang
            ? lines[0]
            : undefined
        ),
        stop: early_stop,
        tokens,
        tree,
        warnings: warnings.sort(function (a, b) {
            return a.line - b.line || a.column - b.column;
        })
    };
});



/*
file none
*/
// jslint-hack - ignore bad_property_a
rx_bad_property = (
    /$^/m
);
// jslint-hack - extra
jslint_extra = function (source, opt, global_array) {
/*
 * this function will run with extra-features inside jslint-function jslint()
 */
    // init
    line_ignore = null;
    lines = (
        // ternary-operator
        Array.isArray(source)
        ? source
        : source.split(rx_crlf)
    );
    lines_extra = lines.map(function () {
        return {};
    });
    // jslint
    jslint_result = jslint0(lines, opt, global_array);
    // autofix
    // expected_space_a_b: "Expected one space between '{a}' and '{b}'.",
    // unexpected_space_a_b: "Unexpected space between '{a}' and '{b}'.",
    source = lines_extra.map(function (element, ii) {
        return element.source_autofix || lines[ii];
    }).join("\n").replace((
        /\s+?\u0000/g
    ), "\u0000").replace((
        /(\n\u0020+)(.*?)\n\u0020*?(\/\/.*?)\u0000/g
    ), "$1$3$1$2\u0000").replace((
        /\u0000expected_space_a_b\u0000/g
    ), " ").replace((
        /\u0000unexpected_space_a_b\u0000/g
    ), "");
    jslint_result.lines_extra = lines_extra;
    jslint_result.source_autofix = source;
    return jslint_result;
};
local.jslint_extra = jslint_extra;
next_line_extra = function (source_line, line) {
/*
 * this function will run with extra-features inside jslint-function next_line()
 */
    var line_extra;
    var tmp;
    line_extra = {};
    line_extra.line = line;
    line_extra.source = source_line;
    lines_extra[line] = line_extra;
    tmp = (
        source_line.match(
            /^\/\*\u0020jslint\u0020(ignore:start|ignore:end|utility2:true)\u0020\*\/$/m
        )
        || source_line.slice(-50).match(
            /\u0020\/\/\u0020jslint\u0020(ignore:line)$/m
        )
    );
    switch (tmp && tmp[1]) {
    case "ignore:end":
        line_ignore = null;
        break;
    case "ignore:line":
        line_ignore = "line";
        break;
    case "ignore:start":
        line_ignore = true;
        break;
    case "utility2:true":
        option.bitwise = true;
        option.browser = true;
        option.node = true;
        option.this = true;
        option.utility2 = true;
        [
            allowed_option.browser,
            allowed_option.node, [
                "globalThis"
            ]
        ].forEach(function (list) {
            list.forEach(function (key) {
                declared_globals[key] = false;
            });
        });
        break;
    }
    line_extra.ignore = line_ignore;
    switch (line_ignore) {
    case "line":
        line_ignore = null;
        break;
    case true:
        source_line = "";
        break;
    }
    return source_line;
};
warn_at_extra = function (warning, warnings) {
/*
 * this function will run with extra-features inside jslint-function warn_at()
 */
    var tmp;
    Object.assign(warning, lines_extra[warning.line]);
    // left, right
    [
        "c", "d"
    ].forEach(function (key) {
        if (warning[key] === undefined || typeof warning[key] === "object") {
            warning[key] = Object.assign({}, warning[key]);
            Object.keys(warning[key]).forEach(function (key2) {
                if (typeof warning[key][key2] === "object") {
                    warning[key][key2] = null;
                }
            });
        }
    });
    // early_stop
    if (early_stop) {
        if (option.utility2) {
            warning.stack = warning.stack || new Error().stack;
        }
        warnings.push(warning);
        return;
    }
    // ignore
    if (warning.ignore) {
        delete warning.d.warning;
        return;
    }
    switch (option.utility2 && warning.code) {
    // unexpected_a: "Unexpected '{a}'.",
    case "unexpected_a":
        switch (
            JSON.stringify(warning.c.wrapped || warning.c.id)
            + " " + warning.d.id
        ) {
        case "true .":
            delete warning.d.warning;
            return;
        }
        break;
    }
    // autofix
    warning.a = warning.a || warning.source.trim();
    switch (option.autofix && warning.code) {
    // expected_a_at_b_c: "Expected '{a}' at column {b}, not column {c}.",
    case "expected_a_at_b_c":
        tmp = warning.b - warning.c;
        // autofix indent - increment
        if (tmp >= 0) {
            lines_extra[warning.line].source_autofix = (
                " ".repeat(tmp) + warning.source
            );
            break;
        }
        tmp = -tmp;
        // autofix indent - decrement
        if ((
            /^\u0020*?$/m
        ).test(warning.source.slice(0, warning.column))) {
            lines_extra[warning.line].source_autofix = (
                warning.source.slice(tmp)
            );
            break;
        }
        // autofix indent - newline
        lines_extra[warning.line].source_autofix = (
            warning.source.slice(0, warning.column) + "\n"
            + " ".repeat(warning.b) + warning.source.slice(warning.column)
        );
        break;
    // expected_identifier_a: "Expected an identifier and instead saw '{a}'.",
    case "expected_identifier_a":
        if (!(
            // newline
            (
                /^\d+$/m
            ).test(warning.a)
            && warning.source[warning.column + warning.a.length] === ":"
        )) {
            break;
        }
        lines_extra[warning.line].source_autofix = (
            warning.source.slice(0, warning.column) + "\"" + warning.a + "\""
            + warning.source.slice(warning.column + warning.a.length)
        );
        break;
    // expected_space_a_b: "Expected one space between '{a}' and '{b}'.",
    // unexpected_space_a_b: "Unexpected space between '{a}' and '{b}'.",
    case "expected_space_a_b":
    case "unexpected_space_a_b":
        lines_extra[warning.line].source_autofix = (
            warning.source.slice(0, warning.column) + "\u0000" + warning.code
            + "\u0000" + warning.source.slice(warning.column)
        );
        break;
    // use_spaces: "Use spaces, not tabs.",
    case "use_spaces":
        lines_extra[warning.line].source_autofix = (
            warning.source.replace((
                /^(\u0020*?)\t/
            ), "$1   ")
        );
        break;
    }
    if (warnings.length && warnings[warnings.length - 1].line < warning.line) {
        warnings.push(warning);
        return;
    }
    // debug
    if (option.utility2) {
        warning.option = Object.assign({}, option);
        Object.keys(warning.option).forEach(function (key) {
            if (
                typeof warning.option[key] === "object"
                || (warning.option[key] || "").length >= 100
            ) {
                delete warning.option[key];
            }
        });
        warning.source_autofix = (
            lines_extra[warning.line]
            && lines_extra[warning.line].source_autofix
        );
        warning.stack = warning.stack || new Error().stack;
    }
    warnings.unshift(warning);
};
}());



// run shared js-env code - function
(function () {
local.jslintAndPrint = function (code, file, opt) {
/*
 * this function will jslint / csslint <code> and print any errors to stderr
 */
    var tmp;
    if (!(opt && opt.modeNext)) {
        local.jslintResult = {
            modeNext: 0
        };
    }
    code = code || "";
    file = file || "undefined";
    opt = Object.assign(local.jslintResult, opt || {}, {
        code,
        file
    });
    opt.modeNext += 1;
    switch (opt.modeNext) {
    // jslint - init
    case 1:
        // cleanup
        opt.errList = [];
        opt.errText = "";
        switch (opt.fileType0) {
        // deembed-js - '\\n\\\n...\\n\\\n'
        case ".\\n\\":
            // rgx - remove \\n\\
            code = code.replace((
                /\\n\\$|\\(.)/gm
            ), function (match0) {
                return (
                    match0 === "\\n\\"
                    ? ""
                    : match0[1]
                );
            });
            break;
        // deembed-js - '\n...\n'
        case ".sh":
            // rgx - convert '"'"' to '
            code = code.replace((
                /'"'"'/g
            ), "'");
            break;
        }
        // init
        opt = Object.assign(opt, {
            ".css": (
                /^\/\*csslint\b|(^\/\*\u0020jslint\u0020utility2:true\u0020\*\/$)/m
            ),
            ".html": (
                /^\/\*csslint\b|(^\/\*\u0020jslint\u0020utility2:true\u0020\*\/$)/m
            ),
            ".js": (
                /^\/\*jslint\b|(^\/\*\u0020jslint\u0020utility2:true\u0020\*\/$)/m
            ),
            ".md": (
                /(^\/\*\u0020jslint\u0020utility2:true\u0020\*\/$)/m
            ),
            ".sh": (
                /(^#\u0020jslint\u0020utility2:true$)/m
            ),
            code0: code,
            fileType: (
                /\.\w+?$|$/m
            ).exec(file)[0]
        });
        // jslint - .json
        if (
            code && (opt.fileType === ".js" || opt.fileType === ".json")
            && !opt.fileType0
        ) {
            try {
                tmp = JSON.parse(code);
                opt.fileType = ".json";
                if (opt.autofix) {
                    code = JSON.stringify(tmp, null, 4) + "\n";
                    opt.code0 = code;
                }
                opt.modeNext = Infinity;
                break;
            } catch (errCaught) {
                if (opt.fileType === ".json") {
                    opt.errList.push({
                        column: 0,
                        evidence: code.slice(0, 100),
                        line: 0,
                        message: errCaught.message
                    });
                    opt.modeNext = Infinity;
                    break;
                }
            }
        }
        try {
            opt.conditionalPassed = opt[opt.fileType].exec(code);
        } catch (ignore) {}
        opt.utility2 = (
            opt.conditionalPassed
            && opt.conditionalPassed[1]
        ) || opt.autofix;
        if (
            opt.conditional
            && (!opt.conditionalPassed || opt.coverage)
        ) {
            break;
        }
        opt.modeNext = 10;
        break;
    // jslint - autofix
    case 11:
        code = local.jslintAutofix(code, file, opt);
        local.jslintResult = opt;
        break;
    // jslint - csslint and jslint
    case 12:
        // restore lineOffset
        code = "\n".repeat(opt.lineOffset | 0) + code;
        switch (opt.fileType) {
        case ".css":
            // csslint
            Object.assign(opt, local.CSSLint.verify(code));
            // init errList
            opt.errList = opt.messages.map(function (err) {
                err.column = err.col;
                err.message = (
                    err.type + " - " + err.rule.id + " - " + err.message
                    + "\n    " + err.rule.desc
                );
                return err;
            });
            break;
        case ".html":
        case ".md":
        case ".sh":
            break;
        default:
            // jslint - .js
            Object.assign(opt, local.jslint_extra(code, opt));
            code = opt.source_autofix || code;
            // prioritize fatal err
            opt.warnings.forEach(function (err, ii) {
                if (err.early_stop) {
                    err.message = (
                        "[JSLint was unable to finish] - "
                        + err.message
                    );
                    opt.warnings.unshift(err);
                    opt.warnings.splice(ii, 1);
                }
            });
            // init errList
            opt.errList = opt.warnings.filter(function (err) {
                return err && err.message;
            }).map(function (err) {
                err.column = err.column + 1;
                err.evidence = err.source;
                err.line = err.line + 1;
                return err;
            });
        }
        break;
    // jslint - utility2
    case 13:
        local.jslintUtility2(code, file, opt);
        break;
    // jslint - print
    default:
        switch (Boolean(opt.fileType0) && opt.fileType0) {
        // reembed-js - '\\n\\\n...\\n\\\n'
        case ".\\n\\":
            code = code.trim();
            // rgx - escape \ to \\
            code = code.replace((
                /\\/g
            ), "\\\\");
            // rgx - append \n\
            code = code.replace((
                /$/gm
            ), "\\n\\");
            // rgx - escape ' to \'
            code = code.replace((
                /'/g
            ), "\\'");
            code += "\n";
            break;
        // reembed-js - '\n...\n'
        case ".sh":
            // rgx - escape ' to '"'"'
            code = code.trim().replace((
                /'/g
            ), "'\"'\"'") + "\n";
            break;
        case false:
            code = code.trimRight() + "\n";
            break;
        default:
            code = code.trim() + "\n";
        }
        // autofix-save
        if (
            !local.isBrowser
            && opt.autofix
            && !opt.fileType0
            && !opt.stop
            && code !== opt.code0
            && local.fs.existsSync(file)
        ) {
            local.fs.writeFileSync(file, code);
            local.fs.writeFileSync(file + ".autofix.old", opt.code0);
            local.child_process.spawnSync(
                "diff",
                [
                    "-u", file + ".autofix.old", file
                ],
                {
                    stdio: [
                        "ignore", 2, "ignore"
                    ]
                }
            );
            local.fs.unlinkSync(file + ".autofix.old");
            console.error(
                "\u001b[1mjslint-autofix - modified and saved file " + file
                + "\u001b[22m"
            );
        }
        // print colorized err.message to stderr
        // https://github.com/kaizhu256/JSLint/blob/cli/cli.js#L99
        opt.errList.filter(function (warning) {
            return warning && warning.message;
        // print only first 10 warnings
        }).slice(0, 10).forEach(function (err, ii) {
            opt.errText = (
                opt.errText || " \u001b[1mjslint " + file + "\u001b[22m\n"
            );
            opt.errText += (
                ("  " + String(ii + 1)).slice(-3)
                + " \u001b[31m" + err.message + "\u001b[39m"
                + " \u001b[90m\/\/ line " + err.line + ", column "
                + err.column
                + "\u001b[39m\n"
                + ("    " + String(err.evidence).trim()).slice(0, 80) + "\n"
            );
            if (!ii && err.stack && err.a !== "debug\u0049nline") {
                tmp = err.stack;
                err.stack = null;
                opt.errText += (
                    JSON.stringify(err, null, 4) + "\n" + tmp.trim() + "\n"
                );
            }
        });
        opt.errText = opt.errText.trim();
        if (opt.errText) {
            // debug jslintResult
            local._debugJslintResult = local.jslintResult;
            // print err to stderr
            console.error(opt.errText);
        }
        return code;
    }
    // recurse
    return local.jslintAndPrint(code, file, opt);
};

local.jslintAndPrintDir = function (dir, opt, onError) {
/*
 * this function will jslint files in shallow <dir>
 */
    var onParallel;
    onParallel = local.onParallel(onError);
    local.fs.readdirSync(dir).forEach(function (file) {
        var timeStart;
        file = process.cwd() + "/" + file;
        switch ((
            /\.\w+?$|$/m
        ).exec(file)[0]) {
        case ".css":
        case ".html":
        case ".js":
        case ".json":
        case ".md":
        case ".sh":
            if ((
                /\b(?:assets\.app\.js|lock|min|raw|rollup)\b/
            ).test(file)) {
                return;
            }
            onParallel.counter += 1;
            // jslint file
            local.fs.readFile(file, "utf8", function (err, data) {
                // validate no err occurred
                local.assertThrow(!err, err);
                timeStart = Date.now();
                local.jslintAndPrint(data, file, opt);
                console.error(
                    "jslint - " + (Date.now() - timeStart) + "ms " + file
                );
                onParallel();
            });
            break;
        }
    });
};

local.jslintAutofix = function (code, file, opt) {
/*
 * this function will jslint-autofix <code>
 */
    var code0;
    var code2;
    var dataList;
    var ignoreList;
    var ii;
    var rgx1;
    var rgx2;
    var tmp;
    // autofix-all
    if (opt.autofix) {
        // autofix-all - normalize local-function
        if (typeof(
            globalThis.utility2
            && globalThis.utility2.jslintAutofixLocalFunction
        ) === "function") {
            code = globalThis.utility2.jslintAutofixLocalFunction(code, file);
        }
        // autofix-all - remove trailing-whitespace
        code = code.replace((
            /\u0020+$/gm
        ), "");
        // autofix-all - remove leading-whitespace before )]}
        code = code.replace((
            /\n+?(\n\u0020*?[)\]}])/g
        ), "$1");
        // autofix-all - normalize newlines to \n\n
        code = code.replace((
            /([^\n])\n{3}([^\n])/g
        ), "$1\n\n$2");
        // autofix-all - normalize newlines to \n\n\n\n
        code = code.replace((
            /\n{5,}/g
        ), "\n\n\n\n");
        // autofix-all - recurse <script>...</script>, <style>...</style>
        code = code.replace((
            /(^\/\*\u0020jslint\u0020utility2:true\u0020\*\/\\n\\\n(?:^.*?\\n\\\n)*?)(^(?:\/\/\u0020)?<\/(?:script|style)>\\n\\\n)/gm
        ), function (ignore, match1, match2, ii) {
            return local.jslintAndPrint(
                match1,
                file + (
                    match2.indexOf("style") >= 0
                    ? ".<style>.css"
                    : ".<script>.js"
                ),
                Object.assign({}, opt, {
                    fileType0: ".\\n\\",
                    lineOffset: (
                        opt.lineOffset | 0
                    ) + code.slice(0, ii).replace((
                        /.+/g
                    ), "").length,
                    modeNext: 0
                })
            ) + match2;
        });
    }
    switch (opt.autofix && opt.fileType) {
    case ".css":
        break;
    case ".html":
        // autofix-html - recurse <script>...</script>, <style>...</style>
        code = code.replace((
            /(^\/\*\u0020jslint\u0020utility2:true\u0020\*\/\n(?:^.*?\n)*?)(^<\/(?:script|style)>\n)/gm
        ), function (ignore, match1, match2, ii) {
            return local.jslintAndPrint(
                match1,
                file + (
                    match2.indexOf("style") >= 0
                    ? ".<style>.css"
                    : ".<script>.js"
                ),
                local.objectAssignDefault({
                    fileType0: opt.fileType,
                    lineOffset: (
                        (opt.lineOffset | 0)
                        + code.slice(0, ii).replace((
                            /.+/g
                        ), "").length
                    ),
                    modeNext: 0
                }, opt)
            ) + match2;
        });
        break;
    case ".js":
        // autofix-js - demux code to [code, ignoreList]
        ignoreList = [];
        code = code.replace((
            /^\u0020*?\/\*\u0020jslint\u0020ignore:start\u0020\*\/$[\S\s]*?^\/\*\u0020jslint\u0020ignore:end\u0020\*\/$/gm
        ), function (match0) {
            ignoreList.push(match0);
            return "/* jslint ignore:start:end */";
        });
        // autofix-js - escape non-ascii
        code = code.replace((
            /[^\n\r\t\u0020-\u007e]/g
        ), function (match0) {
            return "\\u" + (
                "0000"
                + match0.charCodeAt(0).toString(16)
            ).slice(-4);
        });
        // autofix-js - demux code2 to [code2, ignoreList]
        code2 = "";
        dataList = [];
        ii = 0;
        rgx1 = (
            /\\.|\/\*|\*\/|\/\/!!|\/\/|["'\/`]|$/gm
        );
        // parse rgx
        // https://github.com/douglascrockford/JSLint/blob/557afd32bcaa35480d31a86f02d3a8c06a4e5b5c/jslint.js#L1383
        rgx2 = (
            /(?:[^.]\b(?:case|delete|in|instanceof|new|return|typeof|void|yield)|[!%&\u0028*+,\-:;<=>?\[\^{|}~])[\s\u0028]*?\/[^*\/]/g
        );
        tmp = "";
        // autofix-js - demux shebang
        code.replace((
            /^#!.*/
        ), function (match0) {
            code2 += "#!";
            dataList.push({
                code: match0,
                type: "#_"
            });
            rgx1.lastIndex = match0.length;
            ii = rgx1.lastIndex;
        });
        while (rgx1.lastIndex < code.length) {
            tmp = rgx1.exec(code);
            if (!tmp) {
                break;
            }
            tmp.input = null;
            switch (tmp[0]) {
            case "":
                rgx1.lastIndex += 1;
                break;
            case "\"":
            case "'":
            case "/*":
            case "//!!":
            case "//":
            case "`":
                // autofix-js - normalize rgx /_*/ to /_/
                rgx2.lastIndex = ii;
                if (rgx2.test(code) && rgx2.lastIndex - 2 <= tmp.index) {
                    rgx1.lastIndex = rgx2.lastIndex - 1;
                    tmp[0] = "/";
                }
                code2 += code.slice(ii, rgx1.lastIndex);
                ii = rgx1.lastIndex;
                while (rgx1.lastIndex < code.length) {
                    tmp[1] = rgx1.exec(code)[0];
                    switch (tmp[0] + "_" + tmp[1]) {
                    case "\"_\"":
                    case "'_'":
                    case "/*_*/":
                    case "//!!_":
                    case "//_":
                    case "/_*/":
                    case "/_/":
                    case "`_`":
                        code2 += "_" + tmp[1];
                        dataList.push({
                            code: tmp[0] + code.slice(ii, rgx1.lastIndex),
                            type: (tmp[0] + "_" + tmp[1]).replace("/_*/", "/_/")
                        });
                        ii = 0;
                        break;
                    case "/_":
                        code2 += code.slice(ii, rgx1.lastIndex);
                        ii = 0;
                        break;
                    }
                    if (!ii) {
                        break;
                    }
                    if (!tmp[1]) {
                        rgx1.lastIndex += 1;
                    }
                }
                ii = rgx1.lastIndex;
                break;
            }
        }
        code2 += code.slice(ii);
        code = code2;
        // autofix-js - normalize rgx /_*/ to /_/
        code = code.replace((
            /\/_\*\//g
        ), "/_/");
        opt.codeDemux = code;
        // autofix-js - left-align comment //_
        tmp = null;
        code = code.split("\n").reverse().map(function (line) {
            if ((
                /^\u0020+?\/\/_/
            ).test(line)) {
                return (
                    tmp
                    ? tmp[0].slice(0, -1) + line.trimLeft()
                    : line
                );
            }
            tmp = (
                /^\u0020*?\S/
            ).exec(line);
            return line;
        }).reverse().join("\n");
        // autofix-js - normalize prefix-operators to beginning-of-line
        // https://stackoverflow.com/questions/12122293/list-of-all-binary-operators-in-javascript
        code = code.replace((
            /(\S)\u0020+?(!=|!==|%|&|&&|-|:|<|<<|<=|==|===|>|>=|>>|>>>|\*|\+|\/|\?|\^|\||\|\|)((?:\s*?\/\*_\*\/|\s*?\/\/_)*)\s*?\n/g
        ), "$1$3\n$2");
        // autofix-js-braket - normalize rgx /_/ to (/_/)
        code = code.replace((
            /\/_\/[\w\s]*(\S)/g
        ), function (match0, match1) {
            return (
                match1 === ")"
                ? match0
                : match0.replace((
                    /\/_\/\w*/
                ), "($&)")
            );
        });
        // autofix-js-braket - normalize rgx (/_/) to (\n/_/\n)
        code = code.replace((
            /\((\/_\/\w*)\)/g
        ), "(\n$1\n)");
        // autofix-js-braket - normalize to jslint-open-form (\n...\n)
        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Expressions_and_Operators#Assignment
        code = code.replace((
            /\u0020(%=|&=|-=|<<=|=|>>=|>>>=|\*=|\*\*=|\+=|\/=|\^=|\|=)\n/g
        ), " $1  \n");
        code = code.replace((
            /\u0020(%=|&=|-=|<<=|=|>>=|>>>=|\*=|\*\*=|\+=|\/=|\^=|\|=|return)\u0020([^\n;]*?[^\n(;\[{]\n[\S\s]*?);/g
        ), function (match0, match1, match2) {
            if (!(
                /^\u0020\n|\u0020{4}(?:!=|!==|%|&|&&|-|:|<|<<|<=|==|===|>|>=|>>|>>>|\*|\+|\/|\?|\^|\||\|\|)\u0020/
            ).test(match2) || (
                /\bfunction\u0020\(/
            ).test(match2)) {
                return match0;
            }
            return " " + match1 + " (\n    " + match2.trim() + "\n);";
        });
        code = code.replace((
            /(\(\n)(\S)/g
        ), "$1    $2");
        // autofix-js-braket - remove leading-whitespace from ([{
        code = code.replace((
            /\n+\s*?([(\[{])\n/g
        ), "\u0000$1\n");
        code = code.replace((
            /\/\*_\*\/\u0000|\/\/_\u0000/g
        ), "$&\n");
        code = code.replace((
            /\u0000/g
        ), "");
        // autofix-js-braket - normalize {... to {\n   ...
        code = code.replace((
            /^(\u0020+)(.*?(?:\u0020\[|\(\[|\{))\u0020*?(\S)/gm
        ), "$1$2\n$1    $3");
        // autofix-js-braket - normalize {\s+} to {}
        code = code.replace((
            /([(\[{])\s+([)\]}])/g
        ), "$1$2");
        // autofix-js-whitespace - remove trailing-whitespace
        code = code.replace((
            /\u0020+$/gm
        ), "");
        // autofix-js-whitespace - normalize 8-space-indent to 4-space-indent
        tmp = "";
        code = code.replace((
            /^\u0020+/gm
        ), function (match0) {
            if (match0.length > tmp.length + 4) {
                match0 = tmp;
            }
            tmp = match0;
            return match0;
        });
        code = ("\n" + code + "\n");
        // autofix-js-whitespace - normalize comment //_... to //_\n...
        code = code.replace((
            /\/\/_([^\n])/g
        ), "//_\n$1");
        // autofix-js-whitespace - normalize (function { to \n\n\n\n(function {
        code = code.replace((
            /\n+((?:\/\*_\*\/\n|\/\/_\n)*?\(function\u0020.*?)\n+/g
        ), "\n\n\n\n$1\n");
        // autofix-js-whitespace - ...}()); to ...}());\n\n\n\n
        code = code.replace((
            /\n+(\}\(.*\)\);)\n+/g
        ), "\n$1\n\n\n\n");
        // autofix-js-whitespace - remove double-whitespace
        code = code.replace((
            /(\S\u0020)\u0020+/g
        ), "$1");
        code = code.trim();
        dataList.forEach(function (data) {
            switch (data.type) {
            case "'_'":
                // autofix-js - normalize single-quote to double-quote
                if (data.code[0] === "'") {
                    data.code = (
                        "\"" + data.code.slice(1, -1).replace((
                            /\\.|"/g
                        ), function (match0) {
                            return (
                                match0[1] === ""
                                ? "\\\""
                                : match0[1] === "'"
                                ? "'"
                                : match0
                            );
                        }) + "\""
                    );
                }
                break;
            case "/*_*/":
                // autofix-js - comment - "/*" to "/\*"
                data.code = "/*" + data.code.slice(2).replace((
                    /\/\*/g
                ), "/\\*");
                break;
            case "/_/":
                // autofix-js - rgx - " " -> "\\u0020"
                data.code = data.code.replace((
                    /\u0020/g
                ), "\\u0020");
                // autofix-js - rgx - "-]" -> "\-]"
                data.code = data.code.replace((
                    /\\.|-\]/g
                ), function (match0) {
                    return (
                        match0[0] === "-"
                        ? "\\" + match0
                        : match0
                    );
                });
                break;
            }
            // autofix-js - ascii
            data.code = data.code.replace((
                /\r/g
            ), "\\r").replace((
                /\t/g
            ), "\\t");
        });
        // autofix-js - remux shebang
        code = code.replace((
            /^#!/
        ), function () {
            return dataList.shift().code;
        });
        // autofix-js - remux [code, dataList] to code
        code = code.replace((
            /"_"|'_'|\/\*_\*\/|\/\/!!_|\/\/_|\/_\/|`_`/g
        ), function (match0) {
            // autofix-js - defer remux rgx /_/
            if (match0 === "/_/") {
                dataList.push(dataList.shift());
                return "/\u0000/";
            }
            return dataList.shift().code;
        });
        // autofix-js - jslint autofixed code
        ii = 0;
        while (true) {
            ii += 1;
            code0 = code;
            Object.assign(opt, local.jslint_extra(code, opt));
            code = opt.source_autofix;
            if (ii >= 10 || opt.stop || code0 === code) {
                break;
            }
        }
        // autofix-js - remux - code, dataList.</_/> -> code
        code = code.replace((
            /\/\u0000\//g
        ), function () {
            return dataList.shift().code;
        });
        // autofix-js - sort const, let, var
        code = code.replace((
            /(?:^\u0020*?(?:const|let|var)\u0020[\w$]*?;.*?\n)+/gm
        ), function (match0) {
            return match0.split("\n").slice(0, -1).sort().join("\n") + "\n";
        });
        // autofix-js - remux - code, ignoreList -> code
        code = code.replace((
            /^\u0020*?\/\*\u0020jslint\u0020ignore:start:end\u0020\*\/$/gm
        ), function () {
            return ignoreList.shift().trimLeft();
        });
        break;
    case ".md":
        // autofix-md - recurse ```javascript...```
        code = code.replace((
            /(```javascript\n)([\S\s]*?)\n```/g
        ), function (ignore, match1, match2, ii) {
            return match1 + local.jslintAndPrint(
                match2,
                file + ".<```javascript>.js",
                Object.assign({}, opt, {
                    fileType0: opt.fileType,
                    lineOffset: code.slice(0, ii).replace((
                        /.+/g
                    ), "").length + 1,
                    modeNext: 0
                })
            ) + "```";
        });
        break;
    case ".sh":
        // autofix-sh - recurse node -e '...'
        code = code.replace((
            /(\bUTILITY2_MACRO_JS='\n|\bnode\u0020-e\u0020(?:"\$UTILITY2_MACRO_JS")?'\n)([\S\s]*?)\n'/g
        ), function (ignore, match1, match2, ii) {
            return match1 + local.jslintAndPrint(
                match2,
                file + ".<node -e>.js",
                Object.assign({}, opt, {
                    fileType0: opt.fileType,
                    lineOffset: code.slice(0, ii).replace((
                        /.+/g
                    ), "").length + 1,
                    modeNext: 0
                })
            ) + "'";
        });
        break;
    }
    return code;
};

local.jslintGetColumnLine = function (code, ii) {
/*
 * this function will transform <code> and <ii> -> {column, line, evidence}
 */
    var column;
    var evidence;
    var line;
    evidence = code.slice(0, ii).split("\n");
    line = evidence.length - 1;
    column = evidence[line].length;
    evidence = evidence[line] + code.slice(ii, ii + 100).split("\n")[0];
    return {
        column,
        evidence,
        line
    };
};

local.jslintResult = {};

local.jslintUtility2 = function (code, ignore, opt) {
/*
 * this function will jslint <code> with utiity2-specific rules
 */
    var code2;
    var err;
    var indent;
    var previous;
    // jslintUtility2 - all
    if (opt.utility2) {
        code2 = code;
        code2 = code2.replace((
            /^\/\*\u0020jslint\u0020ignore:start\u0020\*\/$[\S\s]+?^\/\*\u0020jslint\u0020ignore:end\u0020\*\/$/gm
        ), function (match0) {
            // preserve lineno
            return match0.replace((
                /.+/g
            ), "");
        });
        code2.replace((
            /^\u0020+?(?:\*|\/\/!!)|^\u0020+|[\r\t]/gm
        ), function (match0, ii) {
            switch (match0.slice(-1)) {
            case " ":
                if (match0.length % 4 === 0) {
                    return;
                }
                err = {
                    message: "non 4-space indent"
                };
                break;
            case "\r":
                err = {
                    message: "unexpected \\r"
                };
                break;
            case "\t":
                err = {
                    message: "unexpected \\t"
                };
                break;
            default:
                return;
            }
            Object.assign(err, local.jslintGetColumnLine(code2, ii));
            opt.errList.push({
                column: err.column + 1,
                evidence: JSON.stringify(err.evidence),
                line: err.line + 1,
                message: err.message
            });
        });
    }
    switch (opt.utility2 && opt.fileType) {
    // jslintUtility2 - .css
    case ".css":
        // ignore comment
        code2 = code2.replace((
            /^\u0020*?\/\*[\S\s]*?\*\/\u0020*?$/gm
        ), function (match0) {
            // preserve lineno
            return match0.replace((
                /.+/g
            ), "");
        });
        code2.replace((
            /\S\u0020{2}|\u0020,|^\S.*?[,;{}]./gm
        ), function (match0, ii) {
            switch (match0.slice(-2)) {
            case "  ":
                err = {
                    colOffset: 2,
                    message: "unexpected multi-whitespace"
                };
                break;
            case " ,":
                err = {
                    colOffset: 1,
                    message: "unexpected whitespace before comma"
                };
                break;
            default:
                err = {
                    colOffset: match0.length,
                    message: "unexpected multiline-statement"
                };
            }
            Object.assign(err, local.jslintGetColumnLine(code2, ii));
            opt.errList.push({
                column: err.column + err.colOffset,
                evidence: JSON.stringify(err.evidence),
                line: err.line + 1,
                message: err.message
            });
        });
        // validate line-sorted - css-selector
        previous = "";
        code2 = code2.replace((
            /^.|[#.>]|[,}]$|\u0020\{$|\b\w/gm
        ), function (match0) {
            switch (match0) {
            case " ":
                return match0;
            case " {":
                return "\u0001" + match0;
            case "#":
                return "\u0002" + match0;
            case ",":
                return "\u0000" + match0;
            case ".":
                return "\u0001" + match0;
            case ">":
                return "\u0003" + match0;
            case "}":
                return match0;
            default:
                return "\u0000" + match0;
            }
        });
        code2.replace((
            /\n{2,}|^\u0000@|^\}\n\}|\}|^(?:\S.*?\n)+/gm
        ), function (match0, ii) {
            switch (match0.slice(0, 2)) {
            case "\n\n":
            case "\u0000@":
            case "}\n":
                previous = "";
                return;
            case "}":
                return;
            }
            match0 = match0.trim();
            err = (
                !(previous < match0)
                ? {
                    message: "lines not sorted\n" + previous + "\n" + match0
                }
                : match0.split("\n").sort().join("\n") !== match0
                ? {
                    message: "lines not sorted\n" + match0
                }
                : null
            );
            if (err) {
                Object.assign(err, local.jslintGetColumnLine(code2, ii));
                opt.errList.push({
                    column: err.column + 1,
                    evidence: err.evidence,
                    line: err.line + 1,
                    message: err.message.replace((
                        /[\u0000-\u0007]/g
                    ), "")
                });
            }
            previous = match0;
        });
        break;
    // jslintUtility2 - .html
    case ".html":
        break;
    // jslintUtility2 - .js
    case ".js":
        // validate line-sorted - "local.xxx = "
        previous = "";
        code2.replace((
            /^\/\*\u0020validateLineSortedReset\u0020\*\/$|^\(function\u0020\(|(^local\.\S*?\u0020=\u0020.*?$)/gm
        ), function (ignore, match1, ii) {
            if (!match1) {
                previous = "";
                return;
            }
            if (match1.slice(-3) === "\\n\\") {
                return;
            }
            if (!(previous < match1)) {
                err = {
                    message: "lines not sorted\n" + previous + "\n" + match1
                };
                Object.assign(err, local.jslintGetColumnLine(code2, ii));
                opt.errList.push({
                    column: err.column + 1,
                    evidence: err.evidence,
                    line: err.line + 1,
                    message: err.message
                });
            }
            previous = match1;
        });
        // validate line-sorted - switch-statement
        previous = "";
        code2.replace((
            /^(\u0020+?)(\/\*\u0020validateLineSortedReset\u0020\*\/|switch\u0020.+?\u0020\{|\}|case\u0020.+?:(?:\n\u0020+?case\u0020.+?:)*|default:)$/gm
        ), function (ignore, match1, match2, ii) {
            err = null;
            switch (match2.slice(-1)) {
            case "/":
                if (match1 === indent) {
                    previous = "";
                }
                break;
            case "{":
                indent = indent || match1;
                break;
            case "}":
                if (match1 === indent) {
                    indent = "";
                    previous = "";
                }
                break;
            default:
                if (match1 !== indent) {
                    break;
                }
                match2 = match2.replace((
                    /\d+?\b/g
                ), function (match0) {
                    return ("0000" + match0).slice(-4);
                });
                if (!(previous < match2)) {
                    err = {
                        message: (
                            "lines not sorted\n" + previous + "\n" + match2
                        )
                    };
                }
                previous = match2;
            }
            if (err) {
                Object.assign(err, local.jslintGetColumnLine(code2, ii));
                opt.errList.push({
                    column: err.column + 1,
                    evidence: err.evidence,
                    line: err.line + 1,
                    message: err.message
                });
            }
        });
        break;
    // jslintUtility2 - .md
    case ".md":
        break;
    // jslintUtility2 - .sh
    case ".sh":
        previous = "";
        code2.replace((
            /(^sh\w+?\u0020\(\)\u0020\{)|^sh\w+?\u0020*?\(\)\u0020*?\{/gm
        ), function (ignore, match1, ii) {
            err = null;
            if (!match1) {
                err = {
                    message: "invalid whitespace"
                };
            } else {
                if (!(previous < match1)) {
                    err = {
                        message: (
                            "lines not sorted\n" + previous + "\n" + match1
                        )
                    };
                }
                previous = match1;
            }
            if (err) {
                Object.assign(err, local.jslintGetColumnLine(code2, ii));
                opt.errList.push({
                    column: err.column + 1,
                    evidence: err.evidence,
                    line: err.line + 1,
                    message: err.message
                });
            }
        });
        // validate line-sorted - case-esac-statement
        previous = "";
        code2.replace((
            /^(\u0020+?)(case\u0020.+?\u0020in|esac|[^\u0020()]+?\))$/gm
        ), function (ignore, match1, match2, ii) {
            err = null;
            match2 = match2.replace("*", "~*");
            switch (match2.slice(0, 5)) {
            case "case ":
                indent = indent || match1;
                break;
            case "esac":
                if (match1 === indent) {
                    indent = "";
                    previous = "";
                }
                break;
            default:
                if (match1 !== indent) {
                    break;
                }
                if (!(previous < match2)) {
                    err = {
                        message: (
                            "lines not sorted\n" + previous + "\n" + match2
                        )
                    };
                }
                previous = match2;
            }
            if (err) {
                Object.assign(err, local.jslintGetColumnLine(code2, ii));
                opt.errList.push({
                    column: err.column + 1,
                    evidence: err.evidence,
                    line: err.line + 1,
                    message: err.message
                });
            }
        });
        break;
    }
};
}());



/* istanbul ignore next */
// run node js-env code - init-after
(function () {
if (local.isBrowser) {
    return;
}

local.cliDict = {};

local.cliDict._default = function () {
/*
 * <file1> <file2> ...
 * will jslint <file1> <file2> ... and print errors to stderr
 */
    // jslint files
    process.argv.slice(2).forEach(function (file) {
        if (file[0] === "-") {
            return;
        }
        local.jslintAndPrint(
            local.fs.readFileSync(local.path.resolve(file), "utf8"),
            file,
            {
                autofix: process.argv.indexOf("--autofix") >= 0,
                conditional: process.argv.indexOf("--conditional") >= 0
            }
        );
    });
    // if err occurred, then exit with non-zero code
    process.exit(Boolean(local.jslintResult.errList.length));
};

local.cliDict.dir = function () {
/*
 * <dir>
 * will jslint files in shallow <dir>
 */
    local.jslintAndPrintDir(process.argv[3], {
        autofix: process.argv.indexOf("--autofix") >= 0,
        conditional: process.argv.indexOf("--conditional") >= 0
    }, process.exit);
};

// run the cli
if (module === require.main && !globalThis.utility2_rollup) {
    local.cliRun();
}
}());



}());
/* script-end /assets.utility2.lib.jslint.js */



/* script-begin /assets.utility2.lib.marked.js */
// usr/bin/env node



/* istanbul instrument in package marked */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_marked = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.marked = local;



/* validateLineSortedReset */
return;
}());



/* jslint ignore:start */
(function () { var exports, module; exports = module = {};
// rollup-file marked.js
// 2017-01-19T23:03:37Z
// https://github.com/markedjs/marked/blob/v0.3.7/lib/marked.js
// utility2-uglifyjs https://raw.githubusercontent.com/chjj/marked/v0.3.7/lib/marked.js > /tmp/out.js
(function(){function t(t){this.tokens=[],this.tokens.links={},this.options=t||c.
defaults,this.rules=e.normal,this.options.gfm&&(this.options.tables?this.rules=e
.tables:this.rules=e.gfm)}function r(e,t){this.options=t||c.defaults,this.links=
e,this.rules=n.normal,this.renderer=this.options.renderer||new i,this.renderer.options=
this.options;if(!this.links)throw new Error("Tokens array requires a `links` property."
);this.options.gfm?this.options.breaks?this.rules=n.breaks:this.rules=n.gfm:this
.options.pedantic&&(this.rules=n.pedantic)}function i(e){this.options=e||{}}function s
(e){this.tokens=[],this.token=null,this.options=e||c.defaults,this.options.renderer=
this.options.renderer||new i,this.renderer=this.options.renderer,this.renderer.options=
this.options}function o(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace
(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}
function u(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/g,function(
e,t){return t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?
String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring
(1)):""})}function a(e,t){return e=e.source,t=t||"",function n(r,i){return r?(i=
i.source||i,i=i.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(r,i),n):new RegExp(e,t)
}}function f(){}function l(e){var t=1,n,r;for(;t<arguments.length;t++){n=arguments
[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}function c
(e,n,r){if(r||typeof n=="function"){r||(r=n,n=null),n=l({},c.defaults,n||{});var i=
n.highlight,u,a,f=0;try{u=t.lex(e,n)}catch(h){return r(h)}a=u.length;var p=function(
e){if(e)return n.highlight=i,r(e);var t;try{t=s.parse(u,n)}catch(o){e=o}return n
.highlight=i,e?r(e):r(null,t)};if(!i||i.length<3)return p();delete n.highlight;if(!
a)return p();for(;f<u.length;f++)(function(e){return e.type!=="code"?--a||p():i(
e.text,e.lang,function(t,n){if(t)return p(t);if(n==null||n===e.text)return--a||p
();e.text=n,e.escaped=!0,--a||p()})})(u[f]);return}try{return n&&(n=l({},c.defaults
,n)),s.parse(t.lex(e,n),n)}catch(h){h.message+="\nPlease report this to https://github.com/chjj/marked."
;if((n||c.defaults).silent)return"<p>An error occured:</p><pre>"+o(h.message+"",!0
)+"</pre>";throw h}}var e={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:f,hr:/^( *[-*_]){3,} *(?:\n+|$)/
,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:f,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/
,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/
,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/
,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:f
,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text
:/^[^\n]+/};e.bullet=/(?:[*+-]|\d+\.)/,e.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/
,e.item=a(e.item,"gm")(/bull/g,e.bullet)(),e.list=a(e.list)(/bull/g,e.bullet)("hr"
,"\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+e.def.source+")")(),e.
blockquote=a(e.blockquote)("def",e.def)(),e._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b"
,e.html=a(e.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing"
,/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,e._tag)(),e.paragraph=a(e.paragraph
)("hr",e.hr)("heading",e.heading)("lheading",e.lheading)("blockquote",e.blockquote
)("tag","<"+e._tag)("def",e.def)(),e.normal=l({},e),e.gfm=l({},e.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\s*\1 *(?:\n+|$)/
,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),e.gfm.paragraph=
a(e.paragraph)("(?!","(?!"+e.gfm.fences.source.replace("\\1","\\2")+"|"+e.list.source
.replace("\\1","\\3")+"|")(),e.tables=l({},e.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/
,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),t.rules=e,t
.lex=function(e,n){var r=new t(n);return r.lex(e)},t.prototype.lex=function(e){return e=
e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g
,"\n"),this.token(e,!0)},t.prototype.token=function(t,n,r){var t=t.replace(/^ +$/gm
,""),i,s,o,u,a,f,l,c,h;while(t){if(o=this.rules.newline.exec(t))t=t.substring(o[0
].length),o[0].length>1&&this.tokens.push({type:"space"});if(o=this.rules.code.exec
(t)){t=t.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),this.tokens.push({type
:"code",text:this.options.pedantic?o:o.replace(/\n+$/,"")});continue}if(o=this.rules
.fences.exec(t)){t=t.substring(o[0].length),this.tokens.push({type:"code",lang:o
[2],text:o[3]||""});continue}if(o=this.rules.heading.exec(t)){t=t.substring(o[0]
.length),this.tokens.push({type:"heading",depth:o[1].length,text:o[2]});continue}
if(n&&(o=this.rules.nptable.exec(t))){t=t.substring(o[0].length),f={type:"table"
,header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g
,"").split(/ *\| */),cells:o[3].replace(/\n$/,"").split("\n")};for(c=0;c<f.align
.length;c++)/^ *-+: *$/.test(f.align[c])?f.align[c]="right":/^ *:-+: *$/.test(f.
align[c])?f.align[c]="center":/^ *:-+ *$/.test(f.align[c])?f.align[c]="left":f.align
[c]=null;for(c=0;c<f.cells.length;c++)f.cells[c]=f.cells[c].split(/ *\| */);this
.tokens.push(f);continue}if(o=this.rules.lheading.exec(t)){t=t.substring(o[0].length
),this.tokens.push({type:"heading",depth:o[2]==="="?1:2,text:o[1]});continue}if(
o=this.rules.hr.exec(t)){t=t.substring(o[0].length),this.tokens.push({type:"hr"}
);continue}if(o=this.rules.blockquote.exec(t)){t=t.substring(o[0].length),this.tokens
.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),this.token(o,n,!0
),this.tokens.push({type:"blockquote_end"});continue}if(o=this.rules.list.exec(t
)){t=t.substring(o[0].length),u=o[2],this.tokens.push({type:"list_start",ordered
:u.length>1}),o=o[0].match(this.rules.item),i=!1,h=o.length,c=0;for(;c<h;c++)f=o
[c],l=f.length,f=f.replace(/^ *([*+-]|\d+\.) +/,""),~f.indexOf("\n ")&&(l-=f.length
,f=this.options.pedantic?f.replace(/^ {1,4}/gm,""):f.replace(new RegExp("^ {1,"+
l+"}","gm"),"")),this.options.smartLists&&c!==h-1&&(a=e.bullet.exec(o[c+1])[0],u!==
a&&!(u.length>1&&a.length>1)&&(t=o.slice(c+1).join("\n")+t,c=h-1)),s=i||/\n\n(?!\s*$)/
.test(f),c!==h-1&&(i=f.charAt(f.length-1)==="\n",s||(s=i)),this.tokens.push({type
:s?"loose_item_start":"list_item_start"}),this.token(f,!1,r),this.tokens.push({type
:"list_item_end"});this.tokens.push({type:"list_end"});continue}if(o=this.rules.
html.exec(t)){t=t.substring(o[0].length),this.tokens.push({type:this.options.sanitize?"paragraph"
:"html",pre:!this.options.sanitizer&&(o[1]==="pre"||o[1]==="script"||o[1]==="style"
),text:o[0]});continue}if(!r&&n&&(o=this.rules.def.exec(t))){t=t.substring(o[0].
length),this.tokens.links[o[1].toLowerCase()]={href:o[2],title:o[3]};continue}if(
n&&(o=this.rules.table.exec(t))){t=t.substring(o[0].length),f={type:"table",header
:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g
,"").split(/ *\| */),cells:o[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(c=0
;c<f.align.length;c++)/^ *-+: *$/.test(f.align[c])?f.align[c]="right":/^ *:-+: *$/
.test(f.align[c])?f.align[c]="center":/^ *:-+ *$/.test(f.align[c])?f.align[c]="left"
:f.align[c]=null;for(c=0;c<f.cells.length;c++)f.cells[c]=f.cells[c].replace(/^ *\| *| *\| *$/g
,"").split(/ *\| */);this.tokens.push(f);continue}if(n&&(o=this.rules.paragraph.
exec(t))){t=t.substring(o[0].length),this.tokens.push({type:"paragraph",text:o[1
].charAt(o[1].length-1)==="\n"?o[1].slice(0,-1):o[1]});continue}if(o=this.rules.
text.exec(t)){t=t.substring(o[0].length),this.tokens.push({type:"text",text:o[0]
});continue}if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0))}return this
.tokens};var n={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/
,url:f,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/
,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/
,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/
,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:f,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/
};n._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,n._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/
,n.link=a(n.link)("inside",n._inside)("href",n._href)(),n.reflink=a(n.reflink)("inside"
,n._inside)(),n.normal=l({},n),n.pedantic=l({},n.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/
,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),n.gfm=l({},n.normal
,{escape:a(n.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del
:/^~~(?=\S)([\s\S]*?\S)~~/,text:a(n.text)("]|","~]|")("|","|https?://|")()}),n.breaks=
l({},n.gfm,{br:a(n.br)("{2,}","*")(),text:a(n.gfm.text)("{2,}","*")()}),r.rules=
n,r.output=function(e,t,n){var i=new r(t,n);return i.output(e)},r.prototype.output=
function(e){var t="",n,r,i,s;while(e){if(s=this.rules.escape.exec(e)){e=e.substring
(s[0].length),t+=s[1];continue}if(s=this.rules.autolink.exec(e)){e=e.substring(s
[0].length),s[2]==="@"?(r=s[1].charAt(6)===":"?this.mangle(s[1].substring(7)):this
.mangle(s[1]),i=this.mangle("mailto:")+r):(r=o(s[1]),i=r),t+=this.renderer.link(
i,null,r);continue}if(!this.inLink&&(s=this.rules.url.exec(e))){e=e.substring(s[0
].length),r=o(s[1]),i=r,t+=this.renderer.link(i,null,r);continue}if(s=this.rules
.tag.exec(e)){!this.inLink&&/^<a /i.test(s[0])?this.inLink=!0:this.inLink&&/^<\/a>/i
.test(s[0])&&(this.inLink=!1),e=e.substring(s[0].length),t+=this.options.sanitize?
this.options.sanitizer?this.options.sanitizer(s[0]):o(s[0]):s[0];continue}if(s=this
.rules.link.exec(e)){e=e.substring(s[0].length),this.inLink=!0,t+=this.outputLink
(s,{href:s[2],title:s[3]}),this.inLink=!1;continue}if((s=this.rules.reflink.exec
(e))||(s=this.rules.nolink.exec(e))){e=e.substring(s[0].length),n=(s[2]||s[1]).replace
(/\s+/g," "),n=this.links[n.toLowerCase()];if(!n||!n.href){t+=s[0].charAt(0),e=s
[0].substring(1)+e;continue}this.inLink=!0,t+=this.outputLink(s,n),this.inLink=!1
;continue}if(s=this.rules.strong.exec(e)){e=e.substring(s[0].length),t+=this.renderer
.strong(this.output(s[2]||s[1]));continue}if(s=this.rules.em.exec(e)){e=e.substring
(s[0].length),t+=this.renderer.em(this.output(s[2]||s[1]));continue}if(s=this.rules
.code.exec(e)){e=e.substring(s[0].length),t+=this.renderer.codespan(o(s[2],!0));
continue}if(s=this.rules.br.exec(e)){e=e.substring(s[0].length),t+=this.renderer
.br();continue}if(s=this.rules.del.exec(e)){e=e.substring(s[0].length),t+=this.renderer
.del(this.output(s[1]));continue}if(s=this.rules.text.exec(e)){e=e.substring(s[0
].length),t+=this.renderer.text(o(this.smartypants(s[0])));continue}if(e)throw new
Error("Infinite loop on byte: "+e.charCodeAt(0))}return t},r.prototype.outputLink=
function(e,t){var n=o(t.href),r=t.title?o(t.title):null;return e[0].charAt(0)!=="!"?
this.renderer.link(n,r,this.output(e[1])):this.renderer.image(n,r,o(e[1]))},r.prototype
.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"\u2014"
).replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g
,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d"
).replace(/\.{3}/g,"\u2026"):e},r.prototype.mangle=function(e){if(!this.options.
mangle)return e;var t="",n=e.length,r=0,i;for(;r<n;r++)i=e.charCodeAt(r),Math.random
()>.5&&(i="x"+i.toString(16)),t+="&#"+i+";";return t},i.prototype.code=function(
e,t,n){if(this.options.highlight){var r=this.options.highlight(e,t);r!=null&&r!==
e&&(n=!0,e=r)}return t?'<pre><code class="'+this.options.langPrefix+o(t,!0)+'">'+
(n?e:o(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:o(e,!0))+"\n</code></pre>"}
,i.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},
i.prototype.html=function(e){return e},i.prototype.heading=function(e,t,n){return"<h"+
t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+
e+"</h"+t+">\n"},i.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"
},i.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"
},i.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},i.prototype.paragraph=
function(e){return"<p>"+e+"</p>\n"},i.prototype.table=function(e,t){return"<table>\n<thead>\n"+
e+"</thead>\n"+"<tbody>\n"+t+"</tbody>\n"+"</table>\n"},i.prototype.tablerow=function(
e){return"<tr>\n"+e+"</tr>\n"},i.prototype.tablecell=function(e,t){var n=t.header?"th"
:"td",r=t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">";return r+e+"</"+
n+">\n"},i.prototype.strong=function(e){return"<strong>"+e+"</strong>"},i.prototype
.em=function(e){return"<em>"+e+"</em>"},i.prototype.codespan=function(e){return"<code>"+
e+"</code>"},i.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"}
,i.prototype.del=function(e){return"<del>"+e+"</del>"},i.prototype.link=function(
e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent(u(e)).replace(/[^\w:]/g
,"").toLowerCase()}catch(i){return""}if(r.indexOf("javascript:")===0||r.indexOf("vbscript:"
)===0||r.indexOf("data:")===0)return""}var s='<a href="'+e+'"';return t&&(s+=' title="'+
t+'"'),s+=">"+n+"</a>",s},i.prototype.image=function(e,t,n){var r='<img src="'+e+'" alt="'+
n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">",r},i.prototype
.text=function(e){return e},s.parse=function(e,t,n){var r=new s(t,n);return r.parse
(e)},s.prototype.parse=function(e){this.inline=new r(e.links,this.options,this.renderer
),this.tokens=e.reverse();var t="";while(this.next())t+=this.tok();return t},s.prototype
.next=function(){return this.token=this.tokens.pop()},s.prototype.peek=function(
){return this.tokens[this.tokens.length-1]||0},s.prototype.parseText=function(){
var e=this.token.text;while(this.peek().type==="text")e+="\n"+this.next().text;return this
.inline.output(e)},s.prototype.tok=function(){switch(this.token.type){case"space"
:return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.
heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code"
:return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table"
:var e="",t="",n,r,i,s,o;i="";for(n=0;n<this.token.header.length;n++)s={header:!0
,align:this.token.align[n]},i+=this.renderer.tablecell(this.inline.output(this.token
.header[n]),{header:!0,align:this.token.align[n]});e+=this.renderer.tablerow(i);
for(n=0;n<this.token.cells.length;n++){r=this.token.cells[n],i="";for(o=0;o<r.length
;o++)i+=this.renderer.tablecell(this.inline.output(r[o]),{header:!1,align:this.token
.align[o]});t+=this.renderer.tablerow(i)}return this.renderer.table(e,t);case"blockquote_start"
:var t="";while(this.next().type!=="blockquote_end")t+=this.tok();return this.renderer
.blockquote(t);case"list_start":var t="",u=this.token.ordered;while(this.next().
type!=="list_end")t+=this.tok();return this.renderer.list(t,u);case"list_item_start"
:var t="";while(this.next().type!=="list_item_end")t+=this.token.type==="text"?this
.parseText():this.tok();return this.renderer.listitem(t);case"loose_item_start":
var t="";while(this.next().type!=="list_item_end")t+=this.tok();return this.renderer
.listitem(t);case"html":var a=!this.token.pre&&!this.options.pedantic?this.inline
.output(this.token.text):this.token.text;return this.renderer.html(a);case"paragraph"
:return this.renderer.paragraph(this.inline.output(this.token.text));case"text":
return this.renderer.paragraph(this.parseText())}},f.exec=f,c.options=c.setOptions=
function(e){return l(c.defaults,e),c},c.defaults={gfm:!0,tables:!0,breaks:!1,pedantic
:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,
langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new i,xhtml:!1},c.Parser=
s,c.parser=s.parse,c.Renderer=i,c.Lexer=t,c.lexer=t.lex,c.InlineLexer=r,c.inlineLexer=
r.output,c.parse=c,typeof module!="undefined"&&typeof exports=="object"?module.exports=
c:typeof define=="function"&&define.amd?define(function(){return c}):this.marked=
c}).call(function(){return this||(typeof window!="undefined"?window:global)}())
local.marked = module.exports; }());
/* jslint ignore:end */
// init exports
if (local.isBrowser) {
    globalThis.utility2_marked = local.marked;
} else {
    module.exports = local.marked;
}
}());
/* script-end /assets.utility2.lib.marked.js */



/* script-begin /assets.utility2.lib.sjcl.js */
// usr/bin/env node



/* istanbul instrument in package sjcl */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_sjcl = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.sjcl = local;



/* validateLineSortedReset */
/*
file https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/sjcl.js
shGithubDateCommitted https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/sjcl.js # 2017-07-04T08:55:03Z
curl https://raw.githubusercontent.com/bitwiseshiftleft/sjcl/1.0.8/sjcl.js > /tmp/aa.js
*/
/* jslint ignore:start */
(function () { var module;
"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};
sjcl.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl.exception.invalid("invalid aes key size");this.b=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&
255]]};
sjcl.cipher.aes.prototype={encrypt:function(a){return t(this,a,0)},decrypt:function(a){return t(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d=b[4],e,f,g,h=[],k=[],l,n,m,p;for(e=0;0x100>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d[m]=f,n=h[e=h[l=h[f]]],p=0x1010101*n^0x10001*e^0x101*l^0x1010100*f,n=0x101*h[m]^0x1010100*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p=p<<24^p>>>8;for(e=
0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};
function t(a,b,c){if(4!==b.length)throw new sjcl.exception.invalid("invalid aes block size");var d=a.b[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,k,l,n=d.length/4-2,m,p=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v=h[2],w=h[3],x=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v[g>>8&255]^w[b&255]^d[p],k=a[f>>>24]^q[g>>16&255]^v[b>>8&255]^w[e&255]^d[p+1],l=a[g>>>24]^q[b>>16&255]^v[e>>8&255]^w[f&255]^d[p+2],b=a[b>>>24]^q[e>>16&255]^v[f>>8&255]^w[g&255]^d[p+3],p+=4,e=h,f=k,g=l;for(m=
0;4>m;m++)r[c?3&-m:m]=x[e>>>24]<<24^x[f>>16&255]<<16^x[g>>8&255]<<8^x[b&255]^d[p++],h=e,e=f,f=g,g=b,b=h;return r}
sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray.$(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===
b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+0x10000000000*a},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return!1;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===
c},$:function(a,b,c,d){var e;e=0;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&0xff00|(c&0xff00)<<8|c<<24;return a}};
sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};
sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\s|0x/g,"");d=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};
sjcl.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f="",g=0,h=sjcl.codec.base32.B,k=0,l=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32.X);for(c=0;f.length*d<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d?(k=a[c]<<d-g,g+=e,c++):(k<<=d,g-=d);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\s|=/g,"").toUpperCase();var c=sjcl.codec.base32.BITS,
d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f=[],g,h=0,k=sjcl.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p){}throw new sjcl.exception.invalid("this isn't "+m+"!");}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d,l^=n<<c-h)}h&56&&f.push(sjcl.bitArray.partial(h&56,l,1));return f}};
sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};
sjcl.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.B,g=0,h=sjcl.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c=[],d,e=0,f=sjcl.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d=0;d<a.length;d++){h=f.indexOf(a.charAt(d));
if(0>h)throw new sjcl.exception.invalid("this isn't base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl.bitArray.partial(e&56,g,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl.hash.sha256.hash=function(a){return(new sjcl.hash.sha256).update(a).finalize()};
sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.A=sjcl.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl.bitArray.bitLength(a);if(0x1fffffffffffff<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=512+b-(512+b&0x1ff);b<=a;b+=512)u(this,d.subarray(16*e,
16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&0x1ff);b<=a;b+=512)u(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/0x100000000));for(b.push(this.l|0);b.length;)u(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a){return 0x100000000*(a-Math.floor(a))|0}for(var b=0,c=2,d,e;64>b;c++){e=!0;for(d=2;d*d<=c;d++)if(0===c%d){e=
!1;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};
function u(a,b){var c,d,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d=b[c]:(d=b[c+1&15],e=b[c+14&15],d=b[c&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d=d+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p^r))+g[c],q=r,r=p,p=m,m=n+d|0,n=l,l=k,k=h,h=d+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p|0;f[6]=f[6]+r|0;f[7]=
f[7]+q|0}
sjcl.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm.G.indexOf(a);-1<a&&sjcl.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,
8*(15-f));b=sjcl.mode.ccm.V(a,b,c,d,e,f);g=sjcl.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl.mode.ccm.C(a,k,c,l,e,b);a=sjcl.mode.ccm.V(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn't match");
return k.data},na:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,k=h.i;d=[h.partial(8,(b.length?64:0)|d-2<<2|f-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:0xffffffff>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d=a.encrypt(k(d,g.slice(b,b+4).concat([0,0,0])));return d},V:function(a,b,c,d,e,f){var g=sjcl.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");
if(0xffffffff<d.length||0xffffffff<b.length)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");c=sjcl.mode.ccm.na(a,d,c,e,g.bitLength(b)/8,f);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl.mode.ccm.fa(g/
k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,l)}}};
sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.S,k=sjcl.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p=p.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));
d.length&&(n=l(n,f?d:sjcl.mode.ocb2.pmac(a,d)));return p.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.S,h=sjcl.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p,r=sjcl.bitArray.bitLength(b)-e,q=[];d=d||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p=r-32*c;m=a.encrypt(k(n,[0,0,0,p]));m=k(m,h.clamp(b.slice(c),p).concat([0,
0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d.length&&(l=k(l,f?d:sjcl.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl.exception.corrupt("ocb: tag doesn't match");return q.concat(h.clamp(m,p))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.S,e=sjcl.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);
return a.encrypt(f(d(f(h,d(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};
sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;d=d||[];a=sjcl.mode.gcm.C(!0,a,f,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl.mode.gcm.C(!1,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn't match");return a.data},ka:function(a,b){var c,d,e,f,g,h=sjcl.bitArray.i;e=[0,0,
0,0];f=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d=3;0<d;d--)f[d]=f[d]>>>1|(f[d-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-0x1f000000)}return e},j:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=0xffffffff&c[d],b[1]^=0xffffffff&c[d+1],b[2]^=0xffffffff&c[d+2],b[3]^=0xffffffff&c[d+3],b=sjcl.mode.gcm.ka(b,a);return b},C:function(a,b,c,d,e,f){var g,h,k,l,n,m,p,r,q=sjcl.bitArray;m=c.length;p=q.bitLength(c);r=q.bitLength(d);h=q.bitLength(e);
g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl.mode.gcm.j(g,[0,0,0,0],e),e=sjcl.mode.gcm.j(g,e,[0,0,Math.floor(h/0x100000000),h&0xffffffff]));h=sjcl.mode.gcm.j(g,[0,0,0,0],d);n=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p);a&&(d=sjcl.mode.gcm.j(g,h,c));a=[Math.floor(r/0x100000000),r&0xffffffff,Math.floor(p/0x100000000),p&0xffffffff];d=sjcl.mode.gcm.j(g,d,a);k=b.encrypt(e);
d[0]^=k[0];d[1]^=k[1];d[2]^=k[2];d[3]^=k[3];return{tag:q.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.W=b=b||sjcl.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};
sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=!1};sjcl.misc.hmac.prototype.update=function(a){this.aa=!0;this.R.update(a)};sjcl.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=(new this.W(this.w[1])).update(a).finalize();this.reset();return a};
sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1E4;if(0>d||0>c)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl.bitArray;for(k=1;32*l.length<(d||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d&&(l=n.clamp(l,d));return l};
sjcl.prng=function(a){this.c=[new sjcl.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=!1;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=0x10000;this.T=[0,48,64,96,128,192,0x100,384,512,768,1024];this.da=3E4;this.ba=80};
sjcl.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;if(d===this.u)throw new sjcl.exception.notReady("generator isn't seeded");if(d&this.J){d=!(d&this.I);e=[];var f=0,g;this.Z=e[0]=(new Date).valueOf()+this.da;for(g=0;16>g;g++)e.push(0x100000000*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=
f);this.P++;this.b=sjcl.hash.sha256.hash(this.b.concat(e));this.L=new sjcl.cipher.aes(this.b);for(d=0;4>d&&(this.h[d]=this.h[d]+1|0,!this.h[d]);d++);}for(d=0;d<a;d+=4)0===(d+1)%this.ca&&y(this),e=z(this),c.push(e[0],e[1],e[2],e[3]);y(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,
b,c){c=c||"user";var d,e,f=(new Date).valueOf(),g=this.H[c],h=this.isReady(),k=0;d=this.U[c];void 0===d&&(d=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case "number":void 0===b&&(b=1);this.c[g].update([d,this.N++,1,b,f,1,a|0]);break;case "object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&
(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d,this.N++,2,b,f,a.length].concat(a))}break;case "string":void 0===b&&(b=a.length);this.c[g].update([d,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},
isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&(new Date).valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)};if(window.addEventListener)window.addEventListener("load",
this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl.exception.bug("can't attach event");
this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",
this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d,e=this.K[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},la:function(){C(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C(this,0)},qa:function(a){a=
a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C(this,0)},ma:function(){C(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C(this,0)}};
function A(a,b){var c,d=sjcl.random.K[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function C(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy((new Date).valueOf(),b,"loadtime")}function y(a){a.b=z(a).concat(z(a));a.L=new sjcl.cipher.aes(a.b)}function z(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}
function B(a,b){return function(){b.apply(a,arguments)}}sjcl.random=new sjcl.prng(6);
a:try{var D,E,F,G;if(G="undefined"!==typeof module&&module.exports){var H;try{H=require("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array((new Uint8Array(D)).buffer),sjcl.random.addEntropy(D,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F);
else break a;sjcl.random.addEntropy(F,1024,"crypto['getRandomValues']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}
sjcl.json={defaults:{v:1,iter:1E4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.g({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&0x100!==f.ks||2>f.iv.length||
4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[f.cipher](a);e.g(d,f);d.key=a;f.ct="ccm"===f.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&
b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d){var e=sjcl.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.g(e.g(e.g({},e.defaults),b),c,!0);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===
typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&0x100!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl.codec.utf8String.toBits(f));g=new sjcl.cipher[b.cipher](a);f="ccm"===
b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d,b);d.key=a;return 1===c.raw?f:sjcl.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=sjcl.json;return e.ia(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+'"'+
b+'":';d=",";switch(typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+='"'+sjcl.codec.base64.fromBits(a[b],0)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type");}}return c+"}"},decode:function(a){a=a.replace(/\s/g,"");if(!a.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");
null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},sa:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},ra:function(a,
b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.pa={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.pa,d;b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};
"undefined"!==typeof module&&module.exports&&(module.exports=sjcl);"function"===typeof define&&define([],function(){return sjcl});
local.sjcl = sjcl;



/*
file https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/sha1.js
shGithubDateCommitted https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/sha1.js # 2016-06-09T23:25:22Z
curl https://raw.githubusercontent.com/bitwiseshiftleft/sjcl/1.0.8/core/sha1.js > /tmp/aa.js
*/
/** @fileOverview Javascript SHA-1 implementation.
 *
 * Based on the implementation in RFC 3174, method 1, and on the SJCL
 * SHA-256 implementation.
 *
 * @author Quinn Slack
 */

/**
 * Context for a SHA-1 operation in progress.
 * @constructor
 */
sjcl.hash.sha1 = function (hash) {
  if (hash) {
    this._h = hash._h.slice(0);
    this._buffer = hash._buffer.slice(0);
    this._length = hash._length;
  } else {
    this.reset();
  }
};

/**
 * Hash a string or an array of words.
 * @static
 * @param {bitArray|String} data the data to hash.
 * @return {bitArray} The hash value, an array of 5 big-endian words.
 */
sjcl.hash.sha1.hash = function (data) {
  return (new sjcl.hash.sha1()).update(data).finalize();
};

sjcl.hash.sha1.prototype = {
  /**
   * The hash's block size, in bits.
   * @constant
   */
  blockSize: 512,

  /**
   * Reset the hash state.
   * @return this
   */
  reset:function () {
    this._h = this._init.slice(0);
    this._buffer = [];
    this._length = 0;
    return this;
  },

  /**
   * Input several words to the hash.
   * @param {bitArray|String} data the data to hash.
   * @return this
   */
  update: function (data) {
    if (typeof data === "string") {
      data = sjcl.codec.utf8String.toBits(data);
    }
    var i, b = this._buffer = sjcl.bitArray.concat(this._buffer, data),
        ol = this._length,
        nl = this._length = ol + sjcl.bitArray.bitLength(data);
    if (nl > 9007199254740991){
      throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");
    }

    if (typeof Uint32Array !== 'undefined') {
	var c = new Uint32Array(b);
    	var j = 0;
    	for (i = this.blockSize+ol - ((this.blockSize+ol) & (this.blockSize-1)); i <= nl;
		i+= this.blockSize) {
      	    this._block(c.subarray(16 * j, 16 * (j+1)));
      	    j += 1;
    	}
    	b.splice(0, 16 * j);
    } else {
    	for (i = this.blockSize+ol - ((this.blockSize+ol) & (this.blockSize-1)); i <= nl;
             i+= this.blockSize) {
      	     this._block(b.splice(0,16));
      	}
    }
    return this;
  },

  /**
   * Complete hashing and output the hash value.
   * @return {bitArray} The hash value, an array of 5 big-endian words. TODO
   */
  finalize:function () {
    var i, b = this._buffer, h = this._h;

    // Round out and push the buffer
    b = sjcl.bitArray.concat(b, [sjcl.bitArray.partial(1,1)]);
    // Round out the buffer to a multiple of 16 words, less the 2 length words.
    for (i = b.length + 2; i & 15; i++) {
      b.push(0);
    }

    // append the length
    b.push(Math.floor(this._length / 0x100000000));
    b.push(this._length | 0);

    while (b.length) {
      this._block(b.splice(0,16));
    }

    this.reset();
    return h;
  },

  /**
   * The SHA-1 initialization vector.
   * @private
   */
  _init:[0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0],

  /**
   * The SHA-1 hash key.
   * @private
   */
  _key:[0x5A827999, 0x6ED9EBA1, 0x8F1BBCDC, 0xCA62C1D6],

  /**
   * The SHA-1 logical functions f(0), f(1), ..., f(79).
   * @private
   */
  _f:function(t, b, c, d) {
    if (t <= 19) {
      return (b & c) | (~b & d);
    } else if (t <= 39) {
      return b ^ c ^ d;
    } else if (t <= 59) {
      return (b & c) | (b & d) | (c & d);
    } else if (t <= 79) {
      return b ^ c ^ d;
    }
  },

  /**
   * Circular left-shift operator.
   * @private
   */
  _S:function(n, x) {
    return (x << n) | (x >>> 32-n);
  },

  /**
   * Perform one cycle of SHA-1.
   * @param {Uint32Array|bitArray} words one block of words.
   * @private
   */
  _block:function (words) {
    var t, tmp, a, b, c, d, e,
    h = this._h;
    var w;
    if (typeof Uint32Array !== 'undefined') {
        // When words is passed to _block, it has 16 elements. SHA1 _block
        // function extends words with new elements (at the end there are 80 elements).
        // The problem is that if we use Uint32Array instead of Array,
        // the length of Uint32Array cannot be changed. Thus, we replace words with a
        // normal Array here.
        w = Array(80); // do not use Uint32Array here as the instantiation is slower
        for (var j=0; j<16; j++){
            w[j] = words[j];
        }
    } else {
        w = words;
    }

    a = h[0]; b = h[1]; c = h[2]; d = h[3]; e = h[4];

    for (t=0; t<=79; t++) {
      if (t >= 16) {
        w[t] = this._S(1, w[t-3] ^ w[t-8] ^ w[t-14] ^ w[t-16]);
      }
      tmp = (this._S(5, a) + this._f(t, b, c, d) + e + w[t] +
             this._key[Math.floor(t/20)]) | 0;
      e = d;
      d = c;
      c = this._S(30, b);
      b = a;
      a = tmp;
   }

   h[0] = (h[0]+a) |0;
   h[1] = (h[1]+b) |0;
   h[2] = (h[2]+c) |0;
   h[3] = (h[3]+d) |0;
   h[4] = (h[4]+e) |0;
  }
};



/*
file https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/codecBytes.js
shGithubDateCommitted https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/codecBytes.js # 2016-05-31T18:26:45Z
curl https://raw.githubusercontent.com/bitwiseshiftleft/sjcl/1.0.8/core/codecBytes.js > /tmp/aa.js
*/
/** @fileOverview Bit array codec implementations.
 *
 * @author Emily Stark
 * @author Mike Hamburg
 * @author Dan Boneh
 */

/**
 * Arrays of bytes
 * @namespace
 */
sjcl.codec.bytes = {
  /** Convert from a bitArray to an array of bytes. */
  fromBits: function (arr) {
    var out = [], bl = sjcl.bitArray.bitLength(arr), i, tmp;
    for (i=0; i<bl/8; i++) {
      if ((i&3) === 0) {
        tmp = arr[i/4];
      }
      out.push(tmp >>> 24);
      tmp <<= 8;
    }
    return out;
  },
  /** Convert from an array of bytes to a bitArray. */
  toBits: function (bytes) {
    var out = [], i, tmp=0;
    for (i=0; i<bytes.length; i++) {
      tmp = tmp << 8 | bytes[i];
      if ((i&3) === 3) {
        out.push(tmp);
        tmp = 0;
      }
    }
    if (i&3) {
      out.push(sjcl.bitArray.partial(8*(i&3), tmp));
    }
    return out;
  }
};



/*
file https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/scrypt.js
shGithubDateCommitted https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/scrypt.js # 2016-05-31T18:10:00Z
curl https://raw.githubusercontent.com/bitwiseshiftleft/sjcl/1.0.8/core/scrypt.js > /tmp/aa.js
*/
/** scrypt Password-Based Key-Derivation Function.
 *
 * @param {bitArray|String} password  The password.
 * @param {bitArray|String} salt      The salt.  Should have lots of entropy.
 *
 * @param {Number} [N=16384] CPU/Memory cost parameter.
 * @param {Number} [r=8]     Block size parameter.
 * @param {Number} [p=1]     Parallelization parameter.
 *
 * @param {Number} [length] The length of the derived key.  Defaults to the
 *                          output size of the hash function.
 * @param {Object} [Prff=sjcl.misc.hmac] The pseudorandom function family.
 *
 * @return {bitArray} The derived key.
 */
sjcl.misc.scrypt = function (password, salt, N, r, p, length, Prff) {
  var SIZE_MAX = Math.pow(2, 32) - 1,
      self = sjcl.misc.scrypt;

  N = N || 16384;
  r = r || 8;
  p = p || 1;

  if (r * p >= Math.pow(2, 30)) {
    throw sjcl.exception.invalid("The parameters r, p must satisfy r * p < 2^30");
  }

  if ((N < 2) || (N & (N - 1) != 0)) {
    throw sjcl.exception.invalid("The parameter N must be a power of 2.");
  }

  if (N > SIZE_MAX / 128 / r) {
    throw sjcl.exception.invalid("N too big.");
  }

  if (r > SIZE_MAX / 128 / p) {
    throw sjcl.exception.invalid("r too big.");
  }

  var blocks = sjcl.misc.pbkdf2(password, salt, 1, p * 128 * r * 8, Prff),
      len = blocks.length / p;

  self.reverse(blocks);

  for (var i = 0; i < p; i++) {
    var block = blocks.slice(i * len, (i + 1) * len);
    self.blockcopy(self.ROMix(block, N), 0, blocks, i * len);
  }

  self.reverse(blocks);

  return sjcl.misc.pbkdf2(password, blocks, 1, length, Prff);
};

sjcl.misc.scrypt.salsa20Core = function (word, rounds) {
  var R = function(a, b) { return (a << b) | (a >>> (32 - b)); };
  var x = word.slice(0);

  for (var i = rounds; i > 0; i -= 2) {
    x[ 4] ^= R(x[ 0]+x[12], 7);  x[ 8] ^= R(x[ 4]+x[ 0], 9);
    x[12] ^= R(x[ 8]+x[ 4],13);  x[ 0] ^= R(x[12]+x[ 8],18);
    x[ 9] ^= R(x[ 5]+x[ 1], 7);  x[13] ^= R(x[ 9]+x[ 5], 9);
    x[ 1] ^= R(x[13]+x[ 9],13);  x[ 5] ^= R(x[ 1]+x[13],18);
    x[14] ^= R(x[10]+x[ 6], 7);  x[ 2] ^= R(x[14]+x[10], 9);
    x[ 6] ^= R(x[ 2]+x[14],13);  x[10] ^= R(x[ 6]+x[ 2],18);
    x[ 3] ^= R(x[15]+x[11], 7);  x[ 7] ^= R(x[ 3]+x[15], 9);
    x[11] ^= R(x[ 7]+x[ 3],13);  x[15] ^= R(x[11]+x[ 7],18);
    x[ 1] ^= R(x[ 0]+x[ 3], 7);  x[ 2] ^= R(x[ 1]+x[ 0], 9);
    x[ 3] ^= R(x[ 2]+x[ 1],13);  x[ 0] ^= R(x[ 3]+x[ 2],18);
    x[ 6] ^= R(x[ 5]+x[ 4], 7);  x[ 7] ^= R(x[ 6]+x[ 5], 9);
    x[ 4] ^= R(x[ 7]+x[ 6],13);  x[ 5] ^= R(x[ 4]+x[ 7],18);
    x[11] ^= R(x[10]+x[ 9], 7);  x[ 8] ^= R(x[11]+x[10], 9);
    x[ 9] ^= R(x[ 8]+x[11],13);  x[10] ^= R(x[ 9]+x[ 8],18);
    x[12] ^= R(x[15]+x[14], 7);  x[13] ^= R(x[12]+x[15], 9);
    x[14] ^= R(x[13]+x[12],13);  x[15] ^= R(x[14]+x[13],18);
  }

  for (i = 0; i < 16; i++) word[i] = x[i]+word[i];
};

sjcl.misc.scrypt.blockMix = function(blocks) {
  var X = blocks.slice(-16),
      out = [],
      len = blocks.length / 16,
      self = sjcl.misc.scrypt;

  for (var i = 0; i < len; i++) {
    self.blockxor(blocks, 16 * i, X, 0, 16);
    self.salsa20Core(X, 8);

    if ((i & 1) == 0) {
      self.blockcopy(X, 0, out, 8 * i);
    } else {
      self.blockcopy(X, 0, out, 8 * (i^1 + len));
    }
  }

  return out;
};

sjcl.misc.scrypt.ROMix = function(block, N) {
  var X = block.slice(0),
      V = [],
      self = sjcl.misc.scrypt;

  for (var i = 0; i < N; i++) {
    V.push(X.slice(0));
    X = self.blockMix(X);
  }

  for (i = 0; i < N; i++) {
    var j = X[X.length - 16] & (N - 1);

    self.blockxor(V[j], 0, X, 0);
    X = self.blockMix(X);
  }

  return X;
};

sjcl.misc.scrypt.reverse = function (words) { // Converts Big <-> Little Endian words
  for (var i in words) {
    var out = words[i] &  0xFF;
    out = (out << 8) | (words[i] >>>  8) & 0xFF;
    out = (out << 8) | (words[i] >>> 16) & 0xFF;
    out = (out << 8) | (words[i] >>> 24) & 0xFF;

    words[i] = out;
  }
};

sjcl.misc.scrypt.blockcopy = function (S, Si, D, Di, len) {
  var i;

  len = len || (S.length - Si);

  for (i = 0; i < len; i++) D[Di + i] = S[Si + i] | 0;
};

sjcl.misc.scrypt.blockxor = function(S, Si, D, Di, len) {
  var i;

  len = len || (S.length - Si);

  for (i = 0; i < len; i++) D[Di + i] = (D[Di + i] ^ S[Si + i]) | 0;
};



/*
file https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/cbc.js
shGithubDateCommitted https://github.com/bitwiseshiftleft/sjcl/blob/1.0.8/core/cbc.js # 2016-05-31T18:26:45Z
curl https://raw.githubusercontent.com/bitwiseshiftleft/sjcl/1.0.8/core/cbc.js > /tmp/aa.js
*/
/** @fileOverview CBC mode implementation
 *
 * @author Emily Stark
 * @author Mike Hamburg
 * @author Dan Boneh
 */

if (sjcl.beware === undefined) {
  sjcl.beware = {};
}
sjcl.beware["CBC mode is dangerous because it doesn't protect message integrity."
] = function() {
  /**
   * Dangerous: CBC mode with PKCS#5 padding.
   * @namespace
   * @author Emily Stark
   * @author Mike Hamburg
   * @author Dan Boneh
   */
  sjcl.mode.cbc = {
    /** The name of the mode.
     * @constant
     */
    name: "cbc",

    /** Encrypt in CBC mode with PKCS#5 padding.
     * @param {Object} prp The block cipher.  It must have a block size of 16 bytes.
     * @param {bitArray} plaintext The plaintext data.
     * @param {bitArray} iv The initialization value.
     * @param {bitArray} [adata=[]] The authenticated data.  Must be empty.
     * @return The encrypted data, an array of bytes.
     * @throws {sjcl.exception.invalid} if the IV isn't exactly 128 bits, or if any adata is specified.
     */
    encrypt: function(prp, plaintext, iv, adata) {
      if (adata && adata.length) {
        throw new sjcl.exception.invalid("cbc can't authenticate data");
      }
      if (sjcl.bitArray.bitLength(iv) !== 128) {
        throw new sjcl.exception.invalid("cbc iv must be 128 bits");
      }
      var i,
          w = sjcl.bitArray,
          xor = w._xor4,
          bl = w.bitLength(plaintext),
          bp = 0,
          output = [];

      if (bl&7) {
        throw new sjcl.exception.invalid("pkcs#5 padding only works for multiples of a byte");
      }

      for (i=0; bp+128 <= bl; i+=4, bp+=128) {
        /* Encrypt a non-final block */
        iv = prp.encrypt(xor(iv, plaintext.slice(i,i+4)));
        output.splice(i,0,iv[0],iv[1],iv[2],iv[3]);
      }

      /* Construct the pad. */
      bl = (16 - ((bl >> 3) & 15)) * 0x1010101;

      /* Pad and encrypt. */
      iv = prp.encrypt(xor(iv,w.concat(plaintext,[bl,bl,bl,bl]).slice(i,i+4)));
      output.splice(i,0,iv[0],iv[1],iv[2],iv[3]);
      return output;
    },

    /** Decrypt in CBC mode.
     * @param {Object} prp The block cipher.  It must have a block size of 16 bytes.
     * @param {bitArray} ciphertext The ciphertext data.
     * @param {bitArray} iv The initialization value.
     * @param {bitArray} [adata=[]] The authenticated data.  It must be empty.
     * @return The decrypted data, an array of bytes.
     * @throws {sjcl.exception.invalid} if the IV isn't exactly 128 bits, or if any adata is specified.
     * @throws {sjcl.exception.corrupt} if if the message is corrupt.
     */
    decrypt: function(prp, ciphertext, iv, adata) {
      if (adata && adata.length) {
        throw new sjcl.exception.invalid("cbc can't authenticate data");
      }
      if (sjcl.bitArray.bitLength(iv) !== 128) {
        throw new sjcl.exception.invalid("cbc iv must be 128 bits");
      }
      if ((sjcl.bitArray.bitLength(ciphertext) & 127) || !ciphertext.length) {
        throw new sjcl.exception.corrupt("cbc ciphertext must be a positive multiple of the block size");
      }
      var i,
          w = sjcl.bitArray,
          xor = w._xor4,
          bi, bo,
          output = [];

      adata = adata || [];

      for (i=0; i<ciphertext.length; i+=4) {
        bi = ciphertext.slice(i,i+4);
        bo = xor(iv,prp.decrypt(bi));
        output.splice(i,0,bo[0],bo[1],bo[2],bo[3]);
        iv = bi;
      }

      /* check and remove the pad */
      bi = output[i-1] & 255;
      if (bi === 0 || bi > 16) {
        throw new sjcl.exception.corrupt("pkcs#5 padding corrupt");
      }
      bo = bi * 0x1010101;
      if (!w.equal(w.bitSlice([bo,bo,bo,bo], 0, bi*8),
                   w.bitSlice(output, output.length*32 - bi*8, output.length*32))) {
        throw new sjcl.exception.corrupt("pkcs#5 padding corrupt");
      }

      return w.bitSlice(output, 0, output.length*32 - bi*8);
    }
  };
};



/*
file none
*/
}());
/* jslint ignore:end */
// init exports
if (local.isBrowser) {
    globalThis.utility2_sjcl = local.sjcl;
} else {
    module.exports = local.sjcl;
    module.exports.__dirname = __dirname;
}
}());



}());
/* script-end /assets.utility2.lib.sjcl.js */



/* script-begin /assets.utility2.js */
// usr/bin/env node
/*
 * lib.utility2.js (2019.8.11)
 * https://github.com/kaizhu256/node-utility2
 * this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps
 *
 */



/* istanbul instrument in package utility2 */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_utility2 = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.utility2 = local;



/* validateLineSortedReset */
// init lib utility2
globalThis.utility2 = local;
// init lib extra
[
    "apidoc",
    "db",
    "github_crud",
    "istanbul",
    "jslint",
    "marked",
    "sjcl"
].forEach(function (key) {
    try {
        local[key] = (
            local.isBrowser
            ? globalThis["utility2_" + key]
            : require("./lib." + key + ".js")
        );
    } catch (errCaught) {
        local.assertThrow(errCaught.code === "MODULE_NOT_FOUND", errCaught);
    }
    local[key] = local[key] || {};
});
// init assets and templates
local.assetsDict = local.assetsDict || {};



/* jslint ignore:start */
local.assetsDict["/assets.index.template.html"] =
local.assetsDict["/assets.utility2.template.html"] = '\
<!doctype html>\n\
<html lang="en">\n\
<head>\n\
<meta charset="utf-8">\n\
<meta name="viewport" content="width=device-width, initial-scale=1">\n\
<!-- "assets.utility2.template.html" -->\n\
<title>{{env.npm_package_name}} ({{env.npm_package_version}})</title>\n\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
*/\n\
/* csslint ignore:start */\n\
*,\n\
*:after,\n\
*:before {\n\
    box-sizing: border-box;\n\
}\n\
/* csslint ignore:end */\n\
@keyframes uiAnimateShake {\n\
0%,\n\
50% {\n\
    transform: translateX(10px);\n\
}\n\
100% {\n\
    transform: translateX(0);\n\
}\n\
25%,\n\
75% {\n\
    transform: translateX(-10px);\n\
}\n\
}\n\
@keyframes uiAnimateSpin {\n\
0% {\n\
    transform: rotate(0deg);\n\
}\n\
100% {\n\
    transform: rotate(360deg);\n\
}\n\
}\n\
a {\n\
    overflow-wrap: break-word;\n\
}\n\
body {\n\
    background: #eef;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: small;\n\
    margin: 0 40px;\n\
}\n\
body > div,\n\
body > form > div,\n\
body > form > input,\n\
body > form > pre,\n\
body > form > .button,\n\
body > form > .textarea,\n\
body > input,\n\
body > pre,\n\
body > .button,\n\
body > .textarea {\n\
    margin-bottom: 20px;\n\
    margin-top: 0;\n\
}\n\
body > form > input,\n\
body > form > .button,\n\
body > input,\n\
body > .button {\n\
    width: 20rem;\n\
}\n\
body > form > .textarea,\n\
body > .textarea {\n\
    height: 10rem;\n\
    width: 100%;\n\
}\n\
body > .readonly {\n\
    background: #ddd;\n\
}\n\
code,\n\
pre,\n\
.textarea {\n\
    font-family: Consolas, Menlo, monospace;\n\
    font-size: smaller;\n\
}\n\
pre {\n\
    overflow-wrap: break-word;\n\
    white-space: pre-wrap;\n\
}\n\
.button {\n\
    background-color: #fff;\n\
    border: 1px solid;\n\
    border-bottom-color: rgb(186, 186, 186);\n\
    border-left-color: rgb(209, 209, 209);\n\
    border-radius: 4px;\n\
    border-right-color: rgb(209, 209, 209);\n\
    border-top-color: rgb(216, 216, 216);\n\
    color: #00d;\n\
    cursor: pointer;\n\
    display: inline-block;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: 12px;\n\
    font-style: normal;\n\
    font-weight: normal;\n\
    margin: 0;\n\
    padding: 2px 7px 3px 7px;\n\
    text-align: center;\n\
    text-decoration: underline;\n\
}\n\
.colorError {\n\
    color: #d00;\n\
}\n\
.textarea {\n\
    background: #fff;\n\
    border: 1px solid #999;\n\
    border-radius: 0;\n\
    cursor: auto;\n\
    overflow: auto;\n\
    padding: 2px;\n\
}\n\
.uiAnimateShake {\n\
    animation-duration: 500ms;\n\
    animation-name: uiAnimateShake;\n\
}\n\
.uiAnimateSlide {\n\
    overflow-y: hidden;\n\
    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n\
}\n\
.utility2FooterDiv {\n\
    text-align: center;\n\
}\n\
.zeroPixel {\n\
    border: 0;\n\
    height: 0;\n\
    margin: 0;\n\
    padding: 0;\n\
    width: 0;\n\
}\n\
</style>\n\
</head>\n\
<body>\n\
<div id="ajaxProgressDiv1" style="background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;"></div>\n\
<div class="uiAnimateSpin" style="animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;"></div>\n\
<a class="zeroPixel" download="db.persistence.json" href="" id="dbExportA1"></a>\n\
<input class="zeroPixel" data-onevent="onEventDomDb" data-onevent-db="dbImportInput" type="file">\n\
<script>\n\
/* jslint utility2:true */\n\
// init domOnEventWindowOnloadTimeElapsed\n\
(function () {\n\
/*\n\
 * this function will measure and print time-elapsed for window.onload\n\
 */\n\
    "use strict";\n\
    if (window.domOnEventWindowOnloadTimeElapsed) {\n\
        return;\n\
    }\n\
    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n\
    window.addEventListener("load", function () {\n\
        setTimeout(function () {\n\
            window.domOnEventWindowOnloadTimeElapsed = (\n\
                Date.now()\n\
                - window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
            console.error(\n\
                "domOnEventWindowOnloadTimeElapsed = "\n\
                + window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
        }, 100);\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventDelegateDict\n\
(function () {\n\
/*\n\
 * this function will handle delegated dom-event\n\
 */\n\
    "use strict";\n\
    var timerTimeoutDict;\n\
    if (window.domOnEventDelegateDict) {\n\
        return;\n\
    }\n\
    window.domOnEventDelegateDict = {};\n\
    timerTimeoutDict = {};\n\
    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n\
        evt.targetOnEvent = evt.target.closest(\n\
            "[data-onevent]"\n\
        );\n\
        if (\n\
            !evt.targetOnEvent\n\
            || evt.targetOnEvent.dataset.onevent === "domOnEventNop"\n\
            || evt.target.closest(\n\
                ".disabled, .readonly"\n\
            )\n\
        ) {\n\
            return;\n\
        }\n\
        // rate-limit high-frequency-event\n\
        switch (evt.type) {\n\
        case "keydown":\n\
        case "keyup":\n\
            // filter non-input keyboard-event\n\
            if (!evt.target.closest(\n\
                "input, option, select, textarea"\n\
            )) {\n\
                return;\n\
            }\n\
            if (timerTimeoutDict[evt.type] !== true) {\n\
                timerTimeoutDict[evt.type] = timerTimeoutDict[\n\
                    evt.type\n\
                ] || setTimeout(function () {\n\
                    timerTimeoutDict[evt.type] = true;\n\
                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n\
                }, 50);\n\
                return;\n\
            }\n\
            timerTimeoutDict[evt.type] = null;\n\
            break;\n\
        }\n\
        switch (evt.targetOnEvent.tagName) {\n\
        case "BUTTON":\n\
        case "FORM":\n\
            evt.preventDefault();\n\
            break;\n\
        }\n\
        evt.stopPropagation();\n\
        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n\
            evt\n\
        );\n\
    };\n\
    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n\
        Array.from(document.querySelectorAll(\n\
            ".onevent-reset-output"\n\
        )).forEach(function (elem) {\n\
            switch (elem.tagName) {\n\
            case "INPUT":\n\
            case "TEXTAREA":\n\
                elem.value = "";\n\
                break;\n\
            case "PRE":\n\
                elem.textContent = "";\n\
                break;\n\
            default:\n\
                elem.innerHTML = "";\n\
            }\n\
        });\n\
    };\n\
    // init event-handling\n\
    [\n\
        "change",\n\
        "click",\n\
        "keydown",\n\
        "submit"\n\
    ].forEach(function (eventType) {\n\
        document.addEventListener(\n\
            eventType,\n\
            window.domOnEventDelegateDict.domOnEventDelegate\n\
        );\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init timerIntervalAjaxProgressUpdate\n\
(function () {\n\
/*\n\
 * this function will increment ajax-progress-bar\n\
 * until webpage has loaded\n\
 */\n\
    "use strict";\n\
    var ajaxProgressDiv1;\n\
    var ajaxProgressState;\n\
    var ajaxProgressUpdate;\n\
    if (\n\
        window.timerIntervalAjaxProgressUpdate\n\
        || !document.querySelector(\n\
            "#ajaxProgressDiv1"\n\
        )\n\
    ) {\n\
        return;\n\
    }\n\
    ajaxProgressDiv1 = document.querySelector(\n\
        "#ajaxProgressDiv1"\n\
    );\n\
    setTimeout(function () {\n\
        ajaxProgressDiv1.style.width = "25%";\n\
    });\n\
    ajaxProgressState = 0;\n\
    ajaxProgressUpdate = (\n\
        window.local\n\
        && window.local.ajaxProgressUpdate\n\
    ) || function () {\n\
        ajaxProgressDiv1.style.width = "100%";\n\
        setTimeout(function () {\n\
            ajaxProgressDiv1.style.background = "transparent";\n\
            setTimeout(function () {\n\
                ajaxProgressDiv1.style.width = "0%";\n\
            }, 500);\n\
        }, 1000);\n\
    };\n\
    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n\
        ajaxProgressState += 1;\n\
        ajaxProgressDiv1.style.width = Math.max(\n\
            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n\
            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n\
        ) + "%";\n\
    }, 1000);\n\
    window.addEventListener("load", function () {\n\
        clearInterval(window.timerIntervalAjaxProgressUpdate);\n\
        ajaxProgressUpdate();\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventSelectAllWithinPre\n\
(function () {\n\
/*\n\
 * this function will limit select-all within <pre tabIndex="0"> elements\n\
 * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n\
 */\n\
    "use strict";\n\
    if (window.domOnEventSelectAllWithinPre) {\n\
        return;\n\
    }\n\
    window.domOnEventSelectAllWithinPre = function (evt) {\n\
        var range;\n\
        var selection;\n\
        if (\n\
            evt\n\
            && evt.key === "a"\n\
            && (evt.ctrlKey || evt.metaKey)\n\
            && evt.target.closest(\n\
                "pre"\n\
            )\n\
        ) {\n\
            range = document.createRange();\n\
            range.selectNodeContents(evt.target.closest(\n\
                "pre"\n\
            ));\n\
            selection = window.getSelection();\n\
            selection.removeAllRanges();\n\
            selection.addRange(range);\n\
            evt.preventDefault();\n\
        }\n\
    };\n\
    // init event-handling\n\
    document.addEventListener(\n\
        "keydown",\n\
        window.domOnEventSelectAllWithinPre\n\
    );\n\
}());\n\
</script>\n\
<h1>\n\
<!-- utility2-comment\n\
    <a\n\
        {{#if env.npm_package_homepage}}\n\
        href="{{env.npm_package_homepage}}"\n\
        {{/if env.npm_package_homepage}}\n\
        target="_blank"\n\
    >\n\
utility2-comment -->\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\n\
<!-- utility2-comment\n\
    </a>\n\
utility2-comment -->\n\
</h1>\n\
<h3>{{env.npm_package_description}}</h3>\n\
<!-- utility2-comment\n\
<a class="button" download href="assets.app.js">download standalone app</a><br>\n\
<button class="button" data-onevent="testRunBrowser" data-onevent-reset-output="1" id="testRunButton1">run internal test</button><br>\n\
<div class="uiAnimateSlide" id="testReportDiv1" style="border-bottom: 0; border-top: 0; margin-bottom: 0; margin-top: 0; max-height: 0; padding-bottom: 0; padding-top: 0;"></div>\n\
utility2-comment -->\n\
\n\
\n\
\n\
<label>stderr and stdout</label>\n\
<pre class="onevent-reset-output readonly textarea" id="outputStdout1" tabIndex="0"></pre>\n\
<!-- utility2-comment\n\
{{#if isRollup}}\n\
<script src="assets.app.js"></script>\n\
{{#unless isRollup}}\n\
utility2-comment -->\n\
<script src="assets.utility2.rollup.js"></script>\n\
<script>window.utility2_onReadyBefore.counter += 1;</script>\n\
<script src="jsonp.utility2.stateInit?callback=window.utility2.stateInit"></script>\n\
<script src="assets.{{packageJson.nameLib}}.js"></script>\n\
<script src="assets.example.js"></script>\n\
<script src="assets.test.js"></script>\n\
<script>window.utility2_onReadyBefore();</script>\n\
<!-- utility2-comment\n\
{{/if isRollup}}\n\
utility2-comment -->\n\
<div class="utility2FooterDiv">\n\
    [ this app was created with\n\
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>\n\
    ]\n\
</div>\n\
</body>\n\
</html>\n\
';



/* validateLineSortedReset */
// https://img.shields.io/badge/last_build-0000_00_00_00_00_00_UTC_--_master_--_aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa-0077ff.svg?style=flat
local.assetsDict["/assets.buildBadge.template.svg"] =
'<svg xmlns="http://www.w3.org/2000/svg" width="563" height="20"><linearGradient id="a" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><rect rx="0" width="563" height="20" fill="#555"/><rect rx="0" x="61" width="502" height="20" fill="#07f"/><path fill="#07f" d="M61 0h4v20h-4z"/><rect rx="0" width="563" height="20" fill="url(#a)"/><g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11"><text x="31.5" y="15" fill="#010101" fill-opacity=".3">last build</text><text x="31.5" y="14">last build</text><text x="311" y="15" fill="#010101" fill-opacity=".3">0000-00-00 00:00:00 UTC - master - aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</text><text x="311" y="14">0000-00-00 00:00:00 UTC - master - aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</text></g></svg>';



local.assetsDict["/assets.example.begin.js"] = '\
(function (globalThis) {\n\
    "use strict";\n\
    var consoleError;\n\
    var local;\n\
    // init globalThis\n\
    (function () {\n\
        try {\n\
            globalThis = Function("return this")(); // jslint ignore:line\n\
        } catch (ignore) {}\n\
    }());\n\
    globalThis.globalThis = globalThis;\n\
    // init debug_inline\n\
    if (!globalThis["debug\\u0049nline"]) {\n\
        consoleError = console.error;\n\
        globalThis["debug\\u0049nline"] = function () {\n\
        /*\n\
         * this function will both print <arguments> to stderr\n\
         * and return <arguments>[0]\n\
         */\n\
            var argList;\n\
            argList = Array.from(arguments); // jslint ignore:line\n\
            // debug arguments\n\
            globalThis["debug\\u0049nlineArguments"] = argList;\n\
            consoleError("\\n\\ndebug\\u0049nline");\n\
            consoleError.apply(console, argList);\n\
            consoleError("\\n");\n\
            // return arg0 for inspection\n\
            return argList[0];\n\
        };\n\
    }\n\
    // init local\n\
    local = {};\n\
    local.local = local;\n\
    globalThis.globalLocal = local;\n\
    // init isBrowser\n\
    local.isBrowser = (\n\
        typeof window === "object"\n\
        && window === globalThis\n\
        && typeof window.XMLHttpRequest === "function"\n\
        && window.document\n\
        && typeof window.document.querySelector === "function"\n\
    );\n\
    // init function\n\
    local.assertThrow = function (passed, message) {\n\
    /*\n\
     * this function will throw err.<message> if <passed> is falsy\n\
     */\n\
        var err;\n\
        if (passed) {\n\
            return;\n\
        }\n\
        err = (\n\
            // ternary-operator\n\
            (\n\
                message\n\
                && typeof message.message === "string"\n\
                && typeof message.stack === "string"\n\
            )\n\
            // if message is errObj, then leave as is\n\
            ? message\n\
            : new Error(\n\
                typeof message === "string"\n\
                // if message is a string, then leave as is\n\
                ? message\n\
                // else JSON.stringify message\n\
                : JSON.stringify(message, null, 4)\n\
            )\n\
        );\n\
        throw err;\n\
    };\n\
    local.functionOrNop = function (fnc) {\n\
    /*\n\
     * this function will if <fnc> exists,\n\
     * them return <fnc>,\n\
     * else return <nop>\n\
     */\n\
        return fnc || local.nop;\n\
    };\n\
    local.identity = function (value) {\n\
    /*\n\
     * this function will return <value>\n\
     */\n\
        return value;\n\
    };\n\
    local.nop = function () {\n\
    /*\n\
     * this function will do nothing\n\
     */\n\
        return;\n\
    };\n\
    local.objectAssignDefault = function (target, source) {\n\
    /*\n\
     * this function will if items from <target> are\n\
     * null, undefined, or empty-string,\n\
     * then overwrite them with items from <source>\n\
     */\n\
        target = target || {};\n\
        Object.keys(source || {}).forEach(function (key) {\n\
            if (\n\
                target[key] === null\n\
                || target[key] === undefined\n\
                || target[key] === ""\n\
            ) {\n\
                target[key] = target[key] || source[key];\n\
            }\n\
        });\n\
        return target;\n\
    };\n\
    // require builtin\n\
    if (!local.isBrowser) {\n\
        local.assert = require("assert");\n\
        local.buffer = require("buffer");\n\
        local.child_process = require("child_process");\n\
        local.cluster = require("cluster");\n\
        local.crypto = require("crypto");\n\
        local.dgram = require("dgram");\n\
        local.dns = require("dns");\n\
        local.domain = require("domain");\n\
        local.events = require("events");\n\
        local.fs = require("fs");\n\
        local.http = require("http");\n\
        local.https = require("https");\n\
        local.net = require("net");\n\
        local.os = require("os");\n\
        local.path = require("path");\n\
        local.querystring = require("querystring");\n\
        local.readline = require("readline");\n\
        local.repl = require("repl");\n\
        local.stream = require("stream");\n\
        local.string_decoder = require("string_decoder");\n\
        local.timers = require("timers");\n\
        local.tls = require("tls");\n\
        local.tty = require("tty");\n\
        local.url = require("url");\n\
        local.util = require("util");\n\
        local.vm = require("vm");\n\
        local.zlib = require("zlib");\n\
    }\n\
}(this));\n\
'



local.assetsDict["/assets.example.html"] = "";



local.assetsDict["/assets.example.template.js"] = '\
/*\n\
example.js\n\
\n\
this script will run a web-demo of my-app-lite\n\
\n\
instruction\n\
    1. save this script as example.js\n\
    2. run shell-command:\n\
        $ npm install my-app-lite && PORT=8081 node example.js\n\
    3. open a browser to http://127.0.0.1:8081 and play with web-demo\n\
    4. edit this script to suit your needs\n\
*/\n\
\n\
\n\
\n\
/* istanbul instrument in package my_app */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function (local) {\n\
"use strict";\n\
\n\
\n\
\n\
// run shared js\-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2_rollup\n\
    || globalThis.utility2_my_app\n\
    || require("my-app-lite")\n\
);\n\
// init exports\n\
globalThis.local = local;\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run browser js\-env code - init-test\n\
(function () {\n\
if (!local.isBrowser) {\n\
    return;\n\
}\n\
// log stderr and stdout to #outputStdout1\n\
["error", "log"].forEach(function (key) {\n\
    var argList;\n\
    var elem;\n\
    var fnc;\n\
    elem = document.querySelector(\n\
        "#outputStdout1"\n\
    );\n\
    if (!elem) {\n\
        return;\n\
    }\n\
    fnc = console[key];\n\
    console[key] = function () {\n\
        argList = Array.from(arguments); // jslint ignore:line\n\
        fnc.apply(console, argList);\n\
        // append text to #outputStdout1\n\
        elem.textContent += argList.map(function (arg) {\n\
            return (\n\
                typeof arg === "string"\n\
                ? arg\n\
                : JSON.stringify(arg, null, 4)\n\
            );\n\
        }).join(" ").replace((\n\
            /\\u001b\\[\\d*m/g\n\
        ), "") + "\\n";\n\
        // scroll textarea to bottom\n\
        elem.scrollTop = elem.scrollHeight;\n\
    };\n\
});\n\
Object.assign(local, globalThis.domOnEventDelegateDict);\n\
globalThis.domOnEventDelegateDict = local;\n\
local.onEventDomDb = (\n\
    local.db && local.db.onEventDomDb\n\
);\n\
local.testRunBrowser = function (evt) {\n\
/*\n\
 * this function will run browser-tests\n\
 */\n\
    switch (\n\
        !evt.ctrlKey\n\
        && !evt.metaKey\n\
        && (\n\
            evt.modeInit\n\
            || (evt.type + "." + (evt.target && evt.target.id))\n\
        )\n\
    ) {\n\
    // custom-case\n\
    case true:\n\
        return;\n\
    // run browser-tests\n\
    default:\n\
        if (\n\
            (evt.target && evt.target.id) !== "testRunButton1"\n\
            && !(evt.modeInit && (\n\
                /\\bmodeTest=1\\b/\n\
            ).test(location.search))\n\
        ) {\n\
            return;\n\
        }\n\
        // show browser-tests\n\
        if (document.querySelector(\n\
            "#testReportDiv1"\n\
        ).style.maxHeight === "0px") {\n\
            globalThis.domOnEventDelegateDict.domOnEventResetOutput();\n\
            local.uiAnimateSlideDown(document.querySelector(\n\
                "#testReportDiv1"\n\
            ));\n\
            document.querySelector(\n\
                "#testRunButton1"\n\
            ).textContent = "hide internal test";\n\
            local.modeTest = 1;\n\
            local.testRunDefault(local);\n\
            return;\n\
        }\n\
        // hide browser-tests\n\
        local.uiAnimateSlideUp(document.querySelector(\n\
            "#testReportDiv1"\n\
        ));\n\
        document.querySelector(\n\
            "#testRunButton1"\n\
        ).textContent = "run internal test";\n\
    }\n\
};\n\
\n\
local.testRunBrowser({\n\
    modeInit: true\n\
});\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run node js\-env code - init-test\n\
(function () {\n\
if (local.isBrowser) {\n\
    return;\n\
}\n\
// init exports\n\
module.exports = local;\n\
/* validateLineSortedReset */\n\
// init assets\n\
local.assetsDict = local.assetsDict || {};\n\
[\n\
    "assets.index.template.html",\n\
    "assets.swgg.swagger.json",\n\
    "assets.swgg.swagger.server.json"\n\
].forEach(function (file) {\n\
    file = "/" + file;\n\
    local.assetsDict[file] = local.assetsDict[file] || "";\n\
    if (local.fs.existsSync(local.__dirname + file)) {\n\
        local.assetsDict[file] = local.fs.readFileSync(\n\
            local.__dirname + file,\n\
            "utf8"\n\
        );\n\
    }\n\
});\n\
/* jslint ignore:start */\n\
local.assetsDict["/assets.index.template.html"] = \'\\\n\
' + local.assetsDict["/assets.index.template.html"].replace((/\n/g), "\\n\\\n") + '\';\n\
/* jslint ignore:end */\n\
/* validateLineSortedReset */\n\
/* jslint ignore:start */\n\
local.assetsDict["/assets.my_app.js"] =\n\
    local.assetsDict["/assets.my_app.js"] ||\n\
    local.fs.readFileSync(local.__dirname + "/lib.my_app.js", "utf8"\n\
).replace((/^#!\\//), "// ");\n\
/* jslint ignore:end */\n\
/* validateLineSortedReset */\n\
local.assetsDict["/"] = local.assetsDict["/assets.index.template.html"]\n\
.replace((\n\
    /\\{\\{env\\.(\\w+?)\\}\\}/g\n\
), function (match0, match1) {\n\
    switch (match1) {\n\
    case "npm_package_description":\n\
        return "the greatest app in the world!";\n\
    case "npm_package_name":\n\
        return "my-app-lite";\n\
    case "npm_package_nameLib":\n\
        return "my_app";\n\
    case "npm_package_version":\n\
        return "0.0.1";\n\
    default:\n\
        return match0;\n\
    }\n\
});\n\
local.assetsDict["/assets.example.html"] = local.assetsDict["/"];\n\
local.assetsDict["/index.html"] = local.assetsDict["/"];\n\
// init cli\n\
if (module !== require.main || globalThis.utility2_rollup) {\n\
    return;\n\
}\n\
/* validateLineSortedReset */\n\
local.assetsDict["/assets.example.js"] = (\n\
    local.assetsDict["/assets.example.js"]\n\
    || local.fs.readFileSync(__filename, "utf8")\n\
);\n\
local.assetsDict["/favicon.ico"] = local.assetsDict["/favicon.ico"] || "";\n\
// if $npm_config_timeout_exit exists,\n\
// then exit this process after $npm_config_timeout_exit ms\n\
if (Number(process.env.npm_config_timeout_exit)) {\n\
    setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\n\
}\n\
// start server\n\
if (globalThis.utility2_serverHttp1) {\n\
    return;\n\
}\n\
process.env.PORT = process.env.PORT || "8081";\n\
console.error("http-server listening on port " + process.env.PORT);\n\
local.http.createServer(function (req, res) {\n\
    req.urlParsed = local.url.parse(req.url);\n\
    if (local.assetsDict[req.urlParsed.pathname] !== undefined) {\n\
        res.end(local.assetsDict[req.urlParsed.pathname]);\n\
        return;\n\
    }\n\
    res.statusCode = 404;\n\
    res.end();\n\
}).listen(process.env.PORT);\n\
}());\n\
\n\
\n\
\n\
}());\n\
';



local.assetsDict["/assets.my_app.template.js"] = '\
#!/usr/bin/env node\n\
/*\n\
 * lib.my_app.js ({{packageJson.version}})\n\
 * https://github.com/kaizhu256/node-my-app-lite\n\
 * {{packageJson.description}}\n\
 *\n\
 */\n\
\n\
\n\
\n\
/* istanbul instrument in package my_app */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function (local) {\n\
"use strict";\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run shared js\-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2_rollup\n\
    // || globalThis.utility2_rollup_old\n\
    // || require("./assets.utility2.rollup.js")\n\
    || globalThis.globalLocal\n\
);\n\
// init exports\n\
if (local.isBrowser) {\n\
    globalThis.utility2_my_app = local;\n\
} else {\n\
    module.exports = local;\n\
    module.exports.__dirname = __dirname;\n\
}\n\
// init lib main\n\
local.my_app = local;\n\
\n\
\n\
\n\
/* validateLineSortedReset */\n\
return;\n\
}());\n\
\n\
\n\
\n\
}());\n\
';



local.assetsDict["/assets.readme.template.md"] = '\
# my-app-lite\n\
the greatest app in the world!\n\
\n\
# live web demo\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app)\n\
\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app)\n\
\n\
\n\
\n\
[![travis-ci.org build-status](https://api.travis-ci.org/kaizhu256/node-my-app-lite.svg)](https://travis-ci.org/kaizhu256/node-my-app-lite) [![coverage](https://kaizhu256.github.io/node-my-app-lite/build/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build/coverage.html/index.html)\n\
\n\
[![NPM](https://nodei.co/npm/my-app-lite.png?downloads=true)](https://www.npmjs.com/package/my-app-lite)\n\
\n\
[![build commit status](https://kaizhu256.github.io/node-my-app-lite/build/build.badge.svg)](https://travis-ci.org/kaizhu256/node-my-app-lite)\n\
\n\
| git-branch : | [master](https://github.com/kaizhu256/node-my-app-lite/tree/master) | [beta](https://github.com/kaizhu256/node-my-app-lite/tree/beta) | [alpha](https://github.com/kaizhu256/node-my-app-lite/tree/alpha)|\n\
|--:|:--|:--|:--|\n\
| test-server-github : | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/app) | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app) | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/app)|\n\
| test-server-heroku : | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-master.herokuapp.com) | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-beta.herokuapp.com) | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-alpha.herokuapp.com)|\n\
| test-report : | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/test-report.html) | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/test-report.html) | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/test-report.html)|\n\
| coverage : | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/coverage.html/index.html) | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/coverage.html/index.html) | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/coverage.html/index.html)|\n\
| build-artifacts : | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..master..travis-ci.org) | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..beta..travis-ci.org) | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..alpha..travis-ci.org)|\n\
\n\
[![npmPackageListing](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageListing.svg)](https://github.com/kaizhu256/node-my-app-lite)\n\
\n\
![npmPackageDependencyTree](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageDependencyTree.svg)\n\
\n\
\n\
\n\
# table of contents\n\
\n\
\n\
\n\
# cdn download\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.my_app.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.my_app.js)\n\
\n\
\n\
\n\
# documentation\n\
#### cli help\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageCliHelp.svg)\n\
\n\
#### api doc\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html)\n\
\n\
[![apidoc](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html)\n\
\n\
#### swagger doc\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html)\n\
\n\
[![swaggerdoc](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html)\n\
\n\
#### todo\n\
- none\n\
\n\
#### changelog 0.0.1\n\
- npm publish 0.0.1\n\
- update build\n\
- none\n\
\n\
#### this package requires\n\
- darwin or linux os\n\
\n\
\n\
\n\
# quickstart standalone app\n\
#### to run this example, follow instruction in script below\n\
- [assets.app.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.app.js)\n\
```shell\n\
# example.sh\n\
\n\
# this shell script will download and run a web-demo of my-app-lite as a standalone app\n\
\n\
# 1. download standalone app\n\
curl -O https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.app.js\n\
# 2. run standalone app\n\
PORT=8081 node ./assets.app.js\n\
# 3. open a browser to http://127.0.0.1:8081 and play with web-demo\n\
# 4. edit file assets.app.js to suit your needs\n\
```\n\
\n\
#### output from browser\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\n\
\n\
#### output from shell\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.svg)\n\
\n\
\n\
\n\
# quickstart example.js\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\n\
\n\
#### to run this example, follow instruction in script below\n\
- [example.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/example.js)\n\
```javascript\n' + local.assetsDict["/assets.example.template.js"] + '```\n\
\n\
#### output from browser\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\n\
\n\
#### output from shell\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.svg)\n\
\n\
\n\
\n\
# extra screenshots\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)\n\
\n\
\n\
\n\
# package.json\n\
```json\n\
{\n\
    "author": "kai zhu <kaizhu256@gmail.com>",\n\
    "description": "the greatest app in the world!",\n\
    "devDependencies": {\n\
        "electron-lite": "kaizhu256/node-electron-lite#alpha",\n\
        "utility2": "kaizhu256/node-utility2#alpha"\n\
    },\n\
    "engines": {\n\
        "node": ">=10.0"\n\
    },\n\
    "homepage": "https://github.com/kaizhu256/node-my-app-lite",\n\
    "keywords": [],\n\
    "license": "MIT",\n\
    "main": "lib.my_app.js",\n\
    "name": "my-app-lite",\n\
    "nameAliasPublish": "",\n\
    "os": [\n\
        "darwin",\n\
        "linux"\n\
    ],\n\
    "repository": {\n\
        "type": "git",\n\
        "url": "https://github.com/kaizhu256/node-my-app-lite.git"\n\
    },\n\
    "scripts": {\n\
        "build-ci": "sh ./npm_scripts.sh",\n\
        "env": "env",\n\
        "eval": "sh ./npm_scripts.sh",\n\
        "heroku-postbuild": "sh ./npm_scripts.sh",\n\
        "postinstall": "sh ./npm_scripts.sh",\n\
        "start": "sh ./npm_scripts.sh",\n\
        "test": "sh ./npm_scripts.sh",\n\
        "utility2": "sh ./npm_scripts.sh"\n\
    },\n\
    "version": "0.0.1"\n\
}\n\
```\n\
\n\
\n\
\n\
# changelog of last 50 commits\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.gitLog.svg)](https://github.com/kaizhu256/node-my-app-lite/commits)\n\
\n\
\n\
\n\
# internal build script\n\
- build_ci.sh\n\
```shell\n\
# build_ci.sh\n\
\n\
# this shell script will run the build for this package\n\
\n\
shBuildCiAfter () {(set -e\n\
    # shDeployCustom\n\
    shDeployGithub\n\
    # shDeployHeroku\n\
    shReadmeTest example.sh\n\
)}\n\
\n\
shBuildCiBefore () {(set -e\n\
    # shNpmTestPublished\n\
    shReadmeTest example.js\n\
)}\n\
\n\
# run shBuildCi\n\
eval "$(utility2 source)"\n\
shBuildCi\n\
```\n\
\n\
\n\
\n\
# misc\n\
- this package was created with [utility2](https://github.com/kaizhu256/node-utility2)\n\
';



local.assetsDict["/assets.test.template.js"] = '\
/* istanbul instrument in package my_app */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function (local) {\n\
"use strict";\n\
\n\
\n\
\n\
// run shared js\-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2 || require("utility2")\n\
).requireReadme();\n\
globalThis.local = local;\n\
// init test\n\
local.testRunDefault(local);\n\
}());\n\
\n\
\n\
\n\
// run shared js\-env code - function\n\
(function () {\n\
return;\n\
}());\n\
\n\
\n\
\n\
}());\n\
';



local.assetsDict["/assets.testReport.template.html"] =
    local.assetsDict["/assets.utility2.template.html"]
    .replace("assets.utility2.template.html", "")
    .replace((/<title>.*?<\/title>/), "<title>test-report</title>")
    .replace("</style>\n", '\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
*/\n\
.testReportDiv img {\n\
    border: 1px solid black;\n\
    margin: 5px 0 5px 0;\n\
    max-height: 256px;\n\
    max-width: 512px;\n\
}\n\
.testReportDiv pre {\n\
    background: #fdd;\n\
    border-top: 1px solid black;\n\
    margin-bottom: 0;\n\
    padding: 10px;\n\
}\n\
.testReportDiv span {\n\
    display: inline-block;\n\
    width: 120px;\n\
}\n\
.testReportDiv table {\n\
    border-top: 1px solid black;\n\
    text-align: left;\n\
    width: 100%;\n\
}\n\
.testReportDiv table > tbody > tr:nth-child(odd) {\n\
    background: #bfb;\n\
}\n\
.testReportDiv .displayNone {\n\
    display: none;\n\
}\n\
.testReportDiv .footer {\n\
    text-align: center;\n\
}\n\
.testReportDiv .platform {\n\
    background: #fff;\n\
    border: 1px solid black;\n\
    margin-bottom: 20px;\n\
    padding: 0 10px 10px 10px;\n\
    text-align: left;\n\
}\n\
.testReportDiv .summary {\n\
    background: #bfb;\n\
}\n\
.testReportDiv .testFailed {\n\
    background: #f99;\n\
}\n\
.testReportDiv .testPending {\n\
    background: #99f;\n\
}\n\
</style>\n\
'.replace("<style>\n", "")).replace((/<\/script>[\S\s]*?<\/body>/), '\
</script>\n\
<div class="testReportDiv">\n\
<h1>test-report for\n\
    <a\n\
        {{#if env.npm_package_homepage}}\n\
        href="{{env.npm_package_homepage}}"\n\
        {{/if env.npm_package_homepage}}\n\
    >\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\n\
    </a>\n\
</h1>\n\
<div class="platform summary">\n\
<h2>summary</h2>\n\
<h4>\n\
    <span>version</span>-\n\
        {{env.npm_package_version}}<br>\n\
    <span>test date</span>- {{date}}<br>\n\
    <span>commit info</span>-\n\
        {{#if env.CI_COMMIT_INFO}}\n\
        {{env.CI_COMMIT_INFO}}<br>\n\
        {{#unless env.CI_COMMIT_INFO}}\n\
        undefined<br>\n\
        {{/if env.CI_COMMIT_INFO}}\n\
</h4>\n\
<table>\n\
<thead>\n\
    <tr>\n\
        <th>total time-elapsed</th>\n\
        <th>total tests failed</th>\n\
        <th>total tests passed</th>\n\
        <th>total tests pending</th>\n\
    </tr>\n\
</thead>\n\
<tbody><tr>\n\
    <td>{{timeElapsed}} ms</td>\n\
    <td class="{{testStatusClass}}">{{testsFailed}}</td>\n\
    <td>{{testsPassed}}</td>\n\
    <td>{{testsPending}}</td>\n\
</tr></tbody>\n\
</table>\n\
</div>\n\
{{#each testPlatformList}}\n\
<div class="platform">\n\
<h4>\n\
    {{testPlatformNumber}}. {{name}}<br>\n\
    {{#if screenshot}}\n\
    <a href="{{screenshot encodeURIComponent}}">\n\
        <img alt="{{screenshot encodeURIComponent}}" src="{{screenshot encodeURIComponent}}">\n\
    </a>\n\
    <br>\n\
    {{/if screenshot}}\n\
    {{#if domOnEventWindowOnloadTimeElapsed}}\n\
    <span>onload-time</span>- {{domOnEventWindowOnloadTimeElapsed}} ms<br>\n\
    {{/if domOnEventWindowOnloadTimeElapsed}}\n\
    <span>time-elapsed</span>- {{timeElapsed}} ms<br>\n\
    <span>tests failed</span>- {{testsFailed}}<br>\n\
    <span>tests passed</span>- {{testsPassed}}<br>\n\
    <span>tests pending</span>- {{testsPending}}<br>\n\
</h4>\n\
<table>\n\
<thead><tr>\n\
    <th>#</th>\n\
    <th>time-elapsed</th>\n\
    <th>status</th>\n\
    <th>test-case</th>\n\
</tr></thead>\n\
<tbody>\n\
{{#each testCaseList}}\n\
<tr>\n\
    <td>{{testCaseNumber}}</td>\n\
    <td>{{timeElapsed}} ms</td>\n\
    <td class="{{testReportTestStatusClass}}">{{status}}</td>\n\
    <td>{{name}}</td>\n\
</tr>\n\
{{/each testCaseList}}\n\
</tbody>\n\
</table>\n\
<pre class="{{preClass}}" tabIndex="0">\n\
{{#each errorStackList}}\n\
{{errorStack}}\n\
{{/each errorStackList}}\n\
</pre>\n\
</div>\n\
{{/each testPlatformList}}\n\
<div class="footer">\n\
    [ this document was created with\n\
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>\n\
    ]\n\
</div>\n\
</div>\n\
</body>');



// https://img.shields.io/badge/tests_failed-999-dd0000.svg?style=flat
local.assetsDict["/assets.testReportBadge.template.svg"] =
'<svg xmlns="http://www.w3.org/2000/svg" width="103" height="20"><linearGradient id="a" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><rect rx="0" width="103" height="20" fill="#555"/><rect rx="0" x="72" width="31" height="20" fill="#d00"/><path fill="#d00" d="M72 0h4v20h-4z"/><rect rx="0" width="103" height="20" fill="url(#a)"/><g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11"><text x="37" y="15" fill="#010101" fill-opacity=".3">tests failed</text><text x="37" y="14">tests failed</text><text x="86.5" y="15" fill="#010101" fill-opacity=".3">999</text><text x="86.5" y="14">999</text></g></svg>';



local.assetsDict["/assets.utility2.rollup.begin.js"] = '\
/* utility2.rollup.js begin */\n\
/* istanbul ignore all */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function () {\n\
    "use strict";\n\
    // init utility2_rollup\n\
    globalThis.utility2_rollup = (\n\
        globalThis.utility2_rollup_old\n\
        || globalThis.globalLocal\n\
    );\n\
    globalThis.utility2_rollup.local = globalThis.utility2_rollup;\n\
    globalThis.utility2_rollup_old = null;\n\
}());\n\
';



local.assetsDict["/assets.utility2.rollup.content.js"] = '\
(function (local) {\n\
    "use strict";\n\
/* jslint ignore:start */\n\
/* utility2.rollup.js content */\n\
/* jslint ignore:end */\n\
    return local;\n\
}(globalThis.utility2_rollup));\n\
';



local.assetsDict["/assets.utility2.rollup.end.js"] = '\
(function () {\n\
    "use strict";\n\
    globalThis.utility2_rollup_old = globalThis.utility2_rollup;\n\
    globalThis.utility2_rollup = null;\n\
}());\n\
/* utility2.rollup.js end */\n\
';



local.assetsDict["/favicon.ico"] = "";
/* jslint ignore:end */



local.cliDict = {};

local.cliDict["utility2.browserTest"] = function () {
/*
 * <urlList> <mode>
 * will browser-test in parallel, comma-separated <urlList> with given <mode>
 */
    process.argv[3].split(
        process.argv[3].indexOf("?") >= 0
        ? (
            /\s/g
        )
        : (
            /[,\s]/g
        )
    ).filter(local.identity).forEach(function (url) {
        local.browserTest({
            url
        }, local.onErrorDefault);
    });
};

local.cliDict["utility2.githubCrudContentDelete"] = function () {
/*
 * <fileRemote|dirRemote> <commitMessage>
 * will delete from github <fileRemote|dirRemote>
 */
    local.github_crud.githubCrudContentDelete({
        message: process.argv[4],
        url: process.argv[3]
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudContentGet"] = function () {
/*
 * <fileRemote>
 * will get from github <fileRemote>
 */
    local.github_crud.githubCrudContentGet({
        url: process.argv[3]
    }, function (err, data) {
        try {
            process.stdout.write(data);
        } catch (ignore) {}
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudContentPut"] = function () {
/*
 * <fileRemote> <fileLocal> <commitMessage>
 * will put on github <fileRemote>, <fileLocal>
 */
    local.github_crud.githubCrudContentPutFile({
        message: process.argv[5],
        url: process.argv[3],
        file: process.argv[4]
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudContentTouch"] = function () {
/*
 * <fileRemoteList> <commitMessage>
 * will touch on github in parallel, comma-separated <fileRemoteList>
 */
    local.github_crud.githubCrudContentTouchList({
        message: process.argv[4],
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudRepoCreate"] = function () {
/*
 * <repoList>
 * will create on github in parallel, comma-separated <repoList>
 */
    local.github_crud.githubCrudRepoCreateList({
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudRepoDelete"] = function () {
/*
 * <repoList>
 * will delete from github in parallel, comma-separated <repoList>
 */
    local.github_crud.githubCrudRepoDeleteList({
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.start"] = function () {
/*
 * <port>
 * will start utility2 http-server on given <port> (default 8081)
 */
    local.env.PORT = process.argv[3] || local.env.PORT;
    globalThis.local = local;
    local.replStart();
    local.testRunServer({});
};

local.cliDict["utility2.swaggerValidateFile"] = function () {
/*
 * <file/url>
 * will swagger-validate file/url
 */
    setTimeout(function () {
        local.swgg.swaggerValidateFile({
            file: process.argv[3]
        }, function (err, data) {
            console.error(data);
            process.exit(err);
        });
    });
};

local.cliDict["utility2.testReportCreate"] = function () {
/*
 *
 * will create test-report
 */
    local.exit(
        local.testReportCreate(
            JSON.parse(local.fs.readFileSync(
                local.env.npm_config_dir_build + "/test-report.json"
            ))
        ).testsFailed
    );
};
}());



/* istanbul ignore next */
// run shared js-env code - polyfill
(function () {
    var ArrayPrototypeFlat;
    var TextXxcoder;
    ArrayPrototypeFlat = function (depth) {
    /*
     * this function will polyfill Array.prototype.flat
     * https://github.com/jonathantneal/array-flat-polyfill
     */
        depth = (
            globalThis.isNaN(depth)
            ? 1
            : Number(depth)
        );
        if (!depth) {
            return Array.prototype.slice.call(this);
        }
        return Array.prototype.reduce.call(this, function (acc, cur) {
            if (Array.isArray(cur)) {
                // recurse
                acc.push.apply(acc, ArrayPrototypeFlat.call(cur, depth - 1));
            } else {
                acc.push(cur);
            }
            return acc;
        }, []);
    };
    Array.prototype.flat = Array.prototype.flat || ArrayPrototypeFlat;
    Array.prototype.flatMap = Array.prototype.flatMap || function flatMap(
        ...argList
    ) {
    /*
     * this function will polyfill Array.prototype.flatMap
     * https://github.com/jonathantneal/array-flat-polyfill
     */
        return this.map(...argList).flat();
    };
    if (!local.isBrowser) {
        globalThis.TextDecoder = (
            globalThis.TextDecoder || require("util").TextDecoder
        );
        globalThis.TextEncoder = (
            globalThis.TextEncoder || require("util").TextEncoder
        );
    }
    TextXxcoder = function () {
    /*
     * this function will polyfill TextDecoder/TextEncoder
     * https://gist.github.com/Yaffle/5458286
     */
        return;
    };
    TextXxcoder.prototype.decode = function (octets) {
    /*
     * this function will polyfill TextDecoder.prototype.decode
     * https://gist.github.com/Yaffle/5458286
     */
        var bytesNeeded;
        var codePoint;
        var ii;
        var kk;
        var octet;
        var string;
        string = "";
        ii = 0;
        while (ii < octets.length) {
            octet = octets[ii];
            bytesNeeded = 0;
            codePoint = 0;
            if (octet <= 0x7F) {
                bytesNeeded = 0;
                codePoint = octet & 0xFF;
            } else if (octet <= 0xDF) {
                bytesNeeded = 1;
                codePoint = octet & 0x1F;
            } else if (octet <= 0xEF) {
                bytesNeeded = 2;
                codePoint = octet & 0x0F;
            } else if (octet <= 0xF4) {
                bytesNeeded = 3;
                codePoint = octet & 0x07;
            }
            if (octets.length - ii - bytesNeeded > 0) {
                kk = 0;
                while (kk < bytesNeeded) {
                    octet = octets[ii + kk + 1];
                    codePoint = (codePoint << 6) | (octet & 0x3F);
                    kk += 1;
                }
            } else {
                codePoint = 0xFFFD;
                bytesNeeded = octets.length - ii;
            }
            string += String.fromCodePoint(codePoint);
            ii += bytesNeeded + 1;
        }
        return string;
    };
    TextXxcoder.prototype.encode = function (string) {
    /*
     * this function will polyfill TextEncoder.prototype.encode
     * https://gist.github.com/Yaffle/5458286
     */
        var bits;
        var cc;
        var codePoint;
        var ii;
        var length;
        var octets;
        octets = [];
        length = string.length;
        ii = 0;
        while (ii < length) {
            codePoint = string.codePointAt(ii);
            cc = 0;
            bits = 0;
            if (codePoint <= 0x0000007F) {
                cc = 0;
                bits = 0x00;
            } else if (codePoint <= 0x000007FF) {
                cc = 6;
                bits = 0xC0;
            } else if (codePoint <= 0x0000FFFF) {
                cc = 12;
                bits = 0xE0;
            } else if (codePoint <= 0x001FFFFF) {
                cc = 18;
                bits = 0xF0;
            }
            octets.push(bits | (codePoint >> cc));
            cc -= 6;
            while (cc >= 0) {
                octets.push(0x80 | ((codePoint >> cc) & 0x3F));
                cc -= 6;
            }
            ii += (
                codePoint >= 0x10000
                ? 2
                : 1
            );
        }
        return octets;
    };
    globalThis.TextDecoder = globalThis.TextDecoder || TextXxcoder;
    globalThis.TextEncoder = globalThis.TextEncoder || TextXxcoder;
}());



// run shared js-env code - function
(function () {
// init lib Blob
local.Blob = (
    local.isBrowser
    ? globalThis.Blob
    : function (array, opt) {
        /*
         * this function will create a node-compatible Blob instance
         * https://developer.mozilla.org/en-US/docs/Web/API/Blob/Blob
         */
        this.bff = local.bufferConcat(array.map(function (elem) {
            return (
                // ternary-operator
                (
                    typeof elem === "string"
                    || Object.prototype.toString.call(elem)
                    === "[object Uint8Array]"
                )
                ? elem
                : String(elem)
            );
        }));
        this.type = opt && opt.type;
    }
);

// init lib FormData
local.FormData = function () {
/*
 * this function will create a serverLocal-compatible FormData instance
 * The FormData(form) constructor must run these steps:
 * 1. Let fd be a new FormData object.
 * 2. If form is given, set fd's entries to the result
 *    of constructing the form data set for form. (not implemented)
 * 3. Return fd.
 * https://xhr.spec.whatwg.org/#dom-formdata
 */
    this.entryList = [];
};

local.FormData.prototype.append = function (name, value, filename) {
/*
 * The append(name, value, filename) method, when invoked, must run these steps:
 * 1. If the filename argument is given, set value to a new File object
 *    whose contents are value and name is filename.
 * 2. Append a new entry whose name is name, and value is value,
 *    to context object's list of entries.
 * https://xhr.spec.whatwg.org/#dom-formdata-append
 */
    if (filename) {
        // bug-workaround - chromium cannot assign name to Blob instance
        local.tryCatchOnError(function () {
            value.name = filename;
        }, local.nop);
    }
    this.entryList.push({
        name,
        value
    });
};

local.FormData.prototype.read = function (onError) {
/*
 * this function will read from formData as a buffer, e.g.
 * --Boundary\r\n
 * Content-Disposition: form-data; name="key"\r\n
 * \r\n
 * value\r\n
 * --Boundary\r\n
 * Content-Disposition: form-data; name="input1"; filename="file1.png"\r\n
 * Content-Type: image/jpeg\r\n
 * \r\n
 * <data1>\r\n
 * --Boundary\r\n
 * Content-Disposition: form-data; name="input2"; filename="file2.png"\r\n
 * Content-Type: image/jpeg\r\n
 * \r\n
 * <data2>\r\n
 * --Boundary--\r\n
 * https://tools.ietf.org/html/rfc7578
 */
    var boundary;
    var result;
    // handle null-case
    if (!this.entryList.length) {
        onError(null, "");
        return;
    }
    // init boundary
    boundary = "--" + Date.now().toString(16) + Math.random().toString(16);
    // init result
    result = [];
    local.onParallelList({
        list: this.entryList
    }, function (option2, onParallel) {
        var value;
        value = option2.elem.value;
        if (!(value && value.constructor === local.Blob)) {
            result[option2.ii] = [
                (
                    boundary + "\r\nContent-Disposition: form-data; name=\""
                    + option2.elem.name + "\"\r\n\r\n"
                ), value, "\r\n"
            ];
            onParallel.counter += 1;
            onParallel();
            return;
        }
        // read from blob in parallel
        onParallel.counter += 1;
        local.blobRead(value, function (err, data) {
            result[option2.ii] = !err && [
                (
                    boundary + "\r\nContent-Disposition: form-data; name=\""
                    + option2.elem.name + "\"" + (
                        (value && value.name)
                        // read param filename
                        ? "; filename=\"" + value.name + "\""
                        : ""
                    ) + "\r\n" + (
                        (value && value.type)
                        // read param Content-Type
                        ? "Content-Type: " + value.type + "\r\n"
                        : ""
                    ) + "\r\n"
                ), data, "\r\n"
            ];
            onParallel(err);
        });
    }, function (err) {
        // add closing boundary
        result.push([
            boundary + "--\r\n"
        ]);
        // concatenate result
        onError(
            err,
            // flatten result
            !err
            && local.bufferConcat(Array.prototype.concat.apply([], result))
        );
    });
};

// init lib _http
local._http = {};

// init _http.IncomingMessage
local._http.IncomingMessage = function (xhr) {
/*
 * An IncomingMessage object is created by http.Server or http.ClientRequest
 * and passed as the first argument to the 'req' and 'res' event
 * respectively.
 * It may be used to access res status, headers and data.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_http_incomingmessage
 */
    this.headers = xhr.headers;
    this.httpVersion = "1.1";
    this.method = xhr.method;
    this.onEvent = document.createDocumentFragment();
    this.readable = true;
    this.url = xhr.url;
};

local._http.IncomingMessage.prototype.addListener = function (evt, onEvent) {
/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener will result
 * in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_addlistener_event_listener
 */
    this.onEvent.addEventListener(evt, function (evt) {
        onEvent(evt.data);
    });
    if (this.readable && evt === "end") {
        this.readable = null;
        this.emit("data", this.data);
        this.emit("end");
    }
    return this;
};

local._http.IncomingMessage.prototype.emit = function (evt, data) {
/*
 * Execute each of the listeners in order with the supplied arguments.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_emit_event_arg1_arg2
 */
    evt = new Event(evt);
    evt.data = data;
    this.onEvent.dispatchEvent(evt);
};

/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener will result
 * in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_on_event_listener
 */
local._http.IncomingMessage.prototype.on = (
    local._http.IncomingMessage.prototype.addListener
);

local._http.IncomingMessage.prototype.pipe = function (writable) {
/*
 * This method pulls all the data out of a readable stream, and writes it
 * to the supplied destination, automatically managing the flow
 * so that the destination is not overwhelmed by a fast readable stream.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_readable_pipe_destination_options
 */
    this.on("data", function (chunk) {
        writable.write(chunk);
    });
    this.on("end", function () {
        writable.end();
    });
    return writable;
};

local._http.STATUS_CODES = {
    "100": "Continue",
    "101": "Switching Protocols",
    "102": "Processing",
    "200": "OK",
    "201": "Created",
    "202": "Accepted",
    "203": "Non-Authoritative Information",
    "204": "No Content",
    "205": "Reset Content",
    "206": "Partial Content",
    "207": "Multi-Status",
    "208": "Already Reported",
    "226": "IM Used",
    "300": "Multiple Choices",
    "301": "Moved Permanently",
    "302": "Found",
    "303": "See Other",
    "304": "Not Modified",
    "305": "Use Proxy",
    "307": "Temporary Redirect",
    "308": "Permanent Redirect",
    "400": "Bad Request",
    "401": "Unauthorized",
    "402": "Payment Required",
    "403": "Forbidden",
    "404": "Not Found",
    "405": "Method Not Allowed",
    "406": "Not Acceptable",
    "407": "Proxy Authentication Required",
    "408": "Request Timeout",
    "409": "Conflict",
    "410": "Gone",
    "411": "Length Required",
    "412": "Precondition Failed",
    "413": "Payload Too Large",
    "414": "URI Too Long",
    "415": "Unsupported Media Type",
    "416": "Range Not Satisfiable",
    "417": "Expectation Failed",
    "418": "I'm a teapot",
    "421": "Misdirected Request",
    "422": "Unprocessable Entity",
    "423": "Locked",
    "424": "Failed Dependency",
    "425": "Unordered Collection",
    "426": "Upgrade Required",
    "428": "Precondition Required",
    "429": "Too Many Requests",
    "431": "Request Header Fields Too Large",
    "451": "Unavailable For Legal Reasons",
    "500": "Internal Server Error",
    "501": "Not Implemented",
    "502": "Bad Gateway",
    "503": "Service Unavailable",
    "504": "Gateway Timeout",
    "505": "HTTP Version Not Supported",
    "506": "Variant Also Negotiates",
    "507": "Insufficient Storage",
    "508": "Loop Detected",
    "509": "Bandwidth Limit Exceeded",
    "510": "Not Extended",
    "511": "Network Authentication Required"
};

// init _http.ServerResponse
local._http.ServerResponse = function (onResponse) {
/*
 * This object is created internally by a HTTP server--not by the user.
 * It is passed as the second parameter to the 'req' event.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_class_http_serverresponse
 */
    this.chunkList = [];
    this.onEvent = document.createDocumentFragment();
    this.onResponse = onResponse;
    this.resHeaders = {};
    this.statusCode = 200;
};

/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener will result
 * in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_addlistener_event_listener
 */
local._http.ServerResponse.prototype.addListener = (
    local._http.IncomingMessage.prototype.addListener
);
/*
 * Execute each of the listeners in order with the supplied arguments.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_emit_event_arg1_arg2
 */
local._http.ServerResponse.prototype.emit = (
    local._http.IncomingMessage.prototype.emit
);

local._http.ServerResponse.prototype.end = function (data) {
/*
 * This method signals to the server that all of the res headers and body
 * have been sent; that server should consider this message complete.
 * The method, res.end(), MUST be called on each res.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_end_data_encoding_callback
 */
    var that;
    that = this;
    if (that._isDone) {
        return;
    }
    that._isDone = true;
    that.chunkList.push(data);
    // notify server res is finished
    that.emit("finish");
    // asynchronously send res from server to client
    setTimeout(function () {
        that.onResponse(that);
        that.emit("data", local.bufferConcat(that.chunkList));
        that.emit("end");
    });
};

/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener
 * will result in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_on_event_listener
 */
local._http.ServerResponse.prototype.on = (
    local._http.IncomingMessage.prototype.addListener
);

local._http.ServerResponse.prototype.setHeader = function (key, value) {
/*
 * Sets a single header value for implicit headers.
 * If this header already exists in the to-be-sent headers,
 * its value will be replaced.
 * Use an array of strings here if you need to send multiple headers
 * with the same name.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_setheader_name_value
 */
    this.resHeaders[key.toLowerCase()] = value;
};

local._http.ServerResponse.prototype.write = function (data) {
/*
 * This sends a chunk of the res body.
 * This method may be called multiple times
 * to provide successive parts of the body.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_write_chunk_encoding_callback
 */
    this.chunkList.push(data);
};

local._http.createServer = function () {
/*
 * Returns a new instance of http.Server.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_http_createserver_requestlistener
 */
    return {
        listen: function (port, onError) {
        /*
         * This will cause the server to accept connections
         * on the specified handle,
         * but it is presumed that the file descriptor or handle
         * has already been bound to a port or domain socket.
         * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_server_listen_handle_callback
         */
            onError(null, port);
        }
    };
};

local._http.request = function (xhr, onResponse) {
    var isDone;
    xhr = {
        headers: xhr.headers,
        method: xhr.method,
        timeout: xhr.timeout,
        url: xhr.href
    };
    xhr.end = function (data) {
        if (isDone) {
            return;
        }
        isDone = true;
        xhr.serverReq.data = data;
        // asynchronously send req from client -> server
        setTimeout(function () {
            local.serverLocalReqHandler(
                xhr.serverReq,
                xhr.serverResponse
            );
        });
    };
    xhr.on = function () {
        return xhr;
    };
    xhr.serverReq = new local._http.IncomingMessage(xhr);
    xhr.serverResponse = new local._http.ServerResponse(onResponse);
    return xhr;
};

local._testCase_buildApidoc_default = function (opt, onError) {
/*
 * this function will test buildApidoc's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildApidoc(opt, onError);
};

local._testCase_buildApp_default = function (opt, onError) {
/*
 * this function will test buildApp's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    globalThis.local.testCase_buildReadme_default(opt, local.onErrorThrow);
    globalThis.local.testCase_buildLib_default(opt, local.onErrorThrow);
    globalThis.local.testCase_buildTest_default(opt, local.onErrorThrow);
    local.buildApp(opt, onError);
};

local._testCase_buildLib_default = function (opt, onError) {
/*
 * this function will test buildLib's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildLib({}, onError);
};

local._testCase_buildReadme_default = function (opt, onError) {
/*
 * this function will test buildReadme's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildReadme({}, onError);
};

local._testCase_buildTest_default = function (opt, onError) {
/*
 * this function will test buildTest's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildTest({}, onError);
};

local._testCase_webpage_default = function (opt, onError) {
/*
 * this function will test webpage's default handling-behavior
 */
    local.domStyleValidate();
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.browserTest({
        fileScreenshot: (
            local.env.npm_config_dir_build
            + "/screenshot." + local.env.MODE_BUILD + ".browser.%2F.png"
        ),
        modeCoverageMerge: true,
        url: (
            local.assetsDict["/"].indexOf(
                "<script src=\"assets.test.js\"></script>"
            ) >= 0
            ? local.serverLocalHost + "?modeTest=1&timeoutDefault="
            + local.timeoutDefault
            : local.serverLocalHost
            + "/assets.utility2.base.html?modeTest=1&timeoutDefault=1"
        ) + "&modeTestCase=" + local.modeTestCase.replace((
            /_?testCase_webpage_default/
        ), "")
    }, onError);
};

local.ajax = function (opt, onError) {
/*
 * this function will send an ajax-req
 * with given <opt>.url and callback <onError>
 * with err and timeout handling
 * example usage:
    local.ajax({
        data: "hello world",
        header: {"x-header-hello": "world"},
        method: "POST",
        url: "/index.html"
    }, function (err, xhr) {
        console.log(xhr.statusCode);
        console.log(xhr.responseText);
    });
 */
    var ajaxProgressUpdate;
    var bufferValidateAndCoerce;
    var isDone;
    var local2;
    var onEvent;
    var streamCleanup;
    var timeout;
    var tmp;
    var xhr;
    var xhrInit;
    // init local2
    local2 = opt.local2 || local.utility2 || {};
    // init function
    ajaxProgressUpdate = local2.ajaxProgressUpdate || local.nop;
    bufferValidateAndCoerce = local2.bufferValidateAndCoerce || function (
        bff,
        mode
    ) {
    /*
     * this function will validate and coerce/convert <bff> -> Buffer
     * (or String if <mode> = "string")
     */
        // coerce ArrayBuffer -> Buffer
        if (Object.prototype.toString.call(bff) === "[object ArrayBuffer]") {
            bff = new Uint8Array(bff);
        }
        // convert Buffer -> utf8
        if (mode === "string" && typeof bff !== "string") {
            bff = String(bff);
        }
        return bff;
    };
    onEvent = function (evt) {
    /*
     * this function will handle events
     */
        if (Object.prototype.toString.call(evt) === "[object Error]") {
            xhr.err = xhr.err || evt;
            xhr.onEvent({
                type: "error"
            });
            return;
        }
        // init statusCode
        xhr.statusCode = (xhr.statusCode || xhr.status) | 0;
        switch (evt.type) {
        case "abort":
        case "error":
        case "load":
            if (isDone) {
                return;
            }
            isDone = true;
            // decrement ajaxProgressCounter
            local2.ajaxProgressCounter = Math.max(
                local2.ajaxProgressCounter - 1,
                0
            );
            ajaxProgressUpdate();
            // handle abort or err event
            switch (!xhr.err && evt.type) {
            case "abort":
            case "error":
                xhr.err = new Error("ajax - event " + evt.type);
                break;
            case "load":
                if (xhr.statusCode >= 400) {
                    xhr.err = new Error(
                        "ajax - statusCode " + xhr.statusCode
                    );
                }
                break;
            }
            // debug statusCode / method / url
            if (xhr.err) {
                xhr.statusCode = xhr.statusCode || 500;
                xhr.err.statusCode = xhr.statusCode;
                tmp = (
                    // ternary-operator
                    (
                        local.isBrowser
                        ? "browser"
                        : "node"
                    )
                    + " - " + xhr.statusCode + " " + xhr.method + " " + xhr.url
                    + "\n"
                );
                xhr.err.message = tmp + xhr.err.message;
                xhr.err.stack = tmp + xhr.err.stack;
            }
            // update resHeaders
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getAllResponseHeaders
            if (xhr.getAllResponseHeaders) {
                xhr.getAllResponseHeaders().replace((
                    /(.*?):\u0020*(.*?)\r\n/g
                ), function (ignore, match1, match2) {
                    xhr.resHeaders[match1.toLowerCase()] = match2;
                });
            }
            // debug ajaxResponse
            xhr.resContentLength = (
                xhr.response
                && (xhr.response.byteLength || xhr.response.length)
            ) | 0;
            xhr.timeElapsed = Date.now() - xhr.timeStart;
            if (xhr.modeDebug) {
                console.error("serverLog - " + JSON.stringify({
                    time: new Date(xhr.timeStart).toISOString(),
                    type: "ajaxResponse",
                    method: xhr.method,
                    url: xhr.url,
                    statusCode: xhr.statusCode,
                    timeElapsed: xhr.timeElapsed,
                    // extra
                    resContentLength: xhr.resContentLength
                }));
            }
            // init responseType
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType
            switch (xhr.response && xhr.responseType) {
            // init responseText
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText
            case "":
            case "text":
                if (typeof xhr.responseText === "string") {
                    break;
                }
                xhr.responseText = bufferValidateAndCoerce(
                    xhr.response,
                    "string"
                );
                break;
            case "arraybuffer":
                xhr.responseBuffer = bufferValidateAndCoerce(xhr.response);
                break;
            }
            // cleanup timerTimeout
            clearTimeout(xhr.timerTimeout);
            // cleanup reqStream and resStream
            streamCleanup(xhr.reqStream);
            streamCleanup(xhr.resStream);
            onError(xhr.err, xhr);
            break;
        }
    };
    streamCleanup = function (stream) {
    /*
     * this function will try to end or destroy <stream>
     */
        var err;
        // try to end stream
        try {
            stream.end();
        } catch (errCaught) {
            err = errCaught;
        }
        // if err, then try to destroy stream
        if (err) {
            try {
                stream.destroy();
            } catch (ignore) {}
        }
    };
    xhrInit = function () {
    /*
     * this function will init xhr
     */
        // init opt
        Object.keys(opt).forEach(function (key) {
            if (key[0] !== "_") {
                xhr[key] = opt[key];
            }
        });
        // init timeout
        timeout = xhr.timeout || local2.timeoutDefault || 30000;
        // init default
        local.objectAssignDefault(xhr, {
            corsForwardProxyHost: local2.corsForwardProxyHost,
            headers: {},
            location: (local.isBrowser && location) || {},
            method: "GET",
            responseType: ""
        });
        // init headers
        Object.keys(xhr.headers).forEach(function (key) {
            xhr.headers[key.toLowerCase()] = xhr.headers[key];
        });
        // coerce Uint8Array -> Buffer
        if (
            !local.isBrowser
            && !Buffer.isBuffer(xhr.data)
            && Object.prototype.toString.call(xhr.data)
            === "[object Uint8Array]"
        ) {
            Object.setPrototypeOf(xhr.data, Buffer.prototype);
        }
        // init misc
        local2._debugXhr = xhr;
        xhr.onEvent = onEvent;
        xhr.resHeaders = {};
        xhr.timeStart = xhr.timeStart || Date.now();
    };
    // init onError
    if (local2.onErrorWithStack) {
        onError = local2.onErrorWithStack(onError);
    }
    // init xhr - XMLHttpRequest
    xhr = (
        local.isBrowser
        && !opt.httpReq
        && !(local2.serverLocalUrlTest && local2.serverLocalUrlTest(opt.url))
        && new XMLHttpRequest()
    );
    // init xhr - http.request
    if (!xhr) {
        xhr = local.identity(local2.urlParse || require("url").parse)(opt.url);
        // init xhr
        xhrInit();
        // init xhr - http.request
        xhr = local.identity(
            opt.httpReq
            || (local.isBrowser && local2.http.request)
            || require(xhr.protocol.slice(0, -1)).request
        )(xhr, function (resStream) {
        /*
         * this function will read <resStream>
         */
            var chunkList;
            chunkList = [];
            xhr.resHeaders = resStream.resHeaders || resStream.headers;
            xhr.resStream = resStream;
            xhr.statusCode = resStream.statusCode;
            resStream.dataLength = 0;
            resStream.on("data", function (chunk) {
                chunkList.push(chunk);
            });
            resStream.on("end", function () {
                xhr.response = (
                    local.isBrowser
                    ? chunkList[0]
                    : Buffer.concat(chunkList)
                );
                resStream.dataLength = (
                    xhr.response.byteLength || xhr.response.length
                );
                xhr.onEvent({
                    type: "load"
                });
            });
            resStream.on("error", xhr.onEvent);
        });
        xhr.abort = function () {
        /*
         * this function will abort xhr-req
         * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/abort
         */
            xhr.onEvent({
                type: "abort"
            });
        };
        xhr.addEventListener = local.nop;
        xhr.open = local.nop;
        xhr.reqStream = xhr;
        xhr.send = xhr.end;
        xhr.setRequestHeader = local.nop;
        xhr.on("error", onEvent);
    }
    // init xhr
    xhrInit();
    // init timerTimeout
    xhr.timerTimeout = setTimeout(function () {
        xhr.err = xhr.err || new Error(
            "onTimeout - errTimeout - "
            + timeout + " ms - " + "ajax " + xhr.method + " " + xhr.url
        );
        xhr.abort();
        // cleanup reqStream and resStream
        streamCleanup(xhr.reqStream);
        streamCleanup(xhr.resStream);
    }, timeout);
    // increment ajaxProgressCounter
    local2.ajaxProgressCounter = local2.ajaxProgressCounter || 0;
    local2.ajaxProgressCounter += 1;
    // init event-handling
    xhr.addEventListener("abort", xhr.onEvent);
    xhr.addEventListener("error", xhr.onEvent);
    xhr.addEventListener("load", xhr.onEvent);
    xhr.addEventListener("loadstart", ajaxProgressUpdate);
    xhr.addEventListener("progress", ajaxProgressUpdate);
    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/upload
    if (xhr.upload && xhr.upload.addEventListener) {
        xhr.upload.addEventListener("progress", ajaxProgressUpdate);
    }
    // open url - corsForwardProxyHost
    if (local.functionOrNop(local2.corsForwardProxyHostIfNeeded)(xhr)) {
        xhr.open(xhr.method, local2.corsForwardProxyHostIfNeeded(xhr));
        xhr.setRequestHeader(
            "forward-proxy-headers",
            JSON.stringify(xhr.headers)
        );
        xhr.setRequestHeader("forward-proxy-url", xhr.url);
    // open url - default
    } else {
        xhr.open(xhr.method, xhr.url);
    }
    // send headers
    Object.keys(xhr.headers).forEach(function (key) {
        xhr.setRequestHeader(key, xhr.headers[key]);
    });
    // send data
    switch ((xhr.data && xhr.data.constructor) || true) {
    // Blob
    // https://developer.mozilla.org/en-US/docs/Web/API/Blob
    case local2.Blob:
    // FormData
    // https://developer.mozilla.org/en-US/docs/Web/API/FormData
    case local2.FormData:
        local2.blobRead(xhr.data, function (err, data) {
            if (err) {
                xhr.onEvent(err);
                return;
            }
            // send data
            xhr.send(data);
        });
        break;
    default:
        xhr.send(xhr.data);
    }
    return xhr;
};

local.ajaxProgressUpdate = function () {
/*
 * this function will update ajaxProgress
 */
    var ajaxProgressDiv1;
    // init state
    local.ajaxProgressCounter = local.ajaxProgressCounter || 0;
    local.ajaxProgressState = local.ajaxProgressState || 0;
    ajaxProgressDiv1 = (local.isBrowser && document.querySelector(
        "#ajaxProgressDiv1"
    )) || {
        style: {
            width: ""
        }
    };
    // init ajaxProgressDiv1StyleBackground
    local.ajaxProgressDiv1StyleBackground = (
        local.ajaxProgressDiv1StyleBackground
        || ajaxProgressDiv1.style.background
    );
    // show ajaxProgress
    ajaxProgressDiv1.style.background = local.ajaxProgressDiv1StyleBackground;
    // increment ajaxProgress
    if (local.ajaxProgressCounter > 0) {
        local.timerIntervalAjaxProgressHide = (
            local.timerIntervalAjaxProgressHide
            || setInterval(local.ajaxProgressUpdate, 2000)
        );
        // this algorithm will indefinitely increment ajaxProgressBar
        // with successively smaller increments without ever reaching 100%
        if ((ajaxProgressDiv1.style.width.slice(0, -1) | 0) > 95) {
            ajaxProgressDiv1.style.width = "0%";
            local.ajaxProgressState = 0;
        }
        local.ajaxProgressState += 1;
        ajaxProgressDiv1.style.width = Math.max(
            100 - 75 * Math.exp(-0.125 * local.ajaxProgressState),
            ajaxProgressDiv1.style.width.slice(0, -1) | 0
        ) + "%";
    } else {
        // finish ajaxProgress
        ajaxProgressDiv1.style.width = "100%";
    }
    // cleanup timerTimeout
    clearTimeout(local.timerTimeoutAjaxProgressHide);
    // hide ajaxProgress
    local.timerTimeoutAjaxProgressHide = setTimeout(function () {
        ajaxProgressDiv1.style.background = "transparent";
        local.ajaxProgressCounter = 0;
        local.ajaxProgressState = 0;
        // reset ajaxProgress
        clearInterval(local.timerIntervalAjaxProgressHide);
        local.timerIntervalAjaxProgressHide = null;
        setTimeout(function () {
            if (!local.ajaxProgressState) {
                ajaxProgressDiv1.style.width = "0%";
            }
        }, 500);
    }, (
        local.ajaxProgressCounter > 0
        ? local.timeoutDefault
        : 1000
    ));
};

local.assertJsonEqual = function (aa, bb, message) {
/*
 * this function will assert jsonStringifyOrdered(<aa>) === JSON.stringify(<bb>)
 */
    aa = local.jsonStringifyOrdered(aa);
    bb = JSON.stringify(bb);
    local.assertThrow(aa === bb, message || [
        aa, bb
    ]);
};

local.assertJsonNotEqual = function (aa, bb, message) {
/*
 * this function will assert jsonStringifyOrdered(<aa>) !== JSON.stringify(<bb>)
 */
    aa = local.jsonStringifyOrdered(aa);
    bb = JSON.stringify(bb);
    local.assertThrow(aa !== bb, [
        aa
    ], message || aa);
};

local.base64FromBuffer = function (bff) {
/*
 * this function will convert Uint8Array <bff> to base64
 * https://developer.mozilla.org/en-US/Add-ons/Code_snippets/StringView#The_code
 */
    var ii;
    var mod3;
    var text;
    var uint24;
    var uint6ToB64;
    // convert utf8 -> Uint8Array
    if (typeof bff === "string") {
        bff = new TextEncoder().encode(bff);
    }
    bff = bff || [];
    text = "";
    uint24 = 0;
    uint6ToB64 = function (uint6) {
        return (
            uint6 < 26
            ? uint6 + 65
            : uint6 < 52
            ? uint6 + 71
            : uint6 < 62
            ? uint6 - 4
            : uint6 === 62
            ? 43
            : 47
        );
    };
    ii = 0;
    while (ii < bff.length) {
        mod3 = ii % 3;
        uint24 |= bff[ii] << (16 >>> mod3 & 24);
        if (mod3 === 2 || bff.length - ii === 1) {
            text += String.fromCharCode(
                uint6ToB64(uint24 >>> 18 & 63),
                uint6ToB64(uint24 >>> 12 & 63),
                uint6ToB64(uint24 >>> 6 & 63),
                uint6ToB64(uint24 & 63)
            );
            uint24 = 0;
        }
        ii += 1;
    }
    return text.replace((
        /A(?=A$|$)/gm
    ), "=");
};

local.base64ToBuffer = function (b64, mode) {
/*
 * this function will convert <b64> to Uint8Array
 * https://gist.github.com/wang-bin/7332335
 */
    var bff;
    var byte;
    var chr;
    var ii;
    var jj;
    var map64;
    var mod4;
    b64 = b64 || "";
    bff = new Uint8Array(b64.length); // 3/4
    byte = 0;
    jj = 0;
    map64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    mod4 = 0;
    ii = 0;
    while (ii < b64.length) {
        chr = map64.indexOf(b64[ii]);
        if (chr >= 0) {
            mod4 %= 4;
            if (mod4 === 0) {
                byte = chr;
            } else {
                byte = byte * 64 + chr;
                bff[jj] = 255 & (byte >> ((-2 * (mod4 + 1)) & 6));
                jj += 1;
            }
            mod4 += 1;
        }
        ii += 1;
    }
    // optimization - create resized-view of bff
    bff = bff.subarray(0, jj);
    return local.bufferValidateAndCoerce(bff, mode);
};

local.base64ToUtf8 = function (b64) {
/*
 * this function will convert <b64> -> utf8
 */
    return local.base64ToBuffer(b64, "string");
};

local.blobRead = function (blob, onError) {
/*
 * this function will read from <blob>
 */
    var isDone;
    var reader;
    if (blob && blob.constructor && blob.constructor === local.FormData) {
        blob.read(onError);
        return;
    }
    if (!local.isBrowser) {
        onError(null, local.bufferValidateAndCoerce(blob.bff));
        return;
    }
    reader = new FileReader();
    reader.onabort = function (evt) {
        if (isDone) {
            return;
        }
        isDone = true;
        switch (evt.type) {
        case "abort":
        case "error":
            onError(new Error("blobRead - " + evt.type));
            break;
        case "load":
            onError(
                null,
                Object.prototype.toString.call(reader.result)
                === "[object ArrayBuffer]"
                // convert ArrayBuffer -> Uint8Array
                ? new Uint8Array(reader.result)
                : reader.result
            );
            break;
        }
    };
    reader.onerror = reader.onabort;
    reader.onload = reader.onabort;
    reader.readAsArrayBuffer(blob);
};

local.browserTest = function (opt, onError) {
/*
 * this function will spawn an electron process to test <opt>.url
 */
    var isDone;
    var isDoneHtml;
    var onMessage;
    var onParallel;
    var timerTimeout;
    var window;
    window = opt.window || globalThis;
    // init utility2_testReport
    window.utility2_testReport = window.utility2_testReport || {
        coverage: window.__coverage__,
        testPlatformList: [
            {
                name: (
                    local.isBrowser
                    ? (
                        "browser - "
                        + location.pathname + " - " + navigator.userAgent
                    )
                    : "node - " + process.platform + " " + process.version
                ) + " - " + new Date().toISOString(),
                screenshot: local.env && local.env.MODE_BUILD_SCREENSHOT_IMG,
                testCaseList: []
            }
        ]
    };
    window.utility2_testReportSave = (
        window.utility2_testReportSave
        || local.nop
    );
    if (opt.modeTestReportCreate) {
        return;
    }
    onMessage = function (evt, type, data) {
        switch (evt && type) {
        case "html":
            if (isDoneHtml) {
                return;
            }
            isDoneHtml = true;
            opt.fs.writeFile(opt.fileScreenshot.replace((
                /\.\w+$/
            ), ".html"), data, onParallel);
            return;
        case "testReport":
            if (opt.isDoneTestReport || opt.modeBrowserTest !== "test") {
                return;
            }
            opt.isDoneTestReport = true;
            // save browser-coverage
            if (data.coverage) {
                onParallel.counter += 1;
                opt.fs.writeFile(
                    opt.fileCoverage,
                    JSON.stringify(data.coverage),
                    onParallel
                );
                data.coverage = null;
            }
            // save browser-screenshot
            data.testPlatformList[0].screenshot = (
                opt.fileScreenshot.replace((
                    /.*\//
                ), "")
            );
            // save browser-test-report
            onParallel.counter += 1;
            opt.fs.writeFile(
                opt.fileTestReport,
                JSON.stringify(data, null, 4),
                onParallel
            );
            onParallel();
            return;
        }
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        // node - init
        case 1:
            // init fileElectronHtml
            opt.fileElectronHtml = (
                opt.npm_config_dir_tmp
                + "/electron."
                + Date.now().toString(16)
                + Math.random().toString(16)
                + ".html"
            );
            // init url
            if (!(
                /^\w+:\/\//
            ).test(opt.url)) {
                opt.url = local.path.resolve(process.cwd(), opt.url);
            }
            opt.urlParsed = local.urlParse(opt.url);
            // init testName
            opt.testName = opt.urlParsed.pathname;
            if (opt.testName.indexOf(process.cwd()) === 0) {
                opt.testName = opt.testName.replace(process.cwd(), "");
            }
            opt.testName = (
                opt.MODE_BUILD + ".browser."
                + encodeURIComponent(opt.testName.replace(
                    "/build.."
                    + opt.CI_BRANCH
                    + ".." + opt.CI_HOST,
                    "/build"
                ))
            );
            local.objectSetDefault(opt, {
                fileCoverage: (
                    opt.npm_config_dir_tmp + "/coverage."
                    + opt.testName + ".json"
                ),
                fileScreenshot: (
                    opt.npm_config_dir_build + "/screenshot."
                    + opt.testName
                    + ".png"
                ),
                fileTestReport: (
                    opt.npm_config_dir_tmp + "/test-report."
                    + opt.testName
                    + ".json"
                ),
                modeBrowserTest: "test",
                timeExit: Date.now() + opt.timeoutDefault,
                timeoutScreenshot: opt.timeoutScreenshot || 15000
            }, 1);
            // init timerTimeout
            timerTimeout = local.onTimeout(
                opt.onNext,
                opt.timeoutDefault,
                opt.testName
            ).unref();
            data = {};
            Object.keys(opt).forEach(function (key) {
                if (typeof opt[key] !== "object") {
                    data[key] = opt[key];
                }
            });
            data.modeNext = 20;
            // init file fileElectronHtml
            local.fsWriteFileWithMkdirpSync(opt.fileElectronHtml, (
                "//<body "
                + "style=\"border:1px solid black;margin:0;padding:0;\">"
                + "<webview "
                + "preload=\""
                + opt.fileElectronHtml
                + "\" src=\""
                + opt.url.replace("{{timeExit}}", opt.timeExit)
                + "\" style="
                + "\"border:none;height:100%;margin:0;padding:0;width:100%;\">"
                + "</webview>"
                + "<script>document.body.removeChild(document.body.firstChild);"
                + "</script>"
                + "</body>"
                + "<textarea disabled style=\"display:none;\">\n"
                + local.assetsDict["/assets.example.begin.js"]
                + "(function(local){\n"
                + "\"use strict\";\n"
                + "local=globalThis.globalLocal;\n"
                + "local.env={};\n"
                + "local.isBrowser=true;\n"
                + "var opt=" + JSON.stringify(data) + ";\n"
                + [
                    "browserTest",
                    "nop",
                    "onErrorWithStack",
                    "onNext"
                ].map(function (key) {
                    return "local." + key + "=" + String(local[key])
                    // html-safe
                    .replace((
                        /<\//g
                    ), "<\\/")
                    // coverage-hack - un-instrument
                    .replace((
                        /\b__cov_.*?\+\+/g
                    ), "0") + ";\n";
                }).join("")
                + "local.browserTest(opt,console.error);\n"
                + "}());\n"
                + "//</textarea>\n"
            ));
            console.error(
                "\nbrowserTest - created fileElectronHtml "
                + opt.fileElectronHtml
                + "\n"
            );
            // spawn an electron process to test a url
            opt.npm_config_time_exit = opt.timeExit;
            data.modeNext = 10;
            local.childProcessSpawnWithTimeout("electron", [
                __filename,
                "utility2.browserTest",
                opt.url,
                "--enable-logging"
            ], {
                env: data,
                stdio: (
                    (!opt.modeDebug && opt.modeSilent)
                    ? "ignore"
                    : [
                        "ignore", 1, 2
                    ]
                ),
                timeout: opt.timeoutDefault
            }).once("error", opt.onNext).once("exit", opt.onNext);
            return;
        // node - after electron
        case 2:
            console.error(
                "\nbrowserTest - exit-code " + err + " - " + opt.url + "\n"
            );
            if (opt.modeBrowserTest !== "test") {
                opt.modeNext += 1000;
                opt.onNext();
                return;
            }
            // merge browser coverage
            data = (
                opt.modeCoverageMerge
                && local.fsReadFileOrEmptyStringSync(opt.fileCoverage, "json")
            );
            local.istanbulCoverageMerge(window.__coverage__, data);
            console.error(
                "\nbrowserTest - merged coverage from file "
                + opt.fileCoverage
                + "\n"
            );
            // merge browser test-report
            data = local.fsReadFileOrEmptyStringSync(
                opt.fileTestReport,
                "json"
            );
            local.testReportMerge(
                window.utility2_testReport,
                !opt.modeSilent && data
            );
            console.error(
                "\nbrowserTest - merged test-report from file "
                + opt.fileTestReport
                + "\n"
            );
            // create test-report.json
            local.fs.writeFileSync(
                local.env.npm_config_dir_build + "/test-report.json",
                JSON.stringify(window.utility2_testReport)
            );
            opt.onNext(data && data.testsFailed && new Error(data.testsFailed));
            return;
        // node.electron - init
        case 11:
            // handle uncaughtException
            window.process.once("uncaughtException", opt.onNext);
            // wait for electron to init
            opt.electron.app.once("ready", function () {
                opt.onNext();
            });
            return;
        // node.electron - after ready
        case 12:
            Object.assign(opt, {
                frame: false,
                height: 768,
                // disable nodeIntegration
                // https://github.com/electron/electron/blob/v2.0.0/docs/tutorial/security.md#how-1
                nodeIntegration: false,
                show: false,
                width: 1024,
                x: 0,
                y: 0
            });
            onParallel = local.onParallel(opt.onNext);
            // onParallel - html
            onParallel.counter += 1;
            // onParallel - test
            if (opt.modeBrowserTest === "test") {
                onParallel.counter += 1;
            }
            // init event-handling - ipc
            opt.electron.ipcMain.on(opt.fileElectronHtml, function (
                evt,
                type,
                data
            ) {
                try {
                    onMessage(evt, type, data);
                } catch (errCaught) {
                    opt.onNext(errCaught);
                }
            }, false);
            // init browserWindow
            opt.browserWindow = new opt.electron.BrowserWindow(opt);
            // load url in browserWindow
            opt.browserWindow.loadURL("file://" + opt.fileElectronHtml);
            return;
        // node.electron - screenshot
        case 13:
            opt.browserWindow.capturePage(opt, function (data) {
                opt.onNext(null, data);
            });
            return;
        case 14:
            opt.fs.writeFile(opt.fileScreenshot, data.toPNG(), opt.onNext);
            return;
        case 15:
            console.error(
                "\nbrowserTest - created screenshot file "
                + opt.fileScreenshot
                + "\n"
            );
            console.error(
                "browserTest - created screenshot file "
                + opt.fileScreenshot.replace((
                    /\.\w+$/
                ), ".html")
            );
            local.exit();
            return;
        // node.electron.browserWindow.webview.preload - init
        case 21:
            // init domOnEventWindowOnloadTimeElapsed
            (function () {
            /*
             * this function will measure and print time-elapsed
             * for window.onload
             */
                if (window.domOnEventWindowOnloadTimeElapsed) {
                    return;
                }
                window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;
                window.addEventListener("load", function () {
                    setTimeout(function () {
                        window.domOnEventWindowOnloadTimeElapsed = (
                            Date.now()
                            - window.domOnEventWindowOnloadTimeElapsed
                        );
                        console.error(
                            "domOnEventWindowOnloadTimeElapsed = "
                            + window.domOnEventWindowOnloadTimeElapsed
                        );
                    }, 100);
                });
            }());
            // init event-handling - load
            window.addEventListener("load", function () {
                setTimeout(opt.onNext, 5000);
            });
            // wait for render before screenshot
            setTimeout(opt.onNext, opt.timeoutScreenshot);
            if (opt.modeBrowserTest !== "test") {
                return;
            }
            // init utility2_testReportSave
            window.utility2_testReportSave = function () {
                window.utility2_testReportSave = local.nop;
                window.utility2_testReport.coverage = window.__coverage__;
                opt.electron.ipcRenderer.send(
                    opt.fileElectronHtml,
                    "testReport",
                    window.utility2_testReport
                );
            };
            return;
        // node.electron.browserWindow.webview.preload - screenshot
        case 22:
            // cleanup fileElectronHtml
            opt.fs.rename(
                opt.fileElectronHtml,
                opt.npm_config_dir_tmp + "/electron.html",
                console.error
            );
            opt.electron.ipcRenderer.send(
                opt.fileElectronHtml,
                "html",
                window.document.documentElement.outerHTML
            );
            if (opt.modeBrowserTest === "test" && !window.utility2_modeTest) {
                window.utility2_testReportSave();
            }
            return;
        default:
            if (isDone) {
                return;
            }
            isDone = true;
            // cleanup timerTimeout
            clearTimeout(timerTimeout);
            onError(err);
        }
    });
    // init opt
    [
        "CI_BRANCH",
        "CI_HOST",
        "DISPLAY",
        "MODE_BUILD",
        "PATH",
        "fileCoverage",
        "fileElectronHtml",
        "fileScreenshot",
        "fileTestReport",
        "modeBrowserTest",
        "modeCoverageMerge",
        "modeDebug",
        "modeNext",
        "modeSilent",
        "npm_config_dir_build",
        "npm_config_dir_tmp",
        "npm_config_time_exit",
        "npm_config_timeout_default",
        "timeExit",
        "timeoutDefault",
        "timeoutScreenshot",
        "url"
    ].forEach(function (key) {
        if (
            local.env
            && local.env[key] !== undefined
            && typeof opt[key] !== "number"
        ) {
            opt[key] = opt[key] || local.env[key];
        }
    });
    opt.modeNext = Number(opt.modeNext) || 0;
    opt.timeoutDefault = (
        Number(opt.timeoutDefault) || Number(local.timeoutDefault)
    );
    if (10 <= opt.modeNext) {
        opt.electron = opt.electron || require("electron");
    }
    opt.fs = opt.fs || require("fs");
    opt.onNext();
};

local.bufferConcat = function (bffList) {
/*
 * this function will emulate node's Buffer.concat for Uint8Array in browser
 */
    var byteLength;
    var ii;
    var isString;
    var jj;
    var result;
    isString = true;
    result = [
        ""
    ];
    byteLength = 0;
    bffList.forEach(function (bff) {
        if (bff !== 0 && !(bff && bff.length)) {
            return;
        }
        // optimization - concat string
        if (isString && typeof bff === "string") {
            result[0] += bff;
            return;
        }
        isString = null;
        bff = local.bufferValidateAndCoerce(bff);
        byteLength += bff.byteLength;
        result.push(bff);
    });
    // optimization - return string
    if (isString) {
        return result[0];
    }
    result[0] = local.bufferValidateAndCoerce(result[0]);
    byteLength += result[0].byteLength;
    bffList = result;
    result = local.bufferValidateAndCoerce(new Uint8Array(byteLength));
    ii = 0;
    bffList.forEach(function (bff) {
        jj = 0;
        while (jj < bff.byteLength) {
            result[ii] = bff[jj];
            ii += 1;
            jj += 1;
        }
    });
    return result;
};

local.bufferIndexOfSubBuffer = function (bff, subBff, fromIndex) {
/*
 * this function will search <bff> for <fromIndex> position of <subBff>
 */
    var ii;
    var jj;
    var kk;
    if (!subBff.length) {
        return 0;
    }
    ii = fromIndex || 0;
    while (ii < bff.length) {
        kk = ii;
        jj = 0;
        while (jj < subBff.length) {
            if (subBff[jj] !== bff[kk]) {
                break;
            }
            kk += 1;
            jj += 1;
        }
        if (jj === subBff.length) {
            return kk - jj;
        }
        ii += 1;
    }
    return -1;
};

local.bufferRandomBytes = function (length) {
/*
 * this function will return a Buffer with given <length>,
 * filled with cryptographically-strong random-values
 */
    return (
        // ternary-operator
        (
            typeof window === "object"
            && window.crypto
            && typeof window.crypto.getRandomValues === "function"
        )
        ? window.crypto.getRandomValues(new Uint8Array(length))
        : require("crypto").randomBytes(length)
    );
};

local.bufferToUtf8 = function (bff) {
/*
 * this function will convert Uint8Array <bff> -> utf8
 */
    return local.bufferValidateAndCoerce(bff, "string");
};

local.bufferValidateAndCoerce = function (bff, mode) {
/*
 * this function will validate and coerce/convert <bff> -> Buffer
 * (or String if <mode> = "string")
 */
    // validate not 0
    if (bff !== 0) {
        bff = bff || "";
    }
    if (typeof bff === "string" && mode === "string") {
        return bff;
    }
    // convert utf8 -> Uint8Array
    if (typeof bff === "string") {
        bff = (
            local.isBrowser
            ? new TextEncoder().encode(bff)
            : Buffer.from(bff)
        );
    // validate instanceof Uint8Array
    } else if (Object.prototype.toString.call(bff) !== "[object Uint8Array]") {
        throw new Error(
            "bufferValidateAndCoerce - value is not instanceof "
            + "ArrayBuffer, String, or Uint8Array"
        );
    }
    // convert Uint8Array -> utf8
    if (mode === "string") {
        return new TextDecoder().decode(bff);
    }
    // coerce Uint8Array -> Buffer
    if (!local.isBrowser && !Buffer.isBuffer(bff)) {
        Object.setPrototypeOf(bff, Buffer.prototype);
    }
    return bff;
};

local.buildApidoc = function (opt, onError) {
/*
 * this function will build apidoc with given <opt>
 */
    var result;
    // optimization - do not run if $npm_config_mode_coverage = all
    if (local.env.npm_config_mode_coverage === "all") {
        onError();
        return;
    }
    opt = local.objectSetDefault(opt, {
        blacklistDict: local,
        require: local.requireInSandbox
    });
    // save apidoc.html
    result = (
        local.fsReadFileOrEmptyStringSync("apidoc.html", "utf8")
        || local.apidocCreate(opt)
    );
    local.fsWriteFileWithMkdirpSync("tmp/build/apidoc.html", result);
    console.error(
        "created apidoc file " + process.cwd() + "/apidoc.html\n"
    );
    onError();
};

local.buildApp = function (opt, onError) {
/*
 * this function will build app with given <opt>
 */
    opt = local.objectSetDefault(opt, {
        assetsList: []
    });
    // build assets
    local.fsRmrSync("tmp/build/app");
    local.onParallelList({
        list: [
            {
                file: "/LICENSE",
                url: "/LICENSE"
            }, {
                file: "/assets." + local.env.npm_package_nameLib + ".html",
                url: "/index.html"
            }, {
                file: "/assets." + local.env.npm_package_nameLib + ".js",
                url: "/assets." + local.env.npm_package_nameLib + ".js"
            }, {
                file: "/assets.app.js",
                url: "/assets.app.js"
            }, {
                file: "/assets.example.html",
                url: "/assets.example.html"
            }, {
                file: "/assets.example.js",
                url: "/assets.example.js"
            }, {
                file: "/assets.swgg.html",
                url: "/assets.swgg.html"
            }, {
                file: "/assets.swgg.swagger.json",
                url: "/assets.swgg.swagger.json"
            }, {
                file: "/assets.swgg.swagger.petstore.json",
                url: "/assets.swgg.swagger.petstore.json"
            }, {
                file: "/assets.swgg.swagger.server.json",
                url: "/assets.swgg.swagger.server.json"
            }, {
                file: "/assets.test.js",
                url: "/assets.test.js"
            }, {
                file: "/assets.utility2.html",
                url: "/assets.utility2.html"
            }, {
                file: "/assets.utility2.base.html",
                url: "/assets.utility2.base.html"
            }, {
                file: "/assets.utility2.rollup.js",
                url: "/assets.utility2.rollup.js"
            }, {
                file: "/index.html",
                url: "/index.html"
            }, {
                file: "/index.rollup.html",
                url: "/index.rollup.html"
            }, {
                file: "/jsonp.utility2.stateInit",
                url: (
                    "/jsonp.utility2.stateInit"
                    + "?callback=window.utility2.stateInit"
                )
            }
        ].concat(opt.assetsList)
    }, function (option2, onParallel) {
        option2 = option2.elem;
        onParallel.counter += 1;
        local.ajax(option2, function (err, xhr) {
            // validate no err occurred
            local.assertThrow(!err, err);
            // jslint file
            local.jslintAndPrint(xhr.responseText, option2.file, {
                conditional: true,
                coverage: local.env.npm_config_mode_coverage
            });
            // validate no err occurred
            local.assertThrow(
                !local.jslint.jslintResult.errText,
                local.jslint.jslintResult.errText
            );
            local.fsWriteFileWithMkdirpSync(
                "tmp/build/app" + option2.file,
                xhr.response
            );
            onParallel();
        });
    }, function (err) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // test standalone assets.app.js
        local.fsWriteFileWithMkdirpSync(
            "tmp/buildApp/assets.app.js",
            local.assetsDict["/assets.app.js"]
        );
        local.childProcessSpawnWithTimeout("node", [
            "assets.app.js"
        ], {
            cwd: "tmp/buildApp",
            env: {
                PATH: local.env.PATH,
                PORT: (Math.random() * 0x10000) | 0x8000,
                npm_config_timeout_exit: 5000
            },
            stdio: [
                "ignore", "ignore", 2
            ]
        })
        .on("error", onError)
        .on("exit", function (exitCode) {
            // validate exitCode
            local.assertThrow(!exitCode, exitCode);
            onError();
        });
    });
};

local.buildLib = function (opt, onError) {
/*
 * this function will build lib with given <opt>
 */
    var result;
    local.objectSetDefault(opt, {
        customize: local.nop,
        dataFrom: local.fsReadFileOrEmptyStringSync(
            "lib." + local.env.npm_package_nameLib + ".js",
            "utf8"
        ),
        dataTo: local.templateRenderMyApp(
            local.assetsDict["/assets.my_app.template.js"],
            opt
        )
    });
    // search-and-replace - customize dataTo
    [
        // customize top-level comment-description
        (
            /\n\u0020\*\n(?:[\S\s]*?\n)?\u0020\*\/\n/
        ),
        // customize body after /* validateLineSortedReset */
        (
            /\n\/\*\u0020validateLineSortedReset\u0020\*\/\n[\S\s]*?$/
        )
    ].forEach(function (rgx) {
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
    });
    // customize local for assets.utility2.rollup.js
    if (
        local.fs.existsSync("./assets.utility2.rollup.js")
        && local.env.npm_package_nameLib !== "swgg"
    ) {
        opt.dataTo = opt.dataTo.replace(
            "    // || globalThis.utility2_rollup_old",
            "    || globalThis.utility2_rollup_old"
        ).replace(
            "    // || require(\"./assets.utility2.rollup.js\")",
            "    || require(\"./assets.utility2.rollup.js\")"
        );
    }
    // save lib
    result = opt.dataTo;
    local.fsWriteFileWithMkdirpSync(
        "lib." + local.env.npm_package_nameLib + ".js",
        result,
        local.env.npm_config_mode_coverage && local.identity("noWrite")
    );
    opt.customize(opt);
    onError();
    return result;
};

local.buildReadme = function (opt, onError) {
/*
 * this function will build readme with given <opt> my-app-lite template
 */
    var result;
    local.objectSetDefault(opt, {
        customize: local.nop,
        // reset toc
        dataFrom: local.fsReadFileOrEmptyStringSync(
            "README.md",
            "utf8"
        ).replace((
            /\n#\u0020table\u0020of\u0020contents$[\S\s]*?\n\n\n\n/m
        ), "\n# table of contents\n\n\n\n"),
        packageJsonRgx: (
            /\n#\u0020package.json\n```json\n([\S\s]*?)\n```\n/
        )
    });
    // render dataTo
    opt.dataTo = local.templateRenderMyApp(
        local.assetsDict["/assets.readme.template.md"],
        opt
    );
    // init package.json
    opt.dataFrom.replace(opt.packageJsonRgx, function (match0, match1) {
        // remove null-items from package.json
        opt.packageJson = JSON.parse(match1.replace((
            /\u0020{4}".*?":\u0020null,?$/gm
        ), ""));
        opt.packageJson.description = opt.dataFrom.split("\n")[1];
        local.tryCatchOnError(function () {
            local.objectSetDefault(opt.packageJson, {
                nameLib: local.fsReadFileOrEmptyStringSync(
                    "./package.json",
                    "json"
                ).nameLib
            });
        }, local.nop);
        opt.packageJson = local.objectSetDefault(opt.packageJson, {
            nameLib: opt.packageJson.name.replace((
                /\W/g
            ), "_"),
            nameOriginal: opt.packageJson.name
        });
        opt.packageJson = local.objectSetDefault(
            opt.packageJson,
            JSON.parse(local.templateRenderMyApp(opt.packageJsonRgx.exec(
                local.assetsDict["/assets.readme.template.md"]
            )[1], opt)),
            2
        );
        // avoid npm-installing that
        delete opt.packageJson.devDependencies[opt.packageJson.name];
        // reset scripts
        opt.packageJson.scripts = {
            "build-ci": "sh ./npm_scripts.sh",
            env: "env",
            eval: "sh ./npm_scripts.sh",
            "heroku-postbuild": "sh ./npm_scripts.sh",
            postinstall: "sh ./npm_scripts.sh",
            start: "sh ./npm_scripts.sh",
            test: "sh ./npm_scripts.sh",
            utility2: "sh ./npm_scripts.sh"
        };
        // save package.json
        local.fsWriteFileWithMkdirpSync(
            "package.json",
            local.jsonStringifyOrdered(opt.packageJson, null, 4) + "\n"
        );
        // re-render dataTo
        opt.dataTo = local.templateRenderMyApp(
            local.assetsDict["/assets.readme.template.md"],
            opt
        );
        opt.dataTo = opt.dataTo.replace(
            opt.packageJsonRgx,
            match0.replace(
                match1,
                local.jsonStringifyOrdered(opt.packageJson, null, 4)
            )
        );
    });
    // search-and-replace - customize dataTo
    [
        // customize name and description
        (
            /.*?\n.*?\n/
        ),
        // customize cdn-download
        (
            /\n#\u0020cdn\u0020download\n[\S\s]*?\n\n\n\n/
        ),
        // customize live-web-demo
        (
            /\n#\u0020live\u0020web\u0020demo\n[\S\s]*?\n\n\n\n/
        ),
        // customize to-do
        (
            /\n####\u0020todo\n[\S\s]*?\n\n\n\n/
        ),
        // customize example.js - shared js-env code - init-before
        (
            /\nglobalThis\.local\u0020=\u0020local;\n[^`]*?\n\/\/\u0020run\u0020browser\u0020js\-env\u0020code\u0020-\u0020init-test\n/
        ),
        // customize example.js - html-body
        (
            /\nutility2-comment\u0020-->(?:\\n\\\n){4}[^`]*?^<!--\u0020utility2-comment\\n\\\n/m
        ),
        // customize example.js - testRunBrowser
        (
            /\n\u0020{4}\/\/\u0020custom-case\n[^`]*?\n\u0020{4}\/\/\u0020run\u0020browser-tests\n/
        ),
        // customize build_ci - shBuildCiAfter
        (
            /\nshBuildCiAfter\u0020\(\)\u0020\{\(set\u0020-e\n[\S\s]*?\n\)\}\n/
        ),
        // customize build_ci - shBuildCiBefore
        (
            /\nshBuildCiBefore\u0020\(\)\u0020\{\(set\u0020-e\n[\S\s]*?\n\)\}\n/
        )
    ].forEach(function (rgx) {
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
    });
    // customize private-repository
    if (local.env.npm_package_private) {
        opt.dataTo = (
            opt.dataTo.replace((
                /\n\[!\[NPM\]\(https:\/\/nodei.co\/npm\/.*?\n/
            ), "\n").replace(
                "$ npm install ",
                (
                    "$ git clone "
                    + local.env.npm_package_repository_url
                    .replace("git+https://github.com/", "git@github.com:")
                    + " --single-branch -b beta node_modules/"
                )
            )
        );
    }
    // customize version
    [
        "dataFrom", "dataTo"
    ].forEach(function (elem) {
        opt[elem] = opt[elem].replace((
            /\n(####\u0020changelog\u0020|-\u0020npm\u0020publish\u0020)\d+?\.\d+?\.\d+?.*?\n/g
        ), "\n$1" + opt.packageJson.version + "\n");
    });
    // customize swaggerdoc
    if (
        !local.assetsDict["/assets.swgg.swagger.json"]
        || (
            /\bswggUiContainer\b/
        ).test(local.assetsDict["/index.html"])
        || local.env.npm_package_name === "utility2"
    ) {
        opt.dataTo = opt.dataTo.replace((
            /\n####\u0020swagger\u0020doc\n[\S\s]*?\n####\u0020/
        ), "\n#### ");
    }
    // customize example.js
    if (
        local.assetsDict["/index.html"].indexOf(
            "<script src=\"assets.example.js\"></script>"
        ) < 0
    ) {
        opt.dataTo = opt.dataTo.replace((
            /\nif\u0020\(!local.isBrowser\)\u0020\{\n[\S\s]*?\n\}\(\)\);\n/g
        ), "\nif (!local.isBrowser) {\n    return;\n}\n}());\n");
    }
    // customize comment
    opt.dataFrom.replace((
        /^(\u0020*?)(?:#\!\!\u0020|#\/\/\u0020|\/\/\!\!\u0020|<!--\u0020)(.*?)(?:\u0020-->)?$/gm
    ), function (match0, match1, match2) {
        opt.dataTo = opt.dataTo.replace(
            "\n" + match1 + match2 + "\n",
            "\n" + match0 + "\n"
        );
    });
    // customize - user-defined
    opt.customize(opt);
    // customize assets.index.template.html
    if (local.assetsDict["/assets.index.template.html"].indexOf(
        "\"assets.utility2.template.html\""
    ) < 0) {
        opt.dataTo = opt.dataTo.replace((
            /\n\/\*\u0020jslint\u0020ignore:start\u0020\*\/\nlocal.assetsDict\["\/assets.index.template.html"\]\u0020=\u0020'\\\n[\S\s]*?\n\/\*\u0020jslint\u0020ignore:end\u0020\*\/\n/
        ), "\n");
    }
    // customize shDeployCustom
    if (opt.dataFrom.indexOf("    shDeployCustom\n") >= 0) {
        [
            // customize example.sh
            (
                /\n####\u0020changelog\u0020[\S\s]*\n#\u0020quickstart\u0020example.js\n/
            ), (
                opt.dataFrom.indexOf("\"assets.utility2.template.html\"") < 0
                && local.identity(
                    /\n#\u0020quickstart\u0020[\S\s]*?\n#\u0020extra\u0020screenshots\n/
                )
            )
        ].forEach(function (rgx) {
            opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
        });
        // customize screenshot
        opt.dataTo = opt.dataTo.replace((
            /^1\.\u0020.*?screenshot\.(?:npmTest|testExampleJs|testExampleSh).*?\.png[\S\s]*?\n\n/gm
        ), "");
    }
    // customize shNpmTestPublished
    opt.dataTo = opt.dataTo.replace(
        "$ npm install " + local.env.GITHUB_REPO + "#alpha",
        "$ npm install " + local.env.npm_package_name
    );
    if (opt.dataFrom.indexOf("    shNpmTestPublished\n") < 0) {
        opt.dataTo = opt.dataTo.replace(
            "$ npm install " + local.env.npm_package_name,
            "$ npm install " + local.env.GITHUB_REPO + "#alpha"
        );
        [
            (
                /\n.*?\bhttps:\/\/www.npmjs.com\/package\/.*?\n/
            ), (
                /\n.*?npmPackageDependencyTree.*?\n/
            )
        ].forEach(function (rgx) {
            opt.dataTo = opt.dataTo.replace(rgx, "");
        });
    }
    // customize shBuildCiAfter and shBuildCiBefore
    [
        [
            "shDeployGithub", (
                /.*?\/screenshot\.deployGithub.*?\n/g
            )
        ], [
            "shDeployHeroku", (
                /.*?\/screenshot\.deployHeroku.*?\n/g
            )
        ], [
            "shReadmeTest example.js", (
                /.*?\/screenshot\.testExampleJs.*?\n/g
            )
        ], [
            "shReadmeTest example.sh", (
                /.*?\/screenshot\.testExampleSh.*?\n/g
            )
        ]
    ].forEach(function (elem) {
        if (opt.dataFrom.indexOf("    " + elem[0] + "\n") >= 0) {
            return;
        }
        // customize test-server
        opt.dataTo = opt.dataTo.replace(
            new RegExp(
                "\\n\\| test-server-"
                + elem[0].replace("shDeploy", "").toLowerCase()
                + " : \\|.*?\\n"
            ),
            "\n"
        );
        // customize screenshot
        opt.dataTo = opt.dataTo.replace(elem[1], "");
    });
    opt.dataTo = local.templateRenderMyApp(opt.dataTo, opt);
    // customize toc
    opt.toc = "\n# table of contents\n";
    opt.dataTo.replace((
        /\n\n\n\n#\u0020(.*)/g
    ), function (ignore, match1) {
        if (match1 === "table of contents") {
            return;
        }
        opt.toc += "1. [" + match1 + "](#" + match1.toLowerCase().replace((
            /[^\u0020\-0-9A-Z_a-z]/g
        ), "").replace((
            /\u0020/g
        ), "-") + ")\n";
    });
    opt.dataTo = opt.dataTo.replace("\n# table of contents\n", opt.toc);
    // customize whitespace
    opt.dataTo = opt.dataTo.replace((
        /\n{5,}/g
    ), "\n\n\n\n");
    // save README.md
    result = opt.dataTo;
    local.fs.writeFileSync("README.md", result);
    // customize assets.swgg.swagger.json
    opt.swaggerJson = local.swgg.normalizeSwaggerJson(
        local.fsReadFileOrEmptyStringSync("assets.swgg.swagger.json", "json")
    );
    local.objectSetOverride(opt.swaggerJson, {
        info: {
            title: opt.packageJson.name,
            version: opt.packageJson.version,
            "x-swgg-description": opt.packageJson.description,
            "x-swgg-homepage": opt.packageJson.homepage
        }
    }, 2);
    opt.dataTo.replace((
        /\bhttps:\/\/.*?\/assets\.app\.js/
    ), function (match0) {
        opt.swaggerJson["x-swgg-downloadStandaloneApp"] = (
            !local.env.npm_package_private && match0
        );
    });
    local.fsWriteFileWithMkdirpSync(
        "assets.swgg.swagger.json",
        local.jsonStringifyOrdered(opt.swaggerJson, null, 4) + "\n",
        !opt.swaggerJson.swagger && local.identity("noWrite")
    );
    onError();
    return result;
};

local.buildTest = function (opt, onError) {
/*
 * this function will build test with given <opt>
 */
    var result;
    local.objectSetDefault(opt, {
        customize: local.nop,
        dataFrom: local.fsReadFileOrEmptyStringSync("test.js", "utf8"),
        dataTo: local.templateRenderMyApp(
            local.assetsDict["/assets.test.template.js"],
            opt
        )
    });
    // search-and-replace - customize dataTo
    [
        // customize shared js\-env code - function
        (
            /\n\}\(\)\);\n\n\n\n\/\/\u0020run\u0020shared\u0020js\-env\u0020code\u0020-\u0020function\n[\S\s]*?$/
        )
    ].forEach(function (rgx) {
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
    });
    // customize require("utility2")
    [
        "./assets.utility2.rollup.js",
        "./lib.utility2.js"
    ].forEach(function (file) {
        if (local.fs.existsSync(file)) {
            opt.dataTo = opt.dataTo.replace(
                "require(\"utility2\")",
                "require(\"" + file + "\")"
            );
        }
    });
    opt.customize(opt);
    // save test.js
    result = opt.dataTo;
    local.fs.writeFileSync("test.js", result);
    onError();
    return result;
};

local.childProcessSpawnWithTimeout = function (command, args, opt) {
/*
 * this function will run like child_process.spawn,
 * but with auto-timeout after timeout milliseconds
 * example usage:
    var child = local.childProcessSpawnWithTimeout(
        "/bin/sh",
        ["-c", "echo hello world"],
        {stdio: ["ignore", 1, 2], timeout: 5000}
    );
    child.on("error", console.error);
    child.on("exit", function (exitCode) {
        console.error("exitCode " + exitCode);
    });
 */
    var child;
    var child_process;
    var timerTimeout;
    child_process = require("child_process");
    // spawn child
    child = child_process.spawn(command, args, opt).on("exit", function () {
        // cleanup timerTimeout
        try {
            process.kill(timerTimeout.pid);
        } catch (ignore) {}
    });
    // init timerTimeout
    timerTimeout = child_process.spawn(
        // convert timeout to integer seconds with 2 second delay
        "sleep "
        + Math.floor(
            0.001 * (Number(opt && opt.timeout) || local.timeoutDefault)
            + 2
        )
        + "; kill -9 " + child.pid + " 2>/dev/null",
        {
            shell: true,
            stdio: "ignore"
        }
    );
    return child;
};

local.childProcessSpawnWithUtility2 = function (script, onError) {
/*
 * this function will run child_process.spawn, with lib.utility2.sh sourced
 */
    require("child_process").spawn(
        ". " + (process.env.npm_config_dir_utility2 || __dirname)
        + "/lib.utility2.sh; " + script,
        {
            shell: true,
            stdio: [
                "ignore", 1, 2
            ]
        }
    ).on("exit", function (exitCode) {
        onError(exitCode && Object.assign(new Error(), {
            exitCode
        }));
    });
};

local.cliRun = function (opt) {
/*
 * this function will run the cli with given <opt>
 */
    local.cliDict._eval = local.cliDict._eval || function () {
    /*
     * <code>
     * will eval <code>
     */
        globalThis.local = local;
        local.vm.runInThisContext(process.argv[3]);
    };
    local.cliDict["--eval"] = local.cliDict["--eval"] || local.cliDict._eval;
    local.cliDict["-e"] = local.cliDict["-e"] || local.cliDict._eval;
    local.cliDict._help = local.cliDict._help || function () {
    /*
     *
     * will print help
     */
        var commandList;
        var file;
        var packageJson;
        var text;
        var textDict;
        commandList = [
            {
                argList: "<arg2>  ...",
                description: "usage:",
                command: [
                    "<arg1>"
                ]
            }, {
                argList: "'console.log(\"hello world\")'",
                description: "example:",
                command: [
                    "--eval"
                ]
            }
        ];
        file = __filename.replace((
            /.*\//
        ), "");
        opt = Object.assign({}, opt);
        packageJson = require("./package.json");
        // validate comment
        opt.rgxComment = opt.rgxComment || (
            /\)\u0020\{\n(?:|\u0020{4})\/\*\n(?:\u0020|\u0020{5})\*((?:\u0020<[^>]*?>|\u0020\.\.\.)*?)\n(?:\u0020|\u0020{5})\*\u0020(will\u0020.*?\S)\n(?:\u0020|\u0020{5})\*\/\n(?:\u0020{4}|\u0020{8})\S/
        );
        textDict = {};
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {
            if (key[0] === "_" && key !== "_default") {
                return;
            }
            text = String(local.cliDict[key]);
            if (key === "_default") {
                key = "";
            }
            textDict[text] = textDict[text] || (ii + 2);
            ii = textDict[text];
            if (commandList[ii]) {
                commandList[ii].command.push(key);
                return;
            }
            try {
                commandList[ii] = opt.rgxComment.exec(text);
                commandList[ii] = {
                    argList: (commandList[ii][1] || "").trim(),
                    command: [
                        key
                    ],
                    description: commandList[ii][2]
                };
            } catch (ignore) {
                local.assertThrow(null, new Error(
                    "cliRun - cannot parse comment in COMMAND "
                    + key
                    + ":\nnew RegExp("
                    + JSON.stringify(opt.rgxComment.source)
                    + ").exec(" + JSON.stringify(text).replace((
                        /\\\\/g
                    ), "\u0000").replace((
                        /\\n/g
                    ), "\\n\\\n").replace((
                        /\u0000/g
                    ), "\\\\") + ");"
                ));
            }
        });
        text = "";
        text += packageJson.name + " (" + packageJson.version + ")\n\n";
        text += commandList.filter(function (elem) {
            return elem;
        }).map(function (elem, ii) {
            elem.command = elem.command.filter(function (elem) {
                return elem;
            });
            switch (ii) {
            case 0:
            case 1:
                elem.argList = [
                    elem.argList
                ];
                break;
            default:
                elem.argList = elem.argList.split(" ");
                elem.description = (
                    "# COMMAND "
                    + (elem.command[0] || "<none>") + "\n# "
                    + elem.description
                );
            }
            return (
                elem.description + "\n  " + file
                + ("  " + elem.command.sort().join("|") + "  ")
                    .replace((
                    /^\u0020{4}$/
                ), "  ")
                + elem.argList.join("  ")
            );
        })
        .join("\n\n");
        console.log(text);
    };
    local.cliDict["--help"] = local.cliDict["--help"] || local.cliDict._help;
    local.cliDict["-h"] = local.cliDict["-h"] || local.cliDict._help;
    local.cliDict._default = local.cliDict._default || local.cliDict._help;
    local.cliDict.help = local.cliDict.help || local.cliDict._help;
    local.cliDict._interactive = local.cliDict._interactive || function () {
    /*
     *
     * will start interactive-mode
     */
        globalThis.local = local;
        local.identity(local.replStart || require("repl").start)({
            useGlobal: true
        });
    };
    local.cliDict["--interactive"] = (
        local.cliDict["--interactive"]
        || local.cliDict._interactive
    );
    local.cliDict["-i"] = local.cliDict["-i"] || local.cliDict._interactive;
    local.cliDict._version = local.cliDict._version || function () {
    /*
     *
     * will print version
     */
        console.log(require(__dirname + "/package.json").version);
    };
    local.cliDict["--version"] = (
        local.cliDict["--version"]
        || local.cliDict._version
    );
    local.cliDict["-v"] = local.cliDict["-v"] || local.cliDict._version;
    // default to --help command if no arguments are given
    if (process.argv.length <= 2) {
        local.cliDict._help();
        return;
    }
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        return;
    }
    local.cliDict._default();
};

local.corsBackendHostInject = function (url, backendHost, rgx, location) {
/*
 * this function will if <location>.host is a github site,
 * inject <backendHost> into <url> with given <rgx>
 */
    location = (
        location
        || (typeof window === "object" && window && window.location)
    );
    if (!(backendHost && location && (
        /\bgithub.io$/
    ).test(location.host))) {
        return url;
    }
    // init github-branch
    location.pathname.replace((
        /\/build\.\.(alpha|beta|master)\.\.travis-ci\.org\//
    ), function (ignore, match1) {
        backendHost = backendHost.replace("-alpha.", "-" + match1 + ".");
    });
    return url.replace(rgx || (
        /.*?($)/m
    ), backendHost + "$1");
};

local.corsForwardProxyHostIfNeeded = function (xhr) {
/*
 * this function will return xhr.corsForwardProxyHost, if needed
 */
    return (
        local.isBrowser
        && local.env.npm_package_nameLib
        && (
            /^https?:\/\//
        ).test(xhr.url)
        && xhr.url.indexOf(xhr.location.protocol + "//" + xhr.location.host)
        !== 0
        && (
            /\.github\.io$/
        ).test(xhr.location.host)
        && xhr.corsForwardProxyHost !== "disabled"
        && (xhr.corsForwardProxyHost || "https://h1-proxy1.herokuapp.com")
    );
};

/* istanbul ignore next */
local.cryptoAesXxxCbcRawDecrypt = function (opt, onError) {
/*
 * this function will aes-xxx-cbc decrypt with given <opt>
 * example usage:
    data = new Uint8Array([1,2,3]);
    key = '0123456789abcdef0123456789abcdef';
    mode = null;
    local.cryptoAesXxxCbcRawEncrypt({
        data: data,
        key: key,
        mode: mode
    }, function (err, data) {
        console.assert(!err, err);
        local.cryptoAesXxxCbcRawDecrypt({
            data: data,
            key: key,
            mode: mode
        }, console.log);
    });
 */
    var cipher;
    var crypto;
    var data;
    var ii;
    var iv;
    var key;
    // init key
    key = new Uint8Array(0.5 * opt.key.length);
    ii = 0;
    while (ii < key.byteLength) {
        key[ii] = parseInt(opt.key.slice(2 * ii, 2 * ii + 2), 16);
        ii += 2;
    }
    data = opt.data;
    // base64
    if (opt.mode === "base64") {
        data = local.base64ToBuffer(data);
    }
    // normalize data
    if (Object.prototype.toString.call(data) !== "[object Uint8Array]") {
        data = new Uint8Array(data);
    }
    // init iv
    iv = data.subarray(0, 16);
    // optimization - create resized-view of data
    data = data.subarray(16);
    crypto = globalThis.crypto;
    if (!local.isBrowser) {
        setTimeout(function () {
            crypto = require("crypto");
            cipher = crypto.createDecipheriv(
                "aes-" + (8 * key.byteLength) + "-cbc",
                key,
                iv
            );
            onError(null, Buffer.concat([
                cipher.update(data), cipher.final()
            ]));
        });
        return;
    }
    crypto.subtle.importKey("raw", key, {
        name: "AES-CBC"
    }, false, [
        "decrypt"
    ]).then(function (key) {
        crypto.subtle.decrypt({
            iv,
            name: "AES-CBC"
        }, key, data).then(function (data) {
            onError(null, new Uint8Array(data));
        }).catch(onError);
    }).catch(onError);
};

/* istanbul ignore next */
local.cryptoAesXxxCbcRawEncrypt = function (opt, onError) {
/*
 * this function will aes-xxx-cbc encrypt with given <opt>
 * example usage:
    data = new Uint8Array([1,2,3]);
    key = '0123456789abcdef0123456789abcdef';
    mode = null;
    local.cryptoAesXxxCbcRawEncrypt({
        data: data,
        key: key,
        mode: mode
    }, function (err, data) {
        console.assert(!err, err);
        local.cryptoAesXxxCbcRawDecrypt({
            data: data,
            key: key,
            mode: mode
        }, console.log);
    });
 */
    var cipher;
    var crypto;
    var data;
    var ii;
    var iv;
    var key;
    // init key
    key = new Uint8Array(0.5 * opt.key.length);
    ii = 0;
    while (ii < key.byteLength) {
        key[ii] = parseInt(opt.key.slice(2 * ii, 2 * ii + 2), 16);
        ii += 2;
    }
    data = opt.data;
    // init iv
    iv = new Uint8Array((((data.byteLength) >> 4) << 4) + 32);
    crypto = globalThis.crypto;
    if (!local.isBrowser) {
        setTimeout(function () {
            crypto = require("crypto");
            // init iv
            iv.set(crypto.randomBytes(16));
            cipher = crypto.createCipheriv(
                "aes-" + (8 * key.byteLength) + "-cbc",
                key,
                iv.subarray(0, 16)
            );
            data = cipher.update(data);
            iv.set(data, 16);
            iv.set(cipher.final(), 16 + data.byteLength);
            if (opt.mode === "base64") {
                iv = local.base64FromBuffer(iv);
                iv += "\n";
            }
            onError(null, iv);
        });
        return;
    }
    // init iv
    iv.set(crypto.getRandomValues(new Uint8Array(16)));
    crypto.subtle.importKey("raw", key, {
        name: "AES-CBC"
    }, false, [
        "encrypt"
    ]).then(function (key) {
        crypto.subtle.encrypt({
            iv: iv.subarray(0, 16),
            name: "AES-CBC"
        }, key, data).then(function (data) {
            iv.set(new Uint8Array(data), 16);
            // base64
            if (opt.mode === "base64") {
                iv = local.base64FromBuffer(iv);
                iv += "\n";
            }
            onError(null, iv);
        }).catch(onError);
    }).catch(onError);
};

local.dateGetWeekOfMonth = function (date) {
/*
 * this function will return sunday-based week-of-month from <date>
 */
    date = new Date(date.slice(0, 10) + "T00:00:00Z");
    return Math.ceil((date.getUTCDate() + new Date(
        date.getUTCFullYear(),
        date.getUTCMonth(),
        1
    ).getUTCDay()) / 7) - 1;
};

local.dateGetWeekOfYear = function (date) {
/*
 * this function will return ISO week-of-year from <date>
 *
 * Based on information at:
 *
 *    http://www.merlyn.demon.co.uk/weekcalc.htm#WNR
 *
 * Algorithm is to find nearest thursday, it's year
 * is the year of the week number. Then get weeks
 * between that date and the first day of that year.
 *
 * Note that dates in one year can be weeks of previous
 * or next year, overlap is up to 3 days.
 *
 * e.g. 2014/12/29 is Monday in week  1 of 2015
 *      2012/1/1   is Sunday in week 52 of 2011
 *
 * https://stackoverflow.com/questions/6117814/get-week-of-year-in-javascript-like-in-php
 */
    date = new Date(date.slice(0, 10) + "T00:00:00Z");
    // Set to nearest Thursday: current date + 4 - current day number
    // Make Sunday's day number 7
    date.setUTCDate(date.getUTCDate() + 4 - (date.getUTCDay() || 7));
    // Calculate full weeks to nearest Thursday
    return Math.ceil((((
        date
        // Get first day of year
        - new Date(Date.UTC(date.getUTCFullYear(), 0, 1))
    ) / 86400000) + 1) / 7);
};

local.dateUtcFromLocal = function (date, timezoneOffset) {
/*
 * this function will convert local-<date> to utc-date
 */
    if (!date) {
        return "";
    }
    local.assertThrow((
        /^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+?)?$/
    ).test(date), "invalid local-date " + date);
    if (!timezoneOffset) {
        return new Date(date).toISOString();
    }
    return new Date(
        new Date(date + "Z").getTime() + timezoneOffset * 60000
    ).toISOString();
};

local.dateUtcToLocal = function (date, timezoneOffset) {
/*
 * this function will convert utc-<date> to local-date
 */
    if (!date) {
        return "";
    }
    local.assertThrow((
        /^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+?)?Z$/
    ).test(date), "invalid utc-date " + date);
    timezoneOffset = timezoneOffset || new Date(date).getTimezoneOffset();
    return new Date(
        new Date(date).getTime() - timezoneOffset * 60000
    ).toISOString();
};

local.domFragmentRender = function (template, dict) {
/*
 * this function will return dom-elem rendered from <template>
 */
    var tmp;
    tmp = document.createElement("template");
    tmp.innerHTML = local.templateRender(template, dict);
    return tmp.content;
};

local.domQuerySelectorAllTagName = function (selector) {
/*
 * this function will return all tagName that match <selector>
 */
    var set;
    set = new Set();
    Array.from(document.querySelectorAll(
        selector
    )).forEach(function (elem) {
        set.add(elem.tagName);
    });
    return Array.from(set).sort();
};

local.domSelectOptionValue = function (elem) {
/*
 * this function will return <elem>.options[<elem>.selectedIndex].value
 */
    elem = elem && elem.options[elem.selectedIndex];
    return (elem && elem.value) || "";
};

local.domStyleValidate = function () {
/*
 * this function will validate <style> tags
 */
    var rgx;
    var tmp;
    rgx = (
        /^0\u0020(?:(body\u0020>\u0020)?(?:form\u0020>\u0020)?(?:\.testReportDiv\u0020.+|\.x-istanbul\u0020.+|\.button|\.colorError|\.readonly|\.textarea|\.uiAnimateShake|\.uiAnimateSlide|a|body|code|div|input|pre|textarea)(?:,|\u0020\{))|^[1-9]\d*?\u0020#/m
    );
    tmp = [];
    Array.from(
        // ternary-operator
        (
            typeof document === "object"
            && document
            && typeof document.querySelector === "function"
        )
        ? document.querySelectorAll(
            "style"
        )
        : []
    ).map(function (elem, ii) {
        elem.innerHTML.replace((
            /\/\*[\S\s]*?\*\/|;|\}/g
        ), "\n").replace((
            /^([^\n\u0020@].*?)[,{:].*?$/gm
        ), function (match0, match1) {
            try {
                ii = document.querySelectorAll(
                    match1
                ).length;
            } catch (errCaught) {
                console.error(errCaught);
            }
            if (!(ii > 1)) {
                tmp.push(ii + " " + match0);
            }
        });
    });
    tmp.filter(function (elem) {
        return !rgx.test(elem);
    }).sort().reverse().forEach(function (elem, ii, list) {
        console.error(
            "domStyleValidateUnmatched " + (list.length - ii) + ". " + elem
        );
    });
};

local.errorMessagePrepend = function (err, message) {
/*
 * this function will prepend message to <err>.message and <err>.stack
 */
    if (err === local.errDefault) {
        return;
    }
    err.message = message + err.message;
    err.stack = message + err.stack;
    return err;
};

local.exit = function (exitCode, testReport) {
/*
 * this function will exit current process with given <exitCode>
 */
    local.onErrorDefault(typeof exitCode !== "number" && exitCode);
    exitCode = (
        (!exitCode || Number(exitCode) === 0)
        ? 0
        : Number(exitCode) || 1
    );
    if (!local.isBrowser) {
        process.exit(exitCode);
        return;
    }
    if (testReport !== globalThis.utility2_testReport) {
        return;
    }
    // update coverage
    (document.querySelector(
        "#coverageReportDiv1"
    ) || {}).innerHTML = (
        local.istanbulCoverageReportCreate()
    );
    // save testReport
    globalThis.utility2_testReportSave();
};

local.fsReadFileOrEmptyStringSync = function (file, opt) {
/*
 * this function will try to read file or return empty-string, or
 * if <opt> === "json", then try to JSON.parse file or return null
 */
    try {
        return (
            opt === "json"
            ? JSON.parse(local.fs.readFileSync(file, "utf8"))
            : local.fs.readFileSync(file, opt)
        );
    } catch (ignore) {
        return (
            opt === "json"
            ? {}
            : ""
        );
    }
};

local.fsRmrSync = function (dir) {
/*
 * this function will synchronously "rm -fr" dir
 */
    local.child_process.execFileSync(
        "rm",
        [
            "-fr", local.path.resolve(process.cwd(), dir)
        ],
        {
            stdio: [
                "ignore", 1, 2
            ]
        }
    );
};

local.fsWriteFileWithMkdirpSync = function (file, data, mode) {
/*
 * this function will synchronously "mkdir -p" and write <data> to <file>
 */
    try {
        if (
            mode === "noWrite"
            || typeof require("fs").writeFileSync !== "function"
        ) {
            return;
        }
    } catch (ignore) {
        return;
    }
    // try to write to file
    try {
        require("fs").writeFileSync(file, data);
    } catch (ignore) {
        // mkdir -p
        require("child_process").spawnSync(
            "mkdir",
            [
                "-p", require("path").dirname(file)
            ],
            {
                stdio: [
                    "ignore", 1, 2
                ]
            }
        );
        // re-write to file
        require("fs").writeFileSync(file, data);
    }
};

local.isNullOrUndefined = function (arg0) {
/*
 * this function will test if arg0 is null or undefined
 */
    return arg0 === null || arg0 === undefined;
};

local.jslintAutofixLocalFunction = function (code, file) {
/*
 * this function will jslint-autofix local-function
 */
    var code2;
    var dictFnc;
    var dictProp;
    var tmp;
    if (local.isBrowser) {
        return code;
    }
    file = file.replace(process.cwd() + "/", "");
    switch (file) {
    case "README.md":
    case "lib." + process.env.npm_package_nameLib + ".js":
    case "lib." + process.env.npm_package_nameLib + ".sh":
    case "lib.apidoc.js":
    case "lib.db.js":
    case "lib.github_crud.js":
    case "lib.istanbul.js":
    case "lib.jslint.js":
    case "lib.marked.js":
    case "lib.sjcl.js":
    case "lib.swgg.js":
    case "npm_scripts.sh":
    case "test.js":
        break;
    default:
        return code;
    }
    // autofix - assets.example.begin.js
    code = code.replace((
        /^\(function\u0020\(globalThis\)\u0020\{\n[\S\s]*?\n\}\(this\)\);\n/m
    ), local.assetsDict["/assets.example.begin.js"]);
    // autofix - assets.my_app.template.js
    code = local.stringMerge(
        code,
        local.assetsDict["/assets.my_app.template.js"].replace((
            /my_app/g
        ), file.split(".")[1]),
        file !== "README.md" && local.identity(
            /\n\/\*\u0020istanbul\u0020instrument\u0020in\u0020package\u0020[\S\s]*?\n\/\*\u0020validateLineSortedReset\u0020\*\/\n/
        )
    );
    // customize local for assets.utility2.rollup.js
    if (
        file === "lib." + process.env.npm_package_nameLib + ".js"
        && local.fs.existsSync("./assets.utility2.rollup.js")
        && local.env.npm_package_nameLib !== "swgg"
    ) {
        code = code.replace(
            "    // || globalThis.utility2_rollup_old",
            "    || globalThis.utility2_rollup_old"
        ).replace(
            "    // || require(\"./assets.utility2.rollup.js\")",
            "    || require(\"./assets.utility2.rollup.js\")"
        );
    }
    // init functionAllDict and functionBaseDict
    [
        [
            "utility2", "swgg"
        ], [
            "utility2", "apidoc", "db", "github_crud", "swgg"
        ]
    ].forEach(function (dictList, ii) {
        tmp = (
            ii
            ? "functionAllDict"
            : "functionBaseDict"
        );
        if (local[tmp]) {
            return;
        }
        local[tmp] = {};
        dictList.forEach(function (dict) {
            dict = local[dict];
            Object.keys(dict).forEach(function (key) {
                if (
                    !(
                        /^[A-Z_]|^testCase_/m
                    ).test(key)
                    && typeof dict[key] === "function"
                ) {
                    local[tmp][key] = local[tmp][key] || String(dict[key]);
                }
            });
        });
        Object.keys(local[tmp]).forEach(function (key) {
            if (process.binding("natives")[key]) {
                local[tmp][key] = undefined;
            }
        });
    });
    // autofix - local-function
    dictFnc = {};
    dictProp = {};
    code = code.replace((
        /^local\.(.*?)\u0020=\u0020(function\u0020\([\S\s]*?\n\});\n+/gm
    ), function (match0, key, match2, match3) {
        // local-function - duplicate
        if (dictFnc[key]) {
            return "";
        }
        // local-function - normalize
        dictFnc[key] = true;
        match3 = local.functionAllDict[key] || "";
        // make shell-safe
        // https://unix.stackexchange.com/questions/57794/shell-escape-characters-for-sh-c
        if (file.slice(-3) === ".sh") {
            match3 = match3.replace((
                /'/g
            ), "'\"'\"'");
        }
        if (match3 && match3 !== match2) {
            match0 = match0.replace(match2, match3.replace((
                /\$\$|\$/g
            ), "$$$$"));
        }
        return match0.trimRight() + "\n\n";
    });
    // comment
    code2 = code;
    code2 = code2.replace((
        /^\u0020*?\/\*[\S\s]*?\*\/|^\u0020*?(?:\/\/.*?|.*?\\)$/gm
    ), "");
    // local-function - update dictFnc and dictProp
    code2.replace((
        /\blocal\.(\w+?\b)(?:\u0020(===|=|\|\|)(?:\u0020"function"\u0020&&\u0020local\.\w|\u0020|$))?/gm
    ), function (ignore, match1, match2) {
        switch (match2) {
        case "=":
            dictFnc[match1] = true;
            break;
        case "===":
        case "||":
            dictProp[match1] = false;
            break;
        default:
            dictProp[match1] = true;
        }
    });
    [
        dictFnc, dictProp
    ].forEach(function (dict) {
        Object.keys(dict).forEach(function (key) {
            dict[key] = dict[key] && local.functionBaseDict[key];
        });
    });
    dictFnc = local.jsonCopy(dictFnc);
    dictProp = local.jsonCopy(dictProp);
    [
        "assertThrow",
        "functionOrNop",
        "identity",
        "nop",
        "objectAssignDefault"
    ].forEach(function (key) {
        dictFnc[key] = true;
        dictProp[key] = true;
    });
    // local-function - missing
    switch (local.fs.existsSync("assets.utility2.rollup.js") || file) {
    case "README.md":
    case "lib.swgg.js":
    case "lib.utility2.js":
    case "test.js":
    case true:
        break;
    default:
        Object.keys(dictProp).forEach(function (key) {
            if (dictProp[key] && !dictFnc[key]) {
                console.error(
                    "local-function - missing (" + file + ") local." + key
                );
            }
        });
    }
    // local-function - unused
    switch (file) {
    case "lib.swgg.js":
    case "lib.utility2.js":
    case "lib.utility2.sh":
        break;
    default:
        Object.keys(dictFnc).forEach(function (key) {
            if (!dictProp.hasOwnProperty(key)) {
                console.error(
                    "local-function - unused (" + file + ") local." + key
                );
            }
        });
    }
    return code;
};

local.jsonCopy = function (obj) {
/*
 * this function will deep-copy obj
 */
    return (
        obj === undefined
        ? undefined
        : JSON.parse(JSON.stringify(obj))
    );
};

local.jsonStringifyOrdered = function (obj, replacer, space) {
/*
 * this function will JSON.stringify <obj>,
 * with object-keys sorted and circular-references removed
 * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Syntax
 */
    var circularSet;
    var stringify;
    var tmp;
    stringify = function (obj) {
    /*
     * this function will recursively JSON.stringify obj,
     * with object-keys sorted and circular-references removed
     */
        // if obj is not an object or function, then JSON.stringify as normal
        if (!(
            obj
            && typeof obj === "object"
            && typeof obj.toJSON !== "function"
        )) {
            return JSON.stringify(obj);
        }
        // ignore circular-reference
        if (circularSet.has(obj)) {
            return;
        }
        circularSet.add(obj);
        // if obj is an array, then recurse its items
        if (Array.isArray(obj)) {
            tmp = "[" + obj.map(function (obj) {
                // recurse
                tmp = stringify(obj);
                return (
                    typeof tmp === "string"
                    ? tmp
                    : "null"
                );
            }).join(",") + "]";
            circularSet.delete(obj);
            return tmp;
        }
        // if obj is not an array,
        // then recurse its items with object-keys sorted
        tmp = "{" + Object.keys(obj).sort().map(function (key) {
            // recurse
            tmp = stringify(obj[key]);
            if (typeof tmp === "string") {
                return JSON.stringify(key) + ":" + tmp;
            }
        }).filter(function (obj) {
            return typeof obj === "string";
        }).join(",") + "}";
        circularSet.delete(obj);
        return tmp;
    };
    circularSet = new Set();
    return JSON.stringify((
        (typeof obj === "object" && obj)
        // recurse
        ? JSON.parse(stringify(obj))
        : obj
    ), replacer, space);
};

local.jwtAes256GcmDecrypt = function (token, key) {
/*
 * this function will use json-web-encryption to
 * aes-256-gcm-decrypt <token> with given base64url-encoded <key>
 * https://tools.ietf.org/html/rfc7516
 */
    return local.tryCatchOnError(function () {
        token = token
        .replace((
            /-/g
        ), "+")
        .replace((
            /_/g
        ), "/")
        .split(".");
        token = local.sjcl.decrypt(
            local.sjcl.codec.base64url.toBits(local.jwtAes256KeyInit(key)),
            JSON.stringify({
                adata: token[4],
                ct: token[3],
                iv: token[2],
                ks: 256,
                mode: "gcm"
            })
        );
        return local.jwtHs256Decode(token, key);
    }, local.nop) || {};
};

local.jwtAes256GcmEncrypt = function (data, key) {
/*
 * this function will use json-web-encryption to
 * aes-256-gcm-encrypt <data> with given base64url-encoded <key>
 * https://tools.ietf.org/html/rfc7516
 */
    var adata;
    adata = local.jwtAes256KeyCreate();
    data = local.jwtHs256Encode(data, key);
    data = JSON.parse(local.sjcl.encrypt(
        local.sjcl.codec.base64url.toBits(local.jwtAes256KeyInit(key)),
        data,
        {
            adata: local.sjcl.codec.base64url.toBits(adata),
            ks: 256,
            mode: "gcm"
        }
    ));
    return local.normalizeJwtBase64Url(
        "eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4R0NNIn0.."
        + data.iv + "." + data.ct + "." + adata
    );
};

local.jwtAes256KeyCreate = function () {
/*
 * this function will create a random, aes-256-base64url-jwt-key
 */
    return local.normalizeJwtBase64Url(
        local.base64FromBuffer(local.bufferRandomBytes(32))
    );
};

local.jwtAes256KeyInit = function (key) {
/*
 * this function will init aes-256-base64url-jwt-<key>
 * https://jwt.io/
 */
    // init npm_config_jwtAes256Key
    local.env.npm_config_jwtAes256Key = (
        local.env.npm_config_jwtAes256Key
        || "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
    );
    return key || local.env.npm_config_jwtAes256Key;
};

local.jwtHs256Decode = function (token, key) {
/*
 * this function will decode json-web-token with given base64-encoded <key>
 * https://jwt.io/
 */
    var Hmac;
    var timeNow;
    Hmac = local.sjcl.misc.hmac;
    timeNow = Date.now() / 1000;
    // try to decode token
    return local.tryCatchOnError(function () {
        token = token.split(".");
        // validate header
        local.assertThrow(
            token[0] === "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
            token
        );
        // validate signature
        local.assertThrow(local.sjcl.codec.base64url.fromBits(
            new Hmac(local.sjcl.codec.base64url.toBits(
                local.jwtAes256KeyInit(key)
            )).encrypt(token[0] + "." + token[1])
        ) === token[2]);
        // return decoded data
        token = JSON.parse(local.base64ToUtf8(token[1]));
        // https://tools.ietf.org/html/rfc7519#section-4.1
        // validate jwt-registered-headers
        local.assertThrow(!token.exp || token.exp >= timeNow);
        local.assertThrow(!token.nbf || token.nbf <= timeNow);
        return token;
    }, local.nop) || {};
};

local.jwtHs256Encode = function (data, key) {
/*
 * this function will encode <data> into a json-web-token
 * with given base64-encoded <key>
 * https://jwt.io/
 */
    var Hmac;
    Hmac = local.sjcl.misc.hmac;
    data = (
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9."
        + local.normalizeJwtBase64Url(
            local.base64FromBuffer(JSON.stringify(data))
        )
    );
    return data + "." + local.sjcl.codec.base64url.fromBits(
        new Hmac(local.sjcl.codec.base64url.toBits(
            local.jwtAes256KeyInit(key)
        )).encrypt(data)
    );
};

local.listGetElementRandom = function (list) {
/*
 * this function will return random elem from <list>
 */
    return list[Math.floor(Math.random() * list.length)];
};

local.listShuffle = function (list) {
/*
 * this function will inplace shuffle <list> using fisher-yates algorithm
 * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle
 */
    var ii;
    var random;
    var swap;
    ii = list.length;
    while (ii > 1) {
        ii -= 1;
        random = Math.floor(Math.random() * (ii + 1));
        swap = list[ii];
        list[ii] = list[random];
        list[random] = swap;
    }
    return list;
};

local.localStorageSetItemOrClear = function (key, value) {
/*
 * this function will try to set <key>/<value> pair to localStorage,
 * or else call localStorage.clear()
 */
    try {
        localStorage.setItem(key, value);
    } catch (ignore) {
        localStorage.clear();
    }
};

local.middlewareAssetsCached = function (req, res, next) {
/*
 * this function will run middleware that will serve cached-assets
 */
    var opt;
    opt = {};
    local.onNext(opt, function (err, data) {
        opt.result = opt.result || local.assetsDict[req.urlParsed.pathname];
        if (opt.result === undefined) {
            next(err);
            return;
        }
        switch (opt.modeNext) {
        case 1:
            // skip gzip
            if (
                res.headersSent
                || !(
                    /\bgzip\b/
                ).test(req.headers["accept-encoding"])
            ) {
                opt.modeNext += 1;
                opt.onNext();
                return;
            }
            // gzip and cache result
            local.taskCreateCached({
                cacheDict: "middlewareAssetsCachedGzip",
                key: req.urlParsed.pathname
            }, function (onError) {
                local.zlib.gzip(opt.result, function (err, data) {
                    onError(err, !err && data.toString("base64"));
                });
            }, opt.onNext);
            break;
        case 2:
            // set gzip header
            opt.result = local.base64ToBuffer(data);
            res.setHeader("Content-Encoding", "gzip");
            res.setHeader("Content-Length", opt.result.length);
            opt.onNext();
            break;
        case 3:
            local.middlewareCacheControlLastModified(
                req,
                res,
                opt.onNext
            );
            break;
        case 4:
            res.end(opt.result);
            break;
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.middlewareBodyRead = function (req, ignore, next) {
/*
 * this function will run middleware that will
 * read and save the <req>-body to <req>.bodyRaw
 */
    // if req is already read, then goto next
    if (!req.readable) {
        next();
        return;
    }
    local.streamReadAll(req, function (err, data) {
        req.bodyRaw = req.bodyRaw || data;
        next(err);
    });
};

local.middlewareCacheControlLastModified = function (req, res, next) {
/*
 * this function will run middleware that will update res-header last-modified
 */
    // do not cache if headers already sent or url has '?' search indicator
    if (res.headersSent || req.url.indexOf("?") >= 0) {
        next();
        return;
    }
    // init serverResponseHeaderLastModified
    local.serverResponseHeaderLastModified = (
        local.serverResponseHeaderLastModified
        // resolve to 1000 ms
        || new Date(new Date().toUTCString())
    );
    // respond with 304 If-Modified-Since serverResponseHeaderLastModified
    if (
        new Date(req.headers["if-modified-since"])
        >= local.serverResponseHeaderLastModified
    ) {
        res.statusCode = 304;
        res.end();
        return;
    }
    res.setHeader("Cache-Control", "no-cache");
    res.setHeader(
        "Last-Modified",
        local.serverResponseHeaderLastModified.toUTCString()
    );
    next();
};

local.middlewareError = function (err, req, res) {
/*
 * this function will run middleware that will handle errors
 */
    // default - 404 Not Found
    if (!err) {
        local.serverRespondDefault(req, res, 404);
        return;
    }
    // http://jsonapi.org/format/#errors
    if (local.swgg && typeof local.swgg.serverRespondJsonapi === "function") {
        local.swgg.serverRespondJsonapi(req, res, err);
    }
    // statusCode [400, 600)
    local.serverRespondDefault(req, res, (
        (err.statusCode >= 400 && err.statusCode < 600)
        ? err.statusCode
        : 500
    ), err);
};

local.middlewareFileServer = function (req, res, next) {
/*
 * this function will run middleware that will serve files
 */
    if (req.method !== "GET" || local.isBrowser) {
        next();
        return;
    }
    req.urlFile = (process.cwd() + req.urlParsed.pathname
    // security - disable parent directory lookup
    .replace((
        /.*\/\.\.\//g
    ), "/"))
        // replace trailing '/' with '/index.html'
        .replace((
        /\/$/
    ), "/index.html");
    // serve file from cache
    local.taskCreateCached({
        cacheDict: "middlewareFileServer",
        key: req.urlFile
    // run background-task to re-cache file
    }, function (onError) {
        local.fs.readFile(req.urlFile, function (err, data) {
            onError(err, data && local.base64FromBuffer(data));
        });
    }, function (err, data) {
        // default to next
        if (err) {
            next();
            return;
        }
        // init res-header content-type
        local.serverRespondHeadSet(req, res, null, {
            "Content-Type": local.contentTypeDict[(
                /\.[^.]*?$|$/m
            ).exec(req.urlParsed.pathname)[0]]
        });
        // serve file from cache
        res.end(local.base64ToBuffer(data));
    });
};

local.middlewareForwardProxy = function (req, res, next) {
/*
 * this function will run middleware that will forward-proxy <req>
 * to its destination-host
 */
    var isDone;
    var onError;
    var opt;
    var timerTimeout;
    // handle preflight-cors
    if (req.method === "OPTIONS" && (
        /forward-proxy-url/
    )
    .test(req.headers["access-control-request-headers"])) {
        local.serverRespondCors(req, res);
        res.end();
        return;
    }
    if (!req.headers["forward-proxy-url"]) {
        next();
        return;
    }
    local.serverRespondCors(req, res);
    // init onError
    onError = function (err) {
        if (isDone) {
            return;
        }
        isDone = true;
        // cleanup timerTimeout
        clearTimeout(timerTimeout);
        // debug middlewareForwardProxy
        console.error("serverLog - " + JSON.stringify({
            time: new Date(opt.timeStart).toISOString(),
            type: "middlewareForwardProxyResponse",
            method: opt.method,
            url: opt.url,
            statusCode: res.statusCode | 0,
            timeElapsed: Date.now() - opt.timeStart,
            // extra
            headers: opt.headers
        }));
        if (!err) {
            return;
        }
        // cleanup clientReq and clientRes
        local.streamCleanup(opt.clientReq);
        local.streamCleanup(opt.clientResponse);
        next(err);
    };
    // init opt
    opt = local.urlParse(req.headers["forward-proxy-url"]);
    opt.method = req.method;
    opt.url = req.headers["forward-proxy-url"];
    // init timerTimeout
    timerTimeout = local.onTimeout(
        onError,
        local.timeoutDefault,
        "forward-proxy " + opt.method + " " + opt.url
    );
    // parse headers
    opt.headers = {};
    local.tryCatchOnError(function () {
        opt.headers = JSON.parse(req.headers["forward-proxy-headers"]);
    }, local.nop);
    // debug opt
    local._debugForwardProxy = opt;
    opt.clientReq = (
        opt.protocol === "https:"
        ? local.https
        : local.http
    ).request(opt, function (clientResponse) {
        opt.clientResponse = clientResponse.on("error", onError);
        res.statusCode = opt.clientResponse.statusCode;
        // pipe clientResponse to serverResponse
        opt.clientResponse.pipe(res);
    }).on("error", onError);
    opt.timeStart = Date.now();
    // init event-handling
    req.on("error", onError);
    res.on("finish", onError).on("error", onError);
    // pipe serverReq to clientReq
    req.pipe(opt.clientReq);
};

local.middlewareInit = function (req, res, next) {
/*
 * this function will run middleware that will init <req> and <res>
 */
    // debug req and res
    local._debugServerReqRes4 = local._debugServerReqRes3;
    local._debugServerReqRes3 = local._debugServerReqRes2;
    local._debugServerReqRes2 = local._debugServerReqRes1;
    local._debugServerReqRes1 = {
        req,
        res
    };
    // init timerTimeout
    local.serverRespondTimeoutDefault(req, res, local.timeoutDefault);
    // init req.urlParsed
    req.urlParsed = local.urlParse(req.url);
    // init res-header content-type
    local.serverRespondHeadSet(req, res, null, {
        "Content-Type": local.contentTypeDict[(
            /\.[^.]*?$|$/m
        ).exec(req.urlParsed.pathname)[0]]
    });
    // set main-page content-type to text/html
    if (req.urlParsed.pathname === "/") {
        local.serverRespondHeadSet(req, res, null, {
            "Content-Type": "text/html; charset=utf-8"
        });
    }
    // default to next
    next();
};

local.middlewareJsonpStateInit = function (req, res, next) {
/*
 * this function will run middleware that will
 * serve the browser-state wrapped in given jsonp-callback
 */
    var state;
    if (!(req.stateInit || (
        req.urlParsed
        && req.urlParsed.pathname === "/jsonp.utility2.stateInit"
    ))) {
        next();
        return;
    }
    state = {
        utility2: {
            assetsDict: {
                "/assets.example.html":
                local.assetsDict["/assets.example.html"],
                "/assets.example.js": local.assetsDict["/assets.example.js"],
                "/assets.swgg.swagger.json":
                local.assetsDict["/assets.swgg.swagger.json"],
                "/assets.test.js": local.assetsDict["/assets.test.js"],
                "/assets.utility2.base.html":
                local.assetsDict["/assets.utility2.base.rollup.html"],
                "/index.rollup.html": local.assetsDict["/index.rollup.html"]
            },
            env: {
                NODE_ENV: local.env.NODE_ENV,
                npm_config_mode_backend: local.env.npm_config_mode_backend,
                npm_package_assetsList: local.env.npm_package_assetsList,
                npm_package_description: local.env.npm_package_description,
                npm_package_homepage: local.env.npm_package_homepage,
                npm_package_name: local.env.npm_package_name,
                npm_package_nameLib: local.env.npm_package_nameLib,
                npm_package_version: local.env.npm_package_version
            }
        }
    };
    (local.env.npm_package_assetsList || "").split(" ").forEach(function (
        file
    ) {
        local.assetsDict["/" + file] = (
            local.assetsDict["/" + file]
            || local.fsReadFileOrEmptyStringSync(file, "utf8")
        );
        state.utility2.assetsDict["/" + file] = local.assetsDict["/" + file];
    });
    if (req.stateInit) {
        return state;
    }
    res.end(
        req.urlParsed.query.callback + "(" + JSON.stringify(state) + ");"
    );
};

local.moduleDirname = function (module, modulePathList) {
/*
 * this function will search modulePathList for the module's __dirname
 */
    var result;
    // search process.cwd()
    if (!module || module === "." || module.indexOf("/") >= 0) {
        return require("path").resolve(process.cwd(), module || "");
    }
    // search modulePathList
    [
        "node_modules"
    ]
    .concat(modulePathList)
    .concat(require("module").globalPaths)
    .concat([
        process.env.HOME + "/node_modules", "/usr/local/lib/node_modules"
    ])
    .some(function (modulePath) {
        try {
            result = require("path").resolve(
                process.cwd(),
                modulePath + "/" + module
            );
            result = require("fs").statSync(result).isDirectory() && result;
            return result;
        } catch (ignore) {
            result = null;
        }
        return result;
    });
    return result || "";
};

local.normalizeChunk = function (chunk) {
/*
 * this function will normalize the chunk
 */
    return chunk || "";
};

local.normalizeJwt = function (data) {
/*
 * this function will normalize the jwt-data with registered-headers
 * https://tools.ietf.org/html/rfc7519#section-4.1
 */
    var timeNow;
    timeNow = Date.now() / 1000;
    return local.objectSetDefault(data, {
        exp: timeNow + 5 * 60,
        iat: timeNow,
        jti: Math.random().toString(16).slice(2),
        nbf: timeNow
    });
};

local.normalizeJwtBase64Url = function (b64) {
/*
 * this function will normlize <b64> to base64url format
 */
    return b64
    .replace((
        /\=/g
    ), "")
    .replace((
        /\+/g
    ), "-")
    .replace((
        /\//g
    ), "_");
};

local.numberToRomanNumerals = function (num) {
/*
 * this function will convert num to a roman-numeral
 * https://stackoverflow.com/questions/9083037/convert-a-number-into-a-roman-numeral-in-javascript
 */
    var digits;
    var ii;
    var key;
    var roman;
    digits = String(num).split("");
    key = [
        "", "C", "CC", "CCC", "CD", "D", "DC", "DCC", "DCCC", "CM",
        "", "X", "XX", "XXX", "XL", "L", "LX", "LXX", "LXXX", "XC",
        "", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX"
    ];
    roman = "";
    ii = 3;
    while (ii) {
        ii -= 1;
        roman = (key[Number(digits.pop()) + (ii * 10)] || "") + roman;
    }
    return new Array(Number(digits.join("") + 1)).join("M") + roman;
};

local.objectSetDefault = function (dict, defaults, depth) {
/*
 * this function will recursively set defaults for undefined-items in dict
 */
    dict = dict || {};
    defaults = defaults || {};
    Object.keys(defaults).forEach(function (key) {
        var defaults2;
        var dict2;
        dict2 = dict[key];
        // handle misbehaving getter
        try {
            defaults2 = defaults[key];
        } catch (ignore) {}
        if (defaults2 === undefined) {
            return;
        }
        // init dict[key] to default value defaults[key]
        switch (dict2) {
        case "":
        case null:
        case undefined:
            dict[key] = defaults2;
            return;
        }
        // if dict2 and defaults2 are both non-null and non-array objects,
        // then recurse with dict2 and defaults2
        if (
            depth > 1
            // dict2 is a non-null and non-array object
            && typeof dict2 === "object" && dict2 && !Array.isArray(dict2)
            // defaults2 is a non-null and non-array object
            && typeof defaults2 === "object" && defaults2
            && !Array.isArray(defaults2)
        ) {
            // recurse
            local.objectSetDefault(dict2, defaults2, depth - 1);
        }
    });
    return dict;
};

local.objectSetOverride = function (dict, overrides, depth, env) {
/*
 * this function will recursively set overrides for items in dict
 */
    dict = dict || {};
    env = env || (typeof process === "object" && process.env) || {};
    overrides = overrides || {};
    Object.keys(overrides).forEach(function (key) {
        var dict2;
        var overrides2;
        dict2 = dict[key];
        overrides2 = overrides[key];
        if (overrides2 === undefined) {
            return;
        }
        // if both dict2 and overrides2 are non-null and non-array objects,
        // then recurse with dict2 and overrides2
        if (
            depth > 1
            // dict2 is a non-null and non-array object
            && typeof dict2 === "object" && dict2 && !Array.isArray(dict2)
            // overrides2 is a non-null and non-array object
            && typeof overrides2 === "object" && overrides2
            && !Array.isArray(overrides2)
        ) {
            local.objectSetOverride(dict2, overrides2, depth - 1, env);
            return;
        }
        // else set dict[key] with overrides[key]
        dict[key] = (
            dict === env
            // if dict is env, then overrides falsy-value with empty-string
            ? overrides2 || ""
            : overrides2
        );
    });
    return dict;
};

local.onErrorDefault = function (err) {
/*
 * this function will if <err> exists, then print it to stderr
 */
    if (err) {
        console.error(err);
    }
    return err;
};

local.onErrorThrow = function (err) {
/*
 * this function will if <err> exists, then throw it
 */
    if (err) {
        throw err;
    }
    return err;
};

local.onErrorWithStack = function (onError) {
/*
 * this function will create wrapper around <onError>
 * that will append current-stack to err.stack
 */
    var onError2;
    var stack;
    stack = new Error().stack.replace((
        /(.*?)\n.*?$/m
    ), "$1");
    onError2 = function (err, data, meta) {
        if (
            err
            && typeof err.stack === "string"
            && err !== local.errDefault
            && String(err.stack).indexOf(stack.split("\n")[2]) < 0
        ) {
            // append current-stack to err.stack
            err.stack += "\n" + stack;
        }
        onError(err, data, meta);
    };
    // debug onError
    onError2.toString = function () {
        return String(onError);
    };
    return onError2;
};

local.onFileModifiedRestart = function (file) {
/*
 * this function will watch the file, and if modified, then restart the process
 */
    if (
        local.env.npm_config_mode_auto_restart
        && local.fs.existsSync(file)
        && local.fs.statSync(file).isFile()
    ) {
        local.fs.watchFile(file, {
            interval: 1000,
            persistent: false
        }, function (stat2, stat1) {
            if (stat2.mtime > stat1.mtime) {
                console.error("file modified - " + file);
                setTimeout(function () {
                    local.exit(77);
                }, 1000);
            }
        });
    }
};

local.onNext = function (opt, onError) {
/*
 * this function will wrap onError inside recursive-function <opt>.onNext,
 * and append the current-stack to any err
 */
    opt.onNext = local.onErrorWithStack(function (err, data, meta) {
        try {
            opt.modeNext += (
                (err && !opt.modeErrorIgnore)
                ? 1000
                : 1
            );
            if (opt.modeDebug) {
                console.error("onNext - " + JSON.stringify({
                    modeNext: opt.modeNext,
                    errorMessage: err && err.message
                }));
                if (err && err.stack) {
                    console.error(err.stack);
                }
            }
            onError(err, data, meta);
        } catch (errCaught) {
            // throw errCaught to break infinite recursion-loop
            if (opt.errCaught) {
                local.assertThrow(null, opt.errCaught);
            }
            opt.errCaught = errCaught;
            opt.onNext(errCaught, data, meta);
        }
    });
    return opt;
};

local.onParallel = function (onError, onEach, onRetry) {
/*
 * this function will create a function that will
 * 1. run async tasks in parallel
 * 2. if counter === 0 or err occurred, then call onError(err)
 */
    var onParallel;
    onError = local.onErrorWithStack(onError);
    onEach = onEach || local.nop;
    onRetry = onRetry || local.nop;
    onParallel = function (err, data) {
        if (onRetry(err, data)) {
            return;
        }
        // decrement counter
        onParallel.counter -= 1;
        // validate counter
        if (!(onParallel.counter >= 0 || err || onParallel.err)) {
            err = new Error(
                "invalid onParallel.counter = " + onParallel.counter
            );
        // ensure onError is run only once
        } else if (onParallel.counter < 0) {
            return;
        }
        // handle err
        if (err) {
            onParallel.err = err;
            // ensure counter <= 0
            onParallel.counter = -Math.abs(onParallel.counter);
        }
        // call onError when isDone
        if (onParallel.counter <= 0) {
            onError(err, data);
            return;
        }
        onEach();
    };
    // init counter
    onParallel.counter = 0;
    // return callback
    return onParallel;
};

local.onParallelList = function (opt, onEach, onError) {
/*
 * this function will
 * 1. async-run onEach in parallel,
 *    with given <opt>.rateLimit and <opt>.retryLimit
 * 2. call <onError> when onParallel.ii + 1 === <opt>.list.length
 */
    var isListEnd;
    var onEach2;
    var onParallel;
    opt.list = opt.list || [];
    onEach2 = function () {
        while (true) {
            if (!(onParallel.ii + 1 < opt.list.length)) {
                isListEnd = true;
                return;
            }
            if (!(onParallel.counter < opt.rateLimit + 1)) {
                return;
            }
            onParallel.ii += 1;
            onEach({
                elem: opt.list[onParallel.ii],
                ii: onParallel.ii,
                list: opt.list,
                retry: 0
            }, onParallel);
        }
    };
    onParallel = local.onParallel(onError, onEach2, function (err, data) {
        if (err && data && data.retry < opt.retryLimit) {
            local.onErrorDefault(err);
            data.retry += 1;
            setTimeout(function () {
                onParallel.counter -= 1;
                onEach(data, onParallel);
            }, 1000);
            return true;
        }
        // restart if opt.list has grown
        if (isListEnd && (onParallel.ii + 1 < opt.list.length)) {
            isListEnd = null;
            onEach2();
        }
    });
    onParallel.ii = -1;
    opt.rateLimit = Number(opt.rateLimit) || 6;
    opt.rateLimit = Math.max(opt.rateLimit, 1);
    opt.retryLimit = Number(opt.retryLimit) || 2;
    onParallel.counter += 1;
    onEach2();
    onParallel();
};

local.onTimeout = function (onError, timeout, message) {
/*
 * this function will create a timeout-err-handler,
 * that appends current-stack to any err encountered
 */
    onError = local.onErrorWithStack(onError);
    // create timerTimeout
    return setTimeout(function () {
        onError(new Error(
            "onTimeout - errTimeout - " + timeout + " ms - " + message
        ));
    // coerce to finite integer
    }, timeout);
};

local.profile = function (fnc, onError) {
/*
 * this function will profile async <fnc> in milliseconds
 * with callback <onError>
 */
    var timeStart;
    timeStart = Date.now();
    // run async fnc
    fnc(function (err) {
        // call onError with difference in milliseconds
        // between Date.now() and timeStart
        onError(err, Date.now() - timeStart);
    });
};

local.profileSync = function (fnc) {
/*
 * this function will profile sync <fnc> in milliseconds
 */
    var timeStart;
    timeStart = Date.now();
    // run sync fnc
    fnc();
    // return difference in milliseconds between Date.now() and timeStart
    return Date.now() - timeStart;
};

local.replStart = function () {
/*
 * this function will start the repl-debugger
 */
    var that;
    if (globalThis.utility2_repl1) {
        return;
    }
    // start repl
    that = require("repl").start({
        useGlobal: true
    });
    globalThis.utility2_repl1 = that;
    that.onError = function (err) {
    /*
     * this function will debug repl-err
     */
        globalThis.utility2_debugReplError = err;
        console.error(err);
    };
    // save eval-function
    that.evalDefault = that.eval;
    // hook custom-eval-function
    that.eval = function (script, context, file, onError) {
        var onError2;
        onError2 = function (err, data) {
            // debug err
            globalThis.utility2_debugReplError = (
                err || globalThis.utility2_debugReplError
            );
            onError(err, data);
        };
        script.replace((
            /^(\S+)\u0020(.*?)\n/
        ), function (ignore, match1, match2) {
            switch (match1) {
            // syntax-sugar - run async shell-command
            case "$":
                switch (match2) {
                // syntax-sugar - run git diff
                case "git diff":
                    match2 = "git diff --color | cat";
                    break;
                // syntax-sugar - run git log
                case "git log":
                    match2 = "git log -n 4 | cat";
                    break;
                // syntax-sugar - run git log
                case "ll":
                    match2 = "ls -Fal";
                    break;
                }
                // source lib.utility2.sh
                if (
                    process.platform !== "win32"
                    && process.env.npm_config_dir_utility2 && (match2 !== ":")
                ) {
                    match2 = (
                        ". " + process.env.npm_config_dir_utility2
                        + "/lib.utility2.sh;" + match2
                    );
                }
                // run async shell-command
                require("child_process").spawn(match2, {
                    shell: true,
                    stdio: [
                        "ignore", 1, 2
                    ]
                // on shell exit, print return prompt
                }).on("exit", function (exitCode) {
                    console.error("exit-code " + exitCode);
                    that.evalDefault(
                        "\n",
                        context,
                        file,
                        onError2
                    );
                });
                script = "\n";
                break;
            // syntax-sugar - map text with charCodeAt
            case "charCode":
                console.error(
                    match2.split("").map(function (chr) {
                        return (
                            "\\u"
                            + chr.charCodeAt(0).toString(16).padStart(4, 0)
                        );
                    }).join("")
                );
                script = "\n";
                break;
            // syntax-sugar - sort chr
            case "charSort":
                console.error(JSON.stringify(match2.split("").sort().join("")));
                script = "\n";
                break;
            // syntax-sugar - grep current dir
            case "grep":
                // run async shell-command
                require("child_process").spawn((
                    "find . -type f | grep -v -E "
/* jslint ignore:start */
+ '"\
/\\.|(\\b|_)(\\.\\d|\
archive|artifact|\
bower_component|build|\
coverage|\
doc|\
external|\
fixture|\
git_module|\
jquery|\
log|\
min|misc|mock|\
node_module|\
raw|\rollup|\
swp|\
tmp|\
vendor)s{0,1}(\\b|_)\
" '
/* jslint ignore:end */
                    + "| tr \"\\n\" \"\\000\" | xargs -0 grep -HIin -E \""
                    + match2 + "\""
                ), {
                    shell: true,
                    stdio: [
                        "ignore", 1, 2
                    ]
                })
                // on shell exit, print return prompt
                .on("exit", function (exitCode) {
                    console.error("exit-code " + exitCode);
                    that.evalDefault(
                        "\n",
                        context,
                        file,
                        onError2
                    );
                });
                script = "\n";
                break;
            // syntax-sugar - list object's keys, sorted by item-type
            // console.error(Object.keys(global).map(function(key){return(typeof global[key]==='object'&&global[key]&&global[key]===global[key]?'global':typeof global[key])+' '+key;}).sort().join('\n')) // jslint ignore:line
            case "keys":
                script = (
                    "console.error(Object.keys(" + match2
                    + ").map(function(key){return("
                    + "typeof " + match2 + "[key]==='object'&&"
                    + match2 + "[key]&&"
                    + match2 + "[key]===global[key]"
                    + "?'global'"
                    + ":typeof " + match2 + "[key]"
                    + ")+' '+key;"
                    + "}).sort().join('\\n'))\n"
                );
                break;
            // syntax-sugar - print stringified arg
            case "print":
                script = "console.error(String(" + match2 + "))\n";
                break;
            // syntax-sugar - read file
            case "readFile":
                try {
                    console.error(JSON.stringify(
                        require("fs").readFileSync(match2, "utf8")
                    ));
                } catch (errCaught) {
                    console.error(errCaught);
                }
                script = "\n";
                break;
            }
        });
        // eval the script
        that.evalDefault(script, context, file, onError2);
    };
    that.socket = {
        end: local.nop,
        on: local.nop,
        write: local.nop
    };
    // init process.stdout
    process.stdout._writeDefault = (
        process.stdout._writeDefault
        || process.stdout._write
    );
    process.stdout._write = function (chunk, encoding, callback) {
        process.stdout._writeDefault(chunk, encoding, callback);
        // coverage-hack - ignore else-statement
        local.nop(that.socket.writable && (function () {
            that.socket.write(chunk, encoding);
        }()));
    };
    // start serverRepl1
    globalThis.utility2_serverRepl1 = require("net").createServer(function (
        socket
    ) {
        // init socket
        that.socket = socket;
        that.socket.on("data", that.write.bind(that));
        that.socket.on("error", that.onError);
        that.socket.setKeepAlive(true);
    });
    // coverage-hack - ignore else-statement
    local.nop(process.env.PORT_REPL && (function () {
        console.error(
            "repl-server listening on port " + process.env.PORT_REPL
        );
        globalThis.utility2_serverRepl1.listen(process.env.PORT_REPL);
    }()));
};

local.requireInSandbox = function (file) {
/*
 * this function will require the file in a sandbox-lite env
 */
    var exports;
    var mockDict;
    var mockList;
    var tmp;
    mockList = [
        [
            globalThis, {
                setImmediate: local.nop,
                setInterval: local.nop,
                setTimeout: local.nop
            }
        ]
    ];
    [
        [
            local, "child_process"
        ], [
            local, "cluster"
        ], [
            local, "http"
        ], [
            local, "https"
        ], [
            local, "net"
        ], [
            local, "repl"
        ], [
            local.events, "prototype"
        ], [
            globalThis, "process"
        ], [
            local.stream, "prototype"
        ], [
            process, "stdin"
        ]
    ].forEach(function (elem) {
        tmp = elem[0][elem[1]];
        mockDict = {};
        Object.keys(tmp).forEach(function (key) {
            if (
                typeof tmp[key] === "function"
                && !(
                    /^(?:fs\.Read|fs\.read|process\.binding|process\.dlopen)/
                )
                .test(elem[1] + "." + key)
            ) {
                mockDict[key] = function () {
                    return;
                };
                // coverage-hack
                mockDict[key]();
            }
        });
        mockList.push([
            tmp, mockDict
        ]);
    });
    local.testMock(mockList, function (onError) {
        local.tryCatchOnError(function () {
            exports = require(file);
        }, local.onErrorDefault);
        onError();
    }, local.onErrorThrow);
    return exports;
};

local.requireReadme = function () {
/*
 * this function will require and export example.js embedded in README.md
 */
    var code;
    var module;
    var tmp;
    // init module.exports
    module = {};
    if (local.isBrowser) {
        module.exports = local.objectSetDefault(
            globalThis.utility2_rollup || globalThis.local,
            local
        );
        return module.exports;
    }
    // start repl-debugger
    local.replStart();
    // debug dir
    [
        __dirname + "/lib.jslint.js",
        __filename,
        "undefined"
    ].forEach(function (file) {
        local.fs.exists(file, function (exists) {
            if (exists) {
                local.onFileModifiedRestart(file);
            }
        });
    });
    local.fs.readdirSync(process.cwd()).forEach(function (file) {
        file = process.cwd() + "/" + file;
        // if the file is modified, then restart the process
        local.onFileModifiedRestart(file);
        switch (local.path.basename(file)) {
        // swagger-validate assets.swgg.swagger.json
        case "assets.swgg.swagger.json":
            local.fs.readFile(file, "utf8", function (err, data) {
                local.tryCatchOnError(function () {
                    // validate no err occurred
                    local.assertThrow(!err, err);
                    local.swgg.swaggerValidate(JSON.parse(data));
                }, local.onErrorDefault);
            });
            break;
        }
    });
    // jslint process.cwd()
    if (!local.env.npm_config_mode_library) {
        local.child_process.spawn("node", [
            "-e", (
                "require("
                + JSON.stringify(__filename)
                + ").jslint.jslintAndPrintDir("
                + JSON.stringify(process.cwd())
                + ", {autofix:true,conditional:true}, process.exit);"
            )
        ], {
            env: local.objectAssignDefault({
                npm_config_mode_library: "1"
            }, local.env),
            stdio: [
                "ignore", "ignore", 2
            ]
        });
    }
    if (globalThis.utility2_rollup || local.env.npm_config_mode_start) {
        // init assets
        local.assetsDict["/index.html"] = (
            local.fsReadFileOrEmptyStringSync("index.html")
            || local.assetsDict["/index.rollup.html"] || ""
        );
        local.assetsDict["/"] = local.assetsDict["/index.html"];
        local.assetsDict["/assets.app.js"] = local.fs.readFileSync(
            __filename,
            "utf8"
        ).replace((
            /^#!\//
        ), "// ");
        // init exports
        local[local.env.npm_package_nameLib] = local;
        module.exports = local;
        return module.exports;
    }
    // init file $npm_package_main
    globalThis.utility2_moduleExports = require(
        process.cwd() + "/" + local.env.npm_package_main
    );
    globalThis.utility2_moduleExports.globalThis = globalThis;
    // read code from README.md
    code = local.templateRenderMyApp(
        local.assetsDict["/assets.example.template.js"],
        {}
    );
    local.tryCatchOnError(function () {
        tmp = (
            /```\w*?(\n[\W\s]*?example\.js[\n"][\S\s]*?)\n```/
        ).exec(
            local.fs.readFileSync("README.md", "utf8")
        );
        code = tmp.input.slice(0, tmp.index).replace((
            /.+/g
        ), "") + tmp[1];
    }, local.nop);
    code = code
    // alias require($npm_package_name) to utility2_moduleExports;
    .replace(
        new RegExp("require\\(." + local.env.npm_package_name + ".\\)"),
        "globalThis.utility2_moduleExports"
    )
    .replace(
        new RegExp("require\\(." + local.env.npm_package_nameOriginal + ".\\)"),
        "globalThis.utility2_moduleExports"
    );
    // init example.js
    tmp = process.cwd() + "/example.js";
    // jslint code
    local.jslintAndPrint(code, tmp);
    // cover code
    code = local.istanbulInstrumentInPackage(code, tmp);
    // init module.exports
    module = new local.Module(tmp);
    require.cache[tmp] = module;
    // load code into module
    module._compile(code, tmp);
    // init exports
    module.exports.utility2 = local;
    module.exports[local.env.npm_package_nameLib] = (
        globalThis.utility2_moduleExports
    );
    // init assets
    tmp = process.cwd() + "/" + local.env.npm_package_main;
    local.assetsDict["/assets." + local.env.npm_package_nameLib + ".js"] = (
        local.fs.readFileSync(tmp, "utf8").replace((
            /^#!\//
        ), "// ")
    );
    local.objectSetOverride(local.assetsDict, module.exports.assetsDict);
    local.assetsDict["/assets." + local.env.npm_package_nameLib + ".js"] = (
        local.istanbulInstrumentInPackage(
            local.assetsDict[
                "/assets." + local.env.npm_package_nameLib + ".js"
            ],
            tmp
        )
    );
    module.exports.assetsDict = local.assetsDict;
    local.assetsDict["/assets.example.js"] = code;
    local.assetsDict["/assets.test.js"] = local.istanbulInstrumentInPackage(
        local.fs.readFileSync("test.js", "utf8"),
        process.cwd() + "/test.js"
    );
    // init assets index.html
    [
        "", ".rollup"
    ].forEach(function (isRollup) {
        [
            "index", "utility2"
        ].forEach(function (file) {
            tmp = "assets." + file + ".template.html";
            local.assetsDict["/" + tmp] = (
                local.fsReadFileOrEmptyStringSync(tmp, "utf8")
                || local.assetsDict["/" + tmp]
            );
            file = (
                file.replace("utility2", "assets.utility2.base") + isRollup
                + ".html"
            );
            local.assetsDict["/" + file] = local.fsReadFileOrEmptyStringSync(
                file,
                "utf8"
            ) || local.templateRender(
                // uncomment utility2-comment
                local.assetsDict["/" + tmp].replace((
                    /<!--\u0020utility2-comment\b([\S\s]*?)\butility2-comment\u0020-->/g
                ), "$1"),
                {
                    env: local.env,
                    isRollup
                }
            );
        });
    });
    local.assetsDict["/"] = local.assetsDict["/index.html"];
    // init assets.app.js
    local.assetsDict["/assets.app.js"] = [
        "header",
        "/assets.utility2.rollup.js",
        "/assets.utility2.rollup.begin.js",
        "local.stateInit",
        "/assets.my_app.js",
        "/assets.example.js",
        "/assets.test.js",
        "/assets.utility2.rollup.end.js"
    ].map(function (key) {
        switch (key) {
/* jslint ignore:start */
case 'header':
return '\
/* this rollup was created with utility2\n\
 * https://github.com/kaizhu256/node-utility2\n\
 */\n\
\n\
\n\
\n\
/*\n\
assets.app.js\n\
\n\
' + local.env.npm_package_description + '\n\
\n\
instruction\n\
    1. save this script as assets.app.js\n\
    2. run the shell-command:\n\
        $ PORT=8081 node assets.app.js\n\
    3. open a browser to http://127.0.0.1:8081 and play with the web-demo\n\
    4. edit this script to suit your needs\n\
*/\n\
' + local.assetsDict["/assets.utility2.rollup.begin.js"]
    .replace((/utility2_rollup/g), 'utility2_app');
/* jslint ignore:end */
        case "/assets.my_app.js":
            // handle large string-replace
            tmp = "/assets." + local.env.npm_package_nameLib + ".js";
            code = local.assetsDict["/assets.utility2.rollup.content.js"]
            .split("/* utility2.rollup.js content */");
            code.splice(
                1,
                0,
                "local.assetsDict[\"" + tmp + "\"] = "
                + JSON.stringify(local.assetsDict[tmp]).replace((
                    /\\\\/g
                ), "\u0000").replace((
                    /\\n/g
                ), "\\n\\\n").replace((
                    /\u0000/g
                ), "\\\\")
            );
            code = code.join("");
            code += "\n";
            code += local.assetsDict[tmp];
            break;
        case "local.stateInit":
            // handle large string-replace
            code = local.assetsDict["/assets.utility2.rollup.content.js"]
            .split("/* utility2.rollup.js content */");
            tmp = local.middlewareJsonpStateInit({
                stateInit: true
            });
            // add extra physical files to assetsDict
            local.fs.readdirSync(".").forEach(function (file) {
                file = "/" + file;
                if (
                    local.assetsDict[file]
                    && local.assetsDict[file].length <= 0x100000
                    && String(local.assetsDict[file])
                    === local.fsReadFileOrEmptyStringSync("." + file, "utf8")
                ) {
                    tmp.utility2.assetsDict[file] = local.assetsDict[file];
                }
            });
            code.splice(1, 0, key + "(" + JSON.stringify(tmp, null, 4) + ");");
            code = code.join("");
            break;
        default:
            code = local.assetsDict[key];
        }
        return (
            "/* script-begin " + key + " */\n"
            + code.trim()
            + "\n/* script-end " + key + " */\n"
        );
    }).join("\n\n\n");
    local.objectSetDefault(module.exports, local);
    // init testCase_buildXxx
    Object.keys(local).forEach(function (key) {
        if (
            key.indexOf("_testCase_build") === 0
            || key === "_testCase_webpage_default"
        ) {
            module.exports[key.slice(1)] = (
                module.exports[key.slice(1)] || local[key]
            );
        }
    });
    return module.exports;
};

local.semverCompare = function (aa, bb) {
/*
 * this function will compare semver versions aa ? bb and return
 * -1 if aa < bb
 *  0 if aa = bb
 *  1 if aa > bb
 * https://semver.org/#spec-item-11
 */
    return [
        aa, bb
    ].map(function (aa) {
        aa = aa.split("-");
        return [
            aa[0], aa.slice(1).join("-") || "\u00ff"
        ].map(function (aa) {
            return aa.split(".").map(function (aa) {
                return ("0000000000000000" + aa).slice(-16);
            }).join(".");
        }).join("-");
    }).reduce(function (aa, bb) {
        return (
            aa === bb
            ? 0
            : aa < bb
            ? -1
            : 1
        );
    });
};

local.serverRespondCors = function (req, res) {
/*
 * this function will enable cors for the req
 * http://en.wikipedia.org/wiki/Cross-origin_resource_sharing
 */
    local.serverRespondHeadSet(req, res, null, local.jsonCopy({
        "access-control-allow-headers":
        req.headers["access-control-request-headers"],
        "access-control-allow-methods":
        req.headers["access-control-request-method"],
        "access-control-allow-origin": "*"
    }));
};

local.serverRespondDefault = function (req, res, statusCode, err) {
/*
 * this function will respond with a default message,
 * or <err>.stack for given statusCode
 */
    // init statusCode and contentType
    local.serverRespondHeadSet(
        req,
        res,
        statusCode,
        {
            "Content-Type": "text/plain; charset=utf-8"
        }
    );
    if (err) {
        // debug statusCode / method / url
        local.errorMessagePrepend(
            err,
            res.statusCode + " " + req.method + " " + req.url
            + "\n"
        );
        // print err.stack to stderr
        local.onErrorDefault(err);
        // end res with err.stack
        res.end(err.stack);
        return;
    }
    // end res with default statusCode message
    res.end(
        statusCode + " " + local.http.STATUS_CODES[statusCode]
    );
};

local.serverRespondEcho = function (req, res) {
/*
 * this function will respond with debug info
 */
    res.write(
        req.method + " " + req.url
        + " HTTP/" + req.httpVersion + "\r\n"
        + Object.keys(req.headers).map(function (key) {
            return key + ": " + req.headers[key] + "\r\n";
        }).join("") + "\r\n"
    );
    req.pipe(res);
};

local.serverRespondHeadSet = function (ignore, res, statusCode, headers) {
/*
 * this function will set the <res> object's <statusCode> and <headers>
 */
    if (res.headersSent) {
        return;
    }
    // init res.statusCode
    if (Number(statusCode)) {
        res.statusCode = Number(statusCode);
    }
    Object.keys(headers).forEach(function (key) {
        if (headers[key]) {
            res.setHeader(key, headers[key]);
        }
    });
    return true;
};

local.serverRespondTimeoutDefault = function (req, res, timeout) {
/*
 * this function will create a timeout-err-handler for server-<req>
 */
    var isDone;
    var onError;
    onError = function () {
        if (isDone) {
            return;
        }
        isDone = true;
        // debug serverResponse
        console.error("serverLog - " + JSON.stringify({
            time: new Date(req.timeStart).toISOString(),
            type: "serverResponse",
            method: req.method,
            url: req.url,
            statusCode: res.statusCode | 0,
            timeElapsed: Date.now() - req.timeStart,
            // extra
            requestContentLength: req.dataLength || 0,
            resContentLength: res.contentLength,
            requestHeaderXForwardedFor:
            req.headers["x-forwarded-for"] || "",
            requestHeaderOrigin: req.headers.origin || "",
            requestHeaderReferer: req.headers.referer || "",
            requestHeaderUserAgent: req.headers["user-agent"]
        }));
        // cleanup timerTimeout
        clearTimeout(req.timerTimeout);
    };
    req.timeStart = Date.now();
    req.onTimeout = req.onTimeout || function (err) {
        local.serverRespondDefault(req, res, 500, err);
        setTimeout(function () {
            // cleanup <req> and <res>
            local.streamCleanup(req);
            local.streamCleanup(res);
        }, 1000);
    };
    // init timerTimeout
    req.timerTimeout = local.onTimeout(
        req.onTimeout,
        timeout || local.timeoutDefault,
        "server " + req.method + " " + req.url
    );
    res.contentLength = 0;
    res.writeContentLength = res.writeContentLength || res.write;
    res.write = function (chunk, encoding, callback) {
        chunk = local.normalizeChunk(chunk);
        res.contentLength += chunk.length;
        res.writeContentLength(chunk, encoding, callback);
    };
    res.on("error", onError);
    res.on("finish", onError);
};

local.setTimeoutOnError = function (onError, timeout, err, data) {
/*
 * this function will after timeout has passed,
 * then call <onError>(<err>, <data>)
 */
    if (typeof onError === "function") {
        setTimeout(function () {
            onError(err, data);
        }, timeout);
    }
    return data;
};

local.sjclHashScryptCreate = function (password, opt) {
/*
 * this function will create a scrypt-hash of the password
 * with given <opt> (default = $s0$10801)
 * e.g.
 * $s0$e0801$epIxT/h6HbbwHaehFnh/bw==$7H0vs
 * XlY8UxxyW/BWx/9GuY7jEvGjT71GFd6O4SZND0=
 * https://github.com/wg/scrypt
 */
    // init opt
    opt = (opt || "$s0$10801").split("$");
    // init salt
    if (!opt[3]) {
        opt[3] = local.sjcl.codec.base64.fromBits(
            local.sjcl.random.randomWords(4, 0)
        );
    }
    // init hash
    opt[4] = local.sjcl.codec.base64.fromBits(
        local.sjcl.misc.scrypt(
            password || "",
            local.sjcl.codec.base64.toBits(opt[3]),
            Math.pow(2, parseInt(opt[2].slice(0, 1), 16)),
            parseInt(opt[2].slice(1, 2), 16),
            parseInt(opt[2].slice(3, 4), 16)
        )
    );
    return opt.slice(0, 5).join("$");
};

local.sjclHashScryptValidate = function (password, hash) {
/*
 * this function will validate the password against the scrypt-hash
 * https://github.com/wg/scrypt
 */
    return local.sjclHashScryptCreate(password, hash) === hash;
};

local.sjclHashSha1Create = function (data) {
/*
 * this function will create a base64-encoded sha1 hash of the string data
 */
    return local.sjcl.codec.base64.fromBits(local.sjcl.hash.sha1.hash(data));
};

local.sjclHashSha256Create = function (data) {
/*
 * this function will create a base64-encoded sha256 hash of the string data
 */
    return local.sjcl.codec.base64.fromBits(local.sjcl.hash.sha256.hash(data));
};

local.sjclHmacSha1Create = function (key, data) {
/*
 * this function will create a base64-encoded sha1 hmac
 * from the string key and string data
 */
    var Hmac;
    Hmac = local.sjcl.misc.hmac;
    return local.sjcl.codec.base64.fromBits(
        (new Hmac(
            local.sjcl.codec.utf8String.toBits(key),
            local.sjcl.hash.sha1
        )).mac(local.sjcl.codec.utf8String.toBits(data))
    );
};

local.sjclHmacSha256Create = function (key, data) {
/*
 * this function will create a base64-encoded sha256 hmac
 * from the string key and string data
 */
    var Hmac;
    Hmac = local.sjcl.misc.hmac;
    return local.sjcl.codec.base64.fromBits(
        (new Hmac(
            local.sjcl.codec.utf8String.toBits(key),
            local.sjcl.hash.sha256
        )).mac(local.sjcl.codec.utf8String.toBits(data))
    );
};

local.stateInit = function (opt) {
/*
 * this function will init state <opt>
 */
    local.objectSetOverride(local, opt, 10);
    // init swgg
    local.swgg.apiUpdate(local.swgg.swaggerJson);
};

local.streamCleanup = function (stream) {
/*
 * this function will try to end or destroy the stream
 */
    var err;
    // try to end the stream
    try {
        stream.end();
    } catch (errCaught) {
        err = errCaught;
    }
    // if err, then try to destroy the stream
    if (err) {
        try {
            stream.destroy();
        } catch (ignore) {}
    }
};

local.streamReadAll = function (stream, onError) {
/*
 * this function will concat data from <stream>
 * and pass to <onError> when finished reading
 */
    var chunkList;
    chunkList = [];
    stream.dataLength = 0;
    // on event-data, push buffer-chunk to chunkList
    stream.on("data", function (chunk) {
        chunk = local.normalizeChunk(chunk);
        chunkList.push(chunk);
        stream.dataLength += chunk.length;
    // on event-end, pass concatenated-buffer to onError
    }).on("end", function () {
        onError(
            null,
            local.isBrowser
            ? chunkList[0]
            : local.bufferConcat(chunkList)
        );
    // on event-error, pass error to onError
    }).on("error", onError);
};

local.stringHtmlSafe = function (text) {
/*
 * this function will make the text html-safe
 * https://stackoverflow.com/questions/7381974/which-characters-need-to-be-escaped-on-html
 */
    return text
    .replace((
        /&/g
    ), "&amp;")
    .replace((
        /"/g
    ), "&quot;")
    .replace((
        /'/g
    ), "&apos;")
    .replace((
        /</g
    ), "&lt;")
    .replace((
        />/g
    ), "&gt;")
    .replace((
        /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
    ), "&$1");
};

local.stringMerge = function (str1, str2, rgx) {
/*
 * this function will merge <str2> into <str1>,
 * for sections where both match <rgx>
 */
    str2.replace(rgx, function (match2) {
        str1.replace(rgx, function (match1) {
            str1 = str1.replace(match1, function () {
                return match2;
            });
        });
    });
    return str1;
};

local.stringQuotedToAscii = function (str) {
/*
 * this function will replace non-ascii-chr to unicode-escaped-ascii-chr
 * in quoted-<str>
 */
    return str
    .replace((
        /\r/g
    ), "\\r")
    .replace((
        /\t/g
    ), "\\t")
    .replace((
        /[^\n\u0020-\u007e]/g
    ), function (chr) {
        return "\\u" + ("0000" + chr.charCodeAt(0).toString(16)).slice(-4);
    });
};

local.stringRegexpEscape = function (text) {
/*
 * this function will regexp-escape text
 * https://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
 */
    return text.replace((
        /[\-\/\\\^$*+?.()|\[\]{}]/g
    ), "\\$&");
};

local.stringTruncate = function (text, maxLength) {
/*
 * this function will truncate text to given maxLength
 */
    return (
        text.length > maxLength
        ? text.slice(0, maxLength - 3).trimRight() + "..."
        : text
    );
};

local.stringUniqueKey = function (text) {
/*
 * this function will return a string-key that is unique in given text
 */
    var key;
    // seed the key with the least frequent letters in the english-language
    // https://en.wikipedia.org/wiki/Letter_frequency
    key = "zqxj";
    do {
        key += ((1 + Math.random()) * 0x10000000000000).toString(36).slice(1);
    } while (text.indexOf(key) >= 0);
    return key;
};

local.taskCreate = function (opt, onTask, onError) {
/*
 * this function will create the task onTask named <opt>.key,
 * if it does not exist, and push onError to its onErrorList
 */
    var task;
    // init task
    local.taskOnTaskDict[opt.key] = (
        local.taskOnTaskDict[opt.key]
        || {
            onErrorList: []
        }
    );
    task = local.taskOnTaskDict[opt.key];
    // push callback onError to the task
    if (onError) {
        onError = local.onErrorWithStack(onError);
        task.onErrorList.push(onError);
    }
    // if task exists, then return it
    if (!onTask || task.onTask) {
        return task;
    }
    task.onDone = function (err, data, meta) {
        // if isDone, then do nothing
        if (task.isDone) {
            return;
        }
        task.isDone = true;
        // cleanup timerTimeout
        clearTimeout(task.timerTimeout);
        // cleanup task
        delete local.taskOnTaskDict[opt.key];
        // preserve err.message and err.stack
        task.result = JSON.stringify([
            (
                (err && err.stack)
                ? Object.assign(local.jsonCopy(err), {
                    message: err.message,
                    name: err.name,
                    stack: err.stack
                })
                : err
            ), data, meta
        ]);
        // pass result to callbacks in onErrorList
        task.onErrorList.forEach(function (onError) {
            onError.apply(null, JSON.parse(task.result));
        });
    };
    // init timerTimeout
    task.timerTimeout = local.onTimeout(
        task.onDone,
        opt.timeout || local.timeoutDefault,
        "taskCreate " + opt.key
    );
    task.onTask = onTask;
    // run onTask
    task.onTask(task.onDone);
    return task;
};

local.taskCreateCached = function (opt, onTask, onError) {
/*
 * this function will
 * 1. if cache-hit, then call onError with cacheValue
 * 2. run onTask in background to update cache
 * 3. save onTask's result to cache
 * 4. if cache-miss, then call onError with onTask's result
 */
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        // 1. if cache-hit, then call onError with cacheValue
        case 1:
            // read cacheValue from memory-cache
            local.cacheDict[opt.cacheDict] = (
                local.cacheDict[opt.cacheDict]
                || {}
            );
            opt.cacheValue = local.cacheDict[opt.cacheDict][opt.key];
            if (opt.cacheValue) {
                // call onError with cacheValue
                opt.modeCacheHit = true;
                onError(null, JSON.parse(opt.cacheValue));
                if (!opt.modeCacheUpdate) {
                    break;
                }
            }
            // run background-task with lower priority for cache-hit
            setTimeout(opt.onNext, opt.modeCacheHit && opt.cacheTtl);
            break;
        // 2. run onTask in background to update cache
        case 2:
            local.taskCreate(opt, onTask, opt.onNext);
            break;
        default:
            // 3. save onTask's result to cache
            // JSON.stringify data to prevent side-effects on cache
            opt.cacheValue = JSON.stringify(data);
            if (!err && opt.cacheValue) {
                local.cacheDict[opt.cacheDict][opt.key] = opt.cacheValue;
            }
            // 4. if cache-miss, then call onError with onTask's result
            if (!opt.modeCacheHit) {
                onError(err, opt.cacheValue && JSON.parse(opt.cacheValue));
            }
            local.functionOrNop(opt.onCacheWrite)();
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.templateRender = function (template, dict, opt) {
/*
 * this function will render the template with given dict
 */
    var argList;
    var getValue;
    var match;
    var renderPartial;
    var rgx;
    var skip;
    var value;
    dict = dict || {};
    opt = opt || {};
    getValue = function (key) {
        argList = key.split(" ");
        value = dict;
        if (argList[0] === "#this/") {
            return;
        }
        // iteratively lookup nested values in the dict
        argList[0].split(".").forEach(function (key) {
            value = value && value[key];
        });
        return value;
    };
    renderPartial = function (match0, helper, key, partial) {
        switch (helper) {
        case "each":
        case "eachTrimRightComma":
            value = getValue(key);
            value = (
                Array.isArray(value)
                ? value.map(function (dict) {
                    // recurse with partial
                    return local.templateRender(partial, dict, opt);
                }).join("")
                : ""
            );
            // remove trailing-comma from last elem
            if (helper === "eachTrimRightComma") {
                value = value.trimRight().replace((
                    /,$/
                ), "");
            }
            return value;
        case "if":
            partial = partial.split("{{#unless " + key + "}}");
            partial = (
                getValue(key)
                ? partial[0]
                // handle 'unless' case
                : partial.slice(1).join("{{#unless " + key + "}}")
            );
            // recurse with partial
            return local.templateRender(partial, dict, opt);
        case "unless":
            return (
                getValue(key)
                ? ""
                // recurse with partial
                : local.templateRender(partial, dict, opt)
            );
        default:
            // recurse with partial
            return match0[0] + local.templateRender(match0.slice(1), dict, opt);
        }
    };
    // render partials
    rgx = (
        /\{\{#(\w+)\u0020([^}]+?)\}\}/g
    );
    template = template || "";
    match = rgx.exec(template);
    while (match) {
        rgx.lastIndex += 1 - match[0].length;
        template = template.replace(
            new RegExp(
                "\\{\\{#(" + match[1] + ") (" + match[2]
                + ")\\}\\}([\\S\\s]*?)\\{\\{/" + match[1] + " " + match[2]
                + "\\}\\}"
            ),
            renderPartial
        );
        match = rgx.exec(template);
    }
    // search for keys in the template
    return template.replace((
        /\{\{[^}]+?\}\}/g
    ), function (match0) {
        var markdownToHtml;
        var notHtmlSafe;
        notHtmlSafe = opt.notHtmlSafe;
        try {
            getValue(match0.slice(2, -2));
            if (value === undefined) {
                return match0;
            }
            argList.slice(1).forEach(function (arg0, ii, list) {
                switch (arg0) {
                case "alphanumeric":
                    value = value.replace((
                        /\W/g
                    ), "_");
                    break;
                case "decodeURIComponent":
                    value = decodeURIComponent(value);
                    break;
                case "encodeURIComponent":
                    value = encodeURIComponent(value);
                    break;
                case "jsonStringify":
                    value = JSON.stringify(value);
                    break;
                case "jsonStringify4":
                    value = JSON.stringify(value, null, 4);
                    break;
                case "markdownSafe":
                    value = value.replace((
                        /`/g
                    ), "'");
                    break;
                case "markdownToHtml":
                    markdownToHtml = true;
                    break;
                case "notHtmlSafe":
                    notHtmlSafe = true;
                    break;
                case "padEnd":
                case "padStart":
                case "slice":
                    skip = ii + 2;
                    value = String(value)[arg0](
                        list[skip - 1],
                        list[skip]
                    );
                    break;
                case "truncate":
                    skip = ii + 1;
                    if (value.length > list[skip]) {
                        value = value.slice(
                            0,
                            Math.max(list[skip] - 3, 0)
                        ).trimRight() + "...";
                    }
                    break;
                // default to String.prototype[arg0]()
                default:
                    if (ii <= skip) {
                        break;
                    }
                    value = value[arg0]();
                }
            });
            value = String(value);
            // default to htmlSafe
            if (!notHtmlSafe) {
                value = value
                .replace((
                    /&/g
                ), "&amp;")
                .replace((
                    /"/g
                ), "&quot;")
                .replace((
                    /'/g
                ), "&apos;")
                .replace((
                    /</g
                ), "&lt;")
                .replace((
                    />/g
                ), "&gt;")
                .replace((
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
                ), "&$1");
            }
            markdownToHtml = (
                markdownToHtml
                && (typeof local.marked === "function" && local.marked)
            );
            if (markdownToHtml) {
                value = markdownToHtml(value)
                .replace((
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
                ), "&$1");
            }
            return value;
        } catch (errCaught) {
            errCaught.message = (
                "templateRender could not render expression "
                + JSON.stringify(match0)
                + "\n"
            ) + errCaught.message;
            local.assertThrow(null, errCaught);
        }
    });
};

local.templateRenderMyApp = function (template, opt) {
/*
 * this function will render my-app-lite template with given <opt>.packageJson
 */
    opt.packageJson = local.fsReadFileOrEmptyStringSync("package.json", "json");
    local.objectSetDefault(opt.packageJson, {
        nameLib: opt.packageJson.name.replace((
            /\W/g
        ), "_"),
        repository: {
            url: (
                "https://github.com/kaizhu256/node-"
                + opt.packageJson.name
                + ".git"
            )
        }
    }, 2);
    opt.githubRepo = opt.packageJson.repository.url.replace((
        /\.git$/
    ), "").split("/").slice(-2);
    template = template.replace((
        /kaizhu256(\.github\.io\/|%252F|\/)/g
    ), opt.githubRepo[0] + ("$1"));
    template = template.replace((
        /node-my-app-lite/g
    ), opt.githubRepo[1]);
    template = template.replace((
        /\bh1-my-app\b/g
    ), (
        opt.packageJson.nameHeroku
        || ("h1-" + opt.packageJson.nameLib.replace((
            /_/g
        ), "-"))
    ));
    template = template.replace((
        /my-app-lite/g
    ), opt.packageJson.name);
    template = template.replace((
        /my_app/g
    ), opt.packageJson.nameLib);
    template = template.replace((
        /\{\{packageJson\.(\S+)\}\}/g
    ), function (ignore, match1) {
        return opt.packageJson[match1];
    });
    return template;
};

local.testCase_nop_default = function (opt, onError) {
/*
 * this function will test nop's default handling-behavior
 */
    local.nop();
    onError(null, opt);
};

local.testMock = function (mockList, onTestCase, onError) {
/*
 * this function will mock the objects in mockList while running the onTestCase
 */
    var onError2;
    onError2 = function (err) {
        // restore mock[0] from mock[2]
        mockList.reverse().forEach(function (mock) {
            Object.keys(mock[2]).forEach(function (key) {
                mock[0][key] = mock[2][key];
            });
        });
        onError(err);
    };
    // suppress console.error and console.log
    if (!(mockList[0] && mockList[0][0] === console)) {
        mockList.unshift([
            console, {}
        ]);
    }
    local.objectSetDefault(mockList[0][1], {
        error: local.nop,
        log: local.nop
    });
    // mock-objects
    mockList.forEach(function (mock) {
        mock[2] = {};
        // backup mock[0] into mock[2]
        Object.keys(mock[1]).forEach(function (key) {
            mock[2][key] = (
                // ternary-operator
                (
                    typeof process === "object"
                    && process.env === mock[0]
                    && mock[0][key] === undefined
                )
                // handle process.env
                ? ""
                : mock[0][key]
            );
        });
        // override mock[0] with mock[1]
        Object.keys(mock[1]).forEach(function (key) {
            mock[0][key] = mock[1][key];
        });
    });
    // try to call onError with mock-objects
    local.tryCatchOnError(function () {
        // run onTestCase
        onTestCase(onError2);
    }, onError2);
};

local.testReportCreate = function (testReport) {
/*
 * this function will create test-report artifacts
 */
    testReport = local.objectSetDefault(testReport, {
        testPlatformList: []
    });
    // print test-report summary
    console.error(
        "\n" + new Array(56).join("-")
        + "\n" + testReport.testPlatformList.filter(function (testPlatform) {
            // if testPlatform has no tests, then filter it out
            return testPlatform.testCaseList.length;
        }).map(function (testPlatform) {
            return (
                "| test-report - " + testPlatform.name + "\n|"
                + ("        " + testPlatform.timeElapsed + " ms     ")
                .slice(-16)
                + ("        " + testPlatform.testsFailed + " failed ")
                .slice(-16)
                + ("        " + testPlatform.testsPassed + " passed ")
                .slice(-16) + "     |\n" + new Array(56).join("-")
            );
        }).join("\n") + "\n"
    );
    // create test-report.html
    local.fs.writeFileSync(
        "tmp/build/test-report.html",
        local.testReportMerge(testReport, {})
    );
    // create build.badge.svg
    local.fs.writeFileSync(
        "tmp/build/build.badge.svg",
        local.assetsDict["/assets.buildBadge.template.svg"].replace((
            /0000-00-00\u002000:00:00\u0020UTC\u0020-\u0020master\u0020-\u0020aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/g
        ), (
            new Date().toISOString().slice(0, 19).replace("T", " ")
            + " - " + local.env.CI_BRANCH + " - " + local.env.CI_COMMIT_ID
        ))
    );
    // create test-report.badge.svg
    local.fs.writeFileSync(
        "tmp/build/test-report.badge.svg",
        local.assetsDict["/assets.testReportBadge.template.svg"]
        // edit number of tests failed
        .replace((
            /999/g
        ), testReport.testsFailed)
        // edit badge color
        .replace((
            /d00/g
        ), (
            testReport.testsFailed
            ? "d00"
            : "0d0"
        ))
    );
    console.error(
        "created test-report file "
        + process.cwd() + "/tmp/build/test-report.html\n"
    );
    // if any test failed, then exit with non-zero exit-code
    console.error(
        "\n" + local.env.MODE_BUILD
        + " - " + testReport.testsFailed + " failed tests\n"
    );
    // print failed testCase
    testReport.testPlatformList.forEach(function (testPlatform) {
        testPlatform.testCaseList.forEach(function (testCase) {
            if (testCase.status !== "passed") {
                console.error(JSON.stringify(testCase, null, 4));
            }
        });
    });
    return testReport;
};

local.testReportMerge = function (testReport1, testReport2) {
/*
 * this function will
 * 1. merge testReport2 into testReport1
 * 2. return testReport1 in html-format
 */
    var errorStackList;
    var testCaseNumber;
    var testReport;
    testReport2 = testReport2 || {};
    // 1. merge testReport2 into testReport1
    [
        testReport1, testReport2
    ].forEach(function (testReport, ii) {
        ii += 1;
        local.objectSetDefault(testReport, {
            date: new Date().toISOString(),
            errorStackList: [],
            testPlatformList: [],
            timeElapsed: 0
        }, 8);
        // security - handle malformed testReport
        local.assertThrow(
            typeof testReport === "object" && testReport,
            ii + " invalid testReport " + typeof testReport
        );
        // validate timeElapsed
        local.assertThrow(
            typeof testReport.timeElapsed === "number",
            ii + " invalid testReport.timeElapsed "
            + typeof testReport.timeElapsed
        );
        // security - handle malformed testReport.testPlatformList
        testReport.testPlatformList.forEach(function (testPlatform) {
            local.objectSetDefault(testPlatform, {
                name: "undefined",
                testCaseList: [],
                timeElapsed: 0
            }, 8);
            local.assertThrow(
                typeof testPlatform.name === "string",
                ii + " invalid testPlatform.name " + typeof testPlatform.name
            );
            // insert $MODE_BUILD into testPlatform.name
            if (local.env.MODE_BUILD) {
                testPlatform.name = testPlatform.name.replace((
                    /^(browser|node)\b/
                ), local.env.MODE_BUILD + " - $1");
            }
            // validate timeElapsed
            local.assertThrow(
                typeof testPlatform.timeElapsed === "number",
                (
                    ii + " invalid testPlatform.timeElapsed "
                    + typeof testPlatform.timeElapsed
                )
            );
            // security - handle malformed testPlatform.testCaseList
            testPlatform.testCaseList.forEach(function (testCase) {
                local.objectSetDefault(testCase, {
                    errorStack: "",
                    name: "undefined",
                    timeElapsed: 0
                }, 8);
                local.assertThrow(
                    typeof testCase.errorStack === "string",
                    ii + " invalid testCase.errorStack "
                    + typeof testCase.errorStack
                );
                local.assertThrow(
                    typeof testCase.name === "string",
                    ii + " invalid testCase.name " + typeof testCase.name
                );
                // validate timeElapsed
                local.assertThrow(
                    typeof testCase.timeElapsed === "number",
                    (
                        ii + " invalid testCase.timeElapsed "
                        + typeof testCase.timeElapsed
                    )
                );
            });
        });
    });
    // merge testReport2.testPlatformList into testReport1.testPlatformList
    testReport2.testPlatformList.forEach(function (testPlatform2) {
        // add testPlatform2 to testReport1.testPlatformList
        testReport1.testPlatformList.push(testPlatform2);
    });
    testReport = testReport1;
    testReport.testsFailed = 0;
    testReport.testsPassed = 0;
    testReport.testsPending = 0;
    testReport.testPlatformList.forEach(function (testPlatform) {
        testPlatform.testsFailed = 0;
        testPlatform.testsPassed = 0;
        testPlatform.testsPending = 0;
        testPlatform.testCaseList.forEach(function (testCase) {
            switch (testCase.status) {
            // update failed tests
            case "failed":
                testPlatform.testsFailed += 1;
                testReport.testsFailed += 1;
                break;
            // update passed tests
            case "passed":
                testPlatform.testsPassed += 1;
                testReport.testsPassed += 1;
                break;
            // update pending tests
            default:
                testPlatform.testsPending += 1;
                testReport.testsPending += 1;
            }
        });
        // update testPlatform.status
        testPlatform.status = (
            testPlatform.testsFailed
            ? "failed"
            : testPlatform.testsPending
            ? "pending"
            : "passed"
        );
        // sort testCaseList by status and name
        testPlatform.testCaseList.sort(function (aa, bb) {
            return (
                aa.status.replace("passed", "z") + aa.name
                > bb.status.replace("passed", "z") + bb.name
                ? 1
                : -1
            );
        });
    });
    // sort testPlatformList by status and name
    testReport.testPlatformList.sort(function (aa, bb) {
        return (
            aa.status.replace("passed", "z") + aa.name
            > bb.status.replace("passed", "z") + bb.name
            ? 1
            : -1
        );
    });
    // stop testReport timer
    if (!testReport.testsPending) {
        local.timeElapsedPoll(testReport);
    }
    // 2. return testReport1 in html-format
    // json-copy testReport that will be modified for html templating
    testReport = local.jsonCopy(testReport1);
    // update timeElapsed
    local.timeElapsedPoll(testReport);
    testReport.testPlatformList.forEach(function (testPlatform) {
        // update testPlatform.timeElapsed
        local.timeElapsedPoll(testPlatform);
        testPlatform.testCaseList.forEach(function (testCase) {
            if (!testCase.isDone) {
                local.timeElapsedPoll(testCase);
            }
            testPlatform.timeElapsed = Math.max(
                testPlatform.timeElapsed,
                testCase.timeElapsed
            );
        });
        // update testReport.timeElapsed with testPlatform.timeElapsed
        testReport.timeElapsed = Math.max(
            testReport.timeElapsed,
            testPlatform.timeElapsed
        );
    });
    // create html test-report
    testCaseNumber = 0;
    return local.templateRender(
        local.assetsDict["/assets.testReport.template.html"],
        local.objectSetOverride(testReport, {
            env: local.env,
            // map testPlatformList
            testPlatformList: testReport.testPlatformList.filter(function (
                testPlatform
            ) {
                // if testPlatform has no tests, then filter it out
                return testPlatform.testCaseList.length;
            }).map(function (testPlatform, ii) {
                errorStackList = [];
                return local.objectSetOverride(testPlatform, {
                    errorStackList,
                    name: testPlatform.name,
                    screenshot: testPlatform.screenshot,
                    // map testCaseList
                    testCaseList: testPlatform.testCaseList.map(function (
                        testCase
                    ) {
                        testCaseNumber += 1;
                        if (testCase.errorStack) {
                            errorStackList.push({
                                errorStack: (
                                    testCaseNumber + ". " + testCase.name
                                    + "\n" + testCase.errorStack
                                )
                            });
                        }
                        return local.objectSetOverride(testCase, {
                            testCaseNumber,
                            testReportTestStatusClass: (
                                "test"
                                + testCase.status[0].toUpperCase()
                                + testCase.status.slice(1)
                            )
                        }, 8);
                    }),
                    preClass: (
                        errorStackList.length
                        ? ""
                        : "displayNone"
                    ),
                    testPlatformNumber: ii + 1
                });
            }, 8),
            testStatusClass: (
                testReport.testsFailed
                ? "testFailed"
                : "testPassed"
            )
        }, 8)
    );
};

local.testRunDefault = function (opt) {
/*
 * this function will run the tests in testPlatform.testCaseList
 */
    var processExit;
    var testPlatform;
    var testReport;
    var testReportDiv1;
    var timerInterval;
    // run-server
    if (!local.isBrowser) {
        local.testRunServer(opt);
    }
    globalThis.utility2_modeTest = Number(
        globalThis.utility2_modeTest
        || opt.modeTest
        || local.modeTest
        || local.env.npm_config_mode_test
    );
    switch (globalThis.utility2_modeTest) {
    // init
    case 1:
        globalThis.utility2_modeTest += 1;
        // reset db
        if (local.db && typeof local.db.dbReset === "function") {
            local.db.dbReset(
                globalThis.utility2_dbSeedList,
                local.onErrorThrow
            );
        }
        globalThis.utility2_onReadyAfter(function () {
            local.testRunDefault(opt);
        });
        return;
    // test-run
    default:
        // test-ignore
        if (
            globalThis.utility2_onReadyBefore.counter
            || !globalThis.utility2_modeTest
            || globalThis.utility2_modeTest > 2
        ) {
            return;
        }
        // test-run
        globalThis.utility2_modeTest += 1;
    }
    // visual notification - testRun
    local.ajaxProgressUpdate();
    // mock serverLog
    local._testRunConsoleError = local._testRunConsoleError || console.error;
    console.error = function (arg0) {
    /*
     * this function will ignore serverLog-messages during test-run
     */
        /* istanbul ignore next */
        if (!globalThis.__coverage__ && !(
            /^serverLog\u0020-\u0020\{/
        ).test(arg0)) {
            local._testRunConsoleError.apply(console, arguments); // jslint ignore:line
        }
    };
    if (!local.isBrowser) {
        // mock proces.exit
        processExit = process.exit;
        process.exit = local.nop;
    }
    // init modeTestCase
    local.modeTestCase = (
        local.modeTestCase
        || local.env.npm_config_mode_test_case || ""
    );
    // init testReport
    testReport = globalThis.utility2_testReport;
    // init testReport timer
    local.timeElapsedStart(testReport);
    // init testPlatform
    testPlatform = testReport.testPlatformList[0];
    // init testPlatform timer
    local.timeElapsedStart(testPlatform);
    // reset testPlatform.testCaseList
    testPlatform.testCaseList.length = 0;
    // add tests into testPlatform.testCaseList
    Object.keys(opt).forEach(function (key) {
        // add testCase opt[key] to testPlatform.testCaseList
        if (
            typeof opt[key] === "function" && (
                local.modeTestCase
                ? local.modeTestCase.split(
                    /[,\s]/g
                ).indexOf(key) >= 0
                : key.indexOf("testCase_") === 0
            )
        ) {
            testPlatform.testCaseList.push({
                isBrowser: local.isBrowser,
                name: key,
                status: "pending",
                onTestCase: opt[key]
            });
        }
    });
    // visual notification - update test-progress until isDone
    // init testReportDiv1 elem
    if (local.isBrowser) {
        testReportDiv1 = document.querySelector(
            "#testReportDiv1"
        );
    }
    testReportDiv1 = testReportDiv1 || {
        style: {}
    };
    local.uiAnimateSlideDown(testReportDiv1);
    testReportDiv1.innerHTML = local.testReportMerge(testReport, {});
    // update test-report status every 1000 ms until isDone
    timerInterval = setInterval(function () {
        // update testPlatform.timeElapsed
        local.timeElapsedPoll(testPlatform);
        // update testReportDiv1 in browser
        testReportDiv1.innerHTML = local.testReportMerge(testReport, {});
        if (!testReport.testsPending) {
            // cleanup timerInterval
            clearInterval(timerInterval);
        }
        // notify of remaining tests
        if (testPlatform.timeElapsed % 5000 < 1000) {
            local._testRunConsoleError(
                "testRunDefault - "
                + testPlatform.timeElapsed + " ms - testCase pending - "
                + testPlatform.testCaseList
                .filter(function (testCase) {
                    return testCase.status === "pending";
                })
                .slice(0, 4)
                .map(function (testCase) {
                    return testCase.name;
                }).join(", ") + " ..."
            );
        }
    }, 1000);
    // shallow-copy testPlatform.testCaseList to prevent side-effects
    // from in-place sort from testReportMerge
    local.onParallelList({
        list: testPlatform.testCaseList.slice(),
        rateLimit: Infinity
    }, function (testCase, onParallel) {
        var onError;
        var timerTimeout;
        onError = function (err) {
            // update testPlatform.timeElapsed
            local.timeElapsedPoll(testPlatform);
            // cleanup timerTimeout
            clearTimeout(timerTimeout);
            // if testCase isDone, then fail testCase
            if (testCase.isDone) {
                err = err || new Error(
                    "callback in testCase "
                    + testCase.name
                    + " called multiple times"
                );
            }
            // if err occurred, then fail testCase
            if (err) {
                // restore console.log
                console.error = local._testRunConsoleError;
                testCase.status = "failed";
                local._testRunConsoleError(
                    "\ntestRunDefault - "
                    + testPlatform.timeElapsed + " ms - testCase failed - "
                    + testCase.name + "\n" + err.message + "\n" + err.stack
                );
                testCase.errorStack = (
                    testCase.errorStack || err.message + "\n" + err.stack
                );
                // validate errorStack is non-empty
                local.assertThrow(
                    testCase.errorStack,
                    "invalid errorStack " + testCase.errorStack
                );
            }
            // if tests isDone, then do nothing
            if (testCase.isDone) {
                return;
            }
            testCase.isDone = true;
            if (testCase.status === "pending") {
                testCase.status = "passed";
            }
            // stop testCase timer
            local.timeElapsedPoll(testCase);
            local._testRunConsoleError(
                "testRunDefault - "
                + testPlatform.timeElapsed + " ms - [" + (
                    local.isBrowser
                    ? "browser"
                    : "node"
                ) + " test-case "
                + testPlatform.testCaseList.filter(function (testCase) {
                    return testCase.isDone;
                }).length + " of " + testPlatform.testCaseList.length + " "
                + testCase.status + "] - " + testCase.name
            );
            // if all testCase.isDone, then create test-report
            onParallel();
        };
        testCase = testCase.elem;
        // init timerTimeout
        timerTimeout = local.onTimeout(
            onError,
            local.timeoutDefault,
            testCase.name
        );
        // increment number of tests remaining
        onParallel.counter += 1;
        // try to run testCase
        local.tryCatchOnError(function () {
            // start testCase timer
            local.timeElapsedStart(testCase);
            testCase.onTestCase(null, onError);
        }, onError);
    }, function () {
    /*
     * this function will create the test-report after all tests isDone
     */
        // update testPlatform.timeElapsed
        local.timeElapsedPoll(testPlatform);
        globalThis.utility2_modeTest = 1;
        local.ajaxProgressUpdate();
        // init domOnEventWindowOnloadTimeElapsed
        if (globalThis.domOnEventWindowOnloadTimeElapsed < 0x10000000000) {
            testPlatform.domOnEventWindowOnloadTimeElapsed = (
                globalThis.domOnEventWindowOnloadTimeElapsed
            );
        }
        // finalize testReport
        local.testReportMerge(testReport, {});
        // create test-report.json
        delete testReport.coverage;
        local.fsWriteFileWithMkdirpSync(
            local.env.npm_config_dir_build + "/test-report.json",
            JSON.stringify(testReport, null, 4)
        );
        setTimeout(function () {
            // restore console.log
            console.error = local._testRunConsoleError;
            // restore process.exit
            if (processExit) {
                process.exit = processExit;
            }
            // reset utility2_modeTest
            globalThis.utility2_modeTest = 0;
            // exit with number of tests failed
            local.exit(testReport.testsFailed, testReport);
        // coverage-hack - wait 1000 ms for timerInterval
        }, 1000);
    });
};

local.testRunServer = function (opt) {
/*
 * this function will
 * 1. create server from local.middlewareList
 * 2. start server on local.env.PORT
 * 3. run tests
 */
    if (globalThis.utility2_serverHttp1) {
        return;
    }
    globalThis.utility2_onReadyBefore.counter += 1;
    // 1. create server from local.middlewareList
    local.middlewareList = local.middlewareList || [
        local.middlewareInit,
        local.middlewareForwardProxy,
        local.middlewareAssetsCached,
        local.middlewareJsonpStateInit,
        local.middlewareFileServer
    ];
    local.serverLocalReqHandler = function (req, res) {
        var that;
        that = {};
        local.onNext(that, function (err) {
            if (err || that.modeNext >= local.middlewareList.length) {
                local.middlewareError(err, req, res);
                return;
            }
            // recurse with next middleware in middlewareList
            local.middlewareList[that.modeNext](req, res, that.onNext);
        });
        that.modeNext = -1;
        that.onNext();
    };
    globalThis.utility2_serverHttp1 = local.http.createServer(
        local.serverLocalReqHandler
    );
    // 2. start server on local.env.PORT
    if (local.env.npm_config_mode_library) {
        globalThis.utility2_onReadyBefore();
        return;
    }
    console.error("http-server listening on port " + local.env.PORT);
    globalThis.utility2_onReadyBefore.counter += 1;
    globalThis.utility2_serverHttp1.listen(
        local.env.PORT,
        globalThis.utility2_onReadyBefore
    );
    // 3. run tests
    local.testRunDefault(opt);
    globalThis.utility2_onReadyBefore();
};

local.throwError = function () {
/*
 * this function will throw new err
 */
    throw new Error();
};

local.timeElapsedPoll = function (opt) {
/*
 * this function will poll <opt>.timeElapsed
 */
    opt = local.timeElapsedStart(opt);
    opt.timeElapsed = Date.now() - opt.timeStart;
    return opt;
};

local.timeElapsedStart = function (opt, timeStart) {
/*
 * this function will start <opt>.timeElapsed
 */
    opt = opt || {};
    opt.timeStart = timeStart || opt.timeStart || Date.now();
    return opt;
};

local.tryCatchOnError = function (fnc, onError) {
/*
 * this function will run the fnc in a tryCatch block,
 * else call onError with errCaught
 */
    var result;
    // validate onError
    local.assertThrow(typeof onError === "function", typeof onError);
    try {
        // reset errCaught
        local._debugTryCatchError = null;
        result = fnc();
        local._debugTryCatchError = null;
        return result;
    } catch (errCaught) {
        // debug errCaught
        local._debugTryCatchError = errCaught;
        return onError(errCaught);
    }
};

local.uiAnimateShake = function (elem, onError) {
/*
 * this function will shake dom-<elem>
 */
    if (!elem || elem.classList.contains("uiAnimateShake")) {
        local.setTimeoutOnError(onError);
        return;
    }
    elem.classList.add("uiAnimateShake");
    setTimeout(function () {
        elem.classList.remove("uiAnimateShake");
        local.setTimeoutOnError(onError);
    }, 500);
};

local.uiAnimateShakeIfError = function (err, elem, onError) {
/*
 * this function will shake dom-<elem> if <err> occurred
 */
    var hasError;
    if (!elem) {
        local.setTimeoutOnError(onError);
        return;
    }
    hasError = elem.classList.contains("hasError");
    if (err && !hasError) {
        elem.classList.add("hasError");
        local.uiAnimateShake(elem, onError);
        return;
    }
    if (!err && hasError) {
        elem.classList.remove("hasError");
    }
    local.setTimeoutOnError(onError);
};

local.uiAnimateSlideAccordian = function (elem, elemList, onError) {
/*
 * this function will slideDown <elem>, but slideUp elements in <elemList>
 */
    elemList.forEach(function (elem2) {
        if (elem2 !== elem) {
            local.uiAnimateSlideUp(elem2);
        }
    });
    setTimeout(function () {
        local.uiAnimateSlideDown(elem, onError);
    }, 250);
};

local.uiAnimateSlideDown = function (elem, onError) {
/*
 * this function will slideDown dom-<elem>
 */
    onError = onError || local.nop;
    if (!(
        elem
        && elem.style && elem.style.maxHeight !== "100%"
        && elem.classList && elem.classList.contains("uiAnimateSlide")
    )) {
        onError();
        return;
    }
    elem.style.borderBottom = "";
    elem.style.borderTop = "";
    elem.style.marginBottom = "";
    elem.style.marginTop = "";
    elem.style.maxHeight = 1.5 * globalThis.innerHeight + "px";
    elem.style.paddingBottom = "";
    elem.style.paddingTop = "";
    setTimeout(function () {
        elem.style.maxHeight = "100%";
        onError();
    }, 250);
};

local.uiAnimateSlideUp = function (elem, onError) {
/*
 * this function will slideUp dom-<elem>
 */
    if (!(
        elem
        && elem.style && elem.style.maxHeight !== "0px"
        && elem.classList && elem.classList.contains("uiAnimateSlide")
    )) {
        local.setTimeoutOnError(onError);
        return;
    }
    elem.style.borderBottom = "0";
    elem.style.borderTop = "0";
    elem.style.marginBottom = "0";
    elem.style.marginTop = "0";
    elem.style.maxHeight = "0";
    elem.style.paddingBottom = "0";
    elem.style.paddingTop = "0";
    local.setTimeoutOnError(onError, 250);
};

local.urlJoin = function (aa, bb) {
/*
 * this function will if bb is relative, url-join aa with bb
 */
    // bb is absolute-url
    if ((
        /^\w+?:\/\//
    ).test(bb)) {
        return bb;
    }
    // bb is absolute-url without protocol
    if (bb.slice(0, 2) === "//") {
        return aa.split("/")[0] + bb;
    }
    // bb is absolute-url without host
    if (bb[0] === "/") {
        return aa.split("/").slice(0, 3).join("/") + bb;
    }
    // bb is relative-url
    if (aa.split("/").length < 4) {
        aa += "/";
    }
    return aa.replace((
        /[?#].*?$/
    ), "").replace((
        /[^\/]*?$/
    ), "") + bb;
};

local.urlParse = function (url) {
/*
 * this function will parse <url> according to below spec, plus a query param
 * https://developer.mozilla.org/en-US/docs/Web/API/URL
 */
    var urlParsed;
    urlParsed = {};
    // try to parse url
    local.tryCatchOnError(function () {
        // resolve host-less url
        if (local.isBrowser) {
            local.serverLocalHost = (
                local.serverLocalHost
                || location.protocol + "//" + location.host
            );
            // resolve absolute path
            if (url[0] === "/") {
                url = local.serverLocalHost + url;
            // resolve relative path
            } else if (!(
                /^\w+?:\/\//
            ).test(url)) {
                url = (
                    local.serverLocalHost
                    + location.pathname.replace((
                        /\/[^\/]*?$/
                    ), "") + "/" + url
                );
            }
            urlParsed = new globalThis.URL(url);
            urlParsed.path = "/" + urlParsed.href
            .split("/")
            .slice(3)
            .join("/")
            .split("#")[0];
        } else {
            local.env.PORT = local.env.PORT || "8081";
            local.serverLocalHost = (
                local.serverLocalHost
                || ("http://127.0.0.1:" + local.env.PORT)
            );
            // resolve absolute path
            if (url[0] === "/") {
                url = local.serverLocalHost + url;
            // resolve relative path
            } else if (!(
                /^\w+?:\/\//
            ).test(url)) {
                url = local.serverLocalHost + "/" + url;
            }
            urlParsed = local.url.parse(url);
        }
        // init query
        urlParsed.query = {};
        (urlParsed.search || "").slice(1).replace((
            /[^&]+/g
        ), function (item) {
            item = item.split("=");
            item[0] = decodeURIComponent(item[0]);
            item[1] = decodeURIComponent(item.slice(1).join("="));
            // parse repeating query-param as an array
            if (urlParsed.query[item[0]]) {
                if (!Array.isArray(urlParsed.query[item[0]])) {
                    urlParsed.query[item[0]] = [
                        urlParsed.query[item[0]]
                    ];
                }
                urlParsed.query[item[0]].push(item[1]);
            } else {
                urlParsed.query[item[0]] = item[1];
            }
        });
        urlParsed.basename = urlParsed.pathname.replace((
            /^.*\//
        ), "");
    }, local.nop);
    // https://developer.mozilla.org/en/docs/Web/API/URL#Properties
    return {
        basename: urlParsed.basename || "",
        hash: urlParsed.hash || "",
        host: urlParsed.host || "",
        hostname: urlParsed.hostname || "",
        href: urlParsed.href || "",
        path: urlParsed.path || "",
        pathname: urlParsed.pathname || "",
        port: urlParsed.port || "",
        protocol: urlParsed.protocol || "",
        query: urlParsed.query || {},
        search: urlParsed.search || ""
    };
};

local.uuid4Create = function () {
/*
 * this function will create a random uuid,
 * with format 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'
 */
    // code derived from http://jsperf.com/uuid4
    var id;
    var ii;
    id = "";
    ii = 0;
    while (ii < 32) {
        switch (ii) {
        case 8:
        case 20:
            id += "-";
            // coerce to finite integer
            id += ((Math.random() * 16) | 0).toString(16);
            break;
        case 12:
            id += "-";
            id += "4";
            break;
        case 16:
            id += "-";
            id += ((Math.random() * 4) | 8).toString(16);
            break;
        default:
            // coerce to finite integer
            id += ((Math.random() * 16) | 0).toString(16);
        }
        ii += 1;
    }
    return id;
};
}());



// run shared js-env code - init-after
(function () {
local.apidocCreate = local.apidoc.apidocCreate;
local.browserTest({
modeTestReportCreate: true
});
local.cacheDict = {};
local.contentTypeDict = {
    // application
    ".js": "application/javascript; charset=utf-8",
    ".json": "application/json; charset=utf-8",
    ".pdf": "application/pdf",
    ".xml": "application/xml; charset=utf-8",
    // image
    ".bmp": "image/bmp",
    ".gif": "image/gif",
    ".jpeg": "image/jpeg",
    ".jpg": "image/jpeg",
    ".png": "image/png",
    ".svg": "image/svg+xml; charset=utf-8",
    // text
    ".css": "text/css; charset=utf-8",
    ".htm": "text/html; charset=utf-8",
    ".html": "text/html; charset=utf-8",
    ".md": "text/markdown; charset=utf-8",
    ".txt": "text/plain; charset=utf-8"
};
// init env
local.env = (
    local.isBrowser
    ? {}
    : process.env
);
local.objectSetDefault(local.env, {
    npm_package_nameLib: (local.env.npm_package_name || "").replace((
        /\W/g
    ), "_")
});
local.objectSetDefault(local.env, {
    npm_package_description: "the greatest app in the world!",
    npm_package_name: "my-app-lite",
    npm_package_nameLib: "my_app",
    npm_package_version: "0.0.1"
});
local.errDefault = new Error("default-error");
globalThis.utility2_onReadyAfter = (
    globalThis.utility2_onReadyAfter || function (onError) {
    /*
     * this function will call onError when utility2_onReadyBefore.counter === 0
     */
        globalThis.utility2_onReadyBefore.counter += 1;
        local.taskCreate({
            key: "globalThis.utility2_onReadyAfter"
        }, null, onError);
        setTimeout(globalThis.utility2_onReadyBefore);
        return onError;
    }
);
globalThis.utility2_onReadyBefore = (
    globalThis.utility2_onReadyBefore
    || local.onParallel(function (err) {
    /*
     * this function will keep track of utility2_onReadyBefore.counter
     */
        local.taskCreate({
            key: "globalThis.utility2_onReadyAfter"
        }, function (onError) {
            onError(err);
        }, local.onErrorThrow);
    })
);
local.istanbulCoverageMerge = local.istanbul.coverageMerge || local.identity;
// cbranch-no cstat-no fstat-no missing-if-branch
local.istanbulCoverageReportCreate = (
    local.istanbul.coverageReportCreate || local.identity
);
local.istanbulInstrumentInPackage = (
    local.istanbul.instrumentInPackage || local.identity
);
local.istanbulInstrumentSync = local.istanbul.instrumentSync || local.identity;
local.jslintAndPrint = local.jslint.jslintAndPrint || local.identity;
local.regexpCharsetEncodeUri = (
    /\w!#\$%&'\(\)\*\+,\-\.\/:;=\?@~/
);
local.regexpCharsetEncodeUriComponent = (
    /\w!%'\(\)\*\-\.~/
);
// https://github.com/chjj/marked/blob/v0.3.7/lib/marked.js#L499
local.regexpMatchUrl = (
    /\bhttps?:\/\/[^\s<]+[^<.,:;"')\]\s]/
);
// https://www.w3.org/TR/html5/sec-forms.html#email-state-typeemail
local.regexpValidateEmail = (
    /^[a-zA-Z0-9.!#$%&'*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?)*$/
);
// https://en.wikipedia.org/wiki/E.164
local.regexpValidatePhone = (
    /^(?:\+\d{1,3}[\u0020\-]?)?(?:\(\d{1,4}\)[\u0020\-]?)?\d[\d\u0020\-]{7,17}$/
);
local.regexpValidateUuid = (
    /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/
);
local.stringCharsetAscii = (
    "\u0000\u0001\u0002\u0003\u0004\u0005\u0006\u0007"
    + "\b\t\n\u000b\f\r\u000e\u000f"
    + "\u0010\u0011\u0012\u0013\u0014\u0015\u0016\u0017"
    + "\u0018\u0019\u001a\u001b\u001c\u001d\u001e\u001f"
    + " !\"#$%&'()*+,-./0123456789:;<=>?"
    + "@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_"
    + "`abcdefghijklmnopqrstuvwxyz{|}~\u007f"
);
local.stringCharsetEncodeUri = (
    "!#$%&'()*+,-./"
    + "0123456789:;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"
);
local.stringCharsetEncodeUriComponent = (
    "!%'()*-."
    + "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"
);
local.stringHelloEmoji = "hello \ud83d\ude01\n";
// mock swgg
local.swgg = local.swgg || {
    apiUpdate: local.nop,
    normalizeSwaggerJson: local.nop,
    swaggerValidate: local.nop
};
local.taskOnTaskDict = {};
// init serverLocalHost
local.urlParse("");
// init timeoutDefault
if (local.isBrowser) {
    location.search.replace((
        /\b(NODE_ENV|mode[A-Z]\w+|timeExit|timeoutDefault)=([^&#]+)/g
    ), function (match0, key, value) {
        local[key] = decodeURIComponent(value);
        local.env[key] = local[key];
        // try to JSON.parse the string
        local.tryCatchOnError(function () {
            local[key] = JSON.parse(match0);
        }, local.nop);
    });
} else {
    local.timeoutDefault = local.env.npm_config_timeout_default;
}
// init timeExit
local.timeExit = (
    Number(local.env.npm_config_time_exit) || local.timeExit
    || Number(Date.now() + Number(local.env.npm_config_timeout_exit))
);
if (local.timeExit) {
    local.timeoutDefault = local.timeExit - Date.now();
    setTimeout(local.exit, local.timeoutDefault);
}
// re-init timeoutDefault
local.timeoutDefault = Number(local.timeoutDefault) || 30000;
globalThis.utility2_onReadyAfter(local.nop);
}());



// run browser js-env code - init-after
(function () {
if (!local.isBrowser) {
    return;
}
// require modules
local.http = local._http;
local.https = local._http;
}());



/* istanbul ignore next */
// run node js-env code - init-after
(function () {
if (local.isBrowser) {
    return;
}
local.Module = require("module");
// init env
local.objectAssignDefault(local.env, {
    npm_config_dir_build: process.cwd() + "/tmp/build",
    npm_config_dir_tmp: process.cwd() + "/tmp"
});
// merge previous test-report
if (local.env.npm_config_file_test_report_merge) {
    local.testReportMerge(
        globalThis.utility2_testReport,
        local.fsReadFileOrEmptyStringSync(
            local.env.npm_config_file_test_report_merge,
            "json"
        )
    );
    if (process.argv[2] !== "--help") {
        console.error(
            "\n" + local.env.MODE_BUILD + " - merged test-report from file "
            + local.env.npm_config_file_test_report_merge
        );
    }
}
// init cli
if (module === require.main && (!globalThis.utility2_rollup || (
    process.argv[2]
    && local.cliDict[process.argv[2]]
    && process.argv[2].indexOf("utility2.") === 0
))) {
    local.cliRun({}, local.nop);
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        switch (process.argv[2]) {
        case "--interactive":
        case "-i":
        case "utility2.swaggerValidateFile":
        case "utility2.start":
            break;
        default:
            return;
        }
    }
}
/* validateLineSortedReset */
// override assets
[
    "/assets.index.template.html",
    "/assets.swgg.swagger.json",
    "/assets.swgg.swagger.server.json"
].forEach(function (file) {
    local.assetsDict[file] = local.assetsDict[file] || "";
    if (process.argv[2] !== "--help" && local.fs.existsSync(__dirname + file)) {
        console.error("override assets " + __dirname + file);
        local.assetsDict[file] = local.fs.readFileSync(
            __dirname + file,
            "utf8"
        );
    }
});
if (globalThis.utility2_rollup) {
    local.assetsDict["/assets.utility2.rollup.js"] = (
        local.fs.readFileSync(
            __filename,
            "utf8"
        ).split("\n/* script-end /assets.utility2.rollup.end.js */")[0]
        + "\n/* script-end /assets.utility2.rollup.end.js */\n"
    );
    return;
}
// init assets
[
    "/assets.utility2.example.js",
    "/assets.utility2.html",
    "/assets.utility2.test.js",
    "lib.apidoc.js",
    "lib.db.js",
    "lib.github_crud.js",
    "lib.istanbul.js",
    "lib.jslint.js",
    "lib.marked.js",
    "lib.sjcl.js",
    "lib.swgg.js",
    "lib.utility2.js",
    "test.js"
].forEach(function (key) {
    switch (key) {
    case "/assets.utility2.example.js":
        local.assetsDict[key] = "";
        local.tryCatchOnError(function () {
            local.fs.readFileSync(
                __dirname + "/README.md",
                "utf8"
            ).replace((
                /```javascript([\S\s]*?)```/
            ), function (ignore, match1) {
                local.assetsDict[key] = match1.trim() + "\n";
            });
        }, local.nop);
        break;
    case "/assets.utility2.html":
        local.assetsDict[key] = "";
        local.tryCatchOnError(function () {
            local.fs.readFileSync(__dirname + "/README.md", "utf8").replace((
                /<!doctype\u0020html>[\S\s]*?<\/html>\\n\\\n/
            ), function (match0) {
                local.assetsDict[key] = (
                    local.templateRender(match0
                    .replace((
                        /\\n\\$/gm
                    ), "")
                    .replace(
                        "<script src=\"assets.app.js\"></script>\n",
                        (
                            "<script "
                            + "src=\"assets.utility2.rollup.js\"></script>\n"
                            + "<script "
                            + "src=\"assets.utility2.example.js\"></script>\n"
                            + "<script "
                            + "src=\"assets.utility2.test.js\"></script>\n"
                        )
                    )
                    .replace("assets.example.js", "assets.utility2.example.js")
                    .replace("assets.test.js", "assets.utility2.test.js")
                    .replace((
                        /npm_package_/g
                    ), "")
                    // uncomment utility2-comment
                    .replace((
                        /<!--\u0020utility2-comment\b([\S\s]*?)\butility2-comment\u0020-->/g
                    ), "$1"), {
                        env: local.objectSetDefault({
                            version: "0.0.1"
                        }, require(__dirname + "/package.json")),
                        isRollup: true
                    })
                );
            });
        }, local.nop);
        break;
    case "/assets.utility2.test.js":
        local.assetsDict[key] = local.fsReadFileOrEmptyStringSync(
            __dirname + "/test.js",
            "utf8"
        );
        break;
    case "lib.swgg.js":
    case "lib.utility2.js":
        key = key.replace("lib.", "");
        local.assetsDict["/assets." + key] = local.fsReadFileOrEmptyStringSync(
            __dirname + "/lib." + key,
            "utf8"
        ).replace((
            /^#!\//
        ), "// ");
        break;
    default:
        local.assetsDict["/assets.utility2." + key] = (
            local.fsReadFileOrEmptyStringSync(
                __dirname + "/" + key,
                "utf8"
            ).replace((
                /^#!\//
            ), "// ")
        );
    }
});
local.assetsDict["/assets.utility2.rollup.js"] = [
    "header",
    "/assets.utility2.rollup.begin.js",
    "lib.apidoc.js",
    "lib.db.js",
    "lib.github_crud.js",
    "lib.istanbul.js",
    "lib.jslint.js",
    "lib.marked.js",
    "lib.sjcl.js",
    "lib.utility2.js",
    "lib.swgg.js",
    "/assets.utility2.example.js",
    "/assets.utility2.html",
    "/assets.utility2.test.js",
    "/assets.utility2.rollup.end.js"
].map(function (key) {
    var script;
    switch (key) {
    case "/assets.utility2.example.js":
    case "/assets.utility2.html":
    case "/assets.utility2.test.js":
        // handle large string-replace
        script = local.assetsDict["/assets.utility2.rollup.content.js"]
        .split("/* utility2.rollup.js content */");
        script.splice(1, 0, (
            "local.assetsDict[\"" + key + "\"] = "
            + JSON.stringify(local.assetsDict[key])
        ).replace((
            /\\\\/g
        ), "\u0000").replace((
            /\\n/g
        ), "\\n\\\n").replace((
            /\u0000/g
        ), "\\\\"));
        script = script.join("");
        script += "\n";
        break;
    case "/assets.utility2.rollup.begin.js":
    case "/assets.utility2.rollup.end.js":
        script = local.assetsDict[key];
        break;
    case "header":
        return (
            "/* this rollup was created with utility2\n"
            + " * https://github.com/kaizhu256/node-utility2\n"
            + " */\n"
        );
    case "lib.swgg.js":
    case "lib.utility2.js":
        key = "/assets." + key.replace("lib.", "");
        script = local.assetsDict[key];
        break;
    default:
        key = "/assets.utility2." + key;
        script = local.assetsDict[key];
    }
    return (
        "/* script-begin " + key + " */\n"
        + script.trim()
        + "\n/* script-end " + key + " */\n"
    );
}).join("\n\n\n");
// init lib dependents
[
    "swgg"
].forEach(function (lib) {
    var file;
    file = __dirname + "/lib." + lib + ".js";
    if (local.fs.existsSync(file)) {
        local[lib] = require(file);
    }
});
}());



}());
/* script-end /assets.utility2.js */



/* script-begin /assets.swgg.js */
// usr/bin/env node
/*
 * lib.swgg.js (2019.8.1)
 * https://github.com/kaizhu256/node-swgg
 * this zero-dependency package will run a virtual swagger-ui server with persistent-storage in the browser, that your webapp can use (in-place of a real backend), with a working web-demo
 *
 */



/* istanbul instrument in package swgg */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_swgg = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.swgg = local;



/* validateLineSortedReset */
// init lib utility2
local.utility2 = globalThis.utility2_rollup || (
    local.isBrowser
    ? globalThis.utility2
    : (function () {
        try {
            return require("./lib.utility2.js");
        } catch (ignore) {
            return require("./assets.utility2.rollup.js");
        }
    }())
);
local.utility2.objectSetDefault(local, local.utility2);
// init lib swgg
globalThis.swgg = local;
local.utility2.swgg = local;
/* validateLineSortedReset */
// init assets and templates
// https://github.com/json-schema-org/json-schema-org.github.io/blob/eb4805e94c3e27932352344767d19cc4c3c3381c/draft-04/schema
/* jslint ignore:start */
// curl -Ls https://raw.githubusercontent.com/json-schema-org/json-schema-org.github.io/eb4805e94c3e27932352344767d19cc4c3c3381c/draft-04/schema > /tmp/aa.json; node -e "console.log(JSON.stringify(require('/tmp/aa.json')));"
local.assetsDict["/assets.swgg.json-schema.json"] = JSON.stringify(
{"id":"http://json-schema.org/draft-04/schema#","$schema":"http://json-schema.org/draft-04/schema#","description":"Core schema meta-schema","definitions":{"schemaArray":{"type":"array","minItems":1,"items":{"$ref":"#"}},"positiveInteger":{"type":"integer","minimum":0},"positiveIntegerDefault0":{"allOf":[{"$ref":"#/definitions/positiveInteger"},{"default":0}]},"simpleTypes":{"enum":["array","boolean","integer","null","number","object","string"]},"stringArray":{"type":"array","items":{"type":"string"},"minItems":1,"uniqueItems":true}},"type":"object","properties":{"id":{"type":"string","format":"uri"},"$schema":{"type":"string","format":"uri"},"title":{"type":"string"},"description":{"type":"string"},"default":{},"multipleOf":{"type":"number","minimum":0,"exclusiveMinimum":true},"maximum":{"type":"number"},"exclusiveMaximum":{"type":"boolean","default":false},"minimum":{"type":"number"},"exclusiveMinimum":{"type":"boolean","default":false},"maxLength":{"$ref":"#/definitions/positiveInteger"},"minLength":{"$ref":"#/definitions/positiveIntegerDefault0"},"pattern":{"type":"string","format":"regex"},"additionalItems":{"anyOf":[{"type":"boolean"},{"$ref":"#"}],"default":{}},"items":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/schemaArray"}],"default":{}},"maxItems":{"$ref":"#/definitions/positiveInteger"},"minItems":{"$ref":"#/definitions/positiveIntegerDefault0"},"uniqueItems":{"type":"boolean","default":false},"maxProperties":{"$ref":"#/definitions/positiveInteger"},"minProperties":{"$ref":"#/definitions/positiveIntegerDefault0"},"required":{"$ref":"#/definitions/stringArray"},"additionalProperties":{"anyOf":[{"type":"boolean"},{"$ref":"#"}],"default":{}},"definitions":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"properties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"patternProperties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"dependencies":{"type":"object","additionalProperties":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/stringArray"}]}},"enum":{"type":"array","minItems":1,"uniqueItems":true},"type":{"anyOf":[{"$ref":"#/definitions/simpleTypes"},{"type":"array","items":{"$ref":"#/definitions/simpleTypes"},"minItems":1,"uniqueItems":true}]},"allOf":{"$ref":"#/definitions/schemaArray"},"anyOf":{"$ref":"#/definitions/schemaArray"},"oneOf":{"$ref":"#/definitions/schemaArray"},"not":{"$ref":"#"}},"dependencies":{"exclusiveMaximum":["maximum"],"exclusiveMinimum":["minimum"]},"default":{}}
);



// https://github.com/OAI/OpenAPI-Specification/blob/3.0.0/schemas/v2.0/schema.json
// curl -Ls https://raw.githubusercontent.com/OAI/OpenAPI-Specification/3.0.0/schemas/v2.0/schema.json > /tmp/aa.json; node -e "console.log(JSON.stringify(require('/tmp/aa.json')));"
local.assetsDict["/assets.swgg.schema.json"] = JSON.stringify(
{"title":"A JSON Schema for Swagger 2.0 API.","id":"http://swagger.io/v2/schema.json#","$schema":"http://json-schema.org/draft-04/schema#","type":"object","required":["swagger","info","paths"],"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"swagger":{"type":"string","enum":["2.0"],"description":"The Swagger version of this document."},"info":{"$ref":"#/definitions/info"},"host":{"type":"string","pattern":"^[^{}/ :\\\\]+(?::\\d+)?$","description":"The host (name or ip) of the API. Example: 'swagger.io'"},"basePath":{"type":"string","pattern":"^/","description":"The base path to the API. Example: '/api'."},"schemes":{"$ref":"#/definitions/schemesList"},"consumes":{"description":"A list of MIME types accepted by the API.","allOf":[{"$ref":"#/definitions/mediaTypeList"}]},"produces":{"description":"A list of MIME types the API can produce.","allOf":[{"$ref":"#/definitions/mediaTypeList"}]},"paths":{"$ref":"#/definitions/paths"},"definitions":{"$ref":"#/definitions/definitions"},"parameters":{"$ref":"#/definitions/parameterDefinitions"},"responses":{"$ref":"#/definitions/responseDefinitions"},"security":{"$ref":"#/definitions/security"},"securityDefinitions":{"$ref":"#/definitions/securityDefinitions"},"tags":{"type":"array","items":{"$ref":"#/definitions/tag"},"uniqueItems":true},"externalDocs":{"$ref":"#/definitions/externalDocs"}},"definitions":{"info":{"type":"object","description":"General information about the API.","required":["version","title"],"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"title":{"type":"string","description":"A unique and precise title of the API."},"version":{"type":"string","description":"A semantic version number of the API."},"description":{"type":"string","description":"A longer description of the API. Should be different from the title.  GitHub Flavored Markdown is allowed."},"termsOfService":{"type":"string","description":"The terms of service for the API."},"contact":{"$ref":"#/definitions/contact"},"license":{"$ref":"#/definitions/license"}}},"contact":{"type":"object","description":"Contact information for the owners of the API.","additionalProperties":false,"properties":{"name":{"type":"string","description":"The identifying name of the contact person/organization."},"url":{"type":"string","description":"The URL pointing to the contact information.","format":"uri"},"email":{"type":"string","description":"The email address of the contact person/organization.","format":"email"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"license":{"type":"object","required":["name"],"additionalProperties":false,"properties":{"name":{"type":"string","description":"The name of the license type. It's encouraged to use an OSI compatible license."},"url":{"type":"string","description":"The URL pointing to the license.","format":"uri"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"paths":{"type":"object","description":"Relative paths to the individual endpoints. They must be relative to the 'basePath'.","patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"},"^/":{"$ref":"#/definitions/pathItem"}},"additionalProperties":false},"definitions":{"type":"object","additionalProperties":{"$ref":"#/definitions/schema"},"description":"One or more JSON objects describing the schemas being consumed and produced by the API."},"parameterDefinitions":{"type":"object","additionalProperties":{"$ref":"#/definitions/parameter"},"description":"One or more JSON representations for parameters"},"responseDefinitions":{"type":"object","additionalProperties":{"$ref":"#/definitions/response"},"description":"One or more JSON representations for parameters"},"externalDocs":{"type":"object","additionalProperties":false,"description":"information about external documentation","required":["url"],"properties":{"description":{"type":"string"},"url":{"type":"string","format":"uri"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"examples":{"type":"object","additionalProperties":true},"mimeType":{"type":"string","description":"The MIME type of the HTTP message."},"operation":{"type":"object","required":["responses"],"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"tags":{"type":"array","items":{"type":"string"},"uniqueItems":true},"summary":{"type":"string","description":"A brief summary of the operation."},"description":{"type":"string","description":"A longer description of the operation, GitHub Flavored Markdown is allowed."},"externalDocs":{"$ref":"#/definitions/externalDocs"},"operationId":{"type":"string","description":"A unique identifier of the operation."},"produces":{"description":"A list of MIME types the API can produce.","allOf":[{"$ref":"#/definitions/mediaTypeList"}]},"consumes":{"description":"A list of MIME types the API can consume.","allOf":[{"$ref":"#/definitions/mediaTypeList"}]},"parameters":{"$ref":"#/definitions/parametersList"},"responses":{"$ref":"#/definitions/responses"},"schemes":{"$ref":"#/definitions/schemesList"},"deprecated":{"type":"boolean","default":false},"security":{"$ref":"#/definitions/security"}}},"pathItem":{"type":"object","additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"$ref":{"type":"string"},"get":{"$ref":"#/definitions/operation"},"put":{"$ref":"#/definitions/operation"},"post":{"$ref":"#/definitions/operation"},"delete":{"$ref":"#/definitions/operation"},"options":{"$ref":"#/definitions/operation"},"head":{"$ref":"#/definitions/operation"},"patch":{"$ref":"#/definitions/operation"},"parameters":{"$ref":"#/definitions/parametersList"}}},"responses":{"type":"object","description":"Response objects names can either be any valid HTTP status code or 'default'.","minProperties":1,"additionalProperties":false,"patternProperties":{"^([0-9]{3})$|^(default)$":{"$ref":"#/definitions/responseValue"},"^x-":{"$ref":"#/definitions/vendorExtension"}},"not":{"type":"object","additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}}},"responseValue":{"oneOf":[{"$ref":"#/definitions/response"},{"$ref":"#/definitions/jsonReference"}]},"response":{"type":"object","required":["description"],"properties":{"description":{"type":"string"},"schema":{"oneOf":[{"$ref":"#/definitions/schema"},{"$ref":"#/definitions/fileSchema"}]},"headers":{"$ref":"#/definitions/headers"},"examples":{"$ref":"#/definitions/examples"}},"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"headers":{"type":"object","additionalProperties":{"$ref":"#/definitions/header"}},"header":{"type":"object","additionalProperties":false,"required":["type"],"properties":{"type":{"type":"string","enum":["string","number","integer","boolean","array"]},"format":{"type":"string"},"items":{"$ref":"#/definitions/primitivesItems"},"collectionFormat":{"$ref":"#/definitions/collectionFormat"},"default":{"$ref":"#/definitions/default"},"maximum":{"$ref":"#/definitions/maximum"},"exclusiveMaximum":{"$ref":"#/definitions/exclusiveMaximum"},"minimum":{"$ref":"#/definitions/minimum"},"exclusiveMinimum":{"$ref":"#/definitions/exclusiveMinimum"},"maxLength":{"$ref":"#/definitions/maxLength"},"minLength":{"$ref":"#/definitions/minLength"},"pattern":{"$ref":"#/definitions/pattern"},"maxItems":{"$ref":"#/definitions/maxItems"},"minItems":{"$ref":"#/definitions/minItems"},"uniqueItems":{"$ref":"#/definitions/uniqueItems"},"enum":{"$ref":"#/definitions/enum"},"multipleOf":{"$ref":"#/definitions/multipleOf"},"description":{"type":"string"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"vendorExtension":{"description":"Any property starting with x- is valid.","additionalProperties":true,"additionalItems":true},"bodyParameter":{"type":"object","required":["name","in","schema"],"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"description":{"type":"string","description":"A brief description of the parameter. This could contain examples of use.  GitHub Flavored Markdown is allowed."},"name":{"type":"string","description":"The name of the parameter."},"in":{"type":"string","description":"Determines the location of the parameter.","enum":["body"]},"required":{"type":"boolean","description":"Determines whether or not this parameter is required or optional.","default":false},"schema":{"$ref":"#/definitions/schema"}},"additionalProperties":false},"headerParameterSubSchema":{"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"required":{"type":"boolean","description":"Determines whether or not this parameter is required or optional.","default":false},"in":{"type":"string","description":"Determines the location of the parameter.","enum":["header"]},"description":{"type":"string","description":"A brief description of the parameter. This could contain examples of use.  GitHub Flavored Markdown is allowed."},"name":{"type":"string","description":"The name of the parameter."},"type":{"type":"string","enum":["string","number","boolean","integer","array"]},"format":{"type":"string"},"items":{"$ref":"#/definitions/primitivesItems"},"collectionFormat":{"$ref":"#/definitions/collectionFormat"},"default":{"$ref":"#/definitions/default"},"maximum":{"$ref":"#/definitions/maximum"},"exclusiveMaximum":{"$ref":"#/definitions/exclusiveMaximum"},"minimum":{"$ref":"#/definitions/minimum"},"exclusiveMinimum":{"$ref":"#/definitions/exclusiveMinimum"},"maxLength":{"$ref":"#/definitions/maxLength"},"minLength":{"$ref":"#/definitions/minLength"},"pattern":{"$ref":"#/definitions/pattern"},"maxItems":{"$ref":"#/definitions/maxItems"},"minItems":{"$ref":"#/definitions/minItems"},"uniqueItems":{"$ref":"#/definitions/uniqueItems"},"enum":{"$ref":"#/definitions/enum"},"multipleOf":{"$ref":"#/definitions/multipleOf"}}},"queryParameterSubSchema":{"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"required":{"type":"boolean","description":"Determines whether or not this parameter is required or optional.","default":false},"in":{"type":"string","description":"Determines the location of the parameter.","enum":["query"]},"description":{"type":"string","description":"A brief description of the parameter. This could contain examples of use.  GitHub Flavored Markdown is allowed."},"name":{"type":"string","description":"The name of the parameter."},"allowEmptyValue":{"type":"boolean","default":false,"description":"allows sending a parameter by name only or with an empty value."},"type":{"type":"string","enum":["string","number","boolean","integer","array"]},"format":{"type":"string"},"items":{"$ref":"#/definitions/primitivesItems"},"collectionFormat":{"$ref":"#/definitions/collectionFormatWithMulti"},"default":{"$ref":"#/definitions/default"},"maximum":{"$ref":"#/definitions/maximum"},"exclusiveMaximum":{"$ref":"#/definitions/exclusiveMaximum"},"minimum":{"$ref":"#/definitions/minimum"},"exclusiveMinimum":{"$ref":"#/definitions/exclusiveMinimum"},"maxLength":{"$ref":"#/definitions/maxLength"},"minLength":{"$ref":"#/definitions/minLength"},"pattern":{"$ref":"#/definitions/pattern"},"maxItems":{"$ref":"#/definitions/maxItems"},"minItems":{"$ref":"#/definitions/minItems"},"uniqueItems":{"$ref":"#/definitions/uniqueItems"},"enum":{"$ref":"#/definitions/enum"},"multipleOf":{"$ref":"#/definitions/multipleOf"}}},"formDataParameterSubSchema":{"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"required":{"type":"boolean","description":"Determines whether or not this parameter is required or optional.","default":false},"in":{"type":"string","description":"Determines the location of the parameter.","enum":["formData"]},"description":{"type":"string","description":"A brief description of the parameter. This could contain examples of use.  GitHub Flavored Markdown is allowed."},"name":{"type":"string","description":"The name of the parameter."},"allowEmptyValue":{"type":"boolean","default":false,"description":"allows sending a parameter by name only or with an empty value."},"type":{"type":"string","enum":["string","number","boolean","integer","array","file"]},"format":{"type":"string"},"items":{"$ref":"#/definitions/primitivesItems"},"collectionFormat":{"$ref":"#/definitions/collectionFormatWithMulti"},"default":{"$ref":"#/definitions/default"},"maximum":{"$ref":"#/definitions/maximum"},"exclusiveMaximum":{"$ref":"#/definitions/exclusiveMaximum"},"minimum":{"$ref":"#/definitions/minimum"},"exclusiveMinimum":{"$ref":"#/definitions/exclusiveMinimum"},"maxLength":{"$ref":"#/definitions/maxLength"},"minLength":{"$ref":"#/definitions/minLength"},"pattern":{"$ref":"#/definitions/pattern"},"maxItems":{"$ref":"#/definitions/maxItems"},"minItems":{"$ref":"#/definitions/minItems"},"uniqueItems":{"$ref":"#/definitions/uniqueItems"},"enum":{"$ref":"#/definitions/enum"},"multipleOf":{"$ref":"#/definitions/multipleOf"}}},"pathParameterSubSchema":{"additionalProperties":false,"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"required":["required"],"properties":{"required":{"type":"boolean","enum":[true],"description":"Determines whether or not this parameter is required or optional."},"in":{"type":"string","description":"Determines the location of the parameter.","enum":["path"]},"description":{"type":"string","description":"A brief description of the parameter. This could contain examples of use.  GitHub Flavored Markdown is allowed."},"name":{"type":"string","description":"The name of the parameter."},"type":{"type":"string","enum":["string","number","boolean","integer","array"]},"format":{"type":"string"},"items":{"$ref":"#/definitions/primitivesItems"},"collectionFormat":{"$ref":"#/definitions/collectionFormat"},"default":{"$ref":"#/definitions/default"},"maximum":{"$ref":"#/definitions/maximum"},"exclusiveMaximum":{"$ref":"#/definitions/exclusiveMaximum"},"minimum":{"$ref":"#/definitions/minimum"},"exclusiveMinimum":{"$ref":"#/definitions/exclusiveMinimum"},"maxLength":{"$ref":"#/definitions/maxLength"},"minLength":{"$ref":"#/definitions/minLength"},"pattern":{"$ref":"#/definitions/pattern"},"maxItems":{"$ref":"#/definitions/maxItems"},"minItems":{"$ref":"#/definitions/minItems"},"uniqueItems":{"$ref":"#/definitions/uniqueItems"},"enum":{"$ref":"#/definitions/enum"},"multipleOf":{"$ref":"#/definitions/multipleOf"}}},"nonBodyParameter":{"type":"object","required":["name","in","type"],"oneOf":[{"$ref":"#/definitions/headerParameterSubSchema"},{"$ref":"#/definitions/formDataParameterSubSchema"},{"$ref":"#/definitions/queryParameterSubSchema"},{"$ref":"#/definitions/pathParameterSubSchema"}]},"parameter":{"oneOf":[{"$ref":"#/definitions/bodyParameter"},{"$ref":"#/definitions/nonBodyParameter"}]},"schema":{"type":"object","description":"A deterministic version of a JSON Schema object.","patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"properties":{"$ref":{"type":"string"},"format":{"type":"string"},"title":{"$ref":"http://json-schema.org/draft-04/schema#/properties/title"},"description":{"$ref":"http://json-schema.org/draft-04/schema#/properties/description"},"default":{"$ref":"http://json-schema.org/draft-04/schema#/properties/default"},"multipleOf":{"$ref":"http://json-schema.org/draft-04/schema#/properties/multipleOf"},"maximum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/maximum"},"exclusiveMaximum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/exclusiveMaximum"},"minimum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/minimum"},"exclusiveMinimum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/exclusiveMinimum"},"maxLength":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveInteger"},"minLength":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveIntegerDefault0"},"pattern":{"$ref":"http://json-schema.org/draft-04/schema#/properties/pattern"},"maxItems":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveInteger"},"minItems":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveIntegerDefault0"},"uniqueItems":{"$ref":"http://json-schema.org/draft-04/schema#/properties/uniqueItems"},"maxProperties":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveInteger"},"minProperties":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveIntegerDefault0"},"required":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/stringArray"},"enum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/enum"},"additionalProperties":{"anyOf":[{"$ref":"#/definitions/schema"},{"type":"boolean"}],"default":{}},"type":{"$ref":"http://json-schema.org/draft-04/schema#/properties/type"},"items":{"anyOf":[{"$ref":"#/definitions/schema"},{"type":"array","minItems":1,"items":{"$ref":"#/definitions/schema"}}],"default":{}},"allOf":{"type":"array","minItems":1,"items":{"$ref":"#/definitions/schema"}},"properties":{"type":"object","additionalProperties":{"$ref":"#/definitions/schema"},"default":{}},"discriminator":{"type":"string"},"readOnly":{"type":"boolean","default":false},"xml":{"$ref":"#/definitions/xml"},"externalDocs":{"$ref":"#/definitions/externalDocs"},"example":{}},"additionalProperties":false},"fileSchema":{"type":"object","description":"A deterministic version of a JSON Schema object.","patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}},"required":["type"],"properties":{"format":{"type":"string"},"title":{"$ref":"http://json-schema.org/draft-04/schema#/properties/title"},"description":{"$ref":"http://json-schema.org/draft-04/schema#/properties/description"},"default":{"$ref":"http://json-schema.org/draft-04/schema#/properties/default"},"required":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/stringArray"},"type":{"type":"string","enum":["file"]},"readOnly":{"type":"boolean","default":false},"externalDocs":{"$ref":"#/definitions/externalDocs"},"example":{}},"additionalProperties":false},"primitivesItems":{"type":"object","additionalProperties":false,"properties":{"type":{"type":"string","enum":["string","number","integer","boolean","array"]},"format":{"type":"string"},"items":{"$ref":"#/definitions/primitivesItems"},"collectionFormat":{"$ref":"#/definitions/collectionFormat"},"default":{"$ref":"#/definitions/default"},"maximum":{"$ref":"#/definitions/maximum"},"exclusiveMaximum":{"$ref":"#/definitions/exclusiveMaximum"},"minimum":{"$ref":"#/definitions/minimum"},"exclusiveMinimum":{"$ref":"#/definitions/exclusiveMinimum"},"maxLength":{"$ref":"#/definitions/maxLength"},"minLength":{"$ref":"#/definitions/minLength"},"pattern":{"$ref":"#/definitions/pattern"},"maxItems":{"$ref":"#/definitions/maxItems"},"minItems":{"$ref":"#/definitions/minItems"},"uniqueItems":{"$ref":"#/definitions/uniqueItems"},"enum":{"$ref":"#/definitions/enum"},"multipleOf":{"$ref":"#/definitions/multipleOf"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"security":{"type":"array","items":{"$ref":"#/definitions/securityRequirement"},"uniqueItems":true},"securityRequirement":{"type":"object","additionalProperties":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"xml":{"type":"object","additionalProperties":false,"properties":{"name":{"type":"string"},"namespace":{"type":"string"},"prefix":{"type":"string"},"attribute":{"type":"boolean","default":false},"wrapped":{"type":"boolean","default":false}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"tag":{"type":"object","additionalProperties":false,"required":["name"],"properties":{"name":{"type":"string"},"description":{"type":"string"},"externalDocs":{"$ref":"#/definitions/externalDocs"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"securityDefinitions":{"type":"object","additionalProperties":{"oneOf":[{"$ref":"#/definitions/basicAuthenticationSecurity"},{"$ref":"#/definitions/apiKeySecurity"},{"$ref":"#/definitions/oauth2ImplicitSecurity"},{"$ref":"#/definitions/oauth2PasswordSecurity"},{"$ref":"#/definitions/oauth2ApplicationSecurity"},{"$ref":"#/definitions/oauth2AccessCodeSecurity"}]}},"basicAuthenticationSecurity":{"type":"object","additionalProperties":false,"required":["type"],"properties":{"type":{"type":"string","enum":["basic"]},"description":{"type":"string"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"apiKeySecurity":{"type":"object","additionalProperties":false,"required":["type","name","in"],"properties":{"type":{"type":"string","enum":["apiKey"]},"name":{"type":"string"},"in":{"type":"string","enum":["header","query"]},"description":{"type":"string"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"oauth2ImplicitSecurity":{"type":"object","additionalProperties":false,"required":["type","flow","authorizationUrl"],"properties":{"type":{"type":"string","enum":["oauth2"]},"flow":{"type":"string","enum":["implicit"]},"scopes":{"$ref":"#/definitions/oauth2Scopes"},"authorizationUrl":{"type":"string","format":"uri"},"description":{"type":"string"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"oauth2PasswordSecurity":{"type":"object","additionalProperties":false,"required":["type","flow","tokenUrl"],"properties":{"type":{"type":"string","enum":["oauth2"]},"flow":{"type":"string","enum":["password"]},"scopes":{"$ref":"#/definitions/oauth2Scopes"},"tokenUrl":{"type":"string","format":"uri"},"description":{"type":"string"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"oauth2ApplicationSecurity":{"type":"object","additionalProperties":false,"required":["type","flow","tokenUrl"],"properties":{"type":{"type":"string","enum":["oauth2"]},"flow":{"type":"string","enum":["application"]},"scopes":{"$ref":"#/definitions/oauth2Scopes"},"tokenUrl":{"type":"string","format":"uri"},"description":{"type":"string"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"oauth2AccessCodeSecurity":{"type":"object","additionalProperties":false,"required":["type","flow","authorizationUrl","tokenUrl"],"properties":{"type":{"type":"string","enum":["oauth2"]},"flow":{"type":"string","enum":["accessCode"]},"scopes":{"$ref":"#/definitions/oauth2Scopes"},"authorizationUrl":{"type":"string","format":"uri"},"tokenUrl":{"type":"string","format":"uri"},"description":{"type":"string"}},"patternProperties":{"^x-":{"$ref":"#/definitions/vendorExtension"}}},"oauth2Scopes":{"type":"object","additionalProperties":{"type":"string"}},"mediaTypeList":{"type":"array","items":{"$ref":"#/definitions/mimeType"},"uniqueItems":true},"parametersList":{"type":"array","description":"The parameters needed to send a valid API call.","additionalItems":false,"items":{"oneOf":[{"$ref":"#/definitions/parameter"},{"$ref":"#/definitions/jsonReference"}]},"uniqueItems":true},"schemesList":{"type":"array","description":"The transfer protocol of the API.","items":{"type":"string","enum":["http","https","ws","wss"]},"uniqueItems":true},"collectionFormat":{"type":"string","enum":["csv","ssv","tsv","pipes"],"default":"csv"},"collectionFormatWithMulti":{"type":"string","enum":["csv","ssv","tsv","pipes","multi"],"default":"csv"},"title":{"$ref":"http://json-schema.org/draft-04/schema#/properties/title"},"description":{"$ref":"http://json-schema.org/draft-04/schema#/properties/description"},"default":{"$ref":"http://json-schema.org/draft-04/schema#/properties/default"},"multipleOf":{"$ref":"http://json-schema.org/draft-04/schema#/properties/multipleOf"},"maximum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/maximum"},"exclusiveMaximum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/exclusiveMaximum"},"minimum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/minimum"},"exclusiveMinimum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/exclusiveMinimum"},"maxLength":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveInteger"},"minLength":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveIntegerDefault0"},"pattern":{"$ref":"http://json-schema.org/draft-04/schema#/properties/pattern"},"maxItems":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveInteger"},"minItems":{"$ref":"http://json-schema.org/draft-04/schema#/definitions/positiveIntegerDefault0"},"uniqueItems":{"$ref":"http://json-schema.org/draft-04/schema#/properties/uniqueItems"},"enum":{"$ref":"http://json-schema.org/draft-04/schema#/properties/enum"},"jsonReference":{"type":"object","required":["$ref"],"additionalProperties":false,"properties":{"$ref":{"type":"string"}}}}}
);



local.assetsDict["/assets.swgg.swagger.json"] = local.assetsDict["/assets.swgg.swagger.json"] || "";



// https://petstore.swagger.io/v2/swagger.json
// curl -Ls https://petstore.swagger.io/v2/swagger.json > /tmp/aa.json; node -e "console.log(JSON.stringify(require('/tmp/aa.json')));"
local.assetsDict["/assets.swgg.swagger.petstore.json"] = JSON.stringify(
{"swagger":"2.0","info":{"description":"This is a sample server Petstore server.  You can find out more about Swagger at [http://swagger.io](http://swagger.io) or on [irc.freenode.net, #swagger](http://swagger.io/irc/).  For this sample, you can use the api key `special-key` to test the authorization filters.","version":"1.0.0","title":"Swagger Petstore","termsOfService":"http://swagger.io/terms/","contact":{"email":"apiteam@swagger.io"},"license":{"name":"Apache 2.0","url":"http://www.apache.org/licenses/LICENSE-2.0.html"}},"host":"petstore.swagger.io","basePath":"/v2","tags":[{"name":"pet","description":"Everything about your Pets","externalDocs":{"description":"Find out more","url":"http://swagger.io"}},{"name":"store","description":"Access to Petstore orders"},{"name":"user","description":"Operations about user","externalDocs":{"description":"Find out more about our store","url":"http://swagger.io"}}],"schemes":["http"],"paths":{"/pet":{"post":{"tags":["pet"],"summary":"Add a new pet to the store","description":"","operationId":"addPet","consumes":["application/json","application/xml"],"produces":["application/xml","application/json"],"parameters":[{"in":"body","name":"body","description":"Pet object that needs to be added to the store","required":true,"schema":{"$ref":"#/definitions/Pet"}}],"responses":{"405":{"description":"Invalid input"}},"security":[{"petstore_auth":["write:pets","read:pets"]}]},"put":{"tags":["pet"],"summary":"Update an existing pet","description":"","operationId":"updatePet","consumes":["application/json","application/xml"],"produces":["application/xml","application/json"],"parameters":[{"in":"body","name":"body","description":"Pet object that needs to be added to the store","required":true,"schema":{"$ref":"#/definitions/Pet"}}],"responses":{"400":{"description":"Invalid ID supplied"},"404":{"description":"Pet not found"},"405":{"description":"Validation exception"}},"security":[{"petstore_auth":["write:pets","read:pets"]}]}},"/pet/findByStatus":{"get":{"tags":["pet"],"summary":"Finds Pets by status","description":"Multiple status values can be provided with comma separated strings","operationId":"findPetsByStatus","produces":["application/xml","application/json"],"parameters":[{"name":"status","in":"query","description":"Status values that need to be considered for filter","required":true,"type":"array","items":{"type":"string","enum":["available","pending","sold"],"default":"available"},"collectionFormat":"multi"}],"responses":{"200":{"description":"successful operation","schema":{"type":"array","items":{"$ref":"#/definitions/Pet"}}},"400":{"description":"Invalid status value"}},"security":[{"petstore_auth":["write:pets","read:pets"]}]}},"/pet/findByTags":{"get":{"tags":["pet"],"summary":"Finds Pets by tags","description":"Muliple tags can be provided with comma separated strings. Use tag1, tag2, tag3 for testing.","operationId":"findPetsByTags","produces":["application/xml","application/json"],"parameters":[{"name":"tags","in":"query","description":"Tags to filter by","required":true,"type":"array","items":{"type":"string"},"collectionFormat":"multi"}],"responses":{"200":{"description":"successful operation","schema":{"type":"array","items":{"$ref":"#/definitions/Pet"}}},"400":{"description":"Invalid tag value"}},"security":[{"petstore_auth":["write:pets","read:pets"]}],"deprecated":true}},"/pet/{petId}":{"get":{"tags":["pet"],"summary":"Find pet by ID","description":"Returns a single pet","operationId":"getPetById","produces":["application/xml","application/json"],"parameters":[{"name":"petId","in":"path","description":"ID of pet to return","required":true,"type":"integer","format":"int64"}],"responses":{"200":{"description":"successful operation","schema":{"$ref":"#/definitions/Pet"}},"400":{"description":"Invalid ID supplied"},"404":{"description":"Pet not found"}},"security":[{"api_key":[]}]},"post":{"tags":["pet"],"summary":"Updates a pet in the store with form data","description":"","operationId":"updatePetWithForm","consumes":["application/x-www-form-urlencoded"],"produces":["application/xml","application/json"],"parameters":[{"name":"petId","in":"path","description":"ID of pet that needs to be updated","required":true,"type":"integer","format":"int64"},{"name":"name","in":"formData","description":"Updated name of the pet","required":false,"type":"string"},{"name":"status","in":"formData","description":"Updated status of the pet","required":false,"type":"string"}],"responses":{"405":{"description":"Invalid input"}},"security":[{"petstore_auth":["write:pets","read:pets"]}]},"delete":{"tags":["pet"],"summary":"Deletes a pet","description":"","operationId":"deletePet","produces":["application/xml","application/json"],"parameters":[{"name":"api_key","in":"header","required":false,"type":"string"},{"name":"petId","in":"path","description":"Pet id to delete","required":true,"type":"integer","format":"int64"}],"responses":{"400":{"description":"Invalid ID supplied"},"404":{"description":"Pet not found"}},"security":[{"petstore_auth":["write:pets","read:pets"]}]}},"/pet/{petId}/uploadImage":{"post":{"tags":["pet"],"summary":"uploads an image","description":"","operationId":"uploadFile","consumes":["multipart/form-data"],"produces":["application/json"],"parameters":[{"name":"petId","in":"path","description":"ID of pet to update","required":true,"type":"integer","format":"int64"},{"name":"additionalMetadata","in":"formData","description":"Additional data to pass to server","required":false,"type":"string"},{"name":"file","in":"formData","description":"file to upload","required":false,"type":"file"}],"responses":{"200":{"description":"successful operation","schema":{"$ref":"#/definitions/ApiResponse"}}},"security":[{"petstore_auth":["write:pets","read:pets"]}]}},"/store/inventory":{"get":{"tags":["store"],"summary":"Returns pet inventories by status","description":"Returns a map of status codes to quantities","operationId":"getInventory","produces":["application/json"],"parameters":[],"responses":{"200":{"description":"successful operation","schema":{"type":"object","additionalProperties":{"type":"integer","format":"int32"}}}},"security":[{"api_key":[]}]}},"/store/order":{"post":{"tags":["store"],"summary":"Place an order for a pet","description":"","operationId":"placeOrder","produces":["application/xml","application/json"],"parameters":[{"in":"body","name":"body","description":"order placed for purchasing the pet","required":true,"schema":{"$ref":"#/definitions/Order"}}],"responses":{"200":{"description":"successful operation","schema":{"$ref":"#/definitions/Order"}},"400":{"description":"Invalid Order"}}}},"/store/order/{orderId}":{"get":{"tags":["store"],"summary":"Find purchase order by ID","description":"For valid response try integer IDs with value >= 1 and <= 10. Other values will generated exceptions","operationId":"getOrderById","produces":["application/xml","application/json"],"parameters":[{"name":"orderId","in":"path","description":"ID of pet that needs to be fetched","required":true,"type":"integer","maximum":10,"minimum":1,"format":"int64"}],"responses":{"200":{"description":"successful operation","schema":{"$ref":"#/definitions/Order"}},"400":{"description":"Invalid ID supplied"},"404":{"description":"Order not found"}}},"delete":{"tags":["store"],"summary":"Delete purchase order by ID","description":"For valid response try integer IDs with positive integer value. Negative or non-integer values will generate API errors","operationId":"deleteOrder","produces":["application/xml","application/json"],"parameters":[{"name":"orderId","in":"path","description":"ID of the order that needs to be deleted","required":true,"type":"integer","minimum":1,"format":"int64"}],"responses":{"400":{"description":"Invalid ID supplied"},"404":{"description":"Order not found"}}}},"/user":{"post":{"tags":["user"],"summary":"Create user","description":"This can only be done by the logged in user.","operationId":"createUser","produces":["application/xml","application/json"],"parameters":[{"in":"body","name":"body","description":"Created user object","required":true,"schema":{"$ref":"#/definitions/User"}}],"responses":{"default":{"description":"successful operation"}}}},"/user/createWithArray":{"post":{"tags":["user"],"summary":"Creates list of users with given input array","description":"","operationId":"createUsersWithArrayInput","produces":["application/xml","application/json"],"parameters":[{"in":"body","name":"body","description":"List of user object","required":true,"schema":{"type":"array","items":{"$ref":"#/definitions/User"}}}],"responses":{"default":{"description":"successful operation"}}}},"/user/createWithList":{"post":{"tags":["user"],"summary":"Creates list of users with given input array","description":"","operationId":"createUsersWithListInput","produces":["application/xml","application/json"],"parameters":[{"in":"body","name":"body","description":"List of user object","required":true,"schema":{"type":"array","items":{"$ref":"#/definitions/User"}}}],"responses":{"default":{"description":"successful operation"}}}},"/user/login":{"get":{"tags":["user"],"summary":"Logs user into the system","description":"","operationId":"loginUser","produces":["application/xml","application/json"],"parameters":[{"name":"username","in":"query","description":"The user name for login","required":true,"type":"string"},{"name":"password","in":"query","description":"The password for login in clear text","required":true,"type":"string"}],"responses":{"200":{"description":"successful operation","schema":{"type":"string"},"headers":{"X-Rate-Limit":{"type":"integer","format":"int32","description":"calls per hour allowed by the user"},"X-Expires-After":{"type":"string","format":"date-time","description":"date in UTC when token expires"}}},"400":{"description":"Invalid username/password supplied"}}}},"/user/logout":{"get":{"tags":["user"],"summary":"Logs out current logged in user session","description":"","operationId":"logoutUser","produces":["application/xml","application/json"],"parameters":[],"responses":{"default":{"description":"successful operation"}}}},"/user/{username}":{"get":{"tags":["user"],"summary":"Get user by user name","description":"","operationId":"getUserByName","produces":["application/xml","application/json"],"parameters":[{"name":"username","in":"path","description":"The name that needs to be fetched. Use user1 for testing. ","required":true,"type":"string"}],"responses":{"200":{"description":"successful operation","schema":{"$ref":"#/definitions/User"}},"400":{"description":"Invalid username supplied"},"404":{"description":"User not found"}}},"put":{"tags":["user"],"summary":"Updated user","description":"This can only be done by the logged in user.","operationId":"updateUser","produces":["application/xml","application/json"],"parameters":[{"name":"username","in":"path","description":"name that need to be updated","required":true,"type":"string"},{"in":"body","name":"body","description":"Updated user object","required":true,"schema":{"$ref":"#/definitions/User"}}],"responses":{"400":{"description":"Invalid user supplied"},"404":{"description":"User not found"}}},"delete":{"tags":["user"],"summary":"Delete user","description":"This can only be done by the logged in user.","operationId":"deleteUser","produces":["application/xml","application/json"],"parameters":[{"name":"username","in":"path","description":"The name that needs to be deleted","required":true,"type":"string"}],"responses":{"400":{"description":"Invalid username supplied"},"404":{"description":"User not found"}}}}},"securityDefinitions":{"petstore_auth":{"type":"oauth2","authorizationUrl":"http://petstore.swagger.io/oauth/dialog","flow":"implicit","scopes":{"write:pets":"modify pets in your account","read:pets":"read your pets"}},"api_key":{"type":"apiKey","name":"api_key","in":"header"}},"definitions":{"Order":{"type":"object","properties":{"id":{"type":"integer","format":"int64"},"petId":{"type":"integer","format":"int64"},"quantity":{"type":"integer","format":"int32"},"shipDate":{"type":"string","format":"date-time"},"status":{"type":"string","description":"Order Status","enum":["placed","approved","delivered"]},"complete":{"type":"boolean","default":false}},"xml":{"name":"Order"}},"Category":{"type":"object","properties":{"id":{"type":"integer","format":"int64"},"name":{"type":"string"}},"xml":{"name":"Category"}},"User":{"type":"object","properties":{"id":{"type":"integer","format":"int64"},"username":{"type":"string"},"firstName":{"type":"string"},"lastName":{"type":"string"},"email":{"type":"string"},"password":{"type":"string"},"phone":{"type":"string"},"userStatus":{"type":"integer","format":"int32","description":"User Status"}},"xml":{"name":"User"}},"Tag":{"type":"object","properties":{"id":{"type":"integer","format":"int64"},"name":{"type":"string"}},"xml":{"name":"Tag"}},"Pet":{"type":"object","required":["name","photoUrls"],"properties":{"id":{"type":"integer","format":"int64"},"category":{"$ref":"#/definitions/Category"},"name":{"type":"string","example":"doggie"},"photoUrls":{"type":"array","xml":{"name":"photoUrl","wrapped":true},"items":{"type":"string"}},"tags":{"type":"array","xml":{"name":"tag","wrapped":true},"items":{"$ref":"#/definitions/Tag"}},"status":{"type":"string","description":"pet status in the store","enum":["available","pending","sold"]}},"xml":{"name":"Pet"}},"ApiResponse":{"type":"object","properties":{"code":{"type":"integer","format":"int32"},"type":{"type":"string"},"message":{"type":"string"}}}},"externalDocs":{"description":"Find out more about Swagger","url":"http://swagger.io"}}
);



local.swaggerErrorTypeDict = {
    arrayMaxItems: '{{type2}} {{prefix0}} must have <= {{schema.maxItems}} items',
    arrayMinItems: '{{type2}} {{prefix0}} must have >= {{schema.minItems}} items',
    arrayUniqueItems: '{{type2}} {{prefix0}} must have unique items (has duplicate item {{tmp jsonStringify}})',
    itemEnum: '{{type2}} {{prefix0}} can only have items from the list {{schema.enum jsonStringify}}',
    itemAnyOf: '{{tmp}} (from schama.anyOf {{schema2}})',
    itemNot: '{{type2}} {{prefix0}} must not validate against schama.not {{schema2}}',
    itemOneOf: '{{type2}} {{prefix0}} did not validate against exactly one schema (validated {{tmp}}) in schema.oneOf {{schema2}}',
    itemType: 'value {{prefix0}} is not a valid {{type2}}',
    numberMultipleOf: '{{type2}} {{prefix0}} must be a multiple of {{schema.multipleOf}}',
    numberExclusiveMaximum: '{{type2}} {{prefix0}} must be < {{schema.maximum}}',
    numberExclusiveMinimum: '{{type2}} {{prefix0}} must be > {{schema.minimum}}',
    numberMaximum: '{{type2}} {{prefix0}} must be <= {{schema.maximum}}',
    numberMinimum: '{{type2}} {{prefix0}} must be >= {{schema.minimum}}',
    objectAdditionalProperties: '{{type2}} {{prefix0}} cannot have additional property {{key jsonStringify}}',
    objectDependencies: '{{type2}} {{prefix0}} with item {{key jsonStringify}} must have dependency {{key2 jsonStringify}}',
    objectMaxProperties: '{{type2}} {{prefix0}} must have <= {{schema.maxProperties}} properties',
    objectMinProperties: '{{type2}} {{prefix0}} must have >= {{schema.minProperties}} properties',
    objectRequired: '{{type2}} {{prefix0}} is required',
    schemaDereferenceCircular: 'cannot dereference circular-reference schema {{schema2}}',
    schemaDereference: 'cannot dereference schema {{schema2}}',
    // https://github.com/swagger-api/swagger-editor/tree/v3.1.20/src/plugins/validation/semantic-validators/validators
    // shGrep swagger-editor/src/plugins/validation/semantic-validators/validators 'message:'
    // form-data.js:90: "Parameter \"in: formdata\" is invalid, did you mean \"in: formData\" ( camelCase )?",
    semanticFormData1: "Parameter {{prefix0}} is invalid, did you mean \"in: formData\" ( camelCase )?",
    // form-data.js:109: "Parameters cannot have both a \"in: body\" and \"in: formData\", as \"formData\" _will_ be the body"
    semanticFormData2: "Parameters cannot have both a \"in: body\" and \"in: formData\", as \"formData\" _will_ be the body",
    // form-data.js:131: "Parameters with \"type: file\" must have \"in: formData\"",
    semanticFormData3: "Parameter {{prefix0}} with \"type: file\" must have \"in: formData\"",
    // form-data.js:140: "Operations with Parameters of \"type: file\" must include \"multipart/form-data\" in their \"consumes\" property",
    semanticFormData4: "Operation {{prefix0}} with Parameters of \"type: file\" must include \"multipart/form-data\" in their \"consumes\" property",
    // form-data.js:163: "Operations with Parameters of \"in: formData\" must include \"application/x-www-form-urlencoded\" or \"multipart/form-data\" in their \"consumes\" property",
    semanticFormData5: "Operation {{prefix0}} with Parameters of \"in: formData\" must include \"application/x-www-form-urlencoded\" or \"multipart/form-data\" in their \"consumes\" property",
    // items-required-for-array-objects.js:27: "Schema objects with 'array' type require an 'items' property"
    semanticItemsRequiredForArrayObjects1: "Schema {{schema2}} with 'array' type require an 'items' property",
    // items-required-for-array-objects.js:38: "Schema properties specified as 'required' must be defined"
    semanticItemsRequiredForArrayObjects2: "{{type2}} {{prefix0}} must have property {{key jsonStringify}}",
    // items-required-for-array-objects.js:50: "Headers with 'array' type require an 'items' property"
    semanticItemsRequiredForArrayObjects3: "Headers with 'array' type require an 'items' property",
    // items-required-for-array-objects.js:59: "Model properties with 'array' type require an 'items' property"
    semanticItemsRequiredForArrayObjects4: "Model properties with 'array' type require an 'items' property",
    // operation-ids.js:40: "operationIds must be unique"
    semanticOperationIds1: 'operationId {{prefix0}} must be unique',
    // operations.js:30: "Operations cannot have both a \"body\" parameter and \"formData\" parameter"
    semanticOperations1: "Operation {{prefix0}} cannot have both a \"body\" parameter and \"formData\" parameter",
    // operations.js:38: "Operations must have no more than one body parameter"
    semanticOperations2: "Operation {{prefix0}} must have no more than one body parameter",
    // operations.js:53: "Operation parameters must have unique 'name' + 'in' properties"
    semanticOperations3: "Operation parameters {{prefix0}} must have unique 'name' + 'in' properties",
    // parameters.js:18: "Parameters with 'array' type require an 'items' property."
    semanticParameters1: "Parameters with 'array' type require an 'items' property.",
    // parameters.js:24: "Non-body parameters require a 'type' property."
    semanticParameters2: "Non-body parameter {{prefix0}} require a 'type' property.",
    // paths.js:48: "Query strings in paths are not allowed."
    semanticPaths1: "Query strings in path {{prefix2 jsonStringify}} are not allowed",
    // paths.js:79: "Equivalent paths are not allowed."
    semanticPaths2: 'Equivalent paths {{pathList jsonStringify}} are not allowed',
    // paths.js:94: "Path parameters must have unique 'name' + 'in' properties"
    semanticPaths3: "Path parameter ${parameterDefinition.name jsonStringify} must be unique",
    // paths.js:107: `Path parameter ${parameterDefinition.name} was defined but never used`
    semanticPaths4: 'Path parameter ${parameterDefinition.name} was defined but never used',
    // paths.js:119: "Empty path parameter declarations are not valid"
    semanticPaths5: "Empty path parameter declarations are not valid - {{prefix2 jsonStringify}}",
    // paths.js:131: `Declared path parameter "${parameter}" needs to be defined as a path parameter at either the path or operation level`
    semanticPaths6: 'Declared path parameter {{name jsonStringify}} needs to be defined as a path parameter {{prefix2 jsonStringify}} at either the path or operation level',
    // paths.js:141: `Path parameter ${parameterDefinition.name} was defined but never used`
    semanticPaths7: 'Path parameter {{prefix0}} was defined but never used',
    // refs.js:37: "Definition was declared but never used in document"
    semanticRefs1: 'Definition was declared but never used in document',
    // schema.js:61: "Read only properties cannot marked as required by a schema."
    semanticSchema1: "Read only property {{prefix0}} cannot be marked as required by a schema.",
    // security-definitions.js:33: `${path} must have required string 'type' param`,
    semanticSecurityDefinitions1: '${path} must have required string "type" param',
    // security-definitions.js:44: "apiKey authorization must have required 'in' param, valid values are 'query' or 'header'.",
    semanticSecurityDefinitions2: 'apiKey authorization must have required "in" param, valid values are "query" or "header".',
    // security-definitions.js:52: "apiKey authorization must have required 'name' string param. The name of the header or query parameter to be used.",
    semanticSecurityDefinitions3: "apiKey authorization must have required 'name' string param. The name of the header or query parameter to be used.",
    // security-definitions.js:66: "oauth2 authorization must have required 'flow' string param. Valid values are 'implicit', 'password', 'application' or 'accessCode'",
    semanticSecurityDefinitions4: "oauth2 authorization must have required 'flow' string param. Valid values are 'implicit', 'password', 'application' or 'accessCode'",
    // security-definitions.js:73: "oauth2 authorization implicit flow must have required 'authorizationUrl' parameter.",
    semanticSecurityDefinitions5: "oauth2 authorization implicit flow must have required 'authorizationUrl' parameter.",
    // security-definitions.js:81: "oauth2 authorization accessCode flow must have required 'authorizationUrl' and 'tokenUrl' string parameters.",
    semanticSecurityDefinitions6: "oauth2 authorization accessCode flow must have required 'authorizationUrl' and 'tokenUrl' string parameters.",
    // security-definitions.js:89: "oauth2 authorization password flow must have required 'tokenUrl' string parameter.",
    semanticSecurityDefinitions7: "oauth2 authorization password flow must have required 'tokenUrl' string parameter.",
    // security-definitions.js:97: "oauth2 authorization application flow must have required 'tokenUrl' string parameter.",
    semanticSecurityDefinitions8: "oauth2 authorization application flow must have required 'tokenUrl' string parameter.",
    // security-definitions.js:106: "'scopes' is required property type object. The available scopes for the OAuth2 security scheme.",
    semanticSecurityDefinitions9: "'scopes' is required property type object. The available scopes for the OAuth2 security scheme.",
    // security.js:23: "security requirements must match a security definition",
    semanticSecurity1: "security requirements must match a security definition",
    // security.js:37: `Security scope definition ${scope} could not be resolved`,
    semanticSecurity2: 'Security scope definition ${scope} could not be resolved',
    // walker.js:27: "\"type\" should be a string"
    semanticWalker1: "type {{prefix0}} should be a string",
    // walker.js:39: "Minimum cannot be more than maximum"
    semanticWalker2: 'Minimum cannot be more than maximum - {{prefix0}}',
    // walker.js:48: "minProperties cannot be more than maxProperties"
    semanticWalker3: 'minProperties cannot be more than maxProperties - {{prefix0}}',
    // walker.js:57: "minLength cannot be more than maxLength"
    semanticWalker4: 'minLength cannot be more than maxLength - {{prefix0}}',
    // walker.js:76: `${path[path.length - 2]} $refs cannot match any of the following: ${humanFriendlyRefBlacklist}`
    // semanticWalker5: '${path[path.length - 2]} $refs cannot match any of the following: ${humanFriendlyRefBlacklist}',
    // walker.js:89: "$ref paths must begin with `#/`"
    semanticWalker6: '$ref {{prefix0}} must begin with "#/"',
    // walker.js:108: "Values alongside a $ref will be ignored."
    semanticWalker7: 'Values alongside a $ref will be ignored.',
    stringMaxLength: '{{type2}} {{prefix0}} must have <= {{schema.maxLength}} characters',
    stringMinLength: '{{type2}} {{prefix0}} must have >= {{schema.minLength}} characters',
    stringPattern: '{{type2}} {{prefix0}} must match regexp pattern {{schema.pattern jsonStringify}}'
};



local.templateApiDict =
{
    "crudCountManyByQuery": {
        "_method": "GET",
        "_path": "/{{_tags0}}/crudCountManyByQuery",
        "parameters": [
            {
                "default": "{\"id\":{\"$exists\":true}}",
                "description": "query param",
                "format": "json",
                "in": "query",
                "name": "_queryWhere",
                "type": "string"
            }
        ],
        "summary": "count many {{_schemaName}} objects by query"
    },
    "crudErrorDelete": {
        "_method": "DELETE",
        "_path": "/{{_tags0}}/crudErrorDelete",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudErrorGet": {
        "_method": "GET",
        "_path": "/{{_tags0}}/crudErrorGet",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudErrorHead": {
        "_method": "HEAD",
        "_path": "/{{_tags0}}/crudErrorHead",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudErrorLogin": {
        "_method": "GET",
        "_path": "/{{_tags0}}/crudErrorLogin",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "login by password"
    },
    "crudErrorOptions": {
        "_method": "OPTIONS",
        "_path": "/{{_tags0}}/crudErrorOptions",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudErrorPatch": {
        "_method": "PATCH",
        "_path": "/{{_tags0}}/crudErrorPatch",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudErrorPost": {
        "_method": "POST",
        "_path": "/{{_tags0}}/crudErrorPost",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudErrorPre": {
        "_method": "GET",
        "_path": "/{{_tags0}}/crudErrorPre",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudErrorPut": {
        "_method": "PUT",
        "_path": "/{{_tags0}}/crudErrorPut",
        "responses": {
            "500": {
                "description": "500 error - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return error response"
    },
    "crudGetManyByQuery": {
        "_method": "GET",
        "_path": "/{{_tags0}}/crudGetManyByQuery",
        "parameters": [
            {
                "default": "{\"id\":{\"$exists\":true}}",
                "description": "query param",
                "format": "json",
                "in": "query",
                "name": "_queryWhere",
                "required": true,
                "type": "string"
            },
            {
                "default": null,
                "description": "projection-fields param",
                "format": "json",
                "in": "query",
                "name": "_queryFields",
                "type": "string",
                "x-swgg-collectionFormat": "json",
                "x-swgg-items": {
                    "type": "string"
                },
                "x-swgg-type": "array"
            },
            {
                "default": 20,
                "description": "cursor-limit param",
                "in": "query",
                "name": "_queryLimit",
                "required": true,
                "type": "integer"
            },
            {
                "default": 0,
                "description": "cursor-skip param",
                "in": "query",
                "name": "_querySkip",
                "type": "integer"
            },
            {
                "default": [
                    {
                        "fieldName": "id"
                    },
                    {
                        "fieldName": "_timeUpdated",
                        "isDescending": true
                    }
                ],
                "description": "cursor-sort param",
                "format": "json",
                "in": "query",
                "name": "_querySort",
                "type": "string",
                "x-swgg-collectionFormat": "json",
                "x-swgg-items": {
                    "type": "object"
                },
                "x-swgg-type": "array"
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "get many {{_schemaName}} objects by query"
    },
    "crudGetOneById": {
        "_idName": "{{_idName}}",
        "_method": "GET",
        "_path": "/{{_tags0}}/crudGetOneById.{{_idName}}.{{_idBackend}}",
        "parameters": [
            {
                "description": "{{_schemaName}} {{_idName}}",
                "in": "query",
                "name": "{{_idName}}",
                "required": true,
                "type": "string"
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "get one {{_schemaName}} object by {{_idName}}"
    },
    "crudGetOneByQuery": {
        "_method": "GET",
        "_path": "/{{_tags0}}/crudGetOneByQuery",
        "parameters": [
            {
                "default": "{\"id\":{\"$exists\":true}}",
                "description": "query param",
                "format": "json",
                "in": "query",
                "name": "_queryWhere",
                "required": true,
                "type": "string"
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "get one {{_schemaName}} object by query"
    },
    "crudNullDelete": {
        "_method": "DELETE",
        "_path": "/{{_tags0}}/crudNullDelete",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return null response"
    },
    "crudNullGet": {
        "_method": "GET",
        "_path": "/{{_tags0}}/crudNullGet",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return null response"
    },
    "crudNullHead": {
        "_method": "HEAD",
        "_path": "/{{_tags0}}/crudNullHead",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return null response"
    },
    "crudNullOptions": {
        "_method": "OPTIONS",
        "_path": "/{{_tags0}}/crudNullOptions",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return null response"
    },
    "crudNullPatch": {
        "_method": "PATCH",
        "_path": "/{{_tags0}}/crudNullPatch",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return null response"
    },
    "crudNullPost": {
        "_method": "POST",
        "_path": "/{{_tags0}}/crudNullPost",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return null response"
    },
    "crudNullPut": {
        "_method": "PUT",
        "_path": "/{{_tags0}}/crudNullPut",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "return null response"
    },
    "crudRemoveManyByQuery": {
        "_method": "DELETE",
        "_path": "/{{_tags0}}/crudRemoveManyByQuery",
        "parameters": [
            {
                "default": "{\"id\":\"undefined\"}",
                "description": "query param",
                "format": "json",
                "in": "query",
                "name": "_queryWhere",
                "required": true,
                "type": "string"
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "remove many {{_schemaName}} objects by query"
    },
    "crudRemoveOneById": {
        "_idName": "{{_idName}}",
        "_method": "DELETE",
        "_path": "/{{_tags0}}/crudRemoveOneById.{{_idName}}.{{_idBackend}}",
        "parameters": [
            {
                "description": "{{_schemaName}} {{_idName}}",
                "in": "query",
                "name": "{{_idName}}",
                "required": true,
                "type": "string"
            }
        ],
        "summary": "remove one {{_schemaName}} object by {{_idName}}"
    },
    "crudSetManyById": {
        "_method": "PUT",
        "_path": "/{{_tags0}}/crudSetManyById",
        "parameters": [
            {
                "description": "{{_schemaName}} object",
                "in": "body",
                "name": "body",
                "required": true,
                "schema": {
                    "items": {
                        "$ref": "#/definitions/{{_schemaName}}"
                    },
                    "type": "array"
                }
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "create or replace many {{_schemaName}} objects"
    },
    "crudSetOneById": {
        "_idName": "{{_idName}}",
        "_method": "PUT",
        "_path": "/{{_tags0}}/crudSetOneById.{{_idName}}.{{_idBackend}}",
        "parameters": [
            {
                "description": "{{_schemaName}} {{_idName}}",
                "in": "query",
                "name": "{{_idName}}",
                "type": "string"
            },
            {
                "description": "{{_schemaName}} object",
                "in": "body",
                "name": "body",
                "required": true,
                "schema": {
                    "$ref": "#/definitions/{{_schemaName}}"
                }
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "create or replace one {{_schemaName}} object by {{_idName}}"
    },
    "crudUpdateOneById": {
        "_idName": "{{_idName}}",
        "_method": "PATCH",
        "_path": "/{{_tags0}}/crudUpdateOneById.{{_idName}}.{{_idBackend}}",
        "parameters": [
            {
                "description": "{{_schemaName}} {{_idName}}",
                "in": "query",
                "name": "{{_idName}}",
                "type": "string"
            },
            {
                "description": "{{_schemaName}} object",
                "in": "body",
                "name": "body",
                "required": true,
                "schema": {
                    "$ref": "#/definitions/{{_schemaName}}"
                },
                "x-swgg-notRequired": true
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "create or update one {{_schemaName}} object by {{_idName}}"
    },
    "fileGetOneById": {
        "_idName": "{{_idName}}",
        "_method": "GET",
        "_path": "/{{_tags0}}/fileGetOneById.{{_idName}}.{{_idBackend}}",
        "parameters": [
            {
                "description": "{{_schemaName}} {{_idName}}",
                "in": "query",
                "name": "{{_idName}}",
                "required": true,
                "type": "string"
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "type": "file"
                }
            }
        },
        "summary": "get one {{_schemaName}} file by {{_idName}}",
        "x-swgg-consumes0": "application/octet-stream"
    },
    "fileUploadManyByForm": {
        "_fileUploadNumber": "{{_fileUploadNumber}}",
        "_method": "POST",
        "_path": "/{{_tags0}}/fileUploadManyByForm.{{_fileUploadNumber}}",
        "consumes": [
            "multipart/form-data"
        ],
        "parameters": [
            {
                "description": "{{_schemaName}} file description",
                "in": "formData",
                "name": "fileDescription",
                "type": "string"
            },
            {
                "description": "{{_schemaName}} file to upload by form",
                "in": "formData",
                "name": "file1",
                "type": "file"
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "upload many {{_schemaName}} files by form",
        "x-swgg-consumes0": "multipart/form-data"
    },
    "userLoginByPassword": {
        "_method": "GET",
        "_path": "/{{_tags0}}/userLoginByPassword",
        "parameters": [
            {
                "description": "The user name for login",
                "in": "query",
                "name": "username",
                "required": true,
                "type": "string"
            },
            {
                "description": "The password for login in clear text",
                "in": "query",
                "name": "password",
                "required": true,
                "type": "string"
            }
        ],
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "login by password"
    },
    "userLogout": {
        "_method": "GET",
        "_path": "/{{_tags0}}/userLogout",
        "responses": {
            "200": {
                "description": "200 ok - http://jsonapi.org/format/#document-structure-top-level",
                "schema": {
                    "$ref": "#/definitions/BuiltinJsonapiResponse"
                }
            }
        },
        "summary": "logout"
    }
}
;
// JSON.stringify templateApiDict items to prevent side-effects
Object.keys(local.templateApiDict).forEach(function (key) {
    local.templateApiDict[key] = JSON.stringify(local.templateApiDict[key]);
});



// https://swaggerhub.com/wp-content/uploads/2017/10/Swagger-Icon.svg
local.templateSwaggerUiLogoMediumBase64 = '\
iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAMAAAAL34HQAAAC6FBMVEUAAABqn0BqmUBumUBtmj9tmUBt\
mT9tmkBtmj9tmT9tmUBsmkBsmUBtmj9smkBsmUBsmT9tm0BtmkFvmTxsnEFtmT9smT9smUBtmT9tmkBs\
mkBtmkBsmj9tmz+AgABqmj9smT9tmUBtmkBsmkBsmj9tm0BVqlVgn0BtmkBsmj9tmUBxnDltkkltmD5s\
mT9tmj9smkBtmUFsmEBsmUBtmkBtmT9vnUEA/wBsmj5smkBsmkBmmTNtmj5smj9smT9rmz9smT9smj9t\
mj9um0Fvmz1tmj9qmz5wmT1smj9smkBtmj9mmTNsmT9tmkBrmj9tmEFtmT9smkBtmUBsmUBtmD9roUNt\
mT9smkCAv0Bsm0Bqnj5tmz5smUBrmUBtmkBsmj9smkBtmT9smUBtmkBsmUBtmUBsmkFsnTttmkBwl0Bt\
mkBtmT9tmUCRs2+kwIe2zZ92oEyauXttmkBrmkDj7Nv///+/0qt/p1htmj+JrWTa5s/I2bdtmT9pljxt\
mkCkwIj2+fObunxsmEB0okZsmUBtmT9Vqittmj9rmkGtx5TS4MRumj7b5tDt8+j2+fSStHBrmEFsmT/k\
7Ny2zKBtmT5um0Ftmj9umD5smj9tmj9tmkBsmT9tmkBsmj9smT9tmj9smT5tnD5smj9tmT9smUBtmUJs\
mEDI2bhrmD/R38Nsmj+sxpNtmz9/pljt8ue1zJ+IrWSauXyjv4dsmT5tmT9rmj+txpS/06xrmj9sm0Bs\
mT+Rs3C2zaBsmkBtmUBsmUBtmkBrmUBsmkFinTttmUBsmkBtpDdqnEBsmkBsmT9smD9tmUBtmD1smT9t\
mUBtmUBolzpsmT9umj9smz5tmT9qlUBumT9tnj2txpNsmT9rmjxrnEJtmT9smj9rmUFsmUBtmT9smT9r\
mT1rmD5smkBxqjltmT9smUBtmT9tmkBtm0BsmUBsmUBmmURtmUBsmT9smkBsmj9unEBrmz5tmUBtmT9s\
m0Bvm0OD9tkQAAAA+HRSTlMAGDxkgYyWn6myvL+vnYt4ZlQ/Hjt6pcvx/9SwiT0CNXa39Pe9OAMIW7Zs\
EgdS9fmsSzSg6IonAU7EuAVi1sFFVd7KTy7JKRn+/I0KfeNRL9pv+PBNE7mQBEAdXntrk4anraODgGdH\
Gu8gzM6P//////+ITP/////y////5hG7////Vwvn4QZ+K///Vv////9Dzf//RjPFJZLqpJ5grqrtLTFt\
buwjXP85/0n/Wf///////1ppef//cn+Z//+Xm4d3X1MNw3QOJM/pYdwq7nOUFt1dIXUMQRX/xiYfkdk3\
UP36Mj6cCfYo1asc89cP6+Lg5SxKcL5jF9reEmcAAAc2SURBVHgB7NGDYQNAAAXQX9v8sW2ntt0Gtfdf\
oQOUl0Oqt8ID8O9fS2tbe0dnV3dPb1//wODQ8MjoGJprfGJyappvsFhtw3Y0gcPpcnv4Ia9vwh+AQcGQ\
dZpf4glHojAiFu9OUEAylQ5At0w2QWG5fAEaFUtlNmjGD01m5+YpYWEROiwtU9LKKlRbK1OB9Q2otJnd\
ohLbO7tQJbjnoTL7B1Dj8IhKhcegwPEJFTs9g6xKlRrU6pBynqMW6xeQcLlFYfojr6jRNRp0Q61u0YjA\
HTXLQlywSu3u6xDlpgHVXQgppmiE2wERXTTkAQIeacwTvuyZBoXwwrxdfbltxFEcnzLTU88tMzMzMzMz\
k7PaZhWvvG1ll+3KUrNhLjvMTOU2KTP/L0WtZGfvaH6Nxj77ee5Rv7EmI82MInT2JeigSx9SIg8/go7a\
71HRNPoYOuxxyTryCWgVhnX9B5BzCoXuru5CAXpPKqPh0BjW4yYAOXdAz4giuEuM2yiP9oLySq6bIyvW\
54B66mmV7RlQvuvayHLLFVC7q0zPgvLcvFkJH1Tmeui558EUy/ayXA/MCy8qvZtB9bgWs0qgXlJaL18K\
pujazNLcxutuUzqPgarazaqBOkZpvALBPQz+ATkEf6u7zRxQuslrN1COmwgjbCQ/dBMRqF0VdQq4iP8t\
EiJzTBXcq4oZCa6S3kDk0O8OGAVuW0WMhsYofj0hcpkaNMaQrLHm61XsZAXQuFcNchJ0avqxajnrknFq\
QydCJ+hYFsarDU1od5YvmI1P2Msw4O1nRYIsnK1aTRwaWZNUi8v3h5ZrJ8uRZPW2bpZMRtuzQLJMr4NT\
hkrWVNVsWgeyAklW78kq9Rr0nI5m4XWVekP2N6iIPGqirDdV6hhZFmBnmo+Eg2uaKCvsRNZbGY9p/iYf\
IJcKWWQQbydZR8rfk3KIZO9t78hOKwLD1eRkf777+QNRv+6p2MoqI8M9fH2on7Y85BOIZprzkqyjRa9J\
Iaxl+dB7RMVug56T3sMGcqrKBtfhcdZ06M1wrQ0tFGXX2jvOmgnAvAdYx//ndM8q0KVi2YPWDXHWbFrU\
1dVX4hstc2bNmFuaNx8tFvSVSjMWtkaN+LdgVvOEmugrQGNRnLWYz6Kt+jFgfrwJN6u5IL7ZJYcMyxlk\
0Gc8N3aOs5YIssJiU1VsKXk7KLFbtgyxYijIWh5n7WHOCj3yJy47yR0k93qBS/5DLzRnrYizVmqzyAbS\
fDbclrmJRvoDplaBdvGsHcmzh2b1O0gsdVOryZgJ2DhagIRTM2WtibPWmrJ6HL5Dvywrq0F/LaCPZNGT\
9SeMN7HsiW9ijfU75KmhzdqSnbXyIV9mQz6ckzXknZD834s95iH/bpz1njnLLacTRJg1QQTAoNbQSVLn\
uuasneKsO0H4QUh3+ZOucCkGD+TAGfzy0T8fzTc7UQ8aFRCL46z3wTmVgD98/EZQWz0HLRYsC4KGjxZz\
ljaCZT5dRIVVmB4+H0ArSn+yucgtvYX9RWgNF7zYeBZfbCrkUZZxbPAhMjTyLXz4parI8Kh+g5L9XGXk\
VBYtz49WAz5ChrqVnRH5scPIJGutbEejamux35B9dfNxvqsROU5DliRZM+W/vZWsKjKcn2R9ggyRlZlL\
fhryqUqsk81cyCUQZa2nR+eE/ayi8Duzq2RZXgf2Tj9TqcMxVHaacZvgmLrzWZ+rZncPlayVqtkXHcia\
K8k6VrVYNzQOV77cS7X4SnI5v+1ZX6tW31wiuNwoO1l1aB3IvyfrSFYAnW/Vhr5rd5bHswyf7J6+Hhqh\
naxI8Pb9vRrkB/N8E7T5EOMANdiPve3N8s2vWz8p4m5wo+y8cDWM099Yxfx8NCjfynzqlY0vIjMVtcZ4\
zlnuxsYp/JJWhdolD7fJUcJvIZfl+jawof/WgLvC9BIeC9rwJSV+VTovvgDGt5vlgLn0N6W1C6i6zaxR\
oC5TGc4CE1nMqoF6/mCV4aJLwPjWsvodULuoTHuAqlrKCjRVpymD80B5gYWsegXcfr8L/nkBFzXCPFlh\
sMx39PuSRkdCqxhVR40aVYkc2PWHEpiEv9qDZ4BcozAAwO+1zffatpndkq0p7UPTv+U929qz7bHlt5mx\
tscP55z4PIwlhgAH3jJkKj4OOKkcR5bsgSP5R2SnHDhTeCArncBDEzJyCnhpQSY+/QR+viIDr4G3KKTu\
bgrw14WUnQRBwpVIkUcXCPRZhdSoroBg6lGkJEkDInhrkYr/gyCO8ziSl68DsY70IWH6BiDg57FiJOm/\
AcgIvOCBpOibXwIxNUYkw2QGkl40WVA8qwZIm4q+jeLE+74ACmw3plG4mUc2oERXNovCOGUCVaHaD8jX\
h7yjQJ2uSqJE7vzOZ+qAjbcNX+eQC0/JPxswNT8R9BS38vF35+cB2AnZC76TQY64zu1beTeuwk67VnNl\
8V7M0tkzp0+dPHF8+f4KHDoEq3MUjwHy2w4OAAAAAElFTkSuQmCC\
';



// https://github.com/swagger-api/swagger-ui/blob/v2.1.3/dist/images/logo_small.png
local.templateSwaggerUiLogoSmallBase64 = '\
iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFn\
ZVJlYWR5ccllPAAAAqRJREFUeNrEVz1s00AUfnGXii5maMXoEUEHVwIpEkPNgkBdMnQoU5ytiKHJwpp2\
Q2JIO8DCUDOxIJFIVOoWZyJSh3pp1Q2PVVlcCVBH3ufeVZZ9Zye1Ay86nXV+ue/9fO/lheg/Se02X1rv\
ksmbnTiKvuxQMBNgBnN4a/LCbmnUAP6JV58NCUsBC8CuAJxGPF47OgNqBaA93tolUhnx6jC4NxGwyOEw\
lccyAs+3kwdzKq0HDn2vEBTi8J2XpyMaywNDE157BhXUE3zJhlq8GKq+Zd2zaWHepPA8oN9XkfLmRdOi\
JV4XUUg/IyWncLjCYY/SHndV2u7zHr3bPKZtdxgboJOnthvrfGj/oMf3G0r7JVmNlLfKklmrt2MvvcNO\
7LFOhoFHfuAJI5o6ta10jpt5CQLgwXhXG2YIwvu+34qf78ybOjWTnWwkgR36d7JqJOrW0hHmNrKg9xhi\
S4+1jFmrxymh03B0w+6kURIAu3yHtOD5oaUNojMnGgbcctNvwdAnyxvxRR+/vaJnjzbpzcZX+nN1SdGv\
85i9eH8w3qPO+mdm/y4dnQ1iI8Fq6Nf4cxL6GWSjiFDSs0VRnxC5g0xSB2cgHpaseTxfqOv5uoHkNQ6H\
a/N1Yz9mNMppEkEkYKj79q6uCq4bCHcSX3fJ0Vk/k9siASjCm1N6gZH6Ec9IXt2WkFES2K/ixoIyktJP\
Au/ptOA1SgO5zqtr6KASJPF0nMV8dgMsRhRPOcMwqQAOoi0VAIMLAEWJ6YYC1c8ibj1GP51RqwzYwZVM\
HQuvOzMCBUtb2tGHx5NAdLKqp5AX7Ng4d+Zi8AGDI9z1ijx9yaCH04y3GCP2S+QcvaGl+pcxyUBvinFl\
awoDQjHSelX8hQEoIrAq8p/mgC88HOS1YCl/BRgAmiD/1gn6Nu8AAAAASUVORK5CYII=\
';



// https://github.com/swagger-api/swagger-ui/blob/v2.1.3/src/main/template/main.handlebars
local.templateUiMain = '\
<!-- <div class="swggUiContainer"> -->\n\
<h2 class="eventDelegateSubmit hXxx thead" data-onevent="onEventUiReload">\n\
    <a class="td td1" href="https://github.com/kaizhu256/node-swgg" target="_blank">swgg</a>\n\
    <input\n\
        class="td td2"\n\
        placeholder="http://petstore.swagger.io/v2/swagger.json"\n\
        type="text"\n\
        value="{{urlSwaggerJson}}"\n\
    >\n\
    <input\n\
        class="td td3"\n\
        id="swggApiKeyInput1"\n\
        placeholder="api-key"\n\
        type="text"\n\
        value="{{apiKeyValue}}"\n\
    >\n\
    <button class="button eventDelegateClick td td4" data-onevent="onEventUiReload">explore</button>\n\
    <button\n\
        class="button eventDelegateClick td td5" data-onevent="onEventUiReload"\n\
        id="swggApiKeyClearButton1"\n\
    >\n\
        clear api-keys\n\
    </button>\n\
</h2>\n\
<div\n\
    class="colorError"\n\
    id="swggUiReloadErrorDiv1"\n\
    style="background: none; border: 0;"\n\
></div>\n\
<div class="eventDelegateClick info reset">\n\
    {{#if info}}\n\
    {{#if info.x-swgg-homepage}}\n\
    <h2 class="hXxx">\n\
        <a href="{{info.x-swgg-homepage}}" target="_blank">{{info.title}} ({{info.version}})</a>\n\
    </h2>\n\
    {{#unless info.x-swgg-homepage}}\n\
    <h2 class="hXxx">{{info.title}} ({{info.version}})</h2>\n\
    {{/if info.x-swgg-homepage}}\n\
    {{#if info.x-swgg-description}}\n\
    <div class="markdown">{{info.x-swgg-description markdownToHtml}}</div>\n\
    {{/if info.x-swgg-description}}\n\
    {{#if info.description}}\n\
    <div class="description markdown">{{info.description markdownToHtml}}</div>\n\
    {{/if info.description}}\n\
    {{#if x-swgg-downloadStandaloneApp}}\n\
    <a class="button" download href="{{x-swgg-downloadStandaloneApp notHtmlSafe}}">\n\
        download standalone app\n\
    </a><br>\n\
    {{/if x-swgg-downloadStandaloneApp}}\n\
    {{#if x-swgg-onEventDomDb}}\n\
    <button class="button" data-onevent="onEventDomDb" data-onevent-db="dbReset">reset database</button><br>\n\
    <button class="button" data-onevent="onEventDomDb" data-onevent-db="dbExport">export database -&gt; file</button><br>\n\
    <button class="button" data-onevent="onEventDomDb" data-onevent-db="dbImport">import database &lt;- file</button><br>\n\
    {{/if x-swgg-onEventDomDb}}\n\
    <ul>\n\
        {{#if externalDocs.url}}\n\
        <li>\n\
            <a href="{{externalDocs.url}}" target="_blank">\n\
                {{#if externalDocs.description}}\n\
                {{externalDocs.description}}\n\
                {{#unless externalDocs.description}}\n\
                external url\n\
                {{/if externalDocs.description}}\n\
            </a>\n\
        </li>\n\
        {{/if externalDocs.url}}\n\
        {{#if info.termsOfService}}\n\
        <li><a target="_blank" href="{{info.termsOfService}}">terms of service</a></li>\n\
        {{/if info.termsOfService}}\n\
        {{#if info.contact.name}}\n\
        <li>created by {{info.contact.name}}</li>\n\
        {{/if info.contact.name}}\n\
        {{#if info.contact.url}}\n\
        <li>see more at <a href="{{info.contact.url}}">{{info.contact.url}}</a></li>\n\
        {{/if info.contact.url}}\n\
        {{#if info.contact.email}}\n\
        <li>\n\
            <a\n\
                target="_parent"\n\
                href="mailto:{{info.contact.email}}?subject={{info.title}}"\n\
            >\n\
                contact the developer\n\
            </a>\n\
        </li>\n\
        {{/if info.contact.email}}\n\
        {{#if info.license}}\n\
        <li><a target="_blank" href="{{info.license.url}}">{{info.license.name}}</a></li>\n\
        {{/if info.license}}\n\
    </ul>\n\
    {{/if info}}\n\
</div>\n\
{{#if urlSwaggerJson}}\n\
<h4 class="label">nodejs initialization</h4>\n\
<pre id="swggAjaxProgressPre1" tabIndex="0">\n\
/*\n\
 * initialize nodejs swgg-client\n\
 * 1. download currently-loaded apis to file swagger.json:\n\
 *     $ curl -L -o swagger.json "{{urlSwaggerJson}}"\n\
 * 2. npm install swgg\n\
 *     $ npm install swgg\n\
 * 3. run code below to initialize nodejs swgg-client\n\
 * 4. (optional) edit file swagger.json to suit your needs\n\
 */\n\
var swgg;\n\
swgg = require("swgg");\n\
swgg.apiUpdate(require("./swagger.json"));\n\
console.log("printing currently loaded apis ...");\n\
Object.keys(swgg.apiDict).sort().forEach(function (key) {\n\
    console.log("swgg.apiDict[" + JSON.stringify(key) + "].ajax");\n\
});\n\
console.log("initialized nodejs swgg-client");\n\
</pre>\n\
<div class="color777 reset">[ <span>base url</span>: {{basePath}} ]</div>\n\
{{/if urlSwaggerJson}}\n\
<div id="swggAjaxProgressDiv1" style="text-align: center;">\n\
    <span>{{ajaxProgressText}}</span>\n\
    <div class="uiAnimateSpin" style="animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: inline-block; height: 25px; vertical-align: middle; width: 25px;"></div>\n\
</div>\n\
<ol class="reset resourceList" style="list-style-type: upper-roman;"></ol>\n\
<div class="utility2FooterDiv">\n\
    [ this document was created with\n\
    <a href="https://github.com/kaizhu256/node-swgg" target="_blank">swgg</a>\n\
    ]\n\
</div>\n\
<!-- </div> -->\n\
';



// https://github.com/swagger-api/swagger-ui/blob/v2.1.3/src/main/template/operation.handlebars
local.templateUiOperation = '\
<div class="operation" data-_method-path="{{_methodPath}}" id="{{id}}">\n\
<div class="thead" data-onevent="onEventOperationDisplayShow" tabindex="0">\n\
    <span class="td td1"></span>\n\
    <span class="method{{_method}} td td2">{{_method}}</span>\n\
    <span\n\
        class="td td3"\n\
        {{#if deprecated}}style="text-decoration: line-through;"{{/if deprecated}}\n\
    >\n\
        {{_path}}\n\
    </span>\n\
    <span class="color777 td td4 textOverflowEllipsis">{{summary}}</span>\n\
</div>\n\
<form accept-charset="UTF-8"\n\
    class="onEventInputValidateAndAjax uiAnimateSlide"\n\
    style="border-bottom: 0; border-top: 0; margin-bottom: 0; margin-top: 0; max-height: 0; padding-bottom: 0; padding-top: 0;"\n\
>\n\
    {{#if deprecated}}\n\
    <h4 class="colorError label">(warning: deprecated)</h4><br>\n\
    {{/if deprecated}}\n\
    <h4 class="label">description</h4>\n\
    <div class="description markdown">\n\
        {{description markdownToHtml}}\n\
    </div>\n\
    {{#if parameters.length}}\n\
    <h4 class="label">parameters</h4>\n\
    <div class="borderBottom1Px color777 schemaP thead">\n\
        <span class="td td1">name and description</span>\n\
        <span class="td td2">data type</span>\n\
        <span class="td td3">value</span>\n\
        <span class="td td4">schema</span>\n\
    </div>\n\
    {{#each parameters}}\n\
    {{innerHTML notHtmlSafe}}\n\
    {{/each parameters}}\n\
    {{/if parameters.length}}\n\
    <h4 class="label">response messages</h4>\n\
    <div class="borderBottom1Px color777 schemaResponse thead">\n\
        <span class="td td1">http status code</span>\n\
        <span class="td td2">reason</span>\n\
    </div>\n\
    {{#each responseList}}\n\
    <div class="schemaResponse tr">\n\
        <span class="td td1">{{key}}</span>\n\
        <span class="markdown td td2">{{value.description markdownToHtml}}</span>\n\
    </div>\n\
    {{/each responseList}}\n\
    <button class="button" data-onevent="onEventOperationAjax">try it out!</button>\n\
    <h4 class="label">nodejs request</h4>\n\
    <pre class="reqJs" tabIndex="0"></pre>\n\
    <h4 class="label">curl request</h4>\n\
    <pre class="reqCurl" tabIndex="0"></pre>\n\
    <h4 class="label">response status code</h4>\n\
    <pre class="resStatusCode" tabindex="0"></pre>\n\
    <h4 class="label">response headers</h4>\n\
    <pre class="resHeaders" tabIndex="0"></pre>\n\
    <h4 class="label">response body</h4>\n\
    <pre class="resBody" tabIndex="0"></pre>\n\
    <div class="resMedia"></div>\n\
</form>\n\
</div>\n\
';



// https://github.com/swagger-api/swagger-ui/blob/v2.1.3/src/main/template/param.handlebars
local.templateUiParameter = '\
<div class="schemaP tr" id="{{id}}" data-name="{{name}}">\n\
<span class="td td1">\n\
    {{name}}\n\
    {{#if required}}<br><span style="font-weight: bold;">(required)</span>{{/if required}}\n\
    {{#if description}}\n\
    <br>\n\
    <span class="color777 markdown">{{description markdownToHtml}}</span>\n\
    {{/if description}}\n\
</span>\n\
<span class="td td2">{{type2}}{{#if format2}}<br>({{format2}}){{/if format2}}</span>\n\
<span class="td td3" data-onevent="onEventInputValidateAndAjax">\n\
    {{#if isTextarea}}\n\
    <div class="multilinePlaceholderContainer">\n\
        <pre class="multilinePlaceholderPre">{{placeholder}}</pre>\n\
        <textarea\n\
            class="input multilinePlaceholderTextarea textarea" data-onevent="onEventInputTextareaChange"\n\
            data-value-text="{{valueText encodeURIComponent notHtmlSafe}}"\n\
        ></textarea>\n\
    </div>\n\
    {{/if isTextarea}}\n\
    {{#if isFile}}<input class="input" type="file">{{/if isFile}}\n\
    {{#if enum2}}\n\
    <select class="input" {{#if isSelectMultiple}}multiple{{/if isSelectMultiple}}>\n\
        {{#each selectOptionList}}\n\
        <option\n\
            data-value-select-option=\n\
                "{{valueSelectOption jsonStringify encodeURIComponent notHtmlSafe}}"\n\
            id="{{id}}"\n\
            {{selected}}\n\
        >{{placeholder}}</option>\n\
        {{/each selectOptionList}}\n\
    </select>\n\
    {{/if enum2}}\n\
    {{#if isInputNumber}}\n\
    <input\n\
        class="input"\n\
        data-value-text="{{valueText encodeURIComponent notHtmlSafe}}"\n\
        placeholder="{{placeholder}}"\n\
        type="number"\n\
    >\n\
    {{/if isInputNumber}}\n\
    {{#if isInputText}}\n\
    <input\n\
        class="input"\n\
        data-value-text="{{valueText encodeURIComponent notHtmlSafe}}"\n\
        placeholder="{{placeholder}}"\n\
        type="text"\n\
    >\n\
    {{/if isInputText}}\n\
    <div class="colorError"></div>\n\
</span>\n\
<span class="td td4">\n\
    {{#if schemaText}}<pre tabIndex="0">{{schemaText}}</pre>{{/if schemaText}}\n\
</span>\n\
</div>\n\
';



local.templateUiReqJs = '\
/*\n\
 * reproduce api-call {{opt.api._methodPath jsonStringify}}\n\
 * 1. initialize nodejs swgg-client from previous step\n\
 * 2. run code below to reproduce api-call\n\
 */\n\
swgg.apiDict[{{opt.api._methodPath jsonStringify}}].ajax({{optionJson}}, \
function (err, data) {\n\
    if (err) {\n\
        console.error(err);\n\
        return;\n\
    }\n\
    console.log(data.responseJson || data.responseText);\n\
}\
);\n\
';



// https://github.com/swagger-api/swagger-ui/blob/v2.1.3/src/main/template/resource.handlebars
local.templateUiResource = '\
<li\n\
    class="eventDelegateChange eventDelegateClick eventDelegateKeyup eventDelegateSubmit resource"\n\
    data-name="{{name}}"\n\
    id="{{id}}"\n\
>\n\
<h3 class="thead">\n\
    <span class="td td1 textOverflowEllipsis" data-onevent="onEventResourceDisplayAction" tabindex="0">\n\
        {{name}}:&nbsp;&nbsp;{{summary}}\n\
    </span>\n\
    <span class="td td2" data-onevent="onEventResourceDisplayAction" tabindex="0">\n\
    expand / collapse operations\n\
    </span>\n\
</h3>\n\
<ol\n\
    class="operationList uiAnimateSlide"\n\
    style="border-bottom: 0; border-top: 0; margin-bottom: 0; margin-top: 0; max-height: 0; padding-bottom: 0; padding-top: 0;"\n\
>\n\
    <div class="description markdown">{{description markdownToHtml}}</div>\n\
</ol>\n\
</li>\n\
';



local.templateUiTitle = '\
{{#if info.title}}\n\
{{#if info.version}}\n\
{{info.title}} ({{info.version}})\n\
{{#unless info.version}}\n\
{{info.title}}\n\
{{/if info.version}}\n\
{{#unless info.title}}\n\
swgg\n\
{{/if info.title}}\n\
';



/* validateLineSortedReset */
local.assetsDict["/assets.swgg.html"] = local.assetsDict["/assets.utility2.template.html"]
    .replace("assets.utility2.template.html", "")
    .replace((/<title>.*?<\/title>/), "<title>swgg</title>")
    .replace("\n<!-- utility2-comment\n", "\n")
    .replace("\n</style>\n", '\
\n\
</style>\n\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
*/\n\
/* csslint ignore:start */\n\
.swggUiContainer,\n\
.swggUiContainer * {\n\
    border: 0;\n\
    border-radius: 0;\n\
    margin: 0;\n\
    max-width: 100%;\n\
    padding: 0;\n\
}\n\
.swggUiContainer pre,\n\
.swggUiContainer .operation > .thead:focus,\n\
.swggUiContainer .resource > .thead > .td:focus {\n\
    outline: none;\n\
}\n\
.swggUiContainer .description > * {\n\
    margin-top: 20px;\n\
}\n\
.swggUiContainer .description > *:first-child {\n\
    margin-top: 0;\n\
}\n\
/* csslint ignore:end */\n\
/* validateLineSortedReset */\n\
/* general */\n\
.swggUiContainer code,\n\
.swggUiContainer pre,\n\
.swggUiContainer textarea {\n\
    line-height: 1.25rem;\n\
    max-height: 50rem;\n\
    overflow: auto;\n\
}\n\
.swggUiContainer input,\n\
.swggUiContainer pre,\n\
.swggUiContainer textarea {\n\
    min-height: 1.5rem;\n\
}\n\
.swggUiContainer pre {\n\
    white-space: pre;\n\
}\n\
.swggUiContainer .button,\n\
.swggUiContainer .operation > .thead,\n\
.swggUiContainer .resource > .thead {\n\
    cursor: pointer;\n\
}\n\
.swggUiContainer .button,\n\
.swggUiContainer .operation > .thead > .td3,\n\
.swggUiContainer .resource > .thead > .td {\n\
    font-weight: bold;\n\
    text-decoration: underline;\n\
}\n\
.swggUiContainer .markdown pre {\n\
    max-height: none;\n\
}\n\
.swggUiContainer .multilinePlaceholderContainer {\n\
    min-height: 10rem;\n\
    position: relative;\n\
}\n\
.swggUiContainer .multilinePlaceholderPre {\n\
    position: absolute;\n\
    white-space: pre;\n\
}\n\
.swggUiContainer .multilinePlaceholderTextarea {\n\
    position: absolute;\n\
}\n\
.swggUiContainer .operation > .thead > .td1 {\n\
    text-align: left;\n\
    width: 2rem;\n\
}\n\
.swggUiContainer .operation > .thead > .td2 {\n\
    text-align: center;\n\
    width: 5rem;\n\
}\n\
.swggUiContainer .resBody,\n\
.swggUiContainer .resHeaders,\n\
.swggUiContainer .resStatusCode {\n\
    font-weight: bold;\n\
}\n\
.swggUiContainer .schemaP pre,\n\
.swggUiContainer .schemaP select[multiple],\n\
.swggUiContainer .schemaP textarea,\n\
.swggUiContainer .schemaP .multilinePlaceholderContainer {\n\
    height: 10rem;\n\
}\n\
.swggUiContainer .schemaP > .td3 {\n\
    overflow: visible;\n\
}\n\
.swggUiContainer .td {\n\
    overflow: auto;\n\
    overflow-wrap: break-word;\n\
}\n\
.swggUiContainer .td input,\n\
.swggUiContainer .td pre,\n\
.swggUiContainer .td select,\n\
.swggUiContainer .td textarea {\n\
    width: 100%;\n\
}\n\
.swggUiContainer .zeroPixel {\n\
    border: 0;\n\
    height: 0;\n\
    margin: 0;\n\
    padding: 0;\n\
    width: 0;\n\
}\n\
/* validateLineSortedReset */\n\
/* background */\n\
.swggUiContainer code,\n\
.swggUiContainer pre {\n\
    background: #ddd;\n\
}\n\
.swggUiContainer .button {\n\
    background: #ddf;\n\
}\n\
.swggUiContainer .description {\n\
    background: #bdb;\n\
}\n\
.swggUiContainer .methodDELETE {\n\
    background: #b07;\n\
}\n\
.swggUiContainer .methodGET {\n\
    background: #373;\n\
}\n\
.swggUiContainer .methodHEAD {\n\
    background: #7b7;\n\
}\n\
.swggUiContainer .methodOPTIONS {\n\
    background: #777;\n\
}\n\
.swggUiContainer .methodPATCH {\n\
    background: #99f;\n\
}\n\
.swggUiContainer .methodPOST {\n\
    background: #33d;\n\
}\n\
.swggUiContainer .methodPUT {\n\
    background: #77d;\n\
}\n\
.swggUiContainer .multilinePlaceholderPre {\n\
    background: #fff;\n\
}\n\
.swggUiContainer .operation {\n\
    background: #dfd;\n\
}\n\
.swggUiContainer .resource > .thead,\n\
.swggUiContainer > .thead {\n\
    background: #7b7;\n\
}\n\
.swggUiContainer > .info > .button {\n\
    width: 20rem;\n\
}\n\
.swggUiContainer > .thead > .td1 {\n\
    background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAqRJREFUeNrEVz1s00AUfnGXii5maMXoEUEHVwIpEkPNgkBdMnQoU5ytiKHJwpp2Q2JIO8DCUDOxIJFIVOoWZyJSh3pp1Q2PVVlcCVBH3ufeVZZ9Zye1Ay86nXV+ue/9fO/lheg/Se02X1rvksmbnTiKvuxQMBNgBnN4a/LCbmnUAP6JV58NCUsBC8CuAJxGPF47OgNqBaA93tolUhnx6jC4NxGwyOEwlccyAs+3kwdzKq0HDn2vEBTi8J2XpyMaywNDE157BhXUE3zJhlq8GKq+Zd2zaWHepPA8oN9XkfLmRdOiJV4XUUg/IyWncLjCYY/SHndV2u7zHr3bPKZtdxgboJOnthvrfGj/oMf3G0r7JVmNlLfKklmrt2MvvcNO7LFOhoFHfuAJI5o6ta10jpt5CQLgwXhXG2YIwvu+34qf78ybOjWTnWwkgR36d7JqJOrW0hHmNrKg9xhiS4+1jFmrxymh03B0w+6kURIAu3yHtOD5oaUNojMnGgbcctNvwdAnyxvxRR+/vaJnjzbpzcZX+nN1SdGv85i9eH8w3qPO+mdm/y4dnQ1iI8Fq6Nf4cxL6GWSjiFDSs0VRnxC5g0xSB2cgHpaseTxfqOv5uoHkNQ6Ha/N1Yz9mNMppEkEkYKj79q6uCq4bCHcSX3fJ0Vk/k9siASjCm1N6gZH6Ec9IXt2WkFES2K/ixoIyktJPAu/ptOA1SgO5zqtr6KASJPF0nMV8dgMsRhRPOcMwqQAOoi0VAIMLAEWJ6YYC1c8ibj1GP51RqwzYwZVMHQuvOzMCBUtb2tGHx5NAdLKqp5AX7Ng4d+Zi8AGDI9z1ijx9yaCH04y3GCP2S+QcvaGl+pcxyUBvinFlawoDQjHSelX8hQEoIrAq8p/mgC88HOS1YCl/BRgAmiD/1gn6Nu8AAAAASUVORK5CYII=) no-repeat left center;\n\
}\n\
/* validateLineSortedReset */\n\
/* border */\n\
.swggUiContainer input,\n\
.swggUiContainer pre,\n\
.swggUiContainer select,\n\
.swggUiContainer textarea {\n\
    border: 1px solid #999;\n\
}\n\
.swggUiContainer .borderBottom1Px {\n\
    border-bottom: 1px solid #777;\n\
}\n\
.swggUiContainer .button {\n\
    border: 1px solid #35b;\n\
    border-radius: 5px;\n\
}\n\
.swggUiContainer .resource > .thead > .td2 {\n\
    border-left: 1px solid #333;\n\
}\n\
/* validateLineSortedReset */\n\
/* color */\n\
.swggUiContainer a,\n\
.swggUiContainer .button,\n\
.swggUiContainer .operation > .thead,\n\
.swggUiContainer .resource > .thead {\n\
    color: #35b;\n\
}\n\
.swggUiContainer code {\n\
    color: #333;\n\
}\n\
.swggUiContainer .color777 {\n\
    color: #777;\n\
}\n\
.swggUiContainer .label {\n\
    color: #373;\n\
}\n\
.swggUiContainer .multilinePlaceholderPre {\n\
    color: #999;\n\
}\n\
.swggUiContainer .operation > .thead > .td2,\n\
.swggUiContainer .resource > .thead,\n\
.swggUiContainer > .thead > .td1 {\n\
    color: #fff;\n\
}\n\
.swggUiContainer .thead,\n\
.swggUiContainer .tr {\n\
    display: flex;\n\
}\n\
/* validateLineSortedReset */\n\
/* flex */\n\
.swggUiContainer .operation > .thead > .td3 {\n\
    flex: 1;\n\
}\n\
.swggUiContainer .operation > .thead > .td4 {\n\
    flex: 1;\n\
}\n\
.swggUiContainer .resource > .thead > .td1 {\n\
    flex: 1;\n\
}\n\
.swggUiContainer .schemaP > .td1 {\n\
    flex: 2;\n\
}\n\
.swggUiContainer .schemaP > .td2 {\n\
    flex: 1;\n\
}\n\
.swggUiContainer .schemaP > .td3 {\n\
    flex: 4;\n\
}\n\
.swggUiContainer .schemaP > .td4 {\n\
    flex: 3;\n\
}\n\
.swggUiContainer .schemaResponse > .td1 {\n\
    flex: 1;\n\
}\n\
.swggUiContainer .schemaResponse > .td2 {\n\
    flex: 4;\n\
}\n\
.swggUiContainer > .thead > .td2 {\n\
    flex: 4;\n\
}\n\
.swggUiContainer > .thead > .td3 {\n\
    flex: 1;\n\
}\n\
/* validateLineSortedReset */\n\
/* margin */\n\
.swggUiContainer li {\n\
    margin-top: 10px;\n\
}\n\
.swggUiContainer ol,\n\
.swggUiContainer ul,\n\
.swggUiContainer .td {\n\
    margin-left: 20px;\n\
}\n\
.swggUiContainer .description,\n\
.swggUiContainer .label,\n\
.swggUiContainer .operation,\n\
.swggUiContainer .operation > form > div,\n\
.swggUiContainer .operation > form > pre,\n\
.swggUiContainer .resource,\n\
.swggUiContainer > div,\n\
.swggUiContainer > ol,\n\
.swggUiContainer > pre,\n\
.swggUiContainer > .info > div,\n\
.swggUiContainer > .info > ul,\n\
.swggUiContainer > .info > .button,\n\
.swggUiContainer > .info > .hXxx {\n\
    margin-top: 20px;\n\
}\n\
.swggUiContainer .label {\n\
    margin-bottom: -19px;\n\
}\n\
.swggUiContainer .operation > form > .button {\n\
    margin: 40px 0 20px 0;\n\
}\n\
.swggUiContainer .resource > ol,\n\
.swggUiContainer .resource > .thead > .td,\n\
.swggUiContainer .td:first-child,\n\
.swggUiContainer > ol {\n\
    margin-left: 0;\n\
}\n\
.swggUiContainer .resource > ol > .description {\n\
    margin-top: 0;\n\
}\n\
/* validateLineSortedReset */\n\
/* padding */\n\
.swggUiContainer code {\n\
    padding: 2px;\n\
}\n\
.swggUiContainer input {\n\
    padding: 0 5px;\n\
}\n\
.swggUiContainer pre,\n\
.swggUiContainer textarea {\n\
    padding: 5px;\n\
}\n\
.swggUiContainer .button,\n\
.swggUiContainer .resource > .thead > .td,\n\
.swggUiContainer > .thead {\n\
    padding: 10px 20px;\n\
}\n\
.swggUiContainer .description {\n\
    padding: 20px;\n\
}\n\
.swggUiContainer .operation > form {\n\
    padding: 0 20px;\n\
}\n\
.swggUiContainer .operation > form .td1 {\n\
    padding-left: 0;\n\
}\n\
.swggUiContainer .operation > .thead {\n\
    padding: 0 20px;\n\
}\n\
.swggUiContainer .operation > .thead > .td {\n\
    padding: 10px 0;\n\
}\n\
.swggUiContainer > .thead > .td1 {\n\
    padding-left: 40px;\n\
    padding-top: 4px;\n\
}\n\
/* validateLineSortedReset */\n\
/* .textOverflowEllipsis */\n\
.swggUiContainer .textOverflowEllipsis {\n\
    overflow: hidden;\n\
    text-overflow: ellipsis;\n\
    white-space: nowrap;\n\
}\n\
/* validateLineSortedReset */\n\
/* @media */\n\
@media screen and (max-width: 640px) {\n\
    .swggUiContainer .operation {\n\
        font-size: small;\n\
    }\n\
    .swggUiContainer .resource > .thead > .td {\n\
        flex: 1;\n\
    }\n\
    .swggUiContainer > .thead {\n\
        display: block;\n\
        padding: 0;\n\
    }\n\
    .swggUiContainer > .thead > .td {\n\
        display: block;\n\
        margin: 0;\n\
        width: 100%;\n\
    }\n\
}\n\
/* validateLineSortedReset */\n\
/* hover */\n\
.swggUiContainer a:hover,\n\
.swggUiContainer .resource > .thead > .td:hover,\n\
.swggUiContainer > .thead > .td1:hover {\n\
    color: #037;\n\
}\n\
.swggUiContainer .button:hover,\n\
.swggUiContainer .operation > .thead:hover {\n\
    background: #bbf;\n\
}\n\
/* validateLineSortedReset */\n\
/* err */\n\
.swggUiContainer button.hasError,\n\
.swggUiContainer pre.hasError,\n\
.swggUiContainer textarea.hasError {\n\
    background: #fbb;\n\
}\n\
.swggUiContainer input.hasError,\n\
.swggUiContainer select.hasError {\n\
    border: 5px solid #d00;\n\
}\n\
</style>\n\
')
    .replace((/\n<\/script>\n[\S\s]*\n<\/html>\n/), '\
\n\
</script>\n\
<div class="swggUiContainer" style="margin: 0 auto; max-width: 1200px;">\n\
' + local.templateRender(local.templateUiMain, {
    ajaxProgressText: "loading script",
    apiKeyValue: "",
    urlSwaggerJson: ""
}) + '\
</div>\n\
<script>\n\
/* jslint utility2:true */\n\
// init domOnEventMediaHotkeys\n\
(function () {\n\
/*\n\
 * this function will add media-hotkeys to elements\n\
 * with class=".domOnEventMediaHotkeysInit"\n\
 */\n\
    "use strict";\n\
    var currentTarget;\n\
    var identity;\n\
    var input;\n\
    var onEvent;\n\
    if (window.domOnEventMediaHotkeys) {\n\
        return;\n\
    }\n\
    identity = function (value) {\n\
    /*\n\
     * this function will return <value>\n\
     */\n\
        return value;\n\
    };\n\
    window.domOnEventMediaHotkeys = function (evt) {\n\
        var media;\n\
        if (evt === "init") {\n\
            Array.from(document.querySelectorAll(\n\
                ".domOnEventMediaHotkeysInit"\n\
            )).forEach(function (media) {\n\
                media.classList.remove("domOnEventMediaHotkeysInit");\n\
                media.classList.add("domOnEventMediaHotkeys");\n\
                [\n\
                    "play", "pause", "seeking"\n\
                ].forEach(function (evt) {\n\
                    media.addEventListener(evt, onEvent);\n\
                });\n\
            });\n\
            return;\n\
        }\n\
        if (evt.currentTarget.classList.contains("domOnEventMediaHotkeys")) {\n\
            currentTarget = evt.currentTarget;\n\
            input.focus();\n\
            return;\n\
        }\n\
        media = currentTarget;\n\
        try {\n\
            switch (evt.key || evt.type) {\n\
            case ",":\n\
            case ".":\n\
                media.currentTime += (\n\
                    evt.key === "," && identity(-0.03125)\n\
                ) || 0.03125;\n\
                break;\n\
            case "<":\n\
            case ">":\n\
                media.playbackRate *= (\n\
                    evt.key === "<" && identity(0.5)\n\
                ) || 2;\n\
                break;\n\
            case "ArrowDown":\n\
            case "ArrowUp":\n\
                media.volume += (\n\
                    evt.key === "ArrowDown" && identity(-0.05)\n\
                ) || 0.05;\n\
                break;\n\
            case "ArrowLeft":\n\
            case "ArrowRight":\n\
                media.currentTime += (\n\
                    evt.key === "ArrowLeft" && identity(-5)\n\
                ) || 5;\n\
                break;\n\
            case "j":\n\
            case "l":\n\
                media.currentTime += (evt.key === "j" && identity(-10)) || 10;\n\
                break;\n\
            case "k":\n\
            case " ":\n\
                if (media.paused) {\n\
                    media.play();\n\
                } else {\n\
                    media.pause();\n\
                }\n\
                break;\n\
            case "m":\n\
                media.muted = !media.muted;\n\
                break;\n\
            default:\n\
                if (evt.key >= 0) {\n\
                    media.currentTime = 0.1 * evt.key * media.duration;\n\
                    break;\n\
                }\n\
                return;\n\
            }\n\
        } catch (ignore) {}\n\
        evt.preventDefault();\n\
    };\n\
    onEvent = window.domOnEventMediaHotkeys;\n\
    input = document.createElement("button");\n\
    input.style = (\n\
        "border:0;height:0;margin:0;padding:0;position:fixed;width:0;"\n\
        + "z-index:-1;"\n\
    );\n\
    input.addEventListener("click", onEvent);\n\
    input.addEventListener("keydown", onEvent);\n\
    document.body.appendChild(input);\n\
    onEvent("init");\n\
}());\n\
\n\
\n\
\n\
document.querySelector(\n\
    ".swggUiContainer > .thead > .td2"\n\
).value = ((\n\
    /\\bmodeSwaggerJsonUrl=([^&]+)|$/gm\n\
).exec(location.search)[1] || "assets.swgg.swagger.json");\n\
</script>\n\
<script src="assets.utility2.rollup.js"></script>\n\
<script>\n\
/* jslint utility2:true */\n\
window.local = window.local || window.swgg;\n\
window.swgg.uiEventListenerDict.onEventUiReload({\n\
    swggInit: true\n\
});\n\
</script>\n\
<!-- swgg-script-extra-begin -->\n\
<!-- swgg-script-extra-end -->\n\
</body>\n\
</html>\n\
');
/* jslint ignore:end */
local.assetsDict[
    "/assets.swgg.swagger.schema.json"
] = local.jsonStringifyOrdered(
    local.objectSetOverride(
        JSON.parse(local.assetsDict["/assets.swgg.json-schema.json"].replace((
            /"\$ref":".*?#/g
        ), "\"$ref\":\"http://json-schema.org/draft-04/schema#")),
        JSON.parse(local.assetsDict["/assets.swgg.schema.json"].replace((
            /"\$ref":".*?#/g
        ), "\"$ref\":\"http://json-schema.org/draft-04/schema#")),
        2
    )
);
local.swaggerSchemaJson = JSON.parse(
    local.assetsDict["/assets.swgg.swagger.schema.json"]
);
}());



// run shared js-env code - function
(function () {
local.apiAjax = function (that, opt, onError) {
/*
 * this function will send a swagger-api ajax-req with the operation that
 */
    var tmp;
    local.objectSetDefault(opt, {
        data: "",
        operation: that,
        paramDict: {},
        url: ""
    });
    if (opt.modeDefault) {
        local.normalizeSwaggerParamDict(opt);
    }
    // try to validate paramDict
    opt.err = local.swaggerValidateDataParameters({
        // normalize paramDict
        data: local.normalizeSwaggerParamDict({
            modeNoDefault: opt.modeNoDefault,
            operation: that,
            paramDict: local.jsonCopy(opt.paramDict)
        }).paramDict,
        dataReadonlyRemove: opt.paramDict,
        prefix: [
            "operation", that._methodPath
        ],
        parameters: that.parameters,
        swaggerJson: local.swaggerJson
    })[0];
    // init default
    local.objectSetDefault(opt, {
        inForm: (
            // ternary-operator
            that._consumes0 === "multipart/form-data"
            ? new local.FormData()
            : ""
        ),
        inHeader: {},
        inPath: that._path.replace((
            /#.*?$/
        ), ""),
        inQuery: "",
        headers: {},
        method: that._method,
        responseType: (
            // ternary-operator
            that._consumes0.indexOf("application/octet-stream") === 0
            ? "arraybuffer"
            : ""
        )
    });
    // init paramDict
    that.parameters.forEach(function (schemaP) {
        tmp = opt.paramDict[schemaP.name];
        if (local.isNullOrUndefined(tmp)) {
            return;
        }
        // serialize array
        if (Array.isArray(tmp) && schemaP.in !== "body") {
            switch (
                schemaP.collectionFormat || schemaP["x-swgg-collectionFormat"]
            ) {
            case "json":
                tmp = JSON.stringify(tmp);
                break;
            case "multi":
                tmp.forEach(function (value) {
                    opt[(
                        // ternary-operator
                        schemaP.in === "formData"
                        ? "inForm"
                        : "inQuery"
                    )] += (
                        "&" + encodeURIComponent(schemaP.name) + "="
                        + encodeURIComponent(
                            local.schemaPItemsType(schemaP) === "string"
                            ? value
                            : JSON.stringify(value)
                        )
                    );
                });
                return;
            case "pipes":
                tmp = tmp.join("|");
                break;
            case "ssv":
                tmp = tmp.join(" ");
                break;
            case "tsv":
                tmp = tmp.join("\t");
                break;
            // default to csv
            default:
                tmp = tmp.join(",");
            }
        } else if (
            typeof tmp !== "string"
            && !(tmp && tmp.constructor === local.Blob)
        ) {
            tmp = JSON.stringify(tmp);
        }
        switch (schemaP.in) {
        case "body":
            opt.inBody = tmp;
            break;
        case "formData":
            switch (that._consumes0) {
            case "application/xml":
                // init xml header
                if (!opt.inForm) {
                    opt.inForm += "<?xml version=\"1.0\"?>";
                }
                opt.inForm += (
                    "\n<" + schemaP.name + ">" + "<![CDATA["
                    + tmp.replace((
                        /\]\]>/g
                    ), "]]&#x3e;") + "]]></" + schemaP.name + ">"
                );
                break;
            case "multipart/form-data":
                opt.inForm.append(schemaP.name, tmp, tmp && tmp.name);
                break;
            default:
                if (opt.inForm) {
                    opt.inForm += "&";
                }
                opt.inForm += (
                    encodeURIComponent(schemaP.name) + "="
                    + encodeURIComponent(tmp)
                );
            }
            break;
        case "header":
            opt.inHeader[encodeURIComponent(schemaP.name.toLowerCase())] = tmp;
            break;
        case "path":
            opt.inPath = opt.inPath
            .replace("{" + schemaP.name + "}", encodeURIComponent(tmp));
            break;
        case "query":
            opt.inQuery += (
                "&" + encodeURIComponent(schemaP.name) + "="
                + encodeURIComponent(tmp)
            );
            break;
        }
    });
    // init data
    opt.data = opt.inBody || opt.inForm;
    // init headers
    local.objectSetOverride(opt.headers, opt.inHeader);
    // init headers - Content-Type
    opt.headers["Content-Type"] = that._consumes0;
    // init headers - Authorization
    opt.jwtEncrypted = opt.jwtEncrypted || local.userJwtEncrypted;
    if (opt.jwtEncrypted) {
        opt.headers.Authorization = (
            opt.headers.Authorization
            || "Bearer " + opt.jwtEncrypted
        );
    }
    // init url
    opt.url = "";
    opt.url += (
        local.identity(
            that["x-swgg-schemes"] || local.swaggerJson.schemes || []
        )[0] || local.urlParse("").protocol.slice(0, -1)
    );
    opt.url += "://";
    opt.url += (
        that["x-swgg-host"]
        || local.swaggerJson.host
        || local.urlParse("").host
    );
    opt.url += local.swaggerJsonBasePath;
    opt.url += opt.inPath + "?" + opt.inQuery.slice(1);
    opt.url = opt.url.replace((
        /\?$/
    ), "");
    if (opt.modeAjax === "validate" || (opt.err && opt.modeAjax !== "ajax")) {
        onError(opt.err);
        return;
    }
    opt.err = null;
    // send ajax-req
    return local.ajax(opt, function (err, xhr) {
        // try to init responseJson
        local.tryCatchOnError(function () {
            xhr.responseJson = JSON.parse(xhr.responseText);
        }, local.nop);
        // init userJwtEncrypted
        local.userJwtEncrypted = (
            xhr.resHeaders["swgg-jwt-encrypted"]
            || local.userJwtEncrypted
        );
        onError(err, xhr);
    });
};

local.apiUpdate = function (swaggerJson) {
/*
 * this function will update the swagger-api dict of api-calls
 */
    var pathDict;
    var tmp;
    swaggerJson = swaggerJson || {};
    // normalize swaggerJson
    swaggerJson = local.normalizeSwaggerJson(swaggerJson, {
        objectSetDescription: function (dict) {
            if (typeof dict === "object" && dict && !dict.$ref) {
                if (Array.isArray(dict["x-swgg-descriptionLineList"])) {
                    dict.description = (
                        dict["x-swgg-descriptionLineList"].join("\n")
                    );
                }
                if (!(
                    dict === swaggerJson.externalDocs
                    || dict === swaggerJson.info
                )) {
                    dict.description = dict.description || "no description";
                }
            }
        }
    });
    // init apiDict
    local.apiDict = local.apiDict || {};
    // init swaggerJson
    local.swaggerJson = local.swaggerJson || {
        "basePath": "/api/v0",
        "definitions": {
            "BuiltinFile": {
                "properties": {
                    "_id": {
                        "readOnly": true,
                        "type": "string"
                    },
                    "_timeCreated": {
                        "format": "date-time",
                        "readOnly": true,
                        "type": "string"
                    },
                    "_timeUpdated": {
                        "format": "date-time",
                        "readOnly": true,
                        "type": "string"
                    },
                    "fileBlob": {
                        "format": "byte",
                        "type": "string"
                    },
                    "fileContentType": {
                        "type": "string"
                    },
                    "fileDescription": {
                        "type": "string"
                    },
                    "fileFilename": {
                        "type": "string"
                    },
                    "fileInputName": {
                        "type": "string"
                    },
                    "fileSize": {
                        "minimum": 0,
                        "type": "integer"
                    },
                    "fileUrl": {
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    }
                }
            },
            "BuiltinJsonapiResponse": {
                "properties": {
                    "data": {
                        "items": {
                            "type": "object"
                        },
                        "type": "array"
                    },
                    "errors": {
                        "items": {
                            "type": "object"
                        },
                        "type": "array"
                    },
                    "meta": {
                        "type": "object"
                    }
                }
            },
            "BuiltinUser": {
                "properties": {
                    "_id": {
                        "readOnly": true,
                        "type": "string"
                    },
                    "_timeCreated": {
                        "format": "date-time",
                        "readOnly": true,
                        "type": "string"
                    },
                    "_timeUpdated": {
                        "format": "date-time",
                        "readOnly": true,
                        "type": "string"
                    },
                    "id": {
                        "type": "string"
                    },
                    "jwtEncrypted": {
                        "type": "string"
                    },
                    "password": {
                        "format": "password",
                        "type": "string"
                    },
                    "username": {
                        "type": "string"
                    }
                }
            }
        },
        "info": {
            "title": "swgg api",
            "version": "0.0.1"
        },
        "paths": {},
        "securityDefinitions": {},
        "swagger": "2.0",
        "tags": []
    };
    // save tags
    tmp = {};
    [
        local.swaggerJson.tags, swaggerJson.tags
    ].forEach(function (tagList) {
        tagList.forEach(function (tag) {
            tmp[tag.name] = local.objectSetOverride(tmp[tag.name], tag);
        });
    });
    local.swaggerJson["x-swgg-tagNameList"] = Object.keys(tmp).sort();
    tmp = local.swaggerJson["x-swgg-tagNameList"].map(function (key) {
        return tmp[key];
    });
    // merge swaggerJson into local.swaggerJson
    swaggerJson = local.objectSetOverride(local.swaggerJson, swaggerJson, 10);
    // restore tags
    local.swaggerJson.tags = tmp;
    // init swaggerJsonBasePath
    local.swaggerJsonBasePath = (
        local.swaggerJson.basePath === "/"
        ? ""
        : local.swaggerJson.basePath
    );
    Object.keys(swaggerJson.definitions).forEach(function (schemaName) {
        swaggerJson.definitions[schemaName] = local.jsonCopy(
            local.swaggerValidateDataSchema({
                // dereference definition
                modeDereference: true,
                prefix: [
                    "swaggerJson", "definitions", schemaName
                ],
                schema: swaggerJson.definitions[schemaName],
                swaggerJson: local.swaggerJson
            })
        );
        tmp = swaggerJson.definitions[schemaName];
        (tmp.allOf || []).forEach(function (element) {
            local.objectSetDefault(
                tmp,
                local.jsonCopy(local.swaggerValidateDataSchema({
                    // dereference definition.allOf
                    modeDereference: true,
                    prefix: [
                        "swaggerJson", "definitions", schemaName, "allOf"
                    ],
                    schema: element,
                    swaggerJson: local.swaggerJson
                })),
                2
            );
        });
        delete tmp.allOf;
    });
    // init apiDict from paths
    Object.keys(swaggerJson.paths).forEach(function (path) {
        Object.keys(swaggerJson.paths[path]).forEach(function (method) {
            var that;
            that = local.jsonCopy(swaggerJson.paths[path][method]);
            that._method = method.toUpperCase();
            that._path = path;
            tmp = "operationId." + that.operationId;
            local.apiDict[tmp] = local.objectSetOverride(
                local.apiDict[tmp],
                that
            );
        });
    });
    // init apiDict from x-swgg-apiDict
    Object.keys(swaggerJson["x-swgg-apiDict"] || {}).forEach(function (key) {
        local.apiDict[key] = local.objectSetOverride(
            local.apiDict[key],
            local.jsonCopy(swaggerJson["x-swgg-apiDict"][key])
        );
    });
    // init apiDict
    Object.keys(local.apiDict).forEach(function (key) {
        var that;
        if (key.indexOf("operationId.") !== 0) {
            return;
        }
        key = key.split(".");
        that = local.apiDict[key.join(".")];
        // init operationId
        that.operationId = that.operationId || key.slice(1).join(".");
        // init _crudType
        that._crudType = that._crudType || key.slice(2);
        that._crudType[0] = that._crudType[0] || that.operationId;
        // init _fileUploadNumber
        that._fileUploadNumber = Number(
            that._crudType[0] === "fileUploadManyByForm" && that._crudType[1]
        ) || 1;
        // init _idBackend and _idName
        tmp = local.idNameInit({
            crudType: that._crudType
        });
        that._idBackend = tmp.idBackend;
        that._idName = tmp.idName;
        // init tags
        that.tags = that.tags || [];
        that.tags[0] = that.tags[0] || key[1];
        // init templateApiDict
        if (local.templateApiDict[that._crudType[0]]) {
            local.objectSetDefault(
                that,
                JSON.parse(local.templateApiDict[that._crudType[0]]
                .replace((
                    /\{\{_fileUploadNumber\}\}/g
                ), that._fileUploadNumber)
                .replace((
                    /\{\{_idBackend\}\}/g
                ), that._idBackend)
                .replace((
                    /\{\{_idName\}\}/g
                ), that._idName)
                .replace((
                    /\{\{_operationId\}\}/g
                ), that.operationId)
                .replace((
                    /\{\{_schemaName\}\}/g
                ), that._schemaName)
                .replace((
                    /\{\{_tags0\}\}/g
                ), that.tags[0]))
            );
        }
        // init default
        local.objectSetDefault(that, {
            _schemaPDict: {},
            consumes: [],
            parameters: [],
            responses: {
                "200": {
                    description: (
                        "ok - http://jsonapi.org/format/#document-top-level"
                    ),
                    schema: {
                        $ref: "#/definitions/BuiltinJsonapiResponse"
                    }
                }
            },
            tags: []
        });
        // init _consumes0
        tmp = that["x-swgg-consumes0"] || (that.consumes && that.consumes[0]);
        that.parameters.some(function (schemaP) {
            tmp = tmp || (
                schemaP.in === "body"
                && schemaP.schema.type === "string"
                && local.identity("text/plain")
            );
            return tmp;
        });
        that._consumes0 = tmp || "application/json";
        // init _methodPath
        that._methodPath = that._method + " " + that._path.replace((
            /\{.*?\}/g
        ), "{}");
        that.parameters.forEach(function (schemaP) {
            // dereference schemaP
            String(schemaP["x-swgg-$ref"] || schemaP.$ref).replace((
                /#\/parameters\/(.+?$)/m
            ), function (ignore, match1) {
                local.objectSetDefault(
                    schemaP,
                    local.jsonCopy(swaggerJson.parameters[match1])
                );
                delete schemaP.$ref;
            });
            // init _idName.format and _idName.type
            if (that._schemaName && schemaP.name === that._idName) {
                schemaP.format = swaggerJson.definitions[
                    that._schemaName
                ].properties[that._idBackend].format;
                schemaP.type = local.schemaPType(
                    swaggerJson.definitions[
                        that._schemaName
                    ].properties[that._idBackend]
                );
            }
            // init _schemaPDict
            that._schemaPDict[schemaP.name] = schemaP;
        });
        // init required
        [
            that["x-swgg-notRequired"],
            that["x-swgg-required"]
        ].forEach(function (element, ii) {
            (element || []).forEach(function (name) {
                that._schemaPDict[name].required = Boolean(ii);
            });
        });
        switch (that._crudType[0]) {
        // add extra file-upload forms
        case "fileUploadManyByForm":
            tmp = 1;
            while (tmp <= that._fileUploadNumber) {
                that.parameters[tmp] = local.jsonCopy(that.parameters[1]);
                that.parameters[tmp].name = "file" + tmp;
                tmp += 1;
            }
            break;
        }
        // update apiDict
        that = local.jsonCopy(that);
        local.apiDict[key.join(".")] = that;
        local.apiDict[that._methodPath] = that;
        // init ajax
        that.ajax = function (swaggerJson, onError) {
            return local.apiAjax(that, swaggerJson, onError);
        };
        that._ajaxToString = (
            that.ajax.toString()
            .replace("{", (
                "{\n"
                + "/*\n"
                + " * this function will run the api-call "
                + JSON.stringify(that._methodPath) + "\n"
                + " * example usage:" + (
                    "\n"
                    + "swgg.apiDict["
                    + JSON.stringify(key.join("."))
                    + "].ajax("
                    + JSON.stringify(local.normalizeSwaggerParamDict({
                        modeDefault: true,
                        operation: that,
                        paramDict: {}
                    }).paramDict, null, 4)
                    + ", function (err, data) {\n"
                    + "    if (err) {\n"
                    + "        console.error(err);\n"
                    + "        return;\n"
                    + "    }\n"
                    + "    console.log(data.responseJson"
                    + " || data.responseText);\n"
                    + "});"
                ).replace((
                    /\n/g
                ), "\n    ") + "\n */"
            )
                .replace((
                /\n/g
            ), "\n                "))
        );
        that.ajax.toString = function () {
            return that._ajaxToString;
        };
        // remove underscored keys from that
        tmp = local.jsonCopy(that);
        Object.keys(tmp).forEach(function (key) {
            if (key[0] === "_") {
                tmp[key] = undefined;
            }
        });
        // update paths
        pathDict = {};
        pathDict[that._path] = {};
        pathDict[that._path][that._method.toLowerCase()] = tmp;
        local.objectSetOverride(swaggerJson, {
            paths: pathDict
        }, 3);
    });
    // normalize swaggerJson
    local.swaggerJson = JSON.parse(local.jsonStringifyOrdered(swaggerJson));
    // try to validate swaggerJson
    local.tryCatchOnError(function () {
        local.swaggerValidate(local.swaggerJson);
    }, local.onErrorDefault);
    // init corsForwardProxyHost
    local.corsForwardProxyHost = (
        local.corsForwardProxyHost
        || local.swaggerJson["x-swgg-corsForwardProxyHost"]
    );
    // init assets.swgg.swagger.server.json
    local.assetsDict["/assets.swgg.swagger.server.json"] = JSON.stringify(
        local.swaggerJson
    );
};

local.dbFieldRandomCreate = function (opt) {
/*
 * this function will create a random dbField from <opt>.schemaP
 */
    var depth;
    var ii;
    var max;
    var min;
    var schemaP;
    var value;
    depth = (
        Number.isFinite(opt.depth)
        ? opt.depth
        : 3
    );
    schemaP = opt.schemaP;
    schemaP = schemaP.schema || schemaP;
    if (schemaP.readOnly) {
        return;
    }
    // init default
    if (opt.modeNotRandom && !local.isNullOrUndefined(schemaP.default)) {
        return local.jsonCopy(schemaP.default);
    }
    // init enum-value
    if (schemaP.enum) {
        value = (
            opt.modeNotRandom
            ? schemaP.enum[0]
            : local.listGetElementRandom(schemaP.enum)
        );
        return (
            local.schemaPType(schemaP) === "array"
            ? [
                value
            ]
            : value
        );
    }
    // init default
    value = null;
    switch (local.schemaPType(schemaP)) {
    // 5.3. Validation keywords for arrays
    case "array":
        if (depth <= 0) {
            break;
        }
        value = [];
        ii = 0;
        while (ii < Math.min(
            // 5.3.2. maxItems
            schemaP.maxItems || 2,
            // 5.3.3. minItems
            schemaP.minItems || 2,
            // 5.3.4. uniqueItems
            schemaP.uniqueItems
            ? 2
            : 1
        )) {
            // recurse dbFieldRandomCreate
            value.push(local.dbFieldRandomCreate({
                depth: depth - 1,
                modeNotRandom: opt.modeNotRandom,
                schemaP: local.schemaPItems(schemaP)
            }));
            ii += 1;
        }
        break;
    case "boolean":
        value = (
            opt.modeNotRandom
            ? false
            : Boolean(Math.random() > 0.5)
        );
        break;
    // 5.1. Validation keywords for numeric instances (number and integer)
    case "integer":
    case "number":
        max = schemaP.maximum;
        min = schemaP.minimum;
        if (opt.modeNotRandom) {
            value = (
                !(0 < min || max < 0)
                ? 0
                : min || max
            );
        } else {
            if (!(Number.isFinite(max) && Number.isFinite(min))) {
                if (!Number.isFinite(max) && !Number.isFinite(min)) {
                    max = 1000;
                    min = 0;
                } else if (Number.isFinite(max)) {
                    min = max - 1000;
                } else {
                    max = min + 1000;
                }
            }
            // exclusiveMaximum and exclusiveMinimum for float
            value = (
                min
                + (max - min) * Math.max(Math.random(), min * 0.000000000000001)
            );
            if (local.schemaPType(schemaP) === "integer") {
                value = Math.round(value);
            }
        }
        max = schemaP.maximum;
        min = schemaP.minimum;
        // exclusiveMaximum for integer
        if (schemaP.exclusiveMaximum && value === max) {
            value -= 1;
        }
        // exclusiveMinimum for integer
        if (schemaP.exclusiveMaximum && value === min) {
            value += 1;
        }
        // multipleOf
        if (schemaP.multipleOf > 0) {
            value = schemaP.multipleOf * Math.floor(value / schemaP.multipleOf);
            if (value < min || (schemaP.exclusiveMinimum && value <= min)) {
                value += schemaP.multipleOf;
            }
        }
        break;
    // 5.2. Validation keywords for strings
    case "string":
        value = (
            opt.modeNotRandom
            ? "abcd1234"
            : ((1 + Math.random()) * 0x10000000000000).toString(36).slice(1)
        );
        switch (schemaP.format) {
        case "byte":
            value = local.base64FromBuffer(value);
            break;
        case "date":
        case "date-time":
            value = new Date().toISOString();
            break;
        case "email":
            value = value + "@example.com";
            break;
        case "json":
            value = JSON.stringify({
                foo: value
            });
            break;
        case "phone":
            value = (
                opt.modeNotRandom
                ? "+123 (1234) 1234-1234"
                : "+" + Math.random().toString().slice(-3)
                + " (" + Math.random().toString().slice(-4) + ") "
                + Math.random().toString().slice(-4) + "-"
                + Math.random().toString().slice(-4)
            );
            break;
        }
        while (value.length < schemaP.minLength) {
            value += value;
        }
        value = value.slice(0, schemaP.maxLength || Infinity);
        break;
    // 5.4. Validation keywords for objects
    default:
        if (depth <= 0) {
            break;
        }
        // recurse dbRowRandomCreate
        value = local.dbRowRandomCreate({
            depth: depth - 1,
            modeNotRandom: opt.modeNotRandom,
            prefix: [
                "schema<" + JSON.stringify(schemaP) + ">"
            ],
            schema: schemaP
        });
    }
    return value;
};

local.dbRowListRandomCreate = function (opt) {
/*
 * this function will create a dbRowList of <opt>.length random dbRow's
 */
    var ii;
    ii = 0;
    while (ii < opt.length) {
        opt.dbRowList.push(local.dbRowRandomCreate(opt));
        ii += 1;
    }
    return opt.dbRowList;
};

local.dbRowRandomCreate = function (opt) {
/*
 * this function will create a random dbRow from opt.properties
 */
    var dbRow;
    var ii;
    var properties;
    dbRow = {};
    opt = local.objectSetDefault(opt, {
        override: local.nop,
        prefix: [
            "dbRow"
        ]
    });
    properties = local.swaggerValidateDataSchema({
        // dereference property
        modeDereference: true,
        prefix: opt.prefix,
        schema: opt.schema,
        swaggerJson: local.swaggerJson
    });
    properties = local.jsonCopy((properties && properties.properties) || {});
    ii = Object.keys(properties).length;
    while (ii < (opt.schema && opt.schema.minProperties)) {
        properties["property" + ii] = {
            type: "string"
        };
        ii += 1;
    }
    Object.keys(properties).forEach(function (key) {
        dbRow[key] = local.dbFieldRandomCreate({
            depth: opt.depth,
            modeNotRandom: opt.modeNotRandom,
            schemaP: local.swaggerValidateDataSchema({
                // dereference property
                modeDereference: true,
                prefix: opt.prefix.concat([
                    key
                ]),
                schema: properties[key],
                swaggerJson: local.swaggerJson
            })
        });
    });
    dbRow = local.jsonCopy(local.objectSetOverride(dbRow, opt.override(opt)));
    // try to validate data
    local.tryCatchOnError(function () {
        local.swaggerValidateDataSchema({
            data: dbRow,
            prefix: opt.prefix,
            schema: opt.schema,
            swaggerJson: local.swaggerJson
        });
    }, local.onErrorDefault);
    return dbRow;
};

local.idDomElementCreate = function (seed) {
/*
 * this function will create a deterministic and unique dom-element id
 * from <seed> that is both dom-selector and url friendly
 */
    local.idDomElementDict[seed] = (local.idDomElementDict[seed] || 0) + 1;
    return encodeURIComponent(
        seed + "_" + local.idDomElementDict[seed]
    ).replace((
        /\W/g
    ), "_");
};

local.idNameInit = function (opt) {
/*
 * this function will init <opt>.idBackend, <opt>.idName, and <opt>.queryById
 */
    var idBackend;
    var idName;
    // init idName
    idName = opt.crudType[1] || "id";
    opt.idName = idName;
    // init idBackend
    idBackend = opt.crudType[2] || opt.idName;
    opt.idBackend = idBackend;
    // invert queryById
    if (opt.modeQueryByIdInvert) {
        idBackend = opt.idName;
        idName = opt.idBackend;
    }
    // init queryById
    opt.idValue = (opt.data && opt.data[idBackend]) || opt.idValue;
    opt.queryById = {};
    opt.queryById[idName] = opt.idValue;
    return opt;
};

local.middlewareBodyParse = function (req, res, next) {
/*
 * this function will run middleware that will parse req.bodyRaw
 */
    var boundary;
    var crlf;
    var data;
    var headerParse;
    var ii;
    var jj;
    var name;
    // if req is already parsed, then goto next
    if (!req.swgg.operation || !local.isNullOrUndefined(req.swgg.bodyParsed)) {
        next();
        return;
    }
    headerParse = function () {
        local.bufferToUtf8(req.bodyRaw.slice(ii, ii + 1024)).replace((
            /^content-disposition:\u0020?form-data;(.+?)\r\n(?:content-type:\u0020?(.*?)$)?/im
        ), function (ignore, match1, match2) {
            data = {
                contentType: match2,
                name: ""
            };
            match1.replace((
                /(\w+)="([^"]+)/g
            ), function (ignore, match1, match2) {
                data[match1.toLowerCase()] = match2;
            });
            name = data.name;
            req.swgg.bodyMeta[name] = data;
        });
    };
    switch (req.swgg.operation._consumes0) {
    // parse application/x-www-form-urlencoded, e.g.
    // aa=hello%20world&bb=bye%20world
    case "application/x-www-form-urlencoded":
        req.swgg.bodyParsed = local.bufferToUtf8(req.bodyRaw);
        req.swgg.bodyParsed = local.urlParse(
            "?" + req.swgg.bodyParsed,
            true
        ).query;
        break;
    case "application/xml":
        req.swgg.bodyParsed = {};
        local.bufferToUtf8(req.bodyRaw).replace((
            /<(.+?)><!\[CDATA\[([\S\s]+?)\]\]>/g
        ), function (name, match1, value) {
            name = match1;
            name = decodeURIComponent(name);
            req.swgg.bodyParsed[name] = (
                local.schemaPType(
                    req.swgg.operation._schemaPDict[name]
                ) === "string"
                ? value
                : JSON.parse(value)
            );
        });
        break;
    /*
     * parse multipart/form-data, e.g.
     * --Boundary\r\n
     * Content-Disposition: form-data; name="key"\r\n
     * \r\n
     * value\r\n
     * --Boundary\r\n
     * Content-Disposition: form-data; name="input1"; filename="file1.png"\r\n
     * Content-Type: image/jpeg\r\n
     * \r\n
     * <data1>\r\n
     * --Boundary\r\n
     * Content-Disposition: form-data; name="input2"; filename="file2.png"\r\n
     * Content-Type: image/jpeg\r\n
     * \r\n
     * <data2>\r\n
     * --Boundary--\r\n
     * https://tools.ietf.org/html/rfc7578
     */
    case "multipart/form-data":
        req.swgg.bodyParsed = {};
        req.swgg.bodyMeta = {};
        crlf = new Uint8Array([
            0x0d, 0x0a
        ]);
        // init boundary
        ii = 0;
        jj = local.bufferIndexOfSubBuffer(req.bodyRaw, crlf, ii);
        if (jj <= 0) {
            break;
        }
        boundary = local.bufferConcat([
            crlf, req.bodyRaw.slice(ii, jj)
        ]);
        ii = jj + 2;
        while (true) {
            jj = local.bufferIndexOfSubBuffer(
                req.bodyRaw,
                boundary,
                ii
            );
            if (jj < 0) {
                break;
            }
            headerParse();
            ii = local.bufferIndexOfSubBuffer(
                req.bodyRaw,
                [
                    0x0d, 0x0a, 0x0d, 0x0a
                ],
                ii + 2
            ) + 4;
            data = req.bodyRaw.slice(ii, jj);
            req.swgg.bodyParsed[name] = data;
            ii = jj + boundary.length + 2;
        }
        break;
    default:
        req.swgg.bodyParsed = local.bufferToUtf8(req.bodyRaw);
        // try to JSON.parse the string
        local.tryCatchOnError(function () {
            req.swgg.bodyParsed = JSON.parse(req.swgg.bodyParsed);
        }, local.nop);
    }
    next(null, req, res);
};

local.middlewareCrudBuiltin = function (req, res, next) {
/*
 * this function will run middleware that will
 * run the builtin crud-operations backed by db-lite
 */
    var crud;
    var onParallel;
    var opt;
    var tmp;
    var user;
    opt = {};
    local.onNext(opt, function (err, data, meta) {
        switch (opt.modeNext) {
        case 1:
            crud = req.swgg.crud;
            user = req.swgg.user;
            switch (crud.crudType[0]) {
            case "crudCountManyByQuery":
                crud.dbTable.crudCountManyByQuery(crud.queryWhere, opt.onNext);
                break;
            case "crudSetManyById":
                crud.dbTable.crudSetManyById(crud.body, opt.onNext);
                break;
            case "crudSetOneById":
                // replace idName with idBackend in body
                delete crud.body.id;
                delete crud.body[crud.idName];
                crud.body[crud.idBackend] = crud.data[crud.idName];
                crud.dbTable.crudSetOneById(crud.body, opt.onNext);
                break;
            case "crudUpdateOneById":
                // replace idName with idBackend in body
                delete crud.body.id;
                delete crud.body[crud.idName];
                crud.body[crud.idBackend] = crud.data[crud.idName];
                crud.dbTable.crudUpdateOneById(crud.body, opt.onNext);
                break;
            // coverage-hack - test err handling-behavior
            case "crudErrorDelete":
            case "crudErrorGet":
            case "crudErrorHead":
            case "crudErrorOptions":
            case "crudErrorPatch":
            case "crudErrorPost":
            case "crudErrorPut":
                opt.onNext(local.errDefault);
                break;
            case "crudGetManyByQuery":
                onParallel = local.onParallel(opt.onNext);
                onParallel.counter += 1;
                crud.dbTable.crudGetManyByQuery({
                    fieldList: crud.queryFields,
                    limit: crud.queryLimit,
                    query: crud.queryWhere,
                    skip: crud.querySkip,
                    sort: crud.querySort
                }, function (err, data) {
                    crud.queryData = data;
                    onParallel(err);
                });
                onParallel.counter += 1;
                crud.dbTable.crudCountAll(function (err, data) {
                    crud.paginationCountTotal = data;
                    onParallel(err);
                });
                break;
            case "crudGetOneById":
                crud.dbTable.crudGetOneById(crud.queryById, opt.onNext);
                break;
            case "crudGetOneByQuery":
                crud.dbTable.crudGetOneByQuery({
                    query: crud.queryWhere
                }, opt.onNext);
                break;
            case "crudNullDelete":
            case "crudNullGet":
            case "crudNullHead":
            case "crudNullOptions":
            case "crudNullPatch":
            case "crudNullPost":
            case "crudNullPut":
                opt.onNext();
                break;
            case "crudRemoveManyByQuery":
                crud.dbTable.crudRemoveManyByQuery(crud.queryWhere, opt.onNext);
                break;
            case "crudRemoveOneById":
                crud.dbTable.crudRemoveOneById(crud.queryById, opt.onNext);
                break;
            case "fileGetOneById":
                local.dbTableFile = local.db.dbTableCreateOne({
                    name: "File"
                });
                crud.dbTable.crudGetOneById(crud.queryById, opt.onNext);
                break;
            case "fileUploadManyByForm":
                local.dbTableFile = local.db.dbTableCreateOne({
                    name: "File"
                });
                req.swgg.paramDict = {};
                Object.keys(req.swgg.bodyMeta).forEach(function (key) {
                    if (typeof req.swgg.bodyMeta[key].filename !== "string") {
                        req.swgg.paramDict[key] = local.bufferToUtf8(
                            req.swgg.bodyParsed[key]
                        );
                    }
                });
                crud.body = Object.keys(req.swgg.bodyMeta)
                .filter(function (key) {
                    return typeof req.swgg.bodyMeta[key].filename === "string";
                })
                .map(function (key) {
                    tmp = local.jsonCopy(req.swgg.paramDict);
                    tmp.id = tmp.id || ((1 + Math.random()) * 0x10000000000000)
                    .toString(36).slice(1);
                    local.objectSetOverride(tmp, {
                        fileBlob: local.base64FromBuffer(
                            req.swgg.bodyParsed[key]
                        ),
                        fileContentType: req.swgg.bodyMeta[key].contentType,
                        fileFilename: req.swgg.bodyMeta[key].filename,
                        fileInputName: req.swgg.bodyMeta[key].name,
                        fileSize: req.swgg.bodyParsed[key].length,
                        fileUrl: (
                            local.swaggerJsonBasePath
                            + "/" + req.swgg.operation.tags[0]
                            + "/fileGetOneById/" + tmp.id
                        )
                    });
                    return tmp;
                });
                local.dbTableFile.crudSetManyById(crud.body, opt.onNext);
                break;
            case "userLoginByPassword":
            case "userLogout":
                // respond with 401 Unauthorized
                if (!user.isAuthenticated) {
                    local.serverRespondHeadSet(req, res, 401, {});
                    req.swgg.crud.endArgList = [
                        req, res
                    ];
                    opt.modeNext = Infinity;
                    opt.onNext();
                    return;
                }
                opt.onNext();
                break;
            default:
                opt.modeNext = Infinity;
                opt.onNext();
            }
            break;
        case 2:
            switch (crud.crudType[0]) {
            case "crudSetOneById":
            case "crudUpdateOneById":
                opt.onNext(null, data);
                break;
            case "crudGetManyByQuery":
                opt.onNext(null, crud.queryData, {
                    paginationCountTotal: crud.paginationCountTotal
                });
                break;
            case "fileUploadManyByForm":
                opt.onNext(null, data.map(function (element) {
                    delete element.fileBlob;
                    return element;
                }));
                break;
            case "userLoginByPassword":
                opt.onNext(null, {
                    jwtEncrypted: user.jwtEncrypted
                });
                break;
            case "userLogout":
                crud.dbTable.crudUpdateOneById({
                    jwtEncrypted: null,
                    username: user.username
                }, opt.onNext);
                break;
            default:
                opt.onNext(null, data, meta);
            }
            break;
        case 3:
            switch (crud.crudType[0]) {
            case "fileGetOneById":
                if (!data) {
                    local.serverRespondDefault(req, res, 404);
                    return;
                }
                local.serverRespondHeadSet(req, res, null, {
                    "Content-Type": data.fileContentType
                });
                res.end(local.base64ToBuffer(data.fileBlob));
                break;
            case "userLogout":
                opt.onNext();
                break;
            default:
                opt.onNext(null, data, meta);
            }
            break;
        case 4:
            req.swgg.crud.endArgList = [
                req, res, null, data, meta
            ];
            opt.onNext();
            break;
        default:
            next(err);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.middlewareCrudEnd = function (req, res, next) {
/*
 * this function will run middleware that will end the builtin crud-operations
 */
    if (req.swgg.crud.endArgList) {
        local.serverRespondJsonapi.apply(null, req.swgg.crud.endArgList);
        return;
    }
    next(null, req, res);
};

local.middlewareRouter = function (req, res, next) {
/*
 * this function will run middleware that will
 * map the req's method-path to swagger's tags[0]-crudType
 */
    var tmp;
    // init swgg object
    local.objectSetDefault(req, {
        swgg: {
            crud: {
                crudType: []
            },
            user: {}
        }
    }, 3);
    // if req.url is not prefixed with swaggerJsonBasePath,
    // then default to next
    if (req.urlParsed.pathname.indexOf(local.swaggerJsonBasePath) !== 0) {
        next();
        return;
    }
    // init methodPath
    req.swgg.methodPath = (
        req.method + " "
        + req.urlParsed.pathname.replace(local.swaggerJsonBasePath, "")
    );
    // init operation
    while (req.swgg.methodPath !== tmp) {
        req.swgg.operation = (
            local.apiDict[req.swgg.methodPath]
            // handle /foo/{id}/bar case
            || local.apiDict[req.swgg.methodPath.replace((
                /\/[^\/]+\/([^\/]*?)$/
            ), "/{}/$1")]
        );
        // if operation exists, then break
        if (req.swgg.operation) {
            req.swgg.operation = local.jsonCopy(req.swgg.operation);
            // init crud.crudType
            req.swgg.crud.crudType = req.swgg.operation._crudType;
            break;
        }
        tmp = req.swgg.methodPath;
        // handle /foo/{id} case
        req.swgg.methodPath = req.swgg.methodPath.replace((
            /\/[^\/]+?(\/*?)$/
        ), "/$1{}");
    }
    next(null, req, res);
};

local.middlewareUserLogin = function (req, res, next) {
/*
 * this function will run middleware that will handle user login
 */
    var crud;
    var opt;
    var user;
    opt = {};
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            local.dbTableUser = local.db.dbTableCreateOne({
                name: "User"
            });
            crud = req.swgg.crud;
            user = {};
            req.swgg.user = user;
            user.jwtEncrypted = (
                req.headers.authorization
                && req.headers.authorization.replace("Bearer ", "")
            );
            user.jwtDecrypted = local.jwtAes256GcmDecrypt(user.jwtEncrypted);
            switch (crud.crudType[0]) {
            // coverage-hack - test err handling-behavior
            case "crudErrorLogin":
                opt.onNext(local.errDefault);
                return;
            case "userLoginByPassword":
                user.password = req.urlParsed.query.password;
                user.username = req.urlParsed.query.username;
                if (user.password && user.username) {
                    local.dbTableUser.crudGetOneById({
                        username: user.username
                    }, opt.onNext);
                    return;
                }
                break;
            default:
                if (user.jwtDecrypted.sub) {
                    // init username
                    user.username = user.jwtDecrypted.sub;
                    local.dbTableUser.crudGetOneById({
                        username: user.username
                    }, opt.onNext);
                    return;
                }
            }
            opt.modeNext = Infinity;
            opt.onNext();
            break;
        case 2:
            switch (crud.crudType[0]) {
            case "userLoginByPassword":
                user.data = data;
                if (!local.sjclHashScryptValidate(
                    user.password,
                    user.data && user.data.password
                )) {
                    opt.modeNext = Infinity;
                    opt.onNext();
                    return;
                }
                // init isAuthenticated
                user.isAuthenticated = true;
                // create JSON Web Token (JWT)
                // https://tools.ietf.org/html/rfc7519
                user.jwtDecrypted = {};
                user.jwtDecrypted.sub = user.data.username;
                // update jwtEncrypted in client
                user.jwtEncrypted = local.jwtAes256GcmEncrypt(
                    user.jwtDecrypted
                );
                local.serverRespondHeadSet(req, res, null, {
                    "swgg-jwt-encrypted": user.jwtEncrypted
                });
                // update jwtEncrypted in dbTableUser
                local.dbTableUser.crudUpdateOneById({
                    jwtEncrypted: user.jwtEncrypted,
                    username: user.jwtDecrypted.sub
                }, opt.onNext);
                return;
            default:
                data = data || {};
                user.data = data;
                if (data.jwtEncrypted) {
                    // init isAuthenticated
                    user.isAuthenticated = true;
                    // update jwtEncrypted in client
                    if (data.jwtEncrypted !== user.jwtEncrypted) {
                        user.jwtEncrypted = data.jwtEncrypted;
                        user.jwtDecrypted = local.jwtAes256GcmDecrypt(
                            user.jwtEncrypted
                        );
                        local.serverRespondHeadSet(req, res, null, {
                            "swgg-jwt-encrypted": user.jwtEncrypted
                        });
                    }
                }
            }
            opt.onNext();
            break;
        default:
            next(err);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.middlewareValidate = function (req, res, next) {
/*
 * this function will run middleware that will validate the swagger-<req>
 */
    var crud;
    var opt;
    var tmp;
    opt = {};
    local.onNext(opt, function (err) {
        switch (opt.modeNext) {
        case 1:
            if (!req.swgg.operation) {
                opt.modeNext = Infinity;
                opt.onNext();
                return;
            }
            // init paramDict
            req.swgg.paramDict = {};
            // parse path param
            tmp = req.urlParsed.pathname
            .replace(local.swaggerJsonBasePath, "")
            .split("/");
            req.swgg.operation._path.split("/").forEach(function (key, ii) {
                if ((
                    /^\{\S*?\}$/
                ).test(key)) {
                    req.swgg.paramDict[key.slice(1, -1)] = (
                        decodeURIComponent(tmp[ii])
                    );
                }
            });
            req.swgg.operation.parameters.forEach(function (schemaP) {
                switch (schemaP.in) {
                // parse body param
                case "body":
                    req.swgg.paramDict[schemaP.name] = (
                        req.swgg.bodyParsed
                        || undefined
                    );
                    break;
                // parse formData param
                case "formData":
                    switch (req.swgg.operation._consumes0) {
                    case "application/x-www-form-urlencoded":
                    case "application/xml":
                        req.swgg.paramDict[schemaP.name] = (
                            req.swgg.bodyParsed[schemaP.name]
                        );
                        break;
                    }
                    break;
                // parse header param
                case "header":
                    req.swgg.paramDict[schemaP.name] = (
                        req.headers[schemaP.name.toLowerCase()]
                    );
                    break;
                // parse query param
                case "query":
                    req.swgg.paramDict[schemaP.name] = (
                        req.urlParsed.query[schemaP.name]
                    );
                    break;
                }
                // parse array-multi
                tmp = req.swgg.paramDict[schemaP.name];
                if (
                    tmp
                    && local.schemaPType(schemaP) === "array"
                    && schemaP.collectionFormat === "multi"
                ) {
                    req.swgg.paramDict[schemaP.name] = (
                        encodeURIComponent(schemaP.name)
                        + "=" + (
                            Array.isArray(tmp)
                            ? tmp
                            : [
                                tmp
                            ]
                        ).join("&" + encodeURIComponent(schemaP.name) + "=")
                    );
                }
                // init default
                if (
                    local.isNullOrUndefined(req.swgg.paramDict[schemaP.name])
                    && schemaP.default !== undefined
                ) {
                    req.swgg.paramDict[schemaP.name] = local.jsonCopy(
                        schemaP.default
                    );
                }
            });
            // normalize paramDict
            local.normalizeSwaggerParamDict(req.swgg);
            // validate paramDict
            err = local.swaggerValidateDataParameters({
                data: req.swgg.paramDict,
                prefix: [
                    "operation", req.swgg.methodPath
                ],
                parameters: req.swgg.operation.parameters,
                swaggerJson: local.swaggerJson
            })[0];
            opt.onNext(err);
            break;
        case 2:
            // init crud
            crud = req.swgg.crud;
            // init crud.dbTable
            crud.dbTable = (
                req.swgg.operation
                && req.swgg.operation._schemaName
                && local.db.dbTableCreateOne({
                    name: req.swgg.operation._schemaName
                })
            );
            if (!crud.dbTable) {
                next();
                return;
            }
            // init crud.body
            if (req.swgg.operation._consumes0 !== "multipart/form-data") {
                crud.body = local.jsonCopy(req.swgg.bodyParsed);
            }
            // init crud.data
            crud.data = local.jsonCopy(req.swgg.paramDict);
            req.swgg.operation.parameters.forEach(function (schemaP) {
                // JSON.parse json-string
                if (
                    schemaP.format === "json"
                    && local.schemaPType(schemaP) === "string"
                    && crud.data[schemaP.name]
                ) {
                    crud.data[schemaP.name] = JSON.parse(
                        crud.data[schemaP.name]
                    );
                }
            });
            // init crud.query*
            [
                {
                    key: "queryFields",
                    value: {}
                }, {
                    key: "queryLimit",
                    value: 100
                }, {
                    key: "querySkip",
                    value: 0
                }, {
                    key: "querySort",
                    value: [
                        {
                            fieldName: "id"
                        }, {
                            fieldName: "_timeUpdated",
                            isDescending: true
                        }
                    ]
                }, {
                    key: "queryWhere",
                    value: {}
                }
            ].forEach(function (element) {
                crud[element.key] = crud.data["_" + element.key] || JSON.parse(
                    local.templateRender(
                        req.swgg.operation["_" + element.key] || "null",
                        req.swgg.paramDict,
                        {
                            notHtmlSafe: true
                        }
                    )
                ) || element.value;
            });
            // init-before crud.idName
            crud.modeQueryByIdInvert = true;
            local.idNameInit(crud);
            // init crud.data.id
            switch (crud.crudType[0]) {
            case "crudSetOneById":
            case "crudUpdateOneById":
                if (!local.isNullOrUndefined(crud.data[crud.idName])) {
                    break;
                }
                crud.data[crud.idName] = (
                    crud.body && crud.body[crud.idBackend]
                );
                break;
            }
            // init-after crud.idName
            crud.modeQueryByIdInvert = true;
            local.idNameInit(crud);
            next();
            break;
        default:
            next(err, req, res);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.normalizeSwaggerJson = function (swaggerJson, opt) {
/*
 * this function will normalize swaggerJson and filter $npm_package_swggTags0
 */
    var pathDict;
    var tmp;
    opt = local.objectSetDefault(opt, {
        objectSetDescription: function (dict) {
            if (
                dict
                && dict.description
                && Array.isArray(dict["x-swgg-descriptionLineList"])
            ) {
                delete dict.description;
            }
        }
    });
    local.objectSetDefault(swaggerJson, {
        paths: {},
        tags: []
    });
    // fix err - semanticPaths2
    pathDict = {};
    Object.keys(swaggerJson.paths).forEach(function (path) {
        tmp = path.replace((
            /\{.*?\}/g
        ), "{}");
        pathDict[tmp] = pathDict[tmp] || {};
        pathDict[tmp][path] = true;
    });
    Object.keys(pathDict).forEach(function (key) {
        Object.keys(pathDict[key]).sort().forEach(function (path, ii) {
            // fix err.semanticUniquePath
            if (ii && swaggerJson["x-swgg-fixErrorSemanticUniquePath"]) {
                swaggerJson.paths[path + "#" + ii] = swaggerJson.paths[path];
                delete swaggerJson.paths[path];
            }
        });
    });
    Object.keys(swaggerJson.paths).forEach(function (path) {
        Object.keys(swaggerJson.paths[path]).forEach(function (method) {
            tmp = swaggerJson.paths[path][method];
            // auto-create operationId from path
            if (
                swaggerJson["x-swgg-operationIdFromPath"]
                || tmp["x-swgg-operationIdFromPath"]
                || !tmp.operationId
            ) {
                tmp.operationId = local.operationIdFromAjax({
                    method,
                    url: path
                });
            }
            // normalize parameter.required
            (tmp.parameters || []).forEach(function (schemaP) {
                if (schemaP.required === false) {
                    delete schemaP.required;
                }
            });
        });
    });
    // override tag.description with x-swgg-tags0-override
    if (swaggerJson["x-swgg-tags0-override"]) {
        swaggerJson.tags.forEach(function (tag) {
            tmp = local.objectSetDefault(
                swaggerJson["x-swgg-tags0-override"][tag.name],
                {
                    description: tag.description,
                    "x-swgg-descriptionLineList": (
                        tag["x-swgg-descriptionLineList"]
                    )
                }
            );
            tag.description = tmp.description;
            tag["x-swgg-descriptionLineList"] = (
                tmp["x-swgg-descriptionLineList"]
            );
            // objectSetDescription
            opt.objectSetDescription(tmp);
            opt.objectSetDescription(tag);
        });
    }
    // apply opt.objectSetDescription
    ([
        swaggerJson.externalDocs, swaggerJson.info
    ]).forEach(opt.objectSetDescription);
    ([
        swaggerJson.definitions, swaggerJson.parameters, swaggerJson.responses
    ]).forEach(function (dict) {
        Object.keys(dict || {}).forEach(function (key) {
            tmp = dict[key];
            if (dict === swaggerJson.definitions) {
                tmp = tmp.properties || {};
                Object.keys(tmp).forEach(function (key) {
                    opt.objectSetDescription(tmp[key]);
                });
                return;
            }
            opt.objectSetDescription(tmp);
        });
    });
    Object.keys(swaggerJson.paths).forEach(function (path) {
        Object.keys(swaggerJson.paths[path]).forEach(function (method) {
            tmp = swaggerJson.paths[path][method];
            opt.objectSetDescription(tmp);
            (tmp.parameters || []).forEach(opt.objectSetDescription);
            Object.keys(tmp.responses || {}).forEach(function (key) {
                opt.objectSetDescription(tmp.responses[key]);
            });
        });
    });
    if (
        !local.env.npm_package_swggTags0 || (
            /-all$/
        ).test(local.env.npm_package_swggTags0)
    ) {
        return swaggerJson;
    }
    // override swaggerJson with x-swgg-tags0-override
    local.objectSetOverride(
        swaggerJson,
        (
            swaggerJson["x-swgg-tags0-override"]
            && swaggerJson["x-swgg-tags0-override"][
                local.env.npm_package_swggTags0
            ]
        ),
        10
    );
    // filter $npm_package_swggTags0 - definitions and parameters
    [
        "definitions", "parameters", "responses"
    ].forEach(function (schema) {
        schema = swaggerJson[schema] || {};
        Object.keys(schema).forEach(function (key) {
            tmp = schema[key]["x-swgg-tags0"];
            if (
                tmp && tmp !== "all" && tmp !== local.env.npm_package_swggTags0
            ) {
                delete schema[key];
            }
        });
    });
    // filter $npm_package_swggTags0 - paths
    Object.keys(swaggerJson.paths).forEach(function (path) {
        Object.keys(swaggerJson.paths[path]).forEach(function (method) {
            tmp = swaggerJson.paths[path][method]["x-swgg-tags0"];
            if (
                tmp && tmp !== "all" && tmp !== local.env.npm_package_swggTags0
            ) {
                delete swaggerJson.paths[path][method];
                return;
            }
        });
        if (!Object.keys(swaggerJson.paths[path]).length) {
            delete swaggerJson.paths[path];
        }
    });
    // filter $npm_package_swggTags0 - tags
    swaggerJson.tags = swaggerJson.tags.filter(function (tag) {
        return (
            !tag["x-swgg-tags0"]
            || tmp["x-swgg-tags0"] === "all"
            || tag["x-swgg-tags0"] === local.env.npm_package_swggTags0
        );
    });
    return swaggerJson;
};

local.normalizeSwaggerParamDict = function (opt) {
/*
 * this function will parse the <opt> according to <opt>.operation.parameters
 */
    var tmp;
    opt.operation.parameters.forEach(function (schemaP) {
        tmp = opt.paramDict[schemaP.name];
        // init default
        if (
            !opt.modeNoDefault
            && (opt.modeDefault || schemaP.required)
            && local.isNullOrUndefined(tmp)
        ) {
            tmp = local.jsonCopy(schemaP.default);
        }
        if (opt.modeDefault && local.isNullOrUndefined(tmp)) {
            tmp = local.dbFieldRandomCreate({
                modeNotRandom: true,
                schemaP
            });
        }
        // parse array
        if (local.schemaPType(schemaP) === "array" && schemaP.in !== "body") {
            if (typeof tmp === "string") {
                switch (
                    schemaP.collectionFormat
                    || schemaP["x-swgg-collectionFormat"]
                ) {
                case "json":
                    local.tryCatchOnError(function () {
                        tmp = JSON.parse(tmp);
                    }, local.nop);
                    opt.paramDict[schemaP.name] = tmp;
                    return;
                case "multi":
                    tmp = local.urlParse("?" + tmp, true).query[schemaP.name];
                    if (!Array.isArray(tmp)) {
                        tmp = [
                            tmp
                        ];
                    }
                    break;
                case "pipes":
                    tmp = tmp.split("|");
                    break;
                case "ssv":
                    tmp = tmp.split(" ");
                    break;
                case "tsv":
                    tmp = tmp.split("\t");
                    break;
                // default to csv
                default:
                    tmp = tmp.split(",");
                }
                if (local.schemaPItemsType(schemaP) !== "string") {
                    // try to JSON.parse the string
                    local.tryCatchOnError(function () {
                        tmp = tmp.map(function (element) {
                            return JSON.parse(element);
                        });
                    }, local.nop);
                }
            }
        // JSON.parse paramDict
        } else if (
            local.schemaPType(schemaP) !== "file"
            && local.schemaPType(schemaP) !== "string"
            && (
                typeof tmp === "string"
                || Object.prototype.toString.call(tmp) === "[object Uint8Array]"
            )
        ) {
            // try to JSON.parse the string
            local.tryCatchOnError(function () {
                tmp = JSON.parse(local.bufferToUtf8(tmp));
            }, local.nop);
        }
        opt.paramDict[schemaP.name] = tmp;
    });
    return opt;
};

local.onErrorJsonapi = function (onError) {
/*
 * this function will normalize err and data to jsonapi format,
 * and pass them to onError
 * http://jsonapi.org/format/#errors
 * http://jsonapi.org/format/#document-structure-resource-objects
 */
    return function (err, data, meta) {
        data = [
            err, data
        ].map(function (data, ii) {
            // if no err occurred, then return
            if (
                (ii === 0 && !data)
                // if data is already normalized, then return it
                || (data && data.meta && data.meta.isJsonapiResponse)
            ) {
                return data;
            }
            // normalize data-list
            if (!Array.isArray(data)) {
                data = [
                    data
                ];
            }
            // normalize errList to contain non-null objects
            if (!ii) {
                data = data.errList || data;
                // normalize errList to be non-empty
                if (!data.length) {
                    data.push(null);
                }
                data = data.map(function (element) {
                    if (!(typeof element === "object" && element)) {
                        element = {
                            message: String(element)
                        };
                    }
                    // normalize errObj to plain json-object
                    return {
                        message: element.message,
                        name: element.name,
                        stack: element.stack,
                        statusCode: Number(element.statusCode) || 500
                    };
                });
                err = local.jsonCopy(data[0]);
                err.errors = data;
                return err;
            }
            return {
                data
            };
        });
        // init data.meta
        data.forEach(function (data, ii) {
            if (!data) {
                return;
            }
            data.meta = local.jsonCopy(meta || {});
            data.meta.isJsonapiResponse = true;
            if (ii) {
                data.meta.dataLength = data.data.length;
            } else {
                data.meta.errorsLength = data.errors.length;
            }
            data.meta.statusCode = (
                Number(data.meta.statusCode)
                || Number(data.statusCode)
                || 0
            );
        });
        onError(data[0], data[1]);
    };
};

local.operationIdFromAjax = function (opt) {
/*
 * this function will create a sortable operationId
 * from given ajax-<opt>
 */
    var urlParsed;
    urlParsed = local.urlParseWithBraket(opt.url);
    return encodeURIComponent(
        urlParsed.pathname + urlParsed.hash + " " + opt.method.toUpperCase()
    ).replace((
        /[^\w\-.]/g
    ), "_");
};

local.schemaPItems = function (schemaP) {
/*
 * this function will return schemaP.items
 */
    return schemaP["x-swgg-items"] || schemaP.items;
};

local.schemaPItemsType = function (schemaP) {
/*
 * this function will return schemaP.items.type
 */
    return local.schemaPType(local.schemaPItems(schemaP) || {});
};

local.schemaPType = function (schemaP) {
/*
 * this function will return schemaP.type
 */
    return schemaP && (schemaP["x-swgg-type"] || schemaP.type);
};

local.serverRespondJsonapi = function (req, res, err, data, meta) {
/*
 * this function will respond in jsonapi format
 * http://jsonapi.org/format/#errors
 * http://jsonapi.org/format/#document-structure-resource-objects
 */
    local.onErrorJsonapi(function (err, data) {
        local.serverRespondHeadSet(req, res, err && err.statusCode, {
            "Content-Type": "application/json"
        });
        if (err) {
            // debug statusCode / method / url
            local.errorMessagePrepend(
                err,
                res.statusCode + " " + req.method + " " + req.url + "\n"
            );
            // print err.stack to stderr
            local.onErrorDefault(err);
        }
        data = err || data;
        res.statusCode = data.meta.statusCode || res.statusCode;
        data.meta.statusCode = res.statusCode;
        res.end(JSON.stringify(data));
    })(err, data, meta);
};

local.swaggerJsonFromAjax = function (swaggerJson, opt) {
/*
 * this function will update swaggerJson
 * with definitions and paths created from given ajax-<opt>
 */
    var data;
    var isArray;
    var operation;
    var pathDict;
    var type;
    var upsertSchemaP;
    var urlParsed;
    upsertSchemaP = function (schemaP) {
        if (!operation.parameters.some(function (element) {
            if (element.in === schemaP.in && element.name === schemaP.name) {
                [
                    "default", "items", "schema"
                ].forEach(function (key) {
                    if (!local.isNullOrUndefined(schemaP[key])) {
                        element[key] = schemaP[key];
                    }
                });
                return true;
            }
        })) {
            operation.parameters.push(schemaP);
        }
    };
    // init swaggerJson
    swaggerJson = local.objectSetDefault(swaggerJson, {
        basePath: "/",
        definitions: {},
        info: {
            title: "",
            version: ""
        },
        paths: {},
        swagger: "2.0"
    });
    // init opt
    opt = local.objectSetDefault(opt, {
        headers: {},
        method: "GET"
    });
    // init urlParsed
    urlParsed = local.urlParseWithBraket(opt.url);
    // init operation
    operation = {
        operationId: opt.operationId || local.operationIdFromAjax(opt),
        parameters: [],
        responses: {
            default: {
                description: "default response"
            }
        },
        tags: opt.tags || [
            "undefined"
        ],
        "x-swgg-tags0": opt["x-swgg-tags0"]
    };
    if ((
        /^(?:http|https):\/\//
    ).test(opt.url)) {
        operation["x-swgg-host"] = urlParsed.host;
        operation["x-swgg-schemes"] = [
            urlParsed.protocol.slice(0, -1)
        ];
    }
    pathDict = {};
    pathDict[urlParsed.pathname + urlParsed.hash] = {};
    pathDict[urlParsed.pathname + urlParsed.hash][
        opt.method.toLowerCase()
    ] = operation;
    local.objectSetDefault(swaggerJson, {
        paths: pathDict
    }, 3);
    // init param in header
    Object.keys(opt.headers).forEach(function (key) {
        upsertSchemaP({
            default: opt.headers[key],
            in: "header",
            name: key,
            type: "string"
        });
    });
    // init param in path
    urlParsed.pathname.replace((
        /\{[^}]+?\}/g
    ), function (match0) {
        match0 = match0.slice(1, -1);
        upsertSchemaP({
            default: match0,
            in: "path",
            name: match0,
            required: true,
            type: "string"
        });
    });
    // init param in query
    Object.keys(urlParsed.query).forEach(function (key) {
        upsertSchemaP({
            default: urlParsed.query[key],
            in: "query",
            name: key,
            type: "string"
        });
    });
    data = opt.data;
    if (!data) {
        return swaggerJson;
    }
    // init param in body - text-data
    upsertSchemaP({
        in: "body",
        name: "body",
        schema: {
            type: "string"
        }
    });
    local.tryCatchOnError(function () {
        data = JSON.parse(data);
    }, local.nop);
    if (typeof data !== "object") {
        return swaggerJson;
    }
    // init param in body - json-data
    isArray = Array.isArray(data);
    type = local.swaggerJsonFromPostBody(swaggerJson, {
        data: (
            // ternary-operator
            isArray
            ? data[0]
            : data
        ),
        depth: 2,
        key: "body",
        prefix: operation.operationId,
        "x-swgg-tags0": opt["x-swgg-tags0"]
    });
    upsertSchemaP({
        in: "body",
        name: "body",
        schema: (
            // ternary-operator
            isArray
            ? {
                items: type,
                type: "array"
            }
            : type
        )
    });
    return swaggerJson;
};

local.swaggerJsonFromCurl = function (swaggerJson, text) {
/*
 * this function will update swaggerJson
 * with definitions and paths created from given curl-command-text
 */
    var arg;
    var argList;
    var doubleBackslash;
    var opt;
    var quote;
    arg = "";
    argList = [];
    doubleBackslash = local.stringUniqueKey(text);
    // parse doubleBackslash
    text = text.replace((
        /\\\\/g
    ), doubleBackslash);
    // parse line-continuation
    text = text.replace((
        /\\\n/g
    ), "");
    // parse quotes
    text.replace((
        /(\s*?)(\S+)/g
    ), function (match0, line, word) {
        line = match0;
        word.replace((
            /^(["']?).*?(?:\\")?(["']?)$/
        ), function (quote1, match1, quote2) {
            quote1 = match1;
            if (quote) {
                arg += line;
            } else {
                arg = word;
                quote = quote1;
            }
            if (!quote || quote === quote2) {
                switch (quote) {
                // parse escapes in single-quotes
                case "'":
                    arg = arg.replace((
                        /'"'"'/g
                    ), "'");
                    arg = arg.slice(1, -1);
                    break;
                // parse escapes in double-quotes
                // https://www.gnu.org/software/bash/manual/html_node/Double-Quotes.html
                case "\"":
                    arg = arg.replace((
                        /\\([$`"\n])/g
                    ), "$1");
                    arg = arg.slice(1, -1);
                    break;
                }
                argList.push(arg);
                arg = "";
                quote = "";
            }
        });
    });
    // un-parse doubleBackslash
    argList = argList.map(function (arg) {
        return arg.replace(new RegExp(doubleBackslash, "g"), "\\\\");
    });
    argList.push("curl");
    argList.forEach(function (arg, ii) {
        switch (argList[ii - 1]) {
        case "--data":
        case "--data-ascii":
        case "--data-binary":
        case "--data-raw":
        case "-d":
            opt.data = arg;
            return;
        case "--header":
        case "-H":
            arg = arg.split(":");
            arg[1] = arg.slice(1).join(":").trim();
            opt.headers[arg[0].toLowerCase()] = arg[1];
            return;
        case "--request":
        case "-X":
            opt.method = arg;
            return;
        }
        if (arg === "curl") {
            if (opt) {
                opt.url = opt.url || argList[ii - 1];
                swaggerJson = local.swaggerJsonFromAjax(swaggerJson, opt);
            }
            opt = {
                headers: {},
                method: "GET"
            };
        }
        if ((
            /^(?:http|https):\/\//
        ).test(arg)) {
            opt.url = arg;
        }
    });
    return swaggerJson;
};

local.swaggerJsonFromPostBody = function (swaggerJson, opt) {
/*
 * this function will update swaggerJson
 * with definitions created from the post-body-data
 */
    var definition;
    var isArray;
    var prefix;
    var schemaP;
    var type;
    var value;
    prefix = opt.prefix + "." + encodeURIComponent(opt.key);
    definition = {
        properties: {},
        "x-swgg-tags0": opt["x-swgg-tags0"]
    };
    swaggerJson.definitions[prefix] = definition;
    Object.keys(opt.data).forEach(function (key) {
        value = opt.data[key];
        isArray = Array.isArray(value);
        if (isArray) {
            value = value[0];
        }
        type = (
            local.isNullOrUndefined(value)
            ? "string"
            : typeof value
        );
        schemaP = (
            isArray
            ? {
                default: opt.data[key],
                items: {
                    type
                },
                type: "array"
            }
            : {
                default: value,
                type
            }
        );
        definition.properties[key] = schemaP;
        if (!(type === "object" && opt.depth > 1)) {
            return;
        }
        // recurse
        type = local.swaggerJsonFromPostBody(swaggerJson, {
            data: value,
            depth: opt.depth - 1,
            key,
            prefix,
            "x-swgg-tags0": opt["x-swgg-tags0"]
        });
        if (isArray) {
            schemaP.items = type;
        } else {
            definition.properties[key] = type;
        }
    });
    return {
        $ref: "#/definitions/" + prefix
    };
};

local.swaggerValidate = function (swaggerJson) {
/*
 * this function will validate the json-object swaggerJson
 */
    var operation;
    var operationIdDict;
    var pathDict;
    var prefix;
    var test;
    var tmp;
    operationIdDict = {};
    swaggerJson = swaggerJson || {};
    local.swaggerValidateDataSchema({
        data: swaggerJson,
        modeSchema: true,
        prefix: [
            "swaggerJson"
        ],
        schema: local.swaggerSchemaJson,
        swaggerJson
    });
    pathDict = {};
    Object.keys(swaggerJson.paths).forEach(function (path) {
        prefix = [
            "swaggerJson", "paths", path
        ];
        // validate semanticPaths1
        test = path.indexOf("?") < 0;
        local.throwSwaggerError(!test && {
            errorType: "semanticPaths1",
            prefix
        });
        tmp = path.replace((
            /\{.*?\}/g
        ), "{}");
        // validate semanticPaths2
        test = !pathDict[tmp];
        local.throwSwaggerError(!test && {
            errorType: "semanticPaths2",
            pathList: [
                pathDict[tmp], path
            ],
            prefix
        });
        pathDict[tmp] = path;
        // validate semanticPaths3
        tmp = {};
        path.replace((
            /\{.*?\}/g
        ), function (match0) {
            test = !tmp[match0];
            local.throwSwaggerError(!test && {
                errorType: "semanticPaths3",
                name: match0,
                prefix
            });
            tmp[match0] = true;
        });
        // validate semanticPaths5
        test = path.indexOf("{}") < 0;
        local.throwSwaggerError(!test && {
            errorType: "semanticPaths5",
            prefix
        });
    });
    // validate swaggerJson.definitions[key].properties[ii].default
    Object.keys(swaggerJson.definitions || {}).forEach(function (schemaName) {
        tmp = local.swaggerValidateDataSchema({
            // dereference definition
            modeDereference: true,
            prefix: [
                "swaggerJson", "definitions", schemaName
            ],
            schema: swaggerJson.definitions[schemaName],
            swaggerJson
        });
        Object.keys(tmp.properties || {}).forEach(function (key) {
            local.swaggerValidateDataSchema({
                modeDefault: true,
                prefix: [
                    "swaggerJson", "definitions", schemaName, "properties", key
                ],
                schema: tmp.properties[key],
                swaggerJson
            });
        });
    });
    // validate swaggerJson.parameters[key].default
    Object.keys(swaggerJson.parameters || []).forEach(function (key) {
        local.swaggerValidateDataSchema({
            modeDefault: true,
            prefix: [
                "swaggerJson", "parameters", key
            ],
            schema: swaggerJson.parameters[key],
            swaggerJson
        });
    });
    // validate swaggerJson.paths[key][key].parameters[ii].default
    Object.keys(swaggerJson.paths).forEach(function (path) {
        Object.keys(swaggerJson.paths[path]).forEach(function (method) {
            prefix = [
                "swaggerJson", "paths", path, method
            ];
            operation = local.swaggerValidateDataSchema({
                // dereference operation
                modeDereference: true,
                prefix,
                schema: swaggerJson.paths[path][method],
                swaggerJson
            });
            // validate semanticOperationIds1
            test = !operationIdDict[operation.operationId];
            local.throwSwaggerError(!test && {
                data: operation.operationId,
                errorType: "semanticOperationIds1",
                prefix: prefix.concat([
                    "operationId"
                ])
            });
            operationIdDict[operation.operationId] = true;
            tmp = {
                in: {},
                name: {},
                path: {},
                type: {}
            };
            path.replace((
                /\{.*?\}/g
            ), function (match0) {
                match0 = match0.slice(1, -1);
                tmp.path[match0] = tmp.path[match0] || [];
                tmp.path[match0][0] = true;
            });
            (operation.parameters || []).forEach(function (schemaP, ii) {
                // dereference schemaP
                String(schemaP["x-swgg-$ref"] || schemaP.$ref).replace((
                    /#\/parameters\/(.+?$)/m
                ), function (ignore, match1) {
                    schemaP = local.objectSetDefault(
                        local.jsonCopy(schemaP),
                        local.jsonCopy(swaggerJson.parameters[match1])
                    );
                    delete schemaP.$ref;
                });
                // validate semanticOperations2
                test = !(tmp.in.body && schemaP.in === "body");
                local.throwSwaggerError(!test && {
                    data: operation,
                    errorType: "semanticOperations2",
                    prefix,
                    schema: operation
                });
                // validate semanticOperations3
                test = (
                    schemaP.name === undefined
                    || schemaP.in === undefined
                    || !tmp.name[schemaP.name + " " + schemaP.in]
                );
                local.throwSwaggerError(!test && {
                    data: operation.parameters,
                    errorType: "semanticOperations3",
                    prefix: prefix.concat([
                        "parameters"
                    ])
                });
                tmp.in[schemaP.in] = true;
                tmp.name[schemaP.name + " " + schemaP.in] = true;
                tmp.type[schemaP.type] = true;
                // validate semanticOperations1
                test = !(tmp.in.body && tmp.in.formData);
                local.throwSwaggerError(!test && {
                    data: operation,
                    errorType: "semanticOperations1",
                    prefix
                });
                // validate schemaP
                local.swaggerValidateDataSchema({
                    modeDefault: true,
                    prefix: prefix.concat([
                        "parameters", schemaP.name
                    ]),
                    schema: schemaP,
                    swaggerJson
                });
                if (schemaP.in === "path") {
                    tmp.path[schemaP.name] = tmp.path[schemaP.name] || [];
                    tmp.path[schemaP.name][1] = true;
                    // validate semanticPaths7
                    test = tmp.path[schemaP.name][0];
                    local.throwSwaggerError(!test && {
                        data: schemaP,
                        errorType: "semanticPaths7",
                        prefix: prefix.concat([
                            "parameters", ii
                        ])
                    });
                }
            });
            Object.keys(tmp.path).forEach(function (name) {
                // validate semanticPaths6
                test = tmp.path[name][1];
                local.throwSwaggerError(!test && {
                    errorType: "semanticPaths6",
                    name,
                    prefix: prefix.concat([
                        "parameters", "ii"
                    ])
                });
            });
            // validate semanticFormData4
            test = (
                !tmp.type.file
                || (operation.consumes || []).indexOf(
                    "multipart/form-data"
                ) >= 0
            );
            local.throwSwaggerError(!test && {
                data: operation,
                errorType: "semanticFormData4",
                prefix
            });
            // validate semanticFormData5
            test = (
                !tmp.in.formData
                || (operation.consumes || []).indexOf(
                    "application/x-www-form-urlencoded"
                ) >= 0
                || (operation.consumes || []).indexOf(
                    "multipart/form-data"
                ) >= 0
            );
            local.throwSwaggerError(!test && {
                data: operation,
                errorType: "semanticFormData5",
                prefix,
                schema: operation
            });
        });
    });
};

local.swaggerValidateDataParameters = function (opt) {
/*
 * this function will validate the items in <opt>.paramDict
 * against the schemaP's in <opt>.parameters
 */
    var errList;
    errList = [];
    opt.parameters.forEach(function (schemaP) {
        local.tryCatchOnError(function () {
            local.swaggerValidateDataSchema({
                data: opt.data[schemaP.name],
                dataReadonlyRemove: [
                    opt.dataReadonlyRemove || {},
                    schemaP.name,
                    opt.dataReadonlyRemove
                    && opt.dataReadonlyRemove[schemaP.name]
                ],
                prefix: opt.prefix.concat([
                    schemaP.name
                ]),
                schema: schemaP,
                swaggerJson: local.swaggerJson
            });
        }, function (errCaught) {
            console.error(errCaught.message);
            errList.push(errCaught);
            errCaught.errList = errList;
        });
    });
    return errList;
};

local.swaggerValidateDataSchema = function (opt) {
/*
 * this function will validate <opt>.data against the swagger <opt>.schema
 * http://json-schema.org/draft-04/json-schema-validation.html#rfc.section.5
 */
    var $ref;
    var circularSet;
    var data;
    var dataReadonlyRemove2;
    var ii;
    var list;
    var oneOf;
    var schema;
    var test;
    var tmp;
    if (!opt.schema) {
        return;
    }
    data = opt.data;
    opt.dataReadonlyRemove = opt.dataReadonlyRemove || [
        {}, "", null
    ];
    dataReadonlyRemove2 = opt.dataReadonlyRemove[2] || {};
    schema = opt.schema;
    circularSet = new Set();
    while (true) {
        // dereference schema.schema
        while (schema.schema) {
            schema = schema.schema;
        }
        // dereference schema.oneOf
        oneOf = (data && schema.oneOf) || [];
        ii = 0;
        while (ii < oneOf.length) {
            tmp = String(oneOf[ii] && oneOf[ii].$ref)
            .replace("http://json-schema.org/draft-04/schema#", "#");
            switch (
                tmp + " " + (!local.isNullOrUndefined(data.$ref) || data.in)
            ) {
            case "#/definitions/bodyParameter body":
            case "#/definitions/formDataParameterSubSchema formData":
            case "#/definitions/headerParameterSubSchema header":
            case "#/definitions/jsonReference true":
            case "#/definitions/pathParameterSubSchema path":
            case "#/definitions/queryParameterSubSchema query":
                schema = local.swaggerSchemaJson.definitions[tmp.split("/")[2]];
                break;
            default:
                switch (tmp) {
                case "#/definitions/bodyParameter":
                case "#/definitions/jsonReference":
                    schema = oneOf[ii ^ 1];
                    break;
                }
            }
            if (!schema.oneOf) {
                break;
            }
            ii += 1;
        }
        // dereference schema.$ref
        $ref = schema && schema.$ref;
        if (!$ref) {
            break;
        }
        test = !circularSet.has($ref);
        local.throwSwaggerError(!test && {
            data,
            errorType: "schemaDereferenceCircular",
            prefix: opt.prefix,
            schema
        });
        circularSet.add($ref);
        // validate semanticWalker6
        test = (
            $ref.indexOf("#/") === 0
            || $ref.indexOf("http://json-schema.org/draft-04/schema#/") === 0
        );
        local.throwSwaggerError(!test && {
            data: $ref,
            errorType: "semanticWalker6",
            prefix: opt.prefix.concat([
                "$ref"
            ])
        });
        switch (opt.modeSchema && $ref) {
        case "http://json-schema.org/draft-04/schema#/definitions/parameter":
            // validate semanticFormData1
            test = data.in !== "formdata";
            local.throwSwaggerError(!test && {
                data: data.in,
                errorType: "semanticFormData1",
                prefix: opt.prefix.concat([
                    "in"
                ])
            });
            // validate semanticFormData3
            test = data.type !== "file" || data.in === "formData";
            local.throwSwaggerError(!test && {
                data,
                errorType: "semanticFormData3",
                prefix: opt.prefix
            });
            // validate semanticParameters2
            test = data.in === "body" || !local.isNullOrUndefined(data.type);
            local.throwSwaggerError(!test && {
                data,
                errorType: "semanticParameters2",
                prefix: opt.prefix
            });
            break;
        case "http://json-schema.org/draft-04/schema#/definitions/schema":
            list = data.required || [];
            ii = 0;
            while (ii < list.length) {
                tmp = list[ii];
                // validate semanticSchema1
                test = !(
                    data.properties
                    && data.properties[tmp]
                    && data.properties[tmp].readOnly
                );
                local.throwSwaggerError(!test && {
                    data: data.properties[tmp],
                    errorType: "semanticSchema1",
                    prefix: opt.prefix.concat([
                        "properties", tmp
                    ])
                });
                ii += 1;
            }
            // validate semanticWalker1
            test = (
                local.isNullOrUndefined(data.type)
                || typeof data.type === "string"
            );
            local.throwSwaggerError(!test && {
                data: data.type,
                errorType: "semanticWalker1",
                prefix: opt.prefix.concat([
                    "type"
                ])
            });
            // validate semanticWalker2
            test = !(data.maximum < data.minimum);
            local.throwSwaggerError(!test && {
                data,
                errorType: "semanticWalker2",
                prefix: opt.prefix
            });
            // validate semanticWalker3
            test = !(data.maxProperties < data.minProperties);
            local.throwSwaggerError(!test && {
                data,
                errorType: "semanticWalker3",
                prefix: opt.prefix
            });
            // validate semanticWalker4
            test = !(data.maxLength < data.minLength);
            local.throwSwaggerError(!test && {
                data,
                errorType: "semanticWalker4",
                prefix: opt.prefix,
                schema
            });
            break;
        }
        tmp = $ref.split("/").slice(-2);
        schema = (
            $ref.indexOf("http://json-schema.org/draft-04/schema#/") === 0
            ? local.swaggerSchemaJson[tmp[0]]
            : opt.swaggerJson[tmp[0]]
        );
        schema = schema && schema[tmp[1]];
        test = schema;
        local.throwSwaggerError(!test && {
            data,
            errorType: "schemaDereference",
            prefix: opt.prefix,
            schema: opt.schema
        });
    }
    if (opt.modeDereference) {
        if (opt.modeDereferenceDepth > 1) {
            schema = local.jsonCopy(schema);
            Object.keys(schema.properties || {}).forEach(function (key) {
                schema.properties[key] = local.swaggerValidateDataSchema({
                    // dereference property
                    modeDereference: true,
                    modeDereferenceDepth: opt.modeDereferenceDepth - 1,
                    prefix: opt.prefix.concat([
                        "properties", key
                    ]),
                    schema: schema.properties[key],
                    swaggerJson: opt.swaggerJson
                });
            });
        }
        return schema;
    }
    // validate schema.default
    if (opt.modeDefault) {
        data = schema.default;
    }
    // validate schema.required
    test = (
        opt.modeDefault
        || !local.isNullOrUndefined(data)
        || schema.required !== true
        || schema["x-swgg-notRequired"]
    );
    local.throwSwaggerError(!test && {
        data,
        errorType: "objectRequired",
        prefix: opt.prefix,
        schema
    });
    if (local.isNullOrUndefined(data)) {
        return;
    }
    // validate semanticItemsRequiredForArrayObjects1
    test = (
        !opt.modeSchema
        || local.schemaPType(data) !== "array"
        || (
            typeof local.schemaPItems(data) === "object"
            && local.schemaPItems(data)
        )
    );
    local.throwSwaggerError(!test && {
        errorType: "semanticItemsRequiredForArrayObjects1",
        prefix: opt.prefix,
        schema: data
    });
    // remove readOnly property
    if (schema.readOnly) {
        delete opt.dataReadonlyRemove[0][opt.dataReadonlyRemove[1]];
    }
    // optimization - validate schema.type first
    // 5.5.2. type
    // https://swagger.io/docs/specification/data-models/data-types/
    // https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#data-types
    switch (local.schemaPType(schema)) {
    case "array":
        test = Array.isArray(data);
        break;
    case "boolean":
        test = typeof data === "boolean";
        break;
    case "file":
        test = !opt.modeSchema;
        break;
    case "integer":
        test = Number.isInteger(data);
        switch (schema.format) {
        case "int32":
            break;
        case "int64":
            break;
        }
        break;
    case "number":
        test = Number.isFinite(data);
        switch (schema.format) {
        case "double":
            break;
        case "float":
            break;
        }
        break;
    case "string":
        test = (
            typeof data === "string"
            || (!opt.modeSchema && schema.format === "binary")
        );
        switch (test && !opt.modeSchema && schema.format) {
        // Clarify 'byte' format #50
        // https://github.com/swagger-api/swagger-spec/issues/50
        case "byte":
            test = !(
                /[^\n\r+\/0-9=A-Za-z]/
            ).test(data);
            break;
        case "date":
        case "date-time":
            test = JSON.stringify(new Date(data)) !== "null";
            break;
        case "email":
            test = local.regexpValidateEmail.test(data);
            break;
        case "json":
            test = local.tryCatchOnError(function () {
                JSON.parse(data);
                return true;
            }, local.nop);
            break;
        case "phone":
            test = local.regexpValidatePhone.test(data);
            break;
        }
        break;
    default:
        test = opt.modeSchema || typeof data === "object";
    }
    local.throwSwaggerError(!test && {
        data,
        errorType: "itemType",
        prefix: opt.prefix,
        schema,
        typeof: local.identity(typeof data)
    });
    tmp = typeof data;
    if (tmp === "object" && Array.isArray(data)) {
        tmp = "array";
    }
    switch (tmp) {
    // 5.3. Validation keywords for arrays
    case "array":
        // 5.3.1. additionalItems and items
        // swagger disallows array items
        data.forEach(function (element, ii) {
            // recurse - schema.additionalItems and schema.items
            local.swaggerValidateDataSchema({
                data: element,
                dataReadonlyRemove: [
                    dataReadonlyRemove2, ii, dataReadonlyRemove2[ii]
                ],
                modeSchema: opt.modeSchema,
                prefix: opt.prefix.concat([
                    ii
                ]),
                schema: local.schemaPItems(schema) || schema.additionalItems,
                swaggerJson: opt.swaggerJson
            });
        });
        // 5.3.2. maxItems
        test = (
            typeof schema.maxItems !== "number"
            || data.length <= schema.maxItems
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: "arrayMaxItems",
            prefix: opt.prefix,
            schema
        });
        // 5.3.3. minItems
        test = (
            typeof schema.minItems !== "number"
            || data.length >= schema.minItems
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: "arrayMinItems",
            prefix: opt.prefix,
            schema
        });
        // 5.3.4. uniqueItems
        test = !schema.uniqueItems || data.every(function (element) {
            tmp = element;
            return data.indexOf(element) === data.lastIndexOf(element);
        });
        local.throwSwaggerError(!test && {
            data,
            errorType: "arrayUniqueItems",
            prefix: opt.prefix,
            schema,
            tmp
        });
        break;
    // 5.1. Validation keywords for numeric instances (number and integer)
    case "number":
        // 5.1.1. multipleOf
        test = (
            typeof schema.multipleOf !== "number"
            || data % schema.multipleOf === 0
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: "numberMultipleOf",
            prefix: opt.prefix,
            schema
        });
        // 5.1.2. maximum and exclusiveMaximum
        test = typeof schema.maximum !== "number" || (
            schema.exclusiveMaximum
            ? data < schema.maximum
            : data <= schema.maximum
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: (
                // ternary-operator
                schema.exclusiveMaximum
                ? "numberExclusiveMaximum"
                : "numberMaximum"
            ),
            prefix: opt.prefix,
            schema
        });
        // 5.1.3. minimum and exclusiveMinimum
        test = typeof schema.minimum !== "number" || (
            schema.exclusiveMinimum
            ? data > schema.minimum
            : data >= schema.minimum
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: (
                // ternary-operator
                schema.exclusiveMinimum
                ? "numberExclusiveMinimum"
                : "numberMinimum"
            ),
            prefix: opt.prefix,
            schema
        });
        break;
    // 5.4. Validation keywords for objects
    case "object":
        // 5.4.1. maxProperties
        test = (
            typeof schema.maxProperties !== "number"
            || Object.keys(data).length <= schema.maxProperties
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: "objectMaxProperties",
            prefix: opt.prefix,
            schema
        });
        // 5.4.2. minProperties
        test = (
            typeof schema.minProperties !== "number"
            || Object.keys(data).length >= schema.minProperties
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: "objectMinProperties",
            prefix: opt.prefix,
            schema
        });
        // 5.4.3. required
        (schema.required || []).forEach(function (key) {
            // validate semanticItemsRequiredForArrayObjects2
            test = !local.isNullOrUndefined(data[key]);
            local.throwSwaggerError(!test && {
                data,
                errorType: "semanticItemsRequiredForArrayObjects2",
                key,
                prefix: opt.prefix,
                schema
            });
        });
        // 5.4.4. additionalProperties, properties and patternProperties
        Object.keys(data).forEach(function (key) {
            tmp = null;
            if (schema.properties && schema.properties[key]) {
                tmp = true;
                // recurse - schema.properties
                local.swaggerValidateDataSchema({
                    data: data[key],
                    dataReadonlyRemove: [
                        dataReadonlyRemove2,
                        key,
                        dataReadonlyRemove2[key]
                    ],
                    modeSchema: opt.modeSchema,
                    prefix: opt.prefix.concat([
                        key
                    ]),
                    schema: schema.properties[key],
                    swaggerJson: opt.swaggerJson
                });
            }
            Object.keys(schema.patternProperties || {}).forEach(function (rgx) {
                if (new RegExp(rgx).test(key)) {
                    tmp = true;
                    // recurse - schema.patternProperties
                    local.swaggerValidateDataSchema({
                        data: data[key],
                        modeSchema: opt.modeSchema,
                        prefix: opt.prefix.concat([
                            key
                        ]),
                        schema: schema.patternProperties[rgx],
                        swaggerJson: opt.swaggerJson
                    });
                }
            });
/*
* validate
* 5.4.4.4. If "additionalProperties" has boolean value false
*
* In this case, validation of the instance depends on the property set of
* "properties" and "patternProperties". In this section, the property names of
* "patternProperties" will be called regexes for convenience.
*
* The first step is to collect the following sets:
*
* s
* The property set of the instance to validate.
* p
* The property set from "properties".
* pp
* The property set from "patternProperties".
* Having collected these three sets, the process is as follows:
*
* remove from "s" all elements of "p", if any;
* for each regex in "pp", remove all elements of "s" which this regex matches.
* Validation of the instance succeeds if, after these two steps,
* set "s" is empty.
*/
            test = tmp || schema.additionalProperties !== false;
            local.throwSwaggerError(!test && {
                data,
                errorType: "objectAdditionalProperties",
                key,
                prefix: opt.prefix,
                schema
            });
            // recurse - schema.additionalProperties
            local.swaggerValidateDataSchema({
                data: data[key],
                modeSchema: opt.modeSchema,
                prefix: opt.prefix.concat([
                    key
                ]),
                schema: schema.additionalProperties,
                swaggerJson: opt.swaggerJson
            });
        });
        // 5.4.5. dependencies
        Object.keys(schema.dependencies || {}).forEach(function (key) {
            if (local.isNullOrUndefined(data[key])) {
                return;
            }
            // 5.4.5.2.1. Schema dependencies
            // recurse - schema.dependencies
            local.swaggerValidateDataSchema({
                data: data[key],
                modeSchema: opt.modeSchema,
                prefix: opt.prefix.concat([
                    key
                ]),
                schema: schema.dependencies[key],
                swaggerJson: opt.swaggerJson
            });
            // 5.4.5.2.2. Property dependencies
            schema.dependencies[key].every(function (key2) {
                test = !local.isNullOrUndefined(data[key2]);
                local.throwSwaggerError(!test && {
                    data,
                    errorType: "objectDependencies",
                    key,
                    key2,
                    prefix: opt.prefix,
                    schema
                });
            });
        });
        break;
    // 5.2. Validation keywords for strings
    case "string":
        // 5.2.1. maxLength
        test = (
            typeof schema.maxLength !== "number"
            || data.length <= schema.maxLength
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: "stringMaxLength",
            prefix: opt.prefix,
            schema
        });
        // 5.2.2. minLength
        test = (
            typeof schema.minLength !== "number"
            || data.length >= schema.minLength
        );
        local.throwSwaggerError(!test && {
            data,
            errorType: "stringMinLength",
            prefix: opt.prefix,
            schema
        });
        // 5.2.3. pattern
        test = !schema.pattern || new RegExp(schema.pattern).test(data);
        local.throwSwaggerError(!test && {
            data,
            errorType: "stringPattern",
            prefix: opt.prefix,
            schema
        });
        break;
    }
    // 5.5. Validation keywords for any instance type
    // 5.5.1. enum
    tmp = (
        schema.enum
        || (!opt.modeSchema && (local.schemaPItems(schema) || {}).enum)
    );
    test = !tmp || (
        Array.isArray(data)
        ? data
        : [
            data
        ]
    ).every(function (element) {
        return tmp.indexOf(element) >= 0;
    });
    local.throwSwaggerError(!test && {
        data,
        errorType: "itemEnum",
        prefix: opt.prefix,
        schema,
        tmp
    });
    // 5.5.2. type
    local.nop();
    // 5.5.3. allOf
    (schema.allOf || []).forEach(function (element) {
        // recurse - schema.allOf
        local.swaggerValidateDataSchema({
            data,
            prefix: opt.prefix,
            modeSchema: opt.modeSchema,
            schema: element,
            swaggerJson: opt.swaggerJson
        });
    });
    // 5.5.4. anyOf
    tmp = null;
    test = !schema.anyOf || schema.anyOf.some(function (element) {
        local.tryCatchOnError(function () {
            // recurse - schema.anyOf
            local.swaggerValidateDataSchema({
                data,
                modeSchema: opt.modeSchema,
                prefix: opt.prefix,
                schema: element,
                swaggerJson: opt.swaggerJson
            });
            return true;
        }, local.nop);
        tmp = tmp || local.utility2._debugTryCatchError;
        return !tmp;
    });
    local.throwSwaggerError(!test && {
        data,
        errorType: "itemOneOf",
        prefix: opt.prefix,
        schema,
        tmp
    });
    // 5.5.5. oneOf
    tmp = (
        !schema.oneOf
        ? 1
        : 0
    );
    (schema.oneOf || []).some(function (element) {
        local.tryCatchOnError(function () {
            // recurse - schema.oneOf
            local.swaggerValidateDataSchema({
                data,
                modeSchema: opt.modeSchema,
                prefix: opt.prefix,
                schema: element,
                swaggerJson: opt.swaggerJson
            });
            tmp += 1;
        }, local.nop);
        return tmp > 1;
    });
    test = tmp === 1;
    local.throwSwaggerError(!test && {
        data,
        errorType: "itemOneOf",
        prefix: opt.prefix,
        schema,
        tmp
    });
    // 5.5.6. not
    test = !schema.not || !local.tryCatchOnError(function () {
        // recurse - schema.not
        local.swaggerValidateDataSchema({
            data,
            modeSchema: opt.modeSchema,
            prefix: opt.prefix,
            schema: schema.not,
            swaggerJson: opt.swaggerJson
        });
        return true;
    }, local.nop);
    local.throwSwaggerError(!test && {
        data,
        errorType: "itemNot",
        prefix: opt.prefix,
        schema
    });
    // 5.5.7. definitions
    local.nop();
    // validate data.$ref
    if (schema === local.swaggerSchemaJson.definitions.jsonReference) {
        local.swaggerValidateDataSchema({
            modeDereference: true,
            modeSchema: opt.modeSchema,
            prefix: opt.prefix,
            schema: data,
            swaggerJson: opt.swaggerJson
        });
    }
    return schema;
};

local.swaggerValidateFile = function (opt, onError) {
/*
 * this function will validate the json-file <opt>.file
 */
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            if (typeof opt.data === "string") {
                opt.onNext(null, opt.data);
                return;
            }
            // fetch url
            if ((
                /^(?:http|https):\/\//
            ).test(opt.file)) {
                local.ajax({
                    url: opt.file
                }, function (err, xhr) {
                    opt.onNext(err, xhr && xhr.responseText);
                });
                return;
            }
            // read file
            local.fs.readFile(opt.file, "utf8", opt.onNext);
            break;
        case 2:
            // jslint
            local.jslint.jslintAndPrint(data, opt.file);
            local.assertThrow(
                !local.jslint.jslintResult.errText,
                local.jslint.jslintResult.errText.replace((
                    /\u001b\[\d*m/g
                ), "")
            );
            // validate
            local.swgg.swaggerValidate(JSON.parse(data));
            opt.onNext();
            break;
        default:
            console.error(
                err
                ? "\u001b[31mswagger-validate - failed - " + opt.file + "\n"
                + err.message + "\u001b[39m"
                : "swagger-validate - passed - " + opt.file
            );
            onError(err);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.throwSwaggerError = function (opt) {
/*
 * this function will throw a swaggerError with given <opt>.errorType
 */
    var err;
    if (!opt) {
        return;
    }
    [
        0, 2
    ].forEach(function (ii) {
        opt["prefix" + ii] = opt.prefix[ii] + opt.prefix.slice(
            ii + 1
        ).map(function (element) {
            return "[" + JSON.stringify(element) + "]";
        }).join("");
    });
    opt.prefix0 += " = " + local.stringTruncate(
        JSON.stringify(opt.data) || "undefined",
        100
    );
    opt.schema2 = local.stringTruncate(
        JSON.stringify(opt.schema) || "undefined",
        500
    );
    opt.type2 = (opt.schema && local.schemaPType(opt.schema)) || "object";
    if (opt.schema && opt.schema.format) {
        opt.type2 += " (" + opt.schema.format + ")";
    }
    err = new Error("error." + opt.errorType + " - " + local.templateRender(
        local.swaggerErrorTypeDict[opt.errorType],
        opt,
        {
            notHtmlSafe: true
        }
    ));
    err.messageShort = local.templateRender(
        local.swaggerErrorTypeDict[opt.errorType].replace(
            "{{prefix0}}",
            "{{prefix2}}"
        ),
        opt,
        {
            notHtmlSafe: true
        }
    );
    err.opt = opt;
    err.statusCode = 400;
    throw err;
};

local.uiEventDelegate = function (event) {
    // filter non-input keyup-event
    event.targetOnEvent = event.target.closest(
        "[data-onevent]"
    );
    if (!event.targetOnEvent) {
        return;
    }
    // rate-limit keyup
    if (event.type === "keyup") {
        local.uiEventDelegateKeyupEvent = event;
        if (local.uiEventDelegateKeyupTimerTimeout !== 2) {
            local.uiEventDelegateKeyupTimerTimeout = (
                local.uiEventDelegateKeyupTimerTimeout
                || setTimeout(function () {
                    local.uiEventDelegateKeyupTimerTimeout = 2;
                    local.uiEventDelegate(local.uiEventDelegateKeyupEvent);
                }, 100)
            );
            return;
        }
        local.uiEventDelegateKeyupTimerTimeout = null;
        if (!event.target.closest(
            "input, option, select, textarea"
        )) {
            return;
        }
    }
    switch (event.targetOnEvent.tagName) {
    case "BUTTON":
    case "FORM":
        event.preventDefault();
        break;
    }
    event.stopPropagation();
    local.uiEventListenerDict[event.targetOnEvent.dataset.onevent](event);
};

local.uiEventListenerDict = local.objectAssignDefault(
    globalThis.domOnEventDelegateDict
);

local.uiEventListenerDict.onEventDomDb = local.db.onEventDomDb;

local.uiEventListenerDict.onEventInputTextareaChange = function (evt) {
/*
 * this function will show/hide the textarea's multiline placeholder
 */
    var isTransparent;
    var value;
    isTransparent = evt.targetOnEvent.style.background.indexOf(
        "transparent"
    ) >= 0;
    value = evt.targetOnEvent.value;
    if (value && isTransparent) {
        evt.targetOnEvent.style.background = "";
    }
    if (!value && !isTransparent) {
        evt.targetOnEvent.style.background = "transparent";
    }
    local.uiEventListenerDict.onEventInputValidateAndAjax({
        targetOnEvent: evt.targetOnEvent
    });
};

local.uiEventListenerDict.onEventInputValidateAndAjax = function (
    opt,
    onError
) {
/*
 * this function will validate the input parameters
 * against the schemas in <opt>.parameters
 */
    var errorDict;
    var jsonParse;
    var tmp;
    jsonParse = function (text) {
    /*
     * this function will try to JSON.parse(text)
     */
        return local.tryCatchOnError(function () {
            return JSON.parse(text);
        }, function () {
            return text;
        });
    };
    // jslint-hack
    opt.targetOnEvent = opt.targetOnEvent.closest(
        ".operation"
    );
    opt.api = local.apiDict[opt.targetOnEvent.dataset._methodPath];
    opt.headers = {};
    opt.modeAjax = opt.modeAjax || "validate";
    opt.modeNoDefault = true;
    opt.paramDict = {};
    opt.url = "";
    opt.api.parameters.forEach(function (schemaP) {
        tmp = opt.targetOnEvent.querySelector(
            ".schemaP[data-name=" + JSON.stringify(schemaP.name) + "] .input"
        );
        switch (tmp.tagName) {
        case "INPUT":
            // parse file
            if (local.schemaPType(tmp) === "file") {
                tmp = tmp.files && tmp.files[0];
                break;
            }
            tmp = tmp.value;
            if (!tmp) {
                return;
            }
            // parse string
            if (local.schemaPType(schemaP) !== "string") {
                tmp = jsonParse(tmp);
            }
            break;
        case "SELECT":
            tmp = Array.from(tmp.options)
            .filter(function (element) {
                return element.selected;
            })
            .map(function (element) {
                return jsonParse(decodeURIComponent(
                    element.dataset.valueSelectOption
                ));
            });
            if (!tmp.length || tmp[0] === "$swggUndefined") {
                return;
            }
            if (local.schemaPType(schemaP) !== "array") {
                tmp = tmp[0];
            }
            break;
        case "TEXTAREA":
            tmp = tmp.value;
            if (!tmp) {
                return;
            }
            // ignore string (json)
            if (
                schemaP.format === "json"
                && local.schemaPType(schemaP) === "string"
            ) {
                break;
            }
            if (
                schemaP.schema
                && local.schemaPType(schemaP.schema) === "string"
                && typeof tmp === "string"
            ) {
                break;
            }
            // parse schema
            if (schemaP.in === "body") {
                tmp = jsonParse(tmp);
                break;
            }
            // parse array
            tmp = tmp.split("\n").map(function (element) {
                return (
                    local.schemaPItemsType(schemaP) === "string"
                    ? element
                    : jsonParse(element)
                );
            });
            break;
        }
        opt.paramDict[schemaP.name] = tmp;
    });
    opt.api.ajax(opt, onError || local.nop);
    // init errorDict
    errorDict = {};
    ((opt.err && opt.err.errList) || []).forEach(function (err) {
        errorDict[err.opt.prefix[2]] = err;
    });
    // shake input on err
    Array.from(opt.targetOnEvent.querySelectorAll(
        ".schemaP[data-name]"
    )).forEach(function (element) {
        tmp = errorDict[element.dataset.name];
        local.uiAnimateShakeIfError(tmp, element.querySelector(
            ".input"
        ));
        element.querySelector(
            ".colorError"
        ).textContent = (
            tmp
            ? tmp.messageShort
            : ""
        );
    });
    // shake submit-button on err
    local.uiAnimateShakeIfError(
        opt.err,
        opt.targetOnEvent.querySelector(
            ".onEventOperationAjax"
        )
    );
    // init reqCurl
    tmp = opt.data;
    local.tryCatchOnError(function () {
        tmp = JSON.stringify(JSON.parse(opt.data), null, 4);
    }, local.nop);
    tmp = (
        "curl \\\n" + "--request " + opt.api._method + " \\\n"
        + Object.keys(opt.headers).map(function (key) {
            return "--header '" + key + ": " + opt.headers[key] + "' \\\n";
        }).join("") + "--data-binary " + (
            typeof tmp === "string"
            ? "'" + tmp.replace((
                /'/g
            ), "'\"'\"'") + "'"
            : "<blob>"
        ) + " \\\n\"" + opt.url.replace((
            /&/g
        ), "&\\\n") + "\""
    );
    opt.targetOnEvent.querySelector(
        ".reqCurl"
    ).textContent = tmp;
    // init reqJs
    opt.targetOnEvent.querySelector(
        ".reqJs"
    ).textContent = local.templateRender(
        local.templateUiReqJs,
        {
            opt,
            optionJson: JSON.stringify({
                paramDict: opt.paramDict
            }, null, 4)
        },
        {
            notHtmlSafe: true
        }
    );
};

local.uiEventListenerDict.onEventOperationAjax = function (opt) {
/*
 * this function will submit the operation to the backend
 */
    // ensure opt is stateless
    opt = {
        targetOnEvent: opt.targetOnEvent.closest(
            ".operation"
        )
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            // force ajax
            opt.modeAjax = "ajax";
            // validate input
            local.uiEventListenerDict.onEventInputValidateAndAjax(
                opt,
                opt.onNext
            );
            // reset res output
            Array.from(opt.targetOnEvent.querySelectorAll(
                ".resBody, .resHeaders, .resStatusCode"
            )).forEach(function (element) {
                element.classList.remove("hasError");
                element.textContent = "loading ...";
            });
            opt.targetOnEvent.querySelector(
                ".resMedia"
            ).innerHTML = "";
            // scrollTo res
            opt.targetOnEvent.querySelector(
                ".resStatusCode"
            ).focus();
            break;
        default:
            local.onErrorDefault(err);
            data = local.objectSetDefault(data, {
                contentType: "undefined",
                statusCode: "undefined"
            });
            // init resStatusCode
            opt.targetOnEvent.querySelector(
                ".resStatusCode"
            ).textContent = (
                data.statusCode
            );
            // init resHeaders
            opt.targetOnEvent.querySelector(
                ".resHeaders"
            ).textContent = Object.keys(data.resHeaders).map(function (key) {
                return key + ": " + data.resHeaders[key] + "\r\n";
            }).join("");
            // init resBody
            opt.targetOnEvent.querySelector(
                ".resHeaders"
            ).textContent.replace((
                /^content-type:(.*?)$/im
            ), function (ignore, match1) {
                data.contentType = match1.trim();
            });
            data.mediaType = data.contentType.split("/")[0].replace(
                "image",
                "img"
            );
            switch (data.mediaType) {
            case "audio":
            case "img":
            case "video":
                opt.targetOnEvent.querySelector(
                    ".resBody"
                ).textContent = (
                    data.contentType
                );
                opt.targetOnEvent.querySelector(
                    ".resMedia"
                ).innerHTML = (
                    "<" + data.mediaType
                    + " class=\"domOnEventMediaHotkeysInit\""
                    + " controls src=\"data:"
                    + data.contentType
                    + ";base64," + local.base64FromBuffer(data.resBuffer)
                    + "\"></" + data.mediaType + ">"
                );
                globalThis.domOnEventMediaHotkeys("init");
                break;
            default:
                opt.targetOnEvent.querySelector(
                    ".resBody"
                ).textContent = (
                    data.responseJson
                    ? JSON.stringify(data.responseJson, null, 4)
                    : data.response
                );
            }
            // shake res on err
            Array.from(opt.targetOnEvent.querySelectorAll(
                ".resBody, .resHeaders, .resStatusCode"
            )).forEach(function (element) {
                local.uiAnimateShakeIfError(data.statusCode >= 400, element);
            });
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.uiEventListenerDict.onEventOperationDisplayShow = function (
    evt,
    onError
) {
/*
 * this function will toggle the display of the operation
 */
    var element;
    element = evt.targetOnEvent;
    element = element.querySelector(
        ".operation"
    ) || element.closest(
        ".operation"
    );
    location.hash = "!" + element.id;
    element.closest(
        ".resource"
    ).classList.remove("expanded");
    // show parent resource
    local.uiAnimateSlideDown(element.closest(
        ".resource"
    ).querySelector(
        ".operationList"
    ));
    // show the operation, but hide all other operations
    local.uiAnimateSlideAccordian(
        element.querySelector(
            ".operation > form"
        ),
        Array.from(element.closest(
            ".operationList"
        ).querySelectorAll(
            ".operation > form"
        )),
        function () {
            // scrollTo operation
            element.querySelector(
                "[tabIndex]"
            ).blur();
            element.querySelector(
                "[tabIndex]"
            ).focus();
            // validate input
            local.uiEventListenerDict.onEventInputValidateAndAjax({
                targetOnEvent: element
            });
            local.setTimeoutOnError(onError, 0, null, element);
        }
    );
};

local.uiEventListenerDict.onEventResourceDisplayAction = function (evt) {
/*
 * this function will toggle the display of the resource
 */
    location.hash = "!" + evt.currentTarget.id;
    evt.targetOnEvent.className.split(" ").some(function (className) {
        switch (className) {
        case "td1":
            // show the resource, but hide all other resources
            local.uiAnimateSlideAccordian(
                evt.currentTarget.querySelector(
                    ".operationList"
                ),
                Array.from(document.querySelectorAll(
                    ".swggUiContainer .operationList"
                ))
            );
            // show at least one operation in the resource
            local.uiEventListenerDict.onEventOperationDisplayShow({
                targetOnEvent: evt.currentTarget.querySelector(
                    ".operation .uiAnimateSlide[style*=\"max-height: 100%\"]"
                ) || evt.currentTarget.querySelector(
                    ".operation"
                )
            });
            return true;
        case "td2":
            // show the resource, but hide all other resources
            local.uiAnimateSlideAccordian(
                evt.currentTarget.querySelector(
                    ".operationList"
                ),
                Array.from(document.querySelectorAll(
                    ".swggUiContainer .operationList"
                ))
            );
            // collapse all operations in the resource
            if (evt.currentTarget.classList.contains("expanded")) {
                evt.currentTarget.classList.remove("expanded");
                Array.from(evt.currentTarget.querySelectorAll(
                    ".operation > form"
                )).forEach(function (element) {
                    local.uiAnimateSlideUp(element);
                });
            // expand all operations in the resource
            } else {
                evt.currentTarget.classList.add("expanded");
                Array.from(evt.currentTarget.querySelectorAll(
                    ".operation > form"
                )).forEach(function (element) {
                    local.uiAnimateSlideDown(element);
                    // validate input
                    local.uiEventListenerDict.onEventInputValidateAndAjax({
                        targetOnEvent: element
                    });
                });
            }
            return true;
        }
    });
};

local.uiEventListenerDict.onEventUiReload = function (opt, onError) {
/*
 * this function will reload the ui
 */
    var resource;
    var swaggerJson;
    opt = opt || {};
    swaggerJson = opt;
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            if (
                event
                && event.targetOnEvent
                && !event.targetOnEvent.classList.contains(
                    "eventDelegate"
                    + event.type[0].toUpperCase()
                    + event.type.slice(1)
                )
            ) {
                return;
            }
            opt.inputUrl = document.querySelector(
                ".swggUiContainer > .thead > .td2"
            );
            // clear all apiKeyValue's from localStorage
            if (
                opt.targetOnEvent
                && opt.targetOnEvent.id === "swggApiKeyClearButton1"
            ) {
                local.apiKeyValue = "";
                Object.keys(localStorage).forEach(function (key) {
                    if (key.indexOf("utility2_swgg_apiKeyKey_") === 0) {
                        localStorage.removeItem(key);
                    }
                });
            // restore apiKeyValue
            } else if (opt.swggInit) {
                local.apiKeyKey = (
                    "utility2_swgg_apiKeyKey_" + encodeURIComponent(
                        local.urlParse(opt.inputUrl.value.replace((
                            /^\//
                        ), "")).href
                    )
                );
                local.apiKeyValue = localStorage.getItem(local.apiKeyKey) || "";
            // save apiKeyValue
            } else {
                local.apiKeyValue = document.querySelector(
                    "#swggApiKeyInput1"
                ).value;
                local.localStorageSetItemOrClear(
                    local.apiKeyKey,
                    local.apiKeyValue
                );
            }
            // if keyup-event is not return-key, then return
            if (
                (opt.type === "keyup" && opt.code !== "Enter")
                // do not reload ui during test
                || globalThis.utility2_modeTest >= 4
            ) {
                opt.modeNext = Infinity;
                opt.onNext();
                return;
            }
            // reset ui
            document.querySelector(
                "#swggUiReloadErrorDiv1"
            ).textContent = "";
            Array.from(document.querySelectorAll(
                ".swggUiContainer > .reset"
            )).forEach(function (element) {
                element.remove();
            });
            // normalize swaggerJsonUrl
            opt.inputUrl.value = local.urlParse(
                opt.inputUrl.value.replace((
                    /^\//
                ), "")
            ).href;
            document.querySelector(
                "#swggAjaxProgressDiv1 span"
            ).innerHTML = (
                "loading swagger.json"
            );
            opt.onNext();
            break;
        case 2:
            // fetch swagger.json file
            local.ajax({
                url: opt.inputUrl.value
            }, opt.onNext);
            break;
        case 3:
            // JSON.parse swagger.json string
            local.tryCatchOnError(function () {
                opt.onNext(null, JSON.parse(data.responseText));
            }, opt.onNext);
            break;
        case 4:
            // reset state
            local.apiDict = null;
            local.swaggerJson = null;
            // apiUpdate swagger.json object
            local.apiUpdate(data);
            swaggerJson = local.jsonCopy(local.swaggerJson);
            local.uiState = swaggerJson;
            // init ajaxProgressText
            swaggerJson.ajaxProgressText = "rendering swagger.json";
            // init apiKeyValue
            swaggerJson.apiKeyValue = local.apiKeyValue;
            // templateRender title
            document.querySelector(
                "head > title"
            ).textContent = local.templateRender(
                local.templateUiTitle,
                swaggerJson
            ).trim();
            // init urlSwaggerJson
            swaggerJson.urlSwaggerJson = opt.inputUrl.value;
            // templateRender main
            document.querySelector(
                ".swggUiContainer"
            ).innerHTML = local.templateRender(
                local.templateUiMain,
                swaggerJson
            );
            setTimeout(function () {
                // recurse - render .resourceList
                local.uiEventListenerDict.onEventUiReload(
                    swaggerJson,
                    opt.onNext
                );
            }, 100);
            break;
        default:
            local.onErrorDefault(err);
            // debug err
            local._debugOnEventUiReload = err || local._debugOnEventUiReload;
            document.querySelector(
                "#swggUiReloadErrorDiv1"
            ).textContent = (
                (err || {
                    message: ""
                }).message
            );
            local.setTimeoutOnError(onError, 0, err);
        }
    });
    // optimization - render .swggUiContainer first
    if (!swaggerJson.swagger) {
        opt.modeNext = 0;
        opt.onNext();
        return;
    }
    // optimization - render .resourceList in separate event-loop
    // reset state
    local.idDomElementDict = {};
    local.objectSetDefault(swaggerJson, {
        resourceDict: {},
        operationDict: {},
        tagDict: {}
    });
    // init tagDict
    swaggerJson.tags.forEach(function (tag) {
        swaggerJson.tagDict[tag.name] = tag;
    });
    // init operationDict
    Object.keys(local.apiDict).sort().forEach(function (operation) {
        // init operation
        operation = local.jsonCopy(local.apiDict[operation]);
        operation.tags.forEach(function (tag) {
            swaggerJson.operationDict[operation._methodPath] = operation;
            // init resource
            swaggerJson.resourceDict[tag] = local.objectSetDefault(
                swaggerJson.resourceDict[tag] || swaggerJson.tagDict[tag],
                {
                    description: "no description",
                    name: tag
                }
            );
            resource = swaggerJson.resourceDict[tag];
            resource.id = resource.id || local.idDomElementCreate(
                "swgg_id_" + tag
            );
            resource.summary = resource.summary || String(
                resource.description
            ).replace((
                /\bhttps?:\/\/[^\s<]+[^<.,:;"')\]\s]/g
            ), "");
        });
    });
    // init uiFragment
    swaggerJson.uiFragment = document.createDocumentFragment();
    // init resourceDict
    Object.keys(swaggerJson.resourceDict).sort().forEach(function (key) {
        // templateRender resource
        swaggerJson.uiFragment.appendChild(
            local.domFragmentRender(
                local.templateUiResource,
                swaggerJson.resourceDict[key]
            )
        );
    });
    Object.keys(swaggerJson.operationDict).sort(function (aa, bb) {
        aa = swaggerJson.operationDict[aa];
        aa = aa["x-swgg-sortValue"] || (aa._path + " " + aa._method);
        bb = swaggerJson.operationDict[bb];
        bb = bb["x-swgg-sortValue"] || (bb._path + " " + bb._method);
        return (
            aa < bb
            ? -1
            : 1
        );
    }).forEach(function (operation) {
        operation = swaggerJson.operationDict[operation];
        operation.id = local.idDomElementCreate(
            "swgg_id_" + operation.operationId
        );
        operation.tags.forEach(function (tag) {
            // create new operation for each tag
            operation = local.jsonCopy(operation);
            resource = swaggerJson.resourceDict[tag];
            local.objectSetDefault(operation, {
                description: "no description",
                responseList: Object.keys(
                    operation.responses
                ).sort().map(function (key) {
                    return {
                        key,
                        value: operation.responses[key]
                    };
                })
            });
            operation.summary = operation.summary || operation.description
            .replace((
                /\bhttps?:\/\/[^\s<]+[^<.,:;"')\]\s]/g
            ), "");
            operation.parameters.forEach(local.uiRenderSchemaP);
            // templateRender operation
            swaggerJson.uiFragment.querySelector(
                "#" + resource.id + " .operationList"
            ).appendChild(
                local.domFragmentRender(local.templateUiOperation, operation)
            );
        });
    });
    // emulate <ol></ol> for operations
    Array.from(swaggerJson.uiFragment.querySelectorAll(
        ".operationList"
    )).forEach(function (element) {
        Array.from(element.querySelectorAll(
            ".operation > .thead > .td1"
        )).forEach(function (element, ii) {
            element.textContent = ii + 1 + ".";
        });
    });
    // append uiFragment to swggUiContainer
    document.querySelector(
        "#swggAjaxProgressDiv1"
    ).style.display = "none";
    document.querySelector(
        ".swggUiContainer .resourceList"
    ).appendChild(
        swaggerJson.uiFragment
    );
    Array.from(document.querySelectorAll(
        ".swggUiContainer [data-value-text]"
    )).forEach(function (element) {
        // render valueText
        element.value = decodeURIComponent(element.dataset.valueText);
        delete element.dataset.valueText;
        // init textarea's multiline placeholder
        if (element.tagName === "TEXTAREA") {
            local.uiEventListenerDict.onEventInputTextareaChange({
                targetOnEvent: element
            });
        }
    });
    // init event-handling
    [
        "Change", "Click", "Keyup", "Submit"
    ].forEach(function (eventType) {
        Array.from(document.querySelectorAll(
            ".eventDelegate" + eventType
        )).forEach(function (element) {
            element.addEventListener(
                eventType.toLowerCase(),
                local.uiEventDelegate
            );
        });
    });
    // scrollTo location.hash
    local.uiEventListenerDict.onEventOperationDisplayShow({
        targetOnEvent: (
            document.querySelector(
                "#" + (location.hash.slice(2) || "undefined")
            )
            || document.querySelector(
                ".swggUiContainer .operation"
            )
        )
    });
    local.setTimeoutOnError(onError);
};

local.uiRenderSchemaP = function (schemaP) {
/*
 * this function will render schemaP
 */
    // init schemaP.id
    schemaP.id = local.idDomElementCreate("swgg_id_" + schemaP.name);
    // init enum
    schemaP.enum2 = (
        schemaP.enum
        || (local.schemaPItems(schemaP) || {}).enum
        || (local.schemaPType(schemaP) === "boolean" && [
            false, true
        ])
    );
    // init input - file
    if (local.schemaPType(schemaP) === "file") {
        schemaP.isFile = true;
    // init input - textarea
    } else if (schemaP.in === "body") {
        schemaP.isTextarea = true;
    // init input - select
    } else if (schemaP.enum2) {
        // init enumDefault
        schemaP.enumDefault = [];
        if (schemaP.required && schemaP.default !== undefined) {
            schemaP.enumDefault = (
                local.schemaPType(schemaP) === "array"
                ? schemaP.default
                : [
                    schemaP.default
                ]
            );
        }
        schemaP.isSelectMultiple = local.schemaPType(schemaP) === "array";
        schemaP.selectOptionList = schemaP.enum2.map(function (element) {
            // init hasDefault
            schemaP.hasDefault = (
                schemaP.hasDefault
                || schemaP.enumDefault.indexOf(element) >= 0
            );
            return {
                id: local.idDomElementCreate("swgg_id_" + schemaP.name),
                selected: (
                    // ternary-operator
                    schemaP.enumDefault.indexOf(element) >= 0
                    ? "selected"
                    : ""
                ),
                type: (
                    local.schemaPItemsType(schemaP)
                    || local.schemaPType(schemaP)
                ),
                placeholder: (
                    // ternary-operator
                    typeof element === "string"
                    ? element
                    : JSON.stringify(element)
                ),
                valueSelectOption: element
            };
        });
        // init 'undefined' value
        if (!schemaP.required && !schemaP.hasDefault) {
            schemaP.selectOptionList.unshift({
                id: local.idDomElementCreate("swgg_id_" + schemaP.name),
                selected: "selected",
                type: local.schemaPType(schemaP),
                placeholder: "<none>",
                valueSelectOption: "$swggUndefined"
            });
        }
        // select at least one value
        schemaP.selectOptionList.some(function (element, ii) {
            if (ii === 0 || element.selected) {
                element.selected = "selected";
                if (ii !== 0) {
                    schemaP.selectOptionList[0].selected = "";
                    return true;
                }
            }
        });
    // init input - textarea
    } else if (local.schemaPType(schemaP) === "array" || (
        schemaP.format === "json"
        && local.schemaPType(schemaP) === "string"
    )) {
        schemaP.isTextarea = true;
    // init input - number
    } else if (schemaP.type === "integer" || schemaP.type === "number") {
        schemaP.isInputNumber = true;
    // init input - text
    } else {
        schemaP.isInputText = true;
    }
    // init format2 / type2
    ([
        schemaP, schemaP.schema || {}
    ]).some(function (element) {
        local.objectSetDefault(schemaP, {
            format2: local.schemaPItemsType(element) || element.format,
            type2: local.schemaPType(element)
        });
        return schemaP.type2;
    });
    schemaP.type2 = schemaP.type2 || "object";
    // init schema2
    ([
        schemaP,
        local.schemaPItems(schemaP),
        schemaP.schema,
        schemaP.schema && local.schemaPItems(schemaP.schema)
    ]).some(function (element) {
        schemaP.schema2 = (local.swaggerValidateDataSchema({
            // dereference schemaP
            modeDereference: true,
            modeDereferenceDepth: 2,
            prefix: [
                "parameters", schemaP.name
            ],
            schema: element,
            swaggerJson: local.swaggerJson
        }) || {});
        return schemaP.schema2.properties;
    });
    if (schemaP.schema2.properties) {
        schemaP.schemaText = JSON.stringify((
            // ternary-operator
            schemaP.type2 === "array"
            ? [
                schemaP.schema2.properties
            ]
            : schemaP.schema2.properties
        ), null, 4);
    }
    // init placeholder
    schemaP.placeholder = (
        !local.isNullOrUndefined(schemaP.default)
        ? schemaP.default
        : local.dbFieldRandomCreate({
            modeNotRandom: true,
            schemaP
        })
    );
    if (typeof schemaP.placeholder !== "string") {
        if (schemaP.in === "body") {
            schemaP.placeholder = JSON.stringify(schemaP.placeholder, null, 4);
        } else if (Array.isArray(schemaP.placeholder)) {
            schemaP.placeholder = schemaP.placeholder.map(function (element) {
                return (
                    typeof element === "string"
                    ? element
                    : JSON.stringify(element)
                );
            }).join("\n");
        } else {
            schemaP.placeholder = JSON.stringify(schemaP.placeholder);
        }
    } else if (schemaP.format === "json") {
        schemaP.placeholder = JSON.stringify(
            JSON.parse(schemaP.placeholder),
            null,
            4
        );
    }
    // init valueText
    schemaP.valueText = (
        schemaP["x-swgg-apiKey"]
        ? local.apiKeyValue
        : schemaP.default === null
        ? ""
        : (schemaP.required || schemaP.isTextarea)
        ? schemaP.placeholder
        : ""
    );
    // templateRender schemaP
    schemaP.innerHTML = local.templateRender(
        local.templateUiParameter,
        schemaP
    );
};

local.urlParseWithBraket = function (url) {
/*
 * this function will urlParse the url with curly-brackets preserved
 */
    var tmp;
    tmp = local.stringUniqueKey(url);
    return JSON.parse(JSON.stringify(
        local.urlParse(url.replace((
            /\{/g
        ), tmp + 1).replace((
            /\}/g
        ), tmp + 2))
    ).replace(
        new RegExp(tmp + 1, "g"),
        "{"
    ).replace(
        new RegExp(tmp + 2, "g"),
        "}"
    ));
};

local.userLoginByPassword = function (opt, onError) {
/*
 * this function will send a login-by-password req
 */
    local.apiDict["GET /user/userLoginByPassword"].ajax({
        paramDict: {
            password: opt.password,
            username: opt.username
        }
    }, onError);
};

local.userLogout = function (opt, onError) {
/*
 * this function will send a logout req
 */
    local.apiDict["GET /user/userLogout"].ajax(opt, onError);
};
}());



// run node js-env code - init-after
/* istanbul ignore next */
(function () {
if (local.isBrowser) {
    return;
}
local.assetsDict["/assets.swagger-ui.logo.medium.png"] = Buffer.from(
    local.templateSwaggerUiLogoMediumBase64,
    "base64"
);
local.assetsDict["/assets.swagger-ui.logo.small.png"] = Buffer.from(
    local.templateSwaggerUiLogoSmallBase64,
    "base64"
);
local.swgg.apiUpdate(local.fsReadFileOrEmptyStringSync(
    local.__dirname + "/assets.swgg.swagger.json",
    "json"
));
}());



}());
/* script-end /assets.swgg.js */



/* script-begin /assets.utility2.example.js */
(function (local) {
    "use strict";
/* jslint ignore:start */
local.assetsDict["/assets.utility2.example.js"] = "/*\n\
example.js\n\
\n\
this script will demo automated browser-tests with coverage (via electron and istanbul)\n\
\n\
instruction\n\
    1. save this script as example.js\n\
    2. run the shell-command:\n\
        $ npm install utility2 electron-lite && \\\n\
            PATH=\"$(pwd)/node_modules/.bin:$PATH\" \\\n\
            PORT=8081 \\\n\
            npm_config_mode_coverage=utility2 \\\n\
            node_modules/.bin/utility2 test example.js\n\
    3. view test-report in ./tmp/build/test-report.html\n\
    4. view coverage in ./tmp/build/coverage.html/index.html\n\
*/\n\
\n\
\n\
\n\
/* istanbul instrument in package utility2 */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
(function (globalThis) {\n\
    \"use strict\";\n\
    var consoleError;\n\
    var local;\n\
    // init globalThis\n\
    (function () {\n\
        try {\n\
            globalThis = Function(\"return this\")(); // jslint ignore:line\n\
        } catch (ignore) {}\n\
    }());\n\
    globalThis.globalThis = globalThis;\n\
    // init debug_inline\n\
    if (!globalThis[\"debug\\u0049nline\"]) {\n\
        consoleError = console.error;\n\
        globalThis[\"debug\\u0049nline\"] = function () {\n\
        /*\n\
         * this function will both print <arguments> to stderr\n\
         * and return <arguments>[0]\n\
         */\n\
            var argList;\n\
            argList = Array.from(arguments); // jslint ignore:line\n\
            // debug arguments\n\
            globalThis[\"debug\\u0049nlineArguments\"] = argList;\n\
            consoleError(\"\\n\\ndebug\\u0049nline\");\n\
            consoleError.apply(console, argList);\n\
            consoleError(\"\\n\");\n\
            // return arg0 for inspection\n\
            return argList[0];\n\
        };\n\
    }\n\
    // init local\n\
    local = {};\n\
    local.local = local;\n\
    globalThis.globalLocal = local;\n\
    // init isBrowser\n\
    local.isBrowser = (\n\
        typeof window === \"object\"\n\
        && window === globalThis\n\
        && typeof window.XMLHttpRequest === \"function\"\n\
        && window.document\n\
        && typeof window.document.querySelector === \"function\"\n\
    );\n\
    // init function\n\
    local.assertThrow = function (passed, message) {\n\
    /*\n\
     * this function will throw err.<message> if <passed> is falsy\n\
     */\n\
        var err;\n\
        if (passed) {\n\
            return;\n\
        }\n\
        err = (\n\
            // ternary-operator\n\
            (\n\
                message\n\
                && typeof message.message === \"string\"\n\
                && typeof message.stack === \"string\"\n\
            )\n\
            // if message is errObj, then leave as is\n\
            ? message\n\
            : new Error(\n\
                typeof message === \"string\"\n\
                // if message is a string, then leave as is\n\
                ? message\n\
                // else JSON.stringify message\n\
                : JSON.stringify(message, null, 4)\n\
            )\n\
        );\n\
        throw err;\n\
    };\n\
    local.functionOrNop = function (fnc) {\n\
    /*\n\
     * this function will if <fnc> exists,\n\
     * them return <fnc>,\n\
     * else return <nop>\n\
     */\n\
        return fnc || local.nop;\n\
    };\n\
    local.identity = function (value) {\n\
    /*\n\
     * this function will return <value>\n\
     */\n\
        return value;\n\
    };\n\
    local.nop = function () {\n\
    /*\n\
     * this function will do nothing\n\
     */\n\
        return;\n\
    };\n\
    local.objectAssignDefault = function (target, source) {\n\
    /*\n\
     * this function will if items from <target> are\n\
     * null, undefined, or empty-string,\n\
     * then overwrite them with items from <source>\n\
     */\n\
        target = target || {};\n\
        Object.keys(source || {}).forEach(function (key) {\n\
            if (\n\
                target[key] === null\n\
                || target[key] === undefined\n\
                || target[key] === \"\"\n\
            ) {\n\
                target[key] = target[key] || source[key];\n\
            }\n\
        });\n\
        return target;\n\
    };\n\
    // require builtin\n\
    if (!local.isBrowser) {\n\
        local.assert = require(\"assert\");\n\
        local.buffer = require(\"buffer\");\n\
        local.child_process = require(\"child_process\");\n\
        local.cluster = require(\"cluster\");\n\
        local.crypto = require(\"crypto\");\n\
        local.dgram = require(\"dgram\");\n\
        local.dns = require(\"dns\");\n\
        local.domain = require(\"domain\");\n\
        local.events = require(\"events\");\n\
        local.fs = require(\"fs\");\n\
        local.http = require(\"http\");\n\
        local.https = require(\"https\");\n\
        local.net = require(\"net\");\n\
        local.os = require(\"os\");\n\
        local.path = require(\"path\");\n\
        local.querystring = require(\"querystring\");\n\
        local.readline = require(\"readline\");\n\
        local.repl = require(\"repl\");\n\
        local.stream = require(\"stream\");\n\
        local.string_decoder = require(\"string_decoder\");\n\
        local.timers = require(\"timers\");\n\
        local.tls = require(\"tls\");\n\
        local.tty = require(\"tty\");\n\
        local.url = require(\"url\");\n\
        local.util = require(\"util\");\n\
        local.vm = require(\"vm\");\n\
        local.zlib = require(\"zlib\");\n\
    }\n\
}(this));\n\
\n\
\n\
\n\
(function (local) {\n\
\"use strict\";\n\
\n\
\n\
\n\
// run shared js-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2_rollup\n\
    || globalThis.utility2_utility2\n\
    || require(\"utility2\")\n\
);\n\
// init exports\n\
globalThis.local = local;\n\
// run test-server\n\
local.testRunServer(local);\n\
// init assets\n\
local.assetsDict[\"/assets.hello.txt\"] = \"hello \\ud83d\\ude01\\n\";\n\
local.assetsDict[\"/assets.index.template.html\"] = \"\";\n\
}());\n\
\n\
\n\
\n\
// run shared js-env code - function\n\
(function () {\n\
local.testCase_ajax_200 = function (opt, onError) {\n\
/*\n\
 * this function will test ajax's \"200 ok\" handling-behavior\n\
 */\n\
    if (!local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = {};\n\
    // test ajax-path \"assets.hello.txt\"\n\
    local.ajax({\n\
        url: \"assets.hello.txt\"\n\
    }, function (err, xhr) {\n\
        local.tryCatchOnError(function () {\n\
            // validate no err occurred\n\
            local.assertThrow(!err, err);\n\
            // validate data\n\
            opt.data = xhr.responseText;\n\
            local.assertThrow(\n\
                opt.data === \"hello \\ud83d\\ude01\\n\",\n\
                opt.data\n\
            );\n\
            onError();\n\
        }, onError);\n\
    });\n\
};\n\
\n\
local.testCase_ajax_404 = function (opt, onError) {\n\
/*\n\
 * this function will test ajax's \"404 not found\" handling-behavior\n\
 */\n\
    if (!local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = {};\n\
    // test ajax-path \"/undefined\"\n\
    local.ajax({\n\
        url: \"/undefined\"\n\
    }, function (err) {\n\
        local.tryCatchOnError(function () {\n\
            // validate err occurred\n\
            local.assertThrow(err, err);\n\
            opt.statusCode = err.statusCode;\n\
            // validate 404 http statusCode\n\
            local.assertThrow(opt.statusCode === 404, opt.statusCode);\n\
            onError();\n\
        }, onError);\n\
    });\n\
};\n\
\n\
local.testCase_webpage_default = function (opt, onError) {\n\
/*\n\
 * this function will test webpage's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = {\n\
        modeCoverageMerge: true,\n\
        url: local.serverLocalHost + \"?modeTest=1\"\n\
    };\n\
    local.browserTest(opt, onError);\n\
};\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run browser js-env code - init-test\n\
(function () {\n\
if (!local.isBrowser) {\n\
    return;\n\
}\n\
// log stderr and stdout to #outputStdout1\n\
[\"error\", \"log\"].forEach(function (key) {\n\
    var argList;\n\
    var elem;\n\
    var fnc;\n\
    elem = document.querySelector(\n\
        \"#outputStdout1\"\n\
    );\n\
    if (!elem) {\n\
        return;\n\
    }\n\
    fnc = console[key];\n\
    console[key] = function () {\n\
        argList = Array.from(arguments); // jslint ignore:line\n\
        fnc.apply(console, argList);\n\
        // append text to #outputStdout1\n\
        elem.textContent += argList.map(function (arg) {\n\
            return (\n\
                typeof arg === \"string\"\n\
                ? arg\n\
                : JSON.stringify(arg, null, 4)\n\
            );\n\
        }).join(\" \").replace((\n\
            /\\u001b\\[\\d*m/g\n\
        ), \"\") + \"\\n\";\n\
        // scroll textarea to bottom\n\
        elem.scrollTop = elem.scrollHeight;\n\
    };\n\
});\n\
Object.assign(local, globalThis.domOnEventDelegateDict);\n\
globalThis.domOnEventDelegateDict = local;\n\
local.onEventDomDb = (\n\
    local.db && local.db.onEventDomDb\n\
);\n\
local.testRunBrowser = function (evt) {\n\
/*\n\
 * this function will run browser-tests\n\
 */\n\
    switch (\n\
        !evt.ctrlKey\n\
        && !evt.metaKey\n\
        && (\n\
            evt.modeInit\n\
            || (evt.type + \".\" + (evt.target && evt.target.id))\n\
        )\n\
    ) {\n\
    // custom-case\n\
    case \"click.jslintAutofixButton1\":\n\
    case \"keydown.inputEval1\":\n\
    case true:\n\
        globalThis.domOnEventDelegateDict.domOnEventResetOutput();\n\
        // jslint #inputEval1\n\
        local.jslint.jslintAndPrint(\n\
            document.querySelector(\n\
                \"#inputEval1\"\n\
            ).value,\n\
            \"inputEval1.js\",\n\
            {\n\
                autofix: (\n\
                    evt\n\
                    && evt.currentTarget\n\
                    && evt.currentTarget.id === \"jslintAutofixButton1\"\n\
                ),\n\
                conditional: true\n\
            }\n\
        );\n\
        if (local.jslint.jslintResult.autofix) {\n\
            document.querySelector(\n\
                \"#inputEval1\"\n\
            ).value = (\n\
                local.jslint.jslintResult.code\n\
            );\n\
        }\n\
        document.querySelector(\n\
            \"#outputJslintPre1\"\n\
        ).textContent = (\n\
            local.jslint.jslintResult.errText\n\
        ).replace((\n\
            /\\u001b\\[\\d*m/g\n\
        ), \"\").trim();\n\
        // try to cleanup __coverage__\n\
        try {\n\
            delete globalThis.__coverage__[\"/inputEval1.js\"];\n\
        } catch (ignore) {}\n\
        // try to cover and eval input-code\n\
        try {\n\
            document.querySelector(\n\
                \"#outputCode1\"\n\
            ).textContent = (\n\
                local.istanbul.instrumentSync(\n\
                    document.querySelector(\n\
                        \"#inputEval1\"\n\
                    ).value,\n\
                    \"/inputEval1.js\"\n\
                )\n\
            );\n\
            eval( // jslint ignore:line\n\
                document.querySelector(\n\
                    \"#outputCode1\"\n\
                ).textContent.replace((\n\
                    /^#!\\//\n\
                ), \"// \")\n\
            );\n\
            document.querySelector(\n\
                \"#coverageReportDiv1\"\n\
            ).innerHTML = (\n\
                local.istanbul.coverageReportCreate({\n\
                    coverage: window.__coverage__\n\
                })\n\
            );\n\
        } catch (errorCaught2) {\n\
            console.error(errorCaught2);\n\
        }\n\
        return;\n\
    case \"click.testRunButton1\":\n\
        local.modeTest = 1;\n\
        local.testRunDefault(local);\n\
        return;\n\
    // run browser-tests\n\
    default:\n\
        if (\n\
            (evt.target && evt.target.id) !== \"testRunButton1\"\n\
            && !(evt.modeInit && (\n\
                /\\bmodeTest=1\\b/\n\
            ).test(location.search))\n\
        ) {\n\
            return;\n\
        }\n\
        // show browser-tests\n\
        if (document.querySelector(\n\
            \"#testReportDiv1\"\n\
        ).style.maxHeight === \"0px\") {\n\
            globalThis.domOnEventDelegateDict.domOnEventResetOutput();\n\
            local.uiAnimateSlideDown(document.querySelector(\n\
                \"#testReportDiv1\"\n\
            ));\n\
            document.querySelector(\n\
                \"#testRunButton1\"\n\
            ).textContent = \"hide internal test\";\n\
            local.modeTest = 1;\n\
            local.testRunDefault(local);\n\
            return;\n\
        }\n\
        // hide browser-tests\n\
        local.uiAnimateSlideUp(document.querySelector(\n\
            \"#testReportDiv1\"\n\
        ));\n\
        document.querySelector(\n\
            \"#testRunButton1\"\n\
        ).textContent = \"run internal test\";\n\
    }\n\
};\n\
\n\
local.testRunBrowser({\n\
    modeInit: true\n\
});\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run node js-env code - init-test\n\
(function () {\n\
if (local.isBrowser) {\n\
    return;\n\
}\n\
// init exports\n\
module.exports = local;\n\
/* validateLineSortedReset */\n\
// init assets\n\
local.assetsDict = local.assetsDict || {};\n\
[\n\
    \"assets.index.template.html\",\n\
    \"assets.swgg.swagger.json\",\n\
    \"assets.swgg.swagger.server.json\"\n\
].forEach(function (file) {\n\
    file = \"/\" + file;\n\
    local.assetsDict[file] = local.assetsDict[file] || \"\";\n\
    if (local.fs.existsSync(local.__dirname + file)) {\n\
        local.assetsDict[file] = local.fs.readFileSync(\n\
            local.__dirname + file,\n\
            \"utf8\"\n\
        );\n\
    }\n\
});\n\
/* jslint ignore:start */\n\
local.assetsDict[\"/assets.index.template.html\"] = '\\\n\
<!doctype html>\\n\\\n\
<html lang=\"en\">\\n\\\n\
<head>\\n\\\n\
<meta charset=\"utf-8\">\\n\\\n\
<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\\n\
<!-- \"assets.utility2.template.html\" -->\\n\\\n\
<title>{{env.npm_package_name}} ({{env.npm_package_version}})</title>\\n\\\n\
<style>\\n\\\n\
/* jslint utility2:true */\\n\\\n\
/*csslint\\n\\\n\
*/\\n\\\n\
/* csslint ignore:start */\\n\\\n\
*,\\n\\\n\
*:after,\\n\\\n\
*:before {\\n\\\n\
    box-sizing: border-box;\\n\\\n\
}\\n\\\n\
/* csslint ignore:end */\\n\\\n\
@keyframes uiAnimateShake {\\n\\\n\
0%,\\n\\\n\
50% {\\n\\\n\
    transform: translateX(10px);\\n\\\n\
}\\n\\\n\
100% {\\n\\\n\
    transform: translateX(0);\\n\\\n\
}\\n\\\n\
25%,\\n\\\n\
75% {\\n\\\n\
    transform: translateX(-10px);\\n\\\n\
}\\n\\\n\
}\\n\\\n\
@keyframes uiAnimateSpin {\\n\\\n\
0% {\\n\\\n\
    transform: rotate(0deg);\\n\\\n\
}\\n\\\n\
100% {\\n\\\n\
    transform: rotate(360deg);\\n\\\n\
}\\n\\\n\
}\\n\\\n\
a {\\n\\\n\
    overflow-wrap: break-word;\\n\\\n\
}\\n\\\n\
body {\\n\\\n\
    background: #eef;\\n\\\n\
    font-family: Arial, Helvetica, sans-serif;\\n\\\n\
    font-size: small;\\n\\\n\
    margin: 0 40px;\\n\\\n\
}\\n\\\n\
body > div,\\n\\\n\
body > form > div,\\n\\\n\
body > form > input,\\n\\\n\
body > form > pre,\\n\\\n\
body > form > .button,\\n\\\n\
body > form > .textarea,\\n\\\n\
body > input,\\n\\\n\
body > pre,\\n\\\n\
body > .button,\\n\\\n\
body > .textarea {\\n\\\n\
    margin-bottom: 20px;\\n\\\n\
    margin-top: 0;\\n\\\n\
}\\n\\\n\
body > form > input,\\n\\\n\
body > form > .button,\\n\\\n\
body > input,\\n\\\n\
body > .button {\\n\\\n\
    width: 20rem;\\n\\\n\
}\\n\\\n\
body > form > .textarea,\\n\\\n\
body > .textarea {\\n\\\n\
    height: 10rem;\\n\\\n\
    width: 100%;\\n\\\n\
}\\n\\\n\
body > .readonly {\\n\\\n\
    background: #ddd;\\n\\\n\
}\\n\\\n\
code,\\n\\\n\
pre,\\n\\\n\
.textarea {\\n\\\n\
    font-family: Consolas, Menlo, monospace;\\n\\\n\
    font-size: smaller;\\n\\\n\
}\\n\\\n\
pre {\\n\\\n\
    overflow-wrap: break-word;\\n\\\n\
    white-space: pre-wrap;\\n\\\n\
}\\n\\\n\
.button {\\n\\\n\
    background-color: #fff;\\n\\\n\
    border: 1px solid;\\n\\\n\
    border-bottom-color: rgb(186, 186, 186);\\n\\\n\
    border-left-color: rgb(209, 209, 209);\\n\\\n\
    border-radius: 4px;\\n\\\n\
    border-right-color: rgb(209, 209, 209);\\n\\\n\
    border-top-color: rgb(216, 216, 216);\\n\\\n\
    color: #00d;\\n\\\n\
    cursor: pointer;\\n\\\n\
    display: inline-block;\\n\\\n\
    font-family: Arial, Helvetica, sans-serif;\\n\\\n\
    font-size: 12px;\\n\\\n\
    font-style: normal;\\n\\\n\
    font-weight: normal;\\n\\\n\
    margin: 0;\\n\\\n\
    padding: 2px 7px 3px 7px;\\n\\\n\
    text-align: center;\\n\\\n\
    text-decoration: underline;\\n\\\n\
}\\n\\\n\
.colorError {\\n\\\n\
    color: #d00;\\n\\\n\
}\\n\\\n\
.textarea {\\n\\\n\
    background: #fff;\\n\\\n\
    border: 1px solid #999;\\n\\\n\
    border-radius: 0;\\n\\\n\
    cursor: auto;\\n\\\n\
    overflow: auto;\\n\\\n\
    padding: 2px;\\n\\\n\
}\\n\\\n\
.uiAnimateShake {\\n\\\n\
    animation-duration: 500ms;\\n\\\n\
    animation-name: uiAnimateShake;\\n\\\n\
}\\n\\\n\
.uiAnimateSlide {\\n\\\n\
    overflow-y: hidden;\\n\\\n\
    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\\n\\\n\
}\\n\\\n\
.utility2FooterDiv {\\n\\\n\
    text-align: center;\\n\\\n\
}\\n\\\n\
.zeroPixel {\\n\\\n\
    border: 0;\\n\\\n\
    height: 0;\\n\\\n\
    margin: 0;\\n\\\n\
    padding: 0;\\n\\\n\
    width: 0;\\n\\\n\
}\\n\\\n\
</style>\\n\\\n\
</head>\\n\\\n\
<body>\\n\\\n\
<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\\n\\\n\
<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\\n\\\n\
<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\\n\\\n\
<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\\n\\\n\
<script>\\n\\\n\
/* jslint utility2:true */\\n\\\n\
// init domOnEventWindowOnloadTimeElapsed\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will measure and print time-elapsed for window.onload\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    if (window.domOnEventWindowOnloadTimeElapsed) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\\n\\\n\
    window.addEventListener(\"load\", function () {\\n\\\n\
        setTimeout(function () {\\n\\\n\
            window.domOnEventWindowOnloadTimeElapsed = (\\n\\\n\
                Date.now()\\n\\\n\
                - window.domOnEventWindowOnloadTimeElapsed\\n\\\n\
            );\\n\\\n\
            console.error(\\n\\\n\
                \"domOnEventWindowOnloadTimeElapsed = \"\\n\\\n\
                + window.domOnEventWindowOnloadTimeElapsed\\n\\\n\
            );\\n\\\n\
        }, 100);\\n\\\n\
    });\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// init domOnEventDelegateDict\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will handle delegated dom-event\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    var timerTimeoutDict;\\n\\\n\
    if (window.domOnEventDelegateDict) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    window.domOnEventDelegateDict = {};\\n\\\n\
    timerTimeoutDict = {};\\n\\\n\
    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\\n\\\n\
        evt.targetOnEvent = evt.target.closest(\\n\\\n\
            \"[data-onevent]\"\\n\\\n\
        );\\n\\\n\
        if (\\n\\\n\
            !evt.targetOnEvent\\n\\\n\
            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\\n\\\n\
            || evt.target.closest(\\n\\\n\
                \".disabled, .readonly\"\\n\\\n\
            )\\n\\\n\
        ) {\\n\\\n\
            return;\\n\\\n\
        }\\n\\\n\
        // rate-limit high-frequency-event\\n\\\n\
        switch (evt.type) {\\n\\\n\
        case \"keydown\":\\n\\\n\
        case \"keyup\":\\n\\\n\
            // filter non-input keyboard-event\\n\\\n\
            if (!evt.target.closest(\\n\\\n\
                \"input, option, select, textarea\"\\n\\\n\
            )) {\\n\\\n\
                return;\\n\\\n\
            }\\n\\\n\
            if (timerTimeoutDict[evt.type] !== true) {\\n\\\n\
                timerTimeoutDict[evt.type] = timerTimeoutDict[\\n\\\n\
                    evt.type\\n\\\n\
                ] || setTimeout(function () {\\n\\\n\
                    timerTimeoutDict[evt.type] = true;\\n\\\n\
                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\\n\\\n\
                }, 50);\\n\\\n\
                return;\\n\\\n\
            }\\n\\\n\
            timerTimeoutDict[evt.type] = null;\\n\\\n\
            break;\\n\\\n\
        }\\n\\\n\
        switch (evt.targetOnEvent.tagName) {\\n\\\n\
        case \"BUTTON\":\\n\\\n\
        case \"FORM\":\\n\\\n\
            evt.preventDefault();\\n\\\n\
            break;\\n\\\n\
        }\\n\\\n\
        evt.stopPropagation();\\n\\\n\
        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\\n\\\n\
            evt\\n\\\n\
        );\\n\\\n\
    };\\n\\\n\
    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\\n\\\n\
        Array.from(document.querySelectorAll(\\n\\\n\
            \".onevent-reset-output\"\\n\\\n\
        )).forEach(function (elem) {\\n\\\n\
            switch (elem.tagName) {\\n\\\n\
            case \"INPUT\":\\n\\\n\
            case \"TEXTAREA\":\\n\\\n\
                elem.value = \"\";\\n\\\n\
                break;\\n\\\n\
            case \"PRE\":\\n\\\n\
                elem.textContent = \"\";\\n\\\n\
                break;\\n\\\n\
            default:\\n\\\n\
                elem.innerHTML = \"\";\\n\\\n\
            }\\n\\\n\
        });\\n\\\n\
    };\\n\\\n\
    // init event-handling\\n\\\n\
    [\\n\\\n\
        \"change\",\\n\\\n\
        \"click\",\\n\\\n\
        \"keydown\",\\n\\\n\
        \"submit\"\\n\\\n\
    ].forEach(function (eventType) {\\n\\\n\
        document.addEventListener(\\n\\\n\
            eventType,\\n\\\n\
            window.domOnEventDelegateDict.domOnEventDelegate\\n\\\n\
        );\\n\\\n\
    });\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// init timerIntervalAjaxProgressUpdate\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will increment ajax-progress-bar\\n\\\n\
 * until webpage has loaded\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    var ajaxProgressDiv1;\\n\\\n\
    var ajaxProgressState;\\n\\\n\
    var ajaxProgressUpdate;\\n\\\n\
    if (\\n\\\n\
        window.timerIntervalAjaxProgressUpdate\\n\\\n\
        || !document.querySelector(\\n\\\n\
            \"#ajaxProgressDiv1\"\\n\\\n\
        )\\n\\\n\
    ) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    ajaxProgressDiv1 = document.querySelector(\\n\\\n\
        \"#ajaxProgressDiv1\"\\n\\\n\
    );\\n\\\n\
    setTimeout(function () {\\n\\\n\
        ajaxProgressDiv1.style.width = \"25%\";\\n\\\n\
    });\\n\\\n\
    ajaxProgressState = 0;\\n\\\n\
    ajaxProgressUpdate = (\\n\\\n\
        window.local\\n\\\n\
        && window.local.ajaxProgressUpdate\\n\\\n\
    ) || function () {\\n\\\n\
        ajaxProgressDiv1.style.width = \"100%\";\\n\\\n\
        setTimeout(function () {\\n\\\n\
            ajaxProgressDiv1.style.background = \"transparent\";\\n\\\n\
            setTimeout(function () {\\n\\\n\
                ajaxProgressDiv1.style.width = \"0%\";\\n\\\n\
            }, 500);\\n\\\n\
        }, 1000);\\n\\\n\
    };\\n\\\n\
    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\\n\\\n\
        ajaxProgressState += 1;\\n\\\n\
        ajaxProgressDiv1.style.width = Math.max(\\n\\\n\
            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\\n\\\n\
            ajaxProgressDiv1.style.width.slice(0, -1) | 0\\n\\\n\
        ) + \"%\";\\n\\\n\
    }, 1000);\\n\\\n\
    window.addEventListener(\"load\", function () {\\n\\\n\
        clearInterval(window.timerIntervalAjaxProgressUpdate);\\n\\\n\
        ajaxProgressUpdate();\\n\\\n\
    });\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// init domOnEventSelectAllWithinPre\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will limit select-all within <pre tabIndex=\"0\"> elements\\n\\\n\
 * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    if (window.domOnEventSelectAllWithinPre) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    window.domOnEventSelectAllWithinPre = function (evt) {\\n\\\n\
        var range;\\n\\\n\
        var selection;\\n\\\n\
        if (\\n\\\n\
            evt\\n\\\n\
            && evt.key === \"a\"\\n\\\n\
            && (evt.ctrlKey || evt.metaKey)\\n\\\n\
            && evt.target.closest(\\n\\\n\
                \"pre\"\\n\\\n\
            )\\n\\\n\
        ) {\\n\\\n\
            range = document.createRange();\\n\\\n\
            range.selectNodeContents(evt.target.closest(\\n\\\n\
                \"pre\"\\n\\\n\
            ));\\n\\\n\
            selection = window.getSelection();\\n\\\n\
            selection.removeAllRanges();\\n\\\n\
            selection.addRange(range);\\n\\\n\
            evt.preventDefault();\\n\\\n\
        }\\n\\\n\
    };\\n\\\n\
    // init event-handling\\n\\\n\
    document.addEventListener(\\n\\\n\
        \"keydown\",\\n\\\n\
        window.domOnEventSelectAllWithinPre\\n\\\n\
    );\\n\\\n\
}());\\n\\\n\
</script>\\n\\\n\
<h1>\\n\\\n\
<!-- utility2-comment\\n\\\n\
    <a\\n\\\n\
        {{#if env.npm_package_homepage}}\\n\\\n\
        href=\"{{env.npm_package_homepage}}\"\\n\\\n\
        {{/if env.npm_package_homepage}}\\n\\\n\
        target=\"_blank\"\\n\\\n\
    >\\n\\\n\
utility2-comment -->\\n\\\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\\n\\\n\
<!-- utility2-comment\\n\\\n\
    </a>\\n\\\n\
utility2-comment -->\\n\\\n\
</h1>\\n\\\n\
<h3>{{env.npm_package_description}}</h3>\\n\\\n\
<!-- utility2-comment\\n\\\n\
<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\\n\\\n\
<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"testRunButton1\">run internal test</button><br>\\n\\\n\
utility2-comment -->\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
<label>edit or paste script below to cover and test</label>\\n\\\n\
<textarea class=\"textarea\" data-onevent=\"testRunBrowser\" id=\"inputEval1\">\\n\\\n\
// remove comment below to disable jslint\\n\\\n\
/*jslint browser, devel*/\\n\\\n\
/*global window*/\\n\\\n\
(function () {\\n\\\n\
    \"use strict\";\\n\\\n\
    var testCaseDict;\\n\\\n\
    testCaseDict = {};\\n\\\n\
    testCaseDict.modeTest = 1;\\n\\\n\
\\n\\\n\
    // comment this testCase to disable failed error demo\\n\\\n\
    testCaseDict.testCase_failed_error_demo = function (opt, onError) {\\n\\\n\
    /*\\n\\\n\
     * this function will run a failed error demo\\n\\\n\
     */\\n\\\n\
        // jslint-hack\\n\\\n\
        window.utility2.nop(opt);\\n\\\n\
        onError(new Error(\"this is a failed error demo\"));\\n\\\n\
    };\\n\\\n\
\\n\\\n\
    testCaseDict.testCase_passed_ajax_demo = function (opt, onError) {\\n\\\n\
    /*\\n\\\n\
     * this function will demo a passed ajax test\\n\\\n\
     */\\n\\\n\
        var data;\\n\\\n\
        opt = {url: \"/\"};\\n\\\n\
        // test ajax-req for main-page \"/\"\\n\\\n\
        window.utility2.ajax(opt, function (err, xhr) {\\n\\\n\
            try {\\n\\\n\
                // validate no err occurred\\n\\\n\
                console.assert(!err, err);\\n\\\n\
                // validate \"200 ok\" status\\n\\\n\
                console.assert(xhr.statusCode === 200, xhr.statusCode);\\n\\\n\
                // validate non-empty data\\n\\\n\
                data = xhr.responseText;\\n\\\n\
                console.assert(data && data.length > 0, data);\\n\\\n\
                onError();\\n\\\n\
            } catch (errorCaught) {\\n\\\n\
                onError(errorCaught);\\n\\\n\
            }\\n\\\n\
        });\\n\\\n\
    };\\n\\\n\
\\n\\\n\
    window.utility2.testRunDefault(testCaseDict);\\n\\\n\
}());\\n\\\n\
</textarea>\\n\\\n\
<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"jslintAutofixButton1\">jslint autofix</button><br>\\n\\\n\
<pre class= \"colorError\" id=\"outputJslintPre1\" tabindex=\"0\"></pre>\\n\\\n\
<label>instrumented-code</label>\\n\\\n\
<pre class=\"readonly textarea\" id=\"outputCode1\" tabindex=\"0\"></pre>\\n\\\n\
<label>stderr and stdout</label>\\n\\\n\
<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabindex=\"0\"></pre>\\n\\\n\
<div id=\"testReportDiv1\"></div>\\n\\\n\
<div id=\"coverageReportDiv1\"></div>\\n\\\n\
<!-- utility2-comment\\n\\\n\
{{#if isRollup}}\\n\\\n\
<script src=\"assets.app.js\"></script>\\n\\\n\
{{#unless isRollup}}\\n\\\n\
utility2-comment -->\\n\\\n\
<script src=\"assets.utility2.lib.istanbul.js\"></script>\\n\\\n\
<script src=\"assets.utility2.lib.jslint.js\"></script>\\n\\\n\
<script src=\"assets.utility2.lib.db.js\"></script>\\n\\\n\
<script src=\"assets.utility2.lib.marked.js\"></script>\\n\\\n\
<script src=\"assets.utility2.lib.sjcl.js\"></script>\\n\\\n\
<script src=\"assets.utility2.js\"></script>\\n\\\n\
<script>window.utility2_onReadyBefore.counter += 1;</script>\\n\\\n\
<script src=\"jsonp.utility2.stateInit?callback=window.utility2.stateInit\"></script>\\n\\\n\
<script src=\"assets.example.js\"></script>\\n\\\n\
<script src=\"assets.test.js\"></script>\\n\\\n\
<script>window.utility2_onReadyBefore();</script>\\n\\\n\
<!-- utility2-comment\\n\\\n\
{{/if isRollup}}\\n\\\n\
utility2-comment -->\\n\\\n\
<div class=\"utility2FooterDiv\">\\n\\\n\
    [ this app was created with\\n\\\n\
    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\\n\
    ]\\n\\\n\
</div>\\n\\\n\
</body>\\n\\\n\
</html>\\n\\\n\
';\n\
/* jslint ignore:end */\n\
/* validateLineSortedReset */\n\
/* jslint ignore:start */\n\
local.assetsDict[\"/assets.utility2.js\"] =\n\
    local.assetsDict[\"/assets.utility2.js\"] ||\n\
    local.fs.readFileSync(local.__dirname + \"/lib.utility2.js\", \"utf8\"\n\
).replace((/^#!\\//), \"// \");\n\
/* jslint ignore:end */\n\
/* validateLineSortedReset */\n\
local.assetsDict[\"/\"] = local.assetsDict[\"/assets.index.template.html\"]\n\
.replace((\n\
    /\\{\\{env\\.(\\w+?)\\}\\}/g\n\
), function (match0, match1) {\n\
    switch (match1) {\n\
    case \"npm_package_description\":\n\
        return \"the greatest app in the world!\";\n\
    case \"npm_package_name\":\n\
        return \"utility2\";\n\
    case \"npm_package_nameLib\":\n\
        return \"utility2\";\n\
    case \"npm_package_version\":\n\
        return \"0.0.1\";\n\
    default:\n\
        return match0;\n\
    }\n\
});\n\
local.assetsDict[\"/assets.example.html\"] = local.assetsDict[\"/\"];\n\
local.assetsDict[\"/index.html\"] = local.assetsDict[\"/\"];\n\
// init cli\n\
if (module !== require.main || globalThis.utility2_rollup) {\n\
    return;\n\
}\n\
/* validateLineSortedReset */\n\
local.assetsDict[\"/assets.example.js\"] = (\n\
    local.assetsDict[\"/assets.example.js\"]\n\
    || local.fs.readFileSync(__filename, \"utf8\")\n\
);\n\
local.assetsDict[\"/favicon.ico\"] = local.assetsDict[\"/favicon.ico\"] || \"\";\n\
// if $npm_config_timeout_exit exists,\n\
// then exit this process after $npm_config_timeout_exit ms\n\
if (Number(process.env.npm_config_timeout_exit)) {\n\
    setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\n\
}\n\
// start server\n\
if (globalThis.utility2_serverHttp1) {\n\
    return;\n\
}\n\
process.env.PORT = process.env.PORT || \"8081\";\n\
console.error(\"http-server listening on port \" + process.env.PORT);\n\
local.http.createServer(function (req, res) {\n\
    req.urlParsed = local.url.parse(req.url);\n\
    if (local.assetsDict[req.urlParsed.pathname] !== undefined) {\n\
        res.end(local.assetsDict[req.urlParsed.pathname]);\n\
        return;\n\
    }\n\
    res.statusCode = 404;\n\
    res.end();\n\
}).listen(process.env.PORT);\n\
}());\n\
\n\
\n\
\n\
}());\n\
"
/* jslint ignore:end */
    return local;
}(globalThis.utility2_rollup));
/* script-end /assets.utility2.example.js */



/* script-begin /assets.utility2.html */
(function (local) {
    "use strict";
/* jslint ignore:start */
local.assetsDict["/assets.utility2.html"] = "<!doctype html>\n\
<html lang=\"en\">\n\
<head>\n\
<meta charset=\"utf-8\">\n\
<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\
<!-- \"assets.utility2.template.html\" -->\n\
<title>utility2 (0.0.1)</title>\n\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
*/\n\
/* csslint ignore:start */\n\
*,\n\
*:after,\n\
*:before {\n\
    box-sizing: border-box;\n\
}\n\
/* csslint ignore:end */\n\
@keyframes uiAnimateShake {\n\
0%,\n\
50% {\n\
    transform: translateX(10px);\n\
}\n\
100% {\n\
    transform: translateX(0);\n\
}\n\
25%,\n\
75% {\n\
    transform: translateX(-10px);\n\
}\n\
}\n\
@keyframes uiAnimateSpin {\n\
0% {\n\
    transform: rotate(0deg);\n\
}\n\
100% {\n\
    transform: rotate(360deg);\n\
}\n\
}\n\
a {\n\
    overflow-wrap: break-word;\n\
}\n\
body {\n\
    background: #eef;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: small;\n\
    margin: 0 40px;\n\
}\n\
body > div,\n\
body > form > div,\n\
body > form > input,\n\
body > form > pre,\n\
body > form > .button,\n\
body > form > .textarea,\n\
body > input,\n\
body > pre,\n\
body > .button,\n\
body > .textarea {\n\
    margin-bottom: 20px;\n\
    margin-top: 0;\n\
}\n\
body > form > input,\n\
body > form > .button,\n\
body > input,\n\
body > .button {\n\
    width: 20rem;\n\
}\n\
body > form > .textarea,\n\
body > .textarea {\n\
    height: 10rem;\n\
    width: 100%;\n\
}\n\
body > .readonly {\n\
    background: #ddd;\n\
}\n\
code,\n\
pre,\n\
.textarea {\n\
    font-family: Consolas, Menlo, monospace;\n\
    font-size: smaller;\n\
}\n\
pre {\n\
    overflow-wrap: break-word;\n\
    white-space: pre-wrap;\n\
}\n\
.button {\n\
    background-color: #fff;\n\
    border: 1px solid;\n\
    border-bottom-color: rgb(186, 186, 186);\n\
    border-left-color: rgb(209, 209, 209);\n\
    border-radius: 4px;\n\
    border-right-color: rgb(209, 209, 209);\n\
    border-top-color: rgb(216, 216, 216);\n\
    color: #00d;\n\
    cursor: pointer;\n\
    display: inline-block;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: 12px;\n\
    font-style: normal;\n\
    font-weight: normal;\n\
    margin: 0;\n\
    padding: 2px 7px 3px 7px;\n\
    text-align: center;\n\
    text-decoration: underline;\n\
}\n\
.colorError {\n\
    color: #d00;\n\
}\n\
.textarea {\n\
    background: #fff;\n\
    border: 1px solid #999;\n\
    border-radius: 0;\n\
    cursor: auto;\n\
    overflow: auto;\n\
    padding: 2px;\n\
}\n\
.uiAnimateShake {\n\
    animation-duration: 500ms;\n\
    animation-name: uiAnimateShake;\n\
}\n\
.uiAnimateSlide {\n\
    overflow-y: hidden;\n\
    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n\
}\n\
.utility2FooterDiv {\n\
    text-align: center;\n\
}\n\
.zeroPixel {\n\
    border: 0;\n\
    height: 0;\n\
    margin: 0;\n\
    padding: 0;\n\
    width: 0;\n\
}\n\
</style>\n\
</head>\n\
<body>\n\
<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\n\
<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\n\
<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\n\
<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\n\
<script>\n\
/* jslint utility2:true */\n\
// init domOnEventWindowOnloadTimeElapsed\n\
(function () {\n\
/*\n\
 * this function will measure and print time-elapsed for window.onload\n\
 */\n\
    \"use strict\";\n\
    if (window.domOnEventWindowOnloadTimeElapsed) {\n\
        return;\n\
    }\n\
    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n\
    window.addEventListener(\"load\", function () {\n\
        setTimeout(function () {\n\
            window.domOnEventWindowOnloadTimeElapsed = (\n\
                Date.now()\n\
                - window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
            console.error(\n\
                \"domOnEventWindowOnloadTimeElapsed = \"\n\
                + window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
        }, 100);\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventDelegateDict\n\
(function () {\n\
/*\n\
 * this function will handle delegated dom-event\n\
 */\n\
    \"use strict\";\n\
    var timerTimeoutDict;\n\
    if (window.domOnEventDelegateDict) {\n\
        return;\n\
    }\n\
    window.domOnEventDelegateDict = {};\n\
    timerTimeoutDict = {};\n\
    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n\
        evt.targetOnEvent = evt.target.closest(\n\
            \"[data-onevent]\"\n\
        );\n\
        if (\n\
            !evt.targetOnEvent\n\
            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\n\
            || evt.target.closest(\n\
                \".disabled, .readonly\"\n\
            )\n\
        ) {\n\
            return;\n\
        }\n\
        // rate-limit high-frequency-event\n\
        switch (evt.type) {\n\
        case \"keydown\":\n\
        case \"keyup\":\n\
            // filter non-input keyboard-event\n\
            if (!evt.target.closest(\n\
                \"input, option, select, textarea\"\n\
            )) {\n\
                return;\n\
            }\n\
            if (timerTimeoutDict[evt.type] !== true) {\n\
                timerTimeoutDict[evt.type] = timerTimeoutDict[\n\
                    evt.type\n\
                ] || setTimeout(function () {\n\
                    timerTimeoutDict[evt.type] = true;\n\
                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n\
                }, 50);\n\
                return;\n\
            }\n\
            timerTimeoutDict[evt.type] = null;\n\
            break;\n\
        }\n\
        switch (evt.targetOnEvent.tagName) {\n\
        case \"BUTTON\":\n\
        case \"FORM\":\n\
            evt.preventDefault();\n\
            break;\n\
        }\n\
        evt.stopPropagation();\n\
        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n\
            evt\n\
        );\n\
    };\n\
    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n\
        Array.from(document.querySelectorAll(\n\
            \".onevent-reset-output\"\n\
        )).forEach(function (elem) {\n\
            switch (elem.tagName) {\n\
            case \"INPUT\":\n\
            case \"TEXTAREA\":\n\
                elem.value = \"\";\n\
                break;\n\
            case \"PRE\":\n\
                elem.textContent = \"\";\n\
                break;\n\
            default:\n\
                elem.innerHTML = \"\";\n\
            }\n\
        });\n\
    };\n\
    // init event-handling\n\
    [\n\
        \"change\",\n\
        \"click\",\n\
        \"keydown\",\n\
        \"submit\"\n\
    ].forEach(function (eventType) {\n\
        document.addEventListener(\n\
            eventType,\n\
            window.domOnEventDelegateDict.domOnEventDelegate\n\
        );\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init timerIntervalAjaxProgressUpdate\n\
(function () {\n\
/*\n\
 * this function will increment ajax-progress-bar\n\
 * until webpage has loaded\n\
 */\n\
    \"use strict\";\n\
    var ajaxProgressDiv1;\n\
    var ajaxProgressState;\n\
    var ajaxProgressUpdate;\n\
    if (\n\
        window.timerIntervalAjaxProgressUpdate\n\
        || !document.querySelector(\n\
            \"#ajaxProgressDiv1\"\n\
        )\n\
    ) {\n\
        return;\n\
    }\n\
    ajaxProgressDiv1 = document.querySelector(\n\
        \"#ajaxProgressDiv1\"\n\
    );\n\
    setTimeout(function () {\n\
        ajaxProgressDiv1.style.width = \"25%\";\n\
    });\n\
    ajaxProgressState = 0;\n\
    ajaxProgressUpdate = (\n\
        window.local\n\
        && window.local.ajaxProgressUpdate\n\
    ) || function () {\n\
        ajaxProgressDiv1.style.width = \"100%\";\n\
        setTimeout(function () {\n\
            ajaxProgressDiv1.style.background = \"transparent\";\n\
            setTimeout(function () {\n\
                ajaxProgressDiv1.style.width = \"0%\";\n\
            }, 500);\n\
        }, 1000);\n\
    };\n\
    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n\
        ajaxProgressState += 1;\n\
        ajaxProgressDiv1.style.width = Math.max(\n\
            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n\
            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n\
        ) + \"%\";\n\
    }, 1000);\n\
    window.addEventListener(\"load\", function () {\n\
        clearInterval(window.timerIntervalAjaxProgressUpdate);\n\
        ajaxProgressUpdate();\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventSelectAllWithinPre\n\
(function () {\n\
/*\n\
 * this function will limit select-all within <pre tabIndex=\"0\"> elements\n\
 * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n\
 */\n\
    \"use strict\";\n\
    if (window.domOnEventSelectAllWithinPre) {\n\
        return;\n\
    }\n\
    window.domOnEventSelectAllWithinPre = function (evt) {\n\
        var range;\n\
        var selection;\n\
        if (\n\
            evt\n\
            && evt.key === \"a\"\n\
            && (evt.ctrlKey || evt.metaKey)\n\
            && evt.target.closest(\n\
                \"pre\"\n\
            )\n\
        ) {\n\
            range = document.createRange();\n\
            range.selectNodeContents(evt.target.closest(\n\
                \"pre\"\n\
            ));\n\
            selection = window.getSelection();\n\
            selection.removeAllRanges();\n\
            selection.addRange(range);\n\
            evt.preventDefault();\n\
        }\n\
    };\n\
    // init event-handling\n\
    document.addEventListener(\n\
        \"keydown\",\n\
        window.domOnEventSelectAllWithinPre\n\
    );\n\
}());\n\
</script>\n\
<h1>\n\
\n\
    <a\n\
        \n\
        href=\"https://github.com/kaizhu256/node-utility2\"\n\
        \n\
        target=\"_blank\"\n\
    >\n\
\n\
        utility2 (0.0.1)\n\
\n\
    </a>\n\
\n\
</h1>\n\
<h3>this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps</h3>\n\
\n\
<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\n\
<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"testRunButton1\">run internal test</button><br>\n\
\n\
\n\
\n\
\n\
<label>edit or paste script below to cover and test</label>\n\
<textarea class=\"textarea\" data-onevent=\"testRunBrowser\" id=\"inputEval1\">\n\
// remove comment below to disable jslint\n\
/*jslint browser, devel*/\n\
/*global window*/\n\
(function () {\n\
    \"use strict\";\n\
    var testCaseDict;\n\
    testCaseDict = {};\n\
    testCaseDict.modeTest = 1;\n\
\n\
    // comment this testCase to disable failed error demo\n\
    testCaseDict.testCase_failed_error_demo = function (opt, onError) {\n\
    /*\n\
     * this function will run a failed error demo\n\
     */\n\
        // jslint-hack\n\
        window.utility2.nop(opt);\n\
        onError(new Error(\"this is a failed error demo\"));\n\
    };\n\
\n\
    testCaseDict.testCase_passed_ajax_demo = function (opt, onError) {\n\
    /*\n\
     * this function will demo a passed ajax test\n\
     */\n\
        var data;\n\
        opt = {url: \"/\"};\n\
        // test ajax-req for main-page \"/\"\n\
        window.utility2.ajax(opt, function (err, xhr) {\n\
            try {\n\
                // validate no err occurred\n\
                console.assert(!err, err);\n\
                // validate \"200 ok\" status\n\
                console.assert(xhr.statusCode === 200, xhr.statusCode);\n\
                // validate non-empty data\n\
                data = xhr.responseText;\n\
                console.assert(data && data.length > 0, data);\n\
                onError();\n\
            } catch (errorCaught) {\n\
                onError(errorCaught);\n\
            }\n\
        });\n\
    };\n\
\n\
    window.utility2.testRunDefault(testCaseDict);\n\
}());\n\
</textarea>\n\
<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"jslintAutofixButton1\">jslint autofix</button><br>\n\
<pre class= \"colorError\" id=\"outputJslintPre1\" tabindex=\"0\"></pre>\n\
<label>instrumented-code</label>\n\
<pre class=\"readonly textarea\" id=\"outputCode1\" tabindex=\"0\"></pre>\n\
<label>stderr and stdout</label>\n\
<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabindex=\"0\"></pre>\n\
<div id=\"testReportDiv1\"></div>\n\
<div id=\"coverageReportDiv1\"></div>\n\
\n\
\n\
<script src=\"assets.utility2.rollup.js\"></script>\n\
<script src=\"assets.utility2.example.js\"></script>\n\
<script src=\"assets.utility2.test.js\"></script>\n\
\n\
\n\
<div class=\"utility2FooterDiv\">\n\
    [ this app was created with\n\
    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\n\
    ]\n\
</div>\n\
</body>\n\
</html>\n\
"
/* jslint ignore:end */
    return local;
}(globalThis.utility2_rollup));
/* script-end /assets.utility2.html */



/* script-begin /assets.utility2.test.js */
(function (local) {
    "use strict";
/* jslint ignore:start */
local.assetsDict["/assets.utility2.test.js"] = "/* istanbul instrument in package utility2 */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
(function (globalThis) {\n\
    \"use strict\";\n\
    var consoleError;\n\
    var local;\n\
    // init globalThis\n\
    (function () {\n\
        try {\n\
            globalThis = Function(\"return this\")(); // jslint ignore:line\n\
        } catch (ignore) {}\n\
    }());\n\
    globalThis.globalThis = globalThis;\n\
    // init debug_inline\n\
    if (!globalThis[\"debug\\u0049nline\"]) {\n\
        consoleError = console.error;\n\
        globalThis[\"debug\\u0049nline\"] = function () {\n\
        /*\n\
         * this function will both print <arguments> to stderr\n\
         * and return <arguments>[0]\n\
         */\n\
            var argList;\n\
            argList = Array.from(arguments); // jslint ignore:line\n\
            // debug arguments\n\
            globalThis[\"debug\\u0049nlineArguments\"] = argList;\n\
            consoleError(\"\\n\\ndebug\\u0049nline\");\n\
            consoleError.apply(console, argList);\n\
            consoleError(\"\\n\");\n\
            // return arg0 for inspection\n\
            return argList[0];\n\
        };\n\
    }\n\
    // init local\n\
    local = {};\n\
    local.local = local;\n\
    globalThis.globalLocal = local;\n\
    // init isBrowser\n\
    local.isBrowser = (\n\
        typeof window === \"object\"\n\
        && window === globalThis\n\
        && typeof window.XMLHttpRequest === \"function\"\n\
        && window.document\n\
        && typeof window.document.querySelector === \"function\"\n\
    );\n\
    // init function\n\
    local.assertThrow = function (passed, message) {\n\
    /*\n\
     * this function will throw err.<message> if <passed> is falsy\n\
     */\n\
        var err;\n\
        if (passed) {\n\
            return;\n\
        }\n\
        err = (\n\
            // ternary-operator\n\
            (\n\
                message\n\
                && typeof message.message === \"string\"\n\
                && typeof message.stack === \"string\"\n\
            )\n\
            // if message is errObj, then leave as is\n\
            ? message\n\
            : new Error(\n\
                typeof message === \"string\"\n\
                // if message is a string, then leave as is\n\
                ? message\n\
                // else JSON.stringify message\n\
                : JSON.stringify(message, null, 4)\n\
            )\n\
        );\n\
        throw err;\n\
    };\n\
    local.functionOrNop = function (fnc) {\n\
    /*\n\
     * this function will if <fnc> exists,\n\
     * them return <fnc>,\n\
     * else return <nop>\n\
     */\n\
        return fnc || local.nop;\n\
    };\n\
    local.identity = function (value) {\n\
    /*\n\
     * this function will return <value>\n\
     */\n\
        return value;\n\
    };\n\
    local.nop = function () {\n\
    /*\n\
     * this function will do nothing\n\
     */\n\
        return;\n\
    };\n\
    local.objectAssignDefault = function (target, source) {\n\
    /*\n\
     * this function will if items from <target> are\n\
     * null, undefined, or empty-string,\n\
     * then overwrite them with items from <source>\n\
     */\n\
        target = target || {};\n\
        Object.keys(source || {}).forEach(function (key) {\n\
            if (\n\
                target[key] === null\n\
                || target[key] === undefined\n\
                || target[key] === \"\"\n\
            ) {\n\
                target[key] = target[key] || source[key];\n\
            }\n\
        });\n\
        return target;\n\
    };\n\
    // require builtin\n\
    if (!local.isBrowser) {\n\
        local.assert = require(\"assert\");\n\
        local.buffer = require(\"buffer\");\n\
        local.child_process = require(\"child_process\");\n\
        local.cluster = require(\"cluster\");\n\
        local.crypto = require(\"crypto\");\n\
        local.dgram = require(\"dgram\");\n\
        local.dns = require(\"dns\");\n\
        local.domain = require(\"domain\");\n\
        local.events = require(\"events\");\n\
        local.fs = require(\"fs\");\n\
        local.http = require(\"http\");\n\
        local.https = require(\"https\");\n\
        local.net = require(\"net\");\n\
        local.os = require(\"os\");\n\
        local.path = require(\"path\");\n\
        local.querystring = require(\"querystring\");\n\
        local.readline = require(\"readline\");\n\
        local.repl = require(\"repl\");\n\
        local.stream = require(\"stream\");\n\
        local.string_decoder = require(\"string_decoder\");\n\
        local.timers = require(\"timers\");\n\
        local.tls = require(\"tls\");\n\
        local.tty = require(\"tty\");\n\
        local.url = require(\"url\");\n\
        local.util = require(\"util\");\n\
        local.vm = require(\"vm\");\n\
        local.zlib = require(\"zlib\");\n\
    }\n\
}(this));\n\
\n\
\n\
\n\
(function (local) {\n\
\"use strict\";\n\
\n\
\n\
\n\
// run shared js-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2 || require(\"./lib.utility2.js\")\n\
).requireReadme();\n\
globalThis.local = local;\n\
// init test\n\
local.testRunDefault(local);\n\
}());\n\
\n\
\n\
\n\
// run shared js-env code - function\n\
(function () {\n\
local._testCase_testRunDefault_failure = function (opt, onError) {\n\
/*\n\
 * this function will test testRunDefault's failure handling-behavior\n\
 */\n\
    // test failure from callback handling-behavior\n\
    onError(local.errDefault);\n\
    // test failure from multiple-callback handling-behavior\n\
    onError(null, opt);\n\
    // test failure from ajax handling-behavior\n\
    local.ajax({\n\
        url: \"/undefined\"\n\
    }, onError);\n\
    // test failure from uncaught-uncaughtexception handling-behavior\n\
    setTimeout(local.throwError);\n\
    // test console.error handling-behavior\n\
    local.testMock([\n\
        [\n\
            globalThis, {\n\
                __coverage__: null\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        console.error();\n\
        onError(null, opt);\n\
    }, local.onErrorThrow);\n\
    // test failure from thrown err handling-behavior\n\
    throw local.errDefault;\n\
};\n\
\n\
local.testCase_FormData_default = function (opt, onError) {\n\
/*\n\
 * this function will test FormData's default handling-behavior\n\
 */\n\
    opt = {};\n\
    opt.blob1 = new local.Blob([\n\
        \"aa\", \"bb\", local.stringHelloEmoji, 0\n\
    ]);\n\
    opt.blob2 = new local.Blob([\n\
        \"aa\", \"bb\", local.stringHelloEmoji, 0\n\
    ], {\n\
        type: \"text/plain; charset=utf-8\"\n\
    });\n\
    opt.data = new local.FormData();\n\
    opt.data.append(\"text1\", \"aabb\" + local.stringHelloEmoji + \"0\");\n\
    // test file-upload handling-behavior\n\
    opt.data.append(\"file1\", opt.blob1);\n\
    // test file-upload and filename handling-behavior\n\
    opt.data.append(\"file2\", opt.blob2, \"filename2.txt\");\n\
    opt.method = \"POST\";\n\
    opt.url = \"/test.echo\";\n\
    local.ajax(opt, function (err, xhr) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        // validate responseText\n\
        local.assertThrow(xhr.responseText.indexOf(\n\
            \"\\r\\nContent-Disposition: form-data; \"\n\
            + \"name=\\\"text1\\\"\\r\\n\\r\\naabbhello \\ud83d\\ude01\\n0\\r\\n\"\n\
        ) >= 0, xhr.responseText);\n\
        local.assertThrow(xhr.responseText.indexOf(\n\
            \"\\r\\nContent-Disposition: form-data; \"\n\
            + \"name=\\\"file1\\\"\\r\\n\\r\\naabbhello \\ud83d\\ude01\\n0\\r\\n\"\n\
        ) >= 0, xhr.responseText);\n\
        local.assertThrow(xhr.responseText.indexOf(\n\
            \"\\r\\nContent-Disposition: form-data; name=\\\"file2\\\"; \"\n\
            + \"filename=\\\"filename2.txt\\\"\\r\\nContent-Type: text/plain; \"\n\
            + \"charset=utf-8\\r\\n\\r\\naabbhello \\ud83d\\ude01\\n0\\r\\n\"\n\
        ) >= 0, xhr.responseText);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.testCase_FormData_err = function (opt, onError) {\n\
/*\n\
 * this function will test FormData's err handling-behavior\n\
 */\n\
    local.testMock([\n\
        [\n\
            local.FormData.prototype, {\n\
                read: function (onError) {\n\
                    onError(local.errDefault);\n\
                }\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local.ajax({\n\
            data: new local.FormData(),\n\
            method: \"POST\",\n\
            url: \"/test.echo\"\n\
        }, function (err) {\n\
            // validate err occurred\n\
            local.assertThrow(err, err);\n\
            onError(null, opt);\n\
        });\n\
    }, onError);\n\
};\n\
\n\
local.testCase_FormData_nullCase = function (opt, onError) {\n\
/*\n\
 * this function will test FormData's null-case handling-behavior\n\
 */\n\
    local.ajax({\n\
        data: new local.FormData(),\n\
        method: \"POST\",\n\
        url: \"/test.echo\"\n\
    }, function (err, xhr) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        // validate responseText\n\
        local.assertThrow((\n\
            /\\r\\n\\r\\n$/\n\
        ).test(xhr.responseText), xhr.responseText);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.testCase_ajaxProgressUpdate_default = function (opt, onError) {\n\
/*\n\
 * this function will test ajaxProgressUpdate's default handling-behavior\n\
 */\n\
    opt = 0;\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                ajaxProgressCounter: 0,\n\
                ajaxProgressState: 0\n\
            }\n\
        ], [\n\
            globalThis, {\n\
                setTimeout: function (fnc) {\n\
                    opt += 1;\n\
                    local.ajaxProgressState = opt % 3;\n\
                    fnc();\n\
                }\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        // update ajax-progress\n\
        local.ajaxProgressUpdate();\n\
        // validate data\n\
        local.assertJsonEqual(local.ajaxProgressCounter, 0);\n\
        local.assertJsonEqual(local.ajaxProgressState, 2);\n\
        // update ajax-progress\n\
        local.ajaxProgressUpdate();\n\
        // validate data\n\
        local.assertJsonEqual(local.ajaxProgressCounter, 0);\n\
        local.assertJsonEqual(local.ajaxProgressState, 1);\n\
        // update ajax-progress\n\
        local.ajaxProgressUpdate();\n\
        // validate data\n\
        local.assertJsonEqual(local.ajaxProgressCounter, 0);\n\
        local.assertJsonEqual(local.ajaxProgressState, 0);\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_ajax_cache = function (opt, onError) {\n\
/*\n\
 * this function will test ajax's cache handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = {};\n\
    local.onNext(opt, function (err, data) {\n\
        switch (opt.modeNext) {\n\
        case 1:\n\
            // test http GET handling-behavior\n\
            local.ajax({\n\
                url: \"assets.hello.txt\"\n\
            }, opt.onNext);\n\
            break;\n\
        case 2:\n\
            // validate responseText\n\
            local.assertJsonEqual(data.responseText, local.stringHelloEmoji);\n\
            // test http GET 304 cache handling-behavior\n\
            local.ajax({\n\
                headers: {\n\
                    \"If-Modified-Since\": (\n\
                        new Date(Date.now() + 0xffff).toUTCString()\n\
                    )\n\
                },\n\
                url: \"assets.hello.txt\"\n\
            }, opt.onNext);\n\
            break;\n\
        case 3:\n\
            // validate statusCode\n\
            local.assertJsonEqual(data.statusCode, 304);\n\
            opt.onNext();\n\
            break;\n\
        default:\n\
            onError(err, opt);\n\
        }\n\
    });\n\
    opt.modeNext = 0;\n\
    opt.onNext();\n\
};\n\
\n\
local.testCase_ajax_default = function (opt, onError) {\n\
/*\n\
 * this function will test ajax's default handling-behavior\n\
 */\n\
    var onParallel;\n\
    onParallel = local.onParallel(onError);\n\
    onParallel.counter += 1;\n\
\n\
    // test ajax's abort handling-behavior\n\
    onParallel.counter += 1;\n\
    local.onParallelList({\n\
        list: [\n\
            \"\",\n\
            \"arraybuffer\",\n\
            \"blob\",\n\
            \"text\"\n\
        ]\n\
    }, function (responseType, onParallel) {\n\
        responseType = responseType.elem;\n\
        onParallel.counter += 1;\n\
        local.ajax({\n\
            data: (\n\
                responseType === \"arraybuffer\"\n\
                // test POST buffer-data handling-behavior\n\
                ? new TextEncoder().encode(local.stringHelloEmoji)\n\
                : responseType === \"blob\"\n\
                // test POST blob-data handling-behavior\n\
                ? new local.Blob([\n\
                    \"\",\n\
                    new Uint8Array(0),\n\
                    local.stringHelloEmoji\n\
                ])\n\
                // test POST string-data handling-behavior\n\
                : local.stringHelloEmoji\n\
            ),\n\
            method: \"POST\",\n\
            // test nodejs-res handling-behavior\n\
            responseType: responseType.replace(\"blob\", \"arraybuffer\"),\n\
            url: \"/test.body\"\n\
        }, function (err, xhr) {\n\
            // validate no err occurred\n\
            local.assertThrow(!err, err);\n\
            // validate statusCode\n\
            local.assertJsonEqual(xhr.statusCode, 200);\n\
            // validate responseText\n\
            switch (responseType) {\n\
            case \"arraybuffer\":\n\
            case \"blob\":\n\
                local.assertJsonEqual(xhr.responseBuffer.byteLength, 11);\n\
                local.assertJsonEqual(Array.from(xhr.responseBuffer), [\n\
                    0x68,\n\
                    0x65,\n\
                    0x6c,\n\
                    0x6c,\n\
                    0x6f,\n\
                    0x20,\n\
                    0xf0,\n\
                    0x9f,\n\
                    0x98,\n\
                    0x81,\n\
                    0x0a\n\
                ]);\n\
                break;\n\
            default:\n\
                local.assertJsonEqual(xhr.responseText, local.stringHelloEmoji);\n\
            }\n\
            onParallel(null, opt);\n\
        });\n\
    }, onParallel);\n\
\n\
    // test ajax's data handling-behavior\n\
    onParallel.counter += 1;\n\
    opt = local.ajax({\n\
        url: \"/test.timeout\"\n\
    }, function (err, xhr) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        // validate statusCode\n\
        local.assertJsonEqual(xhr.statusCode, 500);\n\
        onParallel(null, opt);\n\
    });\n\
    // test multiple-callback handling-behavior\n\
    opt.onEvent({\n\
        type: \"abort\"\n\
    });\n\
    opt.abort();\n\
    opt.abort();\n\
\n\
    // test ajax's echo handling-behavior\n\
    onParallel.counter += 1;\n\
    local.ajax({\n\
        _aa: \"aa\",\n\
        aa: \"aa\",\n\
        data: local.stringHelloEmoji,\n\
        // test req-header handling-behavior\n\
        headers: {\n\
            \"X-Req-Header-Test\": \"aa\"\n\
        },\n\
        method: \"POST\",\n\
        // test modeDebug handling-behavior\n\
        modeDebug: true,\n\
        url: \"/test.echo\"\n\
    }, function (err, xhr) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        // validate statusCode\n\
        local.assertJsonEqual(xhr.statusCode, 200);\n\
        // validate resHeaders\n\
        local.assertJsonEqual(xhr.resHeaders[\"x-res-header-test\"], \"bb\");\n\
        // validate responseText\n\
        local.assertThrow((\n\
            /\\r\\nhello\\u0020\\ud83d\\ude01\\n$/\n\
        ).test(xhr.responseText), xhr.responseText);\n\
        local.assertThrow((\n\
            /\\r\\nx-req-header-test:\\u0020aa\\r\\n/\n\
        ).test(xhr.responseText), xhr.responseText);\n\
        // validate properties\n\
        local.assertJsonEqual(xhr._aa, undefined);\n\
        local.assertJsonEqual(xhr.aa, \"aa\");\n\
        onParallel(null, opt);\n\
    });\n\
\n\
    // test ajax's err handling-behavior\n\
    onParallel.counter += 1;\n\
    local.onParallelList({\n\
        list: [\n\
            {\n\
                // test 404-not-found handling-behavior\n\
                url: \"/test.err-404\"\n\
            }, {\n\
                // test 500-internal-server-error handling-behavior\n\
                url: \"/test.err-500\"\n\
            }, {\n\
                // test undefined-status-code handling-behavior\n\
                url: \"/test.err-undefined\"\n\
            }, {\n\
                // test corsForwardProxyHost handling-behavior\n\
                corsForwardProxyHost: \"https://undefined:0\",\n\
                location: {\n\
                    host: \"undefined.github.io\"\n\
                },\n\
                timeout: 1,\n\
                // test undefined-https-url handling-behavior\n\
                url: \"https://undefined:0\"\n\
            }\n\
        ]\n\
    }, function (option2, onParallel) {\n\
        onParallel.counter += 1;\n\
        local.ajax(option2.elem, function (err) {\n\
            // validate err occurred\n\
            local.assertThrow(err, err);\n\
            onParallel(null, opt);\n\
        });\n\
    }, onParallel);\n\
\n\
    // test ajax's file handling-behavior\n\
    onParallel.counter += 1;\n\
    local.ajax({\n\
        url: \"LICENSE\"\n\
    }, function (err, xhr) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        // validate statusCode\n\
        local.assertJsonEqual(xhr.statusCode, 200);\n\
        // validate responseText\n\
        local.assertThrow(xhr.responseText.indexOf(\n\
            \"MIT License (https://opensource.org/licenses/MIT)\\n\\n\"\n\
        ) === 0, xhr.data);\n\
        onParallel(null, opt);\n\
    });\n\
\n\
    // test ajax's standalone handling-behavior\n\
    onParallel.counter += 1;\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                utility2: null\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        [\n\
            \"\", \"arraybuffer\"\n\
        ].forEach(function (responseType) {\n\
            // test default handling-behavior\n\
            onParallel.counter += 1;\n\
            local.ajax({\n\
                responseType,\n\
                url: (\n\
                    local.isBrowser\n\
                    ? location.href\n\
                    : local.serverLocalHost\n\
                )\n\
            }, function (err, xhr) {\n\
                // validate no err occurred\n\
                local.assertThrow(!err, err);\n\
                // validate statusCode\n\
                local.assertJsonEqual(xhr.statusCode, 200);\n\
                onParallel();\n\
            });\n\
            // test err handling-behavior\n\
            onParallel.counter += 1;\n\
            local.ajax({\n\
                responseType,\n\
                undefined,\n\
                url: (\n\
                    local.isBrowser\n\
                    ? location.href.replace((\n\
                        /\\?.*$/\n\
                    ), \"\")\n\
                    : local.serverLocalHost\n\
                ) + \"/undefined\"\n\
            }, function (err, xhr) {\n\
                // validate err occurred\n\
                local.assertThrow(err, err);\n\
                // validate statusCode\n\
                local.assertJsonEqual(xhr.statusCode, 404);\n\
                onParallel();\n\
            });\n\
        });\n\
        onError(null, opt);\n\
    }, onParallel);\n\
    onParallel();\n\
\n\
    // test ajax's timeout handling-behavior\n\
    onParallel.counter += 1;\n\
    setTimeout(function () {\n\
        local.ajax({\n\
            timeout: 1,\n\
            url: \"/test.timeout\"\n\
        }, function (err, xhr) {\n\
            // validate err occurred\n\
            local.assertThrow(err, err);\n\
            // validate statusCode\n\
            local.assertJsonEqual(xhr.statusCode, 500);\n\
            onParallel(null, opt);\n\
        });\n\
    }, 1000);\n\
};\n\
\n\
local.testCase_assertXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test assertXxx's default handling-behavior\n\
 */\n\
    // test assertion passed\n\
    local.assertThrow(true, true);\n\
    // test assertion failed with undefined message\n\
    local.tryCatchOnError(function () {\n\
        local.assertThrow(null);\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        // validate err.message\n\
        local.assertJsonEqual(err.message, \"\");\n\
    });\n\
    // test assertion failed with string message\n\
    local.tryCatchOnError(function () {\n\
        local.assertThrow(null, \"aa\");\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        // validate err.message\n\
        local.assertJsonEqual(err.message, \"aa\");\n\
    });\n\
    // test assertion failed with errObj\n\
    local.tryCatchOnError(function () {\n\
        local.assertThrow(null, local.errDefault);\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
    });\n\
    // test assertion failed with json object\n\
    local.tryCatchOnError(function () {\n\
        local.assertThrow(null, {\n\
            aa: 1\n\
        });\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        // validate err.message\n\
        local.assertJsonEqual(err.message, \"{\\n    \\\"aa\\\": 1\\n}\");\n\
    });\n\
    [\n\
        \"\", 0, false, null, undefined\n\
    ].forEach(function (aa, ii) {\n\
        [\n\
            \"\", 0, false, null, undefined\n\
        ].forEach(function (bb, jj) {\n\
            if (ii === jj) {\n\
                // test assertJsonEqual's handling-behavior\n\
                local.assertJsonEqual(aa, bb);\n\
            } else {\n\
                // test assertJsonNotEqual's handling-behavior\n\
                local.assertJsonNotEqual(aa, bb);\n\
            }\n\
        });\n\
    });\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_base64Xxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test base64Xxx's default handling-behavior\n\
 */\n\
    opt = {};\n\
    opt.base64 = local.base64FromBuffer(\n\
        local.stringCharsetAscii + local.stringHelloEmoji\n\
    );\n\
    // test null-case handling-behavior\n\
    local.assertJsonEqual(local.base64FromBuffer(), \"\");\n\
    local.assertJsonEqual(local.bufferToUtf8(local.base64ToBuffer()), \"\");\n\
    local.assertJsonEqual(local.base64ToUtf8(), \"\");\n\
    local.assertJsonEqual(local.base64FromBuffer(local.base64ToBuffer()), \"\");\n\
    local.assertJsonEqual(local.base64FromBuffer(local.base64ToUtf8()), \"\");\n\
    // test identity handling-behavior\n\
    local.assertJsonEqual(\n\
        local.base64FromBuffer(local.base64ToBuffer(opt.base64)),\n\
        opt.base64\n\
    );\n\
    local.assertJsonEqual(\n\
        local.base64FromBuffer(local.base64ToUtf8(opt.base64)),\n\
        opt.base64\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_blobRead_default = function (opt, onError) {\n\
/*\n\
 * this function will test blobRead's default handling-behavior\n\
 */\n\
    var onParallel;\n\
    onParallel = local.onParallel(onError);\n\
    onParallel.counter += 1;\n\
    // test data handling-behavior\n\
    onParallel.counter += 1;\n\
    local.blobRead(new local.Blob([\n\
        \"\",\n\
        \"aa\",\n\
        \"bb\",\n\
        new Uint8Array(0),\n\
        local.stringHelloEmoji\n\
    ]), function (err, data) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        // validate data\n\
        local.assertJsonEqual(\n\
            local.bufferToUtf8(data),\n\
            \"aabbhello \\ud83d\\ude01\\n\"\n\
        );\n\
        onParallel(null, opt);\n\
    });\n\
    if (!local.isBrowser) {\n\
        onParallel(null, opt);\n\
        return;\n\
    }\n\
    // test err handling-behavior\n\
    onParallel.counter += 1;\n\
    local.testMock([\n\
        [\n\
            FileReader.prototype, {\n\
                readAsArrayBuffer: function () {\n\
                    this.onabort({\n\
                        type: \"abort\"\n\
                    });\n\
                    this.onerror({\n\
                        type: \"error\"\n\
                    });\n\
                }\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local.blobRead(null, function (err) {\n\
            // validate err occurred\n\
            local.assertThrow(err, err);\n\
        });\n\
        onError(null, opt);\n\
    }, onParallel);\n\
    onParallel();\n\
};\n\
\n\
local.testCase_browserTest_electron = function (opt, onError) {\n\
/*\n\
 * this function will test browserTest's electron handling-behavior\n\
 */\n\
    opt = function (aa, bb, cc) {\n\
        [\n\
            aa, bb, cc\n\
        ].forEach(function (fnc, ii) {\n\
            if (typeof fnc === \"function\") {\n\
                fnc(ii && opt);\n\
                opt.onNext(null, opt);\n\
                opt.utility2_testReportSave();\n\
            }\n\
        });\n\
        return opt;\n\
    };\n\
    [\n\
        \"BrowserWindow\",\n\
        \"addEventListener\",\n\
        \"app\",\n\
        \"browserWindow\",\n\
        \"capturePage\",\n\
        \"document\",\n\
        \"documentElement\",\n\
        \"electron\",\n\
        \"fileCoverage\",\n\
        \"fileElectronHtml\",\n\
        \"fileScreenshot\",\n\
        \"fileTestReport\",\n\
        \"fs\",\n\
        \"ipcRenderer\",\n\
        \"loadURL\",\n\
        \"modeCoverageMerge\",\n\
        \"on\",\n\
        \"once\",\n\
        \"process\",\n\
        \"prototype\",\n\
        \"rename\",\n\
        \"send\",\n\
        \"toPNG\",\n\
        \"unref\",\n\
        \"window\",\n\
        \"writeFile\"\n\
    ].forEach(function (key) {\n\
        opt[key] = (\n\
            key.indexOf(\"file\") === 0\n\
            ? \"undefined\"\n\
            : opt\n\
        );\n\
    });\n\
    opt.ipcMain = {\n\
        on: function (_, fnc) {\n\
            [\"html\", \"testReport\", \"undefined\"].forEach(function (type) {\n\
                [\n\
                    \"<div></div>\",\n\
                    null,\n\
                    {}, {\n\
                        testPlatformList: [\n\
                            {}\n\
                        ]\n\
                    }, {\n\
                        coverage: {},\n\
                        testPlatformList: [\n\
                            {}\n\
                        ]\n\
                    }\n\
                ].forEach(function (data) {\n\
                    opt.isDoneTestReport = null;\n\
                    fnc(_, type, data);\n\
                });\n\
            });\n\
        }\n\
    };\n\
    opt.utility2_testReportSave = local.nop;\n\
    local.testMock([\n\
        [\n\
            globalThis, {\n\
                setTimeout: opt,\n\
                utility2_testReport: null\n\
            }\n\
        ], [\n\
            local, {\n\
                fs: opt,\n\
                fsReadFileOrEmptyStringSync: function () {\n\
                    return \"\";\n\
                },\n\
                fsWriteFileWithMkdirpSync: opt,\n\
                onParallel: opt\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        [\n\
            \"test\", \"undefined\"\n\
        ].forEach(function (modeBrowserTest) {\n\
            [\n\
                1, 10, 11, 20, 100\n\
            ].forEach(function (modeNext) {\n\
                opt.modeBrowserTest = modeBrowserTest;\n\
                opt.modeNext = modeNext;\n\
                switch (modeNext) {\n\
                case 100:\n\
                    local.tryCatchOnError(function () {\n\
                        local.browserTest({\n\
                            modeNext\n\
                        }, opt);\n\
                    }, local.nop);\n\
                    break;\n\
                default:\n\
                    local.browserTest(opt, opt);\n\
                }\n\
            });\n\
        });\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_browserTest_screenshot = function (opt, onError) {\n\
/*\n\
 * this function will test browserTest's screenshot handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.browserTest({\n\
        modeBrowserTest: \"screenshot\",\n\
        timeoutDefault: 20000,\n\
        url: \"tmp/build/test-report.html\"\n\
    }, onError);\n\
};\n\
\n\
local.testCase_bufferIndexOfSubBuffer_default = function (opt, onError) {\n\
/*\n\
 * this function will test bufferIndexOfSubBuffer's default handling-behavior\n\
 */\n\
[\n\
    {\n\
        buffer: \"\",\n\
        subBuffer: \"\",\n\
        validate: 0\n\
    }, {\n\
        buffer: \"\",\n\
        subBuffer: \"aa\",\n\
        validate: -1\n\
    }, {\n\
        buffer: \"aa\",\n\
        subBuffer: \"\",\n\
        validate: 0\n\
    }, {\n\
        buffer: \"aa\",\n\
        subBuffer: \"aa\",\n\
        validate: 0\n\
    }, {\n\
        buffer: \"aa\",\n\
        subBuffer: \"bb\",\n\
        validate: -1\n\
    }, {\n\
        buffer: \"aaaa\",\n\
        subBuffer: \"aa\",\n\
        validate: 0\n\
    }, {\n\
        buffer: \"aabb\",\n\
        subBuffer: \"aa\",\n\
        validate: 0\n\
    }, {\n\
        buffer: \"aabb\",\n\
        subBuffer: \"bb\",\n\
        validate: 2\n\
    }, {\n\
        buffer: \"aabbaa\",\n\
        subBuffer: \"aa\",\n\
        validate: 0\n\
    }, {\n\
        buffer: \"aabbaa\",\n\
        subBuffer: \"bb\",\n\
        validate: 2\n\
    }, {\n\
        buffer: \"aabbaa\",\n\
        subBuffer: \"ba\",\n\
        validate: 3\n\
    }\n\
].forEach(function (opt) {\n\
    local.assertJsonEqual(local.bufferIndexOfSubBuffer(\n\
        new TextEncoder().encode(opt.buffer),\n\
        new TextEncoder().encode(opt.subBuffer),\n\
        opt.fromIndex\n\
    ), opt.validate);\n\
});\n\
onError(null, opt);\n\
};\n\
\n\
local.testCase_bufferValidateAndCoerce_err = function (opt, onError) {\n\
/*\n\
 * this function will test bufferValidateAndCoerce's err handling-behavior\n\
 */\n\
    [[], 0, {}].forEach(function (elem) {\n\
        opt = null;\n\
        try {\n\
            local.bufferValidateAndCoerce(elem);\n\
        } catch (errCaught) {\n\
            opt = errCaught;\n\
        }\n\
        // validate err occurred\n\
        local.assertThrow(opt, elem);\n\
    });\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_buildApidoc_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildApidoc's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    // test $npm_config_mode_coverage=all handling-behavior\n\
    local.testMock([\n\
        [\n\
            local.env, {\n\
                npm_config_mode_coverage: \"all\"\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local.buildApidoc(null, onError);\n\
    }, local.onErrorThrow);\n\
    local.buildApidoc({\n\
        blacklistDict: {}\n\
    }, onError);\n\
};\n\
\n\
local.testCase_buildApp_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildApp's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.testCase_buildReadme_default(opt, local.onErrorThrow);\n\
    local.testCase_buildLib_default(opt, local.onErrorThrow);\n\
    local.testCase_buildTest_default(opt, local.onErrorThrow);\n\
    local.buildApp({\n\
        assetsList: [\n\
            {\n\
                file: \"/assets.hello.txt\",\n\
                url: \"/assets.hello.txt\"\n\
            }, {\n\
                file: \"/assets.script_only.html\",\n\
                url: \"/assets.script_only.html\"\n\
            }, {\n\
                file: \"/assets.utility2.lib.db.js\",\n\
                url: \"/assets.utility2.lib.db.js\"\n\
            }, {\n\
                file: \"/assets.utility2.lib.istanbul.js\",\n\
                url: \"/assets.utility2.lib.istanbul.js\"\n\
            }, {\n\
                file: \"/assets.utility2.lib.jslint.js\",\n\
                url: \"/assets.utility2.lib.jslint.js\"\n\
            }, {\n\
                file: \"/assets.utility2.lib.marked.js\",\n\
                url: \"/assets.utility2.lib.marked.js\"\n\
            }, {\n\
                file: \"/assets.utility2.lib.sjcl.js\",\n\
                url: \"/assets.utility2.lib.sjcl.js\"\n\
            }, {\n\
                file: \"/assets.utility2.rollup.js\",\n\
                url: \"/assets.utility2.rollup.js\"\n\
            }\n\
        ]\n\
    }, onError);\n\
};\n\
\n\
local.testCase_buildLib_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildLib's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                // test duplicate local function handling-behavior\n\
                fsReadFileOrEmptyStringSync: function () {\n\
                    return (\n\
                        \"local.nop = function () {\\n\"\n\
                        + \"/*\\n\"\n\
                        + \" * this function will do nothing\\n\"\n\
                        + \" */\\n\"\n\
                        + \"    return;\\n\"\n\
                        + \"};\\n\"\n\
                        + \"local.nop = function () {\\n\"\n\
                        + \"/*\\n\"\n\
                        + \" * this function will do nothing\\n\"\n\
                        + \" */\\n\"\n\
                        + \"    return;\\n\"\n\
                        + \"};\\n\"\n\
                    );\n\
                },\n\
                templateRenderMyApp: function () {\n\
                    return local.assetsDict[\"/assets.my_app.template.js\"];\n\
                }\n\
            }\n\
        ], [\n\
            local.fs, {\n\
                // test customize-local handling-behavior\n\
                existsSync: function () {\n\
                    return true;\n\
                },\n\
                writeFileSync: local.nop\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local.buildLib({}, onError);\n\
    }, local.onErrorThrow);\n\
    local.buildLib({}, onError);\n\
};\n\
\n\
local.testCase_buildReadme_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildReadme's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = {};\n\
    // test shNpmTestPublished handling-behavior\n\
    opt.dataFrom = local.fs.readFileSync(\"README.md\", \"utf8\").replace(\n\
        \"#\\u0021! shNpmTestPublished\",\n\
        \"shNpmTestPublished\"\n\
    );\n\
    opt = {};\n\
    opt.customize = function () {\n\
        // search-and-replace - customize dataTo\n\
        [\n\
            // customize quickstart-example-js\n\
            (\n\
                /#\\u0020quickstart\\u0020example.js[\\S\\s]*?istanbul\\u0020instrument\\u0020in\\u0020package/\n\
            ),\n\
            // customize quickstart-footer\n\
            (\n\
                />download\\u0020standalone\\u0020app<[^`]*?\"utility2FooterDiv\"/\n\
            ), (\n\
                /```[^`]*?\\n#\\u0020extra\\u0020screenshots/\n\
            ),\n\
            // customize build-script\n\
            (\n\
                /\\n#\\u0020internal\\u0020build\\u0020script\\n[\\S\\s]*?\\nshBuildCi\\n/\n\
            )\n\
        ].forEach(function (rgx) {\n\
            opt.dataFrom.replace(rgx, function (match0) {\n\
                opt.dataTo = opt.dataTo.replace(rgx, match0);\n\
            });\n\
        });\n\
    };\n\
    local.buildReadme(opt, onError);\n\
};\n\
\n\
local.testCase_buildXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildXxx's default handling-behavior\n\
 */\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                assetsDict: {\n\
                    \"/\": \"\"\n\
                },\n\
                browserTest: local.nop,\n\
                buildApidoc: local.nop,\n\
                buildLib: local.nop,\n\
                buildReadme: local.nop,\n\
                buildTest: local.nop,\n\
                testCase_buildReadme_default: local.nop,\n\
                testCase_buildLib_default: local.nop,\n\
                testCase_buildTest_default: local.nop\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local._testCase_buildApidoc_default(null, local.nop);\n\
        local._testCase_buildApp_default(null, local.nop);\n\
        local._testCase_buildLib_default(null, local.nop);\n\
        local._testCase_buildReadme_default(null, local.nop);\n\
        local._testCase_buildTest_default(null, local.nop);\n\
        local._testCase_webpage_default(null, local.nop);\n\
        local.assetsDict[\"/\"] = \"<script src=\\\"assets.test.js\\\"></script>\";\n\
        local._testCase_webpage_default(null, local.nop);\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_childProcessSpawnWithTimeout_default = function (\n\
    opt,\n\
    onError\n\
) {\n\
/*\n\
 * this function will test\n\
 * childProcessSpawnWithTimeout's default handling-behavior\n\
 */\n\
    var onParallel;\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = {};\n\
    onParallel = local.onParallel(onError);\n\
    onParallel.counter += 1;\n\
    // test default handling-behavior\n\
    onParallel.counter += 1;\n\
    local.childProcessSpawnWithTimeout(\"ls\").on(\n\
        \"error\",\n\
        onParallel\n\
    ).on(\"exit\", function (exitCode, signal) {\n\
        // validate exitCode\n\
        local.assertJsonEqual(exitCode, 0);\n\
        // validate signal\n\
        local.assertJsonEqual(signal, null);\n\
        onParallel(null, opt);\n\
    });\n\
    // test timeout handling-behavior\n\
    onParallel.counter += 1;\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                timeoutDefault: 1000\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        opt.childProcess = (\n\
            local.childProcessSpawnWithTimeout(\"sleep\", [\n\
                5000\n\
            ])\n\
        );\n\
        onError(null, opt);\n\
    }, local.onErrorThrow);\n\
    opt.childProcess\n\
    .on(\"error\", onParallel)\n\
    .on(\"exit\", function (exitCode, signal) {\n\
        // validate exitCode\n\
        local.assertJsonEqual(exitCode, null);\n\
        // validate signal\n\
        local.assertJsonEqual(signal, \"SIGKILL\");\n\
        onParallel(null, opt);\n\
    });\n\
    onParallel(null, opt);\n\
};\n\
\n\
local.testCase_childProcessSpawnWithUtility2_err = function (\n\
    opt,\n\
    onError\n\
) {\n\
/*\n\
 * this function will test\n\
 * childProcessSpawnWithTimeout's err handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.testMock([\n\
        // test __dirname handling-behavior\n\
        [\n\
            process.env, {\n\
                npm_config_dir_utility2: \"\"\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local.local.childProcessSpawnWithUtility2(\"undefined\", function (err) {\n\
            // validate err occurred\n\
            local.assertThrow(err, err);\n\
        });\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_cliRun_default = function (opt, onError) {\n\
/*\n\
 * this function will test cliRun's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                replStart: null\n\
            }\n\
        ], [\n\
            local.cliDict, {\n\
                _default: local.nop,\n\
                _help: null\n\
            }\n\
        ], [\n\
            local.repl, {\n\
                start: local.nop\n\
            }\n\
        ], [\n\
            local.vm, {\n\
                runInThisContext: local.nop\n\
            }\n\
        ], [\n\
            process, {\n\
                argv: []\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        // test default handling-behavior\n\
        local.cliRun({\n\
            rgxComment: (\n\
                /^/\n\
            )\n\
        });\n\
        // test builtin handling-behavior\n\
        [\n\
            \"--eval\",\n\
            \"--help\",\n\
            \"--interactive\",\n\
            \"--version\",\n\
            \"undefined\"\n\
        ].forEach(function (key) {\n\
            process.argv[2] = key;\n\
            local.cliRun();\n\
        });\n\
        // test err handling-behavior\n\
        local.cliDict._default = null;\n\
        local.cliDict._help = null;\n\
        local.tryCatchOnError(local.cliRun, local.nop);\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_corsBackendHostInject_default = function (opt, onError) {\n\
/*\n\
 * this function will corsBackendHostInject's default handling-behavior\n\
 */\n\
    // test null-case handling-behavior\n\
    local.assertJsonEqual(local.corsBackendHostInject(), undefined);\n\
    // test override-all handling-behavior\n\
    local.assertJsonEqual(local.corsBackendHostInject(\n\
        \"cc.com\",\n\
        \"aa-alpha.bb.com\",\n\
        null,\n\
        {\n\
            host: \"github.io\",\n\
            pathname: \"/build..beta..travis-ci.org/\"\n\
        }\n\
    ), \"aa-beta.bb.com\");\n\
    // test override-rgx handling-behavior\n\
    local.assertJsonEqual(local.corsBackendHostInject(\n\
        \"cc/dd\",\n\
        \"aa-alpha.bb.com/\",\n\
        (\n\
            /(^cc\\/)/m\n\
        ),\n\
        {\n\
            host: \"github.io\",\n\
            pathname: \"/build..beta..travis-ci.org/\"\n\
        }\n\
    ), \"aa-beta.bb.com/cc/dd\");\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_corsForwardProxyHostIfNeeded_default = function (\n\
    opt,\n\
    onError\n\
) {\n\
/*\n\
 * this function will corsForwardProxyHostIfNeeded's default handling-behavior\n\
 */\n\
    if (!local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.assertThrow(local.corsForwardProxyHostIfNeeded({\n\
        location: {\n\
            host: \"undefined.github.io\"\n\
        },\n\
        url: \"https://example.com\"\n\
    }).indexOf(\".herokuapp.com\") >= 0);\n\
    onError(null, opt);\n\
};\n\
\n\
/* istanbul ignore next */\n\
local.testCase_cryptoAesXxxCbcRawXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will cryptoAesXxxCbcRawXxx's default handling-behavior\n\
 */\n\
    if (!local.nop()) {\n\
        onError();\n\
        return;\n\
    }\n\
    opt = {};\n\
    local.onNext(opt, function (err, data) {\n\
        switch (opt.modeNext) {\n\
        case 1:\n\
            // encrypt data\n\
            opt.data = new TextEncoder().encode(\"aa\");\n\
            opt.key = \"0123456789abcdef0123456789abcdef\";\n\
            opt.mode = null;\n\
            local.cryptoAesXxxCbcRawEncrypt(opt, opt.onNext);\n\
            break;\n\
        case 2:\n\
            // decrypt data\n\
            opt.data = data.buffer;\n\
            local.cryptoAesXxxCbcRawDecrypt(opt, opt.onNext);\n\
            break;\n\
        case 3:\n\
            // validate data\n\
            local.assertJsonEqual(local.bufferToUtf8(data), \"aa\");\n\
            opt.onNext();\n\
            break;\n\
        case 4:\n\
            // encrypt data - base64\n\
            opt.data = new TextEncoder().encode(\"aa\");\n\
            opt.key = (\n\
                \"0123456789abcdef0123456789abcdef\"\n\
                + \"0123456789abcdef0123456789abcdef\"\n\
            );\n\
            opt.mode = \"base64\";\n\
            local.cryptoAesXxxCbcRawEncrypt(opt, opt.onNext);\n\
            break;\n\
        case 5:\n\
            // decrypt data - base64\n\
            opt.data = data;\n\
            local.cryptoAesXxxCbcRawDecrypt(opt, opt.onNext);\n\
            break;\n\
        case 6:\n\
            // validate data\n\
            local.assertJsonEqual(local.bufferToUtf8(data), \"aa\");\n\
            opt.onNext();\n\
            break;\n\
        default:\n\
            onError(err, opt);\n\
        }\n\
    });\n\
    opt.modeNext = 0;\n\
    opt.onNext();\n\
};\n\
\n\
local.testCase_domFragmentRender_default = function (opt, onError) {\n\
/*\n\
 * this function will test domFragmentRender's default handling-behavior\n\
 */\n\
    if (!local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.assertJsonEqual(local.domFragmentRender(\"<div>{{value}}</div>\", {\n\
        value: \"aa\"\n\
    }).children[0].outerHTML, \"<div>aa</div>\");\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_exit_err = function (opt, onError) {\n\
/*\n\
 * this function will test exit's err handling-behavior\n\
 */\n\
    local.exit(\"invalid-exitCode\");\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_fsWriteFileWithMkdirpSync_default = function (opt, onError) {\n\
/*\n\
 * this function will test\n\
 * fsWriteFileWithMkdirpSync's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.fsRmrSync(\"tmp/build/testCase_fsWriteFileWithMkdirpSync_default\");\n\
    // validate data\n\
    local.assertJsonEqual(local.fsReadFileOrEmptyStringSync(\n\
        \"tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt\",\n\
        \"utf8\"\n\
    ), \"\");\n\
    local.fsWriteFileWithMkdirpSync(\n\
        \"tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt\",\n\
        \"aa\"\n\
    );\n\
    // validate data\n\
    local.assertJsonEqual(local.fsReadFileOrEmptyStringSync(\n\
        \"tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt\",\n\
        \"utf8\"\n\
    ), \"aa\");\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_isNullOrUndefined_default = function (opt, onError) {\n\
/*\n\
 * this function will test isNullOrUndefined's default handling-behavior\n\
 */\n\
    // validate data\n\
    local.assertJsonEqual(local.isNullOrUndefined(null), true);\n\
    // validate data\n\
    local.assertJsonEqual(local.isNullOrUndefined(undefined), true);\n\
    // validate data\n\
    local.assertJsonEqual(local.isNullOrUndefined(false), false);\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_jsonCopy_default = function (opt, onError) {\n\
/*\n\
 * this function will test jsonCopy's default handling-behavior\n\
 */\n\
// test various data-type handling-behavior\n\
[\n\
    undefined, null, false, true, 0, 1, 1.5, \"a\"\n\
].forEach(function (elem) {\n\
    local.assertJsonEqual(local.jsonCopy(elem), elem);\n\
});\n\
onError(null, opt);\n\
};\n\
\n\
local.testCase_jsonStringifyOrdered_default = function (opt, onError) {\n\
/*\n\
 * this function will test jsonStringifyOrdered's default handling-behavior\n\
 */\n\
    // test data-type handling-behavior\n\
    local.identity([\n\
        undefined,\n\
        null,\n\
        false,\n\
        true,\n\
        0,\n\
        1,\n\
        1.5,\n\
        \"a\",\n\
        {},\n\
        []\n\
    ]).forEach(function (data) {\n\
        local.assertJsonEqual(\n\
            local.jsonStringifyOrdered(data),\n\
            JSON.stringify(data)\n\
        );\n\
    });\n\
    // test data-ordering handling-behavior\n\
    opt = {\n\
        // test nested dict handling-behavior\n\
        ff: {\n\
            hh: 2,\n\
            gg: 1\n\
        },\n\
        // test nested array handling-behavior\n\
        ee: [\n\
            1, null, undefined\n\
        ],\n\
        dd: local.nop,\n\
        cc: undefined,\n\
        bb: null,\n\
        aa: 1\n\
    };\n\
    // test circular-reference handling-behavior\n\
    opt.zz = opt;\n\
    local.assertJsonEqual(\n\
        opt,\n\
        {\n\
            aa: 1,\n\
            bb: null,\n\
            ee: [\n\
                1, null, null\n\
            ],\n\
            ff: {\n\
                gg: 1,\n\
                hh: 2\n\
            }\n\
        }\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_jwtAes256GcmXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test jwtAes256GcmXxx's default handling-behavior\n\
 */\n\
    opt = {};\n\
    opt.key = local.jwtAes256KeyCreate();\n\
    // use canonical example at https://jwt.io/\n\
    opt.data = JSON.parse(local.jsonStringifyOrdered(local.normalizeJwt({\n\
        sub: \"1234567890\",\n\
        name: \"John Doe\",\n\
        admin: true\n\
    })));\n\
    // encrypt token\n\
    opt.token = local.jwtAes256GcmEncrypt(opt.data, opt.key);\n\
    // validate encrypted-token\n\
    local.assertJsonEqual(\n\
        local.jwtAes256GcmDecrypt(opt.token, opt.key),\n\
        opt.data\n\
    );\n\
    // test decryption-failed handling-behavior\n\
    local.assertJsonEqual(local.jwtAes256GcmDecrypt(opt.token, null), {});\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_jwtHs256Xxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test jwtHs256Xxx's default handling-behavior\n\
 */\n\
    opt = {};\n\
    opt.key = local.normalizeJwtBase64Url(local.base64FromBuffer(\"secret\"));\n\
    // use canonical example at https://jwt.io/\n\
    opt.data = {\n\
        sub: \"1234567890\",\n\
        name: \"John Doe\",\n\
        admin: true\n\
    };\n\
    opt.token = local.jwtHs256Encode(opt.data, opt.key);\n\
    // validate encoded-token\n\
    local.assertJsonEqual(\n\
        opt.token,\n\
        (\n\
            \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\"\n\
            + \".eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZ\"\n\
            + \"SI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9\"\n\
            + \".TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\"\n\
        )\n\
    );\n\
    // validate decoded-data\n\
    local.assertJsonEqual(\n\
        local.jwtHs256Decode(opt.token, opt.key),\n\
        {\n\
            admin: true,\n\
            name: \"John Doe\",\n\
            sub: \"1234567890\"\n\
        }\n\
    );\n\
    // test decoding-failed handling-behavior\n\
    local.assertJsonEqual(local.jwtHs256Decode(opt.token, \"undefined\"), {});\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_libUtility2Js_standalone = function (opt, onError) {\n\
/*\n\
 * this function will test lib.utility2.js's standalone handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.fs.writeFileSync(\"tmp/lib.utility2.js\", local.fs.readFileSync(\n\
        \"lib.utility2.js\",\n\
        \"utf8\"\n\
    ).replace(\"/* istanbul instrument in package utility2 */\", \"\"));\n\
    require(\"./tmp/lib.utility2.js\");\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_listGetElementRandom_default = function (opt, onError) {\n\
/*\n\
 * this function will test listGetRandom's default handling-behavior\n\
 */\n\
    opt = {};\n\
    // init list\n\
    opt.list = [\n\
        \"aa\", \"bb\", \"cc\", \"dd\"\n\
    ];\n\
    opt.elemDict = {};\n\
    // get 1000 random elem from list\n\
    opt.ii = 0;\n\
    while (opt.ii < 1000) {\n\
        opt.elemDict[local.listGetElementRandom(opt.list)] = true;\n\
        opt.ii += 1;\n\
    }\n\
    // validate all elem were retrieved from list\n\
    local.assertJsonEqual(\n\
        Object.keys(opt.elemDict).sort(),\n\
        [\n\
            \"aa\", \"bb\", \"cc\", \"dd\"\n\
        ]\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_listShuffle_default = function (opt, onError) {\n\
/*\n\
 * this function will test listShuffle's default handling-behavior\n\
 */\n\
    opt = {};\n\
    // init list\n\
    opt.list = \"[0,1]\";\n\
    // shuffle list 100 times\n\
    opt.ii = 0;\n\
    while (opt.ii < 100) {\n\
        opt.listShuffled = JSON.stringify(\n\
            local.listShuffle(JSON.parse(opt.list))\n\
        );\n\
        // validate shuffled list\n\
        local.assertJsonEqual(opt.listShuffled.length, opt.list.length);\n\
        opt.changed = opt.changed || opt.listShuffled !== opt.list;\n\
        opt.ii += 1;\n\
    }\n\
    // validate list changed at least once during the shuffle\n\
    local.assertThrow(opt.changed, opt);\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_localStorageSetItemOrClear_default = function (\n\
    opt,\n\
    onError\n\
) {\n\
/*\n\
 * this function will localStorageSetItemOrClear's default handling-behavior\n\
 */\n\
    if (!local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.localStorageSetItemOrClear(\n\
        \"testCase_localStorageSetItemOrClear_default\",\n\
        null\n\
    );\n\
    local.assertJsonEqual(\n\
        localStorage.testCase_localStorageSetItemOrClear_default,\n\
        \"null\"\n\
    );\n\
    local.testMock([\n\
        [\n\
            localStorage, {\n\
                clear: null,\n\
                setItem: function () {\n\
                    throw local.errDefault;\n\
                }\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        localStorage.clear = onError;\n\
        local.localStorageSetItemOrClear(\n\
            \"testCase_localStorageSetItemOrClear_default\",\n\
            null\n\
        );\n\
    }, onError);\n\
};\n\
\n\
local.testCase_middlewareForwardProxy_default = function (opt, onError) {\n\
/*\n\
 * this function will test middlewareForwardProxy's default handling-behavior\n\
 */\n\
    var onParallel;\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    onParallel = local.onParallel(onError);\n\
    onParallel.counter += 1;\n\
    // test preflight-cors handling-behavior\n\
    onParallel.counter += 1;\n\
    local.ajax({\n\
        headers: {\n\
            \"access-control-request-headers\": (\n\
                \"forward-proxy-headers,forward-proxy-url\"\n\
            )\n\
        },\n\
        method: \"OPTIONS\",\n\
        url: \"\"\n\
    }, onParallel);\n\
    // test forward-proxy-http handling-behavior\n\
    onParallel.counter += 1;\n\
    local.ajax({\n\
        headers: {\n\
            \"forward-proxy-url\": \"/assets.hello.txt\"\n\
        },\n\
        url: \"\"\n\
    }, function (err, xhr) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        // validate responseText\n\
        local.assertJsonEqual(xhr.responseText, local.stringHelloEmoji);\n\
        onParallel(null, opt, xhr);\n\
    });\n\
    // test err handling-behavior\n\
    onParallel.counter += 1;\n\
    local.ajax({\n\
        headers: {\n\
            \"forward-proxy-url\": \"https://undefined:0\"\n\
        },\n\
        url: \"\"\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        onParallel(null, opt);\n\
    });\n\
    onParallel(null, opt);\n\
};\n\
\n\
local.testCase_middlewareJsonpStateInit_assetsList = function (\n\
    opt,\n\
    onError\n\
) {\n\
/*\n\
 * this function will middlewareJsonpStateInit's assetsList handling-behavior\n\
 */\n\
    local.testMock([\n\
        [\n\
            local.env, {\n\
                npm_package_assetsList: \"undefined\"\n\
            }\n\
        ], [\n\
            local, {\n\
                assetsDict: {}\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local.middlewareJsonpStateInit({\n\
            stateInit: true\n\
        });\n\
        // validate data\n\
        local.assertJsonEqual(local.assetsDict[\"/undefined\"], \"\");\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_moduleDirname_default = function (opt, onError) {\n\
/*\n\
 * this function will test moduleDirname's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    // test null-case handling-behavior\n\
    local.assertJsonEqual(\n\
        local.moduleDirname(null, module.paths),\n\
        process.cwd()\n\
    );\n\
    // test path handling-behavior\n\
    local.assertJsonEqual(\n\
        local.moduleDirname(\".\", module.paths),\n\
        process.cwd()\n\
    );\n\
    local.assertJsonEqual(\n\
        local.moduleDirname(\"./\", module.paths),\n\
        process.cwd()\n\
    );\n\
    // test module-exists handling-behavior\n\
    opt = local.moduleDirname(\"electron-lite\", module.paths);\n\
    local.assertThrow((\n\
        /\\/electron-lite$/\n\
    ).test(opt), opt);\n\
    // test module-does-not-exist handling-behavior\n\
    local.assertJsonEqual(\n\
        local.moduleDirname(\"syntax-err\", module.paths),\n\
        \"\"\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_numberToRomanNumerals_default = function (opt, onError) {\n\
/*\n\
 * this function will test numberToRomanNumerals's default handling-behavior\n\
 */\n\
    opt = {};\n\
    opt.list = [\n\
        \"\",\n\
        \"I\",\n\
        \"II\",\n\
        \"III\",\n\
        \"IV\",\n\
        \"V\",\n\
        \"VI\",\n\
        \"VII\",\n\
        \"VIII\",\n\
        \"IX\",\n\
        \"X\",\n\
        \"XI\",\n\
        \"XII\",\n\
        \"XIII\",\n\
        \"XIV\",\n\
        \"XV\",\n\
        \"XVI\",\n\
        \"XVII\",\n\
        \"XVIII\",\n\
        \"XIX\",\n\
        \"XX\",\n\
        \"XXI\",\n\
        \"XXII\",\n\
        \"XXIII\",\n\
        \"XXIV\",\n\
        \"XXV\",\n\
        \"XXVI\",\n\
        \"XXVII\",\n\
        \"XXVIII\",\n\
        \"XXIX\",\n\
        \"XXX\",\n\
        \"XXXI\",\n\
        \"XXXII\",\n\
        \"XXXIII\",\n\
        \"XXXIV\",\n\
        \"XXXV\",\n\
        \"XXXVI\",\n\
        \"XXXVII\",\n\
        \"XXXVIII\",\n\
        \"XXXIX\",\n\
        \"XL\",\n\
        \"XLI\",\n\
        \"XLII\",\n\
        \"XLIII\",\n\
        \"XLIV\",\n\
        \"XLV\",\n\
        \"XLVI\",\n\
        \"XLVII\",\n\
        \"XLVIII\",\n\
        \"XLIX\",\n\
        \"L\",\n\
        \"LI\",\n\
        \"LII\",\n\
        \"LIII\",\n\
        \"LIV\",\n\
        \"LV\",\n\
        \"LVI\",\n\
        \"LVII\",\n\
        \"LVIII\",\n\
        \"LIX\",\n\
        \"LX\",\n\
        \"LXI\",\n\
        \"LXII\",\n\
        \"LXIII\",\n\
        \"LXIV\",\n\
        \"LXV\",\n\
        \"LXVI\",\n\
        \"LXVII\",\n\
        \"LXVIII\",\n\
        \"LXIX\",\n\
        \"LXX\",\n\
        \"LXXI\",\n\
        \"LXXII\",\n\
        \"LXXIII\",\n\
        \"LXXIV\",\n\
        \"LXXV\",\n\
        \"LXXVI\",\n\
        \"LXXVII\",\n\
        \"LXXVIII\",\n\
        \"LXXIX\",\n\
        \"LXXX\",\n\
        \"LXXXI\",\n\
        \"LXXXII\",\n\
        \"LXXXIII\",\n\
        \"LXXXIV\",\n\
        \"LXXXV\",\n\
        \"LXXXVI\",\n\
        \"LXXXVII\",\n\
        \"LXXXVIII\",\n\
        \"LXXXIX\",\n\
        \"XC\",\n\
        \"XCI\",\n\
        \"XCII\",\n\
        \"XCIII\",\n\
        \"XCIV\",\n\
        \"XCV\",\n\
        \"XCVI\",\n\
        \"XCVII\",\n\
        \"XCVIII\",\n\
        \"XCIX\",\n\
        \"C\"\n\
    ];\n\
    opt.ii = 0;\n\
    while (opt.ii < 10) {\n\
        local.assertJsonEqual(\n\
            local.numberToRomanNumerals(opt.ii),\n\
            opt.list[opt.ii]\n\
        );\n\
        opt.ii += 1;\n\
    }\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_objectSetDefault_default = function (opt, onError) {\n\
/*\n\
 * this function will test objectSetDefault's default handling-behavior\n\
 */\n\
    // test null-case handling-behavior\n\
    local.objectSetDefault();\n\
    local.objectSetDefault({});\n\
    // test falsy handling-behavior\n\
    [\n\
        \"\", 0, false, null, undefined\n\
    ].forEach(function (aa) {\n\
        [\n\
            \"\", 0, false, null, undefined\n\
        ].forEach(function (bb) {\n\
            local.assertJsonEqual(\n\
                local.objectSetDefault({\n\
                    data: aa\n\
                }, {\n\
                    data: bb\n\
                }).data,\n\
                (aa === 0 || aa === false || bb === undefined)\n\
                ? aa\n\
                : bb\n\
            );\n\
        });\n\
    });\n\
    // test non-recursive handling-behavior\n\
    local.assertJsonEqual(local.objectSetDefault({\n\
        aa: 0,\n\
        bb: {\n\
            cc: 1\n\
        },\n\
        cc: {\n\
            dd: {}\n\
        },\n\
        dd: [\n\
            1, 1\n\
        ],\n\
        ee: [\n\
            1, 1\n\
        ]\n\
    }, {\n\
        aa: 2,\n\
        bb: {\n\
            dd: 2\n\
        },\n\
        cc: {\n\
            dd: {\n\
                ee: 2\n\
            }\n\
        },\n\
        dd: [\n\
            2, 2\n\
        ],\n\
        ee: {\n\
            ff: 2\n\
        }\n\
    // test default-depth handling-behavior\n\
    }, null), {\n\
        aa: 0,\n\
        bb: {\n\
            cc: 1\n\
        },\n\
        cc: {\n\
            dd: {}\n\
        },\n\
        dd: [\n\
            1, 1\n\
        ],\n\
        ee: [\n\
            1, 1\n\
        ]\n\
    });\n\
    // test recursive handling-behavior\n\
    local.assertJsonEqual(local.objectSetDefault({\n\
        aa: 0,\n\
        bb: {\n\
            cc: 1\n\
        },\n\
        cc: {\n\
            dd: {}\n\
        },\n\
        dd: [\n\
            1, 1\n\
        ],\n\
        ee: [\n\
            1, 1\n\
        ]\n\
    }, {\n\
        aa: 2,\n\
        bb: {\n\
            dd: 2\n\
        },\n\
        cc: {\n\
            dd: {\n\
                ee: 2\n\
            }\n\
        },\n\
        dd: [\n\
            2, 2\n\
        ],\n\
        ee: {\n\
            ff: 2\n\
        }\n\
    // test depth handling-behavior\n\
    }, 2), {\n\
        aa: 0,\n\
        bb: {\n\
            cc: 1,\n\
            dd: 2\n\
        },\n\
        cc: {\n\
            dd: {}\n\
        },\n\
        dd: [\n\
            1, 1\n\
        ],\n\
        ee: [\n\
            1, 1\n\
        ]\n\
    });\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_objectSetOverride_default = function (opt, onError) {\n\
/*\n\
 * this function will test objectSetOverride's default handling-behavior\n\
 */\n\
    // test null-case handling-behavior\n\
    local.objectSetOverride();\n\
    local.objectSetOverride({});\n\
    // test falsy handling-behavior\n\
    [\n\
        \"\", 0, false, null, undefined\n\
    ].forEach(function (aa) {\n\
        [\n\
            \"\", 0, false, null, undefined\n\
        ].forEach(function (bb) {\n\
            local.assertJsonEqual(\n\
                local.objectSetOverride({\n\
                    data: aa\n\
                }, {\n\
                    data: bb\n\
                }).data,\n\
                bb === undefined\n\
                ? aa\n\
                : bb\n\
            );\n\
        });\n\
    });\n\
    // test non-recursive handling-behavior\n\
    local.assertJsonEqual(local.objectSetOverride({\n\
        aa: 1,\n\
        bb: {\n\
            cc: 1\n\
        },\n\
        cc: {\n\
            dd: 1\n\
        },\n\
        dd: [\n\
            1, 1\n\
        ],\n\
        ee: [\n\
            1, 1\n\
        ]\n\
    }, {\n\
        aa: 2,\n\
        bb: {\n\
            dd: 2\n\
        },\n\
        cc: {\n\
            ee: 2\n\
        },\n\
        dd: [\n\
            2, 2\n\
        ],\n\
        ee: {\n\
            ff: 2\n\
        }\n\
    // test default-depth handling-behavior\n\
    }, null), {\n\
        aa: 2,\n\
        bb: {\n\
            dd: 2\n\
        },\n\
        cc: {\n\
            ee: 2\n\
        },\n\
        dd: [\n\
            2, 2\n\
        ],\n\
        ee: {\n\
            ff: 2\n\
        }\n\
    });\n\
    // test recursive handling-behavior\n\
    local.assertJsonEqual(local.objectSetOverride({\n\
        aa: 1,\n\
        bb: {\n\
            cc: 1\n\
        },\n\
        cc: {\n\
            dd: 1\n\
        },\n\
        dd: [\n\
            1, 1\n\
        ],\n\
        ee: [\n\
            1, 1\n\
        ]\n\
    }, {\n\
        aa: 2,\n\
        bb: {\n\
            dd: 2\n\
        },\n\
        cc: {\n\
            ee: 2\n\
        },\n\
        dd: [\n\
            2, 2\n\
        ],\n\
        ee: {\n\
            ff: 2\n\
        }\n\
    // test depth handling-behavior\n\
    }, 2), {\n\
        aa: 2,\n\
        bb: {\n\
            cc: 1,\n\
            dd: 2\n\
        },\n\
        cc: {\n\
            dd: 1,\n\
            ee: 2\n\
        },\n\
        dd: [\n\
            2, 2\n\
        ],\n\
        ee: {\n\
            ff: 2\n\
        }\n\
    });\n\
    // test env with empty-string handling-behavior\n\
    local.assertJsonEqual(local.objectSetOverride(\n\
        local.env,\n\
        {\n\
            \"emptyString\": null\n\
        },\n\
        // test default-depth handling-behavior\n\
        null,\n\
        local.env\n\
    ).emptyString, \"\");\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_onErrorDefault_default = function (opt, onError) {\n\
/*\n\
 * this function will test onErrorDefault's default handling-behavior\n\
 */\n\
    local.testMock([\n\
        [\n\
            console, {\n\
                error: function (arg) {\n\
                    opt = arg;\n\
                }\n\
            }\n\
        ], [\n\
            globalThis, {\n\
                __coverage__: null\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        // test no err handling-behavior\n\
        local.onErrorDefault();\n\
        // validate opt\n\
        local.assertThrow(!opt, opt);\n\
        // test err handling-behavior\n\
        local.onErrorDefault(local.errDefault);\n\
        // validate opt\n\
        local.assertThrow(opt, opt);\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_onErrorThrow_err = function (opt, onError) {\n\
/*\n\
 * this function will test onErrorThrow's err handling-behavior\n\
 */\n\
    local.tryCatchOnError(function () {\n\
        local.onErrorThrow(local.errDefault);\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.testCase_onErrorWithStack_toString = function (opt, onError) {\n\
/*\n\
 * this function will test onErrorWithStack's toString handling-behavior\n\
 */\n\
    local.assertJsonEqual(\n\
        String(local.onErrorWithStack(local.nop)),\n\
        String(local.nop)\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_onFileModifiedRestart_watchFile = function (opt, onError) {\n\
/*\n\
 * this function will test onFileModifiedRestart's watchFile handling-behavior\n\
 */\n\
    var onParallel;\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    onParallel = local.onParallel(onError);\n\
    onParallel.counter += 1;\n\
    local.fs.stat(__filename, function (err, stat) {\n\
        // test default watchFile handling-behavior\n\
        onParallel.counter += 1;\n\
        local.fs.utimes(__filename, stat.atime, new Date(), onParallel);\n\
        // test nop watchFile handling-behavior\n\
        onParallel.counter += 1;\n\
        setTimeout(function () {\n\
            local.fs.utimes(__filename, stat.atime, stat.mtime, onParallel);\n\
        }, 1000);\n\
        onParallel(err, opt);\n\
    });\n\
};\n\
\n\
local.testCase_onNext_err = function (opt, onError) {\n\
/*\n\
 * this function will test onNext's err handling-behavior\n\
 */\n\
\n\
    opt = {};\n\
    opt.modeDebug = true;\n\
    local.onNext(opt, function () {\n\
        throw local.errDefault;\n\
    });\n\
    opt.modeNext = 0;\n\
    local.tryCatchOnError(function () {\n\
        opt.onNext();\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.testCase_onParallelList_default = function (opt, onError) {\n\
/*\n\
 * this function will test onParallelList's default handling-behavior\n\
 */\n\
    opt = {};\n\
    local.onNext(opt, function (err) {\n\
        switch (opt.modeNext) {\n\
        case 1:\n\
            // test null-case handling-behavior\n\
            local.onParallelList({}, local.onErrorThrow, opt.onNext);\n\
            break;\n\
        case 2:\n\
            opt.list = [\n\
                null\n\
            ];\n\
            // test retryLimit handling-behavior\n\
            opt.retryLimit = 1;\n\
            local.onParallelList(opt, function (option2, onParallel) {\n\
                onParallel.counter += 1;\n\
                // test err handling-behavior\n\
                onParallel(local.errDefault, option2);\n\
                // test multiple-callback handling-behavior\n\
                setTimeout(onParallel, 5000);\n\
            }, function (err) {\n\
                // validate err occurred\n\
                local.assertThrow(err, err);\n\
                opt.onNext();\n\
            });\n\
            break;\n\
        case 3:\n\
            opt.data = [];\n\
            // test rateLimit handling-behavior\n\
            opt.rateLimit = 3;\n\
            opt.rateMax = 0;\n\
            // test retryLimit handling-behavior\n\
            opt.retryLimit = 1;\n\
            local.onParallelList({\n\
                list: [\n\
                    1, 2, 3, 4\n\
                ],\n\
                rateLimit: opt.rateLimit\n\
            }, function (option2, onParallel) {\n\
                onParallel.counter += 1;\n\
                opt.rateMax = Math.max(\n\
                    onParallel.counter - 1,\n\
                    opt.rateMax\n\
                );\n\
                // test async handling-behavior\n\
                setTimeout(function () {\n\
                    // test list-growth handling-behavior\n\
                    if (option2.ii === 3) {\n\
                        option2.list.push(5);\n\
                    }\n\
                    opt.data[option2.ii] = option2.elem;\n\
                    // test retry handling-behavior\n\
                    local.assertThrow(option2.retry < 1);\n\
                    onParallel(null, option2);\n\
                });\n\
            }, opt.onNext, opt.rateLimit);\n\
            break;\n\
        case 4:\n\
            // validate data\n\
            local.assertJsonEqual(opt.data, [\n\
                1, 2, 3, 4, 5\n\
            ]);\n\
            local.assertJsonEqual(opt.rateMax, 3);\n\
            opt.data = [];\n\
            opt.rateLimit = \"syntax-err\";\n\
            opt.rateMax = 0;\n\
            local.onParallelList({\n\
                list: [\n\
                    1, 2, 3, 4, 5\n\
                ],\n\
                rateLimit: opt.rateLimit\n\
            }, function (option2, onParallel) {\n\
                // test sync handling-behavior\n\
                onParallel.counter += 1;\n\
                opt.rateMax = Math.max(onParallel.counter, opt.rateMax);\n\
                opt.data[option2.ii] = option2.elem;\n\
                onParallel(null, opt);\n\
            }, opt.onNext);\n\
            break;\n\
        case 5:\n\
            // validate data\n\
            local.assertJsonEqual(opt.data, [\n\
                1, 2, 3, 4, 5\n\
            ]);\n\
            local.assertJsonEqual(opt.rateMax, 2);\n\
            opt.onNext();\n\
            break;\n\
        default:\n\
            onError(err, opt);\n\
        }\n\
    });\n\
    opt.modeNext = 0;\n\
    opt.onNext();\n\
};\n\
\n\
local.testCase_onParallel_default = function (opt, onError) {\n\
/*\n\
 * this function will test onParallel's default handling-behavior\n\
 */\n\
    var onParallel;\n\
    var onParallelError;\n\
    // test onEach handling-behavior\n\
    onParallel = local.onParallel(onError, function () {\n\
        // validate counter\n\
        local.assertThrow(onParallel.counter >= 0, onParallel);\n\
    });\n\
    onParallel.counter += 1;\n\
    // test multiple-task handling-behavior\n\
    onParallel.counter += 1;\n\
    setTimeout(function () {\n\
        onParallelError = local.onParallel(onParallel);\n\
        onParallelError.counter += 1;\n\
        onParallelError();\n\
        // test multiple-callback-error handling-behavior\n\
        onParallelError();\n\
        // validate err occurred\n\
        local.assertThrow(onParallelError.err, onParallelError.err);\n\
        // test err handling-behavior\n\
        onParallelError(local.errDefault);\n\
        // validate err occurred\n\
        local.assertThrow(onParallelError.err, onParallelError.err);\n\
        // test ignore-after-error handling-behavior\n\
        onParallelError();\n\
    });\n\
    // test default handling-behavior\n\
    onParallel(null, opt);\n\
};\n\
\n\
local.testCase_onTimeout_timeout = function (opt, onError) {\n\
/*\n\
 * this function will test onTimeout's timeout handling-behavior\n\
 */\n\
    opt = local.timeElapsedStart();\n\
    local.onTimeout(function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        // validate err.message\n\
        local.assertThrow(\n\
            err.message.indexOf(\"testCase_onTimeout_timeout\") >= 0,\n\
            err\n\
        );\n\
        // poll timeElapsed\n\
        local.timeElapsedPoll(opt);\n\
        // validate timeElapsed passed is greater than timeout\n\
        local.assertThrow(opt.timeElapsed >= 1000, opt);\n\
        onError(null, opt);\n\
    }, 1000, \"testCase_onTimeout_timeout\");\n\
};\n\
\n\
local.testCase_profileXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test profileXxx's default handling-behavior\n\
 */\n\
    opt = {};\n\
    // test profileSync's handling-behavior\n\
    opt.timeElapsed = local.profileSync(function () {\n\
        return;\n\
    });\n\
    // validate timeElapsed\n\
    local.assertThrow(\n\
        0 <= opt.timeElapsed && opt.timeElapsed < 1000,\n\
        opt.timeElapsed\n\
    );\n\
    // test profile's async handling-behavior\n\
    local.profile(function (onError) {\n\
        setTimeout(onError);\n\
    }, function (err, timeElapsed) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        opt.timeElapsed = timeElapsed;\n\
        // validate timeElapsed\n\
        local.assertThrow((\n\
            0 <= opt.timeElapsed\n\
            && opt.timeElapsed < local.timeoutDefault\n\
        ), opt.timeElapsed);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.testCase_replStart_default = function (opt, onError) {\n\
/*\n\
 * this function will test replStart's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.replStart();\n\
    // coverage-hack - test replStart's muliple-call handling-behavior\n\
    local.replStart();\n\
    local.testMock([\n\
        [\n\
            local.child_process, {\n\
                spawn: function () {\n\
                    return {\n\
                        on: function (evt, callback) {\n\
                            callback(null, evt);\n\
                        }\n\
                    };\n\
                }\n\
            }\n\
        ],\n\
        // suppress process.stdout\n\
        [\n\
            process.stdout, {\n\
                write: local.nop\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        [\n\
            // test null-case handling-behavior\n\
            \"\",\n\
            // test shell handling-behavior\n\
            \"$ :\\n\",\n\
            // test git diff handling-behavior\n\
            \"$ git diff\\n\",\n\
            // test git log handling-behavior\n\
            \"$ git log\\n\",\n\
            // test charCode handling-behavior\n\
            \"charCode abcd\\n\",\n\
            // test charSort handling-behavior\n\
            \"charSort abcd\\n\",\n\
            // test grep handling-behavior\n\
            \"grep \\\\baa\\\\b\\n\",\n\
            // test keys handling-behavior\n\
            \"keys {}\\n\",\n\
            // test print handling-behavior\n\
            \"print abcd\\n\",\n\
            // test err handling-behavior\n\
            \"undefined()\\n\"\n\
        ].forEach(function (script) {\n\
            globalThis.utility2_repl1.eval(script, null, \"repl\", local.nop);\n\
        });\n\
        // test err handling-behavior\n\
        globalThis.utility2_repl1.onError(local.errDefault);\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_replStart_tcp = function (opt, onError) {\n\
/*\n\
 * this function will test replStart's tcp handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = {};\n\
    opt.data = \"\";\n\
    opt.input = Math.random();\n\
    opt.socket = local.net.createConnection(local.env.PORT_REPL);\n\
    opt.socket.on(\"data\", function (data) {\n\
    /*\n\
     * this function will concat data to opt.data\n\
     */\n\
        opt.data += data;\n\
    });\n\
    opt.socket.setEncoding(\"utf8\");\n\
    opt.socket.on(\"end\", function () {\n\
        // validate data\n\
        local.assertThrow(\n\
            opt.data.indexOf(opt.input) >= 0,\n\
            JSON.stringify([\n\
                opt.data, opt.input\n\
            ])\n\
        );\n\
        onError(null, opt);\n\
    });\n\
    opt.socket.write(opt.input + \"\\n\");\n\
    // test err handling-behavior\n\
    opt.socket.end(\"undefined()\\n\");\n\
};\n\
\n\
local.testCase_requireReadme_start = function (opt, onError) {\n\
/*\n\
 * this function will test requireReadme's start handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                assetsDict: {},\n\
                onFileModifiedRestart: local.nop\n\
            }\n\
        ], [\n\
            local.env, {\n\
                npm_config_mode_start: \"1\",\n\
                npm_package_nameLib: \"_testCase_requireReadme_start\"\n\
            }\n\
        ], [\n\
            local.fs, {\n\
                readFile: function (file, opt, onError) {\n\
                    onError(null, \"{}\", file, opt);\n\
                },\n\
                readdirSync: function () {\n\
                    // test jslintAndPrint.conditional handling-behavior\n\
                    return [\n\
                        \"aa.css\",\n\
                        \"aa.html\",\n\
                        \"aa.js\",\n\
                        \"aa.json\",\n\
                        \"aa.rollup.js\",\n\
                        \"assets.swgg.swagger.json\"\n\
                    ];\n\
                }\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        // validate data\n\
        local.requireReadme();\n\
        local.assertThrow(local._testCase_requireReadme_start === local);\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_semverCompare_default = function (opt, onError) {\n\
/*\n\
 * this function will test semverCompare's default handling-behavior\n\
 */\n\
    var aa;\n\
    // test aa = bb\n\
    opt = [\n\
        \"1.2.3\",\n\
        \"1.2.3-\",\n\
        \"1.2.3-alpha.beta\",\n\
        \"1.2.3-alpha.beta\"\n\
    ];\n\
    opt.forEach(function (bb, ii) {\n\
        if (Boolean(ii & 1)) {\n\
            local.assertThrow(\n\
                local.semverCompare(aa, bb) === 0,\n\
                [\n\
                    local.semverCompare(aa, bb), aa, bb\n\
                ]\n\
            );\n\
        }\n\
        aa = bb;\n\
    });\n\
    opt = [\n\
        \"1.2.3-a\",\n\
        \"1.2.3-a.2\",\n\
        \"1.2.3-a.10\",\n\
        \"1.2.3-b\",\n\
        \"1.2.3\",\n\
        \"1.2.10\"\n\
    ];\n\
    // test aa < bb\n\
    opt.reduce(function (aa, bb) {\n\
        local.assertThrow(\n\
            local.semverCompare(aa, bb) === -1,\n\
            [\n\
                local.semverCompare(aa, bb), aa, bb\n\
            ]\n\
        );\n\
        return bb;\n\
    });\n\
    // test aa > bb\n\
    opt.reverse().reduce(function (aa, bb) {\n\
        local.assertThrow(\n\
            local.semverCompare(aa, bb) === 1,\n\
            [\n\
                local.semverCompare(aa, bb), aa, bb\n\
            ]\n\
        );\n\
        return bb;\n\
    });\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_serverRespondTimeoutDefault_timeout = function (\n\
    opt,\n\
    onError\n\
) {\n\
/*\n\
 * this function will test\n\
 * serverRespondTimeoutDefault's timeout handling-behavior\n\
 */\n\
    opt = function (fnc1, fnc2) {\n\
        [\n\
            fnc1, fnc2\n\
        ].forEach(function (fnc) {\n\
            if (typeof fnc === \"function\") {\n\
                fnc();\n\
            }\n\
        });\n\
    };\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                onTimeout: opt,\n\
                serverRespondDefault: local.nop,\n\
                setTimeout: opt\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        local.serverRespondTimeoutDefault({\n\
            headers: {}\n\
        }, {\n\
            on: opt\n\
        });\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_setTimeoutOnError_default = function (opt, onError) {\n\
/*\n\
 * this function will test setTimeoutOnError's default handling-behavior\n\
 */\n\
    // test null-case handling-behavior\n\
    local.assertJsonEqual(local.setTimeoutOnError(), undefined);\n\
    // test onError handling-behavior\n\
    local.assertJsonEqual(\n\
        local.setTimeoutOnError(onError, 0, null, {}, opt),\n\
        {}\n\
    );\n\
};\n\
\n\
local.testCase_sjclHashScryptXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test sjclHashScryptXxx's default handling-behavior\n\
 */\n\
    // test sjclHashScryptCreate's null-case handling-behavior\n\
    local.assertJsonEqual(\n\
        local.sjclHashScryptCreate().slice(0, 10),\n\
        \"$s0$10801$\"\n\
    );\n\
    // https://github.com/wg/scrypt\n\
    // test sjclHashScryptValidate's fail handling-behavior\n\
    local.assertJsonEqual(local.sjclHashScryptValidate(\n\
        \"password\",\n\
        (\n\
            \"$s0$80801$epIxT/h6HbbwHaehFnh/bw==\"\n\
            + \"$l/guDhz2Q0v/D93gq0K0qtSX6FWP8pH5maAJkbIcRaEA\"\n\
        )\n\
    ), false);\n\
    // https://github.com/wg/scrypt\n\
    // test sjclHashScryptValidate's pass handling-behavior\n\
    local.assertJsonEqual(local.sjclHashScryptValidate(\"password\", (\n\
        \"$s0$80801$epIxT/h6HbbwHaehFnh/bw==\"\n\
        + \"$l/guDhz2Q0v/D93gq0K0qtSX6FWP8pH5maAJkbIcRaE=\"\n\
    )), true);\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_sjclHashShaXxxCreate_default = function (opt, onError) {\n\
/*\n\
 * this function will test sjclHashShaXxxCreate's default handling-behavior\n\
 */\n\
    local.assertJsonEqual(\n\
        local.sjclHashSha1Create(\"aa\"),\n\
        \"4MkDWJjdUvxlxBRUzsnE0mEb+zc=\"\n\
    );\n\
    local.assertJsonEqual(\n\
        local.sjclHashSha256Create(\"aa\"),\n\
        \"lhtt0+3jy47LqsvWjeBAzXjrLtWIkTDM60xJJo6k1QY=\"\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_sjclHmacShaXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test sjclHmacShaXxx's default handling-behavior\n\
 */\n\
    local.assertJsonEqual(\n\
        local.sjclHmacSha1Create(\"aa\", \"bb\"),\n\
        \"15pOinCz63A+qZoxnv+mJB6UF1k=\"\n\
    );\n\
    local.assertJsonEqual(\n\
        local.sjclHmacSha256Create(\"aa\", \"bb\"),\n\
        \"94Xv3VdPHA+ohKyjkM1pb0W5ZVAuMVcmIAAI2AqNRCQ=\"\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_stringHtmlSafe_default = function (opt, onError) {\n\
/*\n\
 * this function will test stringHtmlSafe's default handling-behavior\n\
 */\n\
    local.assertJsonEqual(\n\
        local.stringHtmlSafe(\n\
            local.stringHtmlSafe(local.stringCharsetAscii).slice(32, -1)\n\
        ),\n\
        (\n\
            \" !&quot;#$%&amp;&apos;()*+,-./0123456789:;&lt;=&gt;?@\"\n\
            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n\
        )\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_stringQuotedToAscii_default = function (opt, onError) {\n\
/*\n\
 * this function will test stringQuotedToAscii's default handling-behavior\n\
 */\n\
    local.assertJsonEqual(\n\
        local.stringQuotedToAscii(local.stringHelloEmoji),\n\
        \"hello \\\\ud83d\\\\ude01\\n\"\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_stringRegexpEscape_default = function (opt, onError) {\n\
/*\n\
 * this function will test stringRegexpEscape's default handling-behavior\n\
 */\n\
    local.assertJsonEqual(\n\
        local.stringRegexpEscape(local.stringCharsetAscii),\n\
        (\n\
            \"\\u0000\\u0001\\u0002\\u0003\\u0004\\u0005\\u0006\\u0007\"\n\
            + \"\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\"\n\
            + \"\\u0010\\u0011\\u0012\\u0013\\u0014\\u0015\\u0016\\u0017\"\n\
            + \"\\u0018\\u0019\\u001a\\u001b\\u001c\\u001d\\u001e\\u001f\"\n\
            + \" !\\\"#\\\\$%&'\\\\(\\\\)\\\\*\\\\+,\\\\-\\\\.\\\\/0123456789:;<=>\\\\?@\"\n\
            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\\\\[\\\\\\\\\\\\]\\\\^_`\"\n\
            + \"abcdefghijklmnopqrstuvwxyz\\\\{\\\\|\\\\}~\"\n\
            + \"\\u007f\"\n\
        )\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_stringTruncate_default = function (opt, onError) {\n\
/*\n\
 * this function will test stringTruncate's default handling-behavior\n\
 */\n\
    local.assertJsonEqual(local.stringTruncate(\"aa\"), \"aa\");\n\
    local.assertJsonEqual(local.stringTruncate(\"aa\", 1), \"...\");\n\
    local.assertJsonEqual(local.stringTruncate(\"aa\", 2), \"aa\");\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_stringUniqueKey_default = function (opt, onError) {\n\
/*\n\
 * this function will test stringUniqueKey's default handling-behavior\n\
 */\n\
    local.assertThrow((\"zqxj\").indexOf(local.stringUniqueKey(\"zqxj\") < 0));\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_taskCreateCached_default = function (opt, onError) {\n\
/*\n\
 * this function will test taskCreateCached's default handling-behavior\n\
 */\n\
    var cacheValue;\n\
    var onTask;\n\
    var option2;\n\
    opt = {};\n\
    local.onNext(opt, function (err, data) {\n\
        switch (opt.modeNext) {\n\
        // test no cache handling-behavior\n\
        case 1:\n\
            onTask = function (onError) {\n\
                onError(null, cacheValue);\n\
            };\n\
            opt.cacheDict = \"testCase_taskCreateCached_default\";\n\
            opt.key = \"memory\";\n\
            // cleanup memory-cache\n\
            local.cacheDict[opt.cacheDict] = null;\n\
            cacheValue = \"aa\";\n\
            option2 = {\n\
                cacheDict: opt.cacheDict,\n\
                key: opt.key,\n\
                // test onCacheWrite handling-behavior\n\
                onCacheWrite: opt.onNext\n\
            };\n\
            local.taskCreateCached(option2, onTask, opt.onNext);\n\
            break;\n\
        case 2:\n\
            // validate data\n\
            local.assertJsonEqual(data, \"aa\");\n\
            // validate no cache-hit\n\
            local.assertThrow(!option2.modeCacheHit, option2.modeCacheHit);\n\
            break;\n\
        // test cache with update handling-behavior\n\
        case 3:\n\
            cacheValue = \"bb\";\n\
            option2 = {\n\
                cacheDict: opt.cacheDict,\n\
                key: opt.key,\n\
                // test modeCacheUpdate handling-behavior\n\
                modeCacheUpdate: true,\n\
                // test onCacheWrite handling-behavior\n\
                onCacheWrite: opt.onNext\n\
            };\n\
            local.taskCreateCached(option2, onTask, opt.onNext);\n\
            break;\n\
        case 4:\n\
            // validate data\n\
            local.assertJsonEqual(data, \"aa\");\n\
            // validate modeCacheHit\n\
            local.assertJsonEqual(option2.modeCacheHit, true);\n\
            break;\n\
        // test cache handling-behavior\n\
        case 5:\n\
            option2 = {\n\
                cacheDict: opt.cacheDict,\n\
                key: opt.key\n\
            };\n\
            local.taskCreateCached(option2, onTask, opt.onNext);\n\
            break;\n\
        case 6:\n\
            // validate data\n\
            local.assertJsonEqual(data, \"bb\");\n\
            // validate modeCacheHit\n\
            local.assertJsonEqual(option2.modeCacheHit, true);\n\
            opt.onNext();\n\
            break;\n\
        default:\n\
            onError(err, opt);\n\
        }\n\
    });\n\
    opt.modeNext = 0;\n\
    opt.onNext();\n\
};\n\
\n\
local.testCase_taskCreate_multipleCallback = function (opt, onError) {\n\
/*\n\
 * this function will test taskCreate's multiple-callback handling-behavior\n\
 */\n\
    opt = {\n\
        counter: 0,\n\
        key: \"testCase_taskCreate_multiCallback\"\n\
    };\n\
    local.taskCreate(opt, function (onError) {\n\
        onError(null, opt);\n\
        // test multiple-callback handling-behavior\n\
        onError(null, opt);\n\
    }, function () {\n\
        opt.counter += 1;\n\
    });\n\
    // validate counter incremented once\n\
    local.assertJsonEqual(opt.counter, 1);\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_taskCreate_upsert = function (opt, onError) {\n\
/*\n\
 * this function will test taskCreate's upsert handling-behavior\n\
 */\n\
    opt = {\n\
        counter: 0,\n\
        key: \"testCase_taskCreate_upsert\"\n\
    };\n\
    // test upsert handling-behavior\n\
    [\n\
        null, null\n\
    ].forEach(function () {\n\
        local.taskCreate(opt, function (onError) {\n\
            opt.counter += 1;\n\
            setTimeout(onError);\n\
        });\n\
    });\n\
    // validate counter incremented once\n\
    setTimeout(function () {\n\
        local.assertJsonEqual(opt.counter, 1);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.testCase_templateRender_default = function (opt, onError) {\n\
/*\n\
 * this function will test templateRender's default handling-behavior\n\
 */\n\
    // test null-case handling-behavior\n\
    local.assertJsonEqual(local.templateRender(), \"\");\n\
    // test undefined-value handling-behavior\n\
    local.assertJsonEqual(local.templateRender(\"{{aa}}\", {}), \"{{aa}}\");\n\
    // test basic handling-behavior\n\
    local.assertJsonEqual(local.templateRender(\"{{aa}}\", {\n\
        aa: \"```<aa\\nbb>```\"\n\
    }), \"```&lt;aa\\nbb&gt;```\");\n\
    // test markdownToHtml handling-behavior\n\
    local.assertJsonEqual(\n\
        local.templateRender(\"{{aa markdownToHtml}}\", {\n\
            aa: local.stringCharsetAscii.slice(32, -1)\n\
        }),\n\
        (\n\
            \"<p> !&quot;#$%&amp;&apos;()*+,-./0123456789:;&lt;=&gt;?@\"\n\
            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n\
            + \"</p>\\n\"\n\
        )\n\
    );\n\
    // test markdownSafe handling-behavior\n\
    local.assertJsonEqual(\n\
        local.templateRender(\"{{aa markdownSafe notHtmlSafe}}\", {\n\
            aa: local.stringCharsetAscii.slice(32, -1)\n\
        }),\n\
        (\n\
            \" !\\\"#$%&'()*+,-./0123456789:;<=>?@\"\n\
            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_'abcdefghijklmnopqrstuvwxyz{|}~\"\n\
        )\n\
    );\n\
    // test notHtmlSafe handling-behavior\n\
    local.assertJsonEqual(local.templateRender(\"{{aa notHtmlSafe}}\", {\n\
        aa: \"```<aa\\nbb>```\"\n\
    }), \"```<aa\\nbb>```\");\n\
    // test default handling-behavior\n\
    local.assertJsonEqual(local.templateRender((\n\
        \"{{aa alphanumeric}} \"\n\
        + \"{{aa truncate 4 truncate 4}} \"\n\
        + \"{{aa jsonStringify jsonStringify4 decodeURIComponent\"\n\
        + \" encodeURIComponent trim}} \"\n\
        + \"{{bb}} {{cc}} {{dd}} {{ee.ff}}\"\n\
    ), {\n\
        // test string value handling-behavior\n\
        aa: \"`<aa>`\",\n\
        // test non-string value handling-behavior\n\
        bb: 1,\n\
        // test null-value handling-behavior\n\
        cc: null,\n\
        // test undefined-value handling-behavior\n\
        dd: undefined,\n\
        // test nested value handling-behavior\n\
        ee: {\n\
            ff: \"gg\"\n\
        }\n\
    }), \"__aa__ `... %22%5C%22%60%3Caa%3E%60%5C%22%22 1 null {{dd}} gg\");\n\
    // test partial handling-behavior\n\
    local.assertJsonEqual(\n\
        local.templateRender((\n\
            \"{{#undefined aa}}\\n\"\n\
            + \"list1{{#each list1}}\\n\"\n\
            + \"    aa - {{aa}}\\n\"\n\
            + \"    list2{{#eachTrimRightComma list2}}\\n\"\n\
            + \"        {{#this/ notHtmlSafe jsonStringify}}\\n\"\n\
            + \"        bb - {{bb}}\\n\"\n\
            + \"        {{#if bb}}\\n\"\n\
            + \"        if\\n\"\n\
            + \"        {{#unless bb}}\\n\"\n\
            + \"        else\\n\"\n\
            + \"        {{/if bb}}\\n\"\n\
            + \"        {{#unless bb}}\\n\"\n\
            + \"        unless\\n\"\n\
            + \"        {{/unless bb}}\\n\"\n\
            + \"        ,\\n\"\n\
            + \"    {{/eachTrimRightComma list2}}\\n\"\n\
            + \"{{/each list1}}\\n\"\n\
            + \"{{/undefined aa}}\\n\"\n\
        ), {\n\
            list1: [\n\
                // test null-value handling-behavior\n\
                null, {\n\
                    aa: \"aa\",\n\
                    // test recursive-list handling-behavior\n\
                    list2: [\n\
                        {\n\
                            bb: \"bb\"\n\
                        }, {\n\
                            bb: null\n\
                        }\n\
                    ]\n\
                }\n\
            ]\n\
        }),\n\
        (\n\
            \"{{#undefined aa}}\\n\"\n\
            + \"list1\\n\"\n\
            + \"    aa - {{aa}}\\n\"\n\
            + \"    list2\\n\"\n\
            + \"\\n\"\n\
            + \"    aa - aa\\n\"\n\
            + \"    list2\\n\"\n\
            + \"        {\\\"bb\\\":\\\"bb\\\"}\\n\"\n\
            + \"        bb - bb\\n\"\n\
            + \"        \\n\"\n\
            + \"        if\\n\"\n\
            + \"        \\n\"\n\
            + \"        \\n\"\n\
            + \"        ,\\n\"\n\
            + \"    \\n\"\n\
            + \"        {\\\"bb\\\":null}\\n\"\n\
            + \"        bb - null\\n\"\n\
            + \"        \\n\"\n\
            + \"        else\\n\"\n\
            + \"        \\n\"\n\
            + \"        \\n\"\n\
            + \"        unless\\n\"\n\
            + \"        \\n\"\n\
            + \"        \\n\"\n\
            + \"\\n\"\n\
            + \"{{/undefined aa}}\\n\"\n\
        )\n\
    );\n\
    // test err handling-behavior\n\
    local.tryCatchOnError(function () {\n\
        local.templateRender(\"{{aa bb}}\", {\n\
            aa: 1\n\
        });\n\
    }, local.nop);\n\
    // validate err occurred\n\
    local.assertThrow(local._debugTryCatchError, local._debugTryCatchError);\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_testReportCreate_default = function (opt, onError) {\n\
/*\n\
 * this function will test testReport's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.testMock([], function (onError) {\n\
        // test null-case handling-behavior\n\
        local.testReportCreate();\n\
        // test testsFailed handling-behavior\n\
        local.testReportCreate({\n\
            testPlatformList: [\n\
                {\n\
                    testCaseList: [\n\
                        {\n\
                            status: \"failed\"\n\
                        }, {\n\
                            status: \"passed\"\n\
                        }\n\
                    ]\n\
                }\n\
            ]\n\
        });\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_throwError_default = function (opt, onError) {\n\
/*\n\
 * this function will test throwError's default handling-behavior\n\
 */\n\
    local.tryCatchOnError(function () {\n\
        local.throwError();\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.testCase_uiAnimateXxx_default = function (opt, onError) {\n\
/*\n\
 * this function will test uiAnimateXxx's default handling-behavior\n\
 */\n\
    if (!local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    opt = document.createElement(\"div\");\n\
    // test uiAnimateShake handling-behavior\n\
    local.uiAnimateShake();\n\
    local.uiAnimateShake(opt);\n\
    local.assertThrow(\n\
        opt.classList.contains(\"uiAnimateShake\"),\n\
        opt.classList\n\
    );\n\
    local.uiAnimateShake(opt);\n\
    local.assertThrow(\n\
        opt.classList.contains(\"uiAnimateShake\"),\n\
        opt.classList\n\
    );\n\
    // test uiAnimateShakeIfError handling-behavior\n\
    local.uiAnimateShakeIfError();\n\
    local.uiAnimateShakeIfError(null, opt);\n\
    local.assertThrow(\n\
        !opt.classList.contains(\"hasError\"),\n\
        opt.classList\n\
    );\n\
    local.uiAnimateShakeIfError(true, opt);\n\
    local.assertThrow(opt.classList.contains(\"hasError\"), opt.classList);\n\
    local.uiAnimateShakeIfError(null, opt);\n\
    local.assertThrow(!opt.classList.contains(\"hasError\"), opt.classList);\n\
    // test uiAnimateSlideXxx handling-behavior\n\
    local.uiAnimateSlideDown();\n\
    local.uiAnimateSlideUp();\n\
    opt.classList.add(\"uiAnimateSlide\");\n\
    local.uiAnimateSlideDown(opt);\n\
    local.assertThrow(\n\
        opt.style.maxHeight.indexOf(\"px\") >= 0,\n\
        opt.style.maxHeight\n\
    );\n\
    local.uiAnimateSlideUp(opt);\n\
    local.assertJsonEqual(opt.style.maxHeight, \"0px\");\n\
    // test uiAnimateSlideAccordian handling-behavior\n\
    local.uiAnimateSlideAccordian(\n\
        opt,\n\
        [\n\
            opt, document.createElement(\"div\")\n\
        ]\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_urlJoin_default = function (opt, onError) {\n\
/*\n\
 * this function will test urlJoin's default handling-behavior\n\
 */\n\
    local.assertJsonEqual(local.urlJoin(\"\", \"\"), \"/\");\n\
    local.assertJsonEqual(local.urlJoin(\"http://aa/bb\", \"zz\"), \"http://aa/zz\");\n\
    local.assertJsonEqual(\n\
        local.urlJoin(\"http://aa/bb/\", \"zz\"),\n\
        \"http://aa/bb/zz\"\n\
    );\n\
    local.assertJsonEqual(\n\
        local.urlJoin(\"http://aa/bb/\", \"/zz\"),\n\
        \"http://aa/zz\"\n\
    );\n\
    local.assertJsonEqual(local.urlJoin(\"http://aa/bb/\", \"//zz\"), \"http://zz\");\n\
    local.assertJsonEqual(\n\
        local.urlJoin(\"http://aa/bb/\", \"http://zz\"),\n\
        \"http://zz\"\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_urlParse_default = function (opt, onError) {\n\
/*\n\
 * this function will test urlParse's default handling-behavior\n\
 */\n\
    local.testMock([\n\
        [\n\
            local, {\n\
                // test default PORT handling-behavior\n\
                env: {},\n\
                // test init-serverLocalHost handling-behavior\n\
                serverLocalHost: \"\"\n\
            }\n\
        ]\n\
    ], function (onError) {\n\
        // test default handling-behavior\n\
        local.assertJsonEqual(local.urlParse(\n\
            \"https://127.0.0.1:80/foo/bar?aa=1&bb%20cc=dd%20=ee&aa=2&aa#zz=1\"\n\
        ), {\n\
            basename: \"bar\",\n\
            hash: \"#zz=1\",\n\
            host: \"127.0.0.1:80\",\n\
            hostname: \"127.0.0.1\",\n\
            href: (\n\
                \"https://127.0.0.1:80/foo/bar\"\n\
                + \"?aa=1&bb%20cc=dd%20=ee&aa=2&aa#zz=1\"\n\
            ),\n\
            path: \"/foo/bar?aa=1&bb%20cc=dd%20=ee&aa=2&aa\",\n\
            pathname: \"/foo/bar\",\n\
            port: \"80\",\n\
            protocol: \"https:\",\n\
            query: {\n\
                aa: [\n\
                    \"1\", \"2\", \"\"\n\
                ],\n\
                \"bb cc\": \"dd =ee\"\n\
            },\n\
            search: \"?aa=1&bb%20cc=dd%20=ee&aa=2&aa\"\n\
        });\n\
        // test err handling-behavior\n\
        local.assertJsonEqual(local.urlParse(null), {\n\
            basename: \"\",\n\
            hash: \"\",\n\
            host: \"\",\n\
            hostname: \"\",\n\
            href: \"\",\n\
            path: \"\",\n\
            pathname: \"\",\n\
            port: \"\",\n\
            protocol: \"\",\n\
            query: {},\n\
            search: \"\"\n\
        });\n\
        onError(null, opt);\n\
    }, onError);\n\
};\n\
\n\
local.testCase_uuid4Create_default = function (opt, onError) {\n\
/*\n\
 * this function will test uuid4Create's default handling-behavior\n\
 */\n\
    local.assertThrow(\n\
        local.regexpValidateUuid.test(local.uuid4Create()),\n\
        local.uuid4Create()\n\
    );\n\
    onError(null, opt);\n\
};\n\
\n\
local.testCase_webpage_err = function (opt, onError) {\n\
/*\n\
 * this function will test webpage's err handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.browserTest({\n\
        modeCoverageMerge: true,\n\
        modeSilent: true,\n\
        timeoutDefault: local.timeoutDefault - 5000,\n\
        // https://localhost:8080/assets.script_only.html?modeTest=1&modeTestCase=_testCase_testRunDefault_failure&timeExit=\n\
        url: (\n\
            local.serverLocalHost\n\
            // test script_only handling-behavior\n\
            + \"/assets.script_only.html\"\n\
            // test electron-callback handling-behavior\n\
            + \"?modeTest=1&\"\n\
            // test specific testCase handling-behavior\n\
            // test testRunDefault's failure handling-behavior\n\
            + \"modeTestCase=_testCase_testRunDefault_failure&\"\n\
            // test timeExit handling-behavior\n\
            + \"timeExit={{timeExit}}\"\n\
        )\n\
    }, function (err) {\n\
        // validate err occurred\n\
        local.assertThrow(err, err);\n\
        onError(null, opt);\n\
    });\n\
};\n\
\n\
local.utility2.serverLocalUrlTest = function (url) {\n\
/*\n\
 * this function will test if the url is local\n\
 */\n\
    url = local.urlParse(url).pathname;\n\
    return local.isBrowser && !local.env.npm_config_mode_backend && (\n\
        /^\\/test\\./\n\
    ).test(url);\n\
};\n\
}());\n\
\n\
\n\
\n\
// run shared js-env code - init-after\n\
(function () {\n\
// init assets\n\
local.assetsDict[\"/assets.swgg.swagger.json\"] = (\n\
    local.fsReadFileOrEmptyStringSync(\"assets.swgg.swagger.json\")\n\
    || local.assetsDict[\"/assets.swgg.swagger.json\"]\n\
    || local.assetsDict[\"/assets.swgg.swagger.petstore.json\"]\n\
);\n\
// coverage-hack - re-run test-server\n\
local.testRunServer(local);\n\
// coverage-hack - stateInit\n\
local.stateInit({});\n\
// init test-middleware\n\
local.middlewareList.push(function (req, res, next) {\n\
/*\n\
 * this function will run the test-middleware\n\
 */\n\
    switch (req.urlParsed.pathname) {\n\
    // test http POST handling-behavior\n\
    case \"/test.body\":\n\
        // test req-body-read handling-behavior\n\
        local.middlewareBodyRead(req, res, function () {\n\
            // test multiple req-body-read handling-behavior\n\
            local.middlewareBodyRead(req, res, function () {\n\
                res.write(req.bodyRaw);\n\
                res.end();\n\
            });\n\
        });\n\
        break;\n\
    // test http POST handling-behavior\n\
    case \"/test.echo\":\n\
        // test res-header handling-behavior\n\
        local.serverRespondHeadSet(req, res, null, {\n\
            \"X-Res-Header-Test\": \"bb\"\n\
        });\n\
        local.serverRespondEcho(req, res);\n\
        break;\n\
    // test 500-internal-server-error handling-behavior\n\
    case \"/test.err-500\":\n\
        // test multiple-callback serverRespondHeadSet handling-behavior\n\
        local.serverRespondHeadSet(req, res, null, {});\n\
        next(local.errDefault);\n\
        // test multiple-callback-error handling-behavior\n\
        next(local.errDefault);\n\
        // test onErrorDefault handling-behavior\n\
        local.testMock([\n\
            [\n\
                local, {\n\
                    swgg: null\n\
                }\n\
            ]\n\
        ], function (onError) {\n\
            var err;\n\
            err = new Error(\"error\");\n\
            err.statusCode = 500;\n\
            local.middlewareError(err, req, res);\n\
            onError();\n\
        }, local.onErrorThrow);\n\
        break;\n\
    // test undefined-status-code handling-behavior\n\
    case \"/test.err-undefined\":\n\
        local.serverRespondDefault(req, res, 999);\n\
        break;\n\
    // test timeout handling-behavior\n\
    case \"/test.timeout\":\n\
        setTimeout(function () {\n\
            res.end();\n\
        }, 2000);\n\
        break;\n\
    // serve file\n\
    default:\n\
        local.middlewareFileServer(req, res, next);\n\
    }\n\
});\n\
}());\n\
\n\
\n\
\n\
// run node js-env code - init-after\n\
/* istanbul ignore next */\n\
(function () {\n\
if (local.isBrowser) {\n\
    return;\n\
}\n\
\n\
\n\
\n\
(function () {\n\
    switch (local.env.HEROKU_APP_NAME) {\n\
    case \"h1-cron1\":\n\
        // heroku-keepalive\n\
        setInterval(function () {\n\
            local.ajax({\n\
                url: \"https://h1-cron1.herokuapp.com\"\n\
            }, local.onErrorThrow);\n\
        }, 5 * 60 * 1000);\n\
        local.cronJob = local.nop;\n\
        // update cron\n\
        local.ajax({\n\
            url: \"https://kaizhu256.github.io/node-utility2/cronJob.js\"\n\
        }, function (err, xhr) {\n\
            if (!err && xhr.responseText !== local.cronScript) {\n\
                local.cronScript = xhr.responseText;\n\
                local.vm.runInThisContext(local.cronScript);\n\
            }\n\
        });\n\
        setInterval(function () {\n\
            var cronTime;\n\
            cronTime = new Date();\n\
            if (\n\
                cronTime.toISOString().slice(0, 16)\n\
                < (local.cronTime && local.cronTime.toISOString())\n\
            ) {\n\
                return;\n\
            }\n\
            local.cronTime = cronTime;\n\
            // cron every 5 minutes\n\
            if (local.cronTime.getUTCMinutes() % 5 === 0) {\n\
                // update cron\n\
                local.ajax({\n\
                    url: \"https://kaizhu256.github.io/node-utility2/cronJob.js\"\n\
                }, function (err, xhr) {\n\
                    if (!err && xhr.responseText !== local.cronScript) {\n\
                        local.cronScript = xhr.responseText;\n\
                        local.vm.runInThisContext(local.cronScript);\n\
                    }\n\
                });\n\
            }\n\
            local.cronJob();\n\
        }, 30000);\n\
        break;\n\
    case \"h1-proxy1\":\n\
        // heroku-keepalive\n\
        setInterval(function () {\n\
            local.ajax({\n\
                url: \"https://h1-proxy1.herokuapp.com\"\n\
            }, local.onErrorThrow);\n\
        }, 5 * 60 * 1000);\n\
        break;\n\
    }\n\
}());\n\
\n\
\n\
\n\
// init cli\n\
if (module !== require.main || globalThis.utility2_rollup) {\n\
    return;\n\
}\n\
local.assetsDict[\"/assets.script_only.html\"] = (\n\
    \"<h1>script_only_test</h1>\\n\"\n\
    + \"<script src=\\\"assets.utility2.js\\\"></script>\\n\"\n\
    + \"<script>window.utility2_onReadyBefore.counter += 1;</script>\\n\"\n\
    + \"<script src=\\\"assets.example.js\\\"></script>\\n\"\n\
    + \"<script src=\\\"assets.test.js\\\"></script>\\n\"\n\
    + \"<script>window.utility2_onReadyBefore();</script>\\n\"\n\
);\n\
if (process.argv[2]) {\n\
    // start with coverage\n\
    if (local.env.npm_config_mode_coverage) {\n\
        process.argv.splice(1, 1, __dirname + \"/lib.istanbul.js\", \"cover\");\n\
        local.istanbul.cliDict[process.argv[2]]();\n\
        return;\n\
    }\n\
    // start\n\
    process.argv.splice(1, 1);\n\
    process.argv[1] = local.path.resolve(process.cwd(), process.argv[1]);\n\
    local.Module.runMain();\n\
}\n\
}());\n\
\n\
\n\
\n\
}());\n\
"
/* jslint ignore:end */
    return local;
}(globalThis.utility2_rollup));
/* script-end /assets.utility2.test.js */



/* script-begin /assets.utility2.rollup.end.js */
(function () {
    "use strict";
    globalThis.utility2_rollup_old = globalThis.utility2_rollup;
    globalThis.utility2_rollup = null;
}());
/* utility2.rollup.js end */
/* script-end /assets.utility2.rollup.end.js */
/* script-end /assets.utility2.rollup.js */



/* script-begin /assets.utility2.rollup.begin.js */
/* utility2.rollup.js begin */
/* istanbul ignore all */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function () {
    "use strict";
    // init utility2_rollup
    globalThis.utility2_rollup = (
        globalThis.utility2_rollup_old
        || globalThis.globalLocal
    );
    globalThis.utility2_rollup.local = globalThis.utility2_rollup;
    globalThis.utility2_rollup_old = null;
}());
/* script-end /assets.utility2.rollup.begin.js */



/* script-begin local.stateInit */
(function (local) {
    "use strict";
/* jslint ignore:start */
local.stateInit({
    "utility2": {
        "assetsDict": {
            "/assets.example.html": "<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<!-- \"assets.utility2.template.html\" -->\n<title>utility2 (0.0.1)</title>\n<style>\n/* jslint utility2:true */\n/*csslint\n*/\n/* csslint ignore:start */\n*,\n*:after,\n*:before {\n    box-sizing: border-box;\n}\n/* csslint ignore:end */\n@keyframes uiAnimateShake {\n0%,\n50% {\n    transform: translateX(10px);\n}\n100% {\n    transform: translateX(0);\n}\n25%,\n75% {\n    transform: translateX(-10px);\n}\n}\n@keyframes uiAnimateSpin {\n0% {\n    transform: rotate(0deg);\n}\n100% {\n    transform: rotate(360deg);\n}\n}\na {\n    overflow-wrap: break-word;\n}\nbody {\n    background: #eef;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: small;\n    margin: 0 40px;\n}\nbody > div,\nbody > form > div,\nbody > form > input,\nbody > form > pre,\nbody > form > .button,\nbody > form > .textarea,\nbody > input,\nbody > pre,\nbody > .button,\nbody > .textarea {\n    margin-bottom: 20px;\n    margin-top: 0;\n}\nbody > form > input,\nbody > form > .button,\nbody > input,\nbody > .button {\n    width: 20rem;\n}\nbody > form > .textarea,\nbody > .textarea {\n    height: 10rem;\n    width: 100%;\n}\nbody > .readonly {\n    background: #ddd;\n}\ncode,\npre,\n.textarea {\n    font-family: Consolas, Menlo, monospace;\n    font-size: smaller;\n}\npre {\n    overflow-wrap: break-word;\n    white-space: pre-wrap;\n}\n.button {\n    background-color: #fff;\n    border: 1px solid;\n    border-bottom-color: rgb(186, 186, 186);\n    border-left-color: rgb(209, 209, 209);\n    border-radius: 4px;\n    border-right-color: rgb(209, 209, 209);\n    border-top-color: rgb(216, 216, 216);\n    color: #00d;\n    cursor: pointer;\n    display: inline-block;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: 12px;\n    font-style: normal;\n    font-weight: normal;\n    margin: 0;\n    padding: 2px 7px 3px 7px;\n    text-align: center;\n    text-decoration: underline;\n}\n.colorError {\n    color: #d00;\n}\n.textarea {\n    background: #fff;\n    border: 1px solid #999;\n    border-radius: 0;\n    cursor: auto;\n    overflow: auto;\n    padding: 2px;\n}\n.uiAnimateShake {\n    animation-duration: 500ms;\n    animation-name: uiAnimateShake;\n}\n.uiAnimateSlide {\n    overflow-y: hidden;\n    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n}\n.utility2FooterDiv {\n    text-align: center;\n}\n.zeroPixel {\n    border: 0;\n    height: 0;\n    margin: 0;\n    padding: 0;\n    width: 0;\n}\n</style>\n</head>\n<body>\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\n<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\n<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\n<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\n<script>\n/* jslint utility2:true */\n// init domOnEventWindowOnloadTimeElapsed\n(function () {\n/*\n * this function will measure and print time-elapsed for window.onload\n */\n    \"use strict\";\n    if (window.domOnEventWindowOnloadTimeElapsed) {\n        return;\n    }\n    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n    window.addEventListener(\"load\", function () {\n        setTimeout(function () {\n            window.domOnEventWindowOnloadTimeElapsed = (\n                Date.now()\n                - window.domOnEventWindowOnloadTimeElapsed\n            );\n            console.error(\n                \"domOnEventWindowOnloadTimeElapsed = \"\n                + window.domOnEventWindowOnloadTimeElapsed\n            );\n        }, 100);\n    });\n}());\n\n\n\n// init domOnEventDelegateDict\n(function () {\n/*\n * this function will handle delegated dom-event\n */\n    \"use strict\";\n    var timerTimeoutDict;\n    if (window.domOnEventDelegateDict) {\n        return;\n    }\n    window.domOnEventDelegateDict = {};\n    timerTimeoutDict = {};\n    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n        evt.targetOnEvent = evt.target.closest(\n            \"[data-onevent]\"\n        );\n        if (\n            !evt.targetOnEvent\n            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\n            || evt.target.closest(\n                \".disabled, .readonly\"\n            )\n        ) {\n            return;\n        }\n        // rate-limit high-frequency-event\n        switch (evt.type) {\n        case \"keydown\":\n        case \"keyup\":\n            // filter non-input keyboard-event\n            if (!evt.target.closest(\n                \"input, option, select, textarea\"\n            )) {\n                return;\n            }\n            if (timerTimeoutDict[evt.type] !== true) {\n                timerTimeoutDict[evt.type] = timerTimeoutDict[\n                    evt.type\n                ] || setTimeout(function () {\n                    timerTimeoutDict[evt.type] = true;\n                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n                }, 50);\n                return;\n            }\n            timerTimeoutDict[evt.type] = null;\n            break;\n        }\n        switch (evt.targetOnEvent.tagName) {\n        case \"BUTTON\":\n        case \"FORM\":\n            evt.preventDefault();\n            break;\n        }\n        evt.stopPropagation();\n        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n            evt\n        );\n    };\n    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n        Array.from(document.querySelectorAll(\n            \".onevent-reset-output\"\n        )).forEach(function (elem) {\n            switch (elem.tagName) {\n            case \"INPUT\":\n            case \"TEXTAREA\":\n                elem.value = \"\";\n                break;\n            case \"PRE\":\n                elem.textContent = \"\";\n                break;\n            default:\n                elem.innerHTML = \"\";\n            }\n        });\n    };\n    // init event-handling\n    [\n        \"change\",\n        \"click\",\n        \"keydown\",\n        \"submit\"\n    ].forEach(function (eventType) {\n        document.addEventListener(\n            eventType,\n            window.domOnEventDelegateDict.domOnEventDelegate\n        );\n    });\n}());\n\n\n\n// init timerIntervalAjaxProgressUpdate\n(function () {\n/*\n * this function will increment ajax-progress-bar\n * until webpage has loaded\n */\n    \"use strict\";\n    var ajaxProgressDiv1;\n    var ajaxProgressState;\n    var ajaxProgressUpdate;\n    if (\n        window.timerIntervalAjaxProgressUpdate\n        || !document.querySelector(\n            \"#ajaxProgressDiv1\"\n        )\n    ) {\n        return;\n    }\n    ajaxProgressDiv1 = document.querySelector(\n        \"#ajaxProgressDiv1\"\n    );\n    setTimeout(function () {\n        ajaxProgressDiv1.style.width = \"25%\";\n    });\n    ajaxProgressState = 0;\n    ajaxProgressUpdate = (\n        window.local\n        && window.local.ajaxProgressUpdate\n    ) || function () {\n        ajaxProgressDiv1.style.width = \"100%\";\n        setTimeout(function () {\n            ajaxProgressDiv1.style.background = \"transparent\";\n            setTimeout(function () {\n                ajaxProgressDiv1.style.width = \"0%\";\n            }, 500);\n        }, 1000);\n    };\n    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n        ajaxProgressState += 1;\n        ajaxProgressDiv1.style.width = Math.max(\n            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n        ) + \"%\";\n    }, 1000);\n    window.addEventListener(\"load\", function () {\n        clearInterval(window.timerIntervalAjaxProgressUpdate);\n        ajaxProgressUpdate();\n    });\n}());\n\n\n\n// init domOnEventSelectAllWithinPre\n(function () {\n/*\n * this function will limit select-all within <pre tabIndex=\"0\"> elements\n * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n */\n    \"use strict\";\n    if (window.domOnEventSelectAllWithinPre) {\n        return;\n    }\n    window.domOnEventSelectAllWithinPre = function (evt) {\n        var range;\n        var selection;\n        if (\n            evt\n            && evt.key === \"a\"\n            && (evt.ctrlKey || evt.metaKey)\n            && evt.target.closest(\n                \"pre\"\n            )\n        ) {\n            range = document.createRange();\n            range.selectNodeContents(evt.target.closest(\n                \"pre\"\n            ));\n            selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            evt.preventDefault();\n        }\n    };\n    // init event-handling\n    document.addEventListener(\n        \"keydown\",\n        window.domOnEventSelectAllWithinPre\n    );\n}());\n</script>\n<h1>\n<!-- utility2-comment\n    <a\n        {{#if env.npm_package_homepage}}\n        href=\"{{env.npm_package_homepage}}\"\n        {{/if env.npm_package_homepage}}\n        target=\"_blank\"\n    >\nutility2-comment -->\n        utility2 (0.0.1)\n<!-- utility2-comment\n    </a>\nutility2-comment -->\n</h1>\n<h3>the greatest app in the world!</h3>\n<!-- utility2-comment\n<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"testRunButton1\">run internal test</button><br>\nutility2-comment -->\n\n\n\n<label>edit or paste script below to cover and test</label>\n<textarea class=\"textarea\" data-onevent=\"testRunBrowser\" id=\"inputEval1\">\n// remove comment below to disable jslint\n/*jslint browser, devel*/\n/*global window*/\n(function () {\n    \"use strict\";\n    var testCaseDict;\n    testCaseDict = {};\n    testCaseDict.modeTest = 1;\n\n    // comment this testCase to disable failed error demo\n    testCaseDict.testCase_failed_error_demo = function (opt, onError) {\n    /*\n     * this function will run a failed error demo\n     */\n        // jslint-hack\n        window.utility2.nop(opt);\n        onError(new Error(\"this is a failed error demo\"));\n    };\n\n    testCaseDict.testCase_passed_ajax_demo = function (opt, onError) {\n    /*\n     * this function will demo a passed ajax test\n     */\n        var data;\n        opt = {url: \"/\"};\n        // test ajax-req for main-page \"/\"\n        window.utility2.ajax(opt, function (err, xhr) {\n            try {\n                // validate no err occurred\n                console.assert(!err, err);\n                // validate \"200 ok\" status\n                console.assert(xhr.statusCode === 200, xhr.statusCode);\n                // validate non-empty data\n                data = xhr.responseText;\n                console.assert(data && data.length > 0, data);\n                onError();\n            } catch (errorCaught) {\n                onError(errorCaught);\n            }\n        });\n    };\n\n    window.utility2.testRunDefault(testCaseDict);\n}());\n</textarea>\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"jslintAutofixButton1\">jslint autofix</button><br>\n<pre class= \"colorError\" id=\"outputJslintPre1\" tabindex=\"0\"></pre>\n<label>instrumented-code</label>\n<pre class=\"readonly textarea\" id=\"outputCode1\" tabindex=\"0\"></pre>\n<label>stderr and stdout</label>\n<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabindex=\"0\"></pre>\n<div id=\"testReportDiv1\"></div>\n<div id=\"coverageReportDiv1\"></div>\n<!-- utility2-comment\n{{#if isRollup}}\n<script src=\"assets.app.js\"></script>\n{{#unless isRollup}}\nutility2-comment -->\n<script src=\"assets.utility2.lib.istanbul.js\"></script>\n<script src=\"assets.utility2.lib.jslint.js\"></script>\n<script src=\"assets.utility2.lib.db.js\"></script>\n<script src=\"assets.utility2.lib.marked.js\"></script>\n<script src=\"assets.utility2.lib.sjcl.js\"></script>\n<script src=\"assets.utility2.js\"></script>\n<script>window.utility2_onReadyBefore.counter += 1;</script>\n<script src=\"jsonp.utility2.stateInit?callback=window.utility2.stateInit\"></script>\n<script src=\"assets.example.js\"></script>\n<script src=\"assets.test.js\"></script>\n<script>window.utility2_onReadyBefore();</script>\n<!-- utility2-comment\n{{/if isRollup}}\nutility2-comment -->\n<div class=\"utility2FooterDiv\">\n    [ this app was created with\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\n    ]\n</div>\n</body>\n</html>\n",
            "/assets.example.js": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*\nexample.js\n\nthis script will demo automated browser-tests with coverage (via electron and istanbul)\n\ninstruction\n    1. save this script as example.js\n    2. run the shell-command:\n        $ npm install utility2 electron-lite && \\\n            PATH=\"$(pwd)/node_modules/.bin:$PATH\" \\\n            PORT=8081 \\\n            npm_config_mode_coverage=utility2 \\\n            node_modules/.bin/utility2 test example.js\n    3. view test-report in ./tmp/build/test-report.html\n    4. view coverage in ./tmp/build/coverage.html/index.html\n*/\n\n\n\n/* istanbul instrument in package utility2 */\n/* istanbul ignore next */\n/* jslint utility2:true */\n(function (globalThis) {\n    \"use strict\";\n    var consoleError;\n    var local;\n    // init globalThis\n    (function () {\n        try {\n            globalThis = Function(\"return this\")(); // jslint ignore:line\n        } catch (ignore) {}\n    }());\n    globalThis.globalThis = globalThis;\n    // init debug_inline\n    if (!globalThis[\"debug\\u0049nline\"]) {\n        consoleError = console.error;\n        globalThis[\"debug\\u0049nline\"] = function () {\n        /*\n         * this function will both print <arguments> to stderr\n         * and return <arguments>[0]\n         */\n            var argList;\n            argList = Array.from(arguments); // jslint ignore:line\n            // debug arguments\n            globalThis[\"debug\\u0049nlineArguments\"] = argList;\n            consoleError(\"\\n\\ndebug\\u0049nline\");\n            consoleError.apply(console, argList);\n            consoleError(\"\\n\");\n            // return arg0 for inspection\n            return argList[0];\n        };\n    }\n    // init local\n    local = {};\n    local.local = local;\n    globalThis.globalLocal = local;\n    // init isBrowser\n    local.isBrowser = (\n        typeof window === \"object\"\n        && window === globalThis\n        && typeof window.XMLHttpRequest === \"function\"\n        && window.document\n        && typeof window.document.querySelector === \"function\"\n    );\n    // init function\n    local.assertThrow = function (passed, message) {\n    /*\n     * this function will throw err.<message> if <passed> is falsy\n     */\n        var err;\n        if (passed) {\n            return;\n        }\n        err = (\n            // ternary-operator\n            (\n                message\n                && typeof message.message === \"string\"\n                && typeof message.stack === \"string\"\n            )\n            // if message is errObj, then leave as is\n            ? message\n            : new Error(\n                typeof message === \"string\"\n                // if message is a string, then leave as is\n                ? message\n                // else JSON.stringify message\n                : JSON.stringify(message, null, 4)\n            )\n        );\n        throw err;\n    };\n    local.functionOrNop = function (fnc) {\n    /*\n     * this function will if <fnc> exists,\n     * them return <fnc>,\n     * else return <nop>\n     */\n        return fnc || local.nop;\n    };\n    local.identity = function (value) {\n    /*\n     * this function will return <value>\n     */\n        return value;\n    };\n    local.nop = function () {\n    /*\n     * this function will do nothing\n     */\n        return;\n    };\n    local.objectAssignDefault = function (target, source) {\n    /*\n     * this function will if items from <target> are\n     * null, undefined, or empty-string,\n     * then overwrite them with items from <source>\n     */\n        target = target || {};\n        Object.keys(source || {}).forEach(function (key) {\n            if (\n                target[key] === null\n                || target[key] === undefined\n                || target[key] === \"\"\n            ) {\n                target[key] = target[key] || source[key];\n            }\n        });\n        return target;\n    };\n    // require builtin\n    if (!local.isBrowser) {\n        local.assert = require(\"assert\");\n        local.buffer = require(\"buffer\");\n        local.child_process = require(\"child_process\");\n        local.cluster = require(\"cluster\");\n        local.crypto = require(\"crypto\");\n        local.dgram = require(\"dgram\");\n        local.dns = require(\"dns\");\n        local.domain = require(\"domain\");\n        local.events = require(\"events\");\n        local.fs = require(\"fs\");\n        local.http = require(\"http\");\n        local.https = require(\"https\");\n        local.net = require(\"net\");\n        local.os = require(\"os\");\n        local.path = require(\"path\");\n        local.querystring = require(\"querystring\");\n        local.readline = require(\"readline\");\n        local.repl = require(\"repl\");\n        local.stream = require(\"stream\");\n        local.string_decoder = require(\"string_decoder\");\n        local.timers = require(\"timers\");\n        local.tls = require(\"tls\");\n        local.tty = require(\"tty\");\n        local.url = require(\"url\");\n        local.util = require(\"util\");\n        local.vm = require(\"vm\");\n        local.zlib = require(\"zlib\");\n    }\n}(this));\n\n\n\n(function (local) {\n\"use strict\";\n\n\n\n// run shared js-env code - init-before\n(function () {\n// init local\nlocal = (\n    globalThis.utility2_rollup\n    || globalThis.utility2_utility2\n    || globalThis.utility2_moduleExports\n);\n// init exports\nglobalThis.local = local;\n// run test-server\nlocal.testRunServer(local);\n// init assets\nlocal.assetsDict[\"/assets.hello.txt\"] = \"hello \\ud83d\\ude01\\n\";\nlocal.assetsDict[\"/assets.index.template.html\"] = \"\";\n}());\n\n\n\n// run shared js-env code - function\n(function () {\nlocal.testCase_ajax_200 = function (opt, onError) {\n/*\n * this function will test ajax's \"200 ok\" handling-behavior\n */\n    if (!local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = {};\n    // test ajax-path \"assets.hello.txt\"\n    local.ajax({\n        url: \"assets.hello.txt\"\n    }, function (err, xhr) {\n        local.tryCatchOnError(function () {\n            // validate no err occurred\n            local.assertThrow(!err, err);\n            // validate data\n            opt.data = xhr.responseText;\n            local.assertThrow(\n                opt.data === \"hello \\ud83d\\ude01\\n\",\n                opt.data\n            );\n            onError();\n        }, onError);\n    });\n};\n\nlocal.testCase_ajax_404 = function (opt, onError) {\n/*\n * this function will test ajax's \"404 not found\" handling-behavior\n */\n    if (!local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = {};\n    // test ajax-path \"/undefined\"\n    local.ajax({\n        url: \"/undefined\"\n    }, function (err) {\n        local.tryCatchOnError(function () {\n            // validate err occurred\n            local.assertThrow(err, err);\n            opt.statusCode = err.statusCode;\n            // validate 404 http statusCode\n            local.assertThrow(opt.statusCode === 404, opt.statusCode);\n            onError();\n        }, onError);\n    });\n};\n\nlocal.testCase_webpage_default = function (opt, onError) {\n/*\n * this function will test webpage's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = {\n        modeCoverageMerge: true,\n        url: local.serverLocalHost + \"?modeTest=1\"\n    };\n    local.browserTest(opt, onError);\n};\n}());\n\n\n\n/* istanbul ignore next */\n// run browser js-env code - init-test\n(function () {\nif (!local.isBrowser) {\n    return;\n}\n// log stderr and stdout to #outputStdout1\n[\"error\", \"log\"].forEach(function (key) {\n    var argList;\n    var elem;\n    var fnc;\n    elem = document.querySelector(\n        \"#outputStdout1\"\n    );\n    if (!elem) {\n        return;\n    }\n    fnc = console[key];\n    console[key] = function () {\n        argList = Array.from(arguments); // jslint ignore:line\n        fnc.apply(console, argList);\n        // append text to #outputStdout1\n        elem.textContent += argList.map(function (arg) {\n            return (\n                typeof arg === \"string\"\n                ? arg\n                : JSON.stringify(arg, null, 4)\n            );\n        }).join(\" \").replace((\n            /\\u001b\\[\\d*m/g\n        ), \"\") + \"\\n\";\n        // scroll textarea to bottom\n        elem.scrollTop = elem.scrollHeight;\n    };\n});\nObject.assign(local, globalThis.domOnEventDelegateDict);\nglobalThis.domOnEventDelegateDict = local;\nlocal.onEventDomDb = (\n    local.db && local.db.onEventDomDb\n);\nlocal.testRunBrowser = function (evt) {\n/*\n * this function will run browser-tests\n */\n    switch (\n        !evt.ctrlKey\n        && !evt.metaKey\n        && (\n            evt.modeInit\n            || (evt.type + \".\" + (evt.target && evt.target.id))\n        )\n    ) {\n    // custom-case\n    case \"click.jslintAutofixButton1\":\n    case \"keydown.inputEval1\":\n    case true:\n        globalThis.domOnEventDelegateDict.domOnEventResetOutput();\n        // jslint #inputEval1\n        local.jslint.jslintAndPrint(\n            document.querySelector(\n                \"#inputEval1\"\n            ).value,\n            \"inputEval1.js\",\n            {\n                autofix: (\n                    evt\n                    && evt.currentTarget\n                    && evt.currentTarget.id === \"jslintAutofixButton1\"\n                ),\n                conditional: true\n            }\n        );\n        if (local.jslint.jslintResult.autofix) {\n            document.querySelector(\n                \"#inputEval1\"\n            ).value = (\n                local.jslint.jslintResult.code\n            );\n        }\n        document.querySelector(\n            \"#outputJslintPre1\"\n        ).textContent = (\n            local.jslint.jslintResult.errText\n        ).replace((\n            /\\u001b\\[\\d*m/g\n        ), \"\").trim();\n        // try to cleanup __coverage__\n        try {\n            delete globalThis.__coverage__[\"/inputEval1.js\"];\n        } catch (ignore) {}\n        // try to cover and eval input-code\n        try {\n            document.querySelector(\n                \"#outputCode1\"\n            ).textContent = (\n                local.istanbul.instrumentSync(\n                    document.querySelector(\n                        \"#inputEval1\"\n                    ).value,\n                    \"/inputEval1.js\"\n                )\n            );\n            eval( // jslint ignore:line\n                document.querySelector(\n                    \"#outputCode1\"\n                ).textContent.replace((\n                    /^#!\\//\n                ), \"// \")\n            );\n            document.querySelector(\n                \"#coverageReportDiv1\"\n            ).innerHTML = (\n                local.istanbul.coverageReportCreate({\n                    coverage: window.__coverage__\n                })\n            );\n        } catch (errorCaught2) {\n            console.error(errorCaught2);\n        }\n        return;\n    case \"click.testRunButton1\":\n        local.modeTest = 1;\n        local.testRunDefault(local);\n        return;\n    // run browser-tests\n    default:\n        if (\n            (evt.target && evt.target.id) !== \"testRunButton1\"\n            && !(evt.modeInit && (\n                /\\bmodeTest=1\\b/\n            ).test(location.search))\n        ) {\n            return;\n        }\n        // show browser-tests\n        if (document.querySelector(\n            \"#testReportDiv1\"\n        ).style.maxHeight === \"0px\") {\n            globalThis.domOnEventDelegateDict.domOnEventResetOutput();\n            local.uiAnimateSlideDown(document.querySelector(\n                \"#testReportDiv1\"\n            ));\n            document.querySelector(\n                \"#testRunButton1\"\n            ).textContent = \"hide internal test\";\n            local.modeTest = 1;\n            local.testRunDefault(local);\n            return;\n        }\n        // hide browser-tests\n        local.uiAnimateSlideUp(document.querySelector(\n            \"#testReportDiv1\"\n        ));\n        document.querySelector(\n            \"#testRunButton1\"\n        ).textContent = \"run internal test\";\n    }\n};\n\nlocal.testRunBrowser({\n    modeInit: true\n});\n}());\n\n\n\n/* istanbul ignore next */\n// run node js-env code - init-test\n(function () {\nif (local.isBrowser) {\n    return;\n}\n// init exports\nmodule.exports = local;\n/* validateLineSortedReset */\n// init assets\nlocal.assetsDict = local.assetsDict || {};\n[\n    \"assets.index.template.html\",\n    \"assets.swgg.swagger.json\",\n    \"assets.swgg.swagger.server.json\"\n].forEach(function (file) {\n    file = \"/\" + file;\n    local.assetsDict[file] = local.assetsDict[file] || \"\";\n    if (local.fs.existsSync(local.__dirname + file)) {\n        local.assetsDict[file] = local.fs.readFileSync(\n            local.__dirname + file,\n            \"utf8\"\n        );\n    }\n});\n/* jslint ignore:start */\nlocal.assetsDict[\"/assets.index.template.html\"] = '\\\n<!doctype html>\\n\\\n<html lang=\"en\">\\n\\\n<head>\\n\\\n<meta charset=\"utf-8\">\\n\\\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\\n<!-- \"assets.utility2.template.html\" -->\\n\\\n<title>{{env.npm_package_name}} ({{env.npm_package_version}})</title>\\n\\\n<style>\\n\\\n/* jslint utility2:true */\\n\\\n/*csslint\\n\\\n*/\\n\\\n/* csslint ignore:start */\\n\\\n*,\\n\\\n*:after,\\n\\\n*:before {\\n\\\n    box-sizing: border-box;\\n\\\n}\\n\\\n/* csslint ignore:end */\\n\\\n@keyframes uiAnimateShake {\\n\\\n0%,\\n\\\n50% {\\n\\\n    transform: translateX(10px);\\n\\\n}\\n\\\n100% {\\n\\\n    transform: translateX(0);\\n\\\n}\\n\\\n25%,\\n\\\n75% {\\n\\\n    transform: translateX(-10px);\\n\\\n}\\n\\\n}\\n\\\n@keyframes uiAnimateSpin {\\n\\\n0% {\\n\\\n    transform: rotate(0deg);\\n\\\n}\\n\\\n100% {\\n\\\n    transform: rotate(360deg);\\n\\\n}\\n\\\n}\\n\\\na {\\n\\\n    overflow-wrap: break-word;\\n\\\n}\\n\\\nbody {\\n\\\n    background: #eef;\\n\\\n    font-family: Arial, Helvetica, sans-serif;\\n\\\n    font-size: small;\\n\\\n    margin: 0 40px;\\n\\\n}\\n\\\nbody > div,\\n\\\nbody > form > div,\\n\\\nbody > form > input,\\n\\\nbody > form > pre,\\n\\\nbody > form > .button,\\n\\\nbody > form > .textarea,\\n\\\nbody > input,\\n\\\nbody > pre,\\n\\\nbody > .button,\\n\\\nbody > .textarea {\\n\\\n    margin-bottom: 20px;\\n\\\n    margin-top: 0;\\n\\\n}\\n\\\nbody > form > input,\\n\\\nbody > form > .button,\\n\\\nbody > input,\\n\\\nbody > .button {\\n\\\n    width: 20rem;\\n\\\n}\\n\\\nbody > form > .textarea,\\n\\\nbody > .textarea {\\n\\\n    height: 10rem;\\n\\\n    width: 100%;\\n\\\n}\\n\\\nbody > .readonly {\\n\\\n    background: #ddd;\\n\\\n}\\n\\\ncode,\\n\\\npre,\\n\\\n.textarea {\\n\\\n    font-family: Consolas, Menlo, monospace;\\n\\\n    font-size: smaller;\\n\\\n}\\n\\\npre {\\n\\\n    overflow-wrap: break-word;\\n\\\n    white-space: pre-wrap;\\n\\\n}\\n\\\n.button {\\n\\\n    background-color: #fff;\\n\\\n    border: 1px solid;\\n\\\n    border-bottom-color: rgb(186, 186, 186);\\n\\\n    border-left-color: rgb(209, 209, 209);\\n\\\n    border-radius: 4px;\\n\\\n    border-right-color: rgb(209, 209, 209);\\n\\\n    border-top-color: rgb(216, 216, 216);\\n\\\n    color: #00d;\\n\\\n    cursor: pointer;\\n\\\n    display: inline-block;\\n\\\n    font-family: Arial, Helvetica, sans-serif;\\n\\\n    font-size: 12px;\\n\\\n    font-style: normal;\\n\\\n    font-weight: normal;\\n\\\n    margin: 0;\\n\\\n    padding: 2px 7px 3px 7px;\\n\\\n    text-align: center;\\n\\\n    text-decoration: underline;\\n\\\n}\\n\\\n.colorError {\\n\\\n    color: #d00;\\n\\\n}\\n\\\n.textarea {\\n\\\n    background: #fff;\\n\\\n    border: 1px solid #999;\\n\\\n    border-radius: 0;\\n\\\n    cursor: auto;\\n\\\n    overflow: auto;\\n\\\n    padding: 2px;\\n\\\n}\\n\\\n.uiAnimateShake {\\n\\\n    animation-duration: 500ms;\\n\\\n    animation-name: uiAnimateShake;\\n\\\n}\\n\\\n.uiAnimateSlide {\\n\\\n    overflow-y: hidden;\\n\\\n    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\\n\\\n}\\n\\\n.utility2FooterDiv {\\n\\\n    text-align: center;\\n\\\n}\\n\\\n.zeroPixel {\\n\\\n    border: 0;\\n\\\n    height: 0;\\n\\\n    margin: 0;\\n\\\n    padding: 0;\\n\\\n    width: 0;\\n\\\n}\\n\\\n</style>\\n\\\n</head>\\n\\\n<body>\\n\\\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\\n\\\n<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\\n\\\n<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\\n\\\n<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\\n\\\n<script>\\n\\\n/* jslint utility2:true */\\n\\\n// init domOnEventWindowOnloadTimeElapsed\\n\\\n(function () {\\n\\\n/*\\n\\\n * this function will measure and print time-elapsed for window.onload\\n\\\n */\\n\\\n    \"use strict\";\\n\\\n    if (window.domOnEventWindowOnloadTimeElapsed) {\\n\\\n        return;\\n\\\n    }\\n\\\n    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\\n\\\n    window.addEventListener(\"load\", function () {\\n\\\n        setTimeout(function () {\\n\\\n            window.domOnEventWindowOnloadTimeElapsed = (\\n\\\n                Date.now()\\n\\\n                - window.domOnEventWindowOnloadTimeElapsed\\n\\\n            );\\n\\\n            console.error(\\n\\\n                \"domOnEventWindowOnloadTimeElapsed = \"\\n\\\n                + window.domOnEventWindowOnloadTimeElapsed\\n\\\n            );\\n\\\n        }, 100);\\n\\\n    });\\n\\\n}());\\n\\\n\\n\\\n\\n\\\n\\n\\\n// init domOnEventDelegateDict\\n\\\n(function () {\\n\\\n/*\\n\\\n * this function will handle delegated dom-event\\n\\\n */\\n\\\n    \"use strict\";\\n\\\n    var timerTimeoutDict;\\n\\\n    if (window.domOnEventDelegateDict) {\\n\\\n        return;\\n\\\n    }\\n\\\n    window.domOnEventDelegateDict = {};\\n\\\n    timerTimeoutDict = {};\\n\\\n    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\\n\\\n        evt.targetOnEvent = evt.target.closest(\\n\\\n            \"[data-onevent]\"\\n\\\n        );\\n\\\n        if (\\n\\\n            !evt.targetOnEvent\\n\\\n            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\\n\\\n            || evt.target.closest(\\n\\\n                \".disabled, .readonly\"\\n\\\n            )\\n\\\n        ) {\\n\\\n            return;\\n\\\n        }\\n\\\n        // rate-limit high-frequency-event\\n\\\n        switch (evt.type) {\\n\\\n        case \"keydown\":\\n\\\n        case \"keyup\":\\n\\\n            // filter non-input keyboard-event\\n\\\n            if (!evt.target.closest(\\n\\\n                \"input, option, select, textarea\"\\n\\\n            )) {\\n\\\n                return;\\n\\\n            }\\n\\\n            if (timerTimeoutDict[evt.type] !== true) {\\n\\\n                timerTimeoutDict[evt.type] = timerTimeoutDict[\\n\\\n                    evt.type\\n\\\n                ] || setTimeout(function () {\\n\\\n                    timerTimeoutDict[evt.type] = true;\\n\\\n                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\\n\\\n                }, 50);\\n\\\n                return;\\n\\\n            }\\n\\\n            timerTimeoutDict[evt.type] = null;\\n\\\n            break;\\n\\\n        }\\n\\\n        switch (evt.targetOnEvent.tagName) {\\n\\\n        case \"BUTTON\":\\n\\\n        case \"FORM\":\\n\\\n            evt.preventDefault();\\n\\\n            break;\\n\\\n        }\\n\\\n        evt.stopPropagation();\\n\\\n        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\\n\\\n            evt\\n\\\n        );\\n\\\n    };\\n\\\n    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\\n\\\n        Array.from(document.querySelectorAll(\\n\\\n            \".onevent-reset-output\"\\n\\\n        )).forEach(function (elem) {\\n\\\n            switch (elem.tagName) {\\n\\\n            case \"INPUT\":\\n\\\n            case \"TEXTAREA\":\\n\\\n                elem.value = \"\";\\n\\\n                break;\\n\\\n            case \"PRE\":\\n\\\n                elem.textContent = \"\";\\n\\\n                break;\\n\\\n            default:\\n\\\n                elem.innerHTML = \"\";\\n\\\n            }\\n\\\n        });\\n\\\n    };\\n\\\n    // init event-handling\\n\\\n    [\\n\\\n        \"change\",\\n\\\n        \"click\",\\n\\\n        \"keydown\",\\n\\\n        \"submit\"\\n\\\n    ].forEach(function (eventType) {\\n\\\n        document.addEventListener(\\n\\\n            eventType,\\n\\\n            window.domOnEventDelegateDict.domOnEventDelegate\\n\\\n        );\\n\\\n    });\\n\\\n}());\\n\\\n\\n\\\n\\n\\\n\\n\\\n// init timerIntervalAjaxProgressUpdate\\n\\\n(function () {\\n\\\n/*\\n\\\n * this function will increment ajax-progress-bar\\n\\\n * until webpage has loaded\\n\\\n */\\n\\\n    \"use strict\";\\n\\\n    var ajaxProgressDiv1;\\n\\\n    var ajaxProgressState;\\n\\\n    var ajaxProgressUpdate;\\n\\\n    if (\\n\\\n        window.timerIntervalAjaxProgressUpdate\\n\\\n        || !document.querySelector(\\n\\\n            \"#ajaxProgressDiv1\"\\n\\\n        )\\n\\\n    ) {\\n\\\n        return;\\n\\\n    }\\n\\\n    ajaxProgressDiv1 = document.querySelector(\\n\\\n        \"#ajaxProgressDiv1\"\\n\\\n    );\\n\\\n    setTimeout(function () {\\n\\\n        ajaxProgressDiv1.style.width = \"25%\";\\n\\\n    });\\n\\\n    ajaxProgressState = 0;\\n\\\n    ajaxProgressUpdate = (\\n\\\n        window.local\\n\\\n        && window.local.ajaxProgressUpdate\\n\\\n    ) || function () {\\n\\\n        ajaxProgressDiv1.style.width = \"100%\";\\n\\\n        setTimeout(function () {\\n\\\n            ajaxProgressDiv1.style.background = \"transparent\";\\n\\\n            setTimeout(function () {\\n\\\n                ajaxProgressDiv1.style.width = \"0%\";\\n\\\n            }, 500);\\n\\\n        }, 1000);\\n\\\n    };\\n\\\n    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\\n\\\n        ajaxProgressState += 1;\\n\\\n        ajaxProgressDiv1.style.width = Math.max(\\n\\\n            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\\n\\\n            ajaxProgressDiv1.style.width.slice(0, -1) | 0\\n\\\n        ) + \"%\";\\n\\\n    }, 1000);\\n\\\n    window.addEventListener(\"load\", function () {\\n\\\n        clearInterval(window.timerIntervalAjaxProgressUpdate);\\n\\\n        ajaxProgressUpdate();\\n\\\n    });\\n\\\n}());\\n\\\n\\n\\\n\\n\\\n\\n\\\n// init domOnEventSelectAllWithinPre\\n\\\n(function () {\\n\\\n/*\\n\\\n * this function will limit select-all within <pre tabIndex=\"0\"> elements\\n\\\n * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\\n\\\n */\\n\\\n    \"use strict\";\\n\\\n    if (window.domOnEventSelectAllWithinPre) {\\n\\\n        return;\\n\\\n    }\\n\\\n    window.domOnEventSelectAllWithinPre = function (evt) {\\n\\\n        var range;\\n\\\n        var selection;\\n\\\n        if (\\n\\\n            evt\\n\\\n            && evt.key === \"a\"\\n\\\n            && (evt.ctrlKey || evt.metaKey)\\n\\\n            && evt.target.closest(\\n\\\n                \"pre\"\\n\\\n            )\\n\\\n        ) {\\n\\\n            range = document.createRange();\\n\\\n            range.selectNodeContents(evt.target.closest(\\n\\\n                \"pre\"\\n\\\n            ));\\n\\\n            selection = window.getSelection();\\n\\\n            selection.removeAllRanges();\\n\\\n            selection.addRange(range);\\n\\\n            evt.preventDefault();\\n\\\n        }\\n\\\n    };\\n\\\n    // init event-handling\\n\\\n    document.addEventListener(\\n\\\n        \"keydown\",\\n\\\n        window.domOnEventSelectAllWithinPre\\n\\\n    );\\n\\\n}());\\n\\\n</script>\\n\\\n<h1>\\n\\\n<!-- utility2-comment\\n\\\n    <a\\n\\\n        {{#if env.npm_package_homepage}}\\n\\\n        href=\"{{env.npm_package_homepage}}\"\\n\\\n        {{/if env.npm_package_homepage}}\\n\\\n        target=\"_blank\"\\n\\\n    >\\n\\\nutility2-comment -->\\n\\\n        {{env.npm_package_name}} ({{env.npm_package_version}})\\n\\\n<!-- utility2-comment\\n\\\n    </a>\\n\\\nutility2-comment -->\\n\\\n</h1>\\n\\\n<h3>{{env.npm_package_description}}</h3>\\n\\\n<!-- utility2-comment\\n\\\n<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\\n\\\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"testRunButton1\">run internal test</button><br>\\n\\\nutility2-comment -->\\n\\\n\\n\\\n\\n\\\n\\n\\\n<label>edit or paste script below to cover and test</label>\\n\\\n<textarea class=\"textarea\" data-onevent=\"testRunBrowser\" id=\"inputEval1\">\\n\\\n// remove comment below to disable jslint\\n\\\n/*jslint browser, devel*/\\n\\\n/*global window*/\\n\\\n(function () {\\n\\\n    \"use strict\";\\n\\\n    var testCaseDict;\\n\\\n    testCaseDict = {};\\n\\\n    testCaseDict.modeTest = 1;\\n\\\n\\n\\\n    // comment this testCase to disable failed error demo\\n\\\n    testCaseDict.testCase_failed_error_demo = function (opt, onError) {\\n\\\n    /*\\n\\\n     * this function will run a failed error demo\\n\\\n     */\\n\\\n        // jslint-hack\\n\\\n        window.utility2.nop(opt);\\n\\\n        onError(new Error(\"this is a failed error demo\"));\\n\\\n    };\\n\\\n\\n\\\n    testCaseDict.testCase_passed_ajax_demo = function (opt, onError) {\\n\\\n    /*\\n\\\n     * this function will demo a passed ajax test\\n\\\n     */\\n\\\n        var data;\\n\\\n        opt = {url: \"/\"};\\n\\\n        // test ajax-req for main-page \"/\"\\n\\\n        window.utility2.ajax(opt, function (err, xhr) {\\n\\\n            try {\\n\\\n                // validate no err occurred\\n\\\n                console.assert(!err, err);\\n\\\n                // validate \"200 ok\" status\\n\\\n                console.assert(xhr.statusCode === 200, xhr.statusCode);\\n\\\n                // validate non-empty data\\n\\\n                data = xhr.responseText;\\n\\\n                console.assert(data && data.length > 0, data);\\n\\\n                onError();\\n\\\n            } catch (errorCaught) {\\n\\\n                onError(errorCaught);\\n\\\n            }\\n\\\n        });\\n\\\n    };\\n\\\n\\n\\\n    window.utility2.testRunDefault(testCaseDict);\\n\\\n}());\\n\\\n</textarea>\\n\\\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"jslintAutofixButton1\">jslint autofix</button><br>\\n\\\n<pre class= \"colorError\" id=\"outputJslintPre1\" tabindex=\"0\"></pre>\\n\\\n<label>instrumented-code</label>\\n\\\n<pre class=\"readonly textarea\" id=\"outputCode1\" tabindex=\"0\"></pre>\\n\\\n<label>stderr and stdout</label>\\n\\\n<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabindex=\"0\"></pre>\\n\\\n<div id=\"testReportDiv1\"></div>\\n\\\n<div id=\"coverageReportDiv1\"></div>\\n\\\n<!-- utility2-comment\\n\\\n{{#if isRollup}}\\n\\\n<script src=\"assets.app.js\"></script>\\n\\\n{{#unless isRollup}}\\n\\\nutility2-comment -->\\n\\\n<script src=\"assets.utility2.lib.istanbul.js\"></script>\\n\\\n<script src=\"assets.utility2.lib.jslint.js\"></script>\\n\\\n<script src=\"assets.utility2.lib.db.js\"></script>\\n\\\n<script src=\"assets.utility2.lib.marked.js\"></script>\\n\\\n<script src=\"assets.utility2.lib.sjcl.js\"></script>\\n\\\n<script src=\"assets.utility2.js\"></script>\\n\\\n<script>window.utility2_onReadyBefore.counter += 1;</script>\\n\\\n<script src=\"jsonp.utility2.stateInit?callback=window.utility2.stateInit\"></script>\\n\\\n<script src=\"assets.example.js\"></script>\\n\\\n<script src=\"assets.test.js\"></script>\\n\\\n<script>window.utility2_onReadyBefore();</script>\\n\\\n<!-- utility2-comment\\n\\\n{{/if isRollup}}\\n\\\nutility2-comment -->\\n\\\n<div class=\"utility2FooterDiv\">\\n\\\n    [ this app was created with\\n\\\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\\n    ]\\n\\\n</div>\\n\\\n</body>\\n\\\n</html>\\n\\\n';\n/* jslint ignore:end */\n/* validateLineSortedReset */\n/* jslint ignore:start */\nlocal.assetsDict[\"/assets.utility2.js\"] =\n    local.assetsDict[\"/assets.utility2.js\"] ||\n    local.fs.readFileSync(local.__dirname + \"/lib.utility2.js\", \"utf8\"\n).replace((/^#!\\//), \"// \");\n/* jslint ignore:end */\n/* validateLineSortedReset */\nlocal.assetsDict[\"/\"] = local.assetsDict[\"/assets.index.template.html\"]\n.replace((\n    /\\{\\{env\\.(\\w+?)\\}\\}/g\n), function (match0, match1) {\n    switch (match1) {\n    case \"npm_package_description\":\n        return \"the greatest app in the world!\";\n    case \"npm_package_name\":\n        return \"utility2\";\n    case \"npm_package_nameLib\":\n        return \"utility2\";\n    case \"npm_package_version\":\n        return \"0.0.1\";\n    default:\n        return match0;\n    }\n});\nlocal.assetsDict[\"/assets.example.html\"] = local.assetsDict[\"/\"];\nlocal.assetsDict[\"/index.html\"] = local.assetsDict[\"/\"];\n// init cli\nif (module !== require.main || globalThis.utility2_rollup) {\n    return;\n}\n/* validateLineSortedReset */\nlocal.assetsDict[\"/assets.example.js\"] = (\n    local.assetsDict[\"/assets.example.js\"]\n    || local.fs.readFileSync(__filename, \"utf8\")\n);\nlocal.assetsDict[\"/favicon.ico\"] = local.assetsDict[\"/favicon.ico\"] || \"\";\n// if $npm_config_timeout_exit exists,\n// then exit this process after $npm_config_timeout_exit ms\nif (Number(process.env.npm_config_timeout_exit)) {\n    setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\n}\n// start server\nif (globalThis.utility2_serverHttp1) {\n    return;\n}\nprocess.env.PORT = process.env.PORT || \"8081\";\nconsole.error(\"http-server listening on port \" + process.env.PORT);\nlocal.http.createServer(function (req, res) {\n    req.urlParsed = local.url.parse(req.url);\n    if (local.assetsDict[req.urlParsed.pathname] !== undefined) {\n        res.end(local.assetsDict[req.urlParsed.pathname]);\n        return;\n    }\n    res.statusCode = 404;\n    res.end();\n}).listen(process.env.PORT);\n}());\n\n\n\n}());",
            "/assets.swgg.swagger.json": "",
            "/assets.test.js": "/* istanbul instrument in package utility2 */\n/* istanbul ignore next */\n/* jslint utility2:true */\n(function (globalThis) {\n    \"use strict\";\n    var consoleError;\n    var local;\n    // init globalThis\n    (function () {\n        try {\n            globalThis = Function(\"return this\")(); // jslint ignore:line\n        } catch (ignore) {}\n    }());\n    globalThis.globalThis = globalThis;\n    // init debug_inline\n    if (!globalThis[\"debug\\u0049nline\"]) {\n        consoleError = console.error;\n        globalThis[\"debug\\u0049nline\"] = function () {\n        /*\n         * this function will both print <arguments> to stderr\n         * and return <arguments>[0]\n         */\n            var argList;\n            argList = Array.from(arguments); // jslint ignore:line\n            // debug arguments\n            globalThis[\"debug\\u0049nlineArguments\"] = argList;\n            consoleError(\"\\n\\ndebug\\u0049nline\");\n            consoleError.apply(console, argList);\n            consoleError(\"\\n\");\n            // return arg0 for inspection\n            return argList[0];\n        };\n    }\n    // init local\n    local = {};\n    local.local = local;\n    globalThis.globalLocal = local;\n    // init isBrowser\n    local.isBrowser = (\n        typeof window === \"object\"\n        && window === globalThis\n        && typeof window.XMLHttpRequest === \"function\"\n        && window.document\n        && typeof window.document.querySelector === \"function\"\n    );\n    // init function\n    local.assertThrow = function (passed, message) {\n    /*\n     * this function will throw err.<message> if <passed> is falsy\n     */\n        var err;\n        if (passed) {\n            return;\n        }\n        err = (\n            // ternary-operator\n            (\n                message\n                && typeof message.message === \"string\"\n                && typeof message.stack === \"string\"\n            )\n            // if message is errObj, then leave as is\n            ? message\n            : new Error(\n                typeof message === \"string\"\n                // if message is a string, then leave as is\n                ? message\n                // else JSON.stringify message\n                : JSON.stringify(message, null, 4)\n            )\n        );\n        throw err;\n    };\n    local.functionOrNop = function (fnc) {\n    /*\n     * this function will if <fnc> exists,\n     * them return <fnc>,\n     * else return <nop>\n     */\n        return fnc || local.nop;\n    };\n    local.identity = function (value) {\n    /*\n     * this function will return <value>\n     */\n        return value;\n    };\n    local.nop = function () {\n    /*\n     * this function will do nothing\n     */\n        return;\n    };\n    local.objectAssignDefault = function (target, source) {\n    /*\n     * this function will if items from <target> are\n     * null, undefined, or empty-string,\n     * then overwrite them with items from <source>\n     */\n        target = target || {};\n        Object.keys(source || {}).forEach(function (key) {\n            if (\n                target[key] === null\n                || target[key] === undefined\n                || target[key] === \"\"\n            ) {\n                target[key] = target[key] || source[key];\n            }\n        });\n        return target;\n    };\n    // require builtin\n    if (!local.isBrowser) {\n        local.assert = require(\"assert\");\n        local.buffer = require(\"buffer\");\n        local.child_process = require(\"child_process\");\n        local.cluster = require(\"cluster\");\n        local.crypto = require(\"crypto\");\n        local.dgram = require(\"dgram\");\n        local.dns = require(\"dns\");\n        local.domain = require(\"domain\");\n        local.events = require(\"events\");\n        local.fs = require(\"fs\");\n        local.http = require(\"http\");\n        local.https = require(\"https\");\n        local.net = require(\"net\");\n        local.os = require(\"os\");\n        local.path = require(\"path\");\n        local.querystring = require(\"querystring\");\n        local.readline = require(\"readline\");\n        local.repl = require(\"repl\");\n        local.stream = require(\"stream\");\n        local.string_decoder = require(\"string_decoder\");\n        local.timers = require(\"timers\");\n        local.tls = require(\"tls\");\n        local.tty = require(\"tty\");\n        local.url = require(\"url\");\n        local.util = require(\"util\");\n        local.vm = require(\"vm\");\n        local.zlib = require(\"zlib\");\n    }\n}(this));\n\n\n\n(function (local) {\n\"use strict\";\n\n\n\n// run shared js-env code - init-before\n(function () {\n// init local\nlocal = (\n    globalThis.utility2 || require(\"./lib.utility2.js\")\n).requireReadme();\nglobalThis.local = local;\n// init test\nlocal.testRunDefault(local);\n}());\n\n\n\n// run shared js-env code - function\n(function () {\nlocal._testCase_testRunDefault_failure = function (opt, onError) {\n/*\n * this function will test testRunDefault's failure handling-behavior\n */\n    // test failure from callback handling-behavior\n    onError(local.errDefault);\n    // test failure from multiple-callback handling-behavior\n    onError(null, opt);\n    // test failure from ajax handling-behavior\n    local.ajax({\n        url: \"/undefined\"\n    }, onError);\n    // test failure from uncaught-uncaughtexception handling-behavior\n    setTimeout(local.throwError);\n    // test console.error handling-behavior\n    local.testMock([\n        [\n            globalThis, {\n                __coverage__: null\n            }\n        ]\n    ], function (onError) {\n        console.error();\n        onError(null, opt);\n    }, local.onErrorThrow);\n    // test failure from thrown err handling-behavior\n    throw local.errDefault;\n};\n\nlocal.testCase_FormData_default = function (opt, onError) {\n/*\n * this function will test FormData's default handling-behavior\n */\n    opt = {};\n    opt.blob1 = new local.Blob([\n        \"aa\", \"bb\", local.stringHelloEmoji, 0\n    ]);\n    opt.blob2 = new local.Blob([\n        \"aa\", \"bb\", local.stringHelloEmoji, 0\n    ], {\n        type: \"text/plain; charset=utf-8\"\n    });\n    opt.data = new local.FormData();\n    opt.data.append(\"text1\", \"aabb\" + local.stringHelloEmoji + \"0\");\n    // test file-upload handling-behavior\n    opt.data.append(\"file1\", opt.blob1);\n    // test file-upload and filename handling-behavior\n    opt.data.append(\"file2\", opt.blob2, \"filename2.txt\");\n    opt.method = \"POST\";\n    opt.url = \"/test.echo\";\n    local.ajax(opt, function (err, xhr) {\n        // validate no err occurred\n        local.assertThrow(!err, err);\n        // validate responseText\n        local.assertThrow(xhr.responseText.indexOf(\n            \"\\r\\nContent-Disposition: form-data; \"\n            + \"name=\\\"text1\\\"\\r\\n\\r\\naabbhello \\ud83d\\ude01\\n0\\r\\n\"\n        ) >= 0, xhr.responseText);\n        local.assertThrow(xhr.responseText.indexOf(\n            \"\\r\\nContent-Disposition: form-data; \"\n            + \"name=\\\"file1\\\"\\r\\n\\r\\naabbhello \\ud83d\\ude01\\n0\\r\\n\"\n        ) >= 0, xhr.responseText);\n        local.assertThrow(xhr.responseText.indexOf(\n            \"\\r\\nContent-Disposition: form-data; name=\\\"file2\\\"; \"\n            + \"filename=\\\"filename2.txt\\\"\\r\\nContent-Type: text/plain; \"\n            + \"charset=utf-8\\r\\n\\r\\naabbhello \\ud83d\\ude01\\n0\\r\\n\"\n        ) >= 0, xhr.responseText);\n        onError(null, opt);\n    });\n};\n\nlocal.testCase_FormData_err = function (opt, onError) {\n/*\n * this function will test FormData's err handling-behavior\n */\n    local.testMock([\n        [\n            local.FormData.prototype, {\n                read: function (onError) {\n                    onError(local.errDefault);\n                }\n            }\n        ]\n    ], function (onError) {\n        local.ajax({\n            data: new local.FormData(),\n            method: \"POST\",\n            url: \"/test.echo\"\n        }, function (err) {\n            // validate err occurred\n            local.assertThrow(err, err);\n            onError(null, opt);\n        });\n    }, onError);\n};\n\nlocal.testCase_FormData_nullCase = function (opt, onError) {\n/*\n * this function will test FormData's null-case handling-behavior\n */\n    local.ajax({\n        data: new local.FormData(),\n        method: \"POST\",\n        url: \"/test.echo\"\n    }, function (err, xhr) {\n        // validate no err occurred\n        local.assertThrow(!err, err);\n        // validate responseText\n        local.assertThrow((\n            /\\r\\n\\r\\n$/\n        ).test(xhr.responseText), xhr.responseText);\n        onError(null, opt);\n    });\n};\n\nlocal.testCase_ajaxProgressUpdate_default = function (opt, onError) {\n/*\n * this function will test ajaxProgressUpdate's default handling-behavior\n */\n    opt = 0;\n    local.testMock([\n        [\n            local, {\n                ajaxProgressCounter: 0,\n                ajaxProgressState: 0\n            }\n        ], [\n            globalThis, {\n                setTimeout: function (fnc) {\n                    opt += 1;\n                    local.ajaxProgressState = opt % 3;\n                    fnc();\n                }\n            }\n        ]\n    ], function (onError) {\n        // update ajax-progress\n        local.ajaxProgressUpdate();\n        // validate data\n        local.assertJsonEqual(local.ajaxProgressCounter, 0);\n        local.assertJsonEqual(local.ajaxProgressState, 2);\n        // update ajax-progress\n        local.ajaxProgressUpdate();\n        // validate data\n        local.assertJsonEqual(local.ajaxProgressCounter, 0);\n        local.assertJsonEqual(local.ajaxProgressState, 1);\n        // update ajax-progress\n        local.ajaxProgressUpdate();\n        // validate data\n        local.assertJsonEqual(local.ajaxProgressCounter, 0);\n        local.assertJsonEqual(local.ajaxProgressState, 0);\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_ajax_cache = function (opt, onError) {\n/*\n * this function will test ajax's cache handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = {};\n    local.onNext(opt, function (err, data) {\n        switch (opt.modeNext) {\n        case 1:\n            // test http GET handling-behavior\n            local.ajax({\n                url: \"assets.hello.txt\"\n            }, opt.onNext);\n            break;\n        case 2:\n            // validate responseText\n            local.assertJsonEqual(data.responseText, local.stringHelloEmoji);\n            // test http GET 304 cache handling-behavior\n            local.ajax({\n                headers: {\n                    \"If-Modified-Since\": (\n                        new Date(Date.now() + 0xffff).toUTCString()\n                    )\n                },\n                url: \"assets.hello.txt\"\n            }, opt.onNext);\n            break;\n        case 3:\n            // validate statusCode\n            local.assertJsonEqual(data.statusCode, 304);\n            opt.onNext();\n            break;\n        default:\n            onError(err, opt);\n        }\n    });\n    opt.modeNext = 0;\n    opt.onNext();\n};\n\nlocal.testCase_ajax_default = function (opt, onError) {\n/*\n * this function will test ajax's default handling-behavior\n */\n    var onParallel;\n    onParallel = local.onParallel(onError);\n    onParallel.counter += 1;\n\n    // test ajax's abort handling-behavior\n    onParallel.counter += 1;\n    local.onParallelList({\n        list: [\n            \"\",\n            \"arraybuffer\",\n            \"blob\",\n            \"text\"\n        ]\n    }, function (responseType, onParallel) {\n        responseType = responseType.elem;\n        onParallel.counter += 1;\n        local.ajax({\n            data: (\n                responseType === \"arraybuffer\"\n                // test POST buffer-data handling-behavior\n                ? new TextEncoder().encode(local.stringHelloEmoji)\n                : responseType === \"blob\"\n                // test POST blob-data handling-behavior\n                ? new local.Blob([\n                    \"\",\n                    new Uint8Array(0),\n                    local.stringHelloEmoji\n                ])\n                // test POST string-data handling-behavior\n                : local.stringHelloEmoji\n            ),\n            method: \"POST\",\n            // test nodejs-res handling-behavior\n            responseType: responseType.replace(\"blob\", \"arraybuffer\"),\n            url: \"/test.body\"\n        }, function (err, xhr) {\n            // validate no err occurred\n            local.assertThrow(!err, err);\n            // validate statusCode\n            local.assertJsonEqual(xhr.statusCode, 200);\n            // validate responseText\n            switch (responseType) {\n            case \"arraybuffer\":\n            case \"blob\":\n                local.assertJsonEqual(xhr.responseBuffer.byteLength, 11);\n                local.assertJsonEqual(Array.from(xhr.responseBuffer), [\n                    0x68,\n                    0x65,\n                    0x6c,\n                    0x6c,\n                    0x6f,\n                    0x20,\n                    0xf0,\n                    0x9f,\n                    0x98,\n                    0x81,\n                    0x0a\n                ]);\n                break;\n            default:\n                local.assertJsonEqual(xhr.responseText, local.stringHelloEmoji);\n            }\n            onParallel(null, opt);\n        });\n    }, onParallel);\n\n    // test ajax's data handling-behavior\n    onParallel.counter += 1;\n    opt = local.ajax({\n        url: \"/test.timeout\"\n    }, function (err, xhr) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        // validate statusCode\n        local.assertJsonEqual(xhr.statusCode, 500);\n        onParallel(null, opt);\n    });\n    // test multiple-callback handling-behavior\n    opt.onEvent({\n        type: \"abort\"\n    });\n    opt.abort();\n    opt.abort();\n\n    // test ajax's echo handling-behavior\n    onParallel.counter += 1;\n    local.ajax({\n        _aa: \"aa\",\n        aa: \"aa\",\n        data: local.stringHelloEmoji,\n        // test req-header handling-behavior\n        headers: {\n            \"X-Req-Header-Test\": \"aa\"\n        },\n        method: \"POST\",\n        // test modeDebug handling-behavior\n        modeDebug: true,\n        url: \"/test.echo\"\n    }, function (err, xhr) {\n        // validate no err occurred\n        local.assertThrow(!err, err);\n        // validate statusCode\n        local.assertJsonEqual(xhr.statusCode, 200);\n        // validate resHeaders\n        local.assertJsonEqual(xhr.resHeaders[\"x-res-header-test\"], \"bb\");\n        // validate responseText\n        local.assertThrow((\n            /\\r\\nhello\\u0020\\ud83d\\ude01\\n$/\n        ).test(xhr.responseText), xhr.responseText);\n        local.assertThrow((\n            /\\r\\nx-req-header-test:\\u0020aa\\r\\n/\n        ).test(xhr.responseText), xhr.responseText);\n        // validate properties\n        local.assertJsonEqual(xhr._aa, undefined);\n        local.assertJsonEqual(xhr.aa, \"aa\");\n        onParallel(null, opt);\n    });\n\n    // test ajax's err handling-behavior\n    onParallel.counter += 1;\n    local.onParallelList({\n        list: [\n            {\n                // test 404-not-found handling-behavior\n                url: \"/test.err-404\"\n            }, {\n                // test 500-internal-server-error handling-behavior\n                url: \"/test.err-500\"\n            }, {\n                // test undefined-status-code handling-behavior\n                url: \"/test.err-undefined\"\n            }, {\n                // test corsForwardProxyHost handling-behavior\n                corsForwardProxyHost: \"https://undefined:0\",\n                location: {\n                    host: \"undefined.github.io\"\n                },\n                timeout: 1,\n                // test undefined-https-url handling-behavior\n                url: \"https://undefined:0\"\n            }\n        ]\n    }, function (option2, onParallel) {\n        onParallel.counter += 1;\n        local.ajax(option2.elem, function (err) {\n            // validate err occurred\n            local.assertThrow(err, err);\n            onParallel(null, opt);\n        });\n    }, onParallel);\n\n    // test ajax's file handling-behavior\n    onParallel.counter += 1;\n    local.ajax({\n        url: \"LICENSE\"\n    }, function (err, xhr) {\n        // validate no err occurred\n        local.assertThrow(!err, err);\n        // validate statusCode\n        local.assertJsonEqual(xhr.statusCode, 200);\n        // validate responseText\n        local.assertThrow(xhr.responseText.indexOf(\n            \"MIT License (https://opensource.org/licenses/MIT)\\n\\n\"\n        ) === 0, xhr.data);\n        onParallel(null, opt);\n    });\n\n    // test ajax's standalone handling-behavior\n    onParallel.counter += 1;\n    local.testMock([\n        [\n            local, {\n                utility2: null\n            }\n        ]\n    ], function (onError) {\n        [\n            \"\", \"arraybuffer\"\n        ].forEach(function (responseType) {\n            // test default handling-behavior\n            onParallel.counter += 1;\n            local.ajax({\n                responseType,\n                url: (\n                    local.isBrowser\n                    ? location.href\n                    : local.serverLocalHost\n                )\n            }, function (err, xhr) {\n                // validate no err occurred\n                local.assertThrow(!err, err);\n                // validate statusCode\n                local.assertJsonEqual(xhr.statusCode, 200);\n                onParallel();\n            });\n            // test err handling-behavior\n            onParallel.counter += 1;\n            local.ajax({\n                responseType,\n                undefined,\n                url: (\n                    local.isBrowser\n                    ? location.href.replace((\n                        /\\?.*$/\n                    ), \"\")\n                    : local.serverLocalHost\n                ) + \"/undefined\"\n            }, function (err, xhr) {\n                // validate err occurred\n                local.assertThrow(err, err);\n                // validate statusCode\n                local.assertJsonEqual(xhr.statusCode, 404);\n                onParallel();\n            });\n        });\n        onError(null, opt);\n    }, onParallel);\n    onParallel();\n\n    // test ajax's timeout handling-behavior\n    onParallel.counter += 1;\n    setTimeout(function () {\n        local.ajax({\n            timeout: 1,\n            url: \"/test.timeout\"\n        }, function (err, xhr) {\n            // validate err occurred\n            local.assertThrow(err, err);\n            // validate statusCode\n            local.assertJsonEqual(xhr.statusCode, 500);\n            onParallel(null, opt);\n        });\n    }, 1000);\n};\n\nlocal.testCase_assertXxx_default = function (opt, onError) {\n/*\n * this function will test assertXxx's default handling-behavior\n */\n    // test assertion passed\n    local.assertThrow(true, true);\n    // test assertion failed with undefined message\n    local.tryCatchOnError(function () {\n        local.assertThrow(null);\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        // validate err.message\n        local.assertJsonEqual(err.message, \"\");\n    });\n    // test assertion failed with string message\n    local.tryCatchOnError(function () {\n        local.assertThrow(null, \"aa\");\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        // validate err.message\n        local.assertJsonEqual(err.message, \"aa\");\n    });\n    // test assertion failed with errObj\n    local.tryCatchOnError(function () {\n        local.assertThrow(null, local.errDefault);\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n    });\n    // test assertion failed with json object\n    local.tryCatchOnError(function () {\n        local.assertThrow(null, {\n            aa: 1\n        });\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        // validate err.message\n        local.assertJsonEqual(err.message, \"{\\n    \\\"aa\\\": 1\\n}\");\n    });\n    [\n        \"\", 0, false, null, undefined\n    ].forEach(function (aa, ii) {\n        [\n            \"\", 0, false, null, undefined\n        ].forEach(function (bb, jj) {\n            if (ii === jj) {\n                // test assertJsonEqual's handling-behavior\n                local.assertJsonEqual(aa, bb);\n            } else {\n                // test assertJsonNotEqual's handling-behavior\n                local.assertJsonNotEqual(aa, bb);\n            }\n        });\n    });\n    onError(null, opt);\n};\n\nlocal.testCase_base64Xxx_default = function (opt, onError) {\n/*\n * this function will test base64Xxx's default handling-behavior\n */\n    opt = {};\n    opt.base64 = local.base64FromBuffer(\n        local.stringCharsetAscii + local.stringHelloEmoji\n    );\n    // test null-case handling-behavior\n    local.assertJsonEqual(local.base64FromBuffer(), \"\");\n    local.assertJsonEqual(local.bufferToUtf8(local.base64ToBuffer()), \"\");\n    local.assertJsonEqual(local.base64ToUtf8(), \"\");\n    local.assertJsonEqual(local.base64FromBuffer(local.base64ToBuffer()), \"\");\n    local.assertJsonEqual(local.base64FromBuffer(local.base64ToUtf8()), \"\");\n    // test identity handling-behavior\n    local.assertJsonEqual(\n        local.base64FromBuffer(local.base64ToBuffer(opt.base64)),\n        opt.base64\n    );\n    local.assertJsonEqual(\n        local.base64FromBuffer(local.base64ToUtf8(opt.base64)),\n        opt.base64\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_blobRead_default = function (opt, onError) {\n/*\n * this function will test blobRead's default handling-behavior\n */\n    var onParallel;\n    onParallel = local.onParallel(onError);\n    onParallel.counter += 1;\n    // test data handling-behavior\n    onParallel.counter += 1;\n    local.blobRead(new local.Blob([\n        \"\",\n        \"aa\",\n        \"bb\",\n        new Uint8Array(0),\n        local.stringHelloEmoji\n    ]), function (err, data) {\n        // validate no err occurred\n        local.assertThrow(!err, err);\n        // validate data\n        local.assertJsonEqual(\n            local.bufferToUtf8(data),\n            \"aabbhello \\ud83d\\ude01\\n\"\n        );\n        onParallel(null, opt);\n    });\n    if (!local.isBrowser) {\n        onParallel(null, opt);\n        return;\n    }\n    // test err handling-behavior\n    onParallel.counter += 1;\n    local.testMock([\n        [\n            FileReader.prototype, {\n                readAsArrayBuffer: function () {\n                    this.onabort({\n                        type: \"abort\"\n                    });\n                    this.onerror({\n                        type: \"error\"\n                    });\n                }\n            }\n        ]\n    ], function (onError) {\n        local.blobRead(null, function (err) {\n            // validate err occurred\n            local.assertThrow(err, err);\n        });\n        onError(null, opt);\n    }, onParallel);\n    onParallel();\n};\n\nlocal.testCase_browserTest_electron = function (opt, onError) {\n/*\n * this function will test browserTest's electron handling-behavior\n */\n    opt = function (aa, bb, cc) {\n        [\n            aa, bb, cc\n        ].forEach(function (fnc, ii) {\n            if (typeof fnc === \"function\") {\n                fnc(ii && opt);\n                opt.onNext(null, opt);\n                opt.utility2_testReportSave();\n            }\n        });\n        return opt;\n    };\n    [\n        \"BrowserWindow\",\n        \"addEventListener\",\n        \"app\",\n        \"browserWindow\",\n        \"capturePage\",\n        \"document\",\n        \"documentElement\",\n        \"electron\",\n        \"fileCoverage\",\n        \"fileElectronHtml\",\n        \"fileScreenshot\",\n        \"fileTestReport\",\n        \"fs\",\n        \"ipcRenderer\",\n        \"loadURL\",\n        \"modeCoverageMerge\",\n        \"on\",\n        \"once\",\n        \"process\",\n        \"prototype\",\n        \"rename\",\n        \"send\",\n        \"toPNG\",\n        \"unref\",\n        \"window\",\n        \"writeFile\"\n    ].forEach(function (key) {\n        opt[key] = (\n            key.indexOf(\"file\") === 0\n            ? \"undefined\"\n            : opt\n        );\n    });\n    opt.ipcMain = {\n        on: function (_, fnc) {\n            [\"html\", \"testReport\", \"undefined\"].forEach(function (type) {\n                [\n                    \"<div></div>\",\n                    null,\n                    {}, {\n                        testPlatformList: [\n                            {}\n                        ]\n                    }, {\n                        coverage: {},\n                        testPlatformList: [\n                            {}\n                        ]\n                    }\n                ].forEach(function (data) {\n                    opt.isDoneTestReport = null;\n                    fnc(_, type, data);\n                });\n            });\n        }\n    };\n    opt.utility2_testReportSave = local.nop;\n    local.testMock([\n        [\n            globalThis, {\n                setTimeout: opt,\n                utility2_testReport: null\n            }\n        ], [\n            local, {\n                fs: opt,\n                fsReadFileOrEmptyStringSync: function () {\n                    return \"\";\n                },\n                fsWriteFileWithMkdirpSync: opt,\n                onParallel: opt\n            }\n        ]\n    ], function (onError) {\n        [\n            \"test\", \"undefined\"\n        ].forEach(function (modeBrowserTest) {\n            [\n                1, 10, 11, 20, 100\n            ].forEach(function (modeNext) {\n                opt.modeBrowserTest = modeBrowserTest;\n                opt.modeNext = modeNext;\n                switch (modeNext) {\n                case 100:\n                    local.tryCatchOnError(function () {\n                        local.browserTest({\n                            modeNext\n                        }, opt);\n                    }, local.nop);\n                    break;\n                default:\n                    local.browserTest(opt, opt);\n                }\n            });\n        });\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_browserTest_screenshot = function (opt, onError) {\n/*\n * this function will test browserTest's screenshot handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.browserTest({\n        modeBrowserTest: \"screenshot\",\n        timeoutDefault: 20000,\n        url: \"tmp/build/test-report.html\"\n    }, onError);\n};\n\nlocal.testCase_bufferIndexOfSubBuffer_default = function (opt, onError) {\n/*\n * this function will test bufferIndexOfSubBuffer's default handling-behavior\n */\n[\n    {\n        buffer: \"\",\n        subBuffer: \"\",\n        validate: 0\n    }, {\n        buffer: \"\",\n        subBuffer: \"aa\",\n        validate: -1\n    }, {\n        buffer: \"aa\",\n        subBuffer: \"\",\n        validate: 0\n    }, {\n        buffer: \"aa\",\n        subBuffer: \"aa\",\n        validate: 0\n    }, {\n        buffer: \"aa\",\n        subBuffer: \"bb\",\n        validate: -1\n    }, {\n        buffer: \"aaaa\",\n        subBuffer: \"aa\",\n        validate: 0\n    }, {\n        buffer: \"aabb\",\n        subBuffer: \"aa\",\n        validate: 0\n    }, {\n        buffer: \"aabb\",\n        subBuffer: \"bb\",\n        validate: 2\n    }, {\n        buffer: \"aabbaa\",\n        subBuffer: \"aa\",\n        validate: 0\n    }, {\n        buffer: \"aabbaa\",\n        subBuffer: \"bb\",\n        validate: 2\n    }, {\n        buffer: \"aabbaa\",\n        subBuffer: \"ba\",\n        validate: 3\n    }\n].forEach(function (opt) {\n    local.assertJsonEqual(local.bufferIndexOfSubBuffer(\n        new TextEncoder().encode(opt.buffer),\n        new TextEncoder().encode(opt.subBuffer),\n        opt.fromIndex\n    ), opt.validate);\n});\nonError(null, opt);\n};\n\nlocal.testCase_bufferValidateAndCoerce_err = function (opt, onError) {\n/*\n * this function will test bufferValidateAndCoerce's err handling-behavior\n */\n    [[], 0, {}].forEach(function (elem) {\n        opt = null;\n        try {\n            local.bufferValidateAndCoerce(elem);\n        } catch (errCaught) {\n            opt = errCaught;\n        }\n        // validate err occurred\n        local.assertThrow(opt, elem);\n    });\n    onError(null, opt);\n};\n\nlocal.testCase_buildApidoc_default = function (opt, onError) {\n/*\n * this function will test buildApidoc's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    // test $npm_config_mode_coverage=all handling-behavior\n    local.testMock([\n        [\n            local.env, {\n                npm_config_mode_coverage: \"all\"\n            }\n        ]\n    ], function (onError) {\n        local.buildApidoc(null, onError);\n    }, local.onErrorThrow);\n    local.buildApidoc({\n        blacklistDict: {}\n    }, onError);\n};\n\nlocal.testCase_buildApp_default = function (opt, onError) {\n/*\n * this function will test buildApp's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.testCase_buildReadme_default(opt, local.onErrorThrow);\n    local.testCase_buildLib_default(opt, local.onErrorThrow);\n    local.testCase_buildTest_default(opt, local.onErrorThrow);\n    local.buildApp({\n        assetsList: [\n            {\n                file: \"/assets.hello.txt\",\n                url: \"/assets.hello.txt\"\n            }, {\n                file: \"/assets.script_only.html\",\n                url: \"/assets.script_only.html\"\n            }, {\n                file: \"/assets.utility2.lib.db.js\",\n                url: \"/assets.utility2.lib.db.js\"\n            }, {\n                file: \"/assets.utility2.lib.istanbul.js\",\n                url: \"/assets.utility2.lib.istanbul.js\"\n            }, {\n                file: \"/assets.utility2.lib.jslint.js\",\n                url: \"/assets.utility2.lib.jslint.js\"\n            }, {\n                file: \"/assets.utility2.lib.marked.js\",\n                url: \"/assets.utility2.lib.marked.js\"\n            }, {\n                file: \"/assets.utility2.lib.sjcl.js\",\n                url: \"/assets.utility2.lib.sjcl.js\"\n            }, {\n                file: \"/assets.utility2.rollup.js\",\n                url: \"/assets.utility2.rollup.js\"\n            }\n        ]\n    }, onError);\n};\n\nlocal.testCase_buildLib_default = function (opt, onError) {\n/*\n * this function will test buildLib's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.testMock([\n        [\n            local, {\n                // test duplicate local function handling-behavior\n                fsReadFileOrEmptyStringSync: function () {\n                    return (\n                        \"local.nop = function () {\\n\"\n                        + \"/*\\n\"\n                        + \" * this function will do nothing\\n\"\n                        + \" */\\n\"\n                        + \"    return;\\n\"\n                        + \"};\\n\"\n                        + \"local.nop = function () {\\n\"\n                        + \"/*\\n\"\n                        + \" * this function will do nothing\\n\"\n                        + \" */\\n\"\n                        + \"    return;\\n\"\n                        + \"};\\n\"\n                    );\n                },\n                templateRenderMyApp: function () {\n                    return local.assetsDict[\"/assets.my_app.template.js\"];\n                }\n            }\n        ], [\n            local.fs, {\n                // test customize-local handling-behavior\n                existsSync: function () {\n                    return true;\n                },\n                writeFileSync: local.nop\n            }\n        ]\n    ], function (onError) {\n        local.buildLib({}, onError);\n    }, local.onErrorThrow);\n    local.buildLib({}, onError);\n};\n\nlocal.testCase_buildReadme_default = function (opt, onError) {\n/*\n * this function will test buildReadme's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = {};\n    // test shNpmTestPublished handling-behavior\n    opt.dataFrom = local.fs.readFileSync(\"README.md\", \"utf8\").replace(\n        \"#\\u0021! shNpmTestPublished\",\n        \"shNpmTestPublished\"\n    );\n    opt = {};\n    opt.customize = function () {\n        // search-and-replace - customize dataTo\n        [\n            // customize quickstart-example-js\n            (\n                /#\\u0020quickstart\\u0020example.js[\\S\\s]*?istanbul\\u0020instrument\\u0020in\\u0020package/\n            ),\n            // customize quickstart-footer\n            (\n                />download\\u0020standalone\\u0020app<[^`]*?\"utility2FooterDiv\"/\n            ), (\n                /```[^`]*?\\n#\\u0020extra\\u0020screenshots/\n            ),\n            // customize build-script\n            (\n                /\\n#\\u0020internal\\u0020build\\u0020script\\n[\\S\\s]*?\\nshBuildCi\\n/\n            )\n        ].forEach(function (rgx) {\n            opt.dataFrom.replace(rgx, function (match0) {\n                opt.dataTo = opt.dataTo.replace(rgx, match0);\n            });\n        });\n    };\n    local.buildReadme(opt, onError);\n};\n\nlocal.testCase_buildXxx_default = function (opt, onError) {\n/*\n * this function will test buildXxx's default handling-behavior\n */\n    local.testMock([\n        [\n            local, {\n                assetsDict: {\n                    \"/\": \"\"\n                },\n                browserTest: local.nop,\n                buildApidoc: local.nop,\n                buildLib: local.nop,\n                buildReadme: local.nop,\n                buildTest: local.nop,\n                testCase_buildReadme_default: local.nop,\n                testCase_buildLib_default: local.nop,\n                testCase_buildTest_default: local.nop\n            }\n        ]\n    ], function (onError) {\n        local._testCase_buildApidoc_default(null, local.nop);\n        local._testCase_buildApp_default(null, local.nop);\n        local._testCase_buildLib_default(null, local.nop);\n        local._testCase_buildReadme_default(null, local.nop);\n        local._testCase_buildTest_default(null, local.nop);\n        local._testCase_webpage_default(null, local.nop);\n        local.assetsDict[\"/\"] = \"<script src=\\\"assets.test.js\\\"></script>\";\n        local._testCase_webpage_default(null, local.nop);\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_childProcessSpawnWithTimeout_default = function (\n    opt,\n    onError\n) {\n/*\n * this function will test\n * childProcessSpawnWithTimeout's default handling-behavior\n */\n    var onParallel;\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = {};\n    onParallel = local.onParallel(onError);\n    onParallel.counter += 1;\n    // test default handling-behavior\n    onParallel.counter += 1;\n    local.childProcessSpawnWithTimeout(\"ls\").on(\n        \"error\",\n        onParallel\n    ).on(\"exit\", function (exitCode, signal) {\n        // validate exitCode\n        local.assertJsonEqual(exitCode, 0);\n        // validate signal\n        local.assertJsonEqual(signal, null);\n        onParallel(null, opt);\n    });\n    // test timeout handling-behavior\n    onParallel.counter += 1;\n    local.testMock([\n        [\n            local, {\n                timeoutDefault: 1000\n            }\n        ]\n    ], function (onError) {\n        opt.childProcess = (\n            local.childProcessSpawnWithTimeout(\"sleep\", [\n                5000\n            ])\n        );\n        onError(null, opt);\n    }, local.onErrorThrow);\n    opt.childProcess\n    .on(\"error\", onParallel)\n    .on(\"exit\", function (exitCode, signal) {\n        // validate exitCode\n        local.assertJsonEqual(exitCode, null);\n        // validate signal\n        local.assertJsonEqual(signal, \"SIGKILL\");\n        onParallel(null, opt);\n    });\n    onParallel(null, opt);\n};\n\nlocal.testCase_childProcessSpawnWithUtility2_err = function (\n    opt,\n    onError\n) {\n/*\n * this function will test\n * childProcessSpawnWithTimeout's err handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.testMock([\n        // test __dirname handling-behavior\n        [\n            process.env, {\n                npm_config_dir_utility2: \"\"\n            }\n        ]\n    ], function (onError) {\n        local.local.childProcessSpawnWithUtility2(\"undefined\", function (err) {\n            // validate err occurred\n            local.assertThrow(err, err);\n        });\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_cliRun_default = function (opt, onError) {\n/*\n * this function will test cliRun's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.testMock([\n        [\n            local, {\n                replStart: null\n            }\n        ], [\n            local.cliDict, {\n                _default: local.nop,\n                _help: null\n            }\n        ], [\n            local.repl, {\n                start: local.nop\n            }\n        ], [\n            local.vm, {\n                runInThisContext: local.nop\n            }\n        ], [\n            process, {\n                argv: []\n            }\n        ]\n    ], function (onError) {\n        // test default handling-behavior\n        local.cliRun({\n            rgxComment: (\n                /^/\n            )\n        });\n        // test builtin handling-behavior\n        [\n            \"--eval\",\n            \"--help\",\n            \"--interactive\",\n            \"--version\",\n            \"undefined\"\n        ].forEach(function (key) {\n            process.argv[2] = key;\n            local.cliRun();\n        });\n        // test err handling-behavior\n        local.cliDict._default = null;\n        local.cliDict._help = null;\n        local.tryCatchOnError(local.cliRun, local.nop);\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_corsBackendHostInject_default = function (opt, onError) {\n/*\n * this function will corsBackendHostInject's default handling-behavior\n */\n    // test null-case handling-behavior\n    local.assertJsonEqual(local.corsBackendHostInject(), undefined);\n    // test override-all handling-behavior\n    local.assertJsonEqual(local.corsBackendHostInject(\n        \"cc.com\",\n        \"aa-alpha.bb.com\",\n        null,\n        {\n            host: \"github.io\",\n            pathname: \"/build..beta..travis-ci.org/\"\n        }\n    ), \"aa-beta.bb.com\");\n    // test override-rgx handling-behavior\n    local.assertJsonEqual(local.corsBackendHostInject(\n        \"cc/dd\",\n        \"aa-alpha.bb.com/\",\n        (\n            /(^cc\\/)/m\n        ),\n        {\n            host: \"github.io\",\n            pathname: \"/build..beta..travis-ci.org/\"\n        }\n    ), \"aa-beta.bb.com/cc/dd\");\n    onError(null, opt);\n};\n\nlocal.testCase_corsForwardProxyHostIfNeeded_default = function (\n    opt,\n    onError\n) {\n/*\n * this function will corsForwardProxyHostIfNeeded's default handling-behavior\n */\n    if (!local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.assertThrow(local.corsForwardProxyHostIfNeeded({\n        location: {\n            host: \"undefined.github.io\"\n        },\n        url: \"https://example.com\"\n    }).indexOf(\".herokuapp.com\") >= 0);\n    onError(null, opt);\n};\n\n/* istanbul ignore next */\nlocal.testCase_cryptoAesXxxCbcRawXxx_default = function (opt, onError) {\n/*\n * this function will cryptoAesXxxCbcRawXxx's default handling-behavior\n */\n    if (!local.nop()) {\n        onError();\n        return;\n    }\n    opt = {};\n    local.onNext(opt, function (err, data) {\n        switch (opt.modeNext) {\n        case 1:\n            // encrypt data\n            opt.data = new TextEncoder().encode(\"aa\");\n            opt.key = \"0123456789abcdef0123456789abcdef\";\n            opt.mode = null;\n            local.cryptoAesXxxCbcRawEncrypt(opt, opt.onNext);\n            break;\n        case 2:\n            // decrypt data\n            opt.data = data.buffer;\n            local.cryptoAesXxxCbcRawDecrypt(opt, opt.onNext);\n            break;\n        case 3:\n            // validate data\n            local.assertJsonEqual(local.bufferToUtf8(data), \"aa\");\n            opt.onNext();\n            break;\n        case 4:\n            // encrypt data - base64\n            opt.data = new TextEncoder().encode(\"aa\");\n            opt.key = (\n                \"0123456789abcdef0123456789abcdef\"\n                + \"0123456789abcdef0123456789abcdef\"\n            );\n            opt.mode = \"base64\";\n            local.cryptoAesXxxCbcRawEncrypt(opt, opt.onNext);\n            break;\n        case 5:\n            // decrypt data - base64\n            opt.data = data;\n            local.cryptoAesXxxCbcRawDecrypt(opt, opt.onNext);\n            break;\n        case 6:\n            // validate data\n            local.assertJsonEqual(local.bufferToUtf8(data), \"aa\");\n            opt.onNext();\n            break;\n        default:\n            onError(err, opt);\n        }\n    });\n    opt.modeNext = 0;\n    opt.onNext();\n};\n\nlocal.testCase_domFragmentRender_default = function (opt, onError) {\n/*\n * this function will test domFragmentRender's default handling-behavior\n */\n    if (!local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.assertJsonEqual(local.domFragmentRender(\"<div>{{value}}</div>\", {\n        value: \"aa\"\n    }).children[0].outerHTML, \"<div>aa</div>\");\n    onError(null, opt);\n};\n\nlocal.testCase_exit_err = function (opt, onError) {\n/*\n * this function will test exit's err handling-behavior\n */\n    local.exit(\"invalid-exitCode\");\n    onError(null, opt);\n};\n\nlocal.testCase_fsWriteFileWithMkdirpSync_default = function (opt, onError) {\n/*\n * this function will test\n * fsWriteFileWithMkdirpSync's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.fsRmrSync(\"tmp/build/testCase_fsWriteFileWithMkdirpSync_default\");\n    // validate data\n    local.assertJsonEqual(local.fsReadFileOrEmptyStringSync(\n        \"tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt\",\n        \"utf8\"\n    ), \"\");\n    local.fsWriteFileWithMkdirpSync(\n        \"tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt\",\n        \"aa\"\n    );\n    // validate data\n    local.assertJsonEqual(local.fsReadFileOrEmptyStringSync(\n        \"tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt\",\n        \"utf8\"\n    ), \"aa\");\n    onError(null, opt);\n};\n\nlocal.testCase_isNullOrUndefined_default = function (opt, onError) {\n/*\n * this function will test isNullOrUndefined's default handling-behavior\n */\n    // validate data\n    local.assertJsonEqual(local.isNullOrUndefined(null), true);\n    // validate data\n    local.assertJsonEqual(local.isNullOrUndefined(undefined), true);\n    // validate data\n    local.assertJsonEqual(local.isNullOrUndefined(false), false);\n    onError(null, opt);\n};\n\nlocal.testCase_jsonCopy_default = function (opt, onError) {\n/*\n * this function will test jsonCopy's default handling-behavior\n */\n// test various data-type handling-behavior\n[\n    undefined, null, false, true, 0, 1, 1.5, \"a\"\n].forEach(function (elem) {\n    local.assertJsonEqual(local.jsonCopy(elem), elem);\n});\nonError(null, opt);\n};\n\nlocal.testCase_jsonStringifyOrdered_default = function (opt, onError) {\n/*\n * this function will test jsonStringifyOrdered's default handling-behavior\n */\n    // test data-type handling-behavior\n    local.identity([\n        undefined,\n        null,\n        false,\n        true,\n        0,\n        1,\n        1.5,\n        \"a\",\n        {},\n        []\n    ]).forEach(function (data) {\n        local.assertJsonEqual(\n            local.jsonStringifyOrdered(data),\n            JSON.stringify(data)\n        );\n    });\n    // test data-ordering handling-behavior\n    opt = {\n        // test nested dict handling-behavior\n        ff: {\n            hh: 2,\n            gg: 1\n        },\n        // test nested array handling-behavior\n        ee: [\n            1, null, undefined\n        ],\n        dd: local.nop,\n        cc: undefined,\n        bb: null,\n        aa: 1\n    };\n    // test circular-reference handling-behavior\n    opt.zz = opt;\n    local.assertJsonEqual(\n        opt,\n        {\n            aa: 1,\n            bb: null,\n            ee: [\n                1, null, null\n            ],\n            ff: {\n                gg: 1,\n                hh: 2\n            }\n        }\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_jwtAes256GcmXxx_default = function (opt, onError) {\n/*\n * this function will test jwtAes256GcmXxx's default handling-behavior\n */\n    opt = {};\n    opt.key = local.jwtAes256KeyCreate();\n    // use canonical example at https://jwt.io/\n    opt.data = JSON.parse(local.jsonStringifyOrdered(local.normalizeJwt({\n        sub: \"1234567890\",\n        name: \"John Doe\",\n        admin: true\n    })));\n    // encrypt token\n    opt.token = local.jwtAes256GcmEncrypt(opt.data, opt.key);\n    // validate encrypted-token\n    local.assertJsonEqual(\n        local.jwtAes256GcmDecrypt(opt.token, opt.key),\n        opt.data\n    );\n    // test decryption-failed handling-behavior\n    local.assertJsonEqual(local.jwtAes256GcmDecrypt(opt.token, null), {});\n    onError(null, opt);\n};\n\nlocal.testCase_jwtHs256Xxx_default = function (opt, onError) {\n/*\n * this function will test jwtHs256Xxx's default handling-behavior\n */\n    opt = {};\n    opt.key = local.normalizeJwtBase64Url(local.base64FromBuffer(\"secret\"));\n    // use canonical example at https://jwt.io/\n    opt.data = {\n        sub: \"1234567890\",\n        name: \"John Doe\",\n        admin: true\n    };\n    opt.token = local.jwtHs256Encode(opt.data, opt.key);\n    // validate encoded-token\n    local.assertJsonEqual(\n        opt.token,\n        (\n            \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\"\n            + \".eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZ\"\n            + \"SI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9\"\n            + \".TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\"\n        )\n    );\n    // validate decoded-data\n    local.assertJsonEqual(\n        local.jwtHs256Decode(opt.token, opt.key),\n        {\n            admin: true,\n            name: \"John Doe\",\n            sub: \"1234567890\"\n        }\n    );\n    // test decoding-failed handling-behavior\n    local.assertJsonEqual(local.jwtHs256Decode(opt.token, \"undefined\"), {});\n    onError(null, opt);\n};\n\nlocal.testCase_libUtility2Js_standalone = function (opt, onError) {\n/*\n * this function will test lib.utility2.js's standalone handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.fs.writeFileSync(\"tmp/lib.utility2.js\", local.fs.readFileSync(\n        \"lib.utility2.js\",\n        \"utf8\"\n    ).replace(\"/* istanbul instrument in package utility2 */\", \"\"));\n    require(\"./tmp/lib.utility2.js\");\n    onError(null, opt);\n};\n\nlocal.testCase_listGetElementRandom_default = function (opt, onError) {\n/*\n * this function will test listGetRandom's default handling-behavior\n */\n    opt = {};\n    // init list\n    opt.list = [\n        \"aa\", \"bb\", \"cc\", \"dd\"\n    ];\n    opt.elemDict = {};\n    // get 1000 random elem from list\n    opt.ii = 0;\n    while (opt.ii < 1000) {\n        opt.elemDict[local.listGetElementRandom(opt.list)] = true;\n        opt.ii += 1;\n    }\n    // validate all elem were retrieved from list\n    local.assertJsonEqual(\n        Object.keys(opt.elemDict).sort(),\n        [\n            \"aa\", \"bb\", \"cc\", \"dd\"\n        ]\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_listShuffle_default = function (opt, onError) {\n/*\n * this function will test listShuffle's default handling-behavior\n */\n    opt = {};\n    // init list\n    opt.list = \"[0,1]\";\n    // shuffle list 100 times\n    opt.ii = 0;\n    while (opt.ii < 100) {\n        opt.listShuffled = JSON.stringify(\n            local.listShuffle(JSON.parse(opt.list))\n        );\n        // validate shuffled list\n        local.assertJsonEqual(opt.listShuffled.length, opt.list.length);\n        opt.changed = opt.changed || opt.listShuffled !== opt.list;\n        opt.ii += 1;\n    }\n    // validate list changed at least once during the shuffle\n    local.assertThrow(opt.changed, opt);\n    onError(null, opt);\n};\n\nlocal.testCase_localStorageSetItemOrClear_default = function (\n    opt,\n    onError\n) {\n/*\n * this function will localStorageSetItemOrClear's default handling-behavior\n */\n    if (!local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.localStorageSetItemOrClear(\n        \"testCase_localStorageSetItemOrClear_default\",\n        null\n    );\n    local.assertJsonEqual(\n        localStorage.testCase_localStorageSetItemOrClear_default,\n        \"null\"\n    );\n    local.testMock([\n        [\n            localStorage, {\n                clear: null,\n                setItem: function () {\n                    throw local.errDefault;\n                }\n            }\n        ]\n    ], function (onError) {\n        localStorage.clear = onError;\n        local.localStorageSetItemOrClear(\n            \"testCase_localStorageSetItemOrClear_default\",\n            null\n        );\n    }, onError);\n};\n\nlocal.testCase_middlewareForwardProxy_default = function (opt, onError) {\n/*\n * this function will test middlewareForwardProxy's default handling-behavior\n */\n    var onParallel;\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    onParallel = local.onParallel(onError);\n    onParallel.counter += 1;\n    // test preflight-cors handling-behavior\n    onParallel.counter += 1;\n    local.ajax({\n        headers: {\n            \"access-control-request-headers\": (\n                \"forward-proxy-headers,forward-proxy-url\"\n            )\n        },\n        method: \"OPTIONS\",\n        url: \"\"\n    }, onParallel);\n    // test forward-proxy-http handling-behavior\n    onParallel.counter += 1;\n    local.ajax({\n        headers: {\n            \"forward-proxy-url\": \"/assets.hello.txt\"\n        },\n        url: \"\"\n    }, function (err, xhr) {\n        // validate no err occurred\n        local.assertThrow(!err, err);\n        // validate responseText\n        local.assertJsonEqual(xhr.responseText, local.stringHelloEmoji);\n        onParallel(null, opt, xhr);\n    });\n    // test err handling-behavior\n    onParallel.counter += 1;\n    local.ajax({\n        headers: {\n            \"forward-proxy-url\": \"https://undefined:0\"\n        },\n        url: \"\"\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        onParallel(null, opt);\n    });\n    onParallel(null, opt);\n};\n\nlocal.testCase_middlewareJsonpStateInit_assetsList = function (\n    opt,\n    onError\n) {\n/*\n * this function will middlewareJsonpStateInit's assetsList handling-behavior\n */\n    local.testMock([\n        [\n            local.env, {\n                npm_package_assetsList: \"undefined\"\n            }\n        ], [\n            local, {\n                assetsDict: {}\n            }\n        ]\n    ], function (onError) {\n        local.middlewareJsonpStateInit({\n            stateInit: true\n        });\n        // validate data\n        local.assertJsonEqual(local.assetsDict[\"/undefined\"], \"\");\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_moduleDirname_default = function (opt, onError) {\n/*\n * this function will test moduleDirname's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    // test null-case handling-behavior\n    local.assertJsonEqual(\n        local.moduleDirname(null, module.paths),\n        process.cwd()\n    );\n    // test path handling-behavior\n    local.assertJsonEqual(\n        local.moduleDirname(\".\", module.paths),\n        process.cwd()\n    );\n    local.assertJsonEqual(\n        local.moduleDirname(\"./\", module.paths),\n        process.cwd()\n    );\n    // test module-exists handling-behavior\n    opt = local.moduleDirname(\"electron-lite\", module.paths);\n    local.assertThrow((\n        /\\/electron-lite$/\n    ).test(opt), opt);\n    // test module-does-not-exist handling-behavior\n    local.assertJsonEqual(\n        local.moduleDirname(\"syntax-err\", module.paths),\n        \"\"\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_numberToRomanNumerals_default = function (opt, onError) {\n/*\n * this function will test numberToRomanNumerals's default handling-behavior\n */\n    opt = {};\n    opt.list = [\n        \"\",\n        \"I\",\n        \"II\",\n        \"III\",\n        \"IV\",\n        \"V\",\n        \"VI\",\n        \"VII\",\n        \"VIII\",\n        \"IX\",\n        \"X\",\n        \"XI\",\n        \"XII\",\n        \"XIII\",\n        \"XIV\",\n        \"XV\",\n        \"XVI\",\n        \"XVII\",\n        \"XVIII\",\n        \"XIX\",\n        \"XX\",\n        \"XXI\",\n        \"XXII\",\n        \"XXIII\",\n        \"XXIV\",\n        \"XXV\",\n        \"XXVI\",\n        \"XXVII\",\n        \"XXVIII\",\n        \"XXIX\",\n        \"XXX\",\n        \"XXXI\",\n        \"XXXII\",\n        \"XXXIII\",\n        \"XXXIV\",\n        \"XXXV\",\n        \"XXXVI\",\n        \"XXXVII\",\n        \"XXXVIII\",\n        \"XXXIX\",\n        \"XL\",\n        \"XLI\",\n        \"XLII\",\n        \"XLIII\",\n        \"XLIV\",\n        \"XLV\",\n        \"XLVI\",\n        \"XLVII\",\n        \"XLVIII\",\n        \"XLIX\",\n        \"L\",\n        \"LI\",\n        \"LII\",\n        \"LIII\",\n        \"LIV\",\n        \"LV\",\n        \"LVI\",\n        \"LVII\",\n        \"LVIII\",\n        \"LIX\",\n        \"LX\",\n        \"LXI\",\n        \"LXII\",\n        \"LXIII\",\n        \"LXIV\",\n        \"LXV\",\n        \"LXVI\",\n        \"LXVII\",\n        \"LXVIII\",\n        \"LXIX\",\n        \"LXX\",\n        \"LXXI\",\n        \"LXXII\",\n        \"LXXIII\",\n        \"LXXIV\",\n        \"LXXV\",\n        \"LXXVI\",\n        \"LXXVII\",\n        \"LXXVIII\",\n        \"LXXIX\",\n        \"LXXX\",\n        \"LXXXI\",\n        \"LXXXII\",\n        \"LXXXIII\",\n        \"LXXXIV\",\n        \"LXXXV\",\n        \"LXXXVI\",\n        \"LXXXVII\",\n        \"LXXXVIII\",\n        \"LXXXIX\",\n        \"XC\",\n        \"XCI\",\n        \"XCII\",\n        \"XCIII\",\n        \"XCIV\",\n        \"XCV\",\n        \"XCVI\",\n        \"XCVII\",\n        \"XCVIII\",\n        \"XCIX\",\n        \"C\"\n    ];\n    opt.ii = 0;\n    while (opt.ii < 10) {\n        local.assertJsonEqual(\n            local.numberToRomanNumerals(opt.ii),\n            opt.list[opt.ii]\n        );\n        opt.ii += 1;\n    }\n    onError(null, opt);\n};\n\nlocal.testCase_objectSetDefault_default = function (opt, onError) {\n/*\n * this function will test objectSetDefault's default handling-behavior\n */\n    // test null-case handling-behavior\n    local.objectSetDefault();\n    local.objectSetDefault({});\n    // test falsy handling-behavior\n    [\n        \"\", 0, false, null, undefined\n    ].forEach(function (aa) {\n        [\n            \"\", 0, false, null, undefined\n        ].forEach(function (bb) {\n            local.assertJsonEqual(\n                local.objectSetDefault({\n                    data: aa\n                }, {\n                    data: bb\n                }).data,\n                (aa === 0 || aa === false || bb === undefined)\n                ? aa\n                : bb\n            );\n        });\n    });\n    // test non-recursive handling-behavior\n    local.assertJsonEqual(local.objectSetDefault({\n        aa: 0,\n        bb: {\n            cc: 1\n        },\n        cc: {\n            dd: {}\n        },\n        dd: [\n            1, 1\n        ],\n        ee: [\n            1, 1\n        ]\n    }, {\n        aa: 2,\n        bb: {\n            dd: 2\n        },\n        cc: {\n            dd: {\n                ee: 2\n            }\n        },\n        dd: [\n            2, 2\n        ],\n        ee: {\n            ff: 2\n        }\n    // test default-depth handling-behavior\n    }, null), {\n        aa: 0,\n        bb: {\n            cc: 1\n        },\n        cc: {\n            dd: {}\n        },\n        dd: [\n            1, 1\n        ],\n        ee: [\n            1, 1\n        ]\n    });\n    // test recursive handling-behavior\n    local.assertJsonEqual(local.objectSetDefault({\n        aa: 0,\n        bb: {\n            cc: 1\n        },\n        cc: {\n            dd: {}\n        },\n        dd: [\n            1, 1\n        ],\n        ee: [\n            1, 1\n        ]\n    }, {\n        aa: 2,\n        bb: {\n            dd: 2\n        },\n        cc: {\n            dd: {\n                ee: 2\n            }\n        },\n        dd: [\n            2, 2\n        ],\n        ee: {\n            ff: 2\n        }\n    // test depth handling-behavior\n    }, 2), {\n        aa: 0,\n        bb: {\n            cc: 1,\n            dd: 2\n        },\n        cc: {\n            dd: {}\n        },\n        dd: [\n            1, 1\n        ],\n        ee: [\n            1, 1\n        ]\n    });\n    onError(null, opt);\n};\n\nlocal.testCase_objectSetOverride_default = function (opt, onError) {\n/*\n * this function will test objectSetOverride's default handling-behavior\n */\n    // test null-case handling-behavior\n    local.objectSetOverride();\n    local.objectSetOverride({});\n    // test falsy handling-behavior\n    [\n        \"\", 0, false, null, undefined\n    ].forEach(function (aa) {\n        [\n            \"\", 0, false, null, undefined\n        ].forEach(function (bb) {\n            local.assertJsonEqual(\n                local.objectSetOverride({\n                    data: aa\n                }, {\n                    data: bb\n                }).data,\n                bb === undefined\n                ? aa\n                : bb\n            );\n        });\n    });\n    // test non-recursive handling-behavior\n    local.assertJsonEqual(local.objectSetOverride({\n        aa: 1,\n        bb: {\n            cc: 1\n        },\n        cc: {\n            dd: 1\n        },\n        dd: [\n            1, 1\n        ],\n        ee: [\n            1, 1\n        ]\n    }, {\n        aa: 2,\n        bb: {\n            dd: 2\n        },\n        cc: {\n            ee: 2\n        },\n        dd: [\n            2, 2\n        ],\n        ee: {\n            ff: 2\n        }\n    // test default-depth handling-behavior\n    }, null), {\n        aa: 2,\n        bb: {\n            dd: 2\n        },\n        cc: {\n            ee: 2\n        },\n        dd: [\n            2, 2\n        ],\n        ee: {\n            ff: 2\n        }\n    });\n    // test recursive handling-behavior\n    local.assertJsonEqual(local.objectSetOverride({\n        aa: 1,\n        bb: {\n            cc: 1\n        },\n        cc: {\n            dd: 1\n        },\n        dd: [\n            1, 1\n        ],\n        ee: [\n            1, 1\n        ]\n    }, {\n        aa: 2,\n        bb: {\n            dd: 2\n        },\n        cc: {\n            ee: 2\n        },\n        dd: [\n            2, 2\n        ],\n        ee: {\n            ff: 2\n        }\n    // test depth handling-behavior\n    }, 2), {\n        aa: 2,\n        bb: {\n            cc: 1,\n            dd: 2\n        },\n        cc: {\n            dd: 1,\n            ee: 2\n        },\n        dd: [\n            2, 2\n        ],\n        ee: {\n            ff: 2\n        }\n    });\n    // test env with empty-string handling-behavior\n    local.assertJsonEqual(local.objectSetOverride(\n        local.env,\n        {\n            \"emptyString\": null\n        },\n        // test default-depth handling-behavior\n        null,\n        local.env\n    ).emptyString, \"\");\n    onError(null, opt);\n};\n\nlocal.testCase_onErrorDefault_default = function (opt, onError) {\n/*\n * this function will test onErrorDefault's default handling-behavior\n */\n    local.testMock([\n        [\n            console, {\n                error: function (arg) {\n                    opt = arg;\n                }\n            }\n        ], [\n            globalThis, {\n                __coverage__: null\n            }\n        ]\n    ], function (onError) {\n        // test no err handling-behavior\n        local.onErrorDefault();\n        // validate opt\n        local.assertThrow(!opt, opt);\n        // test err handling-behavior\n        local.onErrorDefault(local.errDefault);\n        // validate opt\n        local.assertThrow(opt, opt);\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_onErrorThrow_err = function (opt, onError) {\n/*\n * this function will test onErrorThrow's err handling-behavior\n */\n    local.tryCatchOnError(function () {\n        local.onErrorThrow(local.errDefault);\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        onError(null, opt);\n    });\n};\n\nlocal.testCase_onErrorWithStack_toString = function (opt, onError) {\n/*\n * this function will test onErrorWithStack's toString handling-behavior\n */\n    local.assertJsonEqual(\n        String(local.onErrorWithStack(local.nop)),\n        String(local.nop)\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_onFileModifiedRestart_watchFile = function (opt, onError) {\n/*\n * this function will test onFileModifiedRestart's watchFile handling-behavior\n */\n    var onParallel;\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    onParallel = local.onParallel(onError);\n    onParallel.counter += 1;\n    local.fs.stat(__filename, function (err, stat) {\n        // test default watchFile handling-behavior\n        onParallel.counter += 1;\n        local.fs.utimes(__filename, stat.atime, new Date(), onParallel);\n        // test nop watchFile handling-behavior\n        onParallel.counter += 1;\n        setTimeout(function () {\n            local.fs.utimes(__filename, stat.atime, stat.mtime, onParallel);\n        }, 1000);\n        onParallel(err, opt);\n    });\n};\n\nlocal.testCase_onNext_err = function (opt, onError) {\n/*\n * this function will test onNext's err handling-behavior\n */\n\n    opt = {};\n    opt.modeDebug = true;\n    local.onNext(opt, function () {\n        throw local.errDefault;\n    });\n    opt.modeNext = 0;\n    local.tryCatchOnError(function () {\n        opt.onNext();\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        onError(null, opt);\n    });\n};\n\nlocal.testCase_onParallelList_default = function (opt, onError) {\n/*\n * this function will test onParallelList's default handling-behavior\n */\n    opt = {};\n    local.onNext(opt, function (err) {\n        switch (opt.modeNext) {\n        case 1:\n            // test null-case handling-behavior\n            local.onParallelList({}, local.onErrorThrow, opt.onNext);\n            break;\n        case 2:\n            opt.list = [\n                null\n            ];\n            // test retryLimit handling-behavior\n            opt.retryLimit = 1;\n            local.onParallelList(opt, function (option2, onParallel) {\n                onParallel.counter += 1;\n                // test err handling-behavior\n                onParallel(local.errDefault, option2);\n                // test multiple-callback handling-behavior\n                setTimeout(onParallel, 5000);\n            }, function (err) {\n                // validate err occurred\n                local.assertThrow(err, err);\n                opt.onNext();\n            });\n            break;\n        case 3:\n            opt.data = [];\n            // test rateLimit handling-behavior\n            opt.rateLimit = 3;\n            opt.rateMax = 0;\n            // test retryLimit handling-behavior\n            opt.retryLimit = 1;\n            local.onParallelList({\n                list: [\n                    1, 2, 3, 4\n                ],\n                rateLimit: opt.rateLimit\n            }, function (option2, onParallel) {\n                onParallel.counter += 1;\n                opt.rateMax = Math.max(\n                    onParallel.counter - 1,\n                    opt.rateMax\n                );\n                // test async handling-behavior\n                setTimeout(function () {\n                    // test list-growth handling-behavior\n                    if (option2.ii === 3) {\n                        option2.list.push(5);\n                    }\n                    opt.data[option2.ii] = option2.elem;\n                    // test retry handling-behavior\n                    local.assertThrow(option2.retry < 1);\n                    onParallel(null, option2);\n                });\n            }, opt.onNext, opt.rateLimit);\n            break;\n        case 4:\n            // validate data\n            local.assertJsonEqual(opt.data, [\n                1, 2, 3, 4, 5\n            ]);\n            local.assertJsonEqual(opt.rateMax, 3);\n            opt.data = [];\n            opt.rateLimit = \"syntax-err\";\n            opt.rateMax = 0;\n            local.onParallelList({\n                list: [\n                    1, 2, 3, 4, 5\n                ],\n                rateLimit: opt.rateLimit\n            }, function (option2, onParallel) {\n                // test sync handling-behavior\n                onParallel.counter += 1;\n                opt.rateMax = Math.max(onParallel.counter, opt.rateMax);\n                opt.data[option2.ii] = option2.elem;\n                onParallel(null, opt);\n            }, opt.onNext);\n            break;\n        case 5:\n            // validate data\n            local.assertJsonEqual(opt.data, [\n                1, 2, 3, 4, 5\n            ]);\n            local.assertJsonEqual(opt.rateMax, 2);\n            opt.onNext();\n            break;\n        default:\n            onError(err, opt);\n        }\n    });\n    opt.modeNext = 0;\n    opt.onNext();\n};\n\nlocal.testCase_onParallel_default = function (opt, onError) {\n/*\n * this function will test onParallel's default handling-behavior\n */\n    var onParallel;\n    var onParallelError;\n    // test onEach handling-behavior\n    onParallel = local.onParallel(onError, function () {\n        // validate counter\n        local.assertThrow(onParallel.counter >= 0, onParallel);\n    });\n    onParallel.counter += 1;\n    // test multiple-task handling-behavior\n    onParallel.counter += 1;\n    setTimeout(function () {\n        onParallelError = local.onParallel(onParallel);\n        onParallelError.counter += 1;\n        onParallelError();\n        // test multiple-callback-error handling-behavior\n        onParallelError();\n        // validate err occurred\n        local.assertThrow(onParallelError.err, onParallelError.err);\n        // test err handling-behavior\n        onParallelError(local.errDefault);\n        // validate err occurred\n        local.assertThrow(onParallelError.err, onParallelError.err);\n        // test ignore-after-error handling-behavior\n        onParallelError();\n    });\n    // test default handling-behavior\n    onParallel(null, opt);\n};\n\nlocal.testCase_onTimeout_timeout = function (opt, onError) {\n/*\n * this function will test onTimeout's timeout handling-behavior\n */\n    opt = local.timeElapsedStart();\n    local.onTimeout(function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        // validate err.message\n        local.assertThrow(\n            err.message.indexOf(\"testCase_onTimeout_timeout\") >= 0,\n            err\n        );\n        // poll timeElapsed\n        local.timeElapsedPoll(opt);\n        // validate timeElapsed passed is greater than timeout\n        local.assertThrow(opt.timeElapsed >= 1000, opt);\n        onError(null, opt);\n    }, 1000, \"testCase_onTimeout_timeout\");\n};\n\nlocal.testCase_profileXxx_default = function (opt, onError) {\n/*\n * this function will test profileXxx's default handling-behavior\n */\n    opt = {};\n    // test profileSync's handling-behavior\n    opt.timeElapsed = local.profileSync(function () {\n        return;\n    });\n    // validate timeElapsed\n    local.assertThrow(\n        0 <= opt.timeElapsed && opt.timeElapsed < 1000,\n        opt.timeElapsed\n    );\n    // test profile's async handling-behavior\n    local.profile(function (onError) {\n        setTimeout(onError);\n    }, function (err, timeElapsed) {\n        // validate no err occurred\n        local.assertThrow(!err, err);\n        opt.timeElapsed = timeElapsed;\n        // validate timeElapsed\n        local.assertThrow((\n            0 <= opt.timeElapsed\n            && opt.timeElapsed < local.timeoutDefault\n        ), opt.timeElapsed);\n        onError(null, opt);\n    });\n};\n\nlocal.testCase_replStart_default = function (opt, onError) {\n/*\n * this function will test replStart's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.replStart();\n    // coverage-hack - test replStart's muliple-call handling-behavior\n    local.replStart();\n    local.testMock([\n        [\n            local.child_process, {\n                spawn: function () {\n                    return {\n                        on: function (evt, callback) {\n                            callback(null, evt);\n                        }\n                    };\n                }\n            }\n        ],\n        // suppress process.stdout\n        [\n            process.stdout, {\n                write: local.nop\n            }\n        ]\n    ], function (onError) {\n        [\n            // test null-case handling-behavior\n            \"\",\n            // test shell handling-behavior\n            \"$ :\\n\",\n            // test git diff handling-behavior\n            \"$ git diff\\n\",\n            // test git log handling-behavior\n            \"$ git log\\n\",\n            // test charCode handling-behavior\n            \"charCode abcd\\n\",\n            // test charSort handling-behavior\n            \"charSort abcd\\n\",\n            // test grep handling-behavior\n            \"grep \\\\baa\\\\b\\n\",\n            // test keys handling-behavior\n            \"keys {}\\n\",\n            // test print handling-behavior\n            \"print abcd\\n\",\n            // test err handling-behavior\n            \"undefined()\\n\"\n        ].forEach(function (script) {\n            globalThis.utility2_repl1.eval(script, null, \"repl\", local.nop);\n        });\n        // test err handling-behavior\n        globalThis.utility2_repl1.onError(local.errDefault);\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_replStart_tcp = function (opt, onError) {\n/*\n * this function will test replStart's tcp handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = {};\n    opt.data = \"\";\n    opt.input = Math.random();\n    opt.socket = local.net.createConnection(local.env.PORT_REPL);\n    opt.socket.on(\"data\", function (data) {\n    /*\n     * this function will concat data to opt.data\n     */\n        opt.data += data;\n    });\n    opt.socket.setEncoding(\"utf8\");\n    opt.socket.on(\"end\", function () {\n        // validate data\n        local.assertThrow(\n            opt.data.indexOf(opt.input) >= 0,\n            JSON.stringify([\n                opt.data, opt.input\n            ])\n        );\n        onError(null, opt);\n    });\n    opt.socket.write(opt.input + \"\\n\");\n    // test err handling-behavior\n    opt.socket.end(\"undefined()\\n\");\n};\n\nlocal.testCase_requireReadme_start = function (opt, onError) {\n/*\n * this function will test requireReadme's start handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.testMock([\n        [\n            local, {\n                assetsDict: {},\n                onFileModifiedRestart: local.nop\n            }\n        ], [\n            local.env, {\n                npm_config_mode_start: \"1\",\n                npm_package_nameLib: \"_testCase_requireReadme_start\"\n            }\n        ], [\n            local.fs, {\n                readFile: function (file, opt, onError) {\n                    onError(null, \"{}\", file, opt);\n                },\n                readdirSync: function () {\n                    // test jslintAndPrint.conditional handling-behavior\n                    return [\n                        \"aa.css\",\n                        \"aa.html\",\n                        \"aa.js\",\n                        \"aa.json\",\n                        \"aa.rollup.js\",\n                        \"assets.swgg.swagger.json\"\n                    ];\n                }\n            }\n        ]\n    ], function (onError) {\n        // validate data\n        local.requireReadme();\n        local.assertThrow(local._testCase_requireReadme_start === local);\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_semverCompare_default = function (opt, onError) {\n/*\n * this function will test semverCompare's default handling-behavior\n */\n    var aa;\n    // test aa = bb\n    opt = [\n        \"1.2.3\",\n        \"1.2.3-\",\n        \"1.2.3-alpha.beta\",\n        \"1.2.3-alpha.beta\"\n    ];\n    opt.forEach(function (bb, ii) {\n        if (Boolean(ii & 1)) {\n            local.assertThrow(\n                local.semverCompare(aa, bb) === 0,\n                [\n                    local.semverCompare(aa, bb), aa, bb\n                ]\n            );\n        }\n        aa = bb;\n    });\n    opt = [\n        \"1.2.3-a\",\n        \"1.2.3-a.2\",\n        \"1.2.3-a.10\",\n        \"1.2.3-b\",\n        \"1.2.3\",\n        \"1.2.10\"\n    ];\n    // test aa < bb\n    opt.reduce(function (aa, bb) {\n        local.assertThrow(\n            local.semverCompare(aa, bb) === -1,\n            [\n                local.semverCompare(aa, bb), aa, bb\n            ]\n        );\n        return bb;\n    });\n    // test aa > bb\n    opt.reverse().reduce(function (aa, bb) {\n        local.assertThrow(\n            local.semverCompare(aa, bb) === 1,\n            [\n                local.semverCompare(aa, bb), aa, bb\n            ]\n        );\n        return bb;\n    });\n    onError(null, opt);\n};\n\nlocal.testCase_serverRespondTimeoutDefault_timeout = function (\n    opt,\n    onError\n) {\n/*\n * this function will test\n * serverRespondTimeoutDefault's timeout handling-behavior\n */\n    opt = function (fnc1, fnc2) {\n        [\n            fnc1, fnc2\n        ].forEach(function (fnc) {\n            if (typeof fnc === \"function\") {\n                fnc();\n            }\n        });\n    };\n    local.testMock([\n        [\n            local, {\n                onTimeout: opt,\n                serverRespondDefault: local.nop,\n                setTimeout: opt\n            }\n        ]\n    ], function (onError) {\n        local.serverRespondTimeoutDefault({\n            headers: {}\n        }, {\n            on: opt\n        });\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_setTimeoutOnError_default = function (opt, onError) {\n/*\n * this function will test setTimeoutOnError's default handling-behavior\n */\n    // test null-case handling-behavior\n    local.assertJsonEqual(local.setTimeoutOnError(), undefined);\n    // test onError handling-behavior\n    local.assertJsonEqual(\n        local.setTimeoutOnError(onError, 0, null, {}, opt),\n        {}\n    );\n};\n\nlocal.testCase_sjclHashScryptXxx_default = function (opt, onError) {\n/*\n * this function will test sjclHashScryptXxx's default handling-behavior\n */\n    // test sjclHashScryptCreate's null-case handling-behavior\n    local.assertJsonEqual(\n        local.sjclHashScryptCreate().slice(0, 10),\n        \"$s0$10801$\"\n    );\n    // https://github.com/wg/scrypt\n    // test sjclHashScryptValidate's fail handling-behavior\n    local.assertJsonEqual(local.sjclHashScryptValidate(\n        \"password\",\n        (\n            \"$s0$80801$epIxT/h6HbbwHaehFnh/bw==\"\n            + \"$l/guDhz2Q0v/D93gq0K0qtSX6FWP8pH5maAJkbIcRaEA\"\n        )\n    ), false);\n    // https://github.com/wg/scrypt\n    // test sjclHashScryptValidate's pass handling-behavior\n    local.assertJsonEqual(local.sjclHashScryptValidate(\"password\", (\n        \"$s0$80801$epIxT/h6HbbwHaehFnh/bw==\"\n        + \"$l/guDhz2Q0v/D93gq0K0qtSX6FWP8pH5maAJkbIcRaE=\"\n    )), true);\n    onError(null, opt);\n};\n\nlocal.testCase_sjclHashShaXxxCreate_default = function (opt, onError) {\n/*\n * this function will test sjclHashShaXxxCreate's default handling-behavior\n */\n    local.assertJsonEqual(\n        local.sjclHashSha1Create(\"aa\"),\n        \"4MkDWJjdUvxlxBRUzsnE0mEb+zc=\"\n    );\n    local.assertJsonEqual(\n        local.sjclHashSha256Create(\"aa\"),\n        \"lhtt0+3jy47LqsvWjeBAzXjrLtWIkTDM60xJJo6k1QY=\"\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_sjclHmacShaXxx_default = function (opt, onError) {\n/*\n * this function will test sjclHmacShaXxx's default handling-behavior\n */\n    local.assertJsonEqual(\n        local.sjclHmacSha1Create(\"aa\", \"bb\"),\n        \"15pOinCz63A+qZoxnv+mJB6UF1k=\"\n    );\n    local.assertJsonEqual(\n        local.sjclHmacSha256Create(\"aa\", \"bb\"),\n        \"94Xv3VdPHA+ohKyjkM1pb0W5ZVAuMVcmIAAI2AqNRCQ=\"\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_stringHtmlSafe_default = function (opt, onError) {\n/*\n * this function will test stringHtmlSafe's default handling-behavior\n */\n    local.assertJsonEqual(\n        local.stringHtmlSafe(\n            local.stringHtmlSafe(local.stringCharsetAscii).slice(32, -1)\n        ),\n        (\n            \" !&quot;#$%&amp;&apos;()*+,-./0123456789:;&lt;=&gt;?@\"\n            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n        )\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_stringQuotedToAscii_default = function (opt, onError) {\n/*\n * this function will test stringQuotedToAscii's default handling-behavior\n */\n    local.assertJsonEqual(\n        local.stringQuotedToAscii(local.stringHelloEmoji),\n        \"hello \\\\ud83d\\\\ude01\\n\"\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_stringRegexpEscape_default = function (opt, onError) {\n/*\n * this function will test stringRegexpEscape's default handling-behavior\n */\n    local.assertJsonEqual(\n        local.stringRegexpEscape(local.stringCharsetAscii),\n        (\n            \"\\u0000\\u0001\\u0002\\u0003\\u0004\\u0005\\u0006\\u0007\"\n            + \"\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\"\n            + \"\\u0010\\u0011\\u0012\\u0013\\u0014\\u0015\\u0016\\u0017\"\n            + \"\\u0018\\u0019\\u001a\\u001b\\u001c\\u001d\\u001e\\u001f\"\n            + \" !\\\"#\\\\$%&'\\\\(\\\\)\\\\*\\\\+,\\\\-\\\\.\\\\/0123456789:;<=>\\\\?@\"\n            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\\\\[\\\\\\\\\\\\]\\\\^_`\"\n            + \"abcdefghijklmnopqrstuvwxyz\\\\{\\\\|\\\\}~\"\n            + \"\\u007f\"\n        )\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_stringTruncate_default = function (opt, onError) {\n/*\n * this function will test stringTruncate's default handling-behavior\n */\n    local.assertJsonEqual(local.stringTruncate(\"aa\"), \"aa\");\n    local.assertJsonEqual(local.stringTruncate(\"aa\", 1), \"...\");\n    local.assertJsonEqual(local.stringTruncate(\"aa\", 2), \"aa\");\n    onError(null, opt);\n};\n\nlocal.testCase_stringUniqueKey_default = function (opt, onError) {\n/*\n * this function will test stringUniqueKey's default handling-behavior\n */\n    local.assertThrow((\"zqxj\").indexOf(local.stringUniqueKey(\"zqxj\") < 0));\n    onError(null, opt);\n};\n\nlocal.testCase_taskCreateCached_default = function (opt, onError) {\n/*\n * this function will test taskCreateCached's default handling-behavior\n */\n    var cacheValue;\n    var onTask;\n    var option2;\n    opt = {};\n    local.onNext(opt, function (err, data) {\n        switch (opt.modeNext) {\n        // test no cache handling-behavior\n        case 1:\n            onTask = function (onError) {\n                onError(null, cacheValue);\n            };\n            opt.cacheDict = \"testCase_taskCreateCached_default\";\n            opt.key = \"memory\";\n            // cleanup memory-cache\n            local.cacheDict[opt.cacheDict] = null;\n            cacheValue = \"aa\";\n            option2 = {\n                cacheDict: opt.cacheDict,\n                key: opt.key,\n                // test onCacheWrite handling-behavior\n                onCacheWrite: opt.onNext\n            };\n            local.taskCreateCached(option2, onTask, opt.onNext);\n            break;\n        case 2:\n            // validate data\n            local.assertJsonEqual(data, \"aa\");\n            // validate no cache-hit\n            local.assertThrow(!option2.modeCacheHit, option2.modeCacheHit);\n            break;\n        // test cache with update handling-behavior\n        case 3:\n            cacheValue = \"bb\";\n            option2 = {\n                cacheDict: opt.cacheDict,\n                key: opt.key,\n                // test modeCacheUpdate handling-behavior\n                modeCacheUpdate: true,\n                // test onCacheWrite handling-behavior\n                onCacheWrite: opt.onNext\n            };\n            local.taskCreateCached(option2, onTask, opt.onNext);\n            break;\n        case 4:\n            // validate data\n            local.assertJsonEqual(data, \"aa\");\n            // validate modeCacheHit\n            local.assertJsonEqual(option2.modeCacheHit, true);\n            break;\n        // test cache handling-behavior\n        case 5:\n            option2 = {\n                cacheDict: opt.cacheDict,\n                key: opt.key\n            };\n            local.taskCreateCached(option2, onTask, opt.onNext);\n            break;\n        case 6:\n            // validate data\n            local.assertJsonEqual(data, \"bb\");\n            // validate modeCacheHit\n            local.assertJsonEqual(option2.modeCacheHit, true);\n            opt.onNext();\n            break;\n        default:\n            onError(err, opt);\n        }\n    });\n    opt.modeNext = 0;\n    opt.onNext();\n};\n\nlocal.testCase_taskCreate_multipleCallback = function (opt, onError) {\n/*\n * this function will test taskCreate's multiple-callback handling-behavior\n */\n    opt = {\n        counter: 0,\n        key: \"testCase_taskCreate_multiCallback\"\n    };\n    local.taskCreate(opt, function (onError) {\n        onError(null, opt);\n        // test multiple-callback handling-behavior\n        onError(null, opt);\n    }, function () {\n        opt.counter += 1;\n    });\n    // validate counter incremented once\n    local.assertJsonEqual(opt.counter, 1);\n    onError(null, opt);\n};\n\nlocal.testCase_taskCreate_upsert = function (opt, onError) {\n/*\n * this function will test taskCreate's upsert handling-behavior\n */\n    opt = {\n        counter: 0,\n        key: \"testCase_taskCreate_upsert\"\n    };\n    // test upsert handling-behavior\n    [\n        null, null\n    ].forEach(function () {\n        local.taskCreate(opt, function (onError) {\n            opt.counter += 1;\n            setTimeout(onError);\n        });\n    });\n    // validate counter incremented once\n    setTimeout(function () {\n        local.assertJsonEqual(opt.counter, 1);\n        onError(null, opt);\n    });\n};\n\nlocal.testCase_templateRender_default = function (opt, onError) {\n/*\n * this function will test templateRender's default handling-behavior\n */\n    // test null-case handling-behavior\n    local.assertJsonEqual(local.templateRender(), \"\");\n    // test undefined-value handling-behavior\n    local.assertJsonEqual(local.templateRender(\"{{aa}}\", {}), \"{{aa}}\");\n    // test basic handling-behavior\n    local.assertJsonEqual(local.templateRender(\"{{aa}}\", {\n        aa: \"```<aa\\nbb>```\"\n    }), \"```&lt;aa\\nbb&gt;```\");\n    // test markdownToHtml handling-behavior\n    local.assertJsonEqual(\n        local.templateRender(\"{{aa markdownToHtml}}\", {\n            aa: local.stringCharsetAscii.slice(32, -1)\n        }),\n        (\n            \"<p> !&quot;#$%&amp;&apos;()*+,-./0123456789:;&lt;=&gt;?@\"\n            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n            + \"</p>\\n\"\n        )\n    );\n    // test markdownSafe handling-behavior\n    local.assertJsonEqual(\n        local.templateRender(\"{{aa markdownSafe notHtmlSafe}}\", {\n            aa: local.stringCharsetAscii.slice(32, -1)\n        }),\n        (\n            \" !\\\"#$%&'()*+,-./0123456789:;<=>?@\"\n            + \"ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_'abcdefghijklmnopqrstuvwxyz{|}~\"\n        )\n    );\n    // test notHtmlSafe handling-behavior\n    local.assertJsonEqual(local.templateRender(\"{{aa notHtmlSafe}}\", {\n        aa: \"```<aa\\nbb>```\"\n    }), \"```<aa\\nbb>```\");\n    // test default handling-behavior\n    local.assertJsonEqual(local.templateRender((\n        \"{{aa alphanumeric}} \"\n        + \"{{aa truncate 4 truncate 4}} \"\n        + \"{{aa jsonStringify jsonStringify4 decodeURIComponent\"\n        + \" encodeURIComponent trim}} \"\n        + \"{{bb}} {{cc}} {{dd}} {{ee.ff}}\"\n    ), {\n        // test string value handling-behavior\n        aa: \"`<aa>`\",\n        // test non-string value handling-behavior\n        bb: 1,\n        // test null-value handling-behavior\n        cc: null,\n        // test undefined-value handling-behavior\n        dd: undefined,\n        // test nested value handling-behavior\n        ee: {\n            ff: \"gg\"\n        }\n    }), \"__aa__ `... %22%5C%22%60%3Caa%3E%60%5C%22%22 1 null {{dd}} gg\");\n    // test partial handling-behavior\n    local.assertJsonEqual(\n        local.templateRender((\n            \"{{#undefined aa}}\\n\"\n            + \"list1{{#each list1}}\\n\"\n            + \"    aa - {{aa}}\\n\"\n            + \"    list2{{#eachTrimRightComma list2}}\\n\"\n            + \"        {{#this/ notHtmlSafe jsonStringify}}\\n\"\n            + \"        bb - {{bb}}\\n\"\n            + \"        {{#if bb}}\\n\"\n            + \"        if\\n\"\n            + \"        {{#unless bb}}\\n\"\n            + \"        else\\n\"\n            + \"        {{/if bb}}\\n\"\n            + \"        {{#unless bb}}\\n\"\n            + \"        unless\\n\"\n            + \"        {{/unless bb}}\\n\"\n            + \"        ,\\n\"\n            + \"    {{/eachTrimRightComma list2}}\\n\"\n            + \"{{/each list1}}\\n\"\n            + \"{{/undefined aa}}\\n\"\n        ), {\n            list1: [\n                // test null-value handling-behavior\n                null, {\n                    aa: \"aa\",\n                    // test recursive-list handling-behavior\n                    list2: [\n                        {\n                            bb: \"bb\"\n                        }, {\n                            bb: null\n                        }\n                    ]\n                }\n            ]\n        }),\n        (\n            \"{{#undefined aa}}\\n\"\n            + \"list1\\n\"\n            + \"    aa - {{aa}}\\n\"\n            + \"    list2\\n\"\n            + \"\\n\"\n            + \"    aa - aa\\n\"\n            + \"    list2\\n\"\n            + \"        {\\\"bb\\\":\\\"bb\\\"}\\n\"\n            + \"        bb - bb\\n\"\n            + \"        \\n\"\n            + \"        if\\n\"\n            + \"        \\n\"\n            + \"        \\n\"\n            + \"        ,\\n\"\n            + \"    \\n\"\n            + \"        {\\\"bb\\\":null}\\n\"\n            + \"        bb - null\\n\"\n            + \"        \\n\"\n            + \"        else\\n\"\n            + \"        \\n\"\n            + \"        \\n\"\n            + \"        unless\\n\"\n            + \"        \\n\"\n            + \"        \\n\"\n            + \"\\n\"\n            + \"{{/undefined aa}}\\n\"\n        )\n    );\n    // test err handling-behavior\n    local.tryCatchOnError(function () {\n        local.templateRender(\"{{aa bb}}\", {\n            aa: 1\n        });\n    }, local.nop);\n    // validate err occurred\n    local.assertThrow(local._debugTryCatchError, local._debugTryCatchError);\n    onError(null, opt);\n};\n\nlocal.testCase_testReportCreate_default = function (opt, onError) {\n/*\n * this function will test testReport's default handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.testMock([], function (onError) {\n        // test null-case handling-behavior\n        local.testReportCreate();\n        // test testsFailed handling-behavior\n        local.testReportCreate({\n            testPlatformList: [\n                {\n                    testCaseList: [\n                        {\n                            status: \"failed\"\n                        }, {\n                            status: \"passed\"\n                        }\n                    ]\n                }\n            ]\n        });\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_throwError_default = function (opt, onError) {\n/*\n * this function will test throwError's default handling-behavior\n */\n    local.tryCatchOnError(function () {\n        local.throwError();\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        onError(null, opt);\n    });\n};\n\nlocal.testCase_uiAnimateXxx_default = function (opt, onError) {\n/*\n * this function will test uiAnimateXxx's default handling-behavior\n */\n    if (!local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    opt = document.createElement(\"div\");\n    // test uiAnimateShake handling-behavior\n    local.uiAnimateShake();\n    local.uiAnimateShake(opt);\n    local.assertThrow(\n        opt.classList.contains(\"uiAnimateShake\"),\n        opt.classList\n    );\n    local.uiAnimateShake(opt);\n    local.assertThrow(\n        opt.classList.contains(\"uiAnimateShake\"),\n        opt.classList\n    );\n    // test uiAnimateShakeIfError handling-behavior\n    local.uiAnimateShakeIfError();\n    local.uiAnimateShakeIfError(null, opt);\n    local.assertThrow(\n        !opt.classList.contains(\"hasError\"),\n        opt.classList\n    );\n    local.uiAnimateShakeIfError(true, opt);\n    local.assertThrow(opt.classList.contains(\"hasError\"), opt.classList);\n    local.uiAnimateShakeIfError(null, opt);\n    local.assertThrow(!opt.classList.contains(\"hasError\"), opt.classList);\n    // test uiAnimateSlideXxx handling-behavior\n    local.uiAnimateSlideDown();\n    local.uiAnimateSlideUp();\n    opt.classList.add(\"uiAnimateSlide\");\n    local.uiAnimateSlideDown(opt);\n    local.assertThrow(\n        opt.style.maxHeight.indexOf(\"px\") >= 0,\n        opt.style.maxHeight\n    );\n    local.uiAnimateSlideUp(opt);\n    local.assertJsonEqual(opt.style.maxHeight, \"0px\");\n    // test uiAnimateSlideAccordian handling-behavior\n    local.uiAnimateSlideAccordian(\n        opt,\n        [\n            opt, document.createElement(\"div\")\n        ]\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_urlJoin_default = function (opt, onError) {\n/*\n * this function will test urlJoin's default handling-behavior\n */\n    local.assertJsonEqual(local.urlJoin(\"\", \"\"), \"/\");\n    local.assertJsonEqual(local.urlJoin(\"http://aa/bb\", \"zz\"), \"http://aa/zz\");\n    local.assertJsonEqual(\n        local.urlJoin(\"http://aa/bb/\", \"zz\"),\n        \"http://aa/bb/zz\"\n    );\n    local.assertJsonEqual(\n        local.urlJoin(\"http://aa/bb/\", \"/zz\"),\n        \"http://aa/zz\"\n    );\n    local.assertJsonEqual(local.urlJoin(\"http://aa/bb/\", \"//zz\"), \"http://zz\");\n    local.assertJsonEqual(\n        local.urlJoin(\"http://aa/bb/\", \"http://zz\"),\n        \"http://zz\"\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_urlParse_default = function (opt, onError) {\n/*\n * this function will test urlParse's default handling-behavior\n */\n    local.testMock([\n        [\n            local, {\n                // test default PORT handling-behavior\n                env: {},\n                // test init-serverLocalHost handling-behavior\n                serverLocalHost: \"\"\n            }\n        ]\n    ], function (onError) {\n        // test default handling-behavior\n        local.assertJsonEqual(local.urlParse(\n            \"https://127.0.0.1:80/foo/bar?aa=1&bb%20cc=dd%20=ee&aa=2&aa#zz=1\"\n        ), {\n            basename: \"bar\",\n            hash: \"#zz=1\",\n            host: \"127.0.0.1:80\",\n            hostname: \"127.0.0.1\",\n            href: (\n                \"https://127.0.0.1:80/foo/bar\"\n                + \"?aa=1&bb%20cc=dd%20=ee&aa=2&aa#zz=1\"\n            ),\n            path: \"/foo/bar?aa=1&bb%20cc=dd%20=ee&aa=2&aa\",\n            pathname: \"/foo/bar\",\n            port: \"80\",\n            protocol: \"https:\",\n            query: {\n                aa: [\n                    \"1\", \"2\", \"\"\n                ],\n                \"bb cc\": \"dd =ee\"\n            },\n            search: \"?aa=1&bb%20cc=dd%20=ee&aa=2&aa\"\n        });\n        // test err handling-behavior\n        local.assertJsonEqual(local.urlParse(null), {\n            basename: \"\",\n            hash: \"\",\n            host: \"\",\n            hostname: \"\",\n            href: \"\",\n            path: \"\",\n            pathname: \"\",\n            port: \"\",\n            protocol: \"\",\n            query: {},\n            search: \"\"\n        });\n        onError(null, opt);\n    }, onError);\n};\n\nlocal.testCase_uuid4Create_default = function (opt, onError) {\n/*\n * this function will test uuid4Create's default handling-behavior\n */\n    local.assertThrow(\n        local.regexpValidateUuid.test(local.uuid4Create()),\n        local.uuid4Create()\n    );\n    onError(null, opt);\n};\n\nlocal.testCase_webpage_err = function (opt, onError) {\n/*\n * this function will test webpage's err handling-behavior\n */\n    if (local.isBrowser) {\n        onError(null, opt);\n        return;\n    }\n    local.browserTest({\n        modeCoverageMerge: true,\n        modeSilent: true,\n        timeoutDefault: local.timeoutDefault - 5000,\n        // https://localhost:8080/assets.script_only.html?modeTest=1&modeTestCase=_testCase_testRunDefault_failure&timeExit=\n        url: (\n            local.serverLocalHost\n            // test script_only handling-behavior\n            + \"/assets.script_only.html\"\n            // test electron-callback handling-behavior\n            + \"?modeTest=1&\"\n            // test specific testCase handling-behavior\n            // test testRunDefault's failure handling-behavior\n            + \"modeTestCase=_testCase_testRunDefault_failure&\"\n            // test timeExit handling-behavior\n            + \"timeExit={{timeExit}}\"\n        )\n    }, function (err) {\n        // validate err occurred\n        local.assertThrow(err, err);\n        onError(null, opt);\n    });\n};\n\nlocal.utility2.serverLocalUrlTest = function (url) {\n/*\n * this function will test if the url is local\n */\n    url = local.urlParse(url).pathname;\n    return local.isBrowser && !local.env.npm_config_mode_backend && (\n        /^\\/test\\./\n    ).test(url);\n};\n}());\n\n\n\n// run shared js-env code - init-after\n(function () {\n// init assets\nlocal.assetsDict[\"/assets.swgg.swagger.json\"] = (\n    local.fsReadFileOrEmptyStringSync(\"assets.swgg.swagger.json\")\n    || local.assetsDict[\"/assets.swgg.swagger.json\"]\n    || local.assetsDict[\"/assets.swgg.swagger.petstore.json\"]\n);\n// coverage-hack - re-run test-server\nlocal.testRunServer(local);\n// coverage-hack - stateInit\nlocal.stateInit({});\n// init test-middleware\nlocal.middlewareList.push(function (req, res, next) {\n/*\n * this function will run the test-middleware\n */\n    switch (req.urlParsed.pathname) {\n    // test http POST handling-behavior\n    case \"/test.body\":\n        // test req-body-read handling-behavior\n        local.middlewareBodyRead(req, res, function () {\n            // test multiple req-body-read handling-behavior\n            local.middlewareBodyRead(req, res, function () {\n                res.write(req.bodyRaw);\n                res.end();\n            });\n        });\n        break;\n    // test http POST handling-behavior\n    case \"/test.echo\":\n        // test res-header handling-behavior\n        local.serverRespondHeadSet(req, res, null, {\n            \"X-Res-Header-Test\": \"bb\"\n        });\n        local.serverRespondEcho(req, res);\n        break;\n    // test 500-internal-server-error handling-behavior\n    case \"/test.err-500\":\n        // test multiple-callback serverRespondHeadSet handling-behavior\n        local.serverRespondHeadSet(req, res, null, {});\n        next(local.errDefault);\n        // test multiple-callback-error handling-behavior\n        next(local.errDefault);\n        // test onErrorDefault handling-behavior\n        local.testMock([\n            [\n                local, {\n                    swgg: null\n                }\n            ]\n        ], function (onError) {\n            var err;\n            err = new Error(\"error\");\n            err.statusCode = 500;\n            local.middlewareError(err, req, res);\n            onError();\n        }, local.onErrorThrow);\n        break;\n    // test undefined-status-code handling-behavior\n    case \"/test.err-undefined\":\n        local.serverRespondDefault(req, res, 999);\n        break;\n    // test timeout handling-behavior\n    case \"/test.timeout\":\n        setTimeout(function () {\n            res.end();\n        }, 2000);\n        break;\n    // serve file\n    default:\n        local.middlewareFileServer(req, res, next);\n    }\n});\n}());\n\n\n\n// run node js-env code - init-after\n/* istanbul ignore next */\n(function () {\nif (local.isBrowser) {\n    return;\n}\n\n\n\n(function () {\n    switch (local.env.HEROKU_APP_NAME) {\n    case \"h1-cron1\":\n        // heroku-keepalive\n        setInterval(function () {\n            local.ajax({\n                url: \"https://h1-cron1.herokuapp.com\"\n            }, local.onErrorThrow);\n        }, 5 * 60 * 1000);\n        local.cronJob = local.nop;\n        // update cron\n        local.ajax({\n            url: \"https://kaizhu256.github.io/node-utility2/cronJob.js\"\n        }, function (err, xhr) {\n            if (!err && xhr.responseText !== local.cronScript) {\n                local.cronScript = xhr.responseText;\n                local.vm.runInThisContext(local.cronScript);\n            }\n        });\n        setInterval(function () {\n            var cronTime;\n            cronTime = new Date();\n            if (\n                cronTime.toISOString().slice(0, 16)\n                < (local.cronTime && local.cronTime.toISOString())\n            ) {\n                return;\n            }\n            local.cronTime = cronTime;\n            // cron every 5 minutes\n            if (local.cronTime.getUTCMinutes() % 5 === 0) {\n                // update cron\n                local.ajax({\n                    url: \"https://kaizhu256.github.io/node-utility2/cronJob.js\"\n                }, function (err, xhr) {\n                    if (!err && xhr.responseText !== local.cronScript) {\n                        local.cronScript = xhr.responseText;\n                        local.vm.runInThisContext(local.cronScript);\n                    }\n                });\n            }\n            local.cronJob();\n        }, 30000);\n        break;\n    case \"h1-proxy1\":\n        // heroku-keepalive\n        setInterval(function () {\n            local.ajax({\n                url: \"https://h1-proxy1.herokuapp.com\"\n            }, local.onErrorThrow);\n        }, 5 * 60 * 1000);\n        break;\n    }\n}());\n\n\n\n// init cli\nif (module !== require.main || globalThis.utility2_rollup) {\n    return;\n}\nlocal.assetsDict[\"/assets.script_only.html\"] = (\n    \"<h1>script_only_test</h1>\\n\"\n    + \"<script src=\\\"assets.utility2.js\\\"></script>\\n\"\n    + \"<script>window.utility2_onReadyBefore.counter += 1;</script>\\n\"\n    + \"<script src=\\\"assets.example.js\\\"></script>\\n\"\n    + \"<script src=\\\"assets.test.js\\\"></script>\\n\"\n    + \"<script>window.utility2_onReadyBefore();</script>\\n\"\n);\nif (process.argv[2]) {\n    // start with coverage\n    if (local.env.npm_config_mode_coverage) {\n        process.argv.splice(1, 1, __dirname + \"/lib.istanbul.js\", \"cover\");\n        local.istanbul.cliDict[process.argv[2]]();\n        return;\n    }\n    // start\n    process.argv.splice(1, 1);\n    process.argv[1] = local.path.resolve(process.cwd(), process.argv[1]);\n    local.Module.runMain();\n}\n}());\n\n\n\n}());\n",
            "/assets.utility2.base.html": "<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<!-- \"assets.utility2.template.html\" -->\n<title>utility2 (2019.8.11)</title>\n<style>\n/* jslint utility2:true */\n/*csslint\n*/\n/* csslint ignore:start */\n*,\n*:after,\n*:before {\n    box-sizing: border-box;\n}\n/* csslint ignore:end */\n@keyframes uiAnimateShake {\n0%,\n50% {\n    transform: translateX(10px);\n}\n100% {\n    transform: translateX(0);\n}\n25%,\n75% {\n    transform: translateX(-10px);\n}\n}\n@keyframes uiAnimateSpin {\n0% {\n    transform: rotate(0deg);\n}\n100% {\n    transform: rotate(360deg);\n}\n}\na {\n    overflow-wrap: break-word;\n}\nbody {\n    background: #eef;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: small;\n    margin: 0 40px;\n}\nbody > div,\nbody > form > div,\nbody > form > input,\nbody > form > pre,\nbody > form > .button,\nbody > form > .textarea,\nbody > input,\nbody > pre,\nbody > .button,\nbody > .textarea {\n    margin-bottom: 20px;\n    margin-top: 0;\n}\nbody > form > input,\nbody > form > .button,\nbody > input,\nbody > .button {\n    width: 20rem;\n}\nbody > form > .textarea,\nbody > .textarea {\n    height: 10rem;\n    width: 100%;\n}\nbody > .readonly {\n    background: #ddd;\n}\ncode,\npre,\n.textarea {\n    font-family: Consolas, Menlo, monospace;\n    font-size: smaller;\n}\npre {\n    overflow-wrap: break-word;\n    white-space: pre-wrap;\n}\n.button {\n    background-color: #fff;\n    border: 1px solid;\n    border-bottom-color: rgb(186, 186, 186);\n    border-left-color: rgb(209, 209, 209);\n    border-radius: 4px;\n    border-right-color: rgb(209, 209, 209);\n    border-top-color: rgb(216, 216, 216);\n    color: #00d;\n    cursor: pointer;\n    display: inline-block;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: 12px;\n    font-style: normal;\n    font-weight: normal;\n    margin: 0;\n    padding: 2px 7px 3px 7px;\n    text-align: center;\n    text-decoration: underline;\n}\n.colorError {\n    color: #d00;\n}\n.textarea {\n    background: #fff;\n    border: 1px solid #999;\n    border-radius: 0;\n    cursor: auto;\n    overflow: auto;\n    padding: 2px;\n}\n.uiAnimateShake {\n    animation-duration: 500ms;\n    animation-name: uiAnimateShake;\n}\n.uiAnimateSlide {\n    overflow-y: hidden;\n    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n}\n.utility2FooterDiv {\n    text-align: center;\n}\n.zeroPixel {\n    border: 0;\n    height: 0;\n    margin: 0;\n    padding: 0;\n    width: 0;\n}\n</style>\n</head>\n<body>\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\n<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\n<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\n<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\n<script>\n/* jslint utility2:true */\n// init domOnEventWindowOnloadTimeElapsed\n(function () {\n/*\n * this function will measure and print time-elapsed for window.onload\n */\n    \"use strict\";\n    if (window.domOnEventWindowOnloadTimeElapsed) {\n        return;\n    }\n    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n    window.addEventListener(\"load\", function () {\n        setTimeout(function () {\n            window.domOnEventWindowOnloadTimeElapsed = (\n                Date.now()\n                - window.domOnEventWindowOnloadTimeElapsed\n            );\n            console.error(\n                \"domOnEventWindowOnloadTimeElapsed = \"\n                + window.domOnEventWindowOnloadTimeElapsed\n            );\n        }, 100);\n    });\n}());\n\n\n\n// init domOnEventDelegateDict\n(function () {\n/*\n * this function will handle delegated dom-event\n */\n    \"use strict\";\n    var timerTimeoutDict;\n    if (window.domOnEventDelegateDict) {\n        return;\n    }\n    window.domOnEventDelegateDict = {};\n    timerTimeoutDict = {};\n    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n        evt.targetOnEvent = evt.target.closest(\n            \"[data-onevent]\"\n        );\n        if (\n            !evt.targetOnEvent\n            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\n            || evt.target.closest(\n                \".disabled, .readonly\"\n            )\n        ) {\n            return;\n        }\n        // rate-limit high-frequency-event\n        switch (evt.type) {\n        case \"keydown\":\n        case \"keyup\":\n            // filter non-input keyboard-event\n            if (!evt.target.closest(\n                \"input, option, select, textarea\"\n            )) {\n                return;\n            }\n            if (timerTimeoutDict[evt.type] !== true) {\n                timerTimeoutDict[evt.type] = timerTimeoutDict[\n                    evt.type\n                ] || setTimeout(function () {\n                    timerTimeoutDict[evt.type] = true;\n                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n                }, 50);\n                return;\n            }\n            timerTimeoutDict[evt.type] = null;\n            break;\n        }\n        switch (evt.targetOnEvent.tagName) {\n        case \"BUTTON\":\n        case \"FORM\":\n            evt.preventDefault();\n            break;\n        }\n        evt.stopPropagation();\n        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n            evt\n        );\n    };\n    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n        Array.from(document.querySelectorAll(\n            \".onevent-reset-output\"\n        )).forEach(function (elem) {\n            switch (elem.tagName) {\n            case \"INPUT\":\n            case \"TEXTAREA\":\n                elem.value = \"\";\n                break;\n            case \"PRE\":\n                elem.textContent = \"\";\n                break;\n            default:\n                elem.innerHTML = \"\";\n            }\n        });\n    };\n    // init event-handling\n    [\n        \"change\",\n        \"click\",\n        \"keydown\",\n        \"submit\"\n    ].forEach(function (eventType) {\n        document.addEventListener(\n            eventType,\n            window.domOnEventDelegateDict.domOnEventDelegate\n        );\n    });\n}());\n\n\n\n// init timerIntervalAjaxProgressUpdate\n(function () {\n/*\n * this function will increment ajax-progress-bar\n * until webpage has loaded\n */\n    \"use strict\";\n    var ajaxProgressDiv1;\n    var ajaxProgressState;\n    var ajaxProgressUpdate;\n    if (\n        window.timerIntervalAjaxProgressUpdate\n        || !document.querySelector(\n            \"#ajaxProgressDiv1\"\n        )\n    ) {\n        return;\n    }\n    ajaxProgressDiv1 = document.querySelector(\n        \"#ajaxProgressDiv1\"\n    );\n    setTimeout(function () {\n        ajaxProgressDiv1.style.width = \"25%\";\n    });\n    ajaxProgressState = 0;\n    ajaxProgressUpdate = (\n        window.local\n        && window.local.ajaxProgressUpdate\n    ) || function () {\n        ajaxProgressDiv1.style.width = \"100%\";\n        setTimeout(function () {\n            ajaxProgressDiv1.style.background = \"transparent\";\n            setTimeout(function () {\n                ajaxProgressDiv1.style.width = \"0%\";\n            }, 500);\n        }, 1000);\n    };\n    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n        ajaxProgressState += 1;\n        ajaxProgressDiv1.style.width = Math.max(\n            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n        ) + \"%\";\n    }, 1000);\n    window.addEventListener(\"load\", function () {\n        clearInterval(window.timerIntervalAjaxProgressUpdate);\n        ajaxProgressUpdate();\n    });\n}());\n\n\n\n// init domOnEventSelectAllWithinPre\n(function () {\n/*\n * this function will limit select-all within <pre tabIndex=\"0\"> elements\n * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n */\n    \"use strict\";\n    if (window.domOnEventSelectAllWithinPre) {\n        return;\n    }\n    window.domOnEventSelectAllWithinPre = function (evt) {\n        var range;\n        var selection;\n        if (\n            evt\n            && evt.key === \"a\"\n            && (evt.ctrlKey || evt.metaKey)\n            && evt.target.closest(\n                \"pre\"\n            )\n        ) {\n            range = document.createRange();\n            range.selectNodeContents(evt.target.closest(\n                \"pre\"\n            ));\n            selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            evt.preventDefault();\n        }\n    };\n    // init event-handling\n    document.addEventListener(\n        \"keydown\",\n        window.domOnEventSelectAllWithinPre\n    );\n}());\n</script>\n<h1>\n\n    <a\n        \n        href=\"https://github.com/kaizhu256/node-utility2\"\n        \n        target=\"_blank\"\n    >\n\n        utility2 (2019.8.11)\n\n    </a>\n\n</h1>\n<h3>this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps</h3>\n\n<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\n<button class=\"button\" data-onevent=\"testRunBrowser\" data-onevent-reset-output=\"1\" id=\"testRunButton1\">run internal test</button><br>\n<div class=\"uiAnimateSlide\" id=\"testReportDiv1\" style=\"border-bottom: 0; border-top: 0; margin-bottom: 0; margin-top: 0; max-height: 0; padding-bottom: 0; padding-top: 0;\"></div>\n\n\n\n\n<label>stderr and stdout</label>\n<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabIndex=\"0\"></pre>\n\n\n<script src=\"assets.app.js\"></script>\n\n\n<div class=\"utility2FooterDiv\">\n    [ this app was created with\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\n    ]\n</div>\n</body>\n</html>\n",
            "/index.rollup.html": "<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<!-- \"assets.utility2.template.html\" -->\n<title>utility2 (2019.8.11)</title>\n<style>\n/* jslint utility2:true */\n/*csslint\n*/\n/* csslint ignore:start */\n*,\n*:after,\n*:before {\n    box-sizing: border-box;\n}\n/* csslint ignore:end */\n@keyframes uiAnimateShake {\n0%,\n50% {\n    transform: translateX(10px);\n}\n100% {\n    transform: translateX(0);\n}\n25%,\n75% {\n    transform: translateX(-10px);\n}\n}\n@keyframes uiAnimateSpin {\n0% {\n    transform: rotate(0deg);\n}\n100% {\n    transform: rotate(360deg);\n}\n}\na {\n    overflow-wrap: break-word;\n}\nbody {\n    background: #eef;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: small;\n    margin: 0 40px;\n}\nbody > div,\nbody > form > div,\nbody > form > input,\nbody > form > pre,\nbody > form > .button,\nbody > form > .textarea,\nbody > input,\nbody > pre,\nbody > .button,\nbody > .textarea {\n    margin-bottom: 20px;\n    margin-top: 0;\n}\nbody > form > input,\nbody > form > .button,\nbody > input,\nbody > .button {\n    width: 20rem;\n}\nbody > form > .textarea,\nbody > .textarea {\n    height: 10rem;\n    width: 100%;\n}\nbody > .readonly {\n    background: #ddd;\n}\ncode,\npre,\n.textarea {\n    font-family: Consolas, Menlo, monospace;\n    font-size: smaller;\n}\npre {\n    overflow-wrap: break-word;\n    white-space: pre-wrap;\n}\n.button {\n    background-color: #fff;\n    border: 1px solid;\n    border-bottom-color: rgb(186, 186, 186);\n    border-left-color: rgb(209, 209, 209);\n    border-radius: 4px;\n    border-right-color: rgb(209, 209, 209);\n    border-top-color: rgb(216, 216, 216);\n    color: #00d;\n    cursor: pointer;\n    display: inline-block;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: 12px;\n    font-style: normal;\n    font-weight: normal;\n    margin: 0;\n    padding: 2px 7px 3px 7px;\n    text-align: center;\n    text-decoration: underline;\n}\n.colorError {\n    color: #d00;\n}\n.textarea {\n    background: #fff;\n    border: 1px solid #999;\n    border-radius: 0;\n    cursor: auto;\n    overflow: auto;\n    padding: 2px;\n}\n.uiAnimateShake {\n    animation-duration: 500ms;\n    animation-name: uiAnimateShake;\n}\n.uiAnimateSlide {\n    overflow-y: hidden;\n    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n}\n.utility2FooterDiv {\n    text-align: center;\n}\n.zeroPixel {\n    border: 0;\n    height: 0;\n    margin: 0;\n    padding: 0;\n    width: 0;\n}\n</style>\n</head>\n<body>\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\n<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\n<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\n<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\n<script>\n/* jslint utility2:true */\n// init domOnEventWindowOnloadTimeElapsed\n(function () {\n/*\n * this function will measure and print time-elapsed for window.onload\n */\n    \"use strict\";\n    if (window.domOnEventWindowOnloadTimeElapsed) {\n        return;\n    }\n    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n    window.addEventListener(\"load\", function () {\n        setTimeout(function () {\n            window.domOnEventWindowOnloadTimeElapsed = (\n                Date.now()\n                - window.domOnEventWindowOnloadTimeElapsed\n            );\n            console.error(\n                \"domOnEventWindowOnloadTimeElapsed = \"\n                + window.domOnEventWindowOnloadTimeElapsed\n            );\n        }, 100);\n    });\n}());\n\n\n\n// init domOnEventDelegateDict\n(function () {\n/*\n * this function will handle delegated dom-event\n */\n    \"use strict\";\n    var timerTimeoutDict;\n    if (window.domOnEventDelegateDict) {\n        return;\n    }\n    window.domOnEventDelegateDict = {};\n    timerTimeoutDict = {};\n    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n        evt.targetOnEvent = evt.target.closest(\n            \"[data-onevent]\"\n        );\n        if (\n            !evt.targetOnEvent\n            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\n            || evt.target.closest(\n                \".disabled, .readonly\"\n            )\n        ) {\n            return;\n        }\n        // rate-limit high-frequency-event\n        switch (evt.type) {\n        case \"keydown\":\n        case \"keyup\":\n            // filter non-input keyboard-event\n            if (!evt.target.closest(\n                \"input, option, select, textarea\"\n            )) {\n                return;\n            }\n            if (timerTimeoutDict[evt.type] !== true) {\n                timerTimeoutDict[evt.type] = timerTimeoutDict[\n                    evt.type\n                ] || setTimeout(function () {\n                    timerTimeoutDict[evt.type] = true;\n                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n                }, 50);\n                return;\n            }\n            timerTimeoutDict[evt.type] = null;\n            break;\n        }\n        switch (evt.targetOnEvent.tagName) {\n        case \"BUTTON\":\n        case \"FORM\":\n            evt.preventDefault();\n            break;\n        }\n        evt.stopPropagation();\n        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n            evt\n        );\n    };\n    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n        Array.from(document.querySelectorAll(\n            \".onevent-reset-output\"\n        )).forEach(function (elem) {\n            switch (elem.tagName) {\n            case \"INPUT\":\n            case \"TEXTAREA\":\n                elem.value = \"\";\n                break;\n            case \"PRE\":\n                elem.textContent = \"\";\n                break;\n            default:\n                elem.innerHTML = \"\";\n            }\n        });\n    };\n    // init event-handling\n    [\n        \"change\",\n        \"click\",\n        \"keydown\",\n        \"submit\"\n    ].forEach(function (eventType) {\n        document.addEventListener(\n            eventType,\n            window.domOnEventDelegateDict.domOnEventDelegate\n        );\n    });\n}());\n\n\n\n// init timerIntervalAjaxProgressUpdate\n(function () {\n/*\n * this function will increment ajax-progress-bar\n * until webpage has loaded\n */\n    \"use strict\";\n    var ajaxProgressDiv1;\n    var ajaxProgressState;\n    var ajaxProgressUpdate;\n    if (\n        window.timerIntervalAjaxProgressUpdate\n        || !document.querySelector(\n            \"#ajaxProgressDiv1\"\n        )\n    ) {\n        return;\n    }\n    ajaxProgressDiv1 = document.querySelector(\n        \"#ajaxProgressDiv1\"\n    );\n    setTimeout(function () {\n        ajaxProgressDiv1.style.width = \"25%\";\n    });\n    ajaxProgressState = 0;\n    ajaxProgressUpdate = (\n        window.local\n        && window.local.ajaxProgressUpdate\n    ) || function () {\n        ajaxProgressDiv1.style.width = \"100%\";\n        setTimeout(function () {\n            ajaxProgressDiv1.style.background = \"transparent\";\n            setTimeout(function () {\n                ajaxProgressDiv1.style.width = \"0%\";\n            }, 500);\n        }, 1000);\n    };\n    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n        ajaxProgressState += 1;\n        ajaxProgressDiv1.style.width = Math.max(\n            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n        ) + \"%\";\n    }, 1000);\n    window.addEventListener(\"load\", function () {\n        clearInterval(window.timerIntervalAjaxProgressUpdate);\n        ajaxProgressUpdate();\n    });\n}());\n\n\n\n// init domOnEventSelectAllWithinPre\n(function () {\n/*\n * this function will limit select-all within <pre tabIndex=\"0\"> elements\n * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n */\n    \"use strict\";\n    if (window.domOnEventSelectAllWithinPre) {\n        return;\n    }\n    window.domOnEventSelectAllWithinPre = function (evt) {\n        var range;\n        var selection;\n        if (\n            evt\n            && evt.key === \"a\"\n            && (evt.ctrlKey || evt.metaKey)\n            && evt.target.closest(\n                \"pre\"\n            )\n        ) {\n            range = document.createRange();\n            range.selectNodeContents(evt.target.closest(\n                \"pre\"\n            ));\n            selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            evt.preventDefault();\n        }\n    };\n    // init event-handling\n    document.addEventListener(\n        \"keydown\",\n        window.domOnEventSelectAllWithinPre\n    );\n}());\n</script>\n<h1>\n\n    <a\n        \n        href=\"https://github.com/kaizhu256/node-utility2\"\n        \n        target=\"_blank\"\n    >\n\n        utility2 (2019.8.11)\n\n    </a>\n\n</h1>\n<h3>this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps</h3>\n\n<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"testRunButton1\">run internal test</button><br>\n\n\n\n\n<label>edit or paste script below to cover and test</label>\n<textarea class=\"textarea\" data-onevent=\"testRunBrowser\" id=\"inputEval1\">\n// remove comment below to disable jslint\n/*jslint browser, devel*/\n/*global window*/\n(function () {\n    \"use strict\";\n    var testCaseDict;\n    testCaseDict = {};\n    testCaseDict.modeTest = 1;\n\n    // comment this testCase to disable failed error demo\n    testCaseDict.testCase_failed_error_demo = function (opt, onError) {\n    /*\n     * this function will run a failed error demo\n     */\n        // jslint-hack\n        window.utility2.nop(opt);\n        onError(new Error(\"this is a failed error demo\"));\n    };\n\n    testCaseDict.testCase_passed_ajax_demo = function (opt, onError) {\n    /*\n     * this function will demo a passed ajax test\n     */\n        var data;\n        opt = {url: \"/\"};\n        // test ajax-req for main-page \"/\"\n        window.utility2.ajax(opt, function (err, xhr) {\n            try {\n                // validate no err occurred\n                console.assert(!err, err);\n                // validate \"200 ok\" status\n                console.assert(xhr.statusCode === 200, xhr.statusCode);\n                // validate non-empty data\n                data = xhr.responseText;\n                console.assert(data && data.length > 0, data);\n                onError();\n            } catch (errorCaught) {\n                onError(errorCaught);\n            }\n        });\n    };\n\n    window.utility2.testRunDefault(testCaseDict);\n}());\n</textarea>\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"jslintAutofixButton1\">jslint autofix</button><br>\n<pre class= \"colorError\" id=\"outputJslintPre1\" tabindex=\"0\"></pre>\n<label>instrumented-code</label>\n<pre class=\"readonly textarea\" id=\"outputCode1\" tabindex=\"0\"></pre>\n<label>stderr and stdout</label>\n<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabindex=\"0\"></pre>\n<div id=\"testReportDiv1\"></div>\n<div id=\"coverageReportDiv1\"></div>\n\n\n<script src=\"assets.app.js\"></script>\n\n\n<div class=\"utility2FooterDiv\">\n    [ this app was created with\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\n    ]\n</div>\n</body>\n</html>\n",
            "/": "<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<!-- \"assets.utility2.template.html\" -->\n<title>utility2 (2019.8.11)</title>\n<style>\n/* jslint utility2:true */\n/*csslint\n*/\n/* csslint ignore:start */\n*,\n*:after,\n*:before {\n    box-sizing: border-box;\n}\n/* csslint ignore:end */\n@keyframes uiAnimateShake {\n0%,\n50% {\n    transform: translateX(10px);\n}\n100% {\n    transform: translateX(0);\n}\n25%,\n75% {\n    transform: translateX(-10px);\n}\n}\n@keyframes uiAnimateSpin {\n0% {\n    transform: rotate(0deg);\n}\n100% {\n    transform: rotate(360deg);\n}\n}\na {\n    overflow-wrap: break-word;\n}\nbody {\n    background: #eef;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: small;\n    margin: 0 40px;\n}\nbody > div,\nbody > form > div,\nbody > form > input,\nbody > form > pre,\nbody > form > .button,\nbody > form > .textarea,\nbody > input,\nbody > pre,\nbody > .button,\nbody > .textarea {\n    margin-bottom: 20px;\n    margin-top: 0;\n}\nbody > form > input,\nbody > form > .button,\nbody > input,\nbody > .button {\n    width: 20rem;\n}\nbody > form > .textarea,\nbody > .textarea {\n    height: 10rem;\n    width: 100%;\n}\nbody > .readonly {\n    background: #ddd;\n}\ncode,\npre,\n.textarea {\n    font-family: Consolas, Menlo, monospace;\n    font-size: smaller;\n}\npre {\n    overflow-wrap: break-word;\n    white-space: pre-wrap;\n}\n.button {\n    background-color: #fff;\n    border: 1px solid;\n    border-bottom-color: rgb(186, 186, 186);\n    border-left-color: rgb(209, 209, 209);\n    border-radius: 4px;\n    border-right-color: rgb(209, 209, 209);\n    border-top-color: rgb(216, 216, 216);\n    color: #00d;\n    cursor: pointer;\n    display: inline-block;\n    font-family: Arial, Helvetica, sans-serif;\n    font-size: 12px;\n    font-style: normal;\n    font-weight: normal;\n    margin: 0;\n    padding: 2px 7px 3px 7px;\n    text-align: center;\n    text-decoration: underline;\n}\n.colorError {\n    color: #d00;\n}\n.textarea {\n    background: #fff;\n    border: 1px solid #999;\n    border-radius: 0;\n    cursor: auto;\n    overflow: auto;\n    padding: 2px;\n}\n.uiAnimateShake {\n    animation-duration: 500ms;\n    animation-name: uiAnimateShake;\n}\n.uiAnimateSlide {\n    overflow-y: hidden;\n    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n}\n.utility2FooterDiv {\n    text-align: center;\n}\n.zeroPixel {\n    border: 0;\n    height: 0;\n    margin: 0;\n    padding: 0;\n    width: 0;\n}\n</style>\n</head>\n<body>\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\n<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\n<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\n<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\n<script>\n/* jslint utility2:true */\n// init domOnEventWindowOnloadTimeElapsed\n(function () {\n/*\n * this function will measure and print time-elapsed for window.onload\n */\n    \"use strict\";\n    if (window.domOnEventWindowOnloadTimeElapsed) {\n        return;\n    }\n    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n    window.addEventListener(\"load\", function () {\n        setTimeout(function () {\n            window.domOnEventWindowOnloadTimeElapsed = (\n                Date.now()\n                - window.domOnEventWindowOnloadTimeElapsed\n            );\n            console.error(\n                \"domOnEventWindowOnloadTimeElapsed = \"\n                + window.domOnEventWindowOnloadTimeElapsed\n            );\n        }, 100);\n    });\n}());\n\n\n\n// init domOnEventDelegateDict\n(function () {\n/*\n * this function will handle delegated dom-event\n */\n    \"use strict\";\n    var timerTimeoutDict;\n    if (window.domOnEventDelegateDict) {\n        return;\n    }\n    window.domOnEventDelegateDict = {};\n    timerTimeoutDict = {};\n    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n        evt.targetOnEvent = evt.target.closest(\n            \"[data-onevent]\"\n        );\n        if (\n            !evt.targetOnEvent\n            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\n            || evt.target.closest(\n                \".disabled, .readonly\"\n            )\n        ) {\n            return;\n        }\n        // rate-limit high-frequency-event\n        switch (evt.type) {\n        case \"keydown\":\n        case \"keyup\":\n            // filter non-input keyboard-event\n            if (!evt.target.closest(\n                \"input, option, select, textarea\"\n            )) {\n                return;\n            }\n            if (timerTimeoutDict[evt.type] !== true) {\n                timerTimeoutDict[evt.type] = timerTimeoutDict[\n                    evt.type\n                ] || setTimeout(function () {\n                    timerTimeoutDict[evt.type] = true;\n                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n                }, 50);\n                return;\n            }\n            timerTimeoutDict[evt.type] = null;\n            break;\n        }\n        switch (evt.targetOnEvent.tagName) {\n        case \"BUTTON\":\n        case \"FORM\":\n            evt.preventDefault();\n            break;\n        }\n        evt.stopPropagation();\n        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n            evt\n        );\n    };\n    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n        Array.from(document.querySelectorAll(\n            \".onevent-reset-output\"\n        )).forEach(function (elem) {\n            switch (elem.tagName) {\n            case \"INPUT\":\n            case \"TEXTAREA\":\n                elem.value = \"\";\n                break;\n            case \"PRE\":\n                elem.textContent = \"\";\n                break;\n            default:\n                elem.innerHTML = \"\";\n            }\n        });\n    };\n    // init event-handling\n    [\n        \"change\",\n        \"click\",\n        \"keydown\",\n        \"submit\"\n    ].forEach(function (eventType) {\n        document.addEventListener(\n            eventType,\n            window.domOnEventDelegateDict.domOnEventDelegate\n        );\n    });\n}());\n\n\n\n// init timerIntervalAjaxProgressUpdate\n(function () {\n/*\n * this function will increment ajax-progress-bar\n * until webpage has loaded\n */\n    \"use strict\";\n    var ajaxProgressDiv1;\n    var ajaxProgressState;\n    var ajaxProgressUpdate;\n    if (\n        window.timerIntervalAjaxProgressUpdate\n        || !document.querySelector(\n            \"#ajaxProgressDiv1\"\n        )\n    ) {\n        return;\n    }\n    ajaxProgressDiv1 = document.querySelector(\n        \"#ajaxProgressDiv1\"\n    );\n    setTimeout(function () {\n        ajaxProgressDiv1.style.width = \"25%\";\n    });\n    ajaxProgressState = 0;\n    ajaxProgressUpdate = (\n        window.local\n        && window.local.ajaxProgressUpdate\n    ) || function () {\n        ajaxProgressDiv1.style.width = \"100%\";\n        setTimeout(function () {\n            ajaxProgressDiv1.style.background = \"transparent\";\n            setTimeout(function () {\n                ajaxProgressDiv1.style.width = \"0%\";\n            }, 500);\n        }, 1000);\n    };\n    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n        ajaxProgressState += 1;\n        ajaxProgressDiv1.style.width = Math.max(\n            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n        ) + \"%\";\n    }, 1000);\n    window.addEventListener(\"load\", function () {\n        clearInterval(window.timerIntervalAjaxProgressUpdate);\n        ajaxProgressUpdate();\n    });\n}());\n\n\n\n// init domOnEventSelectAllWithinPre\n(function () {\n/*\n * this function will limit select-all within <pre tabIndex=\"0\"> elements\n * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n */\n    \"use strict\";\n    if (window.domOnEventSelectAllWithinPre) {\n        return;\n    }\n    window.domOnEventSelectAllWithinPre = function (evt) {\n        var range;\n        var selection;\n        if (\n            evt\n            && evt.key === \"a\"\n            && (evt.ctrlKey || evt.metaKey)\n            && evt.target.closest(\n                \"pre\"\n            )\n        ) {\n            range = document.createRange();\n            range.selectNodeContents(evt.target.closest(\n                \"pre\"\n            ));\n            selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            evt.preventDefault();\n        }\n    };\n    // init event-handling\n    document.addEventListener(\n        \"keydown\",\n        window.domOnEventSelectAllWithinPre\n    );\n}());\n</script>\n<h1>\n\n    <a\n        \n        href=\"https://github.com/kaizhu256/node-utility2\"\n        \n        target=\"_blank\"\n    >\n\n        utility2 (2019.8.11)\n\n    </a>\n\n</h1>\n<h3>this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps</h3>\n\n<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"testRunButton1\">run internal test</button><br>\n\n\n\n\n<label>edit or paste script below to cover and test</label>\n<textarea class=\"textarea\" data-onevent=\"testRunBrowser\" id=\"inputEval1\">\n// remove comment below to disable jslint\n/*jslint browser, devel*/\n/*global window*/\n(function () {\n    \"use strict\";\n    var testCaseDict;\n    testCaseDict = {};\n    testCaseDict.modeTest = 1;\n\n    // comment this testCase to disable failed error demo\n    testCaseDict.testCase_failed_error_demo = function (opt, onError) {\n    /*\n     * this function will run a failed error demo\n     */\n        // jslint-hack\n        window.utility2.nop(opt);\n        onError(new Error(\"this is a failed error demo\"));\n    };\n\n    testCaseDict.testCase_passed_ajax_demo = function (opt, onError) {\n    /*\n     * this function will demo a passed ajax test\n     */\n        var data;\n        opt = {url: \"/\"};\n        // test ajax-req for main-page \"/\"\n        window.utility2.ajax(opt, function (err, xhr) {\n            try {\n                // validate no err occurred\n                console.assert(!err, err);\n                // validate \"200 ok\" status\n                console.assert(xhr.statusCode === 200, xhr.statusCode);\n                // validate non-empty data\n                data = xhr.responseText;\n                console.assert(data && data.length > 0, data);\n                onError();\n            } catch (errorCaught) {\n                onError(errorCaught);\n            }\n        });\n    };\n\n    window.utility2.testRunDefault(testCaseDict);\n}());\n</textarea>\n<button class=\"button\" data-onevent=\"testRunBrowser\" id=\"jslintAutofixButton1\">jslint autofix</button><br>\n<pre class= \"colorError\" id=\"outputJslintPre1\" tabindex=\"0\"></pre>\n<label>instrumented-code</label>\n<pre class=\"readonly textarea\" id=\"outputCode1\" tabindex=\"0\"></pre>\n<label>stderr and stdout</label>\n<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabindex=\"0\"></pre>\n<div id=\"testReportDiv1\"></div>\n<div id=\"coverageReportDiv1\"></div>\n\n\n\n<script src=\"assets.utility2.lib.istanbul.js\"></script>\n<script src=\"assets.utility2.lib.jslint.js\"></script>\n<script src=\"assets.utility2.lib.db.js\"></script>\n<script src=\"assets.utility2.lib.marked.js\"></script>\n<script src=\"assets.utility2.lib.sjcl.js\"></script>\n<script src=\"assets.utility2.js\"></script>\n<script>window.utility2_onReadyBefore.counter += 1;</script>\n<script src=\"jsonp.utility2.stateInit?callback=window.utility2.stateInit\"></script>\n<script src=\"assets.example.js\"></script>\n<script src=\"assets.test.js\"></script>\n<script>window.utility2_onReadyBefore();</script>\n\n\n\n<div class=\"utility2FooterDiv\">\n    [ this app was created with\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\n    ]\n</div>\n</body>\n</html>\n",
            "/assets.hello.txt": "hello 😁\n"
        },
        "env": {
            "NODE_ENV": "test",
            "npm_package_description": "this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps",
            "npm_package_homepage": "https://github.com/kaizhu256/node-utility2",
            "npm_package_name": "utility2",
            "npm_package_nameLib": "utility2",
            "npm_package_version": "2019.8.11"
        }
    }
});
/* jslint ignore:end */
    return local;
}(globalThis.utility2_rollup));
/* script-end local.stateInit */



/* script-begin /assets.my_app.js */
(function (local) {
    "use strict";
/* jslint ignore:start */
local.assetsDict["/assets.utility2.js"] = "// usr/bin/env node\n\
/*\n\
 * lib.utility2.js (2019.8.11)\n\
 * https://github.com/kaizhu256/node-utility2\n\
 * this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps\n\
 *\n\
 */\n\
\n\
\n\
\n\
/* istanbul instrument in package utility2 */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
(function (globalThis) {\n\
    \"use strict\";\n\
    var consoleError;\n\
    var local;\n\
    // init globalThis\n\
    (function () {\n\
        try {\n\
            globalThis = Function(\"return this\")(); // jslint ignore:line\n\
        } catch (ignore) {}\n\
    }());\n\
    globalThis.globalThis = globalThis;\n\
    // init debug_inline\n\
    if (!globalThis[\"debug\\u0049nline\"]) {\n\
        consoleError = console.error;\n\
        globalThis[\"debug\\u0049nline\"] = function () {\n\
        /*\n\
         * this function will both print <arguments> to stderr\n\
         * and return <arguments>[0]\n\
         */\n\
            var argList;\n\
            argList = Array.from(arguments); // jslint ignore:line\n\
            // debug arguments\n\
            globalThis[\"debug\\u0049nlineArguments\"] = argList;\n\
            consoleError(\"\\n\\ndebug\\u0049nline\");\n\
            consoleError.apply(console, argList);\n\
            consoleError(\"\\n\");\n\
            // return arg0 for inspection\n\
            return argList[0];\n\
        };\n\
    }\n\
    // init local\n\
    local = {};\n\
    local.local = local;\n\
    globalThis.globalLocal = local;\n\
    // init isBrowser\n\
    local.isBrowser = (\n\
        typeof window === \"object\"\n\
        && window === globalThis\n\
        && typeof window.XMLHttpRequest === \"function\"\n\
        && window.document\n\
        && typeof window.document.querySelector === \"function\"\n\
    );\n\
    // init function\n\
    local.assertThrow = function (passed, message) {\n\
    /*\n\
     * this function will throw err.<message> if <passed> is falsy\n\
     */\n\
        var err;\n\
        if (passed) {\n\
            return;\n\
        }\n\
        err = (\n\
            // ternary-operator\n\
            (\n\
                message\n\
                && typeof message.message === \"string\"\n\
                && typeof message.stack === \"string\"\n\
            )\n\
            // if message is errObj, then leave as is\n\
            ? message\n\
            : new Error(\n\
                typeof message === \"string\"\n\
                // if message is a string, then leave as is\n\
                ? message\n\
                // else JSON.stringify message\n\
                : JSON.stringify(message, null, 4)\n\
            )\n\
        );\n\
        throw err;\n\
    };\n\
    local.functionOrNop = function (fnc) {\n\
    /*\n\
     * this function will if <fnc> exists,\n\
     * them return <fnc>,\n\
     * else return <nop>\n\
     */\n\
        return fnc || local.nop;\n\
    };\n\
    local.identity = function (value) {\n\
    /*\n\
     * this function will return <value>\n\
     */\n\
        return value;\n\
    };\n\
    local.nop = function () {\n\
    /*\n\
     * this function will do nothing\n\
     */\n\
        return;\n\
    };\n\
    local.objectAssignDefault = function (target, source) {\n\
    /*\n\
     * this function will if items from <target> are\n\
     * null, undefined, or empty-string,\n\
     * then overwrite them with items from <source>\n\
     */\n\
        target = target || {};\n\
        Object.keys(source || {}).forEach(function (key) {\n\
            if (\n\
                target[key] === null\n\
                || target[key] === undefined\n\
                || target[key] === \"\"\n\
            ) {\n\
                target[key] = target[key] || source[key];\n\
            }\n\
        });\n\
        return target;\n\
    };\n\
    // require builtin\n\
    if (!local.isBrowser) {\n\
        local.assert = require(\"assert\");\n\
        local.buffer = require(\"buffer\");\n\
        local.child_process = require(\"child_process\");\n\
        local.cluster = require(\"cluster\");\n\
        local.crypto = require(\"crypto\");\n\
        local.dgram = require(\"dgram\");\n\
        local.dns = require(\"dns\");\n\
        local.domain = require(\"domain\");\n\
        local.events = require(\"events\");\n\
        local.fs = require(\"fs\");\n\
        local.http = require(\"http\");\n\
        local.https = require(\"https\");\n\
        local.net = require(\"net\");\n\
        local.os = require(\"os\");\n\
        local.path = require(\"path\");\n\
        local.querystring = require(\"querystring\");\n\
        local.readline = require(\"readline\");\n\
        local.repl = require(\"repl\");\n\
        local.stream = require(\"stream\");\n\
        local.string_decoder = require(\"string_decoder\");\n\
        local.timers = require(\"timers\");\n\
        local.tls = require(\"tls\");\n\
        local.tty = require(\"tty\");\n\
        local.url = require(\"url\");\n\
        local.util = require(\"util\");\n\
        local.vm = require(\"vm\");\n\
        local.zlib = require(\"zlib\");\n\
    }\n\
}(this));\n\
\n\
\n\
\n\
(function (local) {\n\
\"use strict\";\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run shared js-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2_rollup\n\
    // || globalThis.utility2_rollup_old\n\
    // || require(\"./assets.utility2.rollup.js\")\n\
    || globalThis.globalLocal\n\
);\n\
// init exports\n\
if (local.isBrowser) {\n\
    globalThis.utility2_utility2 = local;\n\
} else {\n\
    module.exports = local;\n\
    module.exports.__dirname = __dirname;\n\
}\n\
// init lib main\n\
local.utility2 = local;\n\
\n\
\n\
\n\
/* validateLineSortedReset */\n\
// init lib utility2\n\
globalThis.utility2 = local;\n\
// init lib extra\n\
[\n\
    \"apidoc\",\n\
    \"db\",\n\
    \"github_crud\",\n\
    \"istanbul\",\n\
    \"jslint\",\n\
    \"marked\",\n\
    \"sjcl\"\n\
].forEach(function (key) {\n\
    try {\n\
        local[key] = (\n\
            local.isBrowser\n\
            ? globalThis[\"utility2_\" + key]\n\
            : require(\"./lib.\" + key + \".js\")\n\
        );\n\
    } catch (errCaught) {\n\
        local.assertThrow(errCaught.code === \"MODULE_NOT_FOUND\", errCaught);\n\
    }\n\
    local[key] = local[key] || {};\n\
});\n\
// init assets and templates\n\
local.assetsDict = local.assetsDict || {};\n\
\n\
\n\
\n\
/* jslint ignore:start */\n\
local.assetsDict[\"/assets.index.template.html\"] =\n\
local.assetsDict[\"/assets.utility2.template.html\"] = '\\\n\
<!doctype html>\\n\\\n\
<html lang=\"en\">\\n\\\n\
<head>\\n\\\n\
<meta charset=\"utf-8\">\\n\\\n\
<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\\n\
<!-- \"assets.utility2.template.html\" -->\\n\\\n\
<title>{{env.npm_package_name}} ({{env.npm_package_version}})</title>\\n\\\n\
<style>\\n\\\n\
/* jslint utility2:true */\\n\\\n\
/*csslint\\n\\\n\
*/\\n\\\n\
/* csslint ignore:start */\\n\\\n\
*,\\n\\\n\
*:after,\\n\\\n\
*:before {\\n\\\n\
    box-sizing: border-box;\\n\\\n\
}\\n\\\n\
/* csslint ignore:end */\\n\\\n\
@keyframes uiAnimateShake {\\n\\\n\
0%,\\n\\\n\
50% {\\n\\\n\
    transform: translateX(10px);\\n\\\n\
}\\n\\\n\
100% {\\n\\\n\
    transform: translateX(0);\\n\\\n\
}\\n\\\n\
25%,\\n\\\n\
75% {\\n\\\n\
    transform: translateX(-10px);\\n\\\n\
}\\n\\\n\
}\\n\\\n\
@keyframes uiAnimateSpin {\\n\\\n\
0% {\\n\\\n\
    transform: rotate(0deg);\\n\\\n\
}\\n\\\n\
100% {\\n\\\n\
    transform: rotate(360deg);\\n\\\n\
}\\n\\\n\
}\\n\\\n\
a {\\n\\\n\
    overflow-wrap: break-word;\\n\\\n\
}\\n\\\n\
body {\\n\\\n\
    background: #eef;\\n\\\n\
    font-family: Arial, Helvetica, sans-serif;\\n\\\n\
    font-size: small;\\n\\\n\
    margin: 0 40px;\\n\\\n\
}\\n\\\n\
body > div,\\n\\\n\
body > form > div,\\n\\\n\
body > form > input,\\n\\\n\
body > form > pre,\\n\\\n\
body > form > .button,\\n\\\n\
body > form > .textarea,\\n\\\n\
body > input,\\n\\\n\
body > pre,\\n\\\n\
body > .button,\\n\\\n\
body > .textarea {\\n\\\n\
    margin-bottom: 20px;\\n\\\n\
    margin-top: 0;\\n\\\n\
}\\n\\\n\
body > form > input,\\n\\\n\
body > form > .button,\\n\\\n\
body > input,\\n\\\n\
body > .button {\\n\\\n\
    width: 20rem;\\n\\\n\
}\\n\\\n\
body > form > .textarea,\\n\\\n\
body > .textarea {\\n\\\n\
    height: 10rem;\\n\\\n\
    width: 100%;\\n\\\n\
}\\n\\\n\
body > .readonly {\\n\\\n\
    background: #ddd;\\n\\\n\
}\\n\\\n\
code,\\n\\\n\
pre,\\n\\\n\
.textarea {\\n\\\n\
    font-family: Consolas, Menlo, monospace;\\n\\\n\
    font-size: smaller;\\n\\\n\
}\\n\\\n\
pre {\\n\\\n\
    overflow-wrap: break-word;\\n\\\n\
    white-space: pre-wrap;\\n\\\n\
}\\n\\\n\
.button {\\n\\\n\
    background-color: #fff;\\n\\\n\
    border: 1px solid;\\n\\\n\
    border-bottom-color: rgb(186, 186, 186);\\n\\\n\
    border-left-color: rgb(209, 209, 209);\\n\\\n\
    border-radius: 4px;\\n\\\n\
    border-right-color: rgb(209, 209, 209);\\n\\\n\
    border-top-color: rgb(216, 216, 216);\\n\\\n\
    color: #00d;\\n\\\n\
    cursor: pointer;\\n\\\n\
    display: inline-block;\\n\\\n\
    font-family: Arial, Helvetica, sans-serif;\\n\\\n\
    font-size: 12px;\\n\\\n\
    font-style: normal;\\n\\\n\
    font-weight: normal;\\n\\\n\
    margin: 0;\\n\\\n\
    padding: 2px 7px 3px 7px;\\n\\\n\
    text-align: center;\\n\\\n\
    text-decoration: underline;\\n\\\n\
}\\n\\\n\
.colorError {\\n\\\n\
    color: #d00;\\n\\\n\
}\\n\\\n\
.textarea {\\n\\\n\
    background: #fff;\\n\\\n\
    border: 1px solid #999;\\n\\\n\
    border-radius: 0;\\n\\\n\
    cursor: auto;\\n\\\n\
    overflow: auto;\\n\\\n\
    padding: 2px;\\n\\\n\
}\\n\\\n\
.uiAnimateShake {\\n\\\n\
    animation-duration: 500ms;\\n\\\n\
    animation-name: uiAnimateShake;\\n\\\n\
}\\n\\\n\
.uiAnimateSlide {\\n\\\n\
    overflow-y: hidden;\\n\\\n\
    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\\n\\\n\
}\\n\\\n\
.utility2FooterDiv {\\n\\\n\
    text-align: center;\\n\\\n\
}\\n\\\n\
.zeroPixel {\\n\\\n\
    border: 0;\\n\\\n\
    height: 0;\\n\\\n\
    margin: 0;\\n\\\n\
    padding: 0;\\n\\\n\
    width: 0;\\n\\\n\
}\\n\\\n\
</style>\\n\\\n\
</head>\\n\\\n\
<body>\\n\\\n\
<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;\"></div>\\n\\\n\
<div class=\"uiAnimateSpin\" style=\"animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;\"></div>\\n\\\n\
<a class=\"zeroPixel\" download=\"db.persistence.json\" href=\"\" id=\"dbExportA1\"></a>\\n\\\n\
<input class=\"zeroPixel\" data-onevent=\"onEventDomDb\" data-onevent-db=\"dbImportInput\" type=\"file\">\\n\\\n\
<script>\\n\\\n\
/* jslint utility2:true */\\n\\\n\
// init domOnEventWindowOnloadTimeElapsed\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will measure and print time-elapsed for window.onload\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    if (window.domOnEventWindowOnloadTimeElapsed) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\\n\\\n\
    window.addEventListener(\"load\", function () {\\n\\\n\
        setTimeout(function () {\\n\\\n\
            window.domOnEventWindowOnloadTimeElapsed = (\\n\\\n\
                Date.now()\\n\\\n\
                - window.domOnEventWindowOnloadTimeElapsed\\n\\\n\
            );\\n\\\n\
            console.error(\\n\\\n\
                \"domOnEventWindowOnloadTimeElapsed = \"\\n\\\n\
                + window.domOnEventWindowOnloadTimeElapsed\\n\\\n\
            );\\n\\\n\
        }, 100);\\n\\\n\
    });\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// init domOnEventDelegateDict\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will handle delegated dom-event\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    var timerTimeoutDict;\\n\\\n\
    if (window.domOnEventDelegateDict) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    window.domOnEventDelegateDict = {};\\n\\\n\
    timerTimeoutDict = {};\\n\\\n\
    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\\n\\\n\
        evt.targetOnEvent = evt.target.closest(\\n\\\n\
            \"[data-onevent]\"\\n\\\n\
        );\\n\\\n\
        if (\\n\\\n\
            !evt.targetOnEvent\\n\\\n\
            || evt.targetOnEvent.dataset.onevent === \"domOnEventNop\"\\n\\\n\
            || evt.target.closest(\\n\\\n\
                \".disabled, .readonly\"\\n\\\n\
            )\\n\\\n\
        ) {\\n\\\n\
            return;\\n\\\n\
        }\\n\\\n\
        // rate-limit high-frequency-event\\n\\\n\
        switch (evt.type) {\\n\\\n\
        case \"keydown\":\\n\\\n\
        case \"keyup\":\\n\\\n\
            // filter non-input keyboard-event\\n\\\n\
            if (!evt.target.closest(\\n\\\n\
                \"input, option, select, textarea\"\\n\\\n\
            )) {\\n\\\n\
                return;\\n\\\n\
            }\\n\\\n\
            if (timerTimeoutDict[evt.type] !== true) {\\n\\\n\
                timerTimeoutDict[evt.type] = timerTimeoutDict[\\n\\\n\
                    evt.type\\n\\\n\
                ] || setTimeout(function () {\\n\\\n\
                    timerTimeoutDict[evt.type] = true;\\n\\\n\
                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\\n\\\n\
                }, 50);\\n\\\n\
                return;\\n\\\n\
            }\\n\\\n\
            timerTimeoutDict[evt.type] = null;\\n\\\n\
            break;\\n\\\n\
        }\\n\\\n\
        switch (evt.targetOnEvent.tagName) {\\n\\\n\
        case \"BUTTON\":\\n\\\n\
        case \"FORM\":\\n\\\n\
            evt.preventDefault();\\n\\\n\
            break;\\n\\\n\
        }\\n\\\n\
        evt.stopPropagation();\\n\\\n\
        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\\n\\\n\
            evt\\n\\\n\
        );\\n\\\n\
    };\\n\\\n\
    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\\n\\\n\
        Array.from(document.querySelectorAll(\\n\\\n\
            \".onevent-reset-output\"\\n\\\n\
        )).forEach(function (elem) {\\n\\\n\
            switch (elem.tagName) {\\n\\\n\
            case \"INPUT\":\\n\\\n\
            case \"TEXTAREA\":\\n\\\n\
                elem.value = \"\";\\n\\\n\
                break;\\n\\\n\
            case \"PRE\":\\n\\\n\
                elem.textContent = \"\";\\n\\\n\
                break;\\n\\\n\
            default:\\n\\\n\
                elem.innerHTML = \"\";\\n\\\n\
            }\\n\\\n\
        });\\n\\\n\
    };\\n\\\n\
    // init event-handling\\n\\\n\
    [\\n\\\n\
        \"change\",\\n\\\n\
        \"click\",\\n\\\n\
        \"keydown\",\\n\\\n\
        \"submit\"\\n\\\n\
    ].forEach(function (eventType) {\\n\\\n\
        document.addEventListener(\\n\\\n\
            eventType,\\n\\\n\
            window.domOnEventDelegateDict.domOnEventDelegate\\n\\\n\
        );\\n\\\n\
    });\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// init timerIntervalAjaxProgressUpdate\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will increment ajax-progress-bar\\n\\\n\
 * until webpage has loaded\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    var ajaxProgressDiv1;\\n\\\n\
    var ajaxProgressState;\\n\\\n\
    var ajaxProgressUpdate;\\n\\\n\
    if (\\n\\\n\
        window.timerIntervalAjaxProgressUpdate\\n\\\n\
        || !document.querySelector(\\n\\\n\
            \"#ajaxProgressDiv1\"\\n\\\n\
        )\\n\\\n\
    ) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    ajaxProgressDiv1 = document.querySelector(\\n\\\n\
        \"#ajaxProgressDiv1\"\\n\\\n\
    );\\n\\\n\
    setTimeout(function () {\\n\\\n\
        ajaxProgressDiv1.style.width = \"25%\";\\n\\\n\
    });\\n\\\n\
    ajaxProgressState = 0;\\n\\\n\
    ajaxProgressUpdate = (\\n\\\n\
        window.local\\n\\\n\
        && window.local.ajaxProgressUpdate\\n\\\n\
    ) || function () {\\n\\\n\
        ajaxProgressDiv1.style.width = \"100%\";\\n\\\n\
        setTimeout(function () {\\n\\\n\
            ajaxProgressDiv1.style.background = \"transparent\";\\n\\\n\
            setTimeout(function () {\\n\\\n\
                ajaxProgressDiv1.style.width = \"0%\";\\n\\\n\
            }, 500);\\n\\\n\
        }, 1000);\\n\\\n\
    };\\n\\\n\
    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\\n\\\n\
        ajaxProgressState += 1;\\n\\\n\
        ajaxProgressDiv1.style.width = Math.max(\\n\\\n\
            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\\n\\\n\
            ajaxProgressDiv1.style.width.slice(0, -1) | 0\\n\\\n\
        ) + \"%\";\\n\\\n\
    }, 1000);\\n\\\n\
    window.addEventListener(\"load\", function () {\\n\\\n\
        clearInterval(window.timerIntervalAjaxProgressUpdate);\\n\\\n\
        ajaxProgressUpdate();\\n\\\n\
    });\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// init domOnEventSelectAllWithinPre\\n\\\n\
(function () {\\n\\\n\
/*\\n\\\n\
 * this function will limit select-all within <pre tabIndex=\"0\"> elements\\n\\\n\
 * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\\n\\\n\
 */\\n\\\n\
    \"use strict\";\\n\\\n\
    if (window.domOnEventSelectAllWithinPre) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    window.domOnEventSelectAllWithinPre = function (evt) {\\n\\\n\
        var range;\\n\\\n\
        var selection;\\n\\\n\
        if (\\n\\\n\
            evt\\n\\\n\
            && evt.key === \"a\"\\n\\\n\
            && (evt.ctrlKey || evt.metaKey)\\n\\\n\
            && evt.target.closest(\\n\\\n\
                \"pre\"\\n\\\n\
            )\\n\\\n\
        ) {\\n\\\n\
            range = document.createRange();\\n\\\n\
            range.selectNodeContents(evt.target.closest(\\n\\\n\
                \"pre\"\\n\\\n\
            ));\\n\\\n\
            selection = window.getSelection();\\n\\\n\
            selection.removeAllRanges();\\n\\\n\
            selection.addRange(range);\\n\\\n\
            evt.preventDefault();\\n\\\n\
        }\\n\\\n\
    };\\n\\\n\
    // init event-handling\\n\\\n\
    document.addEventListener(\\n\\\n\
        \"keydown\",\\n\\\n\
        window.domOnEventSelectAllWithinPre\\n\\\n\
    );\\n\\\n\
}());\\n\\\n\
</script>\\n\\\n\
<h1>\\n\\\n\
<!-- utility2-comment\\n\\\n\
    <a\\n\\\n\
        {{#if env.npm_package_homepage}}\\n\\\n\
        href=\"{{env.npm_package_homepage}}\"\\n\\\n\
        {{/if env.npm_package_homepage}}\\n\\\n\
        target=\"_blank\"\\n\\\n\
    >\\n\\\n\
utility2-comment -->\\n\\\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\\n\\\n\
<!-- utility2-comment\\n\\\n\
    </a>\\n\\\n\
utility2-comment -->\\n\\\n\
</h1>\\n\\\n\
<h3>{{env.npm_package_description}}</h3>\\n\\\n\
<!-- utility2-comment\\n\\\n\
<a class=\"button\" download href=\"assets.app.js\">download standalone app</a><br>\\n\\\n\
<button class=\"button\" data-onevent=\"testRunBrowser\" data-onevent-reset-output=\"1\" id=\"testRunButton1\">run internal test</button><br>\\n\\\n\
<div class=\"uiAnimateSlide\" id=\"testReportDiv1\" style=\"border-bottom: 0; border-top: 0; margin-bottom: 0; margin-top: 0; max-height: 0; padding-bottom: 0; padding-top: 0;\"></div>\\n\\\n\
utility2-comment -->\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
<label>stderr and stdout</label>\\n\\\n\
<pre class=\"onevent-reset-output readonly textarea\" id=\"outputStdout1\" tabIndex=\"0\"></pre>\\n\\\n\
<!-- utility2-comment\\n\\\n\
{{#if isRollup}}\\n\\\n\
<script src=\"assets.app.js\"></script>\\n\\\n\
{{#unless isRollup}}\\n\\\n\
utility2-comment -->\\n\\\n\
<script src=\"assets.utility2.rollup.js\"></script>\\n\\\n\
<script>window.utility2_onReadyBefore.counter += 1;</script>\\n\\\n\
<script src=\"jsonp.utility2.stateInit?callback=window.utility2.stateInit\"></script>\\n\\\n\
<script src=\"assets.{{packageJson.nameLib}}.js\"></script>\\n\\\n\
<script src=\"assets.example.js\"></script>\\n\\\n\
<script src=\"assets.test.js\"></script>\\n\\\n\
<script>window.utility2_onReadyBefore();</script>\\n\\\n\
<!-- utility2-comment\\n\\\n\
{{/if isRollup}}\\n\\\n\
utility2-comment -->\\n\\\n\
<div class=\"utility2FooterDiv\">\\n\\\n\
    [ this app was created with\\n\\\n\
    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\\n\
    ]\\n\\\n\
</div>\\n\\\n\
</body>\\n\\\n\
</html>\\n\\\n\
';\n\
\n\
\n\
\n\
/* validateLineSortedReset */\n\
// https://img.shields.io/badge/last_build-0000_00_00_00_00_00_UTC_--_master_--_aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa-0077ff.svg?style=flat\n\
local.assetsDict[\"/assets.buildBadge.template.svg\"] =\n\
'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"563\" height=\"20\"><linearGradient id=\"a\" x2=\"0\" y2=\"100%\"><stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/><stop offset=\"1\" stop-opacity=\".1\"/></linearGradient><rect rx=\"0\" width=\"563\" height=\"20\" fill=\"#555\"/><rect rx=\"0\" x=\"61\" width=\"502\" height=\"20\" fill=\"#07f\"/><path fill=\"#07f\" d=\"M61 0h4v20h-4z\"/><rect rx=\"0\" width=\"563\" height=\"20\" fill=\"url(#a)\"/><g fill=\"#fff\" text-anchor=\"middle\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\"><text x=\"31.5\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">last build</text><text x=\"31.5\" y=\"14\">last build</text><text x=\"311\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">0000-00-00 00:00:00 UTC - master - aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</text><text x=\"311\" y=\"14\">0000-00-00 00:00:00 UTC - master - aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</text></g></svg>';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.example.begin.js\"] = '\\\n\
(function (globalThis) {\\n\\\n\
    \"use strict\";\\n\\\n\
    var consoleError;\\n\\\n\
    var local;\\n\\\n\
    // init globalThis\\n\\\n\
    (function () {\\n\\\n\
        try {\\n\\\n\
            globalThis = Function(\"return this\")(); // jslint ignore:line\\n\\\n\
        } catch (ignore) {}\\n\\\n\
    }());\\n\\\n\
    globalThis.globalThis = globalThis;\\n\\\n\
    // init debug_inline\\n\\\n\
    if (!globalThis[\"debug\\\\u0049nline\"]) {\\n\\\n\
        consoleError = console.error;\\n\\\n\
        globalThis[\"debug\\\\u0049nline\"] = function () {\\n\\\n\
        /*\\n\\\n\
         * this function will both print <arguments> to stderr\\n\\\n\
         * and return <arguments>[0]\\n\\\n\
         */\\n\\\n\
            var argList;\\n\\\n\
            argList = Array.from(arguments); // jslint ignore:line\\n\\\n\
            // debug arguments\\n\\\n\
            globalThis[\"debug\\\\u0049nlineArguments\"] = argList;\\n\\\n\
            consoleError(\"\\\\n\\\\ndebug\\\\u0049nline\");\\n\\\n\
            consoleError.apply(console, argList);\\n\\\n\
            consoleError(\"\\\\n\");\\n\\\n\
            // return arg0 for inspection\\n\\\n\
            return argList[0];\\n\\\n\
        };\\n\\\n\
    }\\n\\\n\
    // init local\\n\\\n\
    local = {};\\n\\\n\
    local.local = local;\\n\\\n\
    globalThis.globalLocal = local;\\n\\\n\
    // init isBrowser\\n\\\n\
    local.isBrowser = (\\n\\\n\
        typeof window === \"object\"\\n\\\n\
        && window === globalThis\\n\\\n\
        && typeof window.XMLHttpRequest === \"function\"\\n\\\n\
        && window.document\\n\\\n\
        && typeof window.document.querySelector === \"function\"\\n\\\n\
    );\\n\\\n\
    // init function\\n\\\n\
    local.assertThrow = function (passed, message) {\\n\\\n\
    /*\\n\\\n\
     * this function will throw err.<message> if <passed> is falsy\\n\\\n\
     */\\n\\\n\
        var err;\\n\\\n\
        if (passed) {\\n\\\n\
            return;\\n\\\n\
        }\\n\\\n\
        err = (\\n\\\n\
            // ternary-operator\\n\\\n\
            (\\n\\\n\
                message\\n\\\n\
                && typeof message.message === \"string\"\\n\\\n\
                && typeof message.stack === \"string\"\\n\\\n\
            )\\n\\\n\
            // if message is errObj, then leave as is\\n\\\n\
            ? message\\n\\\n\
            : new Error(\\n\\\n\
                typeof message === \"string\"\\n\\\n\
                // if message is a string, then leave as is\\n\\\n\
                ? message\\n\\\n\
                // else JSON.stringify message\\n\\\n\
                : JSON.stringify(message, null, 4)\\n\\\n\
            )\\n\\\n\
        );\\n\\\n\
        throw err;\\n\\\n\
    };\\n\\\n\
    local.functionOrNop = function (fnc) {\\n\\\n\
    /*\\n\\\n\
     * this function will if <fnc> exists,\\n\\\n\
     * them return <fnc>,\\n\\\n\
     * else return <nop>\\n\\\n\
     */\\n\\\n\
        return fnc || local.nop;\\n\\\n\
    };\\n\\\n\
    local.identity = function (value) {\\n\\\n\
    /*\\n\\\n\
     * this function will return <value>\\n\\\n\
     */\\n\\\n\
        return value;\\n\\\n\
    };\\n\\\n\
    local.nop = function () {\\n\\\n\
    /*\\n\\\n\
     * this function will do nothing\\n\\\n\
     */\\n\\\n\
        return;\\n\\\n\
    };\\n\\\n\
    local.objectAssignDefault = function (target, source) {\\n\\\n\
    /*\\n\\\n\
     * this function will if items from <target> are\\n\\\n\
     * null, undefined, or empty-string,\\n\\\n\
     * then overwrite them with items from <source>\\n\\\n\
     */\\n\\\n\
        target = target || {};\\n\\\n\
        Object.keys(source || {}).forEach(function (key) {\\n\\\n\
            if (\\n\\\n\
                target[key] === null\\n\\\n\
                || target[key] === undefined\\n\\\n\
                || target[key] === \"\"\\n\\\n\
            ) {\\n\\\n\
                target[key] = target[key] || source[key];\\n\\\n\
            }\\n\\\n\
        });\\n\\\n\
        return target;\\n\\\n\
    };\\n\\\n\
    // require builtin\\n\\\n\
    if (!local.isBrowser) {\\n\\\n\
        local.assert = require(\"assert\");\\n\\\n\
        local.buffer = require(\"buffer\");\\n\\\n\
        local.child_process = require(\"child_process\");\\n\\\n\
        local.cluster = require(\"cluster\");\\n\\\n\
        local.crypto = require(\"crypto\");\\n\\\n\
        local.dgram = require(\"dgram\");\\n\\\n\
        local.dns = require(\"dns\");\\n\\\n\
        local.domain = require(\"domain\");\\n\\\n\
        local.events = require(\"events\");\\n\\\n\
        local.fs = require(\"fs\");\\n\\\n\
        local.http = require(\"http\");\\n\\\n\
        local.https = require(\"https\");\\n\\\n\
        local.net = require(\"net\");\\n\\\n\
        local.os = require(\"os\");\\n\\\n\
        local.path = require(\"path\");\\n\\\n\
        local.querystring = require(\"querystring\");\\n\\\n\
        local.readline = require(\"readline\");\\n\\\n\
        local.repl = require(\"repl\");\\n\\\n\
        local.stream = require(\"stream\");\\n\\\n\
        local.string_decoder = require(\"string_decoder\");\\n\\\n\
        local.timers = require(\"timers\");\\n\\\n\
        local.tls = require(\"tls\");\\n\\\n\
        local.tty = require(\"tty\");\\n\\\n\
        local.url = require(\"url\");\\n\\\n\
        local.util = require(\"util\");\\n\\\n\
        local.vm = require(\"vm\");\\n\\\n\
        local.zlib = require(\"zlib\");\\n\\\n\
    }\\n\\\n\
}(this));\\n\\\n\
'\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.example.html\"] = \"\";\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.example.template.js\"] = '\\\n\
/*\\n\\\n\
example.js\\n\\\n\
\\n\\\n\
this script will run a web-demo of my-app-lite\\n\\\n\
\\n\\\n\
instruction\\n\\\n\
    1. save this script as example.js\\n\\\n\
    2. run shell-command:\\n\\\n\
        $ npm install my-app-lite && PORT=8081 node example.js\\n\\\n\
    3. open a browser to http://127.0.0.1:8081 and play with web-demo\\n\\\n\
    4. edit this script to suit your needs\\n\\\n\
*/\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
/* istanbul instrument in package my_app */\\n\\\n\
/* istanbul ignore next */\\n\\\n\
/* jslint utility2:true */\\n\\\n\
' + local.assetsDict[\"/assets.example.begin.js\"] + '\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
(function (local) {\\n\\\n\
\"use strict\";\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// run shared js\\-env code - init-before\\n\\\n\
(function () {\\n\\\n\
// init local\\n\\\n\
local = (\\n\\\n\
    globalThis.utility2_rollup\\n\\\n\
    || globalThis.utility2_my_app\\n\\\n\
    || require(\"my-app-lite\")\\n\\\n\
);\\n\\\n\
// init exports\\n\\\n\
globalThis.local = local;\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
/* istanbul ignore next */\\n\\\n\
// run browser js\\-env code - init-test\\n\\\n\
(function () {\\n\\\n\
if (!local.isBrowser) {\\n\\\n\
    return;\\n\\\n\
}\\n\\\n\
// log stderr and stdout to #outputStdout1\\n\\\n\
[\"error\", \"log\"].forEach(function (key) {\\n\\\n\
    var argList;\\n\\\n\
    var elem;\\n\\\n\
    var fnc;\\n\\\n\
    elem = document.querySelector(\\n\\\n\
        \"#outputStdout1\"\\n\\\n\
    );\\n\\\n\
    if (!elem) {\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    fnc = console[key];\\n\\\n\
    console[key] = function () {\\n\\\n\
        argList = Array.from(arguments); // jslint ignore:line\\n\\\n\
        fnc.apply(console, argList);\\n\\\n\
        // append text to #outputStdout1\\n\\\n\
        elem.textContent += argList.map(function (arg) {\\n\\\n\
            return (\\n\\\n\
                typeof arg === \"string\"\\n\\\n\
                ? arg\\n\\\n\
                : JSON.stringify(arg, null, 4)\\n\\\n\
            );\\n\\\n\
        }).join(\" \").replace((\\n\\\n\
            /\\\\u001b\\\\[\\\\d*m/g\\n\\\n\
        ), \"\") + \"\\\\n\";\\n\\\n\
        // scroll textarea to bottom\\n\\\n\
        elem.scrollTop = elem.scrollHeight;\\n\\\n\
    };\\n\\\n\
});\\n\\\n\
Object.assign(local, globalThis.domOnEventDelegateDict);\\n\\\n\
globalThis.domOnEventDelegateDict = local;\\n\\\n\
local.onEventDomDb = (\\n\\\n\
    local.db && local.db.onEventDomDb\\n\\\n\
);\\n\\\n\
local.testRunBrowser = function (evt) {\\n\\\n\
/*\\n\\\n\
 * this function will run browser-tests\\n\\\n\
 */\\n\\\n\
    switch (\\n\\\n\
        !evt.ctrlKey\\n\\\n\
        && !evt.metaKey\\n\\\n\
        && (\\n\\\n\
            evt.modeInit\\n\\\n\
            || (evt.type + \".\" + (evt.target && evt.target.id))\\n\\\n\
        )\\n\\\n\
    ) {\\n\\\n\
    // custom-case\\n\\\n\
    case true:\\n\\\n\
        return;\\n\\\n\
    // run browser-tests\\n\\\n\
    default:\\n\\\n\
        if (\\n\\\n\
            (evt.target && evt.target.id) !== \"testRunButton1\"\\n\\\n\
            && !(evt.modeInit && (\\n\\\n\
                /\\\\bmodeTest=1\\\\b/\\n\\\n\
            ).test(location.search))\\n\\\n\
        ) {\\n\\\n\
            return;\\n\\\n\
        }\\n\\\n\
        // show browser-tests\\n\\\n\
        if (document.querySelector(\\n\\\n\
            \"#testReportDiv1\"\\n\\\n\
        ).style.maxHeight === \"0px\") {\\n\\\n\
            globalThis.domOnEventDelegateDict.domOnEventResetOutput();\\n\\\n\
            local.uiAnimateSlideDown(document.querySelector(\\n\\\n\
                \"#testReportDiv1\"\\n\\\n\
            ));\\n\\\n\
            document.querySelector(\\n\\\n\
                \"#testRunButton1\"\\n\\\n\
            ).textContent = \"hide internal test\";\\n\\\n\
            local.modeTest = 1;\\n\\\n\
            local.testRunDefault(local);\\n\\\n\
            return;\\n\\\n\
        }\\n\\\n\
        // hide browser-tests\\n\\\n\
        local.uiAnimateSlideUp(document.querySelector(\\n\\\n\
            \"#testReportDiv1\"\\n\\\n\
        ));\\n\\\n\
        document.querySelector(\\n\\\n\
            \"#testRunButton1\"\\n\\\n\
        ).textContent = \"run internal test\";\\n\\\n\
    }\\n\\\n\
};\\n\\\n\
\\n\\\n\
local.testRunBrowser({\\n\\\n\
    modeInit: true\\n\\\n\
});\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
/* istanbul ignore next */\\n\\\n\
// run node js\\-env code - init-test\\n\\\n\
(function () {\\n\\\n\
if (local.isBrowser) {\\n\\\n\
    return;\\n\\\n\
}\\n\\\n\
// init exports\\n\\\n\
module.exports = local;\\n\\\n\
/* validateLineSortedReset */\\n\\\n\
// init assets\\n\\\n\
local.assetsDict = local.assetsDict || {};\\n\\\n\
[\\n\\\n\
    \"assets.index.template.html\",\\n\\\n\
    \"assets.swgg.swagger.json\",\\n\\\n\
    \"assets.swgg.swagger.server.json\"\\n\\\n\
].forEach(function (file) {\\n\\\n\
    file = \"/\" + file;\\n\\\n\
    local.assetsDict[file] = local.assetsDict[file] || \"\";\\n\\\n\
    if (local.fs.existsSync(local.__dirname + file)) {\\n\\\n\
        local.assetsDict[file] = local.fs.readFileSync(\\n\\\n\
            local.__dirname + file,\\n\\\n\
            \"utf8\"\\n\\\n\
        );\\n\\\n\
    }\\n\\\n\
});\\n\\\n\
/* jslint ignore:start */\\n\\\n\
local.assetsDict[\"/assets.index.template.html\"] = \\'\\\\\\n\\\n\
' + local.assetsDict[\"/assets.index.template.html\"].replace((/\\n/g), \"\\\\n\\\\\\n\") + '\\';\\n\\\n\
/* jslint ignore:end */\\n\\\n\
/* validateLineSortedReset */\\n\\\n\
/* jslint ignore:start */\\n\\\n\
local.assetsDict[\"/assets.my_app.js\"] =\\n\\\n\
    local.assetsDict[\"/assets.my_app.js\"] ||\\n\\\n\
    local.fs.readFileSync(local.__dirname + \"/lib.my_app.js\", \"utf8\"\\n\\\n\
).replace((/^#!\\\\//), \"// \");\\n\\\n\
/* jslint ignore:end */\\n\\\n\
/* validateLineSortedReset */\\n\\\n\
local.assetsDict[\"/\"] = local.assetsDict[\"/assets.index.template.html\"]\\n\\\n\
.replace((\\n\\\n\
    /\\\\{\\\\{env\\\\.(\\\\w+?)\\\\}\\\\}/g\\n\\\n\
), function (match0, match1) {\\n\\\n\
    switch (match1) {\\n\\\n\
    case \"npm_package_description\":\\n\\\n\
        return \"the greatest app in the world!\";\\n\\\n\
    case \"npm_package_name\":\\n\\\n\
        return \"my-app-lite\";\\n\\\n\
    case \"npm_package_nameLib\":\\n\\\n\
        return \"my_app\";\\n\\\n\
    case \"npm_package_version\":\\n\\\n\
        return \"0.0.1\";\\n\\\n\
    default:\\n\\\n\
        return match0;\\n\\\n\
    }\\n\\\n\
});\\n\\\n\
local.assetsDict[\"/assets.example.html\"] = local.assetsDict[\"/\"];\\n\\\n\
local.assetsDict[\"/index.html\"] = local.assetsDict[\"/\"];\\n\\\n\
// init cli\\n\\\n\
if (module !== require.main || globalThis.utility2_rollup) {\\n\\\n\
    return;\\n\\\n\
}\\n\\\n\
/* validateLineSortedReset */\\n\\\n\
local.assetsDict[\"/assets.example.js\"] = (\\n\\\n\
    local.assetsDict[\"/assets.example.js\"]\\n\\\n\
    || local.fs.readFileSync(__filename, \"utf8\")\\n\\\n\
);\\n\\\n\
local.assetsDict[\"/favicon.ico\"] = local.assetsDict[\"/favicon.ico\"] || \"\";\\n\\\n\
// if $npm_config_timeout_exit exists,\\n\\\n\
// then exit this process after $npm_config_timeout_exit ms\\n\\\n\
if (Number(process.env.npm_config_timeout_exit)) {\\n\\\n\
    setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\\n\\\n\
}\\n\\\n\
// start server\\n\\\n\
if (globalThis.utility2_serverHttp1) {\\n\\\n\
    return;\\n\\\n\
}\\n\\\n\
process.env.PORT = process.env.PORT || \"8081\";\\n\\\n\
console.error(\"http-server listening on port \" + process.env.PORT);\\n\\\n\
local.http.createServer(function (req, res) {\\n\\\n\
    req.urlParsed = local.url.parse(req.url);\\n\\\n\
    if (local.assetsDict[req.urlParsed.pathname] !== undefined) {\\n\\\n\
        res.end(local.assetsDict[req.urlParsed.pathname]);\\n\\\n\
        return;\\n\\\n\
    }\\n\\\n\
    res.statusCode = 404;\\n\\\n\
    res.end();\\n\\\n\
}).listen(process.env.PORT);\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
}());\\n\\\n\
';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.my_app.template.js\"] = '\\\n\
#!/usr/bin/env node\\n\\\n\
/*\\n\\\n\
 * lib.my_app.js ({{packageJson.version}})\\n\\\n\
 * https://github.com/kaizhu256/node-my-app-lite\\n\\\n\
 * {{packageJson.description}}\\n\\\n\
 *\\n\\\n\
 */\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
/* istanbul instrument in package my_app */\\n\\\n\
/* istanbul ignore next */\\n\\\n\
/* jslint utility2:true */\\n\\\n\
' + local.assetsDict[\"/assets.example.begin.js\"] + '\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
(function (local) {\\n\\\n\
\"use strict\";\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
/* istanbul ignore next */\\n\\\n\
// run shared js\\-env code - init-before\\n\\\n\
(function () {\\n\\\n\
// init local\\n\\\n\
local = (\\n\\\n\
    globalThis.utility2_rollup\\n\\\n\
    // || globalThis.utility2_rollup_old\\n\\\n\
    // || require(\"./assets.utility2.rollup.js\")\\n\\\n\
    || globalThis.globalLocal\\n\\\n\
);\\n\\\n\
// init exports\\n\\\n\
if (local.isBrowser) {\\n\\\n\
    globalThis.utility2_my_app = local;\\n\\\n\
} else {\\n\\\n\
    module.exports = local;\\n\\\n\
    module.exports.__dirname = __dirname;\\n\\\n\
}\\n\\\n\
// init lib main\\n\\\n\
local.my_app = local;\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
/* validateLineSortedReset */\\n\\\n\
return;\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
}());\\n\\\n\
';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.readme.template.md\"] = '\\\n\
# my-app-lite\\n\\\n\
the greatest app in the world!\\n\\\n\
\\n\\\n\
# live web demo\\n\\\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app)\\n\\\n\
\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app)\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
[![travis-ci.org build-status](https://api.travis-ci.org/kaizhu256/node-my-app-lite.svg)](https://travis-ci.org/kaizhu256/node-my-app-lite) [![coverage](https://kaizhu256.github.io/node-my-app-lite/build/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build/coverage.html/index.html)\\n\\\n\
\\n\\\n\
[![NPM](https://nodei.co/npm/my-app-lite.png?downloads=true)](https://www.npmjs.com/package/my-app-lite)\\n\\\n\
\\n\\\n\
[![build commit status](https://kaizhu256.github.io/node-my-app-lite/build/build.badge.svg)](https://travis-ci.org/kaizhu256/node-my-app-lite)\\n\\\n\
\\n\\\n\
| git-branch : | [master](https://github.com/kaizhu256/node-my-app-lite/tree/master) | [beta](https://github.com/kaizhu256/node-my-app-lite/tree/beta) | [alpha](https://github.com/kaizhu256/node-my-app-lite/tree/alpha)|\\n\\\n\
|--:|:--|:--|:--|\\n\\\n\
| test-server-github : | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/app) | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app) | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/app)|\\n\\\n\
| test-server-heroku : | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-master.herokuapp.com) | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-beta.herokuapp.com) | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-alpha.herokuapp.com)|\\n\\\n\
| test-report : | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/test-report.html) | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/test-report.html) | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/test-report.html)|\\n\\\n\
| coverage : | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/coverage.html/index.html) | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/coverage.html/index.html) | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/coverage.html/index.html)|\\n\\\n\
| build-artifacts : | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..master..travis-ci.org) | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..beta..travis-ci.org) | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..alpha..travis-ci.org)|\\n\\\n\
\\n\\\n\
[![npmPackageListing](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageListing.svg)](https://github.com/kaizhu256/node-my-app-lite)\\n\\\n\
\\n\\\n\
![npmPackageDependencyTree](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageDependencyTree.svg)\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# table of contents\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# cdn download\\n\\\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.my_app.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.my_app.js)\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# documentation\\n\\\n\
#### cli help\\n\\\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageCliHelp.svg)\\n\\\n\
\\n\\\n\
#### api doc\\n\\\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html)\\n\\\n\
\\n\\\n\
[![apidoc](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html)\\n\\\n\
\\n\\\n\
#### swagger doc\\n\\\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html)\\n\\\n\
\\n\\\n\
[![swaggerdoc](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html)\\n\\\n\
\\n\\\n\
#### todo\\n\\\n\
- none\\n\\\n\
\\n\\\n\
#### changelog 0.0.1\\n\\\n\
- npm publish 0.0.1\\n\\\n\
- update build\\n\\\n\
- none\\n\\\n\
\\n\\\n\
#### this package requires\\n\\\n\
- darwin or linux os\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# quickstart standalone app\\n\\\n\
#### to run this example, follow instruction in script below\\n\\\n\
- [assets.app.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.app.js)\\n\\\n\
```shell\\n\\\n\
# example.sh\\n\\\n\
\\n\\\n\
# this shell script will download and run a web-demo of my-app-lite as a standalone app\\n\\\n\
\\n\\\n\
# 1. download standalone app\\n\\\n\
curl -O https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.app.js\\n\\\n\
# 2. run standalone app\\n\\\n\
PORT=8081 node ./assets.app.js\\n\\\n\
# 3. open a browser to http://127.0.0.1:8081 and play with web-demo\\n\\\n\
# 4. edit file assets.app.js to suit your needs\\n\\\n\
```\\n\\\n\
\\n\\\n\
#### output from browser\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\\n\\\n\
\\n\\\n\
#### output from shell\\n\\\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.svg)\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# quickstart example.js\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\\n\\\n\
\\n\\\n\
#### to run this example, follow instruction in script below\\n\\\n\
- [example.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/example.js)\\n\\\n\
```javascript\\n' + local.assetsDict[\"/assets.example.template.js\"] + '```\\n\\\n\
\\n\\\n\
#### output from browser\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\\n\\\n\
\\n\\\n\
#### output from shell\\n\\\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.svg)\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# extra screenshots\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)\\n\\\n\
\\n\\\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# package.json\\n\\\n\
```json\\n\\\n\
{\\n\\\n\
    \"author\": \"kai zhu <kaizhu256@gmail.com>\",\\n\\\n\
    \"description\": \"the greatest app in the world!\",\\n\\\n\
    \"devDependencies\": {\\n\\\n\
        \"electron-lite\": \"kaizhu256/node-electron-lite#alpha\",\\n\\\n\
        \"utility2\": \"kaizhu256/node-utility2#alpha\"\\n\\\n\
    },\\n\\\n\
    \"engines\": {\\n\\\n\
        \"node\": \">=10.0\"\\n\\\n\
    },\\n\\\n\
    \"homepage\": \"https://github.com/kaizhu256/node-my-app-lite\",\\n\\\n\
    \"keywords\": [],\\n\\\n\
    \"license\": \"MIT\",\\n\\\n\
    \"main\": \"lib.my_app.js\",\\n\\\n\
    \"name\": \"my-app-lite\",\\n\\\n\
    \"nameAliasPublish\": \"\",\\n\\\n\
    \"os\": [\\n\\\n\
        \"darwin\",\\n\\\n\
        \"linux\"\\n\\\n\
    ],\\n\\\n\
    \"repository\": {\\n\\\n\
        \"type\": \"git\",\\n\\\n\
        \"url\": \"https://github.com/kaizhu256/node-my-app-lite.git\"\\n\\\n\
    },\\n\\\n\
    \"scripts\": {\\n\\\n\
        \"build-ci\": \"sh ./npm_scripts.sh\",\\n\\\n\
        \"env\": \"env\",\\n\\\n\
        \"eval\": \"sh ./npm_scripts.sh\",\\n\\\n\
        \"heroku-postbuild\": \"sh ./npm_scripts.sh\",\\n\\\n\
        \"postinstall\": \"sh ./npm_scripts.sh\",\\n\\\n\
        \"start\": \"sh ./npm_scripts.sh\",\\n\\\n\
        \"test\": \"sh ./npm_scripts.sh\",\\n\\\n\
        \"utility2\": \"sh ./npm_scripts.sh\"\\n\\\n\
    },\\n\\\n\
    \"version\": \"0.0.1\"\\n\\\n\
}\\n\\\n\
```\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# changelog of last 50 commits\\n\\\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.gitLog.svg)](https://github.com/kaizhu256/node-my-app-lite/commits)\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# internal build script\\n\\\n\
- build_ci.sh\\n\\\n\
```shell\\n\\\n\
# build_ci.sh\\n\\\n\
\\n\\\n\
# this shell script will run the build for this package\\n\\\n\
\\n\\\n\
shBuildCiAfter () {(set -e\\n\\\n\
    # shDeployCustom\\n\\\n\
    shDeployGithub\\n\\\n\
    # shDeployHeroku\\n\\\n\
    shReadmeTest example.sh\\n\\\n\
)}\\n\\\n\
\\n\\\n\
shBuildCiBefore () {(set -e\\n\\\n\
    # shNpmTestPublished\\n\\\n\
    shReadmeTest example.js\\n\\\n\
)}\\n\\\n\
\\n\\\n\
# run shBuildCi\\n\\\n\
eval \"$(utility2 source)\"\\n\\\n\
shBuildCi\\n\\\n\
```\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
# misc\\n\\\n\
- this package was created with [utility2](https://github.com/kaizhu256/node-utility2)\\n\\\n\
';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.test.template.js\"] = '\\\n\
/* istanbul instrument in package my_app */\\n\\\n\
/* istanbul ignore next */\\n\\\n\
/* jslint utility2:true */\\n\\\n\
' + local.assetsDict[\"/assets.example.begin.js\"] + '\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
(function (local) {\\n\\\n\
\"use strict\";\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// run shared js\\-env code - init-before\\n\\\n\
(function () {\\n\\\n\
// init local\\n\\\n\
local = (\\n\\\n\
    globalThis.utility2 || require(\"utility2\")\\n\\\n\
).requireReadme();\\n\\\n\
globalThis.local = local;\\n\\\n\
// init test\\n\\\n\
local.testRunDefault(local);\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
// run shared js\\-env code - function\\n\\\n\
(function () {\\n\\\n\
return;\\n\\\n\
}());\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
}());\\n\\\n\
';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.testReport.template.html\"] =\n\
    local.assetsDict[\"/assets.utility2.template.html\"]\n\
    .replace(\"assets.utility2.template.html\", \"\")\n\
    .replace((/<title>.*?<\\/title>/), \"<title>test-report</title>\")\n\
    .replace(\"</style>\\n\", '\\\n\
<style>\\n\\\n\
/* jslint utility2:true */\\n\\\n\
/*csslint\\n\\\n\
*/\\n\\\n\
.testReportDiv img {\\n\\\n\
    border: 1px solid black;\\n\\\n\
    margin: 5px 0 5px 0;\\n\\\n\
    max-height: 256px;\\n\\\n\
    max-width: 512px;\\n\\\n\
}\\n\\\n\
.testReportDiv pre {\\n\\\n\
    background: #fdd;\\n\\\n\
    border-top: 1px solid black;\\n\\\n\
    margin-bottom: 0;\\n\\\n\
    padding: 10px;\\n\\\n\
}\\n\\\n\
.testReportDiv span {\\n\\\n\
    display: inline-block;\\n\\\n\
    width: 120px;\\n\\\n\
}\\n\\\n\
.testReportDiv table {\\n\\\n\
    border-top: 1px solid black;\\n\\\n\
    text-align: left;\\n\\\n\
    width: 100%;\\n\\\n\
}\\n\\\n\
.testReportDiv table > tbody > tr:nth-child(odd) {\\n\\\n\
    background: #bfb;\\n\\\n\
}\\n\\\n\
.testReportDiv .displayNone {\\n\\\n\
    display: none;\\n\\\n\
}\\n\\\n\
.testReportDiv .footer {\\n\\\n\
    text-align: center;\\n\\\n\
}\\n\\\n\
.testReportDiv .platform {\\n\\\n\
    background: #fff;\\n\\\n\
    border: 1px solid black;\\n\\\n\
    margin-bottom: 20px;\\n\\\n\
    padding: 0 10px 10px 10px;\\n\\\n\
    text-align: left;\\n\\\n\
}\\n\\\n\
.testReportDiv .summary {\\n\\\n\
    background: #bfb;\\n\\\n\
}\\n\\\n\
.testReportDiv .testFailed {\\n\\\n\
    background: #f99;\\n\\\n\
}\\n\\\n\
.testReportDiv .testPending {\\n\\\n\
    background: #99f;\\n\\\n\
}\\n\\\n\
</style>\\n\\\n\
'.replace(\"<style>\\n\", \"\")).replace((/<\\/script>[\\S\\s]*?<\\/body>/), '\\\n\
</script>\\n\\\n\
<div class=\"testReportDiv\">\\n\\\n\
<h1>test-report for\\n\\\n\
    <a\\n\\\n\
        {{#if env.npm_package_homepage}}\\n\\\n\
        href=\"{{env.npm_package_homepage}}\"\\n\\\n\
        {{/if env.npm_package_homepage}}\\n\\\n\
    >\\n\\\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\\n\\\n\
    </a>\\n\\\n\
</h1>\\n\\\n\
<div class=\"platform summary\">\\n\\\n\
<h2>summary</h2>\\n\\\n\
<h4>\\n\\\n\
    <span>version</span>-\\n\\\n\
        {{env.npm_package_version}}<br>\\n\\\n\
    <span>test date</span>- {{date}}<br>\\n\\\n\
    <span>commit info</span>-\\n\\\n\
        {{#if env.CI_COMMIT_INFO}}\\n\\\n\
        {{env.CI_COMMIT_INFO}}<br>\\n\\\n\
        {{#unless env.CI_COMMIT_INFO}}\\n\\\n\
        undefined<br>\\n\\\n\
        {{/if env.CI_COMMIT_INFO}}\\n\\\n\
</h4>\\n\\\n\
<table>\\n\\\n\
<thead>\\n\\\n\
    <tr>\\n\\\n\
        <th>total time-elapsed</th>\\n\\\n\
        <th>total tests failed</th>\\n\\\n\
        <th>total tests passed</th>\\n\\\n\
        <th>total tests pending</th>\\n\\\n\
    </tr>\\n\\\n\
</thead>\\n\\\n\
<tbody><tr>\\n\\\n\
    <td>{{timeElapsed}} ms</td>\\n\\\n\
    <td class=\"{{testStatusClass}}\">{{testsFailed}}</td>\\n\\\n\
    <td>{{testsPassed}}</td>\\n\\\n\
    <td>{{testsPending}}</td>\\n\\\n\
</tr></tbody>\\n\\\n\
</table>\\n\\\n\
</div>\\n\\\n\
{{#each testPlatformList}}\\n\\\n\
<div class=\"platform\">\\n\\\n\
<h4>\\n\\\n\
    {{testPlatformNumber}}. {{name}}<br>\\n\\\n\
    {{#if screenshot}}\\n\\\n\
    <a href=\"{{screenshot encodeURIComponent}}\">\\n\\\n\
        <img alt=\"{{screenshot encodeURIComponent}}\" src=\"{{screenshot encodeURIComponent}}\">\\n\\\n\
    </a>\\n\\\n\
    <br>\\n\\\n\
    {{/if screenshot}}\\n\\\n\
    {{#if domOnEventWindowOnloadTimeElapsed}}\\n\\\n\
    <span>onload-time</span>- {{domOnEventWindowOnloadTimeElapsed}} ms<br>\\n\\\n\
    {{/if domOnEventWindowOnloadTimeElapsed}}\\n\\\n\
    <span>time-elapsed</span>- {{timeElapsed}} ms<br>\\n\\\n\
    <span>tests failed</span>- {{testsFailed}}<br>\\n\\\n\
    <span>tests passed</span>- {{testsPassed}}<br>\\n\\\n\
    <span>tests pending</span>- {{testsPending}}<br>\\n\\\n\
</h4>\\n\\\n\
<table>\\n\\\n\
<thead><tr>\\n\\\n\
    <th>#</th>\\n\\\n\
    <th>time-elapsed</th>\\n\\\n\
    <th>status</th>\\n\\\n\
    <th>test-case</th>\\n\\\n\
</tr></thead>\\n\\\n\
<tbody>\\n\\\n\
{{#each testCaseList}}\\n\\\n\
<tr>\\n\\\n\
    <td>{{testCaseNumber}}</td>\\n\\\n\
    <td>{{timeElapsed}} ms</td>\\n\\\n\
    <td class=\"{{testReportTestStatusClass}}\">{{status}}</td>\\n\\\n\
    <td>{{name}}</td>\\n\\\n\
</tr>\\n\\\n\
{{/each testCaseList}}\\n\\\n\
</tbody>\\n\\\n\
</table>\\n\\\n\
<pre class=\"{{preClass}}\" tabIndex=\"0\">\\n\\\n\
{{#each errorStackList}}\\n\\\n\
{{errorStack}}\\n\\\n\
{{/each errorStackList}}\\n\\\n\
</pre>\\n\\\n\
</div>\\n\\\n\
{{/each testPlatformList}}\\n\\\n\
<div class=\"footer\">\\n\\\n\
    [ this document was created with\\n\\\n\
    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\\n\
    ]\\n\\\n\
</div>\\n\\\n\
</div>\\n\\\n\
</body>');\n\
\n\
\n\
\n\
// https://img.shields.io/badge/tests_failed-999-dd0000.svg?style=flat\n\
local.assetsDict[\"/assets.testReportBadge.template.svg\"] =\n\
'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"103\" height=\"20\"><linearGradient id=\"a\" x2=\"0\" y2=\"100%\"><stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/><stop offset=\"1\" stop-opacity=\".1\"/></linearGradient><rect rx=\"0\" width=\"103\" height=\"20\" fill=\"#555\"/><rect rx=\"0\" x=\"72\" width=\"31\" height=\"20\" fill=\"#d00\"/><path fill=\"#d00\" d=\"M72 0h4v20h-4z\"/><rect rx=\"0\" width=\"103\" height=\"20\" fill=\"url(#a)\"/><g fill=\"#fff\" text-anchor=\"middle\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\"><text x=\"37\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">tests failed</text><text x=\"37\" y=\"14\">tests failed</text><text x=\"86.5\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">999</text><text x=\"86.5\" y=\"14\">999</text></g></svg>';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.utility2.rollup.begin.js\"] = '\\\n\
/* utility2.rollup.js begin */\\n\\\n\
/* istanbul ignore all */\\n\\\n\
/* jslint utility2:true */\\n\\\n\
' + local.assetsDict[\"/assets.example.begin.js\"] + '\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
(function () {\\n\\\n\
    \"use strict\";\\n\\\n\
    // init utility2_rollup\\n\\\n\
    globalThis.utility2_rollup = (\\n\\\n\
        globalThis.utility2_rollup_old\\n\\\n\
        || globalThis.globalLocal\\n\\\n\
    );\\n\\\n\
    globalThis.utility2_rollup.local = globalThis.utility2_rollup;\\n\\\n\
    globalThis.utility2_rollup_old = null;\\n\\\n\
}());\\n\\\n\
';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.utility2.rollup.content.js\"] = '\\\n\
(function (local) {\\n\\\n\
    \"use strict\";\\n\\\n\
/* jslint ignore:start */\\n\\\n\
/* utility2.rollup.js content */\\n\\\n\
/* jslint ignore:end */\\n\\\n\
    return local;\\n\\\n\
}(globalThis.utility2_rollup));\\n\\\n\
';\n\
\n\
\n\
\n\
local.assetsDict[\"/assets.utility2.rollup.end.js\"] = '\\\n\
(function () {\\n\\\n\
    \"use strict\";\\n\\\n\
    globalThis.utility2_rollup_old = globalThis.utility2_rollup;\\n\\\n\
    globalThis.utility2_rollup = null;\\n\\\n\
}());\\n\\\n\
/* utility2.rollup.js end */\\n\\\n\
';\n\
\n\
\n\
\n\
local.assetsDict[\"/favicon.ico\"] = \"\";\n\
/* jslint ignore:end */\n\
\n\
\n\
\n\
local.cliDict = {};\n\
\n\
local.cliDict[\"utility2.browserTest\"] = function () {\n\
/*\n\
 * <urlList> <mode>\n\
 * will browser-test in parallel, comma-separated <urlList> with given <mode>\n\
 */\n\
    process.argv[3].split(\n\
        process.argv[3].indexOf(\"?\") >= 0\n\
        ? (\n\
            /\\s/g\n\
        )\n\
        : (\n\
            /[,\\s]/g\n\
        )\n\
    ).filter(local.identity).forEach(function (url) {\n\
        local.browserTest({\n\
            url\n\
        }, local.onErrorDefault);\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.githubCrudContentDelete\"] = function () {\n\
/*\n\
 * <fileRemote|dirRemote> <commitMessage>\n\
 * will delete from github <fileRemote|dirRemote>\n\
 */\n\
    local.github_crud.githubCrudContentDelete({\n\
        message: process.argv[4],\n\
        url: process.argv[3]\n\
    }, function (err) {\n\
        process.exit(Boolean(err));\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.githubCrudContentGet\"] = function () {\n\
/*\n\
 * <fileRemote>\n\
 * will get from github <fileRemote>\n\
 */\n\
    local.github_crud.githubCrudContentGet({\n\
        url: process.argv[3]\n\
    }, function (err, data) {\n\
        try {\n\
            process.stdout.write(data);\n\
        } catch (ignore) {}\n\
        process.exit(Boolean(err));\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.githubCrudContentPut\"] = function () {\n\
/*\n\
 * <fileRemote> <fileLocal> <commitMessage>\n\
 * will put on github <fileRemote>, <fileLocal>\n\
 */\n\
    local.github_crud.githubCrudContentPutFile({\n\
        message: process.argv[5],\n\
        url: process.argv[3],\n\
        file: process.argv[4]\n\
    }, function (err) {\n\
        process.exit(Boolean(err));\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.githubCrudContentTouch\"] = function () {\n\
/*\n\
 * <fileRemoteList> <commitMessage>\n\
 * will touch on github in parallel, comma-separated <fileRemoteList>\n\
 */\n\
    local.github_crud.githubCrudContentTouchList({\n\
        message: process.argv[4],\n\
        urlList: process.argv[3].split(\n\
            /[,\\s]/g\n\
        ).filter(local.identity)\n\
    }, function (err) {\n\
        process.exit(Boolean(err));\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.githubCrudRepoCreate\"] = function () {\n\
/*\n\
 * <repoList>\n\
 * will create on github in parallel, comma-separated <repoList>\n\
 */\n\
    local.github_crud.githubCrudRepoCreateList({\n\
        urlList: process.argv[3].split(\n\
            /[,\\s]/g\n\
        ).filter(local.identity)\n\
    }, function (err) {\n\
        process.exit(Boolean(err));\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.githubCrudRepoDelete\"] = function () {\n\
/*\n\
 * <repoList>\n\
 * will delete from github in parallel, comma-separated <repoList>\n\
 */\n\
    local.github_crud.githubCrudRepoDeleteList({\n\
        urlList: process.argv[3].split(\n\
            /[,\\s]/g\n\
        ).filter(local.identity)\n\
    }, function (err) {\n\
        process.exit(Boolean(err));\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.start\"] = function () {\n\
/*\n\
 * <port>\n\
 * will start utility2 http-server on given <port> (default 8081)\n\
 */\n\
    local.env.PORT = process.argv[3] || local.env.PORT;\n\
    globalThis.local = local;\n\
    local.replStart();\n\
    local.testRunServer({});\n\
};\n\
\n\
local.cliDict[\"utility2.swaggerValidateFile\"] = function () {\n\
/*\n\
 * <file/url>\n\
 * will swagger-validate file/url\n\
 */\n\
    setTimeout(function () {\n\
        local.swgg.swaggerValidateFile({\n\
            file: process.argv[3]\n\
        }, function (err, data) {\n\
            console.error(data);\n\
            process.exit(err);\n\
        });\n\
    });\n\
};\n\
\n\
local.cliDict[\"utility2.testReportCreate\"] = function () {\n\
/*\n\
 *\n\
 * will create test-report\n\
 */\n\
    local.exit(\n\
        local.testReportCreate(\n\
            JSON.parse(local.fs.readFileSync(\n\
                local.env.npm_config_dir_build + \"/test-report.json\"\n\
            ))\n\
        ).testsFailed\n\
    );\n\
};\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run shared js-env code - polyfill\n\
(function () {\n\
    var ArrayPrototypeFlat;\n\
    var TextXxcoder;\n\
    ArrayPrototypeFlat = function (depth) {\n\
    /*\n\
     * this function will polyfill Array.prototype.flat\n\
     * https://github.com/jonathantneal/array-flat-polyfill\n\
     */\n\
        depth = (\n\
            globalThis.isNaN(depth)\n\
            ? 1\n\
            : Number(depth)\n\
        );\n\
        if (!depth) {\n\
            return Array.prototype.slice.call(this);\n\
        }\n\
        return Array.prototype.reduce.call(this, function (acc, cur) {\n\
            if (Array.isArray(cur)) {\n\
                // recurse\n\
                acc.push.apply(acc, ArrayPrototypeFlat.call(cur, depth - 1));\n\
            } else {\n\
                acc.push(cur);\n\
            }\n\
            return acc;\n\
        }, []);\n\
    };\n\
    Array.prototype.flat = Array.prototype.flat || ArrayPrototypeFlat;\n\
    Array.prototype.flatMap = Array.prototype.flatMap || function flatMap(\n\
        ...argList\n\
    ) {\n\
    /*\n\
     * this function will polyfill Array.prototype.flatMap\n\
     * https://github.com/jonathantneal/array-flat-polyfill\n\
     */\n\
        return this.map(...argList).flat();\n\
    };\n\
    if (!local.isBrowser) {\n\
        globalThis.TextDecoder = (\n\
            globalThis.TextDecoder || require(\"util\").TextDecoder\n\
        );\n\
        globalThis.TextEncoder = (\n\
            globalThis.TextEncoder || require(\"util\").TextEncoder\n\
        );\n\
    }\n\
    TextXxcoder = function () {\n\
    /*\n\
     * this function will polyfill TextDecoder/TextEncoder\n\
     * https://gist.github.com/Yaffle/5458286\n\
     */\n\
        return;\n\
    };\n\
    TextXxcoder.prototype.decode = function (octets) {\n\
    /*\n\
     * this function will polyfill TextDecoder.prototype.decode\n\
     * https://gist.github.com/Yaffle/5458286\n\
     */\n\
        var bytesNeeded;\n\
        var codePoint;\n\
        var ii;\n\
        var kk;\n\
        var octet;\n\
        var string;\n\
        string = \"\";\n\
        ii = 0;\n\
        while (ii < octets.length) {\n\
            octet = octets[ii];\n\
            bytesNeeded = 0;\n\
            codePoint = 0;\n\
            if (octet <= 0x7F) {\n\
                bytesNeeded = 0;\n\
                codePoint = octet & 0xFF;\n\
            } else if (octet <= 0xDF) {\n\
                bytesNeeded = 1;\n\
                codePoint = octet & 0x1F;\n\
            } else if (octet <= 0xEF) {\n\
                bytesNeeded = 2;\n\
                codePoint = octet & 0x0F;\n\
            } else if (octet <= 0xF4) {\n\
                bytesNeeded = 3;\n\
                codePoint = octet & 0x07;\n\
            }\n\
            if (octets.length - ii - bytesNeeded > 0) {\n\
                kk = 0;\n\
                while (kk < bytesNeeded) {\n\
                    octet = octets[ii + kk + 1];\n\
                    codePoint = (codePoint << 6) | (octet & 0x3F);\n\
                    kk += 1;\n\
                }\n\
            } else {\n\
                codePoint = 0xFFFD;\n\
                bytesNeeded = octets.length - ii;\n\
            }\n\
            string += String.fromCodePoint(codePoint);\n\
            ii += bytesNeeded + 1;\n\
        }\n\
        return string;\n\
    };\n\
    TextXxcoder.prototype.encode = function (string) {\n\
    /*\n\
     * this function will polyfill TextEncoder.prototype.encode\n\
     * https://gist.github.com/Yaffle/5458286\n\
     */\n\
        var bits;\n\
        var cc;\n\
        var codePoint;\n\
        var ii;\n\
        var length;\n\
        var octets;\n\
        octets = [];\n\
        length = string.length;\n\
        ii = 0;\n\
        while (ii < length) {\n\
            codePoint = string.codePointAt(ii);\n\
            cc = 0;\n\
            bits = 0;\n\
            if (codePoint <= 0x0000007F) {\n\
                cc = 0;\n\
                bits = 0x00;\n\
            } else if (codePoint <= 0x000007FF) {\n\
                cc = 6;\n\
                bits = 0xC0;\n\
            } else if (codePoint <= 0x0000FFFF) {\n\
                cc = 12;\n\
                bits = 0xE0;\n\
            } else if (codePoint <= 0x001FFFFF) {\n\
                cc = 18;\n\
                bits = 0xF0;\n\
            }\n\
            octets.push(bits | (codePoint >> cc));\n\
            cc -= 6;\n\
            while (cc >= 0) {\n\
                octets.push(0x80 | ((codePoint >> cc) & 0x3F));\n\
                cc -= 6;\n\
            }\n\
            ii += (\n\
                codePoint >= 0x10000\n\
                ? 2\n\
                : 1\n\
            );\n\
        }\n\
        return octets;\n\
    };\n\
    globalThis.TextDecoder = globalThis.TextDecoder || TextXxcoder;\n\
    globalThis.TextEncoder = globalThis.TextEncoder || TextXxcoder;\n\
}());\n\
\n\
\n\
\n\
// run shared js-env code - function\n\
(function () {\n\
// init lib Blob\n\
local.Blob = (\n\
    local.isBrowser\n\
    ? globalThis.Blob\n\
    : function (array, opt) {\n\
        /*\n\
         * this function will create a node-compatible Blob instance\n\
         * https://developer.mozilla.org/en-US/docs/Web/API/Blob/Blob\n\
         */\n\
        this.bff = local.bufferConcat(array.map(function (elem) {\n\
            return (\n\
                // ternary-operator\n\
                (\n\
                    typeof elem === \"string\"\n\
                    || Object.prototype.toString.call(elem)\n\
                    === \"[object Uint8Array]\"\n\
                )\n\
                ? elem\n\
                : String(elem)\n\
            );\n\
        }));\n\
        this.type = opt && opt.type;\n\
    }\n\
);\n\
\n\
// init lib FormData\n\
local.FormData = function () {\n\
/*\n\
 * this function will create a serverLocal-compatible FormData instance\n\
 * The FormData(form) constructor must run these steps:\n\
 * 1. Let fd be a new FormData object.\n\
 * 2. If form is given, set fd's entries to the result\n\
 *    of constructing the form data set for form. (not implemented)\n\
 * 3. Return fd.\n\
 * https://xhr.spec.whatwg.org/#dom-formdata\n\
 */\n\
    this.entryList = [];\n\
};\n\
\n\
local.FormData.prototype.append = function (name, value, filename) {\n\
/*\n\
 * The append(name, value, filename) method, when invoked, must run these steps:\n\
 * 1. If the filename argument is given, set value to a new File object\n\
 *    whose contents are value and name is filename.\n\
 * 2. Append a new entry whose name is name, and value is value,\n\
 *    to context object's list of entries.\n\
 * https://xhr.spec.whatwg.org/#dom-formdata-append\n\
 */\n\
    if (filename) {\n\
        // bug-workaround - chromium cannot assign name to Blob instance\n\
        local.tryCatchOnError(function () {\n\
            value.name = filename;\n\
        }, local.nop);\n\
    }\n\
    this.entryList.push({\n\
        name,\n\
        value\n\
    });\n\
};\n\
\n\
local.FormData.prototype.read = function (onError) {\n\
/*\n\
 * this function will read from formData as a buffer, e.g.\n\
 * --Boundary\\r\\n\n\
 * Content-Disposition: form-data; name=\"key\"\\r\\n\n\
 * \\r\\n\n\
 * value\\r\\n\n\
 * --Boundary\\r\\n\n\
 * Content-Disposition: form-data; name=\"input1\"; filename=\"file1.png\"\\r\\n\n\
 * Content-Type: image/jpeg\\r\\n\n\
 * \\r\\n\n\
 * <data1>\\r\\n\n\
 * --Boundary\\r\\n\n\
 * Content-Disposition: form-data; name=\"input2\"; filename=\"file2.png\"\\r\\n\n\
 * Content-Type: image/jpeg\\r\\n\n\
 * \\r\\n\n\
 * <data2>\\r\\n\n\
 * --Boundary--\\r\\n\n\
 * https://tools.ietf.org/html/rfc7578\n\
 */\n\
    var boundary;\n\
    var result;\n\
    // handle null-case\n\
    if (!this.entryList.length) {\n\
        onError(null, \"\");\n\
        return;\n\
    }\n\
    // init boundary\n\
    boundary = \"--\" + Date.now().toString(16) + Math.random().toString(16);\n\
    // init result\n\
    result = [];\n\
    local.onParallelList({\n\
        list: this.entryList\n\
    }, function (option2, onParallel) {\n\
        var value;\n\
        value = option2.elem.value;\n\
        if (!(value && value.constructor === local.Blob)) {\n\
            result[option2.ii] = [\n\
                (\n\
                    boundary + \"\\r\\nContent-Disposition: form-data; name=\\\"\"\n\
                    + option2.elem.name + \"\\\"\\r\\n\\r\\n\"\n\
                ), value, \"\\r\\n\"\n\
            ];\n\
            onParallel.counter += 1;\n\
            onParallel();\n\
            return;\n\
        }\n\
        // read from blob in parallel\n\
        onParallel.counter += 1;\n\
        local.blobRead(value, function (err, data) {\n\
            result[option2.ii] = !err && [\n\
                (\n\
                    boundary + \"\\r\\nContent-Disposition: form-data; name=\\\"\"\n\
                    + option2.elem.name + \"\\\"\" + (\n\
                        (value && value.name)\n\
                        // read param filename\n\
                        ? \"; filename=\\\"\" + value.name + \"\\\"\"\n\
                        : \"\"\n\
                    ) + \"\\r\\n\" + (\n\
                        (value && value.type)\n\
                        // read param Content-Type\n\
                        ? \"Content-Type: \" + value.type + \"\\r\\n\"\n\
                        : \"\"\n\
                    ) + \"\\r\\n\"\n\
                ), data, \"\\r\\n\"\n\
            ];\n\
            onParallel(err);\n\
        });\n\
    }, function (err) {\n\
        // add closing boundary\n\
        result.push([\n\
            boundary + \"--\\r\\n\"\n\
        ]);\n\
        // concatenate result\n\
        onError(\n\
            err,\n\
            // flatten result\n\
            !err\n\
            && local.bufferConcat(Array.prototype.concat.apply([], result))\n\
        );\n\
    });\n\
};\n\
\n\
// init lib _http\n\
local._http = {};\n\
\n\
// init _http.IncomingMessage\n\
local._http.IncomingMessage = function (xhr) {\n\
/*\n\
 * An IncomingMessage object is created by http.Server or http.ClientRequest\n\
 * and passed as the first argument to the 'req' and 'res' event\n\
 * respectively.\n\
 * It may be used to access res status, headers and data.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_http_incomingmessage\n\
 */\n\
    this.headers = xhr.headers;\n\
    this.httpVersion = \"1.1\";\n\
    this.method = xhr.method;\n\
    this.onEvent = document.createDocumentFragment();\n\
    this.readable = true;\n\
    this.url = xhr.url;\n\
};\n\
\n\
local._http.IncomingMessage.prototype.addListener = function (evt, onEvent) {\n\
/*\n\
 * Adds a listener to the end of the listeners array for the specified event.\n\
 * No checks are made to see if the listener has already been added.\n\
 * Multiple calls passing the same combination of event and listener will result\n\
 * in the listener being added multiple times.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_addlistener_event_listener\n\
 */\n\
    this.onEvent.addEventListener(evt, function (evt) {\n\
        onEvent(evt.data);\n\
    });\n\
    if (this.readable && evt === \"end\") {\n\
        this.readable = null;\n\
        this.emit(\"data\", this.data);\n\
        this.emit(\"end\");\n\
    }\n\
    return this;\n\
};\n\
\n\
local._http.IncomingMessage.prototype.emit = function (evt, data) {\n\
/*\n\
 * Execute each of the listeners in order with the supplied arguments.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_emit_event_arg1_arg2\n\
 */\n\
    evt = new Event(evt);\n\
    evt.data = data;\n\
    this.onEvent.dispatchEvent(evt);\n\
};\n\
\n\
/*\n\
 * Adds a listener to the end of the listeners array for the specified event.\n\
 * No checks are made to see if the listener has already been added.\n\
 * Multiple calls passing the same combination of event and listener will result\n\
 * in the listener being added multiple times.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_on_event_listener\n\
 */\n\
local._http.IncomingMessage.prototype.on = (\n\
    local._http.IncomingMessage.prototype.addListener\n\
);\n\
\n\
local._http.IncomingMessage.prototype.pipe = function (writable) {\n\
/*\n\
 * This method pulls all the data out of a readable stream, and writes it\n\
 * to the supplied destination, automatically managing the flow\n\
 * so that the destination is not overwhelmed by a fast readable stream.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_readable_pipe_destination_options\n\
 */\n\
    this.on(\"data\", function (chunk) {\n\
        writable.write(chunk);\n\
    });\n\
    this.on(\"end\", function () {\n\
        writable.end();\n\
    });\n\
    return writable;\n\
};\n\
\n\
local._http.STATUS_CODES = {\n\
    \"100\": \"Continue\",\n\
    \"101\": \"Switching Protocols\",\n\
    \"102\": \"Processing\",\n\
    \"200\": \"OK\",\n\
    \"201\": \"Created\",\n\
    \"202\": \"Accepted\",\n\
    \"203\": \"Non-Authoritative Information\",\n\
    \"204\": \"No Content\",\n\
    \"205\": \"Reset Content\",\n\
    \"206\": \"Partial Content\",\n\
    \"207\": \"Multi-Status\",\n\
    \"208\": \"Already Reported\",\n\
    \"226\": \"IM Used\",\n\
    \"300\": \"Multiple Choices\",\n\
    \"301\": \"Moved Permanently\",\n\
    \"302\": \"Found\",\n\
    \"303\": \"See Other\",\n\
    \"304\": \"Not Modified\",\n\
    \"305\": \"Use Proxy\",\n\
    \"307\": \"Temporary Redirect\",\n\
    \"308\": \"Permanent Redirect\",\n\
    \"400\": \"Bad Request\",\n\
    \"401\": \"Unauthorized\",\n\
    \"402\": \"Payment Required\",\n\
    \"403\": \"Forbidden\",\n\
    \"404\": \"Not Found\",\n\
    \"405\": \"Method Not Allowed\",\n\
    \"406\": \"Not Acceptable\",\n\
    \"407\": \"Proxy Authentication Required\",\n\
    \"408\": \"Request Timeout\",\n\
    \"409\": \"Conflict\",\n\
    \"410\": \"Gone\",\n\
    \"411\": \"Length Required\",\n\
    \"412\": \"Precondition Failed\",\n\
    \"413\": \"Payload Too Large\",\n\
    \"414\": \"URI Too Long\",\n\
    \"415\": \"Unsupported Media Type\",\n\
    \"416\": \"Range Not Satisfiable\",\n\
    \"417\": \"Expectation Failed\",\n\
    \"418\": \"I'm a teapot\",\n\
    \"421\": \"Misdirected Request\",\n\
    \"422\": \"Unprocessable Entity\",\n\
    \"423\": \"Locked\",\n\
    \"424\": \"Failed Dependency\",\n\
    \"425\": \"Unordered Collection\",\n\
    \"426\": \"Upgrade Required\",\n\
    \"428\": \"Precondition Required\",\n\
    \"429\": \"Too Many Requests\",\n\
    \"431\": \"Request Header Fields Too Large\",\n\
    \"451\": \"Unavailable For Legal Reasons\",\n\
    \"500\": \"Internal Server Error\",\n\
    \"501\": \"Not Implemented\",\n\
    \"502\": \"Bad Gateway\",\n\
    \"503\": \"Service Unavailable\",\n\
    \"504\": \"Gateway Timeout\",\n\
    \"505\": \"HTTP Version Not Supported\",\n\
    \"506\": \"Variant Also Negotiates\",\n\
    \"507\": \"Insufficient Storage\",\n\
    \"508\": \"Loop Detected\",\n\
    \"509\": \"Bandwidth Limit Exceeded\",\n\
    \"510\": \"Not Extended\",\n\
    \"511\": \"Network Authentication Required\"\n\
};\n\
\n\
// init _http.ServerResponse\n\
local._http.ServerResponse = function (onResponse) {\n\
/*\n\
 * This object is created internally by a HTTP server--not by the user.\n\
 * It is passed as the second parameter to the 'req' event.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_class_http_serverresponse\n\
 */\n\
    this.chunkList = [];\n\
    this.onEvent = document.createDocumentFragment();\n\
    this.onResponse = onResponse;\n\
    this.resHeaders = {};\n\
    this.statusCode = 200;\n\
};\n\
\n\
/*\n\
 * Adds a listener to the end of the listeners array for the specified event.\n\
 * No checks are made to see if the listener has already been added.\n\
 * Multiple calls passing the same combination of event and listener will result\n\
 * in the listener being added multiple times.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_addlistener_event_listener\n\
 */\n\
local._http.ServerResponse.prototype.addListener = (\n\
    local._http.IncomingMessage.prototype.addListener\n\
);\n\
/*\n\
 * Execute each of the listeners in order with the supplied arguments.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_emit_event_arg1_arg2\n\
 */\n\
local._http.ServerResponse.prototype.emit = (\n\
    local._http.IncomingMessage.prototype.emit\n\
);\n\
\n\
local._http.ServerResponse.prototype.end = function (data) {\n\
/*\n\
 * This method signals to the server that all of the res headers and body\n\
 * have been sent; that server should consider this message complete.\n\
 * The method, res.end(), MUST be called on each res.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_end_data_encoding_callback\n\
 */\n\
    var that;\n\
    that = this;\n\
    if (that._isDone) {\n\
        return;\n\
    }\n\
    that._isDone = true;\n\
    that.chunkList.push(data);\n\
    // notify server res is finished\n\
    that.emit(\"finish\");\n\
    // asynchronously send res from server to client\n\
    setTimeout(function () {\n\
        that.onResponse(that);\n\
        that.emit(\"data\", local.bufferConcat(that.chunkList));\n\
        that.emit(\"end\");\n\
    });\n\
};\n\
\n\
/*\n\
 * Adds a listener to the end of the listeners array for the specified event.\n\
 * No checks are made to see if the listener has already been added.\n\
 * Multiple calls passing the same combination of event and listener\n\
 * will result in the listener being added multiple times.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_on_event_listener\n\
 */\n\
local._http.ServerResponse.prototype.on = (\n\
    local._http.IncomingMessage.prototype.addListener\n\
);\n\
\n\
local._http.ServerResponse.prototype.setHeader = function (key, value) {\n\
/*\n\
 * Sets a single header value for implicit headers.\n\
 * If this header already exists in the to-be-sent headers,\n\
 * its value will be replaced.\n\
 * Use an array of strings here if you need to send multiple headers\n\
 * with the same name.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_setheader_name_value\n\
 */\n\
    this.resHeaders[key.toLowerCase()] = value;\n\
};\n\
\n\
local._http.ServerResponse.prototype.write = function (data) {\n\
/*\n\
 * This sends a chunk of the res body.\n\
 * This method may be called multiple times\n\
 * to provide successive parts of the body.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_write_chunk_encoding_callback\n\
 */\n\
    this.chunkList.push(data);\n\
};\n\
\n\
local._http.createServer = function () {\n\
/*\n\
 * Returns a new instance of http.Server.\n\
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_http_createserver_requestlistener\n\
 */\n\
    return {\n\
        listen: function (port, onError) {\n\
        /*\n\
         * This will cause the server to accept connections\n\
         * on the specified handle,\n\
         * but it is presumed that the file descriptor or handle\n\
         * has already been bound to a port or domain socket.\n\
         * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_server_listen_handle_callback\n\
         */\n\
            onError(null, port);\n\
        }\n\
    };\n\
};\n\
\n\
local._http.request = function (xhr, onResponse) {\n\
    var isDone;\n\
    xhr = {\n\
        headers: xhr.headers,\n\
        method: xhr.method,\n\
        timeout: xhr.timeout,\n\
        url: xhr.href\n\
    };\n\
    xhr.end = function (data) {\n\
        if (isDone) {\n\
            return;\n\
        }\n\
        isDone = true;\n\
        xhr.serverReq.data = data;\n\
        // asynchronously send req from client -> server\n\
        setTimeout(function () {\n\
            local.serverLocalReqHandler(\n\
                xhr.serverReq,\n\
                xhr.serverResponse\n\
            );\n\
        });\n\
    };\n\
    xhr.on = function () {\n\
        return xhr;\n\
    };\n\
    xhr.serverReq = new local._http.IncomingMessage(xhr);\n\
    xhr.serverResponse = new local._http.ServerResponse(onResponse);\n\
    return xhr;\n\
};\n\
\n\
local._testCase_buildApidoc_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildApidoc's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    return local.buildApidoc(opt, onError);\n\
};\n\
\n\
local._testCase_buildApp_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildApp's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    globalThis.local.testCase_buildReadme_default(opt, local.onErrorThrow);\n\
    globalThis.local.testCase_buildLib_default(opt, local.onErrorThrow);\n\
    globalThis.local.testCase_buildTest_default(opt, local.onErrorThrow);\n\
    local.buildApp(opt, onError);\n\
};\n\
\n\
local._testCase_buildLib_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildLib's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    return local.buildLib({}, onError);\n\
};\n\
\n\
local._testCase_buildReadme_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildReadme's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    return local.buildReadme({}, onError);\n\
};\n\
\n\
local._testCase_buildTest_default = function (opt, onError) {\n\
/*\n\
 * this function will test buildTest's default handling-behavior\n\
 */\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    return local.buildTest({}, onError);\n\
};\n\
\n\
local._testCase_webpage_default = function (opt, onError) {\n\
/*\n\
 * this function will test webpage's default handling-behavior\n\
 */\n\
    local.domStyleValidate();\n\
    if (local.isBrowser) {\n\
        onError(null, opt);\n\
        return;\n\
    }\n\
    local.browserTest({\n\
        fileScreenshot: (\n\
            local.env.npm_config_dir_build\n\
            + \"/screenshot.\" + local.env.MODE_BUILD + \".browser.%2F.png\"\n\
        ),\n\
        modeCoverageMerge: true,\n\
        url: (\n\
            local.assetsDict[\"/\"].indexOf(\n\
                \"<script src=\\\"assets.test.js\\\"></script>\"\n\
            ) >= 0\n\
            ? local.serverLocalHost + \"?modeTest=1&timeoutDefault=\"\n\
            + local.timeoutDefault\n\
            : local.serverLocalHost\n\
            + \"/assets.utility2.base.html?modeTest=1&timeoutDefault=1\"\n\
        ) + \"&modeTestCase=\" + local.modeTestCase.replace((\n\
            /_?testCase_webpage_default/\n\
        ), \"\")\n\
    }, onError);\n\
};\n\
\n\
local.ajax = function (opt, onError) {\n\
/*\n\
 * this function will send an ajax-req\n\
 * with given <opt>.url and callback <onError>\n\
 * with err and timeout handling\n\
 * example usage:\n\
    local.ajax({\n\
        data: \"hello world\",\n\
        header: {\"x-header-hello\": \"world\"},\n\
        method: \"POST\",\n\
        url: \"/index.html\"\n\
    }, function (err, xhr) {\n\
        console.log(xhr.statusCode);\n\
        console.log(xhr.responseText);\n\
    });\n\
 */\n\
    var ajaxProgressUpdate;\n\
    var bufferValidateAndCoerce;\n\
    var isDone;\n\
    var local2;\n\
    var onEvent;\n\
    var streamCleanup;\n\
    var timeout;\n\
    var tmp;\n\
    var xhr;\n\
    var xhrInit;\n\
    // init local2\n\
    local2 = opt.local2 || local.utility2 || {};\n\
    // init function\n\
    ajaxProgressUpdate = local2.ajaxProgressUpdate || local.nop;\n\
    bufferValidateAndCoerce = local2.bufferValidateAndCoerce || function (\n\
        bff,\n\
        mode\n\
    ) {\n\
    /*\n\
     * this function will validate and coerce/convert <bff> -> Buffer\n\
     * (or String if <mode> = \"string\")\n\
     */\n\
        // coerce ArrayBuffer -> Buffer\n\
        if (Object.prototype.toString.call(bff) === \"[object ArrayBuffer]\") {\n\
            bff = new Uint8Array(bff);\n\
        }\n\
        // convert Buffer -> utf8\n\
        if (mode === \"string\" && typeof bff !== \"string\") {\n\
            bff = String(bff);\n\
        }\n\
        return bff;\n\
    };\n\
    onEvent = function (evt) {\n\
    /*\n\
     * this function will handle events\n\
     */\n\
        if (Object.prototype.toString.call(evt) === \"[object Error]\") {\n\
            xhr.err = xhr.err || evt;\n\
            xhr.onEvent({\n\
                type: \"error\"\n\
            });\n\
            return;\n\
        }\n\
        // init statusCode\n\
        xhr.statusCode = (xhr.statusCode || xhr.status) | 0;\n\
        switch (evt.type) {\n\
        case \"abort\":\n\
        case \"error\":\n\
        case \"load\":\n\
            if (isDone) {\n\
                return;\n\
            }\n\
            isDone = true;\n\
            // decrement ajaxProgressCounter\n\
            local2.ajaxProgressCounter = Math.max(\n\
                local2.ajaxProgressCounter - 1,\n\
                0\n\
            );\n\
            ajaxProgressUpdate();\n\
            // handle abort or err event\n\
            switch (!xhr.err && evt.type) {\n\
            case \"abort\":\n\
            case \"error\":\n\
                xhr.err = new Error(\"ajax - event \" + evt.type);\n\
                break;\n\
            case \"load\":\n\
                if (xhr.statusCode >= 400) {\n\
                    xhr.err = new Error(\n\
                        \"ajax - statusCode \" + xhr.statusCode\n\
                    );\n\
                }\n\
                break;\n\
            }\n\
            // debug statusCode / method / url\n\
            if (xhr.err) {\n\
                xhr.statusCode = xhr.statusCode || 500;\n\
                xhr.err.statusCode = xhr.statusCode;\n\
                tmp = (\n\
                    // ternary-operator\n\
                    (\n\
                        local.isBrowser\n\
                        ? \"browser\"\n\
                        : \"node\"\n\
                    )\n\
                    + \" - \" + xhr.statusCode + \" \" + xhr.method + \" \" + xhr.url\n\
                    + \"\\n\"\n\
                );\n\
                xhr.err.message = tmp + xhr.err.message;\n\
                xhr.err.stack = tmp + xhr.err.stack;\n\
            }\n\
            // update resHeaders\n\
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getAllResponseHeaders\n\
            if (xhr.getAllResponseHeaders) {\n\
                xhr.getAllResponseHeaders().replace((\n\
                    /(.*?):\\u0020*(.*?)\\r\\n/g\n\
                ), function (ignore, match1, match2) {\n\
                    xhr.resHeaders[match1.toLowerCase()] = match2;\n\
                });\n\
            }\n\
            // debug ajaxResponse\n\
            xhr.resContentLength = (\n\
                xhr.response\n\
                && (xhr.response.byteLength || xhr.response.length)\n\
            ) | 0;\n\
            xhr.timeElapsed = Date.now() - xhr.timeStart;\n\
            if (xhr.modeDebug) {\n\
                console.error(\"serverLog - \" + JSON.stringify({\n\
                    time: new Date(xhr.timeStart).toISOString(),\n\
                    type: \"ajaxResponse\",\n\
                    method: xhr.method,\n\
                    url: xhr.url,\n\
                    statusCode: xhr.statusCode,\n\
                    timeElapsed: xhr.timeElapsed,\n\
                    // extra\n\
                    resContentLength: xhr.resContentLength\n\
                }));\n\
            }\n\
            // init responseType\n\
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType\n\
            switch (xhr.response && xhr.responseType) {\n\
            // init responseText\n\
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText\n\
            case \"\":\n\
            case \"text\":\n\
                if (typeof xhr.responseText === \"string\") {\n\
                    break;\n\
                }\n\
                xhr.responseText = bufferValidateAndCoerce(\n\
                    xhr.response,\n\
                    \"string\"\n\
                );\n\
                break;\n\
            case \"arraybuffer\":\n\
                xhr.responseBuffer = bufferValidateAndCoerce(xhr.response);\n\
                break;\n\
            }\n\
            // cleanup timerTimeout\n\
            clearTimeout(xhr.timerTimeout);\n\
            // cleanup reqStream and resStream\n\
            streamCleanup(xhr.reqStream);\n\
            streamCleanup(xhr.resStream);\n\
            onError(xhr.err, xhr);\n\
            break;\n\
        }\n\
    };\n\
    streamCleanup = function (stream) {\n\
    /*\n\
     * this function will try to end or destroy <stream>\n\
     */\n\
        var err;\n\
        // try to end stream\n\
        try {\n\
            stream.end();\n\
        } catch (errCaught) {\n\
            err = errCaught;\n\
        }\n\
        // if err, then try to destroy stream\n\
        if (err) {\n\
            try {\n\
                stream.destroy();\n\
            } catch (ignore) {}\n\
        }\n\
    };\n\
    xhrInit = function () {\n\
    /*\n\
     * this function will init xhr\n\
     */\n\
        // init opt\n\
        Object.keys(opt).forEach(function (key) {\n\
            if (key[0] !== \"_\") {\n\
                xhr[key] = opt[key];\n\
            }\n\
        });\n\
        // init timeout\n\
        timeout = xhr.timeout || local2.timeoutDefault || 30000;\n\
        // init default\n\
        local.objectAssignDefault(xhr, {\n\
            corsForwardProxyHost: local2.corsForwardProxyHost,\n\
            headers: {},\n\
            location: (local.isBrowser && location) || {},\n\
            method: \"GET\",\n\
            responseType: \"\"\n\
        });\n\
        // init headers\n\
        Object.keys(xhr.headers).forEach(function (key) {\n\
            xhr.headers[key.toLowerCase()] = xhr.headers[key];\n\
        });\n\
        // coerce Uint8Array -> Buffer\n\
        if (\n\
            !local.isBrowser\n\
            && !Buffer.isBuffer(xhr.data)\n\
            && Object.prototype.toString.call(xhr.data)\n\
            === \"[object Uint8Array]\"\n\
        ) {\n\
            Object.setPrototypeOf(xhr.data, Buffer.prototype);\n\
        }\n\
        // init misc\n\
        local2._debugXhr = xhr;\n\
        xhr.onEvent = onEvent;\n\
        xhr.resHeaders = {};\n\
        xhr.timeStart = xhr.timeStart || Date.now();\n\
    };\n\
    // init onError\n\
    if (local2.onErrorWithStack) {\n\
        onError = local2.onErrorWithStack(onError);\n\
    }\n\
    // init xhr - XMLHttpRequest\n\
    xhr = (\n\
        local.isBrowser\n\
        && !opt.httpReq\n\
        && !(local2.serverLocalUrlTest && local2.serverLocalUrlTest(opt.url))\n\
        && new XMLHttpRequest()\n\
    );\n\
    // init xhr - http.request\n\
    if (!xhr) {\n\
        xhr = local.identity(local2.urlParse || require(\"url\").parse)(opt.url);\n\
        // init xhr\n\
        xhrInit();\n\
        // init xhr - http.request\n\
        xhr = local.identity(\n\
            opt.httpReq\n\
            || (local.isBrowser && local2.http.request)\n\
            || require(xhr.protocol.slice(0, -1)).request\n\
        )(xhr, function (resStream) {\n\
        /*\n\
         * this function will read <resStream>\n\
         */\n\
            var chunkList;\n\
            chunkList = [];\n\
            xhr.resHeaders = resStream.resHeaders || resStream.headers;\n\
            xhr.resStream = resStream;\n\
            xhr.statusCode = resStream.statusCode;\n\
            resStream.dataLength = 0;\n\
            resStream.on(\"data\", function (chunk) {\n\
                chunkList.push(chunk);\n\
            });\n\
            resStream.on(\"end\", function () {\n\
                xhr.response = (\n\
                    local.isBrowser\n\
                    ? chunkList[0]\n\
                    : Buffer.concat(chunkList)\n\
                );\n\
                resStream.dataLength = (\n\
                    xhr.response.byteLength || xhr.response.length\n\
                );\n\
                xhr.onEvent({\n\
                    type: \"load\"\n\
                });\n\
            });\n\
            resStream.on(\"error\", xhr.onEvent);\n\
        });\n\
        xhr.abort = function () {\n\
        /*\n\
         * this function will abort xhr-req\n\
         * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/abort\n\
         */\n\
            xhr.onEvent({\n\
                type: \"abort\"\n\
            });\n\
        };\n\
        xhr.addEventListener = local.nop;\n\
        xhr.open = local.nop;\n\
        xhr.reqStream = xhr;\n\
        xhr.send = xhr.end;\n\
        xhr.setRequestHeader = local.nop;\n\
        xhr.on(\"error\", onEvent);\n\
    }\n\
    // init xhr\n\
    xhrInit();\n\
    // init timerTimeout\n\
    xhr.timerTimeout = setTimeout(function () {\n\
        xhr.err = xhr.err || new Error(\n\
            \"onTimeout - errTimeout - \"\n\
            + timeout + \" ms - \" + \"ajax \" + xhr.method + \" \" + xhr.url\n\
        );\n\
        xhr.abort();\n\
        // cleanup reqStream and resStream\n\
        streamCleanup(xhr.reqStream);\n\
        streamCleanup(xhr.resStream);\n\
    }, timeout);\n\
    // increment ajaxProgressCounter\n\
    local2.ajaxProgressCounter = local2.ajaxProgressCounter || 0;\n\
    local2.ajaxProgressCounter += 1;\n\
    // init event-handling\n\
    xhr.addEventListener(\"abort\", xhr.onEvent);\n\
    xhr.addEventListener(\"error\", xhr.onEvent);\n\
    xhr.addEventListener(\"load\", xhr.onEvent);\n\
    xhr.addEventListener(\"loadstart\", ajaxProgressUpdate);\n\
    xhr.addEventListener(\"progress\", ajaxProgressUpdate);\n\
    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/upload\n\
    if (xhr.upload && xhr.upload.addEventListener) {\n\
        xhr.upload.addEventListener(\"progress\", ajaxProgressUpdate);\n\
    }\n\
    // open url - corsForwardProxyHost\n\
    if (local.functionOrNop(local2.corsForwardProxyHostIfNeeded)(xhr)) {\n\
        xhr.open(xhr.method, local2.corsForwardProxyHostIfNeeded(xhr));\n\
        xhr.setRequestHeader(\n\
            \"forward-proxy-headers\",\n\
            JSON.stringify(xhr.headers)\n\
        );\n\
        xhr.setRequestHeader(\"forward-proxy-url\", xhr.url);\n\
    // open url - default\n\
    } else {\n\
        xhr.open(xhr.method, xhr.url);\n\
    }\n\
    // send headers\n\
    Object.keys(xhr.headers).forEach(function (key) {\n\
        xhr.setRequestHeader(key, xhr.headers[key]);\n\
    });\n\
    // send data\n\
    switch ((xhr.data && xhr.data.constructor) || true) {\n\
    // Blob\n\
    // https://developer.mozilla.org/en-US/docs/Web/API/Blob\n\
    case local2.Blob:\n\
    // FormData\n\
    // https://developer.mozilla.org/en-US/docs/Web/API/FormData\n\
    case local2.FormData:\n\
        local2.blobRead(xhr.data, function (err, data) {\n\
            if (err) {\n\
                xhr.onEvent(err);\n\
                return;\n\
            }\n\
            // send data\n\
            xhr.send(data);\n\
        });\n\
        break;\n\
    default:\n\
        xhr.send(xhr.data);\n\
    }\n\
    return xhr;\n\
};\n\
\n\
local.ajaxProgressUpdate = function () {\n\
/*\n\
 * this function will update ajaxProgress\n\
 */\n\
    var ajaxProgressDiv1;\n\
    // init state\n\
    local.ajaxProgressCounter = local.ajaxProgressCounter || 0;\n\
    local.ajaxProgressState = local.ajaxProgressState || 0;\n\
    ajaxProgressDiv1 = (local.isBrowser && document.querySelector(\n\
        \"#ajaxProgressDiv1\"\n\
    )) || {\n\
        style: {\n\
            width: \"\"\n\
        }\n\
    };\n\
    // init ajaxProgressDiv1StyleBackground\n\
    local.ajaxProgressDiv1StyleBackground = (\n\
        local.ajaxProgressDiv1StyleBackground\n\
        || ajaxProgressDiv1.style.background\n\
    );\n\
    // show ajaxProgress\n\
    ajaxProgressDiv1.style.background = local.ajaxProgressDiv1StyleBackground;\n\
    // increment ajaxProgress\n\
    if (local.ajaxProgressCounter > 0) {\n\
        local.timerIntervalAjaxProgressHide = (\n\
            local.timerIntervalAjaxProgressHide\n\
            || setInterval(local.ajaxProgressUpdate, 2000)\n\
        );\n\
        // this algorithm will indefinitely increment ajaxProgressBar\n\
        // with successively smaller increments without ever reaching 100%\n\
        if ((ajaxProgressDiv1.style.width.slice(0, -1) | 0) > 95) {\n\
            ajaxProgressDiv1.style.width = \"0%\";\n\
            local.ajaxProgressState = 0;\n\
        }\n\
        local.ajaxProgressState += 1;\n\
        ajaxProgressDiv1.style.width = Math.max(\n\
            100 - 75 * Math.exp(-0.125 * local.ajaxProgressState),\n\
            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n\
        ) + \"%\";\n\
    } else {\n\
        // finish ajaxProgress\n\
        ajaxProgressDiv1.style.width = \"100%\";\n\
    }\n\
    // cleanup timerTimeout\n\
    clearTimeout(local.timerTimeoutAjaxProgressHide);\n\
    // hide ajaxProgress\n\
    local.timerTimeoutAjaxProgressHide = setTimeout(function () {\n\
        ajaxProgressDiv1.style.background = \"transparent\";\n\
        local.ajaxProgressCounter = 0;\n\
        local.ajaxProgressState = 0;\n\
        // reset ajaxProgress\n\
        clearInterval(local.timerIntervalAjaxProgressHide);\n\
        local.timerIntervalAjaxProgressHide = null;\n\
        setTimeout(function () {\n\
            if (!local.ajaxProgressState) {\n\
                ajaxProgressDiv1.style.width = \"0%\";\n\
            }\n\
        }, 500);\n\
    }, (\n\
        local.ajaxProgressCounter > 0\n\
        ? local.timeoutDefault\n\
        : 1000\n\
    ));\n\
};\n\
\n\
local.assertJsonEqual = function (aa, bb, message) {\n\
/*\n\
 * this function will assert jsonStringifyOrdered(<aa>) === JSON.stringify(<bb>)\n\
 */\n\
    aa = local.jsonStringifyOrdered(aa);\n\
    bb = JSON.stringify(bb);\n\
    local.assertThrow(aa === bb, message || [\n\
        aa, bb\n\
    ]);\n\
};\n\
\n\
local.assertJsonNotEqual = function (aa, bb, message) {\n\
/*\n\
 * this function will assert jsonStringifyOrdered(<aa>) !== JSON.stringify(<bb>)\n\
 */\n\
    aa = local.jsonStringifyOrdered(aa);\n\
    bb = JSON.stringify(bb);\n\
    local.assertThrow(aa !== bb, [\n\
        aa\n\
    ], message || aa);\n\
};\n\
\n\
local.base64FromBuffer = function (bff) {\n\
/*\n\
 * this function will convert Uint8Array <bff> to base64\n\
 * https://developer.mozilla.org/en-US/Add-ons/Code_snippets/StringView#The_code\n\
 */\n\
    var ii;\n\
    var mod3;\n\
    var text;\n\
    var uint24;\n\
    var uint6ToB64;\n\
    // convert utf8 -> Uint8Array\n\
    if (typeof bff === \"string\") {\n\
        bff = new TextEncoder().encode(bff);\n\
    }\n\
    bff = bff || [];\n\
    text = \"\";\n\
    uint24 = 0;\n\
    uint6ToB64 = function (uint6) {\n\
        return (\n\
            uint6 < 26\n\
            ? uint6 + 65\n\
            : uint6 < 52\n\
            ? uint6 + 71\n\
            : uint6 < 62\n\
            ? uint6 - 4\n\
            : uint6 === 62\n\
            ? 43\n\
            : 47\n\
        );\n\
    };\n\
    ii = 0;\n\
    while (ii < bff.length) {\n\
        mod3 = ii % 3;\n\
        uint24 |= bff[ii] << (16 >>> mod3 & 24);\n\
        if (mod3 === 2 || bff.length - ii === 1) {\n\
            text += String.fromCharCode(\n\
                uint6ToB64(uint24 >>> 18 & 63),\n\
                uint6ToB64(uint24 >>> 12 & 63),\n\
                uint6ToB64(uint24 >>> 6 & 63),\n\
                uint6ToB64(uint24 & 63)\n\
            );\n\
            uint24 = 0;\n\
        }\n\
        ii += 1;\n\
    }\n\
    return text.replace((\n\
        /A(?=A$|$)/gm\n\
    ), \"=\");\n\
};\n\
\n\
local.base64ToBuffer = function (b64, mode) {\n\
/*\n\
 * this function will convert <b64> to Uint8Array\n\
 * https://gist.github.com/wang-bin/7332335\n\
 */\n\
    var bff;\n\
    var byte;\n\
    var chr;\n\
    var ii;\n\
    var jj;\n\
    var map64;\n\
    var mod4;\n\
    b64 = b64 || \"\";\n\
    bff = new Uint8Array(b64.length); // 3/4\n\
    byte = 0;\n\
    jj = 0;\n\
    map64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\
    mod4 = 0;\n\
    ii = 0;\n\
    while (ii < b64.length) {\n\
        chr = map64.indexOf(b64[ii]);\n\
        if (chr >= 0) {\n\
            mod4 %= 4;\n\
            if (mod4 === 0) {\n\
                byte = chr;\n\
            } else {\n\
                byte = byte * 64 + chr;\n\
                bff[jj] = 255 & (byte >> ((-2 * (mod4 + 1)) & 6));\n\
                jj += 1;\n\
            }\n\
            mod4 += 1;\n\
        }\n\
        ii += 1;\n\
    }\n\
    // optimization - create resized-view of bff\n\
    bff = bff.subarray(0, jj);\n\
    return local.bufferValidateAndCoerce(bff, mode);\n\
};\n\
\n\
local.base64ToUtf8 = function (b64) {\n\
/*\n\
 * this function will convert <b64> -> utf8\n\
 */\n\
    return local.base64ToBuffer(b64, \"string\");\n\
};\n\
\n\
local.blobRead = function (blob, onError) {\n\
/*\n\
 * this function will read from <blob>\n\
 */\n\
    var isDone;\n\
    var reader;\n\
    if (blob && blob.constructor && blob.constructor === local.FormData) {\n\
        blob.read(onError);\n\
        return;\n\
    }\n\
    if (!local.isBrowser) {\n\
        onError(null, local.bufferValidateAndCoerce(blob.bff));\n\
        return;\n\
    }\n\
    reader = new FileReader();\n\
    reader.onabort = function (evt) {\n\
        if (isDone) {\n\
            return;\n\
        }\n\
        isDone = true;\n\
        switch (evt.type) {\n\
        case \"abort\":\n\
        case \"error\":\n\
            onError(new Error(\"blobRead - \" + evt.type));\n\
            break;\n\
        case \"load\":\n\
            onError(\n\
                null,\n\
                Object.prototype.toString.call(reader.result)\n\
                === \"[object ArrayBuffer]\"\n\
                // convert ArrayBuffer -> Uint8Array\n\
                ? new Uint8Array(reader.result)\n\
                : reader.result\n\
            );\n\
            break;\n\
        }\n\
    };\n\
    reader.onerror = reader.onabort;\n\
    reader.onload = reader.onabort;\n\
    reader.readAsArrayBuffer(blob);\n\
};\n\
\n\
local.browserTest = function (opt, onError) {\n\
/*\n\
 * this function will spawn an electron process to test <opt>.url\n\
 */\n\
    var isDone;\n\
    var isDoneHtml;\n\
    var onMessage;\n\
    var onParallel;\n\
    var timerTimeout;\n\
    var window;\n\
    window = opt.window || globalThis;\n\
    // init utility2_testReport\n\
    window.utility2_testReport = window.utility2_testReport || {\n\
        coverage: window.__coverage__,\n\
        testPlatformList: [\n\
            {\n\
                name: (\n\
                    local.isBrowser\n\
                    ? (\n\
                        \"browser - \"\n\
                        + location.pathname + \" - \" + navigator.userAgent\n\
                    )\n\
                    : \"node - \" + process.platform + \" \" + process.version\n\
                ) + \" - \" + new Date().toISOString(),\n\
                screenshot: local.env && local.env.MODE_BUILD_SCREENSHOT_IMG,\n\
                testCaseList: []\n\
            }\n\
        ]\n\
    };\n\
    window.utility2_testReportSave = (\n\
        window.utility2_testReportSave\n\
        || local.nop\n\
    );\n\
    if (opt.modeTestReportCreate) {\n\
        return;\n\
    }\n\
    onMessage = function (evt, type, data) {\n\
        switch (evt && type) {\n\
        case \"html\":\n\
            if (isDoneHtml) {\n\
                return;\n\
            }\n\
            isDoneHtml = true;\n\
            opt.fs.writeFile(opt.fileScreenshot.replace((\n\
                /\\.\\w+$/\n\
            ), \".html\"), data, onParallel);\n\
            return;\n\
        case \"testReport\":\n\
            if (opt.isDoneTestReport || opt.modeBrowserTest !== \"test\") {\n\
                return;\n\
            }\n\
            opt.isDoneTestReport = true;\n\
            // save browser-coverage\n\
            if (data.coverage) {\n\
                onParallel.counter += 1;\n\
                opt.fs.writeFile(\n\
                    opt.fileCoverage,\n\
                    JSON.stringify(data.coverage),\n\
                    onParallel\n\
                );\n\
                data.coverage = null;\n\
            }\n\
            // save browser-screenshot\n\
            data.testPlatformList[0].screenshot = (\n\
                opt.fileScreenshot.replace((\n\
                    /.*\\//\n\
                ), \"\")\n\
            );\n\
            // save browser-test-report\n\
            onParallel.counter += 1;\n\
            opt.fs.writeFile(\n\
                opt.fileTestReport,\n\
                JSON.stringify(data, null, 4),\n\
                onParallel\n\
            );\n\
            onParallel();\n\
            return;\n\
        }\n\
    };\n\
    local.onNext(opt, function (err, data) {\n\
        switch (opt.modeNext) {\n\
        // node - init\n\
        case 1:\n\
            // init fileElectronHtml\n\
            opt.fileElectronHtml = (\n\
                opt.npm_config_dir_tmp\n\
                + \"/electron.\"\n\
                + Date.now().toString(16)\n\
                + Math.random().toString(16)\n\
                + \".html\"\n\
            );\n\
            // init url\n\
            if (!(\n\
                /^\\w+:\\/\\//\n\
            ).test(opt.url)) {\n\
                opt.url = local.path.resolve(process.cwd(), opt.url);\n\
            }\n\
            opt.urlParsed = local.urlParse(opt.url);\n\
            // init testName\n\
            opt.testName = opt.urlParsed.pathname;\n\
            if (opt.testName.indexOf(process.cwd()) === 0) {\n\
                opt.testName = opt.testName.replace(process.cwd(), \"\");\n\
            }\n\
            opt.testName = (\n\
                opt.MODE_BUILD + \".browser.\"\n\
                + encodeURIComponent(opt.testName.replace(\n\
                    \"/build..\"\n\
                    + opt.CI_BRANCH\n\
                    + \"..\" + opt.CI_HOST,\n\
                    \"/build\"\n\
                ))\n\
            );\n\
            local.objectSetDefault(opt, {\n\
                fileCoverage: (\n\
                    opt.npm_config_dir_tmp + \"/coverage.\"\n\
                    + opt.testName + \".json\"\n\
                ),\n\
                fileScreenshot: (\n\
                    opt.npm_config_dir_build + \"/screenshot.\"\n\
                    + opt.testName\n\
                    + \".png\"\n\
                ),\n\
                fileTestReport: (\n\
                    opt.npm_config_dir_tmp + \"/test-report.\"\n\
                    + opt.testName\n\
                    + \".json\"\n\
                ),\n\
                modeBrowserTest: \"test\",\n\
                timeExit: Date.now() + opt.timeoutDefault,\n\
                timeoutScreenshot: opt.timeoutScreenshot || 15000\n\
            }, 1);\n\
            // init timerTimeout\n\
            timerTimeout = local.onTimeout(\n\
                opt.onNext,\n\
                opt.timeoutDefault,\n\
                opt.testName\n\
            ).unref();\n\
            data = {};\n\
            Object.keys(opt).forEach(function (key) {\n\
                if (typeof opt[key] !== \"object\") {\n\
                    data[key] = opt[key];\n\
                }\n\
            });\n\
            data.modeNext = 20;\n\
            // init file fileElectronHtml\n\
            local.fsWriteFileWithMkdirpSync(opt.fileElectronHtml, (\n\
                \"//<body \"\n\
                + \"style=\\\"border:1px solid black;margin:0;padding:0;\\\">\"\n\
                + \"<webview \"\n\
                + \"preload=\\\"\"\n\
                + opt.fileElectronHtml\n\
                + \"\\\" src=\\\"\"\n\
                + opt.url.replace(\"{{timeExit}}\", opt.timeExit)\n\
                + \"\\\" style=\"\n\
                + \"\\\"border:none;height:100%;margin:0;padding:0;width:100%;\\\">\"\n\
                + \"</webview>\"\n\
                + \"<script>document.body.removeChild(document.body.firstChild);\"\n\
                + \"</script>\"\n\
                + \"</body>\"\n\
                + \"<textarea disabled style=\\\"display:none;\\\">\\n\"\n\
                + local.assetsDict[\"/assets.example.begin.js\"]\n\
                + \"(function(local){\\n\"\n\
                + \"\\\"use strict\\\";\\n\"\n\
                + \"local=globalThis.globalLocal;\\n\"\n\
                + \"local.env={};\\n\"\n\
                + \"local.isBrowser=true;\\n\"\n\
                + \"var opt=\" + JSON.stringify(data) + \";\\n\"\n\
                + [\n\
                    \"browserTest\",\n\
                    \"nop\",\n\
                    \"onErrorWithStack\",\n\
                    \"onNext\"\n\
                ].map(function (key) {\n\
                    return \"local.\" + key + \"=\" + String(local[key])\n\
                    // html-safe\n\
                    .replace((\n\
                        /<\\//g\n\
                    ), \"<\\\\/\")\n\
                    // coverage-hack - un-instrument\n\
                    .replace((\n\
                        /\\b__cov_.*?\\+\\+/g\n\
                    ), \"0\") + \";\\n\";\n\
                }).join(\"\")\n\
                + \"local.browserTest(opt,console.error);\\n\"\n\
                + \"}());\\n\"\n\
                + \"//</textarea>\\n\"\n\
            ));\n\
            console.error(\n\
                \"\\nbrowserTest - created fileElectronHtml \"\n\
                + opt.fileElectronHtml\n\
                + \"\\n\"\n\
            );\n\
            // spawn an electron process to test a url\n\
            opt.npm_config_time_exit = opt.timeExit;\n\
            data.modeNext = 10;\n\
            local.childProcessSpawnWithTimeout(\"electron\", [\n\
                __filename,\n\
                \"utility2.browserTest\",\n\
                opt.url,\n\
                \"--enable-logging\"\n\
            ], {\n\
                env: data,\n\
                stdio: (\n\
                    (!opt.modeDebug && opt.modeSilent)\n\
                    ? \"ignore\"\n\
                    : [\n\
                        \"ignore\", 1, 2\n\
                    ]\n\
                ),\n\
                timeout: opt.timeoutDefault\n\
            }).once(\"error\", opt.onNext).once(\"exit\", opt.onNext);\n\
            return;\n\
        // node - after electron\n\
        case 2:\n\
            console.error(\n\
                \"\\nbrowserTest - exit-code \" + err + \" - \" + opt.url + \"\\n\"\n\
            );\n\
            if (opt.modeBrowserTest !== \"test\") {\n\
                opt.modeNext += 1000;\n\
                opt.onNext();\n\
                return;\n\
            }\n\
            // merge browser coverage\n\
            data = (\n\
                opt.modeCoverageMerge\n\
                && local.fsReadFileOrEmptyStringSync(opt.fileCoverage, \"json\")\n\
            );\n\
            local.istanbulCoverageMerge(window.__coverage__, data);\n\
            console.error(\n\
                \"\\nbrowserTest - merged coverage from file \"\n\
                + opt.fileCoverage\n\
                + \"\\n\"\n\
            );\n\
            // merge browser test-report\n\
            data = local.fsReadFileOrEmptyStringSync(\n\
                opt.fileTestReport,\n\
                \"json\"\n\
            );\n\
            local.testReportMerge(\n\
                window.utility2_testReport,\n\
                !opt.modeSilent && data\n\
            );\n\
            console.error(\n\
                \"\\nbrowserTest - merged test-report from file \"\n\
                + opt.fileTestReport\n\
                + \"\\n\"\n\
            );\n\
            // create test-report.json\n\
            local.fs.writeFileSync(\n\
                local.env.npm_config_dir_build + \"/test-report.json\",\n\
                JSON.stringify(window.utility2_testReport)\n\
            );\n\
            opt.onNext(data && data.testsFailed && new Error(data.testsFailed));\n\
            return;\n\
        // node.electron - init\n\
        case 11:\n\
            // handle uncaughtException\n\
            window.process.once(\"uncaughtException\", opt.onNext);\n\
            // wait for electron to init\n\
            opt.electron.app.once(\"ready\", function () {\n\
                opt.onNext();\n\
            });\n\
            return;\n\
        // node.electron - after ready\n\
        case 12:\n\
            Object.assign(opt, {\n\
                frame: false,\n\
                height: 768,\n\
                // disable nodeIntegration\n\
                // https://github.com/electron/electron/blob/v2.0.0/docs/tutorial/security.md#how-1\n\
                nodeIntegration: false,\n\
                show: false,\n\
                width: 1024,\n\
                x: 0,\n\
                y: 0\n\
            });\n\
            onParallel = local.onParallel(opt.onNext);\n\
            // onParallel - html\n\
            onParallel.counter += 1;\n\
            // onParallel - test\n\
            if (opt.modeBrowserTest === \"test\") {\n\
                onParallel.counter += 1;\n\
            }\n\
            // init event-handling - ipc\n\
            opt.electron.ipcMain.on(opt.fileElectronHtml, function (\n\
                evt,\n\
                type,\n\
                data\n\
            ) {\n\
                try {\n\
                    onMessage(evt, type, data);\n\
                } catch (errCaught) {\n\
                    opt.onNext(errCaught);\n\
                }\n\
            }, false);\n\
            // init browserWindow\n\
            opt.browserWindow = new opt.electron.BrowserWindow(opt);\n\
            // load url in browserWindow\n\
            opt.browserWindow.loadURL(\"file://\" + opt.fileElectronHtml);\n\
            return;\n\
        // node.electron - screenshot\n\
        case 13:\n\
            opt.browserWindow.capturePage(opt, function (data) {\n\
                opt.onNext(null, data);\n\
            });\n\
            return;\n\
        case 14:\n\
            opt.fs.writeFile(opt.fileScreenshot, data.toPNG(), opt.onNext);\n\
            return;\n\
        case 15:\n\
            console.error(\n\
                \"\\nbrowserTest - created screenshot file \"\n\
                + opt.fileScreenshot\n\
                + \"\\n\"\n\
            );\n\
            console.error(\n\
                \"browserTest - created screenshot file \"\n\
                + opt.fileScreenshot.replace((\n\
                    /\\.\\w+$/\n\
                ), \".html\")\n\
            );\n\
            local.exit();\n\
            return;\n\
        // node.electron.browserWindow.webview.preload - init\n\
        case 21:\n\
            // init domOnEventWindowOnloadTimeElapsed\n\
            (function () {\n\
            /*\n\
             * this function will measure and print time-elapsed\n\
             * for window.onload\n\
             */\n\
                if (window.domOnEventWindowOnloadTimeElapsed) {\n\
                    return;\n\
                }\n\
                window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n\
                window.addEventListener(\"load\", function () {\n\
                    setTimeout(function () {\n\
                        window.domOnEventWindowOnloadTimeElapsed = (\n\
                            Date.now()\n\
                            - window.domOnEventWindowOnloadTimeElapsed\n\
                        );\n\
                        console.error(\n\
                            \"domOnEventWindowOnloadTimeElapsed = \"\n\
                            + window.domOnEventWindowOnloadTimeElapsed\n\
                        );\n\
                    }, 100);\n\
                });\n\
            }());\n\
            // init event-handling - load\n\
            window.addEventListener(\"load\", function () {\n\
                setTimeout(opt.onNext, 5000);\n\
            });\n\
            // wait for render before screenshot\n\
            setTimeout(opt.onNext, opt.timeoutScreenshot);\n\
            if (opt.modeBrowserTest !== \"test\") {\n\
                return;\n\
            }\n\
            // init utility2_testReportSave\n\
            window.utility2_testReportSave = function () {\n\
                window.utility2_testReportSave = local.nop;\n\
                window.utility2_testReport.coverage = window.__coverage__;\n\
                opt.electron.ipcRenderer.send(\n\
                    opt.fileElectronHtml,\n\
                    \"testReport\",\n\
                    window.utility2_testReport\n\
                );\n\
            };\n\
            return;\n\
        // node.electron.browserWindow.webview.preload - screenshot\n\
        case 22:\n\
            // cleanup fileElectronHtml\n\
            opt.fs.rename(\n\
                opt.fileElectronHtml,\n\
                opt.npm_config_dir_tmp + \"/electron.html\",\n\
                console.error\n\
            );\n\
            opt.electron.ipcRenderer.send(\n\
                opt.fileElectronHtml,\n\
                \"html\",\n\
                window.document.documentElement.outerHTML\n\
            );\n\
            if (opt.modeBrowserTest === \"test\" && !window.utility2_modeTest) {\n\
                window.utility2_testReportSave();\n\
            }\n\
            return;\n\
        default:\n\
            if (isDone) {\n\
                return;\n\
            }\n\
            isDone = true;\n\
            // cleanup timerTimeout\n\
            clearTimeout(timerTimeout);\n\
            onError(err);\n\
        }\n\
    });\n\
    // init opt\n\
    [\n\
        \"CI_BRANCH\",\n\
        \"CI_HOST\",\n\
        \"DISPLAY\",\n\
        \"MODE_BUILD\",\n\
        \"PATH\",\n\
        \"fileCoverage\",\n\
        \"fileElectronHtml\",\n\
        \"fileScreenshot\",\n\
        \"fileTestReport\",\n\
        \"modeBrowserTest\",\n\
        \"modeCoverageMerge\",\n\
        \"modeDebug\",\n\
        \"modeNext\",\n\
        \"modeSilent\",\n\
        \"npm_config_dir_build\",\n\
        \"npm_config_dir_tmp\",\n\
        \"npm_config_time_exit\",\n\
        \"npm_config_timeout_default\",\n\
        \"timeExit\",\n\
        \"timeoutDefault\",\n\
        \"timeoutScreenshot\",\n\
        \"url\"\n\
    ].forEach(function (key) {\n\
        if (\n\
            local.env\n\
            && local.env[key] !== undefined\n\
            && typeof opt[key] !== \"number\"\n\
        ) {\n\
            opt[key] = opt[key] || local.env[key];\n\
        }\n\
    });\n\
    opt.modeNext = Number(opt.modeNext) || 0;\n\
    opt.timeoutDefault = (\n\
        Number(opt.timeoutDefault) || Number(local.timeoutDefault)\n\
    );\n\
    if (10 <= opt.modeNext) {\n\
        opt.electron = opt.electron || require(\"electron\");\n\
    }\n\
    opt.fs = opt.fs || require(\"fs\");\n\
    opt.onNext();\n\
};\n\
\n\
local.bufferConcat = function (bffList) {\n\
/*\n\
 * this function will emulate node's Buffer.concat for Uint8Array in browser\n\
 */\n\
    var byteLength;\n\
    var ii;\n\
    var isString;\n\
    var jj;\n\
    var result;\n\
    isString = true;\n\
    result = [\n\
        \"\"\n\
    ];\n\
    byteLength = 0;\n\
    bffList.forEach(function (bff) {\n\
        if (bff !== 0 && !(bff && bff.length)) {\n\
            return;\n\
        }\n\
        // optimization - concat string\n\
        if (isString && typeof bff === \"string\") {\n\
            result[0] += bff;\n\
            return;\n\
        }\n\
        isString = null;\n\
        bff = local.bufferValidateAndCoerce(bff);\n\
        byteLength += bff.byteLength;\n\
        result.push(bff);\n\
    });\n\
    // optimization - return string\n\
    if (isString) {\n\
        return result[0];\n\
    }\n\
    result[0] = local.bufferValidateAndCoerce(result[0]);\n\
    byteLength += result[0].byteLength;\n\
    bffList = result;\n\
    result = local.bufferValidateAndCoerce(new Uint8Array(byteLength));\n\
    ii = 0;\n\
    bffList.forEach(function (bff) {\n\
        jj = 0;\n\
        while (jj < bff.byteLength) {\n\
            result[ii] = bff[jj];\n\
            ii += 1;\n\
            jj += 1;\n\
        }\n\
    });\n\
    return result;\n\
};\n\
\n\
local.bufferIndexOfSubBuffer = function (bff, subBff, fromIndex) {\n\
/*\n\
 * this function will search <bff> for <fromIndex> position of <subBff>\n\
 */\n\
    var ii;\n\
    var jj;\n\
    var kk;\n\
    if (!subBff.length) {\n\
        return 0;\n\
    }\n\
    ii = fromIndex || 0;\n\
    while (ii < bff.length) {\n\
        kk = ii;\n\
        jj = 0;\n\
        while (jj < subBff.length) {\n\
            if (subBff[jj] !== bff[kk]) {\n\
                break;\n\
            }\n\
            kk += 1;\n\
            jj += 1;\n\
        }\n\
        if (jj === subBff.length) {\n\
            return kk - jj;\n\
        }\n\
        ii += 1;\n\
    }\n\
    return -1;\n\
};\n\
\n\
local.bufferRandomBytes = function (length) {\n\
/*\n\
 * this function will return a Buffer with given <length>,\n\
 * filled with cryptographically-strong random-values\n\
 */\n\
    return (\n\
        // ternary-operator\n\
        (\n\
            typeof window === \"object\"\n\
            && window.crypto\n\
            && typeof window.crypto.getRandomValues === \"function\"\n\
        )\n\
        ? window.crypto.getRandomValues(new Uint8Array(length))\n\
        : require(\"crypto\").randomBytes(length)\n\
    );\n\
};\n\
\n\
local.bufferToUtf8 = function (bff) {\n\
/*\n\
 * this function will convert Uint8Array <bff> -> utf8\n\
 */\n\
    return local.bufferValidateAndCoerce(bff, \"string\");\n\
};\n\
\n\
local.bufferValidateAndCoerce = function (bff, mode) {\n\
/*\n\
 * this function will validate and coerce/convert <bff> -> Buffer\n\
 * (or String if <mode> = \"string\")\n\
 */\n\
    // validate not 0\n\
    if (bff !== 0) {\n\
        bff = bff || \"\";\n\
    }\n\
    if (typeof bff === \"string\" && mode === \"string\") {\n\
        return bff;\n\
    }\n\
    // convert utf8 -> Uint8Array\n\
    if (typeof bff === \"string\") {\n\
        bff = (\n\
            local.isBrowser\n\
            ? new TextEncoder().encode(bff)\n\
            : Buffer.from(bff)\n\
        );\n\
    // validate instanceof Uint8Array\n\
    } else if (Object.prototype.toString.call(bff) !== \"[object Uint8Array]\") {\n\
        throw new Error(\n\
            \"bufferValidateAndCoerce - value is not instanceof \"\n\
            + \"ArrayBuffer, String, or Uint8Array\"\n\
        );\n\
    }\n\
    // convert Uint8Array -> utf8\n\
    if (mode === \"string\") {\n\
        return new TextDecoder().decode(bff);\n\
    }\n\
    // coerce Uint8Array -> Buffer\n\
    if (!local.isBrowser && !Buffer.isBuffer(bff)) {\n\
        Object.setPrototypeOf(bff, Buffer.prototype);\n\
    }\n\
    return bff;\n\
};\n\
\n\
local.buildApidoc = function (opt, onError) {\n\
/*\n\
 * this function will build apidoc with given <opt>\n\
 */\n\
    var result;\n\
    // optimization - do not run if $npm_config_mode_coverage = all\n\
    if (local.env.npm_config_mode_coverage === \"all\") {\n\
        onError();\n\
        return;\n\
    }\n\
    opt = local.objectSetDefault(opt, {\n\
        blacklistDict: local,\n\
        require: local.requireInSandbox\n\
    });\n\
    // save apidoc.html\n\
    result = (\n\
        local.fsReadFileOrEmptyStringSync(\"apidoc.html\", \"utf8\")\n\
        || local.apidocCreate(opt)\n\
    );\n\
    local.fsWriteFileWithMkdirpSync(\"tmp/build/apidoc.html\", result);\n\
    console.error(\n\
        \"created apidoc file \" + process.cwd() + \"/apidoc.html\\n\"\n\
    );\n\
    onError();\n\
};\n\
\n\
local.buildApp = function (opt, onError) {\n\
/*\n\
 * this function will build app with given <opt>\n\
 */\n\
    opt = local.objectSetDefault(opt, {\n\
        assetsList: []\n\
    });\n\
    // build assets\n\
    local.fsRmrSync(\"tmp/build/app\");\n\
    local.onParallelList({\n\
        list: [\n\
            {\n\
                file: \"/LICENSE\",\n\
                url: \"/LICENSE\"\n\
            }, {\n\
                file: \"/assets.\" + local.env.npm_package_nameLib + \".html\",\n\
                url: \"/index.html\"\n\
            }, {\n\
                file: \"/assets.\" + local.env.npm_package_nameLib + \".js\",\n\
                url: \"/assets.\" + local.env.npm_package_nameLib + \".js\"\n\
            }, {\n\
                file: \"/assets.app.js\",\n\
                url: \"/assets.app.js\"\n\
            }, {\n\
                file: \"/assets.example.html\",\n\
                url: \"/assets.example.html\"\n\
            }, {\n\
                file: \"/assets.example.js\",\n\
                url: \"/assets.example.js\"\n\
            }, {\n\
                file: \"/assets.swgg.html\",\n\
                url: \"/assets.swgg.html\"\n\
            }, {\n\
                file: \"/assets.swgg.swagger.json\",\n\
                url: \"/assets.swgg.swagger.json\"\n\
            }, {\n\
                file: \"/assets.swgg.swagger.petstore.json\",\n\
                url: \"/assets.swgg.swagger.petstore.json\"\n\
            }, {\n\
                file: \"/assets.swgg.swagger.server.json\",\n\
                url: \"/assets.swgg.swagger.server.json\"\n\
            }, {\n\
                file: \"/assets.test.js\",\n\
                url: \"/assets.test.js\"\n\
            }, {\n\
                file: \"/assets.utility2.html\",\n\
                url: \"/assets.utility2.html\"\n\
            }, {\n\
                file: \"/assets.utility2.base.html\",\n\
                url: \"/assets.utility2.base.html\"\n\
            }, {\n\
                file: \"/assets.utility2.rollup.js\",\n\
                url: \"/assets.utility2.rollup.js\"\n\
            }, {\n\
                file: \"/index.html\",\n\
                url: \"/index.html\"\n\
            }, {\n\
                file: \"/index.rollup.html\",\n\
                url: \"/index.rollup.html\"\n\
            }, {\n\
                file: \"/jsonp.utility2.stateInit\",\n\
                url: (\n\
                    \"/jsonp.utility2.stateInit\"\n\
                    + \"?callback=window.utility2.stateInit\"\n\
                )\n\
            }\n\
        ].concat(opt.assetsList)\n\
    }, function (option2, onParallel) {\n\
        option2 = option2.elem;\n\
        onParallel.counter += 1;\n\
        local.ajax(option2, function (err, xhr) {\n\
            // validate no err occurred\n\
            local.assertThrow(!err, err);\n\
            // jslint file\n\
            local.jslintAndPrint(xhr.responseText, option2.file, {\n\
                conditional: true,\n\
                coverage: local.env.npm_config_mode_coverage\n\
            });\n\
            // validate no err occurred\n\
            local.assertThrow(\n\
                !local.jslint.jslintResult.errText,\n\
                local.jslint.jslintResult.errText\n\
            );\n\
            local.fsWriteFileWithMkdirpSync(\n\
                \"tmp/build/app\" + option2.file,\n\
                xhr.response\n\
            );\n\
            onParallel();\n\
        });\n\
    }, function (err) {\n\
        // validate no err occurred\n\
        local.assertThrow(!err, err);\n\
        // test standalone assets.app.js\n\
        local.fsWriteFileWithMkdirpSync(\n\
            \"tmp/buildApp/assets.app.js\",\n\
            local.assetsDict[\"/assets.app.js\"]\n\
        );\n\
        local.childProcessSpawnWithTimeout(\"node\", [\n\
            \"assets.app.js\"\n\
        ], {\n\
            cwd: \"tmp/buildApp\",\n\
            env: {\n\
                PATH: local.env.PATH,\n\
                PORT: (Math.random() * 0x10000) | 0x8000,\n\
                npm_config_timeout_exit: 5000\n\
            },\n\
            stdio: [\n\
                \"ignore\", \"ignore\", 2\n\
            ]\n\
        })\n\
        .on(\"error\", onError)\n\
        .on(\"exit\", function (exitCode) {\n\
            // validate exitCode\n\
            local.assertThrow(!exitCode, exitCode);\n\
            onError();\n\
        });\n\
    });\n\
};\n\
\n\
local.buildLib = function (opt, onError) {\n\
/*\n\
 * this function will build lib with given <opt>\n\
 */\n\
    var result;\n\
    local.objectSetDefault(opt, {\n\
        customize: local.nop,\n\
        dataFrom: local.fsReadFileOrEmptyStringSync(\n\
            \"lib.\" + local.env.npm_package_nameLib + \".js\",\n\
            \"utf8\"\n\
        ),\n\
        dataTo: local.templateRenderMyApp(\n\
            local.assetsDict[\"/assets.my_app.template.js\"],\n\
            opt\n\
        )\n\
    });\n\
    // search-and-replace - customize dataTo\n\
    [\n\
        // customize top-level comment-description\n\
        (\n\
            /\\n\\u0020\\*\\n(?:[\\S\\s]*?\\n)?\\u0020\\*\\/\\n/\n\
        ),\n\
        // customize body after /* validateLineSortedReset */\n\
        (\n\
            /\\n\\/\\*\\u0020validateLineSortedReset\\u0020\\*\\/\\n[\\S\\s]*?$/\n\
        )\n\
    ].forEach(function (rgx) {\n\
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);\n\
    });\n\
    // customize local for assets.utility2.rollup.js\n\
    if (\n\
        local.fs.existsSync(\"./assets.utility2.rollup.js\")\n\
        && local.env.npm_package_nameLib !== \"swgg\"\n\
    ) {\n\
        opt.dataTo = opt.dataTo.replace(\n\
            \"    // || globalThis.utility2_rollup_old\",\n\
            \"    || globalThis.utility2_rollup_old\"\n\
        ).replace(\n\
            \"    // || require(\\\"./assets.utility2.rollup.js\\\")\",\n\
            \"    || require(\\\"./assets.utility2.rollup.js\\\")\"\n\
        );\n\
    }\n\
    // save lib\n\
    result = opt.dataTo;\n\
    local.fsWriteFileWithMkdirpSync(\n\
        \"lib.\" + local.env.npm_package_nameLib + \".js\",\n\
        result,\n\
        local.env.npm_config_mode_coverage && local.identity(\"noWrite\")\n\
    );\n\
    opt.customize(opt);\n\
    onError();\n\
    return result;\n\
};\n\
\n\
local.buildReadme = function (opt, onError) {\n\
/*\n\
 * this function will build readme with given <opt> my-app-lite template\n\
 */\n\
    var result;\n\
    local.objectSetDefault(opt, {\n\
        customize: local.nop,\n\
        // reset toc\n\
        dataFrom: local.fsReadFileOrEmptyStringSync(\n\
            \"README.md\",\n\
            \"utf8\"\n\
        ).replace((\n\
            /\\n#\\u0020table\\u0020of\\u0020contents$[\\S\\s]*?\\n\\n\\n\\n/m\n\
        ), \"\\n# table of contents\\n\\n\\n\\n\"),\n\
        packageJsonRgx: (\n\
            /\\n#\\u0020package.json\\n```json\\n([\\S\\s]*?)\\n```\\n/\n\
        )\n\
    });\n\
    // render dataTo\n\
    opt.dataTo = local.templateRenderMyApp(\n\
        local.assetsDict[\"/assets.readme.template.md\"],\n\
        opt\n\
    );\n\
    // init package.json\n\
    opt.dataFrom.replace(opt.packageJsonRgx, function (match0, match1) {\n\
        // remove null-items from package.json\n\
        opt.packageJson = JSON.parse(match1.replace((\n\
            /\\u0020{4}\".*?\":\\u0020null,?$/gm\n\
        ), \"\"));\n\
        opt.packageJson.description = opt.dataFrom.split(\"\\n\")[1];\n\
        local.tryCatchOnError(function () {\n\
            local.objectSetDefault(opt.packageJson, {\n\
                nameLib: local.fsReadFileOrEmptyStringSync(\n\
                    \"./package.json\",\n\
                    \"json\"\n\
                ).nameLib\n\
            });\n\
        }, local.nop);\n\
        opt.packageJson = local.objectSetDefault(opt.packageJson, {\n\
            nameLib: opt.packageJson.name.replace((\n\
                /\\W/g\n\
            ), \"_\"),\n\
            nameOriginal: opt.packageJson.name\n\
        });\n\
        opt.packageJson = local.objectSetDefault(\n\
            opt.packageJson,\n\
            JSON.parse(local.templateRenderMyApp(opt.packageJsonRgx.exec(\n\
                local.assetsDict[\"/assets.readme.template.md\"]\n\
            )[1], opt)),\n\
            2\n\
        );\n\
        // avoid npm-installing that\n\
        delete opt.packageJson.devDependencies[opt.packageJson.name];\n\
        // reset scripts\n\
        opt.packageJson.scripts = {\n\
            \"build-ci\": \"sh ./npm_scripts.sh\",\n\
            env: \"env\",\n\
            eval: \"sh ./npm_scripts.sh\",\n\
            \"heroku-postbuild\": \"sh ./npm_scripts.sh\",\n\
            postinstall: \"sh ./npm_scripts.sh\",\n\
            start: \"sh ./npm_scripts.sh\",\n\
            test: \"sh ./npm_scripts.sh\",\n\
            utility2: \"sh ./npm_scripts.sh\"\n\
        };\n\
        // save package.json\n\
        local.fsWriteFileWithMkdirpSync(\n\
            \"package.json\",\n\
            local.jsonStringifyOrdered(opt.packageJson, null, 4) + \"\\n\"\n\
        );\n\
        // re-render dataTo\n\
        opt.dataTo = local.templateRenderMyApp(\n\
            local.assetsDict[\"/assets.readme.template.md\"],\n\
            opt\n\
        );\n\
        opt.dataTo = opt.dataTo.replace(\n\
            opt.packageJsonRgx,\n\
            match0.replace(\n\
                match1,\n\
                local.jsonStringifyOrdered(opt.packageJson, null, 4)\n\
            )\n\
        );\n\
    });\n\
    // search-and-replace - customize dataTo\n\
    [\n\
        // customize name and description\n\
        (\n\
            /.*?\\n.*?\\n/\n\
        ),\n\
        // customize cdn-download\n\
        (\n\
            /\\n#\\u0020cdn\\u0020download\\n[\\S\\s]*?\\n\\n\\n\\n/\n\
        ),\n\
        // customize live-web-demo\n\
        (\n\
            /\\n#\\u0020live\\u0020web\\u0020demo\\n[\\S\\s]*?\\n\\n\\n\\n/\n\
        ),\n\
        // customize to-do\n\
        (\n\
            /\\n####\\u0020todo\\n[\\S\\s]*?\\n\\n\\n\\n/\n\
        ),\n\
        // customize example.js - shared js-env code - init-before\n\
        (\n\
            /\\nglobalThis\\.local\\u0020=\\u0020local;\\n[^`]*?\\n\\/\\/\\u0020run\\u0020browser\\u0020js\\-env\\u0020code\\u0020-\\u0020init-test\\n/\n\
        ),\n\
        // customize example.js - html-body\n\
        (\n\
            /\\nutility2-comment\\u0020-->(?:\\\\n\\\\\\n){4}[^`]*?^<!--\\u0020utility2-comment\\\\n\\\\\\n/m\n\
        ),\n\
        // customize example.js - testRunBrowser\n\
        (\n\
            /\\n\\u0020{4}\\/\\/\\u0020custom-case\\n[^`]*?\\n\\u0020{4}\\/\\/\\u0020run\\u0020browser-tests\\n/\n\
        ),\n\
        // customize build_ci - shBuildCiAfter\n\
        (\n\
            /\\nshBuildCiAfter\\u0020\\(\\)\\u0020\\{\\(set\\u0020-e\\n[\\S\\s]*?\\n\\)\\}\\n/\n\
        ),\n\
        // customize build_ci - shBuildCiBefore\n\
        (\n\
            /\\nshBuildCiBefore\\u0020\\(\\)\\u0020\\{\\(set\\u0020-e\\n[\\S\\s]*?\\n\\)\\}\\n/\n\
        )\n\
    ].forEach(function (rgx) {\n\
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);\n\
    });\n\
    // customize private-repository\n\
    if (local.env.npm_package_private) {\n\
        opt.dataTo = (\n\
            opt.dataTo.replace((\n\
                /\\n\\[!\\[NPM\\]\\(https:\\/\\/nodei.co\\/npm\\/.*?\\n/\n\
            ), \"\\n\").replace(\n\
                \"$ npm install \",\n\
                (\n\
                    \"$ git clone \"\n\
                    + local.env.npm_package_repository_url\n\
                    .replace(\"git+https://github.com/\", \"git@github.com:\")\n\
                    + \" --single-branch -b beta node_modules/\"\n\
                )\n\
            )\n\
        );\n\
    }\n\
    // customize version\n\
    [\n\
        \"dataFrom\", \"dataTo\"\n\
    ].forEach(function (elem) {\n\
        opt[elem] = opt[elem].replace((\n\
            /\\n(####\\u0020changelog\\u0020|-\\u0020npm\\u0020publish\\u0020)\\d+?\\.\\d+?\\.\\d+?.*?\\n/g\n\
        ), \"\\n$1\" + opt.packageJson.version + \"\\n\");\n\
    });\n\
    // customize swaggerdoc\n\
    if (\n\
        !local.assetsDict[\"/assets.swgg.swagger.json\"]\n\
        || (\n\
            /\\bswggUiContainer\\b/\n\
        ).test(local.assetsDict[\"/index.html\"])\n\
        || local.env.npm_package_name === \"utility2\"\n\
    ) {\n\
        opt.dataTo = opt.dataTo.replace((\n\
            /\\n####\\u0020swagger\\u0020doc\\n[\\S\\s]*?\\n####\\u0020/\n\
        ), \"\\n#### \");\n\
    }\n\
    // customize example.js\n\
    if (\n\
        local.assetsDict[\"/index.html\"].indexOf(\n\
            \"<script src=\\\"assets.example.js\\\"></script>\"\n\
        ) < 0\n\
    ) {\n\
        opt.dataTo = opt.dataTo.replace((\n\
            /\\nif\\u0020\\(!local.isBrowser\\)\\u0020\\{\\n[\\S\\s]*?\\n\\}\\(\\)\\);\\n/g\n\
        ), \"\\nif (!local.isBrowser) {\\n    return;\\n}\\n}());\\n\");\n\
    }\n\
    // customize comment\n\
    opt.dataFrom.replace((\n\
        /^(\\u0020*?)(?:#\\!\\!\\u0020|#\\/\\/\\u0020|\\/\\/\\!\\!\\u0020|<!--\\u0020)(.*?)(?:\\u0020-->)?$/gm\n\
    ), function (match0, match1, match2) {\n\
        opt.dataTo = opt.dataTo.replace(\n\
            \"\\n\" + match1 + match2 + \"\\n\",\n\
            \"\\n\" + match0 + \"\\n\"\n\
        );\n\
    });\n\
    // customize - user-defined\n\
    opt.customize(opt);\n\
    // customize assets.index.template.html\n\
    if (local.assetsDict[\"/assets.index.template.html\"].indexOf(\n\
        \"\\\"assets.utility2.template.html\\\"\"\n\
    ) < 0) {\n\
        opt.dataTo = opt.dataTo.replace((\n\
            /\\n\\/\\*\\u0020jslint\\u0020ignore:start\\u0020\\*\\/\\nlocal.assetsDict\\[\"\\/assets.index.template.html\"\\]\\u0020=\\u0020'\\\\\\n[\\S\\s]*?\\n\\/\\*\\u0020jslint\\u0020ignore:end\\u0020\\*\\/\\n/\n\
        ), \"\\n\");\n\
    }\n\
    // customize shDeployCustom\n\
    if (opt.dataFrom.indexOf(\"    shDeployCustom\\n\") >= 0) {\n\
        [\n\
            // customize example.sh\n\
            (\n\
                /\\n####\\u0020changelog\\u0020[\\S\\s]*\\n#\\u0020quickstart\\u0020example.js\\n/\n\
            ), (\n\
                opt.dataFrom.indexOf(\"\\\"assets.utility2.template.html\\\"\") < 0\n\
                && local.identity(\n\
                    /\\n#\\u0020quickstart\\u0020[\\S\\s]*?\\n#\\u0020extra\\u0020screenshots\\n/\n\
                )\n\
            )\n\
        ].forEach(function (rgx) {\n\
            opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);\n\
        });\n\
        // customize screenshot\n\
        opt.dataTo = opt.dataTo.replace((\n\
            /^1\\.\\u0020.*?screenshot\\.(?:npmTest|testExampleJs|testExampleSh).*?\\.png[\\S\\s]*?\\n\\n/gm\n\
        ), \"\");\n\
    }\n\
    // customize shNpmTestPublished\n\
    opt.dataTo = opt.dataTo.replace(\n\
        \"$ npm install \" + local.env.GITHUB_REPO + \"#alpha\",\n\
        \"$ npm install \" + local.env.npm_package_name\n\
    );\n\
    if (opt.dataFrom.indexOf(\"    shNpmTestPublished\\n\") < 0) {\n\
        opt.dataTo = opt.dataTo.replace(\n\
            \"$ npm install \" + local.env.npm_package_name,\n\
            \"$ npm install \" + local.env.GITHUB_REPO + \"#alpha\"\n\
        );\n\
        [\n\
            (\n\
                /\\n.*?\\bhttps:\\/\\/www.npmjs.com\\/package\\/.*?\\n/\n\
            ), (\n\
                /\\n.*?npmPackageDependencyTree.*?\\n/\n\
            )\n\
        ].forEach(function (rgx) {\n\
            opt.dataTo = opt.dataTo.replace(rgx, \"\");\n\
        });\n\
    }\n\
    // customize shBuildCiAfter and shBuildCiBefore\n\
    [\n\
        [\n\
            \"shDeployGithub\", (\n\
                /.*?\\/screenshot\\.deployGithub.*?\\n/g\n\
            )\n\
        ], [\n\
            \"shDeployHeroku\", (\n\
                /.*?\\/screenshot\\.deployHeroku.*?\\n/g\n\
            )\n\
        ], [\n\
            \"shReadmeTest example.js\", (\n\
                /.*?\\/screenshot\\.testExampleJs.*?\\n/g\n\
            )\n\
        ], [\n\
            \"shReadmeTest example.sh\", (\n\
                /.*?\\/screenshot\\.testExampleSh.*?\\n/g\n\
            )\n\
        ]\n\
    ].forEach(function (elem) {\n\
        if (opt.dataFrom.indexOf(\"    \" + elem[0] + \"\\n\") >= 0) {\n\
            return;\n\
        }\n\
        // customize test-server\n\
        opt.dataTo = opt.dataTo.replace(\n\
            new RegExp(\n\
                \"\\\\n\\\\| test-server-\"\n\
                + elem[0].replace(\"shDeploy\", \"\").toLowerCase()\n\
                + \" : \\\\|.*?\\\\n\"\n\
            ),\n\
            \"\\n\"\n\
        );\n\
        // customize screenshot\n\
        opt.dataTo = opt.dataTo.replace(elem[1], \"\");\n\
    });\n\
    opt.dataTo = local.templateRenderMyApp(opt.dataTo, opt);\n\
    // customize toc\n\
    opt.toc = \"\\n# table of contents\\n\";\n\
    opt.dataTo.replace((\n\
        /\\n\\n\\n\\n#\\u0020(.*)/g\n\
    ), function (ignore, match1) {\n\
        if (match1 === \"table of contents\") {\n\
            return;\n\
        }\n\
        opt.toc += \"1. [\" + match1 + \"](#\" + match1.toLowerCase().replace((\n\
            /[^\\u0020\\-0-9A-Z_a-z]/g\n\
        ), \"\").replace((\n\
            /\\u0020/g\n\
        ), \"-\") + \")\\n\";\n\
    });\n\
    opt.dataTo = opt.dataTo.replace(\"\\n# table of contents\\n\", opt.toc);\n\
    // customize whitespace\n\
    opt.dataTo = opt.dataTo.replace((\n\
        /\\n{5,}/g\n\
    ), \"\\n\\n\\n\\n\");\n\
    // save README.md\n\
    result = opt.dataTo;\n\
    local.fs.writeFileSync(\"README.md\", result);\n\
    // customize assets.swgg.swagger.json\n\
    opt.swaggerJson = local.swgg.normalizeSwaggerJson(\n\
        local.fsReadFileOrEmptyStringSync(\"assets.swgg.swagger.json\", \"json\")\n\
    );\n\
    local.objectSetOverride(opt.swaggerJson, {\n\
        info: {\n\
            title: opt.packageJson.name,\n\
            version: opt.packageJson.version,\n\
            \"x-swgg-description\": opt.packageJson.description,\n\
            \"x-swgg-homepage\": opt.packageJson.homepage\n\
        }\n\
    }, 2);\n\
    opt.dataTo.replace((\n\
        /\\bhttps:\\/\\/.*?\\/assets\\.app\\.js/\n\
    ), function (match0) {\n\
        opt.swaggerJson[\"x-swgg-downloadStandaloneApp\"] = (\n\
            !local.env.npm_package_private && match0\n\
        );\n\
    });\n\
    local.fsWriteFileWithMkdirpSync(\n\
        \"assets.swgg.swagger.json\",\n\
        local.jsonStringifyOrdered(opt.swaggerJson, null, 4) + \"\\n\",\n\
        !opt.swaggerJson.swagger && local.identity(\"noWrite\")\n\
    );\n\
    onError();\n\
    return result;\n\
};\n\
\n\
local.buildTest = function (opt, onError) {\n\
/*\n\
 * this function will build test with given <opt>\n\
 */\n\
    var result;\n\
    local.objectSetDefault(opt, {\n\
        customize: local.nop,\n\
        dataFrom: local.fsReadFileOrEmptyStringSync(\"test.js\", \"utf8\"),\n\
        dataTo: local.templateRenderMyApp(\n\
            local.assetsDict[\"/assets.test.template.js\"],\n\
            opt\n\
        )\n\
    });\n\
    // search-and-replace - customize dataTo\n\
    [\n\
        // customize shared js\\-env code - function\n\
        (\n\
            /\\n\\}\\(\\)\\);\\n\\n\\n\\n\\/\\/\\u0020run\\u0020shared\\u0020js\\-env\\u0020code\\u0020-\\u0020function\\n[\\S\\s]*?$/\n\
        )\n\
    ].forEach(function (rgx) {\n\
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);\n\
    });\n\
    // customize require(\"utility2\")\n\
    [\n\
        \"./assets.utility2.rollup.js\",\n\
        \"./lib.utility2.js\"\n\
    ].forEach(function (file) {\n\
        if (local.fs.existsSync(file)) {\n\
            opt.dataTo = opt.dataTo.replace(\n\
                \"require(\\\"utility2\\\")\",\n\
                \"require(\\\"\" + file + \"\\\")\"\n\
            );\n\
        }\n\
    });\n\
    opt.customize(opt);\n\
    // save test.js\n\
    result = opt.dataTo;\n\
    local.fs.writeFileSync(\"test.js\", result);\n\
    onError();\n\
    return result;\n\
};\n\
\n\
local.childProcessSpawnWithTimeout = function (command, args, opt) {\n\
/*\n\
 * this function will run like child_process.spawn,\n\
 * but with auto-timeout after timeout milliseconds\n\
 * example usage:\n\
    var child = local.childProcessSpawnWithTimeout(\n\
        \"/bin/sh\",\n\
        [\"-c\", \"echo hello world\"],\n\
        {stdio: [\"ignore\", 1, 2], timeout: 5000}\n\
    );\n\
    child.on(\"error\", console.error);\n\
    child.on(\"exit\", function (exitCode) {\n\
        console.error(\"exitCode \" + exitCode);\n\
    });\n\
 */\n\
    var child;\n\
    var child_process;\n\
    var timerTimeout;\n\
    child_process = require(\"child_process\");\n\
    // spawn child\n\
    child = child_process.spawn(command, args, opt).on(\"exit\", function () {\n\
        // cleanup timerTimeout\n\
        try {\n\
            process.kill(timerTimeout.pid);\n\
        } catch (ignore) {}\n\
    });\n\
    // init timerTimeout\n\
    timerTimeout = child_process.spawn(\n\
        // convert timeout to integer seconds with 2 second delay\n\
        \"sleep \"\n\
        + Math.floor(\n\
            0.001 * (Number(opt && opt.timeout) || local.timeoutDefault)\n\
            + 2\n\
        )\n\
        + \"; kill -9 \" + child.pid + \" 2>/dev/null\",\n\
        {\n\
            shell: true,\n\
            stdio: \"ignore\"\n\
        }\n\
    );\n\
    return child;\n\
};\n\
\n\
local.childProcessSpawnWithUtility2 = function (script, onError) {\n\
/*\n\
 * this function will run child_process.spawn, with lib.utility2.sh sourced\n\
 */\n\
    require(\"child_process\").spawn(\n\
        \". \" + (process.env.npm_config_dir_utility2 || __dirname)\n\
        + \"/lib.utility2.sh; \" + script,\n\
        {\n\
            shell: true,\n\
            stdio: [\n\
                \"ignore\", 1, 2\n\
            ]\n\
        }\n\
    ).on(\"exit\", function (exitCode) {\n\
        onError(exitCode && Object.assign(new Error(), {\n\
            exitCode\n\
        }));\n\
    });\n\
};\n\
\n\
local.cliRun = function (opt) {\n\
/*\n\
 * this function will run the cli with given <opt>\n\
 */\n\
    local.cliDict._eval = local.cliDict._eval || function () {\n\
    /*\n\
     * <code>\n\
     * will eval <code>\n\
     */\n\
        globalThis.local = local;\n\
        local.vm.runInThisContext(process.argv[3]);\n\
    };\n\
    local.cliDict[\"--eval\"] = local.cliDict[\"--eval\"] || local.cliDict._eval;\n\
    local.cliDict[\"-e\"] = local.cliDict[\"-e\"] || local.cliDict._eval;\n\
    local.cliDict._help = local.cliDict._help || function () {\n\
    /*\n\
     *\n\
     * will print help\n\
     */\n\
        var commandList;\n\
        var file;\n\
        var packageJson;\n\
        var text;\n\
        var textDict;\n\
        commandList = [\n\
            {\n\
                argList: \"<arg2>  ...\",\n\
                description: \"usage:\",\n\
                command: [\n\
                    \"<arg1>\"\n\
                ]\n\
            }, {\n\
                argList: \"'console.log(\\\"hello world\\\")'\",\n\
                description: \"example:\",\n\
                command: [\n\
                    \"--eval\"\n\
                ]\n\
            }\n\
        ];\n\
        file = __filename.replace((\n\
            /.*\\//\n\
        ), \"\");\n\
        opt = Object.assign({}, opt);\n\
        packageJson = require(\"./package.json\");\n\
        // validate comment\n\
        opt.rgxComment = opt.rgxComment || (\n\
            /\\)\\u0020\\{\\n(?:|\\u0020{4})\\/\\*\\n(?:\\u0020|\\u0020{5})\\*((?:\\u0020<[^>]*?>|\\u0020\\.\\.\\.)*?)\\n(?:\\u0020|\\u0020{5})\\*\\u0020(will\\u0020.*?\\S)\\n(?:\\u0020|\\u0020{5})\\*\\/\\n(?:\\u0020{4}|\\u0020{8})\\S/\n\
        );\n\
        textDict = {};\n\
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {\n\
            if (key[0] === \"_\" && key !== \"_default\") {\n\
                return;\n\
            }\n\
            text = String(local.cliDict[key]);\n\
            if (key === \"_default\") {\n\
                key = \"\";\n\
            }\n\
            textDict[text] = textDict[text] || (ii + 2);\n\
            ii = textDict[text];\n\
            if (commandList[ii]) {\n\
                commandList[ii].command.push(key);\n\
                return;\n\
            }\n\
            try {\n\
                commandList[ii] = opt.rgxComment.exec(text);\n\
                commandList[ii] = {\n\
                    argList: (commandList[ii][1] || \"\").trim(),\n\
                    command: [\n\
                        key\n\
                    ],\n\
                    description: commandList[ii][2]\n\
                };\n\
            } catch (ignore) {\n\
                local.assertThrow(null, new Error(\n\
                    \"cliRun - cannot parse comment in COMMAND \"\n\
                    + key\n\
                    + \":\\nnew RegExp(\"\n\
                    + JSON.stringify(opt.rgxComment.source)\n\
                    + \").exec(\" + JSON.stringify(text).replace((\n\
                        /\\\\\\\\/g\n\
                    ), \"\\u0000\").replace((\n\
                        /\\\\n/g\n\
                    ), \"\\\\n\\\\\\n\").replace((\n\
                        /\\u0000/g\n\
                    ), \"\\\\\\\\\") + \");\"\n\
                ));\n\
            }\n\
        });\n\
        text = \"\";\n\
        text += packageJson.name + \" (\" + packageJson.version + \")\\n\\n\";\n\
        text += commandList.filter(function (elem) {\n\
            return elem;\n\
        }).map(function (elem, ii) {\n\
            elem.command = elem.command.filter(function (elem) {\n\
                return elem;\n\
            });\n\
            switch (ii) {\n\
            case 0:\n\
            case 1:\n\
                elem.argList = [\n\
                    elem.argList\n\
                ];\n\
                break;\n\
            default:\n\
                elem.argList = elem.argList.split(\" \");\n\
                elem.description = (\n\
                    \"# COMMAND \"\n\
                    + (elem.command[0] || \"<none>\") + \"\\n# \"\n\
                    + elem.description\n\
                );\n\
            }\n\
            return (\n\
                elem.description + \"\\n  \" + file\n\
                + (\"  \" + elem.command.sort().join(\"|\") + \"  \")\n\
                    .replace((\n\
                    /^\\u0020{4}$/\n\
                ), \"  \")\n\
                + elem.argList.join(\"  \")\n\
            );\n\
        })\n\
        .join(\"\\n\\n\");\n\
        console.log(text);\n\
    };\n\
    local.cliDict[\"--help\"] = local.cliDict[\"--help\"] || local.cliDict._help;\n\
    local.cliDict[\"-h\"] = local.cliDict[\"-h\"] || local.cliDict._help;\n\
    local.cliDict._default = local.cliDict._default || local.cliDict._help;\n\
    local.cliDict.help = local.cliDict.help || local.cliDict._help;\n\
    local.cliDict._interactive = local.cliDict._interactive || function () {\n\
    /*\n\
     *\n\
     * will start interactive-mode\n\
     */\n\
        globalThis.local = local;\n\
        local.identity(local.replStart || require(\"repl\").start)({\n\
            useGlobal: true\n\
        });\n\
    };\n\
    local.cliDict[\"--interactive\"] = (\n\
        local.cliDict[\"--interactive\"]\n\
        || local.cliDict._interactive\n\
    );\n\
    local.cliDict[\"-i\"] = local.cliDict[\"-i\"] || local.cliDict._interactive;\n\
    local.cliDict._version = local.cliDict._version || function () {\n\
    /*\n\
     *\n\
     * will print version\n\
     */\n\
        console.log(require(__dirname + \"/package.json\").version);\n\
    };\n\
    local.cliDict[\"--version\"] = (\n\
        local.cliDict[\"--version\"]\n\
        || local.cliDict._version\n\
    );\n\
    local.cliDict[\"-v\"] = local.cliDict[\"-v\"] || local.cliDict._version;\n\
    // default to --help command if no arguments are given\n\
    if (process.argv.length <= 2) {\n\
        local.cliDict._help();\n\
        return;\n\
    }\n\
    if (local.cliDict[process.argv[2]]) {\n\
        local.cliDict[process.argv[2]]();\n\
        return;\n\
    }\n\
    local.cliDict._default();\n\
};\n\
\n\
local.corsBackendHostInject = function (url, backendHost, rgx, location) {\n\
/*\n\
 * this function will if <location>.host is a github site,\n\
 * inject <backendHost> into <url> with given <rgx>\n\
 */\n\
    location = (\n\
        location\n\
        || (typeof window === \"object\" && window && window.location)\n\
    );\n\
    if (!(backendHost && location && (\n\
        /\\bgithub.io$/\n\
    ).test(location.host))) {\n\
        return url;\n\
    }\n\
    // init github-branch\n\
    location.pathname.replace((\n\
        /\\/build\\.\\.(alpha|beta|master)\\.\\.travis-ci\\.org\\//\n\
    ), function (ignore, match1) {\n\
        backendHost = backendHost.replace(\"-alpha.\", \"-\" + match1 + \".\");\n\
    });\n\
    return url.replace(rgx || (\n\
        /.*?($)/m\n\
    ), backendHost + \"$1\");\n\
};\n\
\n\
local.corsForwardProxyHostIfNeeded = function (xhr) {\n\
/*\n\
 * this function will return xhr.corsForwardProxyHost, if needed\n\
 */\n\
    return (\n\
        local.isBrowser\n\
        && local.env.npm_package_nameLib\n\
        && (\n\
            /^https?:\\/\\//\n\
        ).test(xhr.url)\n\
        && xhr.url.indexOf(xhr.location.protocol + \"//\" + xhr.location.host)\n\
        !== 0\n\
        && (\n\
            /\\.github\\.io$/\n\
        ).test(xhr.location.host)\n\
        && xhr.corsForwardProxyHost !== \"disabled\"\n\
        && (xhr.corsForwardProxyHost || \"https://h1-proxy1.herokuapp.com\")\n\
    );\n\
};\n\
\n\
/* istanbul ignore next */\n\
local.cryptoAesXxxCbcRawDecrypt = function (opt, onError) {\n\
/*\n\
 * this function will aes-xxx-cbc decrypt with given <opt>\n\
 * example usage:\n\
    data = new Uint8Array([1,2,3]);\n\
    key = '0123456789abcdef0123456789abcdef';\n\
    mode = null;\n\
    local.cryptoAesXxxCbcRawEncrypt({\n\
        data: data,\n\
        key: key,\n\
        mode: mode\n\
    }, function (err, data) {\n\
        console.assert(!err, err);\n\
        local.cryptoAesXxxCbcRawDecrypt({\n\
            data: data,\n\
            key: key,\n\
            mode: mode\n\
        }, console.log);\n\
    });\n\
 */\n\
    var cipher;\n\
    var crypto;\n\
    var data;\n\
    var ii;\n\
    var iv;\n\
    var key;\n\
    // init key\n\
    key = new Uint8Array(0.5 * opt.key.length);\n\
    ii = 0;\n\
    while (ii < key.byteLength) {\n\
        key[ii] = parseInt(opt.key.slice(2 * ii, 2 * ii + 2), 16);\n\
        ii += 2;\n\
    }\n\
    data = opt.data;\n\
    // base64\n\
    if (opt.mode === \"base64\") {\n\
        data = local.base64ToBuffer(data);\n\
    }\n\
    // normalize data\n\
    if (Object.prototype.toString.call(data) !== \"[object Uint8Array]\") {\n\
        data = new Uint8Array(data);\n\
    }\n\
    // init iv\n\
    iv = data.subarray(0, 16);\n\
    // optimization - create resized-view of data\n\
    data = data.subarray(16);\n\
    crypto = globalThis.crypto;\n\
    if (!local.isBrowser) {\n\
        setTimeout(function () {\n\
            crypto = require(\"crypto\");\n\
            cipher = crypto.createDecipheriv(\n\
                \"aes-\" + (8 * key.byteLength) + \"-cbc\",\n\
                key,\n\
                iv\n\
            );\n\
            onError(null, Buffer.concat([\n\
                cipher.update(data), cipher.final()\n\
            ]));\n\
        });\n\
        return;\n\
    }\n\
    crypto.subtle.importKey(\"raw\", key, {\n\
        name: \"AES-CBC\"\n\
    }, false, [\n\
        \"decrypt\"\n\
    ]).then(function (key) {\n\
        crypto.subtle.decrypt({\n\
            iv,\n\
            name: \"AES-CBC\"\n\
        }, key, data).then(function (data) {\n\
            onError(null, new Uint8Array(data));\n\
        }).catch(onError);\n\
    }).catch(onError);\n\
};\n\
\n\
/* istanbul ignore next */\n\
local.cryptoAesXxxCbcRawEncrypt = function (opt, onError) {\n\
/*\n\
 * this function will aes-xxx-cbc encrypt with given <opt>\n\
 * example usage:\n\
    data = new Uint8Array([1,2,3]);\n\
    key = '0123456789abcdef0123456789abcdef';\n\
    mode = null;\n\
    local.cryptoAesXxxCbcRawEncrypt({\n\
        data: data,\n\
        key: key,\n\
        mode: mode\n\
    }, function (err, data) {\n\
        console.assert(!err, err);\n\
        local.cryptoAesXxxCbcRawDecrypt({\n\
            data: data,\n\
            key: key,\n\
            mode: mode\n\
        }, console.log);\n\
    });\n\
 */\n\
    var cipher;\n\
    var crypto;\n\
    var data;\n\
    var ii;\n\
    var iv;\n\
    var key;\n\
    // init key\n\
    key = new Uint8Array(0.5 * opt.key.length);\n\
    ii = 0;\n\
    while (ii < key.byteLength) {\n\
        key[ii] = parseInt(opt.key.slice(2 * ii, 2 * ii + 2), 16);\n\
        ii += 2;\n\
    }\n\
    data = opt.data;\n\
    // init iv\n\
    iv = new Uint8Array((((data.byteLength) >> 4) << 4) + 32);\n\
    crypto = globalThis.crypto;\n\
    if (!local.isBrowser) {\n\
        setTimeout(function () {\n\
            crypto = require(\"crypto\");\n\
            // init iv\n\
            iv.set(crypto.randomBytes(16));\n\
            cipher = crypto.createCipheriv(\n\
                \"aes-\" + (8 * key.byteLength) + \"-cbc\",\n\
                key,\n\
                iv.subarray(0, 16)\n\
            );\n\
            data = cipher.update(data);\n\
            iv.set(data, 16);\n\
            iv.set(cipher.final(), 16 + data.byteLength);\n\
            if (opt.mode === \"base64\") {\n\
                iv = local.base64FromBuffer(iv);\n\
                iv += \"\\n\";\n\
            }\n\
            onError(null, iv);\n\
        });\n\
        return;\n\
    }\n\
    // init iv\n\
    iv.set(crypto.getRandomValues(new Uint8Array(16)));\n\
    crypto.subtle.importKey(\"raw\", key, {\n\
        name: \"AES-CBC\"\n\
    }, false, [\n\
        \"encrypt\"\n\
    ]).then(function (key) {\n\
        crypto.subtle.encrypt({\n\
            iv: iv.subarray(0, 16),\n\
            name: \"AES-CBC\"\n\
        }, key, data).then(function (data) {\n\
            iv.set(new Uint8Array(data), 16);\n\
            // base64\n\
            if (opt.mode === \"base64\") {\n\
                iv = local.base64FromBuffer(iv);\n\
                iv += \"\\n\";\n\
            }\n\
            onError(null, iv);\n\
        }).catch(onError);\n\
    }).catch(onError);\n\
};\n\
\n\
local.dateGetWeekOfMonth = function (date) {\n\
/*\n\
 * this function will return sunday-based week-of-month from <date>\n\
 */\n\
    date = new Date(date.slice(0, 10) + \"T00:00:00Z\");\n\
    return Math.ceil((date.getUTCDate() + new Date(\n\
        date.getUTCFullYear(),\n\
        date.getUTCMonth(),\n\
        1\n\
    ).getUTCDay()) / 7) - 1;\n\
};\n\
\n\
local.dateGetWeekOfYear = function (date) {\n\
/*\n\
 * this function will return ISO week-of-year from <date>\n\
 *\n\
 * Based on information at:\n\
 *\n\
 *    http://www.merlyn.demon.co.uk/weekcalc.htm#WNR\n\
 *\n\
 * Algorithm is to find nearest thursday, it's year\n\
 * is the year of the week number. Then get weeks\n\
 * between that date and the first day of that year.\n\
 *\n\
 * Note that dates in one year can be weeks of previous\n\
 * or next year, overlap is up to 3 days.\n\
 *\n\
 * e.g. 2014/12/29 is Monday in week  1 of 2015\n\
 *      2012/1/1   is Sunday in week 52 of 2011\n\
 *\n\
 * https://stackoverflow.com/questions/6117814/get-week-of-year-in-javascript-like-in-php\n\
 */\n\
    date = new Date(date.slice(0, 10) + \"T00:00:00Z\");\n\
    // Set to nearest Thursday: current date + 4 - current day number\n\
    // Make Sunday's day number 7\n\
    date.setUTCDate(date.getUTCDate() + 4 - (date.getUTCDay() || 7));\n\
    // Calculate full weeks to nearest Thursday\n\
    return Math.ceil((((\n\
        date\n\
        // Get first day of year\n\
        - new Date(Date.UTC(date.getUTCFullYear(), 0, 1))\n\
    ) / 86400000) + 1) / 7);\n\
};\n\
\n\
local.dateUtcFromLocal = function (date, timezoneOffset) {\n\
/*\n\
 * this function will convert local-<date> to utc-date\n\
 */\n\
    if (!date) {\n\
        return \"\";\n\
    }\n\
    local.assertThrow((\n\
        /^\\d\\d\\d\\d-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(\\.\\d+?)?$/\n\
    ).test(date), \"invalid local-date \" + date);\n\
    if (!timezoneOffset) {\n\
        return new Date(date).toISOString();\n\
    }\n\
    return new Date(\n\
        new Date(date + \"Z\").getTime() + timezoneOffset * 60000\n\
    ).toISOString();\n\
};\n\
\n\
local.dateUtcToLocal = function (date, timezoneOffset) {\n\
/*\n\
 * this function will convert utc-<date> to local-date\n\
 */\n\
    if (!date) {\n\
        return \"\";\n\
    }\n\
    local.assertThrow((\n\
        /^\\d\\d\\d\\d-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(\\.\\d+?)?Z$/\n\
    ).test(date), \"invalid utc-date \" + date);\n\
    timezoneOffset = timezoneOffset || new Date(date).getTimezoneOffset();\n\
    return new Date(\n\
        new Date(date).getTime() - timezoneOffset * 60000\n\
    ).toISOString();\n\
};\n\
\n\
local.domFragmentRender = function (template, dict) {\n\
/*\n\
 * this function will return dom-elem rendered from <template>\n\
 */\n\
    var tmp;\n\
    tmp = document.createElement(\"template\");\n\
    tmp.innerHTML = local.templateRender(template, dict);\n\
    return tmp.content;\n\
};\n\
\n\
local.domQuerySelectorAllTagName = function (selector) {\n\
/*\n\
 * this function will return all tagName that match <selector>\n\
 */\n\
    var set;\n\
    set = new Set();\n\
    Array.from(document.querySelectorAll(\n\
        selector\n\
    )).forEach(function (elem) {\n\
        set.add(elem.tagName);\n\
    });\n\
    return Array.from(set).sort();\n\
};\n\
\n\
local.domSelectOptionValue = function (elem) {\n\
/*\n\
 * this function will return <elem>.options[<elem>.selectedIndex].value\n\
 */\n\
    elem = elem && elem.options[elem.selectedIndex];\n\
    return (elem && elem.value) || \"\";\n\
};\n\
\n\
local.domStyleValidate = function () {\n\
/*\n\
 * this function will validate <style> tags\n\
 */\n\
    var rgx;\n\
    var tmp;\n\
    rgx = (\n\
        /^0\\u0020(?:(body\\u0020>\\u0020)?(?:form\\u0020>\\u0020)?(?:\\.testReportDiv\\u0020.+|\\.x-istanbul\\u0020.+|\\.button|\\.colorError|\\.readonly|\\.textarea|\\.uiAnimateShake|\\.uiAnimateSlide|a|body|code|div|input|pre|textarea)(?:,|\\u0020\\{))|^[1-9]\\d*?\\u0020#/m\n\
    );\n\
    tmp = [];\n\
    Array.from(\n\
        // ternary-operator\n\
        (\n\
            typeof document === \"object\"\n\
            && document\n\
            && typeof document.querySelector === \"function\"\n\
        )\n\
        ? document.querySelectorAll(\n\
            \"style\"\n\
        )\n\
        : []\n\
    ).map(function (elem, ii) {\n\
        elem.innerHTML.replace((\n\
            /\\/\\*[\\S\\s]*?\\*\\/|;|\\}/g\n\
        ), \"\\n\").replace((\n\
            /^([^\\n\\u0020@].*?)[,{:].*?$/gm\n\
        ), function (match0, match1) {\n\
            try {\n\
                ii = document.querySelectorAll(\n\
                    match1\n\
                ).length;\n\
            } catch (errCaught) {\n\
                console.error(errCaught);\n\
            }\n\
            if (!(ii > 1)) {\n\
                tmp.push(ii + \" \" + match0);\n\
            }\n\
        });\n\
    });\n\
    tmp.filter(function (elem) {\n\
        return !rgx.test(elem);\n\
    }).sort().reverse().forEach(function (elem, ii, list) {\n\
        console.error(\n\
            \"domStyleValidateUnmatched \" + (list.length - ii) + \". \" + elem\n\
        );\n\
    });\n\
};\n\
\n\
local.errorMessagePrepend = function (err, message) {\n\
/*\n\
 * this function will prepend message to <err>.message and <err>.stack\n\
 */\n\
    if (err === local.errDefault) {\n\
        return;\n\
    }\n\
    err.message = message + err.message;\n\
    err.stack = message + err.stack;\n\
    return err;\n\
};\n\
\n\
local.exit = function (exitCode, testReport) {\n\
/*\n\
 * this function will exit current process with given <exitCode>\n\
 */\n\
    local.onErrorDefault(typeof exitCode !== \"number\" && exitCode);\n\
    exitCode = (\n\
        (!exitCode || Number(exitCode) === 0)\n\
        ? 0\n\
        : Number(exitCode) || 1\n\
    );\n\
    if (!local.isBrowser) {\n\
        process.exit(exitCode);\n\
        return;\n\
    }\n\
    if (testReport !== globalThis.utility2_testReport) {\n\
        return;\n\
    }\n\
    // update coverage\n\
    (document.querySelector(\n\
        \"#coverageReportDiv1\"\n\
    ) || {}).innerHTML = (\n\
        local.istanbulCoverageReportCreate()\n\
    );\n\
    // save testReport\n\
    globalThis.utility2_testReportSave();\n\
};\n\
\n\
local.fsReadFileOrEmptyStringSync = function (file, opt) {\n\
/*\n\
 * this function will try to read file or return empty-string, or\n\
 * if <opt> === \"json\", then try to JSON.parse file or return null\n\
 */\n\
    try {\n\
        return (\n\
            opt === \"json\"\n\
            ? JSON.parse(local.fs.readFileSync(file, \"utf8\"))\n\
            : local.fs.readFileSync(file, opt)\n\
        );\n\
    } catch (ignore) {\n\
        return (\n\
            opt === \"json\"\n\
            ? {}\n\
            : \"\"\n\
        );\n\
    }\n\
};\n\
\n\
local.fsRmrSync = function (dir) {\n\
/*\n\
 * this function will synchronously \"rm -fr\" dir\n\
 */\n\
    local.child_process.execFileSync(\n\
        \"rm\",\n\
        [\n\
            \"-fr\", local.path.resolve(process.cwd(), dir)\n\
        ],\n\
        {\n\
            stdio: [\n\
                \"ignore\", 1, 2\n\
            ]\n\
        }\n\
    );\n\
};\n\
\n\
local.fsWriteFileWithMkdirpSync = function (file, data, mode) {\n\
/*\n\
 * this function will synchronously \"mkdir -p\" and write <data> to <file>\n\
 */\n\
    try {\n\
        if (\n\
            mode === \"noWrite\"\n\
            || typeof require(\"fs\").writeFileSync !== \"function\"\n\
        ) {\n\
            return;\n\
        }\n\
    } catch (ignore) {\n\
        return;\n\
    }\n\
    // try to write to file\n\
    try {\n\
        require(\"fs\").writeFileSync(file, data);\n\
    } catch (ignore) {\n\
        // mkdir -p\n\
        require(\"child_process\").spawnSync(\n\
            \"mkdir\",\n\
            [\n\
                \"-p\", require(\"path\").dirname(file)\n\
            ],\n\
            {\n\
                stdio: [\n\
                    \"ignore\", 1, 2\n\
                ]\n\
            }\n\
        );\n\
        // re-write to file\n\
        require(\"fs\").writeFileSync(file, data);\n\
    }\n\
};\n\
\n\
local.isNullOrUndefined = function (arg0) {\n\
/*\n\
 * this function will test if arg0 is null or undefined\n\
 */\n\
    return arg0 === null || arg0 === undefined;\n\
};\n\
\n\
local.jslintAutofixLocalFunction = function (code, file) {\n\
/*\n\
 * this function will jslint-autofix local-function\n\
 */\n\
    var code2;\n\
    var dictFnc;\n\
    var dictProp;\n\
    var tmp;\n\
    if (local.isBrowser) {\n\
        return code;\n\
    }\n\
    file = file.replace(process.cwd() + \"/\", \"\");\n\
    switch (file) {\n\
    case \"README.md\":\n\
    case \"lib.\" + process.env.npm_package_nameLib + \".js\":\n\
    case \"lib.\" + process.env.npm_package_nameLib + \".sh\":\n\
    case \"lib.apidoc.js\":\n\
    case \"lib.db.js\":\n\
    case \"lib.github_crud.js\":\n\
    case \"lib.istanbul.js\":\n\
    case \"lib.jslint.js\":\n\
    case \"lib.marked.js\":\n\
    case \"lib.sjcl.js\":\n\
    case \"lib.swgg.js\":\n\
    case \"npm_scripts.sh\":\n\
    case \"test.js\":\n\
        break;\n\
    default:\n\
        return code;\n\
    }\n\
    // autofix - assets.example.begin.js\n\
    code = code.replace((\n\
        /^\\(function\\u0020\\(globalThis\\)\\u0020\\{\\n[\\S\\s]*?\\n\\}\\(this\\)\\);\\n/m\n\
    ), local.assetsDict[\"/assets.example.begin.js\"]);\n\
    // autofix - assets.my_app.template.js\n\
    code = local.stringMerge(\n\
        code,\n\
        local.assetsDict[\"/assets.my_app.template.js\"].replace((\n\
            /my_app/g\n\
        ), file.split(\".\")[1]),\n\
        file !== \"README.md\" && local.identity(\n\
            /\\n\\/\\*\\u0020istanbul\\u0020instrument\\u0020in\\u0020package\\u0020[\\S\\s]*?\\n\\/\\*\\u0020validateLineSortedReset\\u0020\\*\\/\\n/\n\
        )\n\
    );\n\
    // customize local for assets.utility2.rollup.js\n\
    if (\n\
        file === \"lib.\" + process.env.npm_package_nameLib + \".js\"\n\
        && local.fs.existsSync(\"./assets.utility2.rollup.js\")\n\
        && local.env.npm_package_nameLib !== \"swgg\"\n\
    ) {\n\
        code = code.replace(\n\
            \"    // || globalThis.utility2_rollup_old\",\n\
            \"    || globalThis.utility2_rollup_old\"\n\
        ).replace(\n\
            \"    // || require(\\\"./assets.utility2.rollup.js\\\")\",\n\
            \"    || require(\\\"./assets.utility2.rollup.js\\\")\"\n\
        );\n\
    }\n\
    // init functionAllDict and functionBaseDict\n\
    [\n\
        [\n\
            \"utility2\", \"swgg\"\n\
        ], [\n\
            \"utility2\", \"apidoc\", \"db\", \"github_crud\", \"swgg\"\n\
        ]\n\
    ].forEach(function (dictList, ii) {\n\
        tmp = (\n\
            ii\n\
            ? \"functionAllDict\"\n\
            : \"functionBaseDict\"\n\
        );\n\
        if (local[tmp]) {\n\
            return;\n\
        }\n\
        local[tmp] = {};\n\
        dictList.forEach(function (dict) {\n\
            dict = local[dict];\n\
            Object.keys(dict).forEach(function (key) {\n\
                if (\n\
                    !(\n\
                        /^[A-Z_]|^testCase_/m\n\
                    ).test(key)\n\
                    && typeof dict[key] === \"function\"\n\
                ) {\n\
                    local[tmp][key] = local[tmp][key] || String(dict[key]);\n\
                }\n\
            });\n\
        });\n\
        Object.keys(local[tmp]).forEach(function (key) {\n\
            if (process.binding(\"natives\")[key]) {\n\
                local[tmp][key] = undefined;\n\
            }\n\
        });\n\
    });\n\
    // autofix - local-function\n\
    dictFnc = {};\n\
    dictProp = {};\n\
    code = code.replace((\n\
        /^local\\.(.*?)\\u0020=\\u0020(function\\u0020\\([\\S\\s]*?\\n\\});\\n+/gm\n\
    ), function (match0, key, match2, match3) {\n\
        // local-function - duplicate\n\
        if (dictFnc[key]) {\n\
            return \"\";\n\
        }\n\
        // local-function - normalize\n\
        dictFnc[key] = true;\n\
        match3 = local.functionAllDict[key] || \"\";\n\
        // make shell-safe\n\
        // https://unix.stackexchange.com/questions/57794/shell-escape-characters-for-sh-c\n\
        if (file.slice(-3) === \".sh\") {\n\
            match3 = match3.replace((\n\
                /'/g\n\
            ), \"'\\\"'\\\"'\");\n\
        }\n\
        if (match3 && match3 !== match2) {\n\
            match0 = match0.replace(match2, match3.replace((\n\
                /\\$\\$|\\$/g\n\
            ), \"$$$$\"));\n\
        }\n\
        return match0.trimRight() + \"\\n\\n\";\n\
    });\n\
    // comment\n\
    code2 = code;\n\
    code2 = code2.replace((\n\
        /^\\u0020*?\\/\\*[\\S\\s]*?\\*\\/|^\\u0020*?(?:\\/\\/.*?|.*?\\\\)$/gm\n\
    ), \"\");\n\
    // local-function - update dictFnc and dictProp\n\
    code2.replace((\n\
        /\\blocal\\.(\\w+?\\b)(?:\\u0020(===|=|\\|\\|)(?:\\u0020\"function\"\\u0020&&\\u0020local\\.\\w|\\u0020|$))?/gm\n\
    ), function (ignore, match1, match2) {\n\
        switch (match2) {\n\
        case \"=\":\n\
            dictFnc[match1] = true;\n\
            break;\n\
        case \"===\":\n\
        case \"||\":\n\
            dictProp[match1] = false;\n\
            break;\n\
        default:\n\
            dictProp[match1] = true;\n\
        }\n\
    });\n\
    [\n\
        dictFnc, dictProp\n\
    ].forEach(function (dict) {\n\
        Object.keys(dict).forEach(function (key) {\n\
            dict[key] = dict[key] && local.functionBaseDict[key];\n\
        });\n\
    });\n\
    dictFnc = local.jsonCopy(dictFnc);\n\
    dictProp = local.jsonCopy(dictProp);\n\
    [\n\
        \"assertThrow\",\n\
        \"functionOrNop\",\n\
        \"identity\",\n\
        \"nop\",\n\
        \"objectAssignDefault\"\n\
    ].forEach(function (key) {\n\
        dictFnc[key] = true;\n\
        dictProp[key] = true;\n\
    });\n\
    // local-function - missing\n\
    switch (local.fs.existsSync(\"assets.utility2.rollup.js\") || file) {\n\
    case \"README.md\":\n\
    case \"lib.swgg.js\":\n\
    case \"lib.utility2.js\":\n\
    case \"test.js\":\n\
    case true:\n\
        break;\n\
    default:\n\
        Object.keys(dictProp).forEach(function (key) {\n\
            if (dictProp[key] && !dictFnc[key]) {\n\
                console.error(\n\
                    \"local-function - missing (\" + file + \") local.\" + key\n\
                );\n\
            }\n\
        });\n\
    }\n\
    // local-function - unused\n\
    switch (file) {\n\
    case \"lib.swgg.js\":\n\
    case \"lib.utility2.js\":\n\
    case \"lib.utility2.sh\":\n\
        break;\n\
    default:\n\
        Object.keys(dictFnc).forEach(function (key) {\n\
            if (!dictProp.hasOwnProperty(key)) {\n\
                console.error(\n\
                    \"local-function - unused (\" + file + \") local.\" + key\n\
                );\n\
            }\n\
        });\n\
    }\n\
    return code;\n\
};\n\
\n\
local.jsonCopy = function (obj) {\n\
/*\n\
 * this function will deep-copy obj\n\
 */\n\
    return (\n\
        obj === undefined\n\
        ? undefined\n\
        : JSON.parse(JSON.stringify(obj))\n\
    );\n\
};\n\
\n\
local.jsonStringifyOrdered = function (obj, replacer, space) {\n\
/*\n\
 * this function will JSON.stringify <obj>,\n\
 * with object-keys sorted and circular-references removed\n\
 * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Syntax\n\
 */\n\
    var circularSet;\n\
    var stringify;\n\
    var tmp;\n\
    stringify = function (obj) {\n\
    /*\n\
     * this function will recursively JSON.stringify obj,\n\
     * with object-keys sorted and circular-references removed\n\
     */\n\
        // if obj is not an object or function, then JSON.stringify as normal\n\
        if (!(\n\
            obj\n\
            && typeof obj === \"object\"\n\
            && typeof obj.toJSON !== \"function\"\n\
        )) {\n\
            return JSON.stringify(obj);\n\
        }\n\
        // ignore circular-reference\n\
        if (circularSet.has(obj)) {\n\
            return;\n\
        }\n\
        circularSet.add(obj);\n\
        // if obj is an array, then recurse its items\n\
        if (Array.isArray(obj)) {\n\
            tmp = \"[\" + obj.map(function (obj) {\n\
                // recurse\n\
                tmp = stringify(obj);\n\
                return (\n\
                    typeof tmp === \"string\"\n\
                    ? tmp\n\
                    : \"null\"\n\
                );\n\
            }).join(\",\") + \"]\";\n\
            circularSet.delete(obj);\n\
            return tmp;\n\
        }\n\
        // if obj is not an array,\n\
        // then recurse its items with object-keys sorted\n\
        tmp = \"{\" + Object.keys(obj).sort().map(function (key) {\n\
            // recurse\n\
            tmp = stringify(obj[key]);\n\
            if (typeof tmp === \"string\") {\n\
                return JSON.stringify(key) + \":\" + tmp;\n\
            }\n\
        }).filter(function (obj) {\n\
            return typeof obj === \"string\";\n\
        }).join(\",\") + \"}\";\n\
        circularSet.delete(obj);\n\
        return tmp;\n\
    };\n\
    circularSet = new Set();\n\
    return JSON.stringify((\n\
        (typeof obj === \"object\" && obj)\n\
        // recurse\n\
        ? JSON.parse(stringify(obj))\n\
        : obj\n\
    ), replacer, space);\n\
};\n\
\n\
local.jwtAes256GcmDecrypt = function (token, key) {\n\
/*\n\
 * this function will use json-web-encryption to\n\
 * aes-256-gcm-decrypt <token> with given base64url-encoded <key>\n\
 * https://tools.ietf.org/html/rfc7516\n\
 */\n\
    return local.tryCatchOnError(function () {\n\
        token = token\n\
        .replace((\n\
            /-/g\n\
        ), \"+\")\n\
        .replace((\n\
            /_/g\n\
        ), \"/\")\n\
        .split(\".\");\n\
        token = local.sjcl.decrypt(\n\
            local.sjcl.codec.base64url.toBits(local.jwtAes256KeyInit(key)),\n\
            JSON.stringify({\n\
                adata: token[4],\n\
                ct: token[3],\n\
                iv: token[2],\n\
                ks: 256,\n\
                mode: \"gcm\"\n\
            })\n\
        );\n\
        return local.jwtHs256Decode(token, key);\n\
    }, local.nop) || {};\n\
};\n\
\n\
local.jwtAes256GcmEncrypt = function (data, key) {\n\
/*\n\
 * this function will use json-web-encryption to\n\
 * aes-256-gcm-encrypt <data> with given base64url-encoded <key>\n\
 * https://tools.ietf.org/html/rfc7516\n\
 */\n\
    var adata;\n\
    adata = local.jwtAes256KeyCreate();\n\
    data = local.jwtHs256Encode(data, key);\n\
    data = JSON.parse(local.sjcl.encrypt(\n\
        local.sjcl.codec.base64url.toBits(local.jwtAes256KeyInit(key)),\n\
        data,\n\
        {\n\
            adata: local.sjcl.codec.base64url.toBits(adata),\n\
            ks: 256,\n\
            mode: \"gcm\"\n\
        }\n\
    ));\n\
    return local.normalizeJwtBase64Url(\n\
        \"eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4R0NNIn0..\"\n\
        + data.iv + \".\" + data.ct + \".\" + adata\n\
    );\n\
};\n\
\n\
local.jwtAes256KeyCreate = function () {\n\
/*\n\
 * this function will create a random, aes-256-base64url-jwt-key\n\
 */\n\
    return local.normalizeJwtBase64Url(\n\
        local.base64FromBuffer(local.bufferRandomBytes(32))\n\
    );\n\
};\n\
\n\
local.jwtAes256KeyInit = function (key) {\n\
/*\n\
 * this function will init aes-256-base64url-jwt-<key>\n\
 * https://jwt.io/\n\
 */\n\
    // init npm_config_jwtAes256Key\n\
    local.env.npm_config_jwtAes256Key = (\n\
        local.env.npm_config_jwtAes256Key\n\
        || \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"\n\
    );\n\
    return key || local.env.npm_config_jwtAes256Key;\n\
};\n\
\n\
local.jwtHs256Decode = function (token, key) {\n\
/*\n\
 * this function will decode json-web-token with given base64-encoded <key>\n\
 * https://jwt.io/\n\
 */\n\
    var Hmac;\n\
    var timeNow;\n\
    Hmac = local.sjcl.misc.hmac;\n\
    timeNow = Date.now() / 1000;\n\
    // try to decode token\n\
    return local.tryCatchOnError(function () {\n\
        token = token.split(\".\");\n\
        // validate header\n\
        local.assertThrow(\n\
            token[0] === \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\",\n\
            token\n\
        );\n\
        // validate signature\n\
        local.assertThrow(local.sjcl.codec.base64url.fromBits(\n\
            new Hmac(local.sjcl.codec.base64url.toBits(\n\
                local.jwtAes256KeyInit(key)\n\
            )).encrypt(token[0] + \".\" + token[1])\n\
        ) === token[2]);\n\
        // return decoded data\n\
        token = JSON.parse(local.base64ToUtf8(token[1]));\n\
        // https://tools.ietf.org/html/rfc7519#section-4.1\n\
        // validate jwt-registered-headers\n\
        local.assertThrow(!token.exp || token.exp >= timeNow);\n\
        local.assertThrow(!token.nbf || token.nbf <= timeNow);\n\
        return token;\n\
    }, local.nop) || {};\n\
};\n\
\n\
local.jwtHs256Encode = function (data, key) {\n\
/*\n\
 * this function will encode <data> into a json-web-token\n\
 * with given base64-encoded <key>\n\
 * https://jwt.io/\n\
 */\n\
    var Hmac;\n\
    Hmac = local.sjcl.misc.hmac;\n\
    data = (\n\
        \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.\"\n\
        + local.normalizeJwtBase64Url(\n\
            local.base64FromBuffer(JSON.stringify(data))\n\
        )\n\
    );\n\
    return data + \".\" + local.sjcl.codec.base64url.fromBits(\n\
        new Hmac(local.sjcl.codec.base64url.toBits(\n\
            local.jwtAes256KeyInit(key)\n\
        )).encrypt(data)\n\
    );\n\
};\n\
\n\
local.listGetElementRandom = function (list) {\n\
/*\n\
 * this function will return random elem from <list>\n\
 */\n\
    return list[Math.floor(Math.random() * list.length)];\n\
};\n\
\n\
local.listShuffle = function (list) {\n\
/*\n\
 * this function will inplace shuffle <list> using fisher-yates algorithm\n\
 * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n\
 */\n\
    var ii;\n\
    var random;\n\
    var swap;\n\
    ii = list.length;\n\
    while (ii > 1) {\n\
        ii -= 1;\n\
        random = Math.floor(Math.random() * (ii + 1));\n\
        swap = list[ii];\n\
        list[ii] = list[random];\n\
        list[random] = swap;\n\
    }\n\
    return list;\n\
};\n\
\n\
local.localStorageSetItemOrClear = function (key, value) {\n\
/*\n\
 * this function will try to set <key>/<value> pair to localStorage,\n\
 * or else call localStorage.clear()\n\
 */\n\
    try {\n\
        localStorage.setItem(key, value);\n\
    } catch (ignore) {\n\
        localStorage.clear();\n\
    }\n\
};\n\
\n\
local.middlewareAssetsCached = function (req, res, next) {\n\
/*\n\
 * this function will run middleware that will serve cached-assets\n\
 */\n\
    var opt;\n\
    opt = {};\n\
    local.onNext(opt, function (err, data) {\n\
        opt.result = opt.result || local.assetsDict[req.urlParsed.pathname];\n\
        if (opt.result === undefined) {\n\
            next(err);\n\
            return;\n\
        }\n\
        switch (opt.modeNext) {\n\
        case 1:\n\
            // skip gzip\n\
            if (\n\
                res.headersSent\n\
                || !(\n\
                    /\\bgzip\\b/\n\
                ).test(req.headers[\"accept-encoding\"])\n\
            ) {\n\
                opt.modeNext += 1;\n\
                opt.onNext();\n\
                return;\n\
            }\n\
            // gzip and cache result\n\
            local.taskCreateCached({\n\
                cacheDict: \"middlewareAssetsCachedGzip\",\n\
                key: req.urlParsed.pathname\n\
            }, function (onError) {\n\
                local.zlib.gzip(opt.result, function (err, data) {\n\
                    onError(err, !err && data.toString(\"base64\"));\n\
                });\n\
            }, opt.onNext);\n\
            break;\n\
        case 2:\n\
            // set gzip header\n\
            opt.result = local.base64ToBuffer(data);\n\
            res.setHeader(\"Content-Encoding\", \"gzip\");\n\
            res.setHeader(\"Content-Length\", opt.result.length);\n\
            opt.onNext();\n\
            break;\n\
        case 3:\n\
            local.middlewareCacheControlLastModified(\n\
                req,\n\
                res,\n\
                opt.onNext\n\
            );\n\
            break;\n\
        case 4:\n\
            res.end(opt.result);\n\
            break;\n\
        }\n\
    });\n\
    opt.modeNext = 0;\n\
    opt.onNext();\n\
};\n\
\n\
local.middlewareBodyRead = function (req, ignore, next) {\n\
/*\n\
 * this function will run middleware that will\n\
 * read and save the <req>-body to <req>.bodyRaw\n\
 */\n\
    // if req is already read, then goto next\n\
    if (!req.readable) {\n\
        next();\n\
        return;\n\
    }\n\
    local.streamReadAll(req, function (err, data) {\n\
        req.bodyRaw = req.bodyRaw || data;\n\
        next(err);\n\
    });\n\
};\n\
\n\
local.middlewareCacheControlLastModified = function (req, res, next) {\n\
/*\n\
 * this function will run middleware that will update res-header last-modified\n\
 */\n\
    // do not cache if headers already sent or url has '?' search indicator\n\
    if (res.headersSent || req.url.indexOf(\"?\") >= 0) {\n\
        next();\n\
        return;\n\
    }\n\
    // init serverResponseHeaderLastModified\n\
    local.serverResponseHeaderLastModified = (\n\
        local.serverResponseHeaderLastModified\n\
        // resolve to 1000 ms\n\
        || new Date(new Date().toUTCString())\n\
    );\n\
    // respond with 304 If-Modified-Since serverResponseHeaderLastModified\n\
    if (\n\
        new Date(req.headers[\"if-modified-since\"])\n\
        >= local.serverResponseHeaderLastModified\n\
    ) {\n\
        res.statusCode = 304;\n\
        res.end();\n\
        return;\n\
    }\n\
    res.setHeader(\"Cache-Control\", \"no-cache\");\n\
    res.setHeader(\n\
        \"Last-Modified\",\n\
        local.serverResponseHeaderLastModified.toUTCString()\n\
    );\n\
    next();\n\
};\n\
\n\
local.middlewareError = function (err, req, res) {\n\
/*\n\
 * this function will run middleware that will handle errors\n\
 */\n\
    // default - 404 Not Found\n\
    if (!err) {\n\
        local.serverRespondDefault(req, res, 404);\n\
        return;\n\
    }\n\
    // http://jsonapi.org/format/#errors\n\
    if (local.swgg && typeof local.swgg.serverRespondJsonapi === \"function\") {\n\
        local.swgg.serverRespondJsonapi(req, res, err);\n\
    }\n\
    // statusCode [400, 600)\n\
    local.serverRespondDefault(req, res, (\n\
        (err.statusCode >= 400 && err.statusCode < 600)\n\
        ? err.statusCode\n\
        : 500\n\
    ), err);\n\
};\n\
\n\
local.middlewareFileServer = function (req, res, next) {\n\
/*\n\
 * this function will run middleware that will serve files\n\
 */\n\
    if (req.method !== \"GET\" || local.isBrowser) {\n\
        next();\n\
        return;\n\
    }\n\
    req.urlFile = (process.cwd() + req.urlParsed.pathname\n\
    // security - disable parent directory lookup\n\
    .replace((\n\
        /.*\\/\\.\\.\\//g\n\
    ), \"/\"))\n\
        // replace trailing '/' with '/index.html'\n\
        .replace((\n\
        /\\/$/\n\
    ), \"/index.html\");\n\
    // serve file from cache\n\
    local.taskCreateCached({\n\
        cacheDict: \"middlewareFileServer\",\n\
        key: req.urlFile\n\
    // run background-task to re-cache file\n\
    }, function (onError) {\n\
        local.fs.readFile(req.urlFile, function (err, data) {\n\
            onError(err, data && local.base64FromBuffer(data));\n\
        });\n\
    }, function (err, data) {\n\
        // default to next\n\
        if (err) {\n\
            next();\n\
            return;\n\
        }\n\
        // init res-header content-type\n\
        local.serverRespondHeadSet(req, res, null, {\n\
            \"Content-Type\": local.contentTypeDict[(\n\
                /\\.[^.]*?$|$/m\n\
            ).exec(req.urlParsed.pathname)[0]]\n\
        });\n\
        // serve file from cache\n\
        res.end(local.base64ToBuffer(data));\n\
    });\n\
};\n\
\n\
local.middlewareForwardProxy = function (req, res, next) {\n\
/*\n\
 * this function will run middleware that will forward-proxy <req>\n\
 * to its destination-host\n\
 */\n\
    var isDone;\n\
    var onError;\n\
    var opt;\n\
    var timerTimeout;\n\
    // handle preflight-cors\n\
    if (req.method === \"OPTIONS\" && (\n\
        /forward-proxy-url/\n\
    )\n\
    .test(req.headers[\"access-control-request-headers\"])) {\n\
        local.serverRespondCors(req, res);\n\
        res.end();\n\
        return;\n\
    }\n\
    if (!req.headers[\"forward-proxy-url\"]) {\n\
        next();\n\
        return;\n\
    }\n\
    local.serverRespondCors(req, res);\n\
    // init onError\n\
    onError = function (err) {\n\
        if (isDone) {\n\
            return;\n\
        }\n\
        isDone = true;\n\
        // cleanup timerTimeout\n\
        clearTimeout(timerTimeout);\n\
        // debug middlewareForwardProxy\n\
        console.error(\"serverLog - \" + JSON.stringify({\n\
            time: new Date(opt.timeStart).toISOString(),\n\
            type: \"middlewareForwardProxyResponse\",\n\
            method: opt.method,\n\
            url: opt.url,\n\
            statusCode: res.statusCode | 0,\n\
            timeElapsed: Date.now() - opt.timeStart,\n\
            // extra\n\
            headers: opt.headers\n\
        }));\n\
        if (!err) {\n\
            return;\n\
        }\n\
        // cleanup clientReq and clientRes\n\
        local.streamCleanup(opt.clientReq);\n\
        local.streamCleanup(opt.clientResponse);\n\
        next(err);\n\
    };\n\
    // init opt\n\
    opt = local.urlParse(req.headers[\"forward-proxy-url\"]);\n\
    opt.method = req.method;\n\
    opt.url = req.headers[\"forward-proxy-url\"];\n\
    // init timerTimeout\n\
    timerTimeout = local.onTimeout(\n\
        onError,\n\
        local.timeoutDefault,\n\
        \"forward-proxy \" + opt.method + \" \" + opt.url\n\
    );\n\
    // parse headers\n\
    opt.headers = {};\n\
    local.tryCatchOnError(function () {\n\
        opt.headers = JSON.parse(req.headers[\"forward-proxy-headers\"]);\n\
    }, local.nop);\n\
    // debug opt\n\
    local._debugForwardProxy = opt;\n\
    opt.clientReq = (\n\
        opt.protocol === \"https:\"\n\
        ? local.https\n\
        : local.http\n\
    ).request(opt, function (clientResponse) {\n\
        opt.clientResponse = clientResponse.on(\"error\", onError);\n\
        res.statusCode = opt.clientResponse.statusCode;\n\
        // pipe clientResponse to serverResponse\n\
        opt.clientResponse.pipe(res);\n\
    }).on(\"error\", onError);\n\
    opt.timeStart = Date.now();\n\
    // init event-handling\n\
    req.on(\"error\", onError);\n\
    res.on(\"finish\", onError).on(\"error\", onError);\n\
    // pipe serverReq to clientReq\n\
    req.pipe(opt.clientReq);\n\
};\n\
\n\
local.middlewareInit = function (req, res, next) {\n\
/*\n\
 * this function will run middleware that will init <req> and <res>\n\
 */\n\
    // debug req and res\n\
    local._debugServerReqRes4 = local._debugServerReqRes3;\n\
    local._debugServerReqRes3 = local._debugServerReqRes2;\n\
    local._debugServerReqRes2 = local._debugServerReqRes1;\n\
    local._debugServerReqRes1 = {\n\
        req,\n\
        res\n\
    };\n\
    // init timerTimeout\n\
    local.serverRespondTimeoutDefault(req, res, local.timeoutDefault);\n\
    // init req.urlParsed\n\
    req.urlParsed = local.urlParse(req.url);\n\
    // init res-header content-type\n\
    local.serverRespondHeadSet(req, res, null, {\n\
        \"Content-Type\": local.contentTypeDict[(\n\
            /\\.[^.]*?$|$/m\n\
        ).exec(req.urlParsed.pathname)[0]]\n\
    });\n\
    // set main-page content-type to text/html\n\
    if (req.urlParsed.pathname === \"/\") {\n\
        local.serverRespondHeadSet(req, res, null, {\n\
            \"Content-Type\": \"text/html; charset=utf-8\"\n\
        });\n\
    }\n\
    // default to next\n\
    next();\n\
};\n\
\n\
local.middlewareJsonpStateInit = function (req, res, next) {\n\
/*\n\
 * this function will run middleware that will\n\
 * serve the browser-state wrapped in given jsonp-callback\n\
 */\n\
    var state;\n\
    if (!(req.stateInit || (\n\
        req.urlParsed\n\
        && req.urlParsed.pathname === \"/jsonp.utility2.stateInit\"\n\
    ))) {\n\
        next();\n\
        return;\n\
    }\n\
    state = {\n\
        utility2: {\n\
            assetsDict: {\n\
                \"/assets.example.html\":\n\
                local.assetsDict[\"/assets.example.html\"],\n\
                \"/assets.example.js\": local.assetsDict[\"/assets.example.js\"],\n\
                \"/assets.swgg.swagger.json\":\n\
                local.assetsDict[\"/assets.swgg.swagger.json\"],\n\
                \"/assets.test.js\": local.assetsDict[\"/assets.test.js\"],\n\
                \"/assets.utility2.base.html\":\n\
                local.assetsDict[\"/assets.utility2.base.rollup.html\"],\n\
                \"/index.rollup.html\": local.assetsDict[\"/index.rollup.html\"]\n\
            },\n\
            env: {\n\
                NODE_ENV: local.env.NODE_ENV,\n\
                npm_config_mode_backend: local.env.npm_config_mode_backend,\n\
                npm_package_assetsList: local.env.npm_package_assetsList,\n\
                npm_package_description: local.env.npm_package_description,\n\
                npm_package_homepage: local.env.npm_package_homepage,\n\
                npm_package_name: local.env.npm_package_name,\n\
                npm_package_nameLib: local.env.npm_package_nameLib,\n\
                npm_package_version: local.env.npm_package_version\n\
            }\n\
        }\n\
    };\n\
    (local.env.npm_package_assetsList || \"\").split(\" \").forEach(function (\n\
        file\n\
    ) {\n\
        local.assetsDict[\"/\" + file] = (\n\
            local.assetsDict[\"/\" + file]\n\
            || local.fsReadFileOrEmptyStringSync(file, \"utf8\")\n\
        );\n\
        state.utility2.assetsDict[\"/\" + file] = local.assetsDict[\"/\" + file];\n\
    });\n\
    if (req.stateInit) {\n\
        return state;\n\
    }\n\
    res.end(\n\
        req.urlParsed.query.callback + \"(\" + JSON.stringify(state) + \");\"\n\
    );\n\
};\n\
\n\
local.moduleDirname = function (module, modulePathList) {\n\
/*\n\
 * this function will search modulePathList for the module's __dirname\n\
 */\n\
    var result;\n\
    // search process.cwd()\n\
    if (!module || module === \".\" || module.indexOf(\"/\") >= 0) {\n\
        return require(\"path\").resolve(process.cwd(), module || \"\");\n\
    }\n\
    // search modulePathList\n\
    [\n\
        \"node_modules\"\n\
    ]\n\
    .concat(modulePathList)\n\
    .concat(require(\"module\").globalPaths)\n\
    .concat([\n\
        process.env.HOME + \"/node_modules\", \"/usr/local/lib/node_modules\"\n\
    ])\n\
    .some(function (modulePath) {\n\
        try {\n\
            result = require(\"path\").resolve(\n\
                process.cwd(),\n\
                modulePath + \"/\" + module\n\
            );\n\
            result = require(\"fs\").statSync(result).isDirectory() && result;\n\
            return result;\n\
        } catch (ignore) {\n\
            result = null;\n\
        }\n\
        return result;\n\
    });\n\
    return result || \"\";\n\
};\n\
\n\
local.normalizeChunk = function (chunk) {\n\
/*\n\
 * this function will normalize the chunk\n\
 */\n\
    return chunk || \"\";\n\
};\n\
\n\
local.normalizeJwt = function (data) {\n\
/*\n\
 * this function will normalize the jwt-data with registered-headers\n\
 * https://tools.ietf.org/html/rfc7519#section-4.1\n\
 */\n\
    var timeNow;\n\
    timeNow = Date.now() / 1000;\n\
    return local.objectSetDefault(data, {\n\
        exp: timeNow + 5 * 60,\n\
        iat: timeNow,\n\
        jti: Math.random().toString(16).slice(2),\n\
        nbf: timeNow\n\
    });\n\
};\n\
\n\
local.normalizeJwtBase64Url = function (b64) {\n\
/*\n\
 * this function will normlize <b64> to base64url format\n\
 */\n\
    return b64\n\
    .replace((\n\
        /\\=/g\n\
    ), \"\")\n\
    .replace((\n\
        /\\+/g\n\
    ), \"-\")\n\
    .replace((\n\
        /\\//g\n\
    ), \"_\");\n\
};\n\
\n\
local.numberToRomanNumerals = function (num) {\n\
/*\n\
 * this function will convert num to a roman-numeral\n\
 * https://stackoverflow.com/questions/9083037/convert-a-number-into-a-roman-numeral-in-javascript\n\
 */\n\
    var digits;\n\
    var ii;\n\
    var key;\n\
    var roman;\n\
    digits = String(num).split(\"\");\n\
    key = [\n\
        \"\", \"C\", \"CC\", \"CCC\", \"CD\", \"D\", \"DC\", \"DCC\", \"DCCC\", \"CM\",\n\
        \"\", \"X\", \"XX\", \"XXX\", \"XL\", \"L\", \"LX\", \"LXX\", \"LXXX\", \"XC\",\n\
        \"\", \"I\", \"II\", \"III\", \"IV\", \"V\", \"VI\", \"VII\", \"VIII\", \"IX\"\n\
    ];\n\
    roman = \"\";\n\
    ii = 3;\n\
    while (ii) {\n\
        ii -= 1;\n\
        roman = (key[Number(digits.pop()) + (ii * 10)] || \"\") + roman;\n\
    }\n\
    return new Array(Number(digits.join(\"\") + 1)).join(\"M\") + roman;\n\
};\n\
\n\
local.objectSetDefault = function (dict, defaults, depth) {\n\
/*\n\
 * this function will recursively set defaults for undefined-items in dict\n\
 */\n\
    dict = dict || {};\n\
    defaults = defaults || {};\n\
    Object.keys(defaults).forEach(function (key) {\n\
        var defaults2;\n\
        var dict2;\n\
        dict2 = dict[key];\n\
        // handle misbehaving getter\n\
        try {\n\
            defaults2 = defaults[key];\n\
        } catch (ignore) {}\n\
        if (defaults2 === undefined) {\n\
            return;\n\
        }\n\
        // init dict[key] to default value defaults[key]\n\
        switch (dict2) {\n\
        case \"\":\n\
        case null:\n\
        case undefined:\n\
            dict[key] = defaults2;\n\
            return;\n\
        }\n\
        // if dict2 and defaults2 are both non-null and non-array objects,\n\
        // then recurse with dict2 and defaults2\n\
        if (\n\
            depth > 1\n\
            // dict2 is a non-null and non-array object\n\
            && typeof dict2 === \"object\" && dict2 && !Array.isArray(dict2)\n\
            // defaults2 is a non-null and non-array object\n\
            && typeof defaults2 === \"object\" && defaults2\n\
            && !Array.isArray(defaults2)\n\
        ) {\n\
            // recurse\n\
            local.objectSetDefault(dict2, defaults2, depth - 1);\n\
        }\n\
    });\n\
    return dict;\n\
};\n\
\n\
local.objectSetOverride = function (dict, overrides, depth, env) {\n\
/*\n\
 * this function will recursively set overrides for items in dict\n\
 */\n\
    dict = dict || {};\n\
    env = env || (typeof process === \"object\" && process.env) || {};\n\
    overrides = overrides || {};\n\
    Object.keys(overrides).forEach(function (key) {\n\
        var dict2;\n\
        var overrides2;\n\
        dict2 = dict[key];\n\
        overrides2 = overrides[key];\n\
        if (overrides2 === undefined) {\n\
            return;\n\
        }\n\
        // if both dict2 and overrides2 are non-null and non-array objects,\n\
        // then recurse with dict2 and overrides2\n\
        if (\n\
            depth > 1\n\
            // dict2 is a non-null and non-array object\n\
            && typeof dict2 === \"object\" && dict2 && !Array.isArray(dict2)\n\
            // overrides2 is a non-null and non-array object\n\
            && typeof overrides2 === \"object\" && overrides2\n\
            && !Array.isArray(overrides2)\n\
        ) {\n\
            local.objectSetOverride(dict2, overrides2, depth - 1, env);\n\
            return;\n\
        }\n\
        // else set dict[key] with overrides[key]\n\
        dict[key] = (\n\
            dict === env\n\
            // if dict is env, then overrides falsy-value with empty-string\n\
            ? overrides2 || \"\"\n\
            : overrides2\n\
        );\n\
    });\n\
    return dict;\n\
};\n\
\n\
local.onErrorDefault = function (err) {\n\
/*\n\
 * this function will if <err> exists, then print it to stderr\n\
 */\n\
    if (err) {\n\
        console.error(err);\n\
    }\n\
    return err;\n\
};\n\
\n\
local.onErrorThrow = function (err) {\n\
/*\n\
 * this function will if <err> exists, then throw it\n\
 */\n\
    if (err) {\n\
        throw err;\n\
    }\n\
    return err;\n\
};\n\
\n\
local.onErrorWithStack = function (onError) {\n\
/*\n\
 * this function will create wrapper around <onError>\n\
 * that will append current-stack to err.stack\n\
 */\n\
    var onError2;\n\
    var stack;\n\
    stack = new Error().stack.replace((\n\
        /(.*?)\\n.*?$/m\n\
    ), \"$1\");\n\
    onError2 = function (err, data, meta) {\n\
        if (\n\
            err\n\
            && typeof err.stack === \"string\"\n\
            && err !== local.errDefault\n\
            && String(err.stack).indexOf(stack.split(\"\\n\")[2]) < 0\n\
        ) {\n\
            // append current-stack to err.stack\n\
            err.stack += \"\\n\" + stack;\n\
        }\n\
        onError(err, data, meta);\n\
    };\n\
    // debug onError\n\
    onError2.toString = function () {\n\
        return String(onError);\n\
    };\n\
    return onError2;\n\
};\n\
\n\
local.onFileModifiedRestart = function (file) {\n\
/*\n\
 * this function will watch the file, and if modified, then restart the process\n\
 */\n\
    if (\n\
        local.env.npm_config_mode_auto_restart\n\
        && local.fs.existsSync(file)\n\
        && local.fs.statSync(file).isFile()\n\
    ) {\n\
        local.fs.watchFile(file, {\n\
            interval: 1000,\n\
            persistent: false\n\
        }, function (stat2, stat1) {\n\
            if (stat2.mtime > stat1.mtime) {\n\
                console.error(\"file modified - \" + file);\n\
                setTimeout(function () {\n\
                    local.exit(77);\n\
                }, 1000);\n\
            }\n\
        });\n\
    }\n\
};\n\
\n\
local.onNext = function (opt, onError) {\n\
/*\n\
 * this function will wrap onError inside recursive-function <opt>.onNext,\n\
 * and append the current-stack to any err\n\
 */\n\
    opt.onNext = local.onErrorWithStack(function (err, data, meta) {\n\
        try {\n\
            opt.modeNext += (\n\
                (err && !opt.modeErrorIgnore)\n\
                ? 1000\n\
                : 1\n\
            );\n\
            if (opt.modeDebug) {\n\
                console.error(\"onNext - \" + JSON.stringify({\n\
                    modeNext: opt.modeNext,\n\
                    errorMessage: err && err.message\n\
                }));\n\
                if (err && err.stack) {\n\
                    console.error(err.stack);\n\
                }\n\
            }\n\
            onError(err, data, meta);\n\
        } catch (errCaught) {\n\
            // throw errCaught to break infinite recursion-loop\n\
            if (opt.errCaught) {\n\
                local.assertThrow(null, opt.errCaught);\n\
            }\n\
            opt.errCaught = errCaught;\n\
            opt.onNext(errCaught, data, meta);\n\
        }\n\
    });\n\
    return opt;\n\
};\n\
\n\
local.onParallel = function (onError, onEach, onRetry) {\n\
/*\n\
 * this function will create a function that will\n\
 * 1. run async tasks in parallel\n\
 * 2. if counter === 0 or err occurred, then call onError(err)\n\
 */\n\
    var onParallel;\n\
    onError = local.onErrorWithStack(onError);\n\
    onEach = onEach || local.nop;\n\
    onRetry = onRetry || local.nop;\n\
    onParallel = function (err, data) {\n\
        if (onRetry(err, data)) {\n\
            return;\n\
        }\n\
        // decrement counter\n\
        onParallel.counter -= 1;\n\
        // validate counter\n\
        if (!(onParallel.counter >= 0 || err || onParallel.err)) {\n\
            err = new Error(\n\
                \"invalid onParallel.counter = \" + onParallel.counter\n\
            );\n\
        // ensure onError is run only once\n\
        } else if (onParallel.counter < 0) {\n\
            return;\n\
        }\n\
        // handle err\n\
        if (err) {\n\
            onParallel.err = err;\n\
            // ensure counter <= 0\n\
            onParallel.counter = -Math.abs(onParallel.counter);\n\
        }\n\
        // call onError when isDone\n\
        if (onParallel.counter <= 0) {\n\
            onError(err, data);\n\
            return;\n\
        }\n\
        onEach();\n\
    };\n\
    // init counter\n\
    onParallel.counter = 0;\n\
    // return callback\n\
    return onParallel;\n\
};\n\
\n\
local.onParallelList = function (opt, onEach, onError) {\n\
/*\n\
 * this function will\n\
 * 1. async-run onEach in parallel,\n\
 *    with given <opt>.rateLimit and <opt>.retryLimit\n\
 * 2. call <onError> when onParallel.ii + 1 === <opt>.list.length\n\
 */\n\
    var isListEnd;\n\
    var onEach2;\n\
    var onParallel;\n\
    opt.list = opt.list || [];\n\
    onEach2 = function () {\n\
        while (true) {\n\
            if (!(onParallel.ii + 1 < opt.list.length)) {\n\
                isListEnd = true;\n\
                return;\n\
            }\n\
            if (!(onParallel.counter < opt.rateLimit + 1)) {\n\
                return;\n\
            }\n\
            onParallel.ii += 1;\n\
            onEach({\n\
                elem: opt.list[onParallel.ii],\n\
                ii: onParallel.ii,\n\
                list: opt.list,\n\
                retry: 0\n\
            }, onParallel);\n\
        }\n\
    };\n\
    onParallel = local.onParallel(onError, onEach2, function (err, data) {\n\
        if (err && data && data.retry < opt.retryLimit) {\n\
            local.onErrorDefault(err);\n\
            data.retry += 1;\n\
            setTimeout(function () {\n\
                onParallel.counter -= 1;\n\
                onEach(data, onParallel);\n\
            }, 1000);\n\
            return true;\n\
        }\n\
        // restart if opt.list has grown\n\
        if (isListEnd && (onParallel.ii + 1 < opt.list.length)) {\n\
            isListEnd = null;\n\
            onEach2();\n\
        }\n\
    });\n\
    onParallel.ii = -1;\n\
    opt.rateLimit = Number(opt.rateLimit) || 6;\n\
    opt.rateLimit = Math.max(opt.rateLimit, 1);\n\
    opt.retryLimit = Number(opt.retryLimit) || 2;\n\
    onParallel.counter += 1;\n\
    onEach2();\n\
    onParallel();\n\
};\n\
\n\
local.onTimeout = function (onError, timeout, message) {\n\
/*\n\
 * this function will create a timeout-err-handler,\n\
 * that appends current-stack to any err encountered\n\
 */\n\
    onError = local.onErrorWithStack(onError);\n\
    // create timerTimeout\n\
    return setTimeout(function () {\n\
        onError(new Error(\n\
            \"onTimeout - errTimeout - \" + timeout + \" ms - \" + message\n\
        ));\n\
    // coerce to finite integer\n\
    }, timeout);\n\
};\n\
\n\
local.profile = function (fnc, onError) {\n\
/*\n\
 * this function will profile async <fnc> in milliseconds\n\
 * with callback <onError>\n\
 */\n\
    var timeStart;\n\
    timeStart = Date.now();\n\
    // run async fnc\n\
    fnc(function (err) {\n\
        // call onError with difference in milliseconds\n\
        // between Date.now() and timeStart\n\
        onError(err, Date.now() - timeStart);\n\
    });\n\
};\n\
\n\
local.profileSync = function (fnc) {\n\
/*\n\
 * this function will profile sync <fnc> in milliseconds\n\
 */\n\
    var timeStart;\n\
    timeStart = Date.now();\n\
    // run sync fnc\n\
    fnc();\n\
    // return difference in milliseconds between Date.now() and timeStart\n\
    return Date.now() - timeStart;\n\
};\n\
\n\
local.replStart = function () {\n\
/*\n\
 * this function will start the repl-debugger\n\
 */\n\
    var that;\n\
    if (globalThis.utility2_repl1) {\n\
        return;\n\
    }\n\
    // start repl\n\
    that = require(\"repl\").start({\n\
        useGlobal: true\n\
    });\n\
    globalThis.utility2_repl1 = that;\n\
    that.onError = function (err) {\n\
    /*\n\
     * this function will debug repl-err\n\
     */\n\
        globalThis.utility2_debugReplError = err;\n\
        console.error(err);\n\
    };\n\
    // save eval-function\n\
    that.evalDefault = that.eval;\n\
    // hook custom-eval-function\n\
    that.eval = function (script, context, file, onError) {\n\
        var onError2;\n\
        onError2 = function (err, data) {\n\
            // debug err\n\
            globalThis.utility2_debugReplError = (\n\
                err || globalThis.utility2_debugReplError\n\
            );\n\
            onError(err, data);\n\
        };\n\
        script.replace((\n\
            /^(\\S+)\\u0020(.*?)\\n/\n\
        ), function (ignore, match1, match2) {\n\
            switch (match1) {\n\
            // syntax-sugar - run async shell-command\n\
            case \"$\":\n\
                switch (match2) {\n\
                // syntax-sugar - run git diff\n\
                case \"git diff\":\n\
                    match2 = \"git diff --color | cat\";\n\
                    break;\n\
                // syntax-sugar - run git log\n\
                case \"git log\":\n\
                    match2 = \"git log -n 4 | cat\";\n\
                    break;\n\
                // syntax-sugar - run git log\n\
                case \"ll\":\n\
                    match2 = \"ls -Fal\";\n\
                    break;\n\
                }\n\
                // source lib.utility2.sh\n\
                if (\n\
                    process.platform !== \"win32\"\n\
                    && process.env.npm_config_dir_utility2 && (match2 !== \":\")\n\
                ) {\n\
                    match2 = (\n\
                        \". \" + process.env.npm_config_dir_utility2\n\
                        + \"/lib.utility2.sh;\" + match2\n\
                    );\n\
                }\n\
                // run async shell-command\n\
                require(\"child_process\").spawn(match2, {\n\
                    shell: true,\n\
                    stdio: [\n\
                        \"ignore\", 1, 2\n\
                    ]\n\
                // on shell exit, print return prompt\n\
                }).on(\"exit\", function (exitCode) {\n\
                    console.error(\"exit-code \" + exitCode);\n\
                    that.evalDefault(\n\
                        \"\\n\",\n\
                        context,\n\
                        file,\n\
                        onError2\n\
                    );\n\
                });\n\
                script = \"\\n\";\n\
                break;\n\
            // syntax-sugar - map text with charCodeAt\n\
            case \"charCode\":\n\
                console.error(\n\
                    match2.split(\"\").map(function (chr) {\n\
                        return (\n\
                            \"\\\\u\"\n\
                            + chr.charCodeAt(0).toString(16).padStart(4, 0)\n\
                        );\n\
                    }).join(\"\")\n\
                );\n\
                script = \"\\n\";\n\
                break;\n\
            // syntax-sugar - sort chr\n\
            case \"charSort\":\n\
                console.error(JSON.stringify(match2.split(\"\").sort().join(\"\")));\n\
                script = \"\\n\";\n\
                break;\n\
            // syntax-sugar - grep current dir\n\
            case \"grep\":\n\
                // run async shell-command\n\
                require(\"child_process\").spawn((\n\
                    \"find . -type f | grep -v -E \"\n\
/* jslint ignore:start */\n\
+ '\"\\\n\
/\\\\.|(\\\\b|_)(\\\\.\\\\d|\\\n\
archive|artifact|\\\n\
bower_component|build|\\\n\
coverage|\\\n\
doc|\\\n\
external|\\\n\
fixture|\\\n\
git_module|\\\n\
jquery|\\\n\
log|\\\n\
min|misc|mock|\\\n\
node_module|\\\n\
raw|\\rollup|\\\n\
swp|\\\n\
tmp|\\\n\
vendor)s{0,1}(\\\\b|_)\\\n\
\" '\n\
/* jslint ignore:end */\n\
                    + \"| tr \\\"\\\\n\\\" \\\"\\\\000\\\" | xargs -0 grep -HIin -E \\\"\"\n\
                    + match2 + \"\\\"\"\n\
                ), {\n\
                    shell: true,\n\
                    stdio: [\n\
                        \"ignore\", 1, 2\n\
                    ]\n\
                })\n\
                // on shell exit, print return prompt\n\
                .on(\"exit\", function (exitCode) {\n\
                    console.error(\"exit-code \" + exitCode);\n\
                    that.evalDefault(\n\
                        \"\\n\",\n\
                        context,\n\
                        file,\n\
                        onError2\n\
                    );\n\
                });\n\
                script = \"\\n\";\n\
                break;\n\
            // syntax-sugar - list object's keys, sorted by item-type\n\
            // console.error(Object.keys(global).map(function(key){return(typeof global[key]==='object'&&global[key]&&global[key]===global[key]?'global':typeof global[key])+' '+key;}).sort().join('\\n')) // jslint ignore:line\n\
            case \"keys\":\n\
                script = (\n\
                    \"console.error(Object.keys(\" + match2\n\
                    + \").map(function(key){return(\"\n\
                    + \"typeof \" + match2 + \"[key]==='object'&&\"\n\
                    + match2 + \"[key]&&\"\n\
                    + match2 + \"[key]===global[key]\"\n\
                    + \"?'global'\"\n\
                    + \":typeof \" + match2 + \"[key]\"\n\
                    + \")+' '+key;\"\n\
                    + \"}).sort().join('\\\\n'))\\n\"\n\
                );\n\
                break;\n\
            // syntax-sugar - print stringified arg\n\
            case \"print\":\n\
                script = \"console.error(String(\" + match2 + \"))\\n\";\n\
                break;\n\
            // syntax-sugar - read file\n\
            case \"readFile\":\n\
                try {\n\
                    console.error(JSON.stringify(\n\
                        require(\"fs\").readFileSync(match2, \"utf8\")\n\
                    ));\n\
                } catch (errCaught) {\n\
                    console.error(errCaught);\n\
                }\n\
                script = \"\\n\";\n\
                break;\n\
            }\n\
        });\n\
        // eval the script\n\
        that.evalDefault(script, context, file, onError2);\n\
    };\n\
    that.socket = {\n\
        end: local.nop,\n\
        on: local.nop,\n\
        write: local.nop\n\
    };\n\
    // init process.stdout\n\
    process.stdout._writeDefault = (\n\
        process.stdout._writeDefault\n\
        || process.stdout._write\n\
    );\n\
    process.stdout._write = function (chunk, encoding, callback) {\n\
        process.stdout._writeDefault(chunk, encoding, callback);\n\
        // coverage-hack - ignore else-statement\n\
        local.nop(that.socket.writable && (function () {\n\
            that.socket.write(chunk, encoding);\n\
        }()));\n\
    };\n\
    // start serverRepl1\n\
    globalThis.utility2_serverRepl1 = require(\"net\").createServer(function (\n\
        socket\n\
    ) {\n\
        // init socket\n\
        that.socket = socket;\n\
        that.socket.on(\"data\", that.write.bind(that));\n\
        that.socket.on(\"error\", that.onError);\n\
        that.socket.setKeepAlive(true);\n\
    });\n\
    // coverage-hack - ignore else-statement\n\
    local.nop(process.env.PORT_REPL && (function () {\n\
        console.error(\n\
            \"repl-server listening on port \" + process.env.PORT_REPL\n\
        );\n\
        globalThis.utility2_serverRepl1.listen(process.env.PORT_REPL);\n\
    }()));\n\
};\n\
\n\
local.requireInSandbox = function (file) {\n\
/*\n\
 * this function will require the file in a sandbox-lite env\n\
 */\n\
    var exports;\n\
    var mockDict;\n\
    var mockList;\n\
    var tmp;\n\
    mockList = [\n\
        [\n\
            globalThis, {\n\
                setImmediate: local.nop,\n\
                setInterval: local.nop,\n\
                setTimeout: local.nop\n\
            }\n\
        ]\n\
    ];\n\
    [\n\
        [\n\
            local, \"child_process\"\n\
        ], [\n\
            local, \"cluster\"\n\
        ], [\n\
            local, \"http\"\n\
        ], [\n\
            local, \"https\"\n\
        ], [\n\
            local, \"net\"\n\
        ], [\n\
            local, \"repl\"\n\
        ], [\n\
            local.events, \"prototype\"\n\
        ], [\n\
            globalThis, \"process\"\n\
        ], [\n\
            local.stream, \"prototype\"\n\
        ], [\n\
            process, \"stdin\"\n\
        ]\n\
    ].forEach(function (elem) {\n\
        tmp = elem[0][elem[1]];\n\
        mockDict = {};\n\
        Object.keys(tmp).forEach(function (key) {\n\
            if (\n\
                typeof tmp[key] === \"function\"\n\
                && !(\n\
                    /^(?:fs\\.Read|fs\\.read|process\\.binding|process\\.dlopen)/\n\
                )\n\
                .test(elem[1] + \".\" + key)\n\
            ) {\n\
                mockDict[key] = function () {\n\
                    return;\n\
                };\n\
                // coverage-hack\n\
                mockDict[key]();\n\
            }\n\
        });\n\
        mockList.push([\n\
            tmp, mockDict\n\
        ]);\n\
    });\n\
    local.testMock(mockList, function (onError) {\n\
        local.tryCatchOnError(function () {\n\
            exports = require(file);\n\
        }, local.onErrorDefault);\n\
        onError();\n\
    }, local.onErrorThrow);\n\
    return exports;\n\
};\n\
\n\
local.requireReadme = function () {\n\
/*\n\
 * this function will require and export example.js embedded in README.md\n\
 */\n\
    var code;\n\
    var module;\n\
    var tmp;\n\
    // init module.exports\n\
    module = {};\n\
    if (local.isBrowser) {\n\
        module.exports = local.objectSetDefault(\n\
            globalThis.utility2_rollup || globalThis.local,\n\
            local\n\
        );\n\
        return module.exports;\n\
    }\n\
    // start repl-debugger\n\
    local.replStart();\n\
    // debug dir\n\
    [\n\
        __dirname + \"/lib.jslint.js\",\n\
        __filename,\n\
        \"undefined\"\n\
    ].forEach(function (file) {\n\
        local.fs.exists(file, function (exists) {\n\
            if (exists) {\n\
                local.onFileModifiedRestart(file);\n\
            }\n\
        });\n\
    });\n\
    local.fs.readdirSync(process.cwd()).forEach(function (file) {\n\
        file = process.cwd() + \"/\" + file;\n\
        // if the file is modified, then restart the process\n\
        local.onFileModifiedRestart(file);\n\
        switch (local.path.basename(file)) {\n\
        // swagger-validate assets.swgg.swagger.json\n\
        case \"assets.swgg.swagger.json\":\n\
            local.fs.readFile(file, \"utf8\", function (err, data) {\n\
                local.tryCatchOnError(function () {\n\
                    // validate no err occurred\n\
                    local.assertThrow(!err, err);\n\
                    local.swgg.swaggerValidate(JSON.parse(data));\n\
                }, local.onErrorDefault);\n\
            });\n\
            break;\n\
        }\n\
    });\n\
    // jslint process.cwd()\n\
    if (!local.env.npm_config_mode_library) {\n\
        local.child_process.spawn(\"node\", [\n\
            \"-e\", (\n\
                \"require(\"\n\
                + JSON.stringify(__filename)\n\
                + \").jslint.jslintAndPrintDir(\"\n\
                + JSON.stringify(process.cwd())\n\
                + \", {autofix:true,conditional:true}, process.exit);\"\n\
            )\n\
        ], {\n\
            env: local.objectAssignDefault({\n\
                npm_config_mode_library: \"1\"\n\
            }, local.env),\n\
            stdio: [\n\
                \"ignore\", \"ignore\", 2\n\
            ]\n\
        });\n\
    }\n\
    if (globalThis.utility2_rollup || local.env.npm_config_mode_start) {\n\
        // init assets\n\
        local.assetsDict[\"/index.html\"] = (\n\
            local.fsReadFileOrEmptyStringSync(\"index.html\")\n\
            || local.assetsDict[\"/index.rollup.html\"] || \"\"\n\
        );\n\
        local.assetsDict[\"/\"] = local.assetsDict[\"/index.html\"];\n\
        local.assetsDict[\"/assets.app.js\"] = local.fs.readFileSync(\n\
            __filename,\n\
            \"utf8\"\n\
        ).replace((\n\
            /^#!\\//\n\
        ), \"// \");\n\
        // init exports\n\
        local[local.env.npm_package_nameLib] = local;\n\
        module.exports = local;\n\
        return module.exports;\n\
    }\n\
    // init file $npm_package_main\n\
    globalThis.utility2_moduleExports = require(\n\
        process.cwd() + \"/\" + local.env.npm_package_main\n\
    );\n\
    globalThis.utility2_moduleExports.globalThis = globalThis;\n\
    // read code from README.md\n\
    code = local.templateRenderMyApp(\n\
        local.assetsDict[\"/assets.example.template.js\"],\n\
        {}\n\
    );\n\
    local.tryCatchOnError(function () {\n\
        tmp = (\n\
            /```\\w*?(\\n[\\W\\s]*?example\\.js[\\n\"][\\S\\s]*?)\\n```/\n\
        ).exec(\n\
            local.fs.readFileSync(\"README.md\", \"utf8\")\n\
        );\n\
        code = tmp.input.slice(0, tmp.index).replace((\n\
            /.+/g\n\
        ), \"\") + tmp[1];\n\
    }, local.nop);\n\
    code = code\n\
    // alias require($npm_package_name) to utility2_moduleExports;\n\
    .replace(\n\
        new RegExp(\"require\\\\(.\" + local.env.npm_package_name + \".\\\\)\"),\n\
        \"globalThis.utility2_moduleExports\"\n\
    )\n\
    .replace(\n\
        new RegExp(\"require\\\\(.\" + local.env.npm_package_nameOriginal + \".\\\\)\"),\n\
        \"globalThis.utility2_moduleExports\"\n\
    );\n\
    // init example.js\n\
    tmp = process.cwd() + \"/example.js\";\n\
    // jslint code\n\
    local.jslintAndPrint(code, tmp);\n\
    // cover code\n\
    code = local.istanbulInstrumentInPackage(code, tmp);\n\
    // init module.exports\n\
    module = new local.Module(tmp);\n\
    require.cache[tmp] = module;\n\
    // load code into module\n\
    module._compile(code, tmp);\n\
    // init exports\n\
    module.exports.utility2 = local;\n\
    module.exports[local.env.npm_package_nameLib] = (\n\
        globalThis.utility2_moduleExports\n\
    );\n\
    // init assets\n\
    tmp = process.cwd() + \"/\" + local.env.npm_package_main;\n\
    local.assetsDict[\"/assets.\" + local.env.npm_package_nameLib + \".js\"] = (\n\
        local.fs.readFileSync(tmp, \"utf8\").replace((\n\
            /^#!\\//\n\
        ), \"// \")\n\
    );\n\
    local.objectSetOverride(local.assetsDict, module.exports.assetsDict);\n\
    local.assetsDict[\"/assets.\" + local.env.npm_package_nameLib + \".js\"] = (\n\
        local.istanbulInstrumentInPackage(\n\
            local.assetsDict[\n\
                \"/assets.\" + local.env.npm_package_nameLib + \".js\"\n\
            ],\n\
            tmp\n\
        )\n\
    );\n\
    module.exports.assetsDict = local.assetsDict;\n\
    local.assetsDict[\"/assets.example.js\"] = code;\n\
    local.assetsDict[\"/assets.test.js\"] = local.istanbulInstrumentInPackage(\n\
        local.fs.readFileSync(\"test.js\", \"utf8\"),\n\
        process.cwd() + \"/test.js\"\n\
    );\n\
    // init assets index.html\n\
    [\n\
        \"\", \".rollup\"\n\
    ].forEach(function (isRollup) {\n\
        [\n\
            \"index\", \"utility2\"\n\
        ].forEach(function (file) {\n\
            tmp = \"assets.\" + file + \".template.html\";\n\
            local.assetsDict[\"/\" + tmp] = (\n\
                local.fsReadFileOrEmptyStringSync(tmp, \"utf8\")\n\
                || local.assetsDict[\"/\" + tmp]\n\
            );\n\
            file = (\n\
                file.replace(\"utility2\", \"assets.utility2.base\") + isRollup\n\
                + \".html\"\n\
            );\n\
            local.assetsDict[\"/\" + file] = local.fsReadFileOrEmptyStringSync(\n\
                file,\n\
                \"utf8\"\n\
            ) || local.templateRender(\n\
                // uncomment utility2-comment\n\
                local.assetsDict[\"/\" + tmp].replace((\n\
                    /<!--\\u0020utility2-comment\\b([\\S\\s]*?)\\butility2-comment\\u0020-->/g\n\
                ), \"$1\"),\n\
                {\n\
                    env: local.env,\n\
                    isRollup\n\
                }\n\
            );\n\
        });\n\
    });\n\
    local.assetsDict[\"/\"] = local.assetsDict[\"/index.html\"];\n\
    // init assets.app.js\n\
    local.assetsDict[\"/assets.app.js\"] = [\n\
        \"header\",\n\
        \"/assets.utility2.rollup.js\",\n\
        \"/assets.utility2.rollup.begin.js\",\n\
        \"local.stateInit\",\n\
        \"/assets.my_app.js\",\n\
        \"/assets.example.js\",\n\
        \"/assets.test.js\",\n\
        \"/assets.utility2.rollup.end.js\"\n\
    ].map(function (key) {\n\
        switch (key) {\n\
/* jslint ignore:start */\n\
case 'header':\n\
return '\\\n\
/* this rollup was created with utility2\\n\\\n\
 * https://github.com/kaizhu256/node-utility2\\n\\\n\
 */\\n\\\n\
\\n\\\n\
\\n\\\n\
\\n\\\n\
/*\\n\\\n\
assets.app.js\\n\\\n\
\\n\\\n\
' + local.env.npm_package_description + '\\n\\\n\
\\n\\\n\
instruction\\n\\\n\
    1. save this script as assets.app.js\\n\\\n\
    2. run the shell-command:\\n\\\n\
        $ PORT=8081 node assets.app.js\\n\\\n\
    3. open a browser to http://127.0.0.1:8081 and play with the web-demo\\n\\\n\
    4. edit this script to suit your needs\\n\\\n\
*/\\n\\\n\
' + local.assetsDict[\"/assets.utility2.rollup.begin.js\"]\n\
    .replace((/utility2_rollup/g), 'utility2_app');\n\
/* jslint ignore:end */\n\
        case \"/assets.my_app.js\":\n\
            // handle large string-replace\n\
            tmp = \"/assets.\" + local.env.npm_package_nameLib + \".js\";\n\
            code = local.assetsDict[\"/assets.utility2.rollup.content.js\"]\n\
            .split(\"/* utility2.rollup.js content */\");\n\
            code.splice(\n\
                1,\n\
                0,\n\
                \"local.assetsDict[\\\"\" + tmp + \"\\\"] = \"\n\
                + JSON.stringify(local.assetsDict[tmp]).replace((\n\
                    /\\\\\\\\/g\n\
                ), \"\\u0000\").replace((\n\
                    /\\\\n/g\n\
                ), \"\\\\n\\\\\\n\").replace((\n\
                    /\\u0000/g\n\
                ), \"\\\\\\\\\")\n\
            );\n\
            code = code.join(\"\");\n\
            code += \"\\n\";\n\
            code += local.assetsDict[tmp];\n\
            break;\n\
        case \"local.stateInit\":\n\
            // handle large string-replace\n\
            code = local.assetsDict[\"/assets.utility2.rollup.content.js\"]\n\
            .split(\"/* utility2.rollup.js content */\");\n\
            tmp = local.middlewareJsonpStateInit({\n\
                stateInit: true\n\
            });\n\
            // add extra physical files to assetsDict\n\
            local.fs.readdirSync(\".\").forEach(function (file) {\n\
                file = \"/\" + file;\n\
                if (\n\
                    local.assetsDict[file]\n\
                    && local.assetsDict[file].length <= 0x100000\n\
                    && String(local.assetsDict[file])\n\
                    === local.fsReadFileOrEmptyStringSync(\".\" + file, \"utf8\")\n\
                ) {\n\
                    tmp.utility2.assetsDict[file] = local.assetsDict[file];\n\
                }\n\
            });\n\
            code.splice(1, 0, key + \"(\" + JSON.stringify(tmp, null, 4) + \");\");\n\
            code = code.join(\"\");\n\
            break;\n\
        default:\n\
            code = local.assetsDict[key];\n\
        }\n\
        return (\n\
            \"/* script-begin \" + key + \" */\\n\"\n\
            + code.trim()\n\
            + \"\\n/* script-end \" + key + \" */\\n\"\n\
        );\n\
    }).join(\"\\n\\n\\n\");\n\
    local.objectSetDefault(module.exports, local);\n\
    // init testCase_buildXxx\n\
    Object.keys(local).forEach(function (key) {\n\
        if (\n\
            key.indexOf(\"_testCase_build\") === 0\n\
            || key === \"_testCase_webpage_default\"\n\
        ) {\n\
            module.exports[key.slice(1)] = (\n\
                module.exports[key.slice(1)] || local[key]\n\
            );\n\
        }\n\
    });\n\
    return module.exports;\n\
};\n\
\n\
local.semverCompare = function (aa, bb) {\n\
/*\n\
 * this function will compare semver versions aa ? bb and return\n\
 * -1 if aa < bb\n\
 *  0 if aa = bb\n\
 *  1 if aa > bb\n\
 * https://semver.org/#spec-item-11\n\
 */\n\
    return [\n\
        aa, bb\n\
    ].map(function (aa) {\n\
        aa = aa.split(\"-\");\n\
        return [\n\
            aa[0], aa.slice(1).join(\"-\") || \"\\u00ff\"\n\
        ].map(function (aa) {\n\
            return aa.split(\".\").map(function (aa) {\n\
                return (\"0000000000000000\" + aa).slice(-16);\n\
            }).join(\".\");\n\
        }).join(\"-\");\n\
    }).reduce(function (aa, bb) {\n\
        return (\n\
            aa === bb\n\
            ? 0\n\
            : aa < bb\n\
            ? -1\n\
            : 1\n\
        );\n\
    });\n\
};\n\
\n\
local.serverRespondCors = function (req, res) {\n\
/*\n\
 * this function will enable cors for the req\n\
 * http://en.wikipedia.org/wiki/Cross-origin_resource_sharing\n\
 */\n\
    local.serverRespondHeadSet(req, res, null, local.jsonCopy({\n\
        \"access-control-allow-headers\":\n\
        req.headers[\"access-control-request-headers\"],\n\
        \"access-control-allow-methods\":\n\
        req.headers[\"access-control-request-method\"],\n\
        \"access-control-allow-origin\": \"*\"\n\
    }));\n\
};\n\
\n\
local.serverRespondDefault = function (req, res, statusCode, err) {\n\
/*\n\
 * this function will respond with a default message,\n\
 * or <err>.stack for given statusCode\n\
 */\n\
    // init statusCode and contentType\n\
    local.serverRespondHeadSet(\n\
        req,\n\
        res,\n\
        statusCode,\n\
        {\n\
            \"Content-Type\": \"text/plain; charset=utf-8\"\n\
        }\n\
    );\n\
    if (err) {\n\
        // debug statusCode / method / url\n\
        local.errorMessagePrepend(\n\
            err,\n\
            res.statusCode + \" \" + req.method + \" \" + req.url\n\
            + \"\\n\"\n\
        );\n\
        // print err.stack to stderr\n\
        local.onErrorDefault(err);\n\
        // end res with err.stack\n\
        res.end(err.stack);\n\
        return;\n\
    }\n\
    // end res with default statusCode message\n\
    res.end(\n\
        statusCode + \" \" + local.http.STATUS_CODES[statusCode]\n\
    );\n\
};\n\
\n\
local.serverRespondEcho = function (req, res) {\n\
/*\n\
 * this function will respond with debug info\n\
 */\n\
    res.write(\n\
        req.method + \" \" + req.url\n\
        + \" HTTP/\" + req.httpVersion + \"\\r\\n\"\n\
        + Object.keys(req.headers).map(function (key) {\n\
            return key + \": \" + req.headers[key] + \"\\r\\n\";\n\
        }).join(\"\") + \"\\r\\n\"\n\
    );\n\
    req.pipe(res);\n\
};\n\
\n\
local.serverRespondHeadSet = function (ignore, res, statusCode, headers) {\n\
/*\n\
 * this function will set the <res> object's <statusCode> and <headers>\n\
 */\n\
    if (res.headersSent) {\n\
        return;\n\
    }\n\
    // init res.statusCode\n\
    if (Number(statusCode)) {\n\
        res.statusCode = Number(statusCode);\n\
    }\n\
    Object.keys(headers).forEach(function (key) {\n\
        if (headers[key]) {\n\
            res.setHeader(key, headers[key]);\n\
        }\n\
    });\n\
    return true;\n\
};\n\
\n\
local.serverRespondTimeoutDefault = function (req, res, timeout) {\n\
/*\n\
 * this function will create a timeout-err-handler for server-<req>\n\
 */\n\
    var isDone;\n\
    var onError;\n\
    onError = function () {\n\
        if (isDone) {\n\
            return;\n\
        }\n\
        isDone = true;\n\
        // debug serverResponse\n\
        console.error(\"serverLog - \" + JSON.stringify({\n\
            time: new Date(req.timeStart).toISOString(),\n\
            type: \"serverResponse\",\n\
            method: req.method,\n\
            url: req.url,\n\
            statusCode: res.statusCode | 0,\n\
            timeElapsed: Date.now() - req.timeStart,\n\
            // extra\n\
            requestContentLength: req.dataLength || 0,\n\
            resContentLength: res.contentLength,\n\
            requestHeaderXForwardedFor:\n\
            req.headers[\"x-forwarded-for\"] || \"\",\n\
            requestHeaderOrigin: req.headers.origin || \"\",\n\
            requestHeaderReferer: req.headers.referer || \"\",\n\
            requestHeaderUserAgent: req.headers[\"user-agent\"]\n\
        }));\n\
        // cleanup timerTimeout\n\
        clearTimeout(req.timerTimeout);\n\
    };\n\
    req.timeStart = Date.now();\n\
    req.onTimeout = req.onTimeout || function (err) {\n\
        local.serverRespondDefault(req, res, 500, err);\n\
        setTimeout(function () {\n\
            // cleanup <req> and <res>\n\
            local.streamCleanup(req);\n\
            local.streamCleanup(res);\n\
        }, 1000);\n\
    };\n\
    // init timerTimeout\n\
    req.timerTimeout = local.onTimeout(\n\
        req.onTimeout,\n\
        timeout || local.timeoutDefault,\n\
        \"server \" + req.method + \" \" + req.url\n\
    );\n\
    res.contentLength = 0;\n\
    res.writeContentLength = res.writeContentLength || res.write;\n\
    res.write = function (chunk, encoding, callback) {\n\
        chunk = local.normalizeChunk(chunk);\n\
        res.contentLength += chunk.length;\n\
        res.writeContentLength(chunk, encoding, callback);\n\
    };\n\
    res.on(\"error\", onError);\n\
    res.on(\"finish\", onError);\n\
};\n\
\n\
local.setTimeoutOnError = function (onError, timeout, err, data) {\n\
/*\n\
 * this function will after timeout has passed,\n\
 * then call <onError>(<err>, <data>)\n\
 */\n\
    if (typeof onError === \"function\") {\n\
        setTimeout(function () {\n\
            onError(err, data);\n\
        }, timeout);\n\
    }\n\
    return data;\n\
};\n\
\n\
local.sjclHashScryptCreate = function (password, opt) {\n\
/*\n\
 * this function will create a scrypt-hash of the password\n\
 * with given <opt> (default = $s0$10801)\n\
 * e.g.\n\
 * $s0$e0801$epIxT/h6HbbwHaehFnh/bw==$7H0vs\n\
 * XlY8UxxyW/BWx/9GuY7jEvGjT71GFd6O4SZND0=\n\
 * https://github.com/wg/scrypt\n\
 */\n\
    // init opt\n\
    opt = (opt || \"$s0$10801\").split(\"$\");\n\
    // init salt\n\
    if (!opt[3]) {\n\
        opt[3] = local.sjcl.codec.base64.fromBits(\n\
            local.sjcl.random.randomWords(4, 0)\n\
        );\n\
    }\n\
    // init hash\n\
    opt[4] = local.sjcl.codec.base64.fromBits(\n\
        local.sjcl.misc.scrypt(\n\
            password || \"\",\n\
            local.sjcl.codec.base64.toBits(opt[3]),\n\
            Math.pow(2, parseInt(opt[2].slice(0, 1), 16)),\n\
            parseInt(opt[2].slice(1, 2), 16),\n\
            parseInt(opt[2].slice(3, 4), 16)\n\
        )\n\
    );\n\
    return opt.slice(0, 5).join(\"$\");\n\
};\n\
\n\
local.sjclHashScryptValidate = function (password, hash) {\n\
/*\n\
 * this function will validate the password against the scrypt-hash\n\
 * https://github.com/wg/scrypt\n\
 */\n\
    return local.sjclHashScryptCreate(password, hash) === hash;\n\
};\n\
\n\
local.sjclHashSha1Create = function (data) {\n\
/*\n\
 * this function will create a base64-encoded sha1 hash of the string data\n\
 */\n\
    return local.sjcl.codec.base64.fromBits(local.sjcl.hash.sha1.hash(data));\n\
};\n\
\n\
local.sjclHashSha256Create = function (data) {\n\
/*\n\
 * this function will create a base64-encoded sha256 hash of the string data\n\
 */\n\
    return local.sjcl.codec.base64.fromBits(local.sjcl.hash.sha256.hash(data));\n\
};\n\
\n\
local.sjclHmacSha1Create = function (key, data) {\n\
/*\n\
 * this function will create a base64-encoded sha1 hmac\n\
 * from the string key and string data\n\
 */\n\
    var Hmac;\n\
    Hmac = local.sjcl.misc.hmac;\n\
    return local.sjcl.codec.base64.fromBits(\n\
        (new Hmac(\n\
            local.sjcl.codec.utf8String.toBits(key),\n\
            local.sjcl.hash.sha1\n\
        )).mac(local.sjcl.codec.utf8String.toBits(data))\n\
    );\n\
};\n\
\n\
local.sjclHmacSha256Create = function (key, data) {\n\
/*\n\
 * this function will create a base64-encoded sha256 hmac\n\
 * from the string key and string data\n\
 */\n\
    var Hmac;\n\
    Hmac = local.sjcl.misc.hmac;\n\
    return local.sjcl.codec.base64.fromBits(\n\
        (new Hmac(\n\
            local.sjcl.codec.utf8String.toBits(key),\n\
            local.sjcl.hash.sha256\n\
        )).mac(local.sjcl.codec.utf8String.toBits(data))\n\
    );\n\
};\n\
\n\
local.stateInit = function (opt) {\n\
/*\n\
 * this function will init state <opt>\n\
 */\n\
    local.objectSetOverride(local, opt, 10);\n\
    // init swgg\n\
    local.swgg.apiUpdate(local.swgg.swaggerJson);\n\
};\n\
\n\
local.streamCleanup = function (stream) {\n\
/*\n\
 * this function will try to end or destroy the stream\n\
 */\n\
    var err;\n\
    // try to end the stream\n\
    try {\n\
        stream.end();\n\
    } catch (errCaught) {\n\
        err = errCaught;\n\
    }\n\
    // if err, then try to destroy the stream\n\
    if (err) {\n\
        try {\n\
            stream.destroy();\n\
        } catch (ignore) {}\n\
    }\n\
};\n\
\n\
local.streamReadAll = function (stream, onError) {\n\
/*\n\
 * this function will concat data from <stream>\n\
 * and pass to <onError> when finished reading\n\
 */\n\
    var chunkList;\n\
    chunkList = [];\n\
    stream.dataLength = 0;\n\
    // on event-data, push buffer-chunk to chunkList\n\
    stream.on(\"data\", function (chunk) {\n\
        chunk = local.normalizeChunk(chunk);\n\
        chunkList.push(chunk);\n\
        stream.dataLength += chunk.length;\n\
    // on event-end, pass concatenated-buffer to onError\n\
    }).on(\"end\", function () {\n\
        onError(\n\
            null,\n\
            local.isBrowser\n\
            ? chunkList[0]\n\
            : local.bufferConcat(chunkList)\n\
        );\n\
    // on event-error, pass error to onError\n\
    }).on(\"error\", onError);\n\
};\n\
\n\
local.stringHtmlSafe = function (text) {\n\
/*\n\
 * this function will make the text html-safe\n\
 * https://stackoverflow.com/questions/7381974/which-characters-need-to-be-escaped-on-html\n\
 */\n\
    return text\n\
    .replace((\n\
        /&/g\n\
    ), \"&amp;\")\n\
    .replace((\n\
        /\"/g\n\
    ), \"&quot;\")\n\
    .replace((\n\
        /'/g\n\
    ), \"&apos;\")\n\
    .replace((\n\
        /</g\n\
    ), \"&lt;\")\n\
    .replace((\n\
        />/g\n\
    ), \"&gt;\")\n\
    .replace((\n\
        /&amp;(amp;|apos;|gt;|lt;|quot;)/ig\n\
    ), \"&$1\");\n\
};\n\
\n\
local.stringMerge = function (str1, str2, rgx) {\n\
/*\n\
 * this function will merge <str2> into <str1>,\n\
 * for sections where both match <rgx>\n\
 */\n\
    str2.replace(rgx, function (match2) {\n\
        str1.replace(rgx, function (match1) {\n\
            str1 = str1.replace(match1, function () {\n\
                return match2;\n\
            });\n\
        });\n\
    });\n\
    return str1;\n\
};\n\
\n\
local.stringQuotedToAscii = function (str) {\n\
/*\n\
 * this function will replace non-ascii-chr to unicode-escaped-ascii-chr\n\
 * in quoted-<str>\n\
 */\n\
    return str\n\
    .replace((\n\
        /\\r/g\n\
    ), \"\\\\r\")\n\
    .replace((\n\
        /\\t/g\n\
    ), \"\\\\t\")\n\
    .replace((\n\
        /[^\\n\\u0020-\\u007e]/g\n\
    ), function (chr) {\n\
        return \"\\\\u\" + (\"0000\" + chr.charCodeAt(0).toString(16)).slice(-4);\n\
    });\n\
};\n\
\n\
local.stringRegexpEscape = function (text) {\n\
/*\n\
 * this function will regexp-escape text\n\
 * https://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript\n\
 */\n\
    return text.replace((\n\
        /[\\-\\/\\\\\\^$*+?.()|\\[\\]{}]/g\n\
    ), \"\\\\$&\");\n\
};\n\
\n\
local.stringTruncate = function (text, maxLength) {\n\
/*\n\
 * this function will truncate text to given maxLength\n\
 */\n\
    return (\n\
        text.length > maxLength\n\
        ? text.slice(0, maxLength - 3).trimRight() + \"...\"\n\
        : text\n\
    );\n\
};\n\
\n\
local.stringUniqueKey = function (text) {\n\
/*\n\
 * this function will return a string-key that is unique in given text\n\
 */\n\
    var key;\n\
    // seed the key with the least frequent letters in the english-language\n\
    // https://en.wikipedia.org/wiki/Letter_frequency\n\
    key = \"zqxj\";\n\
    do {\n\
        key += ((1 + Math.random()) * 0x10000000000000).toString(36).slice(1);\n\
    } while (text.indexOf(key) >= 0);\n\
    return key;\n\
};\n\
\n\
local.taskCreate = function (opt, onTask, onError) {\n\
/*\n\
 * this function will create the task onTask named <opt>.key,\n\
 * if it does not exist, and push onError to its onErrorList\n\
 */\n\
    var task;\n\
    // init task\n\
    local.taskOnTaskDict[opt.key] = (\n\
        local.taskOnTaskDict[opt.key]\n\
        || {\n\
            onErrorList: []\n\
        }\n\
    );\n\
    task = local.taskOnTaskDict[opt.key];\n\
    // push callback onError to the task\n\
    if (onError) {\n\
        onError = local.onErrorWithStack(onError);\n\
        task.onErrorList.push(onError);\n\
    }\n\
    // if task exists, then return it\n\
    if (!onTask || task.onTask) {\n\
        return task;\n\
    }\n\
    task.onDone = function (err, data, meta) {\n\
        // if isDone, then do nothing\n\
        if (task.isDone) {\n\
            return;\n\
        }\n\
        task.isDone = true;\n\
        // cleanup timerTimeout\n\
        clearTimeout(task.timerTimeout);\n\
        // cleanup task\n\
        delete local.taskOnTaskDict[opt.key];\n\
        // preserve err.message and err.stack\n\
        task.result = JSON.stringify([\n\
            (\n\
                (err && err.stack)\n\
                ? Object.assign(local.jsonCopy(err), {\n\
                    message: err.message,\n\
                    name: err.name,\n\
                    stack: err.stack\n\
                })\n\
                : err\n\
            ), data, meta\n\
        ]);\n\
        // pass result to callbacks in onErrorList\n\
        task.onErrorList.forEach(function (onError) {\n\
            onError.apply(null, JSON.parse(task.result));\n\
        });\n\
    };\n\
    // init timerTimeout\n\
    task.timerTimeout = local.onTimeout(\n\
        task.onDone,\n\
        opt.timeout || local.timeoutDefault,\n\
        \"taskCreate \" + opt.key\n\
    );\n\
    task.onTask = onTask;\n\
    // run onTask\n\
    task.onTask(task.onDone);\n\
    return task;\n\
};\n\
\n\
local.taskCreateCached = function (opt, onTask, onError) {\n\
/*\n\
 * this function will\n\
 * 1. if cache-hit, then call onError with cacheValue\n\
 * 2. run onTask in background to update cache\n\
 * 3. save onTask's result to cache\n\
 * 4. if cache-miss, then call onError with onTask's result\n\
 */\n\
    local.onNext(opt, function (err, data) {\n\
        switch (opt.modeNext) {\n\
        // 1. if cache-hit, then call onError with cacheValue\n\
        case 1:\n\
            // read cacheValue from memory-cache\n\
            local.cacheDict[opt.cacheDict] = (\n\
                local.cacheDict[opt.cacheDict]\n\
                || {}\n\
            );\n\
            opt.cacheValue = local.cacheDict[opt.cacheDict][opt.key];\n\
            if (opt.cacheValue) {\n\
                // call onError with cacheValue\n\
                opt.modeCacheHit = true;\n\
                onError(null, JSON.parse(opt.cacheValue));\n\
                if (!opt.modeCacheUpdate) {\n\
                    break;\n\
                }\n\
            }\n\
            // run background-task with lower priority for cache-hit\n\
            setTimeout(opt.onNext, opt.modeCacheHit && opt.cacheTtl);\n\
            break;\n\
        // 2. run onTask in background to update cache\n\
        case 2:\n\
            local.taskCreate(opt, onTask, opt.onNext);\n\
            break;\n\
        default:\n\
            // 3. save onTask's result to cache\n\
            // JSON.stringify data to prevent side-effects on cache\n\
            opt.cacheValue = JSON.stringify(data);\n\
            if (!err && opt.cacheValue) {\n\
                local.cacheDict[opt.cacheDict][opt.key] = opt.cacheValue;\n\
            }\n\
            // 4. if cache-miss, then call onError with onTask's result\n\
            if (!opt.modeCacheHit) {\n\
                onError(err, opt.cacheValue && JSON.parse(opt.cacheValue));\n\
            }\n\
            local.functionOrNop(opt.onCacheWrite)();\n\
        }\n\
    });\n\
    opt.modeNext = 0;\n\
    opt.onNext();\n\
};\n\
\n\
local.templateRender = function (template, dict, opt) {\n\
/*\n\
 * this function will render the template with given dict\n\
 */\n\
    var argList;\n\
    var getValue;\n\
    var match;\n\
    var renderPartial;\n\
    var rgx;\n\
    var skip;\n\
    var value;\n\
    dict = dict || {};\n\
    opt = opt || {};\n\
    getValue = function (key) {\n\
        argList = key.split(\" \");\n\
        value = dict;\n\
        if (argList[0] === \"#this/\") {\n\
            return;\n\
        }\n\
        // iteratively lookup nested values in the dict\n\
        argList[0].split(\".\").forEach(function (key) {\n\
            value = value && value[key];\n\
        });\n\
        return value;\n\
    };\n\
    renderPartial = function (match0, helper, key, partial) {\n\
        switch (helper) {\n\
        case \"each\":\n\
        case \"eachTrimRightComma\":\n\
            value = getValue(key);\n\
            value = (\n\
                Array.isArray(value)\n\
                ? value.map(function (dict) {\n\
                    // recurse with partial\n\
                    return local.templateRender(partial, dict, opt);\n\
                }).join(\"\")\n\
                : \"\"\n\
            );\n\
            // remove trailing-comma from last elem\n\
            if (helper === \"eachTrimRightComma\") {\n\
                value = value.trimRight().replace((\n\
                    /,$/\n\
                ), \"\");\n\
            }\n\
            return value;\n\
        case \"if\":\n\
            partial = partial.split(\"{{#unless \" + key + \"}}\");\n\
            partial = (\n\
                getValue(key)\n\
                ? partial[0]\n\
                // handle 'unless' case\n\
                : partial.slice(1).join(\"{{#unless \" + key + \"}}\")\n\
            );\n\
            // recurse with partial\n\
            return local.templateRender(partial, dict, opt);\n\
        case \"unless\":\n\
            return (\n\
                getValue(key)\n\
                ? \"\"\n\
                // recurse with partial\n\
                : local.templateRender(partial, dict, opt)\n\
            );\n\
        default:\n\
            // recurse with partial\n\
            return match0[0] + local.templateRender(match0.slice(1), dict, opt);\n\
        }\n\
    };\n\
    // render partials\n\
    rgx = (\n\
        /\\{\\{#(\\w+)\\u0020([^}]+?)\\}\\}/g\n\
    );\n\
    template = template || \"\";\n\
    match = rgx.exec(template);\n\
    while (match) {\n\
        rgx.lastIndex += 1 - match[0].length;\n\
        template = template.replace(\n\
            new RegExp(\n\
                \"\\\\{\\\\{#(\" + match[1] + \") (\" + match[2]\n\
                + \")\\\\}\\\\}([\\\\S\\\\s]*?)\\\\{\\\\{/\" + match[1] + \" \" + match[2]\n\
                + \"\\\\}\\\\}\"\n\
            ),\n\
            renderPartial\n\
        );\n\
        match = rgx.exec(template);\n\
    }\n\
    // search for keys in the template\n\
    return template.replace((\n\
        /\\{\\{[^}]+?\\}\\}/g\n\
    ), function (match0) {\n\
        var markdownToHtml;\n\
        var notHtmlSafe;\n\
        notHtmlSafe = opt.notHtmlSafe;\n\
        try {\n\
            getValue(match0.slice(2, -2));\n\
            if (value === undefined) {\n\
                return match0;\n\
            }\n\
            argList.slice(1).forEach(function (arg0, ii, list) {\n\
                switch (arg0) {\n\
                case \"alphanumeric\":\n\
                    value = value.replace((\n\
                        /\\W/g\n\
                    ), \"_\");\n\
                    break;\n\
                case \"decodeURIComponent\":\n\
                    value = decodeURIComponent(value);\n\
                    break;\n\
                case \"encodeURIComponent\":\n\
                    value = encodeURIComponent(value);\n\
                    break;\n\
                case \"jsonStringify\":\n\
                    value = JSON.stringify(value);\n\
                    break;\n\
                case \"jsonStringify4\":\n\
                    value = JSON.stringify(value, null, 4);\n\
                    break;\n\
                case \"markdownSafe\":\n\
                    value = value.replace((\n\
                        /`/g\n\
                    ), \"'\");\n\
                    break;\n\
                case \"markdownToHtml\":\n\
                    markdownToHtml = true;\n\
                    break;\n\
                case \"notHtmlSafe\":\n\
                    notHtmlSafe = true;\n\
                    break;\n\
                case \"padEnd\":\n\
                case \"padStart\":\n\
                case \"slice\":\n\
                    skip = ii + 2;\n\
                    value = String(value)[arg0](\n\
                        list[skip - 1],\n\
                        list[skip]\n\
                    );\n\
                    break;\n\
                case \"truncate\":\n\
                    skip = ii + 1;\n\
                    if (value.length > list[skip]) {\n\
                        value = value.slice(\n\
                            0,\n\
                            Math.max(list[skip] - 3, 0)\n\
                        ).trimRight() + \"...\";\n\
                    }\n\
                    break;\n\
                // default to String.prototype[arg0]()\n\
                default:\n\
                    if (ii <= skip) {\n\
                        break;\n\
                    }\n\
                    value = value[arg0]();\n\
                }\n\
            });\n\
            value = String(value);\n\
            // default to htmlSafe\n\
            if (!notHtmlSafe) {\n\
                value = value\n\
                .replace((\n\
                    /&/g\n\
                ), \"&amp;\")\n\
                .replace((\n\
                    /\"/g\n\
                ), \"&quot;\")\n\
                .replace((\n\
                    /'/g\n\
                ), \"&apos;\")\n\
                .replace((\n\
                    /</g\n\
                ), \"&lt;\")\n\
                .replace((\n\
                    />/g\n\
                ), \"&gt;\")\n\
                .replace((\n\
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig\n\
                ), \"&$1\");\n\
            }\n\
            markdownToHtml = (\n\
                markdownToHtml\n\
                && (typeof local.marked === \"function\" && local.marked)\n\
            );\n\
            if (markdownToHtml) {\n\
                value = markdownToHtml(value)\n\
                .replace((\n\
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig\n\
                ), \"&$1\");\n\
            }\n\
            return value;\n\
        } catch (errCaught) {\n\
            errCaught.message = (\n\
                \"templateRender could not render expression \"\n\
                + JSON.stringify(match0)\n\
                + \"\\n\"\n\
            ) + errCaught.message;\n\
            local.assertThrow(null, errCaught);\n\
        }\n\
    });\n\
};\n\
\n\
local.templateRenderMyApp = function (template, opt) {\n\
/*\n\
 * this function will render my-app-lite template with given <opt>.packageJson\n\
 */\n\
    opt.packageJson = local.fsReadFileOrEmptyStringSync(\"package.json\", \"json\");\n\
    local.objectSetDefault(opt.packageJson, {\n\
        nameLib: opt.packageJson.name.replace((\n\
            /\\W/g\n\
        ), \"_\"),\n\
        repository: {\n\
            url: (\n\
                \"https://github.com/kaizhu256/node-\"\n\
                + opt.packageJson.name\n\
                + \".git\"\n\
            )\n\
        }\n\
    }, 2);\n\
    opt.githubRepo = opt.packageJson.repository.url.replace((\n\
        /\\.git$/\n\
    ), \"\").split(\"/\").slice(-2);\n\
    template = template.replace((\n\
        /kaizhu256(\\.github\\.io\\/|%252F|\\/)/g\n\
    ), opt.githubRepo[0] + (\"$1\"));\n\
    template = template.replace((\n\
        /node-my-app-lite/g\n\
    ), opt.githubRepo[1]);\n\
    template = template.replace((\n\
        /\\bh1-my-app\\b/g\n\
    ), (\n\
        opt.packageJson.nameHeroku\n\
        || (\"h1-\" + opt.packageJson.nameLib.replace((\n\
            /_/g\n\
        ), \"-\"))\n\
    ));\n\
    template = template.replace((\n\
        /my-app-lite/g\n\
    ), opt.packageJson.name);\n\
    template = template.replace((\n\
        /my_app/g\n\
    ), opt.packageJson.nameLib);\n\
    template = template.replace((\n\
        /\\{\\{packageJson\\.(\\S+)\\}\\}/g\n\
    ), function (ignore, match1) {\n\
        return opt.packageJson[match1];\n\
    });\n\
    return template;\n\
};\n\
\n\
local.testCase_nop_default = function (opt, onError) {\n\
/*\n\
 * this function will test nop's default handling-behavior\n\
 */\n\
    local.nop();\n\
    onError(null, opt);\n\
};\n\
\n\
local.testMock = function (mockList, onTestCase, onError) {\n\
/*\n\
 * this function will mock the objects in mockList while running the onTestCase\n\
 */\n\
    var onError2;\n\
    onError2 = function (err) {\n\
        // restore mock[0] from mock[2]\n\
        mockList.reverse().forEach(function (mock) {\n\
            Object.keys(mock[2]).forEach(function (key) {\n\
                mock[0][key] = mock[2][key];\n\
            });\n\
        });\n\
        onError(err);\n\
    };\n\
    // suppress console.error and console.log\n\
    if (!(mockList[0] && mockList[0][0] === console)) {\n\
        mockList.unshift([\n\
            console, {}\n\
        ]);\n\
    }\n\
    local.objectSetDefault(mockList[0][1], {\n\
        error: local.nop,\n\
        log: local.nop\n\
    });\n\
    // mock-objects\n\
    mockList.forEach(function (mock) {\n\
        mock[2] = {};\n\
        // backup mock[0] into mock[2]\n\
        Object.keys(mock[1]).forEach(function (key) {\n\
            mock[2][key] = (\n\
                // ternary-operator\n\
                (\n\
                    typeof process === \"object\"\n\
                    && process.env === mock[0]\n\
                    && mock[0][key] === undefined\n\
                )\n\
                // handle process.env\n\
                ? \"\"\n\
                : mock[0][key]\n\
            );\n\
        });\n\
        // override mock[0] with mock[1]\n\
        Object.keys(mock[1]).forEach(function (key) {\n\
            mock[0][key] = mock[1][key];\n\
        });\n\
    });\n\
    // try to call onError with mock-objects\n\
    local.tryCatchOnError(function () {\n\
        // run onTestCase\n\
        onTestCase(onError2);\n\
    }, onError2);\n\
};\n\
\n\
local.testReportCreate = function (testReport) {\n\
/*\n\
 * this function will create test-report artifacts\n\
 */\n\
    testReport = local.objectSetDefault(testReport, {\n\
        testPlatformList: []\n\
    });\n\
    // print test-report summary\n\
    console.error(\n\
        \"\\n\" + new Array(56).join(\"-\")\n\
        + \"\\n\" + testReport.testPlatformList.filter(function (testPlatform) {\n\
            // if testPlatform has no tests, then filter it out\n\
            return testPlatform.testCaseList.length;\n\
        }).map(function (testPlatform) {\n\
            return (\n\
                \"| test-report - \" + testPlatform.name + \"\\n|\"\n\
                + (\"        \" + testPlatform.timeElapsed + \" ms     \")\n\
                .slice(-16)\n\
                + (\"        \" + testPlatform.testsFailed + \" failed \")\n\
                .slice(-16)\n\
                + (\"        \" + testPlatform.testsPassed + \" passed \")\n\
                .slice(-16) + \"     |\\n\" + new Array(56).join(\"-\")\n\
            );\n\
        }).join(\"\\n\") + \"\\n\"\n\
    );\n\
    // create test-report.html\n\
    local.fs.writeFileSync(\n\
        \"tmp/build/test-report.html\",\n\
        local.testReportMerge(testReport, {})\n\
    );\n\
    // create build.badge.svg\n\
    local.fs.writeFileSync(\n\
        \"tmp/build/build.badge.svg\",\n\
        local.assetsDict[\"/assets.buildBadge.template.svg\"].replace((\n\
            /0000-00-00\\u002000:00:00\\u0020UTC\\u0020-\\u0020master\\u0020-\\u0020aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/g\n\
        ), (\n\
            new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\n\
            + \" - \" + local.env.CI_BRANCH + \" - \" + local.env.CI_COMMIT_ID\n\
        ))\n\
    );\n\
    // create test-report.badge.svg\n\
    local.fs.writeFileSync(\n\
        \"tmp/build/test-report.badge.svg\",\n\
        local.assetsDict[\"/assets.testReportBadge.template.svg\"]\n\
        // edit number of tests failed\n\
        .replace((\n\
            /999/g\n\
        ), testReport.testsFailed)\n\
        // edit badge color\n\
        .replace((\n\
            /d00/g\n\
        ), (\n\
            testReport.testsFailed\n\
            ? \"d00\"\n\
            : \"0d0\"\n\
        ))\n\
    );\n\
    console.error(\n\
        \"created test-report file \"\n\
        + process.cwd() + \"/tmp/build/test-report.html\\n\"\n\
    );\n\
    // if any test failed, then exit with non-zero exit-code\n\
    console.error(\n\
        \"\\n\" + local.env.MODE_BUILD\n\
        + \" - \" + testReport.testsFailed + \" failed tests\\n\"\n\
    );\n\
    // print failed testCase\n\
    testReport.testPlatformList.forEach(function (testPlatform) {\n\
        testPlatform.testCaseList.forEach(function (testCase) {\n\
            if (testCase.status !== \"passed\") {\n\
                console.error(JSON.stringify(testCase, null, 4));\n\
            }\n\
        });\n\
    });\n\
    return testReport;\n\
};\n\
\n\
local.testReportMerge = function (testReport1, testReport2) {\n\
/*\n\
 * this function will\n\
 * 1. merge testReport2 into testReport1\n\
 * 2. return testReport1 in html-format\n\
 */\n\
    var errorStackList;\n\
    var testCaseNumber;\n\
    var testReport;\n\
    testReport2 = testReport2 || {};\n\
    // 1. merge testReport2 into testReport1\n\
    [\n\
        testReport1, testReport2\n\
    ].forEach(function (testReport, ii) {\n\
        ii += 1;\n\
        local.objectSetDefault(testReport, {\n\
            date: new Date().toISOString(),\n\
            errorStackList: [],\n\
            testPlatformList: [],\n\
            timeElapsed: 0\n\
        }, 8);\n\
        // security - handle malformed testReport\n\
        local.assertThrow(\n\
            typeof testReport === \"object\" && testReport,\n\
            ii + \" invalid testReport \" + typeof testReport\n\
        );\n\
        // validate timeElapsed\n\
        local.assertThrow(\n\
            typeof testReport.timeElapsed === \"number\",\n\
            ii + \" invalid testReport.timeElapsed \"\n\
            + typeof testReport.timeElapsed\n\
        );\n\
        // security - handle malformed testReport.testPlatformList\n\
        testReport.testPlatformList.forEach(function (testPlatform) {\n\
            local.objectSetDefault(testPlatform, {\n\
                name: \"undefined\",\n\
                testCaseList: [],\n\
                timeElapsed: 0\n\
            }, 8);\n\
            local.assertThrow(\n\
                typeof testPlatform.name === \"string\",\n\
                ii + \" invalid testPlatform.name \" + typeof testPlatform.name\n\
            );\n\
            // insert $MODE_BUILD into testPlatform.name\n\
            if (local.env.MODE_BUILD) {\n\
                testPlatform.name = testPlatform.name.replace((\n\
                    /^(browser|node)\\b/\n\
                ), local.env.MODE_BUILD + \" - $1\");\n\
            }\n\
            // validate timeElapsed\n\
            local.assertThrow(\n\
                typeof testPlatform.timeElapsed === \"number\",\n\
                (\n\
                    ii + \" invalid testPlatform.timeElapsed \"\n\
                    + typeof testPlatform.timeElapsed\n\
                )\n\
            );\n\
            // security - handle malformed testPlatform.testCaseList\n\
            testPlatform.testCaseList.forEach(function (testCase) {\n\
                local.objectSetDefault(testCase, {\n\
                    errorStack: \"\",\n\
                    name: \"undefined\",\n\
                    timeElapsed: 0\n\
                }, 8);\n\
                local.assertThrow(\n\
                    typeof testCase.errorStack === \"string\",\n\
                    ii + \" invalid testCase.errorStack \"\n\
                    + typeof testCase.errorStack\n\
                );\n\
                local.assertThrow(\n\
                    typeof testCase.name === \"string\",\n\
                    ii + \" invalid testCase.name \" + typeof testCase.name\n\
                );\n\
                // validate timeElapsed\n\
                local.assertThrow(\n\
                    typeof testCase.timeElapsed === \"number\",\n\
                    (\n\
                        ii + \" invalid testCase.timeElapsed \"\n\
                        + typeof testCase.timeElapsed\n\
                    )\n\
                );\n\
            });\n\
        });\n\
    });\n\
    // merge testReport2.testPlatformList into testReport1.testPlatformList\n\
    testReport2.testPlatformList.forEach(function (testPlatform2) {\n\
        // add testPlatform2 to testReport1.testPlatformList\n\
        testReport1.testPlatformList.push(testPlatform2);\n\
    });\n\
    testReport = testReport1;\n\
    testReport.testsFailed = 0;\n\
    testReport.testsPassed = 0;\n\
    testReport.testsPending = 0;\n\
    testReport.testPlatformList.forEach(function (testPlatform) {\n\
        testPlatform.testsFailed = 0;\n\
        testPlatform.testsPassed = 0;\n\
        testPlatform.testsPending = 0;\n\
        testPlatform.testCaseList.forEach(function (testCase) {\n\
            switch (testCase.status) {\n\
            // update failed tests\n\
            case \"failed\":\n\
                testPlatform.testsFailed += 1;\n\
                testReport.testsFailed += 1;\n\
                break;\n\
            // update passed tests\n\
            case \"passed\":\n\
                testPlatform.testsPassed += 1;\n\
                testReport.testsPassed += 1;\n\
                break;\n\
            // update pending tests\n\
            default:\n\
                testPlatform.testsPending += 1;\n\
                testReport.testsPending += 1;\n\
            }\n\
        });\n\
        // update testPlatform.status\n\
        testPlatform.status = (\n\
            testPlatform.testsFailed\n\
            ? \"failed\"\n\
            : testPlatform.testsPending\n\
            ? \"pending\"\n\
            : \"passed\"\n\
        );\n\
        // sort testCaseList by status and name\n\
        testPlatform.testCaseList.sort(function (aa, bb) {\n\
            return (\n\
                aa.status.replace(\"passed\", \"z\") + aa.name\n\
                > bb.status.replace(\"passed\", \"z\") + bb.name\n\
                ? 1\n\
                : -1\n\
            );\n\
        });\n\
    });\n\
    // sort testPlatformList by status and name\n\
    testReport.testPlatformList.sort(function (aa, bb) {\n\
        return (\n\
            aa.status.replace(\"passed\", \"z\") + aa.name\n\
            > bb.status.replace(\"passed\", \"z\") + bb.name\n\
            ? 1\n\
            : -1\n\
        );\n\
    });\n\
    // stop testReport timer\n\
    if (!testReport.testsPending) {\n\
        local.timeElapsedPoll(testReport);\n\
    }\n\
    // 2. return testReport1 in html-format\n\
    // json-copy testReport that will be modified for html templating\n\
    testReport = local.jsonCopy(testReport1);\n\
    // update timeElapsed\n\
    local.timeElapsedPoll(testReport);\n\
    testReport.testPlatformList.forEach(function (testPlatform) {\n\
        // update testPlatform.timeElapsed\n\
        local.timeElapsedPoll(testPlatform);\n\
        testPlatform.testCaseList.forEach(function (testCase) {\n\
            if (!testCase.isDone) {\n\
                local.timeElapsedPoll(testCase);\n\
            }\n\
            testPlatform.timeElapsed = Math.max(\n\
                testPlatform.timeElapsed,\n\
                testCase.timeElapsed\n\
            );\n\
        });\n\
        // update testReport.timeElapsed with testPlatform.timeElapsed\n\
        testReport.timeElapsed = Math.max(\n\
            testReport.timeElapsed,\n\
            testPlatform.timeElapsed\n\
        );\n\
    });\n\
    // create html test-report\n\
    testCaseNumber = 0;\n\
    return local.templateRender(\n\
        local.assetsDict[\"/assets.testReport.template.html\"],\n\
        local.objectSetOverride(testReport, {\n\
            env: local.env,\n\
            // map testPlatformList\n\
            testPlatformList: testReport.testPlatformList.filter(function (\n\
                testPlatform\n\
            ) {\n\
                // if testPlatform has no tests, then filter it out\n\
                return testPlatform.testCaseList.length;\n\
            }).map(function (testPlatform, ii) {\n\
                errorStackList = [];\n\
                return local.objectSetOverride(testPlatform, {\n\
                    errorStackList,\n\
                    name: testPlatform.name,\n\
                    screenshot: testPlatform.screenshot,\n\
                    // map testCaseList\n\
                    testCaseList: testPlatform.testCaseList.map(function (\n\
                        testCase\n\
                    ) {\n\
                        testCaseNumber += 1;\n\
                        if (testCase.errorStack) {\n\
                            errorStackList.push({\n\
                                errorStack: (\n\
                                    testCaseNumber + \". \" + testCase.name\n\
                                    + \"\\n\" + testCase.errorStack\n\
                                )\n\
                            });\n\
                        }\n\
                        return local.objectSetOverride(testCase, {\n\
                            testCaseNumber,\n\
                            testReportTestStatusClass: (\n\
                                \"test\"\n\
                                + testCase.status[0].toUpperCase()\n\
                                + testCase.status.slice(1)\n\
                            )\n\
                        }, 8);\n\
                    }),\n\
                    preClass: (\n\
                        errorStackList.length\n\
                        ? \"\"\n\
                        : \"displayNone\"\n\
                    ),\n\
                    testPlatformNumber: ii + 1\n\
                });\n\
            }, 8),\n\
            testStatusClass: (\n\
                testReport.testsFailed\n\
                ? \"testFailed\"\n\
                : \"testPassed\"\n\
            )\n\
        }, 8)\n\
    );\n\
};\n\
\n\
local.testRunDefault = function (opt) {\n\
/*\n\
 * this function will run the tests in testPlatform.testCaseList\n\
 */\n\
    var processExit;\n\
    var testPlatform;\n\
    var testReport;\n\
    var testReportDiv1;\n\
    var timerInterval;\n\
    // run-server\n\
    if (!local.isBrowser) {\n\
        local.testRunServer(opt);\n\
    }\n\
    globalThis.utility2_modeTest = Number(\n\
        globalThis.utility2_modeTest\n\
        || opt.modeTest\n\
        || local.modeTest\n\
        || local.env.npm_config_mode_test\n\
    );\n\
    switch (globalThis.utility2_modeTest) {\n\
    // init\n\
    case 1:\n\
        globalThis.utility2_modeTest += 1;\n\
        // reset db\n\
        if (local.db && typeof local.db.dbReset === \"function\") {\n\
            local.db.dbReset(\n\
                globalThis.utility2_dbSeedList,\n\
                local.onErrorThrow\n\
            );\n\
        }\n\
        globalThis.utility2_onReadyAfter(function () {\n\
            local.testRunDefault(opt);\n\
        });\n\
        return;\n\
    // test-run\n\
    default:\n\
        // test-ignore\n\
        if (\n\
            globalThis.utility2_onReadyBefore.counter\n\
            || !globalThis.utility2_modeTest\n\
            || globalThis.utility2_modeTest > 2\n\
        ) {\n\
            return;\n\
        }\n\
        // test-run\n\
        globalThis.utility2_modeTest += 1;\n\
    }\n\
    // visual notification - testRun\n\
    local.ajaxProgressUpdate();\n\
    // mock serverLog\n\
    local._testRunConsoleError = local._testRunConsoleError || console.error;\n\
    console.error = function (arg0) {\n\
    /*\n\
     * this function will ignore serverLog-messages during test-run\n\
     */\n\
        /* istanbul ignore next */\n\
        if (!globalThis.__coverage__ && !(\n\
            /^serverLog\\u0020-\\u0020\\{/\n\
        ).test(arg0)) {\n\
            local._testRunConsoleError.apply(console, arguments); // jslint ignore:line\n\
        }\n\
    };\n\
    if (!local.isBrowser) {\n\
        // mock proces.exit\n\
        processExit = process.exit;\n\
        process.exit = local.nop;\n\
    }\n\
    // init modeTestCase\n\
    local.modeTestCase = (\n\
        local.modeTestCase\n\
        || local.env.npm_config_mode_test_case || \"\"\n\
    );\n\
    // init testReport\n\
    testReport = globalThis.utility2_testReport;\n\
    // init testReport timer\n\
    local.timeElapsedStart(testReport);\n\
    // init testPlatform\n\
    testPlatform = testReport.testPlatformList[0];\n\
    // init testPlatform timer\n\
    local.timeElapsedStart(testPlatform);\n\
    // reset testPlatform.testCaseList\n\
    testPlatform.testCaseList.length = 0;\n\
    // add tests into testPlatform.testCaseList\n\
    Object.keys(opt).forEach(function (key) {\n\
        // add testCase opt[key] to testPlatform.testCaseList\n\
        if (\n\
            typeof opt[key] === \"function\" && (\n\
                local.modeTestCase\n\
                ? local.modeTestCase.split(\n\
                    /[,\\s]/g\n\
                ).indexOf(key) >= 0\n\
                : key.indexOf(\"testCase_\") === 0\n\
            )\n\
        ) {\n\
            testPlatform.testCaseList.push({\n\
                isBrowser: local.isBrowser,\n\
                name: key,\n\
                status: \"pending\",\n\
                onTestCase: opt[key]\n\
            });\n\
        }\n\
    });\n\
    // visual notification - update test-progress until isDone\n\
    // init testReportDiv1 elem\n\
    if (local.isBrowser) {\n\
        testReportDiv1 = document.querySelector(\n\
            \"#testReportDiv1\"\n\
        );\n\
    }\n\
    testReportDiv1 = testReportDiv1 || {\n\
        style: {}\n\
    };\n\
    local.uiAnimateSlideDown(testReportDiv1);\n\
    testReportDiv1.innerHTML = local.testReportMerge(testReport, {});\n\
    // update test-report status every 1000 ms until isDone\n\
    timerInterval = setInterval(function () {\n\
        // update testPlatform.timeElapsed\n\
        local.timeElapsedPoll(testPlatform);\n\
        // update testReportDiv1 in browser\n\
        testReportDiv1.innerHTML = local.testReportMerge(testReport, {});\n\
        if (!testReport.testsPending) {\n\
            // cleanup timerInterval\n\
            clearInterval(timerInterval);\n\
        }\n\
        // notify of remaining tests\n\
        if (testPlatform.timeElapsed % 5000 < 1000) {\n\
            local._testRunConsoleError(\n\
                \"testRunDefault - \"\n\
                + testPlatform.timeElapsed + \" ms - testCase pending - \"\n\
                + testPlatform.testCaseList\n\
                .filter(function (testCase) {\n\
                    return testCase.status === \"pending\";\n\
                })\n\
                .slice(0, 4)\n\
                .map(function (testCase) {\n\
                    return testCase.name;\n\
                }).join(\", \") + \" ...\"\n\
            );\n\
        }\n\
    }, 1000);\n\
    // shallow-copy testPlatform.testCaseList to prevent side-effects\n\
    // from in-place sort from testReportMerge\n\
    local.onParallelList({\n\
        list: testPlatform.testCaseList.slice(),\n\
        rateLimit: Infinity\n\
    }, function (testCase, onParallel) {\n\
        var onError;\n\
        var timerTimeout;\n\
        onError = function (err) {\n\
            // update testPlatform.timeElapsed\n\
            local.timeElapsedPoll(testPlatform);\n\
            // cleanup timerTimeout\n\
            clearTimeout(timerTimeout);\n\
            // if testCase isDone, then fail testCase\n\
            if (testCase.isDone) {\n\
                err = err || new Error(\n\
                    \"callback in testCase \"\n\
                    + testCase.name\n\
                    + \" called multiple times\"\n\
                );\n\
            }\n\
            // if err occurred, then fail testCase\n\
            if (err) {\n\
                // restore console.log\n\
                console.error = local._testRunConsoleError;\n\
                testCase.status = \"failed\";\n\
                local._testRunConsoleError(\n\
                    \"\\ntestRunDefault - \"\n\
                    + testPlatform.timeElapsed + \" ms - testCase failed - \"\n\
                    + testCase.name + \"\\n\" + err.message + \"\\n\" + err.stack\n\
                );\n\
                testCase.errorStack = (\n\
                    testCase.errorStack || err.message + \"\\n\" + err.stack\n\
                );\n\
                // validate errorStack is non-empty\n\
                local.assertThrow(\n\
                    testCase.errorStack,\n\
                    \"invalid errorStack \" + testCase.errorStack\n\
                );\n\
            }\n\
            // if tests isDone, then do nothing\n\
            if (testCase.isDone) {\n\
                return;\n\
            }\n\
            testCase.isDone = true;\n\
            if (testCase.status === \"pending\") {\n\
                testCase.status = \"passed\";\n\
            }\n\
            // stop testCase timer\n\
            local.timeElapsedPoll(testCase);\n\
            local._testRunConsoleError(\n\
                \"testRunDefault - \"\n\
                + testPlatform.timeElapsed + \" ms - [\" + (\n\
                    local.isBrowser\n\
                    ? \"browser\"\n\
                    : \"node\"\n\
                ) + \" test-case \"\n\
                + testPlatform.testCaseList.filter(function (testCase) {\n\
                    return testCase.isDone;\n\
                }).length + \" of \" + testPlatform.testCaseList.length + \" \"\n\
                + testCase.status + \"] - \" + testCase.name\n\
            );\n\
            // if all testCase.isDone, then create test-report\n\
            onParallel();\n\
        };\n\
        testCase = testCase.elem;\n\
        // init timerTimeout\n\
        timerTimeout = local.onTimeout(\n\
            onError,\n\
            local.timeoutDefault,\n\
            testCase.name\n\
        );\n\
        // increment number of tests remaining\n\
        onParallel.counter += 1;\n\
        // try to run testCase\n\
        local.tryCatchOnError(function () {\n\
            // start testCase timer\n\
            local.timeElapsedStart(testCase);\n\
            testCase.onTestCase(null, onError);\n\
        }, onError);\n\
    }, function () {\n\
    /*\n\
     * this function will create the test-report after all tests isDone\n\
     */\n\
        // update testPlatform.timeElapsed\n\
        local.timeElapsedPoll(testPlatform);\n\
        globalThis.utility2_modeTest = 1;\n\
        local.ajaxProgressUpdate();\n\
        // init domOnEventWindowOnloadTimeElapsed\n\
        if (globalThis.domOnEventWindowOnloadTimeElapsed < 0x10000000000) {\n\
            testPlatform.domOnEventWindowOnloadTimeElapsed = (\n\
                globalThis.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
        }\n\
        // finalize testReport\n\
        local.testReportMerge(testReport, {});\n\
        // create test-report.json\n\
        delete testReport.coverage;\n\
        local.fsWriteFileWithMkdirpSync(\n\
            local.env.npm_config_dir_build + \"/test-report.json\",\n\
            JSON.stringify(testReport, null, 4)\n\
        );\n\
        setTimeout(function () {\n\
            // restore console.log\n\
            console.error = local._testRunConsoleError;\n\
            // restore process.exit\n\
            if (processExit) {\n\
                process.exit = processExit;\n\
            }\n\
            // reset utility2_modeTest\n\
            globalThis.utility2_modeTest = 0;\n\
            // exit with number of tests failed\n\
            local.exit(testReport.testsFailed, testReport);\n\
        // coverage-hack - wait 1000 ms for timerInterval\n\
        }, 1000);\n\
    });\n\
};\n\
\n\
local.testRunServer = function (opt) {\n\
/*\n\
 * this function will\n\
 * 1. create server from local.middlewareList\n\
 * 2. start server on local.env.PORT\n\
 * 3. run tests\n\
 */\n\
    if (globalThis.utility2_serverHttp1) {\n\
        return;\n\
    }\n\
    globalThis.utility2_onReadyBefore.counter += 1;\n\
    // 1. create server from local.middlewareList\n\
    local.middlewareList = local.middlewareList || [\n\
        local.middlewareInit,\n\
        local.middlewareForwardProxy,\n\
        local.middlewareAssetsCached,\n\
        local.middlewareJsonpStateInit,\n\
        local.middlewareFileServer\n\
    ];\n\
    local.serverLocalReqHandler = function (req, res) {\n\
        var that;\n\
        that = {};\n\
        local.onNext(that, function (err) {\n\
            if (err || that.modeNext >= local.middlewareList.length) {\n\
                local.middlewareError(err, req, res);\n\
                return;\n\
            }\n\
            // recurse with next middleware in middlewareList\n\
            local.middlewareList[that.modeNext](req, res, that.onNext);\n\
        });\n\
        that.modeNext = -1;\n\
        that.onNext();\n\
    };\n\
    globalThis.utility2_serverHttp1 = local.http.createServer(\n\
        local.serverLocalReqHandler\n\
    );\n\
    // 2. start server on local.env.PORT\n\
    if (local.env.npm_config_mode_library) {\n\
        globalThis.utility2_onReadyBefore();\n\
        return;\n\
    }\n\
    console.error(\"http-server listening on port \" + local.env.PORT);\n\
    globalThis.utility2_onReadyBefore.counter += 1;\n\
    globalThis.utility2_serverHttp1.listen(\n\
        local.env.PORT,\n\
        globalThis.utility2_onReadyBefore\n\
    );\n\
    // 3. run tests\n\
    local.testRunDefault(opt);\n\
    globalThis.utility2_onReadyBefore();\n\
};\n\
\n\
local.throwError = function () {\n\
/*\n\
 * this function will throw new err\n\
 */\n\
    throw new Error();\n\
};\n\
\n\
local.timeElapsedPoll = function (opt) {\n\
/*\n\
 * this function will poll <opt>.timeElapsed\n\
 */\n\
    opt = local.timeElapsedStart(opt);\n\
    opt.timeElapsed = Date.now() - opt.timeStart;\n\
    return opt;\n\
};\n\
\n\
local.timeElapsedStart = function (opt, timeStart) {\n\
/*\n\
 * this function will start <opt>.timeElapsed\n\
 */\n\
    opt = opt || {};\n\
    opt.timeStart = timeStart || opt.timeStart || Date.now();\n\
    return opt;\n\
};\n\
\n\
local.tryCatchOnError = function (fnc, onError) {\n\
/*\n\
 * this function will run the fnc in a tryCatch block,\n\
 * else call onError with errCaught\n\
 */\n\
    var result;\n\
    // validate onError\n\
    local.assertThrow(typeof onError === \"function\", typeof onError);\n\
    try {\n\
        // reset errCaught\n\
        local._debugTryCatchError = null;\n\
        result = fnc();\n\
        local._debugTryCatchError = null;\n\
        return result;\n\
    } catch (errCaught) {\n\
        // debug errCaught\n\
        local._debugTryCatchError = errCaught;\n\
        return onError(errCaught);\n\
    }\n\
};\n\
\n\
local.uiAnimateShake = function (elem, onError) {\n\
/*\n\
 * this function will shake dom-<elem>\n\
 */\n\
    if (!elem || elem.classList.contains(\"uiAnimateShake\")) {\n\
        local.setTimeoutOnError(onError);\n\
        return;\n\
    }\n\
    elem.classList.add(\"uiAnimateShake\");\n\
    setTimeout(function () {\n\
        elem.classList.remove(\"uiAnimateShake\");\n\
        local.setTimeoutOnError(onError);\n\
    }, 500);\n\
};\n\
\n\
local.uiAnimateShakeIfError = function (err, elem, onError) {\n\
/*\n\
 * this function will shake dom-<elem> if <err> occurred\n\
 */\n\
    var hasError;\n\
    if (!elem) {\n\
        local.setTimeoutOnError(onError);\n\
        return;\n\
    }\n\
    hasError = elem.classList.contains(\"hasError\");\n\
    if (err && !hasError) {\n\
        elem.classList.add(\"hasError\");\n\
        local.uiAnimateShake(elem, onError);\n\
        return;\n\
    }\n\
    if (!err && hasError) {\n\
        elem.classList.remove(\"hasError\");\n\
    }\n\
    local.setTimeoutOnError(onError);\n\
};\n\
\n\
local.uiAnimateSlideAccordian = function (elem, elemList, onError) {\n\
/*\n\
 * this function will slideDown <elem>, but slideUp elements in <elemList>\n\
 */\n\
    elemList.forEach(function (elem2) {\n\
        if (elem2 !== elem) {\n\
            local.uiAnimateSlideUp(elem2);\n\
        }\n\
    });\n\
    setTimeout(function () {\n\
        local.uiAnimateSlideDown(elem, onError);\n\
    }, 250);\n\
};\n\
\n\
local.uiAnimateSlideDown = function (elem, onError) {\n\
/*\n\
 * this function will slideDown dom-<elem>\n\
 */\n\
    onError = onError || local.nop;\n\
    if (!(\n\
        elem\n\
        && elem.style && elem.style.maxHeight !== \"100%\"\n\
        && elem.classList && elem.classList.contains(\"uiAnimateSlide\")\n\
    )) {\n\
        onError();\n\
        return;\n\
    }\n\
    elem.style.borderBottom = \"\";\n\
    elem.style.borderTop = \"\";\n\
    elem.style.marginBottom = \"\";\n\
    elem.style.marginTop = \"\";\n\
    elem.style.maxHeight = 1.5 * globalThis.innerHeight + \"px\";\n\
    elem.style.paddingBottom = \"\";\n\
    elem.style.paddingTop = \"\";\n\
    setTimeout(function () {\n\
        elem.style.maxHeight = \"100%\";\n\
        onError();\n\
    }, 250);\n\
};\n\
\n\
local.uiAnimateSlideUp = function (elem, onError) {\n\
/*\n\
 * this function will slideUp dom-<elem>\n\
 */\n\
    if (!(\n\
        elem\n\
        && elem.style && elem.style.maxHeight !== \"0px\"\n\
        && elem.classList && elem.classList.contains(\"uiAnimateSlide\")\n\
    )) {\n\
        local.setTimeoutOnError(onError);\n\
        return;\n\
    }\n\
    elem.style.borderBottom = \"0\";\n\
    elem.style.borderTop = \"0\";\n\
    elem.style.marginBottom = \"0\";\n\
    elem.style.marginTop = \"0\";\n\
    elem.style.maxHeight = \"0\";\n\
    elem.style.paddingBottom = \"0\";\n\
    elem.style.paddingTop = \"0\";\n\
    local.setTimeoutOnError(onError, 250);\n\
};\n\
\n\
local.urlJoin = function (aa, bb) {\n\
/*\n\
 * this function will if bb is relative, url-join aa with bb\n\
 */\n\
    // bb is absolute-url\n\
    if ((\n\
        /^\\w+?:\\/\\//\n\
    ).test(bb)) {\n\
        return bb;\n\
    }\n\
    // bb is absolute-url without protocol\n\
    if (bb.slice(0, 2) === \"//\") {\n\
        return aa.split(\"/\")[0] + bb;\n\
    }\n\
    // bb is absolute-url without host\n\
    if (bb[0] === \"/\") {\n\
        return aa.split(\"/\").slice(0, 3).join(\"/\") + bb;\n\
    }\n\
    // bb is relative-url\n\
    if (aa.split(\"/\").length < 4) {\n\
        aa += \"/\";\n\
    }\n\
    return aa.replace((\n\
        /[?#].*?$/\n\
    ), \"\").replace((\n\
        /[^\\/]*?$/\n\
    ), \"\") + bb;\n\
};\n\
\n\
local.urlParse = function (url) {\n\
/*\n\
 * this function will parse <url> according to below spec, plus a query param\n\
 * https://developer.mozilla.org/en-US/docs/Web/API/URL\n\
 */\n\
    var urlParsed;\n\
    urlParsed = {};\n\
    // try to parse url\n\
    local.tryCatchOnError(function () {\n\
        // resolve host-less url\n\
        if (local.isBrowser) {\n\
            local.serverLocalHost = (\n\
                local.serverLocalHost\n\
                || location.protocol + \"//\" + location.host\n\
            );\n\
            // resolve absolute path\n\
            if (url[0] === \"/\") {\n\
                url = local.serverLocalHost + url;\n\
            // resolve relative path\n\
            } else if (!(\n\
                /^\\w+?:\\/\\//\n\
            ).test(url)) {\n\
                url = (\n\
                    local.serverLocalHost\n\
                    + location.pathname.replace((\n\
                        /\\/[^\\/]*?$/\n\
                    ), \"\") + \"/\" + url\n\
                );\n\
            }\n\
            urlParsed = new globalThis.URL(url);\n\
            urlParsed.path = \"/\" + urlParsed.href\n\
            .split(\"/\")\n\
            .slice(3)\n\
            .join(\"/\")\n\
            .split(\"#\")[0];\n\
        } else {\n\
            local.env.PORT = local.env.PORT || \"8081\";\n\
            local.serverLocalHost = (\n\
                local.serverLocalHost\n\
                || (\"http://127.0.0.1:\" + local.env.PORT)\n\
            );\n\
            // resolve absolute path\n\
            if (url[0] === \"/\") {\n\
                url = local.serverLocalHost + url;\n\
            // resolve relative path\n\
            } else if (!(\n\
                /^\\w+?:\\/\\//\n\
            ).test(url)) {\n\
                url = local.serverLocalHost + \"/\" + url;\n\
            }\n\
            urlParsed = local.url.parse(url);\n\
        }\n\
        // init query\n\
        urlParsed.query = {};\n\
        (urlParsed.search || \"\").slice(1).replace((\n\
            /[^&]+/g\n\
        ), function (item) {\n\
            item = item.split(\"=\");\n\
            item[0] = decodeURIComponent(item[0]);\n\
            item[1] = decodeURIComponent(item.slice(1).join(\"=\"));\n\
            // parse repeating query-param as an array\n\
            if (urlParsed.query[item[0]]) {\n\
                if (!Array.isArray(urlParsed.query[item[0]])) {\n\
                    urlParsed.query[item[0]] = [\n\
                        urlParsed.query[item[0]]\n\
                    ];\n\
                }\n\
                urlParsed.query[item[0]].push(item[1]);\n\
            } else {\n\
                urlParsed.query[item[0]] = item[1];\n\
            }\n\
        });\n\
        urlParsed.basename = urlParsed.pathname.replace((\n\
            /^.*\\//\n\
        ), \"\");\n\
    }, local.nop);\n\
    // https://developer.mozilla.org/en/docs/Web/API/URL#Properties\n\
    return {\n\
        basename: urlParsed.basename || \"\",\n\
        hash: urlParsed.hash || \"\",\n\
        host: urlParsed.host || \"\",\n\
        hostname: urlParsed.hostname || \"\",\n\
        href: urlParsed.href || \"\",\n\
        path: urlParsed.path || \"\",\n\
        pathname: urlParsed.pathname || \"\",\n\
        port: urlParsed.port || \"\",\n\
        protocol: urlParsed.protocol || \"\",\n\
        query: urlParsed.query || {},\n\
        search: urlParsed.search || \"\"\n\
    };\n\
};\n\
\n\
local.uuid4Create = function () {\n\
/*\n\
 * this function will create a random uuid,\n\
 * with format 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'\n\
 */\n\
    // code derived from http://jsperf.com/uuid4\n\
    var id;\n\
    var ii;\n\
    id = \"\";\n\
    ii = 0;\n\
    while (ii < 32) {\n\
        switch (ii) {\n\
        case 8:\n\
        case 20:\n\
            id += \"-\";\n\
            // coerce to finite integer\n\
            id += ((Math.random() * 16) | 0).toString(16);\n\
            break;\n\
        case 12:\n\
            id += \"-\";\n\
            id += \"4\";\n\
            break;\n\
        case 16:\n\
            id += \"-\";\n\
            id += ((Math.random() * 4) | 8).toString(16);\n\
            break;\n\
        default:\n\
            // coerce to finite integer\n\
            id += ((Math.random() * 16) | 0).toString(16);\n\
        }\n\
        ii += 1;\n\
    }\n\
    return id;\n\
};\n\
}());\n\
\n\
\n\
\n\
// run shared js-env code - init-after\n\
(function () {\n\
local.apidocCreate = local.apidoc.apidocCreate;\n\
local.browserTest({\n\
modeTestReportCreate: true\n\
});\n\
local.cacheDict = {};\n\
local.contentTypeDict = {\n\
    // application\n\
    \".js\": \"application/javascript; charset=utf-8\",\n\
    \".json\": \"application/json; charset=utf-8\",\n\
    \".pdf\": \"application/pdf\",\n\
    \".xml\": \"application/xml; charset=utf-8\",\n\
    // image\n\
    \".bmp\": \"image/bmp\",\n\
    \".gif\": \"image/gif\",\n\
    \".jpeg\": \"image/jpeg\",\n\
    \".jpg\": \"image/jpeg\",\n\
    \".png\": \"image/png\",\n\
    \".svg\": \"image/svg+xml; charset=utf-8\",\n\
    // text\n\
    \".css\": \"text/css; charset=utf-8\",\n\
    \".htm\": \"text/html; charset=utf-8\",\n\
    \".html\": \"text/html; charset=utf-8\",\n\
    \".md\": \"text/markdown; charset=utf-8\",\n\
    \".txt\": \"text/plain; charset=utf-8\"\n\
};\n\
// init env\n\
local.env = (\n\
    local.isBrowser\n\
    ? {}\n\
    : process.env\n\
);\n\
local.objectSetDefault(local.env, {\n\
    npm_package_nameLib: (local.env.npm_package_name || \"\").replace((\n\
        /\\W/g\n\
    ), \"_\")\n\
});\n\
local.objectSetDefault(local.env, {\n\
    npm_package_description: \"the greatest app in the world!\",\n\
    npm_package_name: \"my-app-lite\",\n\
    npm_package_nameLib: \"my_app\",\n\
    npm_package_version: \"0.0.1\"\n\
});\n\
local.errDefault = new Error(\"default-error\");\n\
globalThis.utility2_onReadyAfter = (\n\
    globalThis.utility2_onReadyAfter || function (onError) {\n\
    /*\n\
     * this function will call onError when utility2_onReadyBefore.counter === 0\n\
     */\n\
        globalThis.utility2_onReadyBefore.counter += 1;\n\
        local.taskCreate({\n\
            key: \"globalThis.utility2_onReadyAfter\"\n\
        }, null, onError);\n\
        setTimeout(globalThis.utility2_onReadyBefore);\n\
        return onError;\n\
    }\n\
);\n\
globalThis.utility2_onReadyBefore = (\n\
    globalThis.utility2_onReadyBefore\n\
    || local.onParallel(function (err) {\n\
    /*\n\
     * this function will keep track of utility2_onReadyBefore.counter\n\
     */\n\
        local.taskCreate({\n\
            key: \"globalThis.utility2_onReadyAfter\"\n\
        }, function (onError) {\n\
            onError(err);\n\
        }, local.onErrorThrow);\n\
    })\n\
);\n\
local.istanbulCoverageMerge = local.istanbul.coverageMerge || local.identity;\n\
// cbranch-no cstat-no fstat-no missing-if-branch\n\
local.istanbulCoverageReportCreate = (\n\
    local.istanbul.coverageReportCreate || local.identity\n\
);\n\
local.istanbulInstrumentInPackage = (\n\
    local.istanbul.instrumentInPackage || local.identity\n\
);\n\
local.istanbulInstrumentSync = local.istanbul.instrumentSync || local.identity;\n\
local.jslintAndPrint = local.jslint.jslintAndPrint || local.identity;\n\
local.regexpCharsetEncodeUri = (\n\
    /\\w!#\\$%&'\\(\\)\\*\\+,\\-\\.\\/:;=\\?@~/\n\
);\n\
local.regexpCharsetEncodeUriComponent = (\n\
    /\\w!%'\\(\\)\\*\\-\\.~/\n\
);\n\
// https://github.com/chjj/marked/blob/v0.3.7/lib/marked.js#L499\n\
local.regexpMatchUrl = (\n\
    /\\bhttps?:\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s]/\n\
);\n\
// https://www.w3.org/TR/html5/sec-forms.html#email-state-typeemail\n\
local.regexpValidateEmail = (\n\
    /^[a-zA-Z0-9.!#$%&'*+\\/=?\\^_`{|}~\\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?)*$/\n\
);\n\
// https://en.wikipedia.org/wiki/E.164\n\
local.regexpValidatePhone = (\n\
    /^(?:\\+\\d{1,3}[\\u0020\\-]?)?(?:\\(\\d{1,4}\\)[\\u0020\\-]?)?\\d[\\d\\u0020\\-]{7,17}$/\n\
);\n\
local.regexpValidateUuid = (\n\
    /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/\n\
);\n\
local.stringCharsetAscii = (\n\
    \"\\u0000\\u0001\\u0002\\u0003\\u0004\\u0005\\u0006\\u0007\"\n\
    + \"\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\"\n\
    + \"\\u0010\\u0011\\u0012\\u0013\\u0014\\u0015\\u0016\\u0017\"\n\
    + \"\\u0018\\u0019\\u001a\\u001b\\u001c\\u001d\\u001e\\u001f\"\n\
    + \" !\\\"#$%&'()*+,-./0123456789:;<=>?\"\n\
    + \"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\"\n\
    + \"`abcdefghijklmnopqrstuvwxyz{|}~\\u007f\"\n\
);\n\
local.stringCharsetEncodeUri = (\n\
    \"!#$%&'()*+,-./\"\n\
    + \"0123456789:;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~\"\n\
);\n\
local.stringCharsetEncodeUriComponent = (\n\
    \"!%'()*-.\"\n\
    + \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~\"\n\
);\n\
local.stringHelloEmoji = \"hello \\ud83d\\ude01\\n\";\n\
// mock swgg\n\
local.swgg = local.swgg || {\n\
    apiUpdate: local.nop,\n\
    normalizeSwaggerJson: local.nop,\n\
    swaggerValidate: local.nop\n\
};\n\
local.taskOnTaskDict = {};\n\
// init serverLocalHost\n\
local.urlParse(\"\");\n\
// init timeoutDefault\n\
if (local.isBrowser) {\n\
    location.search.replace((\n\
        /\\b(NODE_ENV|mode[A-Z]\\w+|timeExit|timeoutDefault)=([^&#]+)/g\n\
    ), function (match0, key, value) {\n\
        local[key] = decodeURIComponent(value);\n\
        local.env[key] = local[key];\n\
        // try to JSON.parse the string\n\
        local.tryCatchOnError(function () {\n\
            local[key] = JSON.parse(match0);\n\
        }, local.nop);\n\
    });\n\
} else {\n\
    local.timeoutDefault = local.env.npm_config_timeout_default;\n\
}\n\
// init timeExit\n\
local.timeExit = (\n\
    Number(local.env.npm_config_time_exit) || local.timeExit\n\
    || Number(Date.now() + Number(local.env.npm_config_timeout_exit))\n\
);\n\
if (local.timeExit) {\n\
    local.timeoutDefault = local.timeExit - Date.now();\n\
    setTimeout(local.exit, local.timeoutDefault);\n\
}\n\
// re-init timeoutDefault\n\
local.timeoutDefault = Number(local.timeoutDefault) || 30000;\n\
globalThis.utility2_onReadyAfter(local.nop);\n\
}());\n\
\n\
\n\
\n\
// run browser js-env code - init-after\n\
(function () {\n\
if (!local.isBrowser) {\n\
    return;\n\
}\n\
// require modules\n\
local.http = local._http;\n\
local.https = local._http;\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run node js-env code - init-after\n\
(function () {\n\
if (local.isBrowser) {\n\
    return;\n\
}\n\
local.Module = require(\"module\");\n\
// init env\n\
local.objectAssignDefault(local.env, {\n\
    npm_config_dir_build: process.cwd() + \"/tmp/build\",\n\
    npm_config_dir_tmp: process.cwd() + \"/tmp\"\n\
});\n\
// merge previous test-report\n\
if (local.env.npm_config_file_test_report_merge) {\n\
    local.testReportMerge(\n\
        globalThis.utility2_testReport,\n\
        local.fsReadFileOrEmptyStringSync(\n\
            local.env.npm_config_file_test_report_merge,\n\
            \"json\"\n\
        )\n\
    );\n\
    if (process.argv[2] !== \"--help\") {\n\
        console.error(\n\
            \"\\n\" + local.env.MODE_BUILD + \" - merged test-report from file \"\n\
            + local.env.npm_config_file_test_report_merge\n\
        );\n\
    }\n\
}\n\
// init cli\n\
if (module === require.main && (!globalThis.utility2_rollup || (\n\
    process.argv[2]\n\
    && local.cliDict[process.argv[2]]\n\
    && process.argv[2].indexOf(\"utility2.\") === 0\n\
))) {\n\
    local.cliRun({}, local.nop);\n\
    if (local.cliDict[process.argv[2]]) {\n\
        local.cliDict[process.argv[2]]();\n\
        switch (process.argv[2]) {\n\
        case \"--interactive\":\n\
        case \"-i\":\n\
        case \"utility2.swaggerValidateFile\":\n\
        case \"utility2.start\":\n\
            break;\n\
        default:\n\
            return;\n\
        }\n\
    }\n\
}\n\
/* validateLineSortedReset */\n\
// override assets\n\
[\n\
    \"/assets.index.template.html\",\n\
    \"/assets.swgg.swagger.json\",\n\
    \"/assets.swgg.swagger.server.json\"\n\
].forEach(function (file) {\n\
    local.assetsDict[file] = local.assetsDict[file] || \"\";\n\
    if (process.argv[2] !== \"--help\" && local.fs.existsSync(__dirname + file)) {\n\
        console.error(\"override assets \" + __dirname + file);\n\
        local.assetsDict[file] = local.fs.readFileSync(\n\
            __dirname + file,\n\
            \"utf8\"\n\
        );\n\
    }\n\
});\n\
if (globalThis.utility2_rollup) {\n\
    local.assetsDict[\"/assets.utility2.rollup.js\"] = (\n\
        local.fs.readFileSync(\n\
            __filename,\n\
            \"utf8\"\n\
        ).split(\"\\n/* script-end /assets.utility2.rollup.end.js */\")[0]\n\
        + \"\\n/* script-end /assets.utility2.rollup.end.js */\\n\"\n\
    );\n\
    return;\n\
}\n\
// init assets\n\
[\n\
    \"/assets.utility2.example.js\",\n\
    \"/assets.utility2.html\",\n\
    \"/assets.utility2.test.js\",\n\
    \"lib.apidoc.js\",\n\
    \"lib.db.js\",\n\
    \"lib.github_crud.js\",\n\
    \"lib.istanbul.js\",\n\
    \"lib.jslint.js\",\n\
    \"lib.marked.js\",\n\
    \"lib.sjcl.js\",\n\
    \"lib.swgg.js\",\n\
    \"lib.utility2.js\",\n\
    \"test.js\"\n\
].forEach(function (key) {\n\
    switch (key) {\n\
    case \"/assets.utility2.example.js\":\n\
        local.assetsDict[key] = \"\";\n\
        local.tryCatchOnError(function () {\n\
            local.fs.readFileSync(\n\
                __dirname + \"/README.md\",\n\
                \"utf8\"\n\
            ).replace((\n\
                /```javascript([\\S\\s]*?)```/\n\
            ), function (ignore, match1) {\n\
                local.assetsDict[key] = match1.trim() + \"\\n\";\n\
            });\n\
        }, local.nop);\n\
        break;\n\
    case \"/assets.utility2.html\":\n\
        local.assetsDict[key] = \"\";\n\
        local.tryCatchOnError(function () {\n\
            local.fs.readFileSync(__dirname + \"/README.md\", \"utf8\").replace((\n\
                /<!doctype\\u0020html>[\\S\\s]*?<\\/html>\\\\n\\\\\\n/\n\
            ), function (match0) {\n\
                local.assetsDict[key] = (\n\
                    local.templateRender(match0\n\
                    .replace((\n\
                        /\\\\n\\\\$/gm\n\
                    ), \"\")\n\
                    .replace(\n\
                        \"<script src=\\\"assets.app.js\\\"></script>\\n\",\n\
                        (\n\
                            \"<script \"\n\
                            + \"src=\\\"assets.utility2.rollup.js\\\"></script>\\n\"\n\
                            + \"<script \"\n\
                            + \"src=\\\"assets.utility2.example.js\\\"></script>\\n\"\n\
                            + \"<script \"\n\
                            + \"src=\\\"assets.utility2.test.js\\\"></script>\\n\"\n\
                        )\n\
                    )\n\
                    .replace(\"assets.example.js\", \"assets.utility2.example.js\")\n\
                    .replace(\"assets.test.js\", \"assets.utility2.test.js\")\n\
                    .replace((\n\
                        /npm_package_/g\n\
                    ), \"\")\n\
                    // uncomment utility2-comment\n\
                    .replace((\n\
                        /<!--\\u0020utility2-comment\\b([\\S\\s]*?)\\butility2-comment\\u0020-->/g\n\
                    ), \"$1\"), {\n\
                        env: local.objectSetDefault({\n\
                            version: \"0.0.1\"\n\
                        }, require(__dirname + \"/package.json\")),\n\
                        isRollup: true\n\
                    })\n\
                );\n\
            });\n\
        }, local.nop);\n\
        break;\n\
    case \"/assets.utility2.test.js\":\n\
        local.assetsDict[key] = local.fsReadFileOrEmptyStringSync(\n\
            __dirname + \"/test.js\",\n\
            \"utf8\"\n\
        );\n\
        break;\n\
    case \"lib.swgg.js\":\n\
    case \"lib.utility2.js\":\n\
        key = key.replace(\"lib.\", \"\");\n\
        local.assetsDict[\"/assets.\" + key] = local.fsReadFileOrEmptyStringSync(\n\
            __dirname + \"/lib.\" + key,\n\
            \"utf8\"\n\
        ).replace((\n\
            /^#!\\//\n\
        ), \"// \");\n\
        break;\n\
    default:\n\
        local.assetsDict[\"/assets.utility2.\" + key] = (\n\
            local.fsReadFileOrEmptyStringSync(\n\
                __dirname + \"/\" + key,\n\
                \"utf8\"\n\
            ).replace((\n\
                /^#!\\//\n\
            ), \"// \")\n\
        );\n\
    }\n\
});\n\
local.assetsDict[\"/assets.utility2.rollup.js\"] = [\n\
    \"header\",\n\
    \"/assets.utility2.rollup.begin.js\",\n\
    \"lib.apidoc.js\",\n\
    \"lib.db.js\",\n\
    \"lib.github_crud.js\",\n\
    \"lib.istanbul.js\",\n\
    \"lib.jslint.js\",\n\
    \"lib.marked.js\",\n\
    \"lib.sjcl.js\",\n\
    \"lib.utility2.js\",\n\
    \"lib.swgg.js\",\n\
    \"/assets.utility2.example.js\",\n\
    \"/assets.utility2.html\",\n\
    \"/assets.utility2.test.js\",\n\
    \"/assets.utility2.rollup.end.js\"\n\
].map(function (key) {\n\
    var script;\n\
    switch (key) {\n\
    case \"/assets.utility2.example.js\":\n\
    case \"/assets.utility2.html\":\n\
    case \"/assets.utility2.test.js\":\n\
        // handle large string-replace\n\
        script = local.assetsDict[\"/assets.utility2.rollup.content.js\"]\n\
        .split(\"/* utility2.rollup.js content */\");\n\
        script.splice(1, 0, (\n\
            \"local.assetsDict[\\\"\" + key + \"\\\"] = \"\n\
            + JSON.stringify(local.assetsDict[key])\n\
        ).replace((\n\
            /\\\\\\\\/g\n\
        ), \"\\u0000\").replace((\n\
            /\\\\n/g\n\
        ), \"\\\\n\\\\\\n\").replace((\n\
            /\\u0000/g\n\
        ), \"\\\\\\\\\"));\n\
        script = script.join(\"\");\n\
        script += \"\\n\";\n\
        break;\n\
    case \"/assets.utility2.rollup.begin.js\":\n\
    case \"/assets.utility2.rollup.end.js\":\n\
        script = local.assetsDict[key];\n\
        break;\n\
    case \"header\":\n\
        return (\n\
            \"/* this rollup was created with utility2\\n\"\n\
            + \" * https://github.com/kaizhu256/node-utility2\\n\"\n\
            + \" */\\n\"\n\
        );\n\
    case \"lib.swgg.js\":\n\
    case \"lib.utility2.js\":\n\
        key = \"/assets.\" + key.replace(\"lib.\", \"\");\n\
        script = local.assetsDict[key];\n\
        break;\n\
    default:\n\
        key = \"/assets.utility2.\" + key;\n\
        script = local.assetsDict[key];\n\
    }\n\
    return (\n\
        \"/* script-begin \" + key + \" */\\n\"\n\
        + script.trim()\n\
        + \"\\n/* script-end \" + key + \" */\\n\"\n\
    );\n\
}).join(\"\\n\\n\\n\");\n\
// init lib dependents\n\
[\n\
    \"swgg\"\n\
].forEach(function (lib) {\n\
    var file;\n\
    file = __dirname + \"/lib.\" + lib + \".js\";\n\
    if (local.fs.existsSync(file)) {\n\
        local[lib] = require(file);\n\
    }\n\
});\n\
}());\n\
\n\
\n\
\n\
}());\n\
"
/* jslint ignore:end */
    return local;
}(globalThis.utility2_rollup));

// usr/bin/env node
/*
 * lib.utility2.js (2019.8.11)
 * https://github.com/kaizhu256/node-utility2
 * this zero-dependency package will provide a collection of high-level functions to to build, test, and deploy webapps
 *
 */



/* istanbul instrument in package utility2 */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



/* istanbul ignore next */
// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    // || globalThis.utility2_rollup_old
    // || require("./assets.utility2.rollup.js")
    || globalThis.globalLocal
);
// init exports
if (local.isBrowser) {
    globalThis.utility2_utility2 = local;
} else {
    module.exports = local;
    module.exports.__dirname = __dirname;
}
// init lib main
local.utility2 = local;



/* validateLineSortedReset */
// init lib utility2
globalThis.utility2 = local;
// init lib extra
[
    "apidoc",
    "db",
    "github_crud",
    "istanbul",
    "jslint",
    "marked",
    "sjcl"
].forEach(function (key) {
    try {
        local[key] = (
            local.isBrowser
            ? globalThis["utility2_" + key]
            : require("./lib." + key + ".js")
        );
    } catch (errCaught) {
        local.assertThrow(errCaught.code === "MODULE_NOT_FOUND", errCaught);
    }
    local[key] = local[key] || {};
});
// init assets and templates
local.assetsDict = local.assetsDict || {};



/* jslint ignore:start */
local.assetsDict["/assets.index.template.html"] =
local.assetsDict["/assets.utility2.template.html"] = '\
<!doctype html>\n\
<html lang="en">\n\
<head>\n\
<meta charset="utf-8">\n\
<meta name="viewport" content="width=device-width, initial-scale=1">\n\
<!-- "assets.utility2.template.html" -->\n\
<title>{{env.npm_package_name}} ({{env.npm_package_version}})</title>\n\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
*/\n\
/* csslint ignore:start */\n\
*,\n\
*:after,\n\
*:before {\n\
    box-sizing: border-box;\n\
}\n\
/* csslint ignore:end */\n\
@keyframes uiAnimateShake {\n\
0%,\n\
50% {\n\
    transform: translateX(10px);\n\
}\n\
100% {\n\
    transform: translateX(0);\n\
}\n\
25%,\n\
75% {\n\
    transform: translateX(-10px);\n\
}\n\
}\n\
@keyframes uiAnimateSpin {\n\
0% {\n\
    transform: rotate(0deg);\n\
}\n\
100% {\n\
    transform: rotate(360deg);\n\
}\n\
}\n\
a {\n\
    overflow-wrap: break-word;\n\
}\n\
body {\n\
    background: #eef;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: small;\n\
    margin: 0 40px;\n\
}\n\
body > div,\n\
body > form > div,\n\
body > form > input,\n\
body > form > pre,\n\
body > form > .button,\n\
body > form > .textarea,\n\
body > input,\n\
body > pre,\n\
body > .button,\n\
body > .textarea {\n\
    margin-bottom: 20px;\n\
    margin-top: 0;\n\
}\n\
body > form > input,\n\
body > form > .button,\n\
body > input,\n\
body > .button {\n\
    width: 20rem;\n\
}\n\
body > form > .textarea,\n\
body > .textarea {\n\
    height: 10rem;\n\
    width: 100%;\n\
}\n\
body > .readonly {\n\
    background: #ddd;\n\
}\n\
code,\n\
pre,\n\
.textarea {\n\
    font-family: Consolas, Menlo, monospace;\n\
    font-size: smaller;\n\
}\n\
pre {\n\
    overflow-wrap: break-word;\n\
    white-space: pre-wrap;\n\
}\n\
.button {\n\
    background-color: #fff;\n\
    border: 1px solid;\n\
    border-bottom-color: rgb(186, 186, 186);\n\
    border-left-color: rgb(209, 209, 209);\n\
    border-radius: 4px;\n\
    border-right-color: rgb(209, 209, 209);\n\
    border-top-color: rgb(216, 216, 216);\n\
    color: #00d;\n\
    cursor: pointer;\n\
    display: inline-block;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: 12px;\n\
    font-style: normal;\n\
    font-weight: normal;\n\
    margin: 0;\n\
    padding: 2px 7px 3px 7px;\n\
    text-align: center;\n\
    text-decoration: underline;\n\
}\n\
.colorError {\n\
    color: #d00;\n\
}\n\
.textarea {\n\
    background: #fff;\n\
    border: 1px solid #999;\n\
    border-radius: 0;\n\
    cursor: auto;\n\
    overflow: auto;\n\
    padding: 2px;\n\
}\n\
.uiAnimateShake {\n\
    animation-duration: 500ms;\n\
    animation-name: uiAnimateShake;\n\
}\n\
.uiAnimateSlide {\n\
    overflow-y: hidden;\n\
    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n\
}\n\
.utility2FooterDiv {\n\
    text-align: center;\n\
}\n\
.zeroPixel {\n\
    border: 0;\n\
    height: 0;\n\
    margin: 0;\n\
    padding: 0;\n\
    width: 0;\n\
}\n\
</style>\n\
</head>\n\
<body>\n\
<div id="ajaxProgressDiv1" style="background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;"></div>\n\
<div class="uiAnimateSpin" style="animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;"></div>\n\
<a class="zeroPixel" download="db.persistence.json" href="" id="dbExportA1"></a>\n\
<input class="zeroPixel" data-onevent="onEventDomDb" data-onevent-db="dbImportInput" type="file">\n\
<script>\n\
/* jslint utility2:true */\n\
// init domOnEventWindowOnloadTimeElapsed\n\
(function () {\n\
/*\n\
 * this function will measure and print time-elapsed for window.onload\n\
 */\n\
    "use strict";\n\
    if (window.domOnEventWindowOnloadTimeElapsed) {\n\
        return;\n\
    }\n\
    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n\
    window.addEventListener("load", function () {\n\
        setTimeout(function () {\n\
            window.domOnEventWindowOnloadTimeElapsed = (\n\
                Date.now()\n\
                - window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
            console.error(\n\
                "domOnEventWindowOnloadTimeElapsed = "\n\
                + window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
        }, 100);\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventDelegateDict\n\
(function () {\n\
/*\n\
 * this function will handle delegated dom-event\n\
 */\n\
    "use strict";\n\
    var timerTimeoutDict;\n\
    if (window.domOnEventDelegateDict) {\n\
        return;\n\
    }\n\
    window.domOnEventDelegateDict = {};\n\
    timerTimeoutDict = {};\n\
    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n\
        evt.targetOnEvent = evt.target.closest(\n\
            "[data-onevent]"\n\
        );\n\
        if (\n\
            !evt.targetOnEvent\n\
            || evt.targetOnEvent.dataset.onevent === "domOnEventNop"\n\
            || evt.target.closest(\n\
                ".disabled, .readonly"\n\
            )\n\
        ) {\n\
            return;\n\
        }\n\
        // rate-limit high-frequency-event\n\
        switch (evt.type) {\n\
        case "keydown":\n\
        case "keyup":\n\
            // filter non-input keyboard-event\n\
            if (!evt.target.closest(\n\
                "input, option, select, textarea"\n\
            )) {\n\
                return;\n\
            }\n\
            if (timerTimeoutDict[evt.type] !== true) {\n\
                timerTimeoutDict[evt.type] = timerTimeoutDict[\n\
                    evt.type\n\
                ] || setTimeout(function () {\n\
                    timerTimeoutDict[evt.type] = true;\n\
                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n\
                }, 50);\n\
                return;\n\
            }\n\
            timerTimeoutDict[evt.type] = null;\n\
            break;\n\
        }\n\
        switch (evt.targetOnEvent.tagName) {\n\
        case "BUTTON":\n\
        case "FORM":\n\
            evt.preventDefault();\n\
            break;\n\
        }\n\
        evt.stopPropagation();\n\
        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n\
            evt\n\
        );\n\
    };\n\
    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n\
        Array.from(document.querySelectorAll(\n\
            ".onevent-reset-output"\n\
        )).forEach(function (elem) {\n\
            switch (elem.tagName) {\n\
            case "INPUT":\n\
            case "TEXTAREA":\n\
                elem.value = "";\n\
                break;\n\
            case "PRE":\n\
                elem.textContent = "";\n\
                break;\n\
            default:\n\
                elem.innerHTML = "";\n\
            }\n\
        });\n\
    };\n\
    // init event-handling\n\
    [\n\
        "change",\n\
        "click",\n\
        "keydown",\n\
        "submit"\n\
    ].forEach(function (eventType) {\n\
        document.addEventListener(\n\
            eventType,\n\
            window.domOnEventDelegateDict.domOnEventDelegate\n\
        );\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init timerIntervalAjaxProgressUpdate\n\
(function () {\n\
/*\n\
 * this function will increment ajax-progress-bar\n\
 * until webpage has loaded\n\
 */\n\
    "use strict";\n\
    var ajaxProgressDiv1;\n\
    var ajaxProgressState;\n\
    var ajaxProgressUpdate;\n\
    if (\n\
        window.timerIntervalAjaxProgressUpdate\n\
        || !document.querySelector(\n\
            "#ajaxProgressDiv1"\n\
        )\n\
    ) {\n\
        return;\n\
    }\n\
    ajaxProgressDiv1 = document.querySelector(\n\
        "#ajaxProgressDiv1"\n\
    );\n\
    setTimeout(function () {\n\
        ajaxProgressDiv1.style.width = "25%";\n\
    });\n\
    ajaxProgressState = 0;\n\
    ajaxProgressUpdate = (\n\
        window.local\n\
        && window.local.ajaxProgressUpdate\n\
    ) || function () {\n\
        ajaxProgressDiv1.style.width = "100%";\n\
        setTimeout(function () {\n\
            ajaxProgressDiv1.style.background = "transparent";\n\
            setTimeout(function () {\n\
                ajaxProgressDiv1.style.width = "0%";\n\
            }, 500);\n\
        }, 1000);\n\
    };\n\
    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n\
        ajaxProgressState += 1;\n\
        ajaxProgressDiv1.style.width = Math.max(\n\
            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n\
            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n\
        ) + "%";\n\
    }, 1000);\n\
    window.addEventListener("load", function () {\n\
        clearInterval(window.timerIntervalAjaxProgressUpdate);\n\
        ajaxProgressUpdate();\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventSelectAllWithinPre\n\
(function () {\n\
/*\n\
 * this function will limit select-all within <pre tabIndex="0"> elements\n\
 * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n\
 */\n\
    "use strict";\n\
    if (window.domOnEventSelectAllWithinPre) {\n\
        return;\n\
    }\n\
    window.domOnEventSelectAllWithinPre = function (evt) {\n\
        var range;\n\
        var selection;\n\
        if (\n\
            evt\n\
            && evt.key === "a"\n\
            && (evt.ctrlKey || evt.metaKey)\n\
            && evt.target.closest(\n\
                "pre"\n\
            )\n\
        ) {\n\
            range = document.createRange();\n\
            range.selectNodeContents(evt.target.closest(\n\
                "pre"\n\
            ));\n\
            selection = window.getSelection();\n\
            selection.removeAllRanges();\n\
            selection.addRange(range);\n\
            evt.preventDefault();\n\
        }\n\
    };\n\
    // init event-handling\n\
    document.addEventListener(\n\
        "keydown",\n\
        window.domOnEventSelectAllWithinPre\n\
    );\n\
}());\n\
</script>\n\
<h1>\n\
<!-- utility2-comment\n\
    <a\n\
        {{#if env.npm_package_homepage}}\n\
        href="{{env.npm_package_homepage}}"\n\
        {{/if env.npm_package_homepage}}\n\
        target="_blank"\n\
    >\n\
utility2-comment -->\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\n\
<!-- utility2-comment\n\
    </a>\n\
utility2-comment -->\n\
</h1>\n\
<h3>{{env.npm_package_description}}</h3>\n\
<!-- utility2-comment\n\
<a class="button" download href="assets.app.js">download standalone app</a><br>\n\
<button class="button" data-onevent="testRunBrowser" data-onevent-reset-output="1" id="testRunButton1">run internal test</button><br>\n\
<div class="uiAnimateSlide" id="testReportDiv1" style="border-bottom: 0; border-top: 0; margin-bottom: 0; margin-top: 0; max-height: 0; padding-bottom: 0; padding-top: 0;"></div>\n\
utility2-comment -->\n\
\n\
\n\
\n\
<label>stderr and stdout</label>\n\
<pre class="onevent-reset-output readonly textarea" id="outputStdout1" tabIndex="0"></pre>\n\
<!-- utility2-comment\n\
{{#if isRollup}}\n\
<script src="assets.app.js"></script>\n\
{{#unless isRollup}}\n\
utility2-comment -->\n\
<script src="assets.utility2.rollup.js"></script>\n\
<script>window.utility2_onReadyBefore.counter += 1;</script>\n\
<script src="jsonp.utility2.stateInit?callback=window.utility2.stateInit"></script>\n\
<script src="assets.{{packageJson.nameLib}}.js"></script>\n\
<script src="assets.example.js"></script>\n\
<script src="assets.test.js"></script>\n\
<script>window.utility2_onReadyBefore();</script>\n\
<!-- utility2-comment\n\
{{/if isRollup}}\n\
utility2-comment -->\n\
<div class="utility2FooterDiv">\n\
    [ this app was created with\n\
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>\n\
    ]\n\
</div>\n\
</body>\n\
</html>\n\
';



/* validateLineSortedReset */
// https://img.shields.io/badge/last_build-0000_00_00_00_00_00_UTC_--_master_--_aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa-0077ff.svg?style=flat
local.assetsDict["/assets.buildBadge.template.svg"] =
'<svg xmlns="http://www.w3.org/2000/svg" width="563" height="20"><linearGradient id="a" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><rect rx="0" width="563" height="20" fill="#555"/><rect rx="0" x="61" width="502" height="20" fill="#07f"/><path fill="#07f" d="M61 0h4v20h-4z"/><rect rx="0" width="563" height="20" fill="url(#a)"/><g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11"><text x="31.5" y="15" fill="#010101" fill-opacity=".3">last build</text><text x="31.5" y="14">last build</text><text x="311" y="15" fill="#010101" fill-opacity=".3">0000-00-00 00:00:00 UTC - master - aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</text><text x="311" y="14">0000-00-00 00:00:00 UTC - master - aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</text></g></svg>';



local.assetsDict["/assets.example.begin.js"] = '\
(function (globalThis) {\n\
    "use strict";\n\
    var consoleError;\n\
    var local;\n\
    // init globalThis\n\
    (function () {\n\
        try {\n\
            globalThis = Function("return this")(); // jslint ignore:line\n\
        } catch (ignore) {}\n\
    }());\n\
    globalThis.globalThis = globalThis;\n\
    // init debug_inline\n\
    if (!globalThis["debug\\u0049nline"]) {\n\
        consoleError = console.error;\n\
        globalThis["debug\\u0049nline"] = function () {\n\
        /*\n\
         * this function will both print <arguments> to stderr\n\
         * and return <arguments>[0]\n\
         */\n\
            var argList;\n\
            argList = Array.from(arguments); // jslint ignore:line\n\
            // debug arguments\n\
            globalThis["debug\\u0049nlineArguments"] = argList;\n\
            consoleError("\\n\\ndebug\\u0049nline");\n\
            consoleError.apply(console, argList);\n\
            consoleError("\\n");\n\
            // return arg0 for inspection\n\
            return argList[0];\n\
        };\n\
    }\n\
    // init local\n\
    local = {};\n\
    local.local = local;\n\
    globalThis.globalLocal = local;\n\
    // init isBrowser\n\
    local.isBrowser = (\n\
        typeof window === "object"\n\
        && window === globalThis\n\
        && typeof window.XMLHttpRequest === "function"\n\
        && window.document\n\
        && typeof window.document.querySelector === "function"\n\
    );\n\
    // init function\n\
    local.assertThrow = function (passed, message) {\n\
    /*\n\
     * this function will throw err.<message> if <passed> is falsy\n\
     */\n\
        var err;\n\
        if (passed) {\n\
            return;\n\
        }\n\
        err = (\n\
            // ternary-operator\n\
            (\n\
                message\n\
                && typeof message.message === "string"\n\
                && typeof message.stack === "string"\n\
            )\n\
            // if message is errObj, then leave as is\n\
            ? message\n\
            : new Error(\n\
                typeof message === "string"\n\
                // if message is a string, then leave as is\n\
                ? message\n\
                // else JSON.stringify message\n\
                : JSON.stringify(message, null, 4)\n\
            )\n\
        );\n\
        throw err;\n\
    };\n\
    local.functionOrNop = function (fnc) {\n\
    /*\n\
     * this function will if <fnc> exists,\n\
     * them return <fnc>,\n\
     * else return <nop>\n\
     */\n\
        return fnc || local.nop;\n\
    };\n\
    local.identity = function (value) {\n\
    /*\n\
     * this function will return <value>\n\
     */\n\
        return value;\n\
    };\n\
    local.nop = function () {\n\
    /*\n\
     * this function will do nothing\n\
     */\n\
        return;\n\
    };\n\
    local.objectAssignDefault = function (target, source) {\n\
    /*\n\
     * this function will if items from <target> are\n\
     * null, undefined, or empty-string,\n\
     * then overwrite them with items from <source>\n\
     */\n\
        target = target || {};\n\
        Object.keys(source || {}).forEach(function (key) {\n\
            if (\n\
                target[key] === null\n\
                || target[key] === undefined\n\
                || target[key] === ""\n\
            ) {\n\
                target[key] = target[key] || source[key];\n\
            }\n\
        });\n\
        return target;\n\
    };\n\
    // require builtin\n\
    if (!local.isBrowser) {\n\
        local.assert = require("assert");\n\
        local.buffer = require("buffer");\n\
        local.child_process = require("child_process");\n\
        local.cluster = require("cluster");\n\
        local.crypto = require("crypto");\n\
        local.dgram = require("dgram");\n\
        local.dns = require("dns");\n\
        local.domain = require("domain");\n\
        local.events = require("events");\n\
        local.fs = require("fs");\n\
        local.http = require("http");\n\
        local.https = require("https");\n\
        local.net = require("net");\n\
        local.os = require("os");\n\
        local.path = require("path");\n\
        local.querystring = require("querystring");\n\
        local.readline = require("readline");\n\
        local.repl = require("repl");\n\
        local.stream = require("stream");\n\
        local.string_decoder = require("string_decoder");\n\
        local.timers = require("timers");\n\
        local.tls = require("tls");\n\
        local.tty = require("tty");\n\
        local.url = require("url");\n\
        local.util = require("util");\n\
        local.vm = require("vm");\n\
        local.zlib = require("zlib");\n\
    }\n\
}(this));\n\
'



local.assetsDict["/assets.example.html"] = "";



local.assetsDict["/assets.example.template.js"] = '\
/*\n\
example.js\n\
\n\
this script will run a web-demo of my-app-lite\n\
\n\
instruction\n\
    1. save this script as example.js\n\
    2. run shell-command:\n\
        $ npm install my-app-lite && PORT=8081 node example.js\n\
    3. open a browser to http://127.0.0.1:8081 and play with web-demo\n\
    4. edit this script to suit your needs\n\
*/\n\
\n\
\n\
\n\
/* istanbul instrument in package my_app */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function (local) {\n\
"use strict";\n\
\n\
\n\
\n\
// run shared js\-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2_rollup\n\
    || globalThis.utility2_my_app\n\
    || require("my-app-lite")\n\
);\n\
// init exports\n\
globalThis.local = local;\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run browser js\-env code - init-test\n\
(function () {\n\
if (!local.isBrowser) {\n\
    return;\n\
}\n\
// log stderr and stdout to #outputStdout1\n\
["error", "log"].forEach(function (key) {\n\
    var argList;\n\
    var elem;\n\
    var fnc;\n\
    elem = document.querySelector(\n\
        "#outputStdout1"\n\
    );\n\
    if (!elem) {\n\
        return;\n\
    }\n\
    fnc = console[key];\n\
    console[key] = function () {\n\
        argList = Array.from(arguments); // jslint ignore:line\n\
        fnc.apply(console, argList);\n\
        // append text to #outputStdout1\n\
        elem.textContent += argList.map(function (arg) {\n\
            return (\n\
                typeof arg === "string"\n\
                ? arg\n\
                : JSON.stringify(arg, null, 4)\n\
            );\n\
        }).join(" ").replace((\n\
            /\\u001b\\[\\d*m/g\n\
        ), "") + "\\n";\n\
        // scroll textarea to bottom\n\
        elem.scrollTop = elem.scrollHeight;\n\
    };\n\
});\n\
Object.assign(local, globalThis.domOnEventDelegateDict);\n\
globalThis.domOnEventDelegateDict = local;\n\
local.onEventDomDb = (\n\
    local.db && local.db.onEventDomDb\n\
);\n\
local.testRunBrowser = function (evt) {\n\
/*\n\
 * this function will run browser-tests\n\
 */\n\
    switch (\n\
        !evt.ctrlKey\n\
        && !evt.metaKey\n\
        && (\n\
            evt.modeInit\n\
            || (evt.type + "." + (evt.target && evt.target.id))\n\
        )\n\
    ) {\n\
    // custom-case\n\
    case true:\n\
        return;\n\
    // run browser-tests\n\
    default:\n\
        if (\n\
            (evt.target && evt.target.id) !== "testRunButton1"\n\
            && !(evt.modeInit && (\n\
                /\\bmodeTest=1\\b/\n\
            ).test(location.search))\n\
        ) {\n\
            return;\n\
        }\n\
        // show browser-tests\n\
        if (document.querySelector(\n\
            "#testReportDiv1"\n\
        ).style.maxHeight === "0px") {\n\
            globalThis.domOnEventDelegateDict.domOnEventResetOutput();\n\
            local.uiAnimateSlideDown(document.querySelector(\n\
                "#testReportDiv1"\n\
            ));\n\
            document.querySelector(\n\
                "#testRunButton1"\n\
            ).textContent = "hide internal test";\n\
            local.modeTest = 1;\n\
            local.testRunDefault(local);\n\
            return;\n\
        }\n\
        // hide browser-tests\n\
        local.uiAnimateSlideUp(document.querySelector(\n\
            "#testReportDiv1"\n\
        ));\n\
        document.querySelector(\n\
            "#testRunButton1"\n\
        ).textContent = "run internal test";\n\
    }\n\
};\n\
\n\
local.testRunBrowser({\n\
    modeInit: true\n\
});\n\
}());\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run node js\-env code - init-test\n\
(function () {\n\
if (local.isBrowser) {\n\
    return;\n\
}\n\
// init exports\n\
module.exports = local;\n\
/* validateLineSortedReset */\n\
// init assets\n\
local.assetsDict = local.assetsDict || {};\n\
[\n\
    "assets.index.template.html",\n\
    "assets.swgg.swagger.json",\n\
    "assets.swgg.swagger.server.json"\n\
].forEach(function (file) {\n\
    file = "/" + file;\n\
    local.assetsDict[file] = local.assetsDict[file] || "";\n\
    if (local.fs.existsSync(local.__dirname + file)) {\n\
        local.assetsDict[file] = local.fs.readFileSync(\n\
            local.__dirname + file,\n\
            "utf8"\n\
        );\n\
    }\n\
});\n\
/* jslint ignore:start */\n\
local.assetsDict["/assets.index.template.html"] = \'\\\n\
' + local.assetsDict["/assets.index.template.html"].replace((/\n/g), "\\n\\\n") + '\';\n\
/* jslint ignore:end */\n\
/* validateLineSortedReset */\n\
/* jslint ignore:start */\n\
local.assetsDict["/assets.my_app.js"] =\n\
    local.assetsDict["/assets.my_app.js"] ||\n\
    local.fs.readFileSync(local.__dirname + "/lib.my_app.js", "utf8"\n\
).replace((/^#!\\//), "// ");\n\
/* jslint ignore:end */\n\
/* validateLineSortedReset */\n\
local.assetsDict["/"] = local.assetsDict["/assets.index.template.html"]\n\
.replace((\n\
    /\\{\\{env\\.(\\w+?)\\}\\}/g\n\
), function (match0, match1) {\n\
    switch (match1) {\n\
    case "npm_package_description":\n\
        return "the greatest app in the world!";\n\
    case "npm_package_name":\n\
        return "my-app-lite";\n\
    case "npm_package_nameLib":\n\
        return "my_app";\n\
    case "npm_package_version":\n\
        return "0.0.1";\n\
    default:\n\
        return match0;\n\
    }\n\
});\n\
local.assetsDict["/assets.example.html"] = local.assetsDict["/"];\n\
local.assetsDict["/index.html"] = local.assetsDict["/"];\n\
// init cli\n\
if (module !== require.main || globalThis.utility2_rollup) {\n\
    return;\n\
}\n\
/* validateLineSortedReset */\n\
local.assetsDict["/assets.example.js"] = (\n\
    local.assetsDict["/assets.example.js"]\n\
    || local.fs.readFileSync(__filename, "utf8")\n\
);\n\
local.assetsDict["/favicon.ico"] = local.assetsDict["/favicon.ico"] || "";\n\
// if $npm_config_timeout_exit exists,\n\
// then exit this process after $npm_config_timeout_exit ms\n\
if (Number(process.env.npm_config_timeout_exit)) {\n\
    setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\n\
}\n\
// start server\n\
if (globalThis.utility2_serverHttp1) {\n\
    return;\n\
}\n\
process.env.PORT = process.env.PORT || "8081";\n\
console.error("http-server listening on port " + process.env.PORT);\n\
local.http.createServer(function (req, res) {\n\
    req.urlParsed = local.url.parse(req.url);\n\
    if (local.assetsDict[req.urlParsed.pathname] !== undefined) {\n\
        res.end(local.assetsDict[req.urlParsed.pathname]);\n\
        return;\n\
    }\n\
    res.statusCode = 404;\n\
    res.end();\n\
}).listen(process.env.PORT);\n\
}());\n\
\n\
\n\
\n\
}());\n\
';



local.assetsDict["/assets.my_app.template.js"] = '\
#!/usr/bin/env node\n\
/*\n\
 * lib.my_app.js ({{packageJson.version}})\n\
 * https://github.com/kaizhu256/node-my-app-lite\n\
 * {{packageJson.description}}\n\
 *\n\
 */\n\
\n\
\n\
\n\
/* istanbul instrument in package my_app */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function (local) {\n\
"use strict";\n\
\n\
\n\
\n\
/* istanbul ignore next */\n\
// run shared js\-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2_rollup\n\
    // || globalThis.utility2_rollup_old\n\
    // || require("./assets.utility2.rollup.js")\n\
    || globalThis.globalLocal\n\
);\n\
// init exports\n\
if (local.isBrowser) {\n\
    globalThis.utility2_my_app = local;\n\
} else {\n\
    module.exports = local;\n\
    module.exports.__dirname = __dirname;\n\
}\n\
// init lib main\n\
local.my_app = local;\n\
\n\
\n\
\n\
/* validateLineSortedReset */\n\
return;\n\
}());\n\
\n\
\n\
\n\
}());\n\
';



local.assetsDict["/assets.readme.template.md"] = '\
# my-app-lite\n\
the greatest app in the world!\n\
\n\
# live web demo\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app)\n\
\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app)\n\
\n\
\n\
\n\
[![travis-ci.org build-status](https://api.travis-ci.org/kaizhu256/node-my-app-lite.svg)](https://travis-ci.org/kaizhu256/node-my-app-lite) [![coverage](https://kaizhu256.github.io/node-my-app-lite/build/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build/coverage.html/index.html)\n\
\n\
[![NPM](https://nodei.co/npm/my-app-lite.png?downloads=true)](https://www.npmjs.com/package/my-app-lite)\n\
\n\
[![build commit status](https://kaizhu256.github.io/node-my-app-lite/build/build.badge.svg)](https://travis-ci.org/kaizhu256/node-my-app-lite)\n\
\n\
| git-branch : | [master](https://github.com/kaizhu256/node-my-app-lite/tree/master) | [beta](https://github.com/kaizhu256/node-my-app-lite/tree/beta) | [alpha](https://github.com/kaizhu256/node-my-app-lite/tree/alpha)|\n\
|--:|:--|:--|:--|\n\
| test-server-github : | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/app) | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app) | [![github.com test-server](https://kaizhu256.github.io/node-my-app-lite/GitHub-Mark-32px.png)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/app)|\n\
| test-server-heroku : | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-master.herokuapp.com) | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-beta.herokuapp.com) | [![heroku.com test-server](https://kaizhu256.github.io/node-my-app-lite/heroku-logo.75x25.png)](https://h1-my-app-alpha.herokuapp.com)|\n\
| test-report : | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/test-report.html) | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/test-report.html) | [![test-report](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/test-report.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/test-report.html)|\n\
| coverage : | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..master..travis-ci.org/coverage.html/index.html) | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/coverage.html/index.html) | [![coverage](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/coverage.badge.svg)](https://kaizhu256.github.io/node-my-app-lite/build..alpha..travis-ci.org/coverage.html/index.html)|\n\
| build-artifacts : | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..master..travis-ci.org) | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..beta..travis-ci.org) | [![build-artifacts](https://kaizhu256.github.io/node-my-app-lite/glyphicons_144_folder_open.png)](https://github.com/kaizhu256/node-my-app-lite/tree/gh-pages/build..alpha..travis-ci.org)|\n\
\n\
[![npmPackageListing](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageListing.svg)](https://github.com/kaizhu256/node-my-app-lite)\n\
\n\
![npmPackageDependencyTree](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageDependencyTree.svg)\n\
\n\
\n\
\n\
# table of contents\n\
\n\
\n\
\n\
# cdn download\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.my_app.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.my_app.js)\n\
\n\
\n\
\n\
# documentation\n\
#### cli help\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmPackageCliHelp.svg)\n\
\n\
#### api doc\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html)\n\
\n\
[![apidoc](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/apidoc.html)\n\
\n\
#### swagger doc\n\
- [https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html)\n\
\n\
[![swaggerdoc](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.swgg.html)\n\
\n\
#### todo\n\
- none\n\
\n\
#### changelog 0.0.1\n\
- npm publish 0.0.1\n\
- update build\n\
- none\n\
\n\
#### this package requires\n\
- darwin or linux os\n\
\n\
\n\
\n\
# quickstart standalone app\n\
#### to run this example, follow instruction in script below\n\
- [assets.app.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.app.js)\n\
```shell\n\
# example.sh\n\
\n\
# this shell script will download and run a web-demo of my-app-lite as a standalone app\n\
\n\
# 1. download standalone app\n\
curl -O https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/app/assets.app.js\n\
# 2. run standalone app\n\
PORT=8081 node ./assets.app.js\n\
# 3. open a browser to http://127.0.0.1:8081 and play with web-demo\n\
# 4. edit file assets.app.js to suit your needs\n\
```\n\
\n\
#### output from browser\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\n\
\n\
#### output from shell\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.svg)\n\
\n\
\n\
\n\
# quickstart example.js\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\n\
\n\
#### to run this example, follow instruction in script below\n\
- [example.js](https://kaizhu256.github.io/node-my-app-lite/build..beta..travis-ci.org/example.js)\n\
```javascript\n' + local.assetsDict["/assets.example.template.js"] + '```\n\
\n\
#### output from browser\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/app/assets.example.html)\n\
\n\
#### output from shell\n\
![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.svg)\n\
\n\
\n\
\n\
# extra screenshots\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fapidoc.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Fcoverage.lib.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.buildCi.browser.%252Ftmp%252Fbuild%252Ftest-report.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp%252Fassets.swgg.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithub.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployGithubTest.browser.%252Fnode-my-app-lite%252Fbuild%252Fapp.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252Fassets.swgg.html.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHeroku.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.deployHerokuTest.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.npmTest.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleJs.browser.%252F.png)\n\
\n\
1. [https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.testExampleSh.browser.%252F.png)\n\
\n\
\n\
\n\
# package.json\n\
```json\n\
{\n\
    "author": "kai zhu <kaizhu256@gmail.com>",\n\
    "description": "the greatest app in the world!",\n\
    "devDependencies": {\n\
        "electron-lite": "kaizhu256/node-electron-lite#alpha",\n\
        "utility2": "kaizhu256/node-utility2#alpha"\n\
    },\n\
    "engines": {\n\
        "node": ">=10.0"\n\
    },\n\
    "homepage": "https://github.com/kaizhu256/node-my-app-lite",\n\
    "keywords": [],\n\
    "license": "MIT",\n\
    "main": "lib.my_app.js",\n\
    "name": "my-app-lite",\n\
    "nameAliasPublish": "",\n\
    "os": [\n\
        "darwin",\n\
        "linux"\n\
    ],\n\
    "repository": {\n\
        "type": "git",\n\
        "url": "https://github.com/kaizhu256/node-my-app-lite.git"\n\
    },\n\
    "scripts": {\n\
        "build-ci": "sh ./npm_scripts.sh",\n\
        "env": "env",\n\
        "eval": "sh ./npm_scripts.sh",\n\
        "heroku-postbuild": "sh ./npm_scripts.sh",\n\
        "postinstall": "sh ./npm_scripts.sh",\n\
        "start": "sh ./npm_scripts.sh",\n\
        "test": "sh ./npm_scripts.sh",\n\
        "utility2": "sh ./npm_scripts.sh"\n\
    },\n\
    "version": "0.0.1"\n\
}\n\
```\n\
\n\
\n\
\n\
# changelog of last 50 commits\n\
[![screenshot](https://kaizhu256.github.io/node-my-app-lite/build/screenshot.gitLog.svg)](https://github.com/kaizhu256/node-my-app-lite/commits)\n\
\n\
\n\
\n\
# internal build script\n\
- build_ci.sh\n\
```shell\n\
# build_ci.sh\n\
\n\
# this shell script will run the build for this package\n\
\n\
shBuildCiAfter () {(set -e\n\
    # shDeployCustom\n\
    shDeployGithub\n\
    # shDeployHeroku\n\
    shReadmeTest example.sh\n\
)}\n\
\n\
shBuildCiBefore () {(set -e\n\
    # shNpmTestPublished\n\
    shReadmeTest example.js\n\
)}\n\
\n\
# run shBuildCi\n\
eval "$(utility2 source)"\n\
shBuildCi\n\
```\n\
\n\
\n\
\n\
# misc\n\
- this package was created with [utility2](https://github.com/kaizhu256/node-utility2)\n\
';



local.assetsDict["/assets.test.template.js"] = '\
/* istanbul instrument in package my_app */\n\
/* istanbul ignore next */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function (local) {\n\
"use strict";\n\
\n\
\n\
\n\
// run shared js\-env code - init-before\n\
(function () {\n\
// init local\n\
local = (\n\
    globalThis.utility2 || require("utility2")\n\
).requireReadme();\n\
globalThis.local = local;\n\
// init test\n\
local.testRunDefault(local);\n\
}());\n\
\n\
\n\
\n\
// run shared js\-env code - function\n\
(function () {\n\
return;\n\
}());\n\
\n\
\n\
\n\
}());\n\
';



local.assetsDict["/assets.testReport.template.html"] =
    local.assetsDict["/assets.utility2.template.html"]
    .replace("assets.utility2.template.html", "")
    .replace((/<title>.*?<\/title>/), "<title>test-report</title>")
    .replace("</style>\n", '\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
*/\n\
.testReportDiv img {\n\
    border: 1px solid black;\n\
    margin: 5px 0 5px 0;\n\
    max-height: 256px;\n\
    max-width: 512px;\n\
}\n\
.testReportDiv pre {\n\
    background: #fdd;\n\
    border-top: 1px solid black;\n\
    margin-bottom: 0;\n\
    padding: 10px;\n\
}\n\
.testReportDiv span {\n\
    display: inline-block;\n\
    width: 120px;\n\
}\n\
.testReportDiv table {\n\
    border-top: 1px solid black;\n\
    text-align: left;\n\
    width: 100%;\n\
}\n\
.testReportDiv table > tbody > tr:nth-child(odd) {\n\
    background: #bfb;\n\
}\n\
.testReportDiv .displayNone {\n\
    display: none;\n\
}\n\
.testReportDiv .footer {\n\
    text-align: center;\n\
}\n\
.testReportDiv .platform {\n\
    background: #fff;\n\
    border: 1px solid black;\n\
    margin-bottom: 20px;\n\
    padding: 0 10px 10px 10px;\n\
    text-align: left;\n\
}\n\
.testReportDiv .summary {\n\
    background: #bfb;\n\
}\n\
.testReportDiv .testFailed {\n\
    background: #f99;\n\
}\n\
.testReportDiv .testPending {\n\
    background: #99f;\n\
}\n\
</style>\n\
'.replace("<style>\n", "")).replace((/<\/script>[\S\s]*?<\/body>/), '\
</script>\n\
<div class="testReportDiv">\n\
<h1>test-report for\n\
    <a\n\
        {{#if env.npm_package_homepage}}\n\
        href="{{env.npm_package_homepage}}"\n\
        {{/if env.npm_package_homepage}}\n\
    >\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\n\
    </a>\n\
</h1>\n\
<div class="platform summary">\n\
<h2>summary</h2>\n\
<h4>\n\
    <span>version</span>-\n\
        {{env.npm_package_version}}<br>\n\
    <span>test date</span>- {{date}}<br>\n\
    <span>commit info</span>-\n\
        {{#if env.CI_COMMIT_INFO}}\n\
        {{env.CI_COMMIT_INFO}}<br>\n\
        {{#unless env.CI_COMMIT_INFO}}\n\
        undefined<br>\n\
        {{/if env.CI_COMMIT_INFO}}\n\
</h4>\n\
<table>\n\
<thead>\n\
    <tr>\n\
        <th>total time-elapsed</th>\n\
        <th>total tests failed</th>\n\
        <th>total tests passed</th>\n\
        <th>total tests pending</th>\n\
    </tr>\n\
</thead>\n\
<tbody><tr>\n\
    <td>{{timeElapsed}} ms</td>\n\
    <td class="{{testStatusClass}}">{{testsFailed}}</td>\n\
    <td>{{testsPassed}}</td>\n\
    <td>{{testsPending}}</td>\n\
</tr></tbody>\n\
</table>\n\
</div>\n\
{{#each testPlatformList}}\n\
<div class="platform">\n\
<h4>\n\
    {{testPlatformNumber}}. {{name}}<br>\n\
    {{#if screenshot}}\n\
    <a href="{{screenshot encodeURIComponent}}">\n\
        <img alt="{{screenshot encodeURIComponent}}" src="{{screenshot encodeURIComponent}}">\n\
    </a>\n\
    <br>\n\
    {{/if screenshot}}\n\
    {{#if domOnEventWindowOnloadTimeElapsed}}\n\
    <span>onload-time</span>- {{domOnEventWindowOnloadTimeElapsed}} ms<br>\n\
    {{/if domOnEventWindowOnloadTimeElapsed}}\n\
    <span>time-elapsed</span>- {{timeElapsed}} ms<br>\n\
    <span>tests failed</span>- {{testsFailed}}<br>\n\
    <span>tests passed</span>- {{testsPassed}}<br>\n\
    <span>tests pending</span>- {{testsPending}}<br>\n\
</h4>\n\
<table>\n\
<thead><tr>\n\
    <th>#</th>\n\
    <th>time-elapsed</th>\n\
    <th>status</th>\n\
    <th>test-case</th>\n\
</tr></thead>\n\
<tbody>\n\
{{#each testCaseList}}\n\
<tr>\n\
    <td>{{testCaseNumber}}</td>\n\
    <td>{{timeElapsed}} ms</td>\n\
    <td class="{{testReportTestStatusClass}}">{{status}}</td>\n\
    <td>{{name}}</td>\n\
</tr>\n\
{{/each testCaseList}}\n\
</tbody>\n\
</table>\n\
<pre class="{{preClass}}" tabIndex="0">\n\
{{#each errorStackList}}\n\
{{errorStack}}\n\
{{/each errorStackList}}\n\
</pre>\n\
</div>\n\
{{/each testPlatformList}}\n\
<div class="footer">\n\
    [ this document was created with\n\
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>\n\
    ]\n\
</div>\n\
</div>\n\
</body>');



// https://img.shields.io/badge/tests_failed-999-dd0000.svg?style=flat
local.assetsDict["/assets.testReportBadge.template.svg"] =
'<svg xmlns="http://www.w3.org/2000/svg" width="103" height="20"><linearGradient id="a" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><rect rx="0" width="103" height="20" fill="#555"/><rect rx="0" x="72" width="31" height="20" fill="#d00"/><path fill="#d00" d="M72 0h4v20h-4z"/><rect rx="0" width="103" height="20" fill="url(#a)"/><g fill="#fff" text-anchor="middle" font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11"><text x="37" y="15" fill="#010101" fill-opacity=".3">tests failed</text><text x="37" y="14">tests failed</text><text x="86.5" y="15" fill="#010101" fill-opacity=".3">999</text><text x="86.5" y="14">999</text></g></svg>';



local.assetsDict["/assets.utility2.rollup.begin.js"] = '\
/* utility2.rollup.js begin */\n\
/* istanbul ignore all */\n\
/* jslint utility2:true */\n\
' + local.assetsDict["/assets.example.begin.js"] + '\
\n\
\n\
\n\
(function () {\n\
    "use strict";\n\
    // init utility2_rollup\n\
    globalThis.utility2_rollup = (\n\
        globalThis.utility2_rollup_old\n\
        || globalThis.globalLocal\n\
    );\n\
    globalThis.utility2_rollup.local = globalThis.utility2_rollup;\n\
    globalThis.utility2_rollup_old = null;\n\
}());\n\
';



local.assetsDict["/assets.utility2.rollup.content.js"] = '\
(function (local) {\n\
    "use strict";\n\
/* jslint ignore:start */\n\
/* utility2.rollup.js content */\n\
/* jslint ignore:end */\n\
    return local;\n\
}(globalThis.utility2_rollup));\n\
';



local.assetsDict["/assets.utility2.rollup.end.js"] = '\
(function () {\n\
    "use strict";\n\
    globalThis.utility2_rollup_old = globalThis.utility2_rollup;\n\
    globalThis.utility2_rollup = null;\n\
}());\n\
/* utility2.rollup.js end */\n\
';



local.assetsDict["/favicon.ico"] = "";
/* jslint ignore:end */



local.cliDict = {};

local.cliDict["utility2.browserTest"] = function () {
/*
 * <urlList> <mode>
 * will browser-test in parallel, comma-separated <urlList> with given <mode>
 */
    process.argv[3].split(
        process.argv[3].indexOf("?") >= 0
        ? (
            /\s/g
        )
        : (
            /[,\s]/g
        )
    ).filter(local.identity).forEach(function (url) {
        local.browserTest({
            url
        }, local.onErrorDefault);
    });
};

local.cliDict["utility2.githubCrudContentDelete"] = function () {
/*
 * <fileRemote|dirRemote> <commitMessage>
 * will delete from github <fileRemote|dirRemote>
 */
    local.github_crud.githubCrudContentDelete({
        message: process.argv[4],
        url: process.argv[3]
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudContentGet"] = function () {
/*
 * <fileRemote>
 * will get from github <fileRemote>
 */
    local.github_crud.githubCrudContentGet({
        url: process.argv[3]
    }, function (err, data) {
        try {
            process.stdout.write(data);
        } catch (ignore) {}
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudContentPut"] = function () {
/*
 * <fileRemote> <fileLocal> <commitMessage>
 * will put on github <fileRemote>, <fileLocal>
 */
    local.github_crud.githubCrudContentPutFile({
        message: process.argv[5],
        url: process.argv[3],
        file: process.argv[4]
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudContentTouch"] = function () {
/*
 * <fileRemoteList> <commitMessage>
 * will touch on github in parallel, comma-separated <fileRemoteList>
 */
    local.github_crud.githubCrudContentTouchList({
        message: process.argv[4],
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudRepoCreate"] = function () {
/*
 * <repoList>
 * will create on github in parallel, comma-separated <repoList>
 */
    local.github_crud.githubCrudRepoCreateList({
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.githubCrudRepoDelete"] = function () {
/*
 * <repoList>
 * will delete from github in parallel, comma-separated <repoList>
 */
    local.github_crud.githubCrudRepoDeleteList({
        urlList: process.argv[3].split(
            /[,\s]/g
        ).filter(local.identity)
    }, function (err) {
        process.exit(Boolean(err));
    });
};

local.cliDict["utility2.start"] = function () {
/*
 * <port>
 * will start utility2 http-server on given <port> (default 8081)
 */
    local.env.PORT = process.argv[3] || local.env.PORT;
    globalThis.local = local;
    local.replStart();
    local.testRunServer({});
};

local.cliDict["utility2.swaggerValidateFile"] = function () {
/*
 * <file/url>
 * will swagger-validate file/url
 */
    setTimeout(function () {
        local.swgg.swaggerValidateFile({
            file: process.argv[3]
        }, function (err, data) {
            console.error(data);
            process.exit(err);
        });
    });
};

local.cliDict["utility2.testReportCreate"] = function () {
/*
 *
 * will create test-report
 */
    local.exit(
        local.testReportCreate(
            JSON.parse(local.fs.readFileSync(
                local.env.npm_config_dir_build + "/test-report.json"
            ))
        ).testsFailed
    );
};
}());



/* istanbul ignore next */
// run shared js-env code - polyfill
(function () {
    var ArrayPrototypeFlat;
    var TextXxcoder;
    ArrayPrototypeFlat = function (depth) {
    /*
     * this function will polyfill Array.prototype.flat
     * https://github.com/jonathantneal/array-flat-polyfill
     */
        depth = (
            globalThis.isNaN(depth)
            ? 1
            : Number(depth)
        );
        if (!depth) {
            return Array.prototype.slice.call(this);
        }
        return Array.prototype.reduce.call(this, function (acc, cur) {
            if (Array.isArray(cur)) {
                // recurse
                acc.push.apply(acc, ArrayPrototypeFlat.call(cur, depth - 1));
            } else {
                acc.push(cur);
            }
            return acc;
        }, []);
    };
    Array.prototype.flat = Array.prototype.flat || ArrayPrototypeFlat;
    Array.prototype.flatMap = Array.prototype.flatMap || function flatMap(
        ...argList
    ) {
    /*
     * this function will polyfill Array.prototype.flatMap
     * https://github.com/jonathantneal/array-flat-polyfill
     */
        return this.map(...argList).flat();
    };
    if (!local.isBrowser) {
        globalThis.TextDecoder = (
            globalThis.TextDecoder || require("util").TextDecoder
        );
        globalThis.TextEncoder = (
            globalThis.TextEncoder || require("util").TextEncoder
        );
    }
    TextXxcoder = function () {
    /*
     * this function will polyfill TextDecoder/TextEncoder
     * https://gist.github.com/Yaffle/5458286
     */
        return;
    };
    TextXxcoder.prototype.decode = function (octets) {
    /*
     * this function will polyfill TextDecoder.prototype.decode
     * https://gist.github.com/Yaffle/5458286
     */
        var bytesNeeded;
        var codePoint;
        var ii;
        var kk;
        var octet;
        var string;
        string = "";
        ii = 0;
        while (ii < octets.length) {
            octet = octets[ii];
            bytesNeeded = 0;
            codePoint = 0;
            if (octet <= 0x7F) {
                bytesNeeded = 0;
                codePoint = octet & 0xFF;
            } else if (octet <= 0xDF) {
                bytesNeeded = 1;
                codePoint = octet & 0x1F;
            } else if (octet <= 0xEF) {
                bytesNeeded = 2;
                codePoint = octet & 0x0F;
            } else if (octet <= 0xF4) {
                bytesNeeded = 3;
                codePoint = octet & 0x07;
            }
            if (octets.length - ii - bytesNeeded > 0) {
                kk = 0;
                while (kk < bytesNeeded) {
                    octet = octets[ii + kk + 1];
                    codePoint = (codePoint << 6) | (octet & 0x3F);
                    kk += 1;
                }
            } else {
                codePoint = 0xFFFD;
                bytesNeeded = octets.length - ii;
            }
            string += String.fromCodePoint(codePoint);
            ii += bytesNeeded + 1;
        }
        return string;
    };
    TextXxcoder.prototype.encode = function (string) {
    /*
     * this function will polyfill TextEncoder.prototype.encode
     * https://gist.github.com/Yaffle/5458286
     */
        var bits;
        var cc;
        var codePoint;
        var ii;
        var length;
        var octets;
        octets = [];
        length = string.length;
        ii = 0;
        while (ii < length) {
            codePoint = string.codePointAt(ii);
            cc = 0;
            bits = 0;
            if (codePoint <= 0x0000007F) {
                cc = 0;
                bits = 0x00;
            } else if (codePoint <= 0x000007FF) {
                cc = 6;
                bits = 0xC0;
            } else if (codePoint <= 0x0000FFFF) {
                cc = 12;
                bits = 0xE0;
            } else if (codePoint <= 0x001FFFFF) {
                cc = 18;
                bits = 0xF0;
            }
            octets.push(bits | (codePoint >> cc));
            cc -= 6;
            while (cc >= 0) {
                octets.push(0x80 | ((codePoint >> cc) & 0x3F));
                cc -= 6;
            }
            ii += (
                codePoint >= 0x10000
                ? 2
                : 1
            );
        }
        return octets;
    };
    globalThis.TextDecoder = globalThis.TextDecoder || TextXxcoder;
    globalThis.TextEncoder = globalThis.TextEncoder || TextXxcoder;
}());



// run shared js-env code - function
(function () {
// init lib Blob
local.Blob = (
    local.isBrowser
    ? globalThis.Blob
    : function (array, opt) {
        /*
         * this function will create a node-compatible Blob instance
         * https://developer.mozilla.org/en-US/docs/Web/API/Blob/Blob
         */
        this.bff = local.bufferConcat(array.map(function (elem) {
            return (
                // ternary-operator
                (
                    typeof elem === "string"
                    || Object.prototype.toString.call(elem)
                    === "[object Uint8Array]"
                )
                ? elem
                : String(elem)
            );
        }));
        this.type = opt && opt.type;
    }
);

// init lib FormData
local.FormData = function () {
/*
 * this function will create a serverLocal-compatible FormData instance
 * The FormData(form) constructor must run these steps:
 * 1. Let fd be a new FormData object.
 * 2. If form is given, set fd's entries to the result
 *    of constructing the form data set for form. (not implemented)
 * 3. Return fd.
 * https://xhr.spec.whatwg.org/#dom-formdata
 */
    this.entryList = [];
};

local.FormData.prototype.append = function (name, value, filename) {
/*
 * The append(name, value, filename) method, when invoked, must run these steps:
 * 1. If the filename argument is given, set value to a new File object
 *    whose contents are value and name is filename.
 * 2. Append a new entry whose name is name, and value is value,
 *    to context object's list of entries.
 * https://xhr.spec.whatwg.org/#dom-formdata-append
 */
    if (filename) {
        // bug-workaround - chromium cannot assign name to Blob instance
        local.tryCatchOnError(function () {
            value.name = filename;
        }, local.nop);
    }
    this.entryList.push({
        name,
        value
    });
};

local.FormData.prototype.read = function (onError) {
/*
 * this function will read from formData as a buffer, e.g.
 * --Boundary\r\n
 * Content-Disposition: form-data; name="key"\r\n
 * \r\n
 * value\r\n
 * --Boundary\r\n
 * Content-Disposition: form-data; name="input1"; filename="file1.png"\r\n
 * Content-Type: image/jpeg\r\n
 * \r\n
 * <data1>\r\n
 * --Boundary\r\n
 * Content-Disposition: form-data; name="input2"; filename="file2.png"\r\n
 * Content-Type: image/jpeg\r\n
 * \r\n
 * <data2>\r\n
 * --Boundary--\r\n
 * https://tools.ietf.org/html/rfc7578
 */
    var boundary;
    var result;
    // handle null-case
    if (!this.entryList.length) {
        onError(null, "");
        return;
    }
    // init boundary
    boundary = "--" + Date.now().toString(16) + Math.random().toString(16);
    // init result
    result = [];
    local.onParallelList({
        list: this.entryList
    }, function (option2, onParallel) {
        var value;
        value = option2.elem.value;
        if (!(value && value.constructor === local.Blob)) {
            result[option2.ii] = [
                (
                    boundary + "\r\nContent-Disposition: form-data; name=\""
                    + option2.elem.name + "\"\r\n\r\n"
                ), value, "\r\n"
            ];
            onParallel.counter += 1;
            onParallel();
            return;
        }
        // read from blob in parallel
        onParallel.counter += 1;
        local.blobRead(value, function (err, data) {
            result[option2.ii] = !err && [
                (
                    boundary + "\r\nContent-Disposition: form-data; name=\""
                    + option2.elem.name + "\"" + (
                        (value && value.name)
                        // read param filename
                        ? "; filename=\"" + value.name + "\""
                        : ""
                    ) + "\r\n" + (
                        (value && value.type)
                        // read param Content-Type
                        ? "Content-Type: " + value.type + "\r\n"
                        : ""
                    ) + "\r\n"
                ), data, "\r\n"
            ];
            onParallel(err);
        });
    }, function (err) {
        // add closing boundary
        result.push([
            boundary + "--\r\n"
        ]);
        // concatenate result
        onError(
            err,
            // flatten result
            !err
            && local.bufferConcat(Array.prototype.concat.apply([], result))
        );
    });
};

// init lib _http
local._http = {};

// init _http.IncomingMessage
local._http.IncomingMessage = function (xhr) {
/*
 * An IncomingMessage object is created by http.Server or http.ClientRequest
 * and passed as the first argument to the 'req' and 'res' event
 * respectively.
 * It may be used to access res status, headers and data.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_http_incomingmessage
 */
    this.headers = xhr.headers;
    this.httpVersion = "1.1";
    this.method = xhr.method;
    this.onEvent = document.createDocumentFragment();
    this.readable = true;
    this.url = xhr.url;
};

local._http.IncomingMessage.prototype.addListener = function (evt, onEvent) {
/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener will result
 * in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_addlistener_event_listener
 */
    this.onEvent.addEventListener(evt, function (evt) {
        onEvent(evt.data);
    });
    if (this.readable && evt === "end") {
        this.readable = null;
        this.emit("data", this.data);
        this.emit("end");
    }
    return this;
};

local._http.IncomingMessage.prototype.emit = function (evt, data) {
/*
 * Execute each of the listeners in order with the supplied arguments.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_emit_event_arg1_arg2
 */
    evt = new Event(evt);
    evt.data = data;
    this.onEvent.dispatchEvent(evt);
};

/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener will result
 * in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_on_event_listener
 */
local._http.IncomingMessage.prototype.on = (
    local._http.IncomingMessage.prototype.addListener
);

local._http.IncomingMessage.prototype.pipe = function (writable) {
/*
 * This method pulls all the data out of a readable stream, and writes it
 * to the supplied destination, automatically managing the flow
 * so that the destination is not overwhelmed by a fast readable stream.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_readable_pipe_destination_options
 */
    this.on("data", function (chunk) {
        writable.write(chunk);
    });
    this.on("end", function () {
        writable.end();
    });
    return writable;
};

local._http.STATUS_CODES = {
    "100": "Continue",
    "101": "Switching Protocols",
    "102": "Processing",
    "200": "OK",
    "201": "Created",
    "202": "Accepted",
    "203": "Non-Authoritative Information",
    "204": "No Content",
    "205": "Reset Content",
    "206": "Partial Content",
    "207": "Multi-Status",
    "208": "Already Reported",
    "226": "IM Used",
    "300": "Multiple Choices",
    "301": "Moved Permanently",
    "302": "Found",
    "303": "See Other",
    "304": "Not Modified",
    "305": "Use Proxy",
    "307": "Temporary Redirect",
    "308": "Permanent Redirect",
    "400": "Bad Request",
    "401": "Unauthorized",
    "402": "Payment Required",
    "403": "Forbidden",
    "404": "Not Found",
    "405": "Method Not Allowed",
    "406": "Not Acceptable",
    "407": "Proxy Authentication Required",
    "408": "Request Timeout",
    "409": "Conflict",
    "410": "Gone",
    "411": "Length Required",
    "412": "Precondition Failed",
    "413": "Payload Too Large",
    "414": "URI Too Long",
    "415": "Unsupported Media Type",
    "416": "Range Not Satisfiable",
    "417": "Expectation Failed",
    "418": "I'm a teapot",
    "421": "Misdirected Request",
    "422": "Unprocessable Entity",
    "423": "Locked",
    "424": "Failed Dependency",
    "425": "Unordered Collection",
    "426": "Upgrade Required",
    "428": "Precondition Required",
    "429": "Too Many Requests",
    "431": "Request Header Fields Too Large",
    "451": "Unavailable For Legal Reasons",
    "500": "Internal Server Error",
    "501": "Not Implemented",
    "502": "Bad Gateway",
    "503": "Service Unavailable",
    "504": "Gateway Timeout",
    "505": "HTTP Version Not Supported",
    "506": "Variant Also Negotiates",
    "507": "Insufficient Storage",
    "508": "Loop Detected",
    "509": "Bandwidth Limit Exceeded",
    "510": "Not Extended",
    "511": "Network Authentication Required"
};

// init _http.ServerResponse
local._http.ServerResponse = function (onResponse) {
/*
 * This object is created internally by a HTTP server--not by the user.
 * It is passed as the second parameter to the 'req' event.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_class_http_serverresponse
 */
    this.chunkList = [];
    this.onEvent = document.createDocumentFragment();
    this.onResponse = onResponse;
    this.resHeaders = {};
    this.statusCode = 200;
};

/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener will result
 * in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_addlistener_event_listener
 */
local._http.ServerResponse.prototype.addListener = (
    local._http.IncomingMessage.prototype.addListener
);
/*
 * Execute each of the listeners in order with the supplied arguments.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_emit_event_arg1_arg2
 */
local._http.ServerResponse.prototype.emit = (
    local._http.IncomingMessage.prototype.emit
);

local._http.ServerResponse.prototype.end = function (data) {
/*
 * This method signals to the server that all of the res headers and body
 * have been sent; that server should consider this message complete.
 * The method, res.end(), MUST be called on each res.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_end_data_encoding_callback
 */
    var that;
    that = this;
    if (that._isDone) {
        return;
    }
    that._isDone = true;
    that.chunkList.push(data);
    // notify server res is finished
    that.emit("finish");
    // asynchronously send res from server to client
    setTimeout(function () {
        that.onResponse(that);
        that.emit("data", local.bufferConcat(that.chunkList));
        that.emit("end");
    });
};

/*
 * Adds a listener to the end of the listeners array for the specified event.
 * No checks are made to see if the listener has already been added.
 * Multiple calls passing the same combination of event and listener
 * will result in the listener being added multiple times.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_emitter_on_event_listener
 */
local._http.ServerResponse.prototype.on = (
    local._http.IncomingMessage.prototype.addListener
);

local._http.ServerResponse.prototype.setHeader = function (key, value) {
/*
 * Sets a single header value for implicit headers.
 * If this header already exists in the to-be-sent headers,
 * its value will be replaced.
 * Use an array of strings here if you need to send multiple headers
 * with the same name.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_setheader_name_value
 */
    this.resHeaders[key.toLowerCase()] = value;
};

local._http.ServerResponse.prototype.write = function (data) {
/*
 * This sends a chunk of the res body.
 * This method may be called multiple times
 * to provide successive parts of the body.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_response_write_chunk_encoding_callback
 */
    this.chunkList.push(data);
};

local._http.createServer = function () {
/*
 * Returns a new instance of http.Server.
 * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_http_createserver_requestlistener
 */
    return {
        listen: function (port, onError) {
        /*
         * This will cause the server to accept connections
         * on the specified handle,
         * but it is presumed that the file descriptor or handle
         * has already been bound to a port or domain socket.
         * https://nodejs.org/dist/v0.12.18/docs/api/all.html#all_server_listen_handle_callback
         */
            onError(null, port);
        }
    };
};

local._http.request = function (xhr, onResponse) {
    var isDone;
    xhr = {
        headers: xhr.headers,
        method: xhr.method,
        timeout: xhr.timeout,
        url: xhr.href
    };
    xhr.end = function (data) {
        if (isDone) {
            return;
        }
        isDone = true;
        xhr.serverReq.data = data;
        // asynchronously send req from client -> server
        setTimeout(function () {
            local.serverLocalReqHandler(
                xhr.serverReq,
                xhr.serverResponse
            );
        });
    };
    xhr.on = function () {
        return xhr;
    };
    xhr.serverReq = new local._http.IncomingMessage(xhr);
    xhr.serverResponse = new local._http.ServerResponse(onResponse);
    return xhr;
};

local._testCase_buildApidoc_default = function (opt, onError) {
/*
 * this function will test buildApidoc's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildApidoc(opt, onError);
};

local._testCase_buildApp_default = function (opt, onError) {
/*
 * this function will test buildApp's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    globalThis.local.testCase_buildReadme_default(opt, local.onErrorThrow);
    globalThis.local.testCase_buildLib_default(opt, local.onErrorThrow);
    globalThis.local.testCase_buildTest_default(opt, local.onErrorThrow);
    local.buildApp(opt, onError);
};

local._testCase_buildLib_default = function (opt, onError) {
/*
 * this function will test buildLib's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildLib({}, onError);
};

local._testCase_buildReadme_default = function (opt, onError) {
/*
 * this function will test buildReadme's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildReadme({}, onError);
};

local._testCase_buildTest_default = function (opt, onError) {
/*
 * this function will test buildTest's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    return local.buildTest({}, onError);
};

local._testCase_webpage_default = function (opt, onError) {
/*
 * this function will test webpage's default handling-behavior
 */
    local.domStyleValidate();
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.browserTest({
        fileScreenshot: (
            local.env.npm_config_dir_build
            + "/screenshot." + local.env.MODE_BUILD + ".browser.%2F.png"
        ),
        modeCoverageMerge: true,
        url: (
            local.assetsDict["/"].indexOf(
                "<script src=\"assets.test.js\"></script>"
            ) >= 0
            ? local.serverLocalHost + "?modeTest=1&timeoutDefault="
            + local.timeoutDefault
            : local.serverLocalHost
            + "/assets.utility2.base.html?modeTest=1&timeoutDefault=1"
        ) + "&modeTestCase=" + local.modeTestCase.replace((
            /_?testCase_webpage_default/
        ), "")
    }, onError);
};

local.ajax = function (opt, onError) {
/*
 * this function will send an ajax-req
 * with given <opt>.url and callback <onError>
 * with err and timeout handling
 * example usage:
    local.ajax({
        data: "hello world",
        header: {"x-header-hello": "world"},
        method: "POST",
        url: "/index.html"
    }, function (err, xhr) {
        console.log(xhr.statusCode);
        console.log(xhr.responseText);
    });
 */
    var ajaxProgressUpdate;
    var bufferValidateAndCoerce;
    var isDone;
    var local2;
    var onEvent;
    var streamCleanup;
    var timeout;
    var tmp;
    var xhr;
    var xhrInit;
    // init local2
    local2 = opt.local2 || local.utility2 || {};
    // init function
    ajaxProgressUpdate = local2.ajaxProgressUpdate || local.nop;
    bufferValidateAndCoerce = local2.bufferValidateAndCoerce || function (
        bff,
        mode
    ) {
    /*
     * this function will validate and coerce/convert <bff> -> Buffer
     * (or String if <mode> = "string")
     */
        // coerce ArrayBuffer -> Buffer
        if (Object.prototype.toString.call(bff) === "[object ArrayBuffer]") {
            bff = new Uint8Array(bff);
        }
        // convert Buffer -> utf8
        if (mode === "string" && typeof bff !== "string") {
            bff = String(bff);
        }
        return bff;
    };
    onEvent = function (evt) {
    /*
     * this function will handle events
     */
        if (Object.prototype.toString.call(evt) === "[object Error]") {
            xhr.err = xhr.err || evt;
            xhr.onEvent({
                type: "error"
            });
            return;
        }
        // init statusCode
        xhr.statusCode = (xhr.statusCode || xhr.status) | 0;
        switch (evt.type) {
        case "abort":
        case "error":
        case "load":
            if (isDone) {
                return;
            }
            isDone = true;
            // decrement ajaxProgressCounter
            local2.ajaxProgressCounter = Math.max(
                local2.ajaxProgressCounter - 1,
                0
            );
            ajaxProgressUpdate();
            // handle abort or err event
            switch (!xhr.err && evt.type) {
            case "abort":
            case "error":
                xhr.err = new Error("ajax - event " + evt.type);
                break;
            case "load":
                if (xhr.statusCode >= 400) {
                    xhr.err = new Error(
                        "ajax - statusCode " + xhr.statusCode
                    );
                }
                break;
            }
            // debug statusCode / method / url
            if (xhr.err) {
                xhr.statusCode = xhr.statusCode || 500;
                xhr.err.statusCode = xhr.statusCode;
                tmp = (
                    // ternary-operator
                    (
                        local.isBrowser
                        ? "browser"
                        : "node"
                    )
                    + " - " + xhr.statusCode + " " + xhr.method + " " + xhr.url
                    + "\n"
                );
                xhr.err.message = tmp + xhr.err.message;
                xhr.err.stack = tmp + xhr.err.stack;
            }
            // update resHeaders
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getAllResponseHeaders
            if (xhr.getAllResponseHeaders) {
                xhr.getAllResponseHeaders().replace((
                    /(.*?):\u0020*(.*?)\r\n/g
                ), function (ignore, match1, match2) {
                    xhr.resHeaders[match1.toLowerCase()] = match2;
                });
            }
            // debug ajaxResponse
            xhr.resContentLength = (
                xhr.response
                && (xhr.response.byteLength || xhr.response.length)
            ) | 0;
            xhr.timeElapsed = Date.now() - xhr.timeStart;
            if (xhr.modeDebug) {
                console.error("serverLog - " + JSON.stringify({
                    time: new Date(xhr.timeStart).toISOString(),
                    type: "ajaxResponse",
                    method: xhr.method,
                    url: xhr.url,
                    statusCode: xhr.statusCode,
                    timeElapsed: xhr.timeElapsed,
                    // extra
                    resContentLength: xhr.resContentLength
                }));
            }
            // init responseType
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType
            switch (xhr.response && xhr.responseType) {
            // init responseText
            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText
            case "":
            case "text":
                if (typeof xhr.responseText === "string") {
                    break;
                }
                xhr.responseText = bufferValidateAndCoerce(
                    xhr.response,
                    "string"
                );
                break;
            case "arraybuffer":
                xhr.responseBuffer = bufferValidateAndCoerce(xhr.response);
                break;
            }
            // cleanup timerTimeout
            clearTimeout(xhr.timerTimeout);
            // cleanup reqStream and resStream
            streamCleanup(xhr.reqStream);
            streamCleanup(xhr.resStream);
            onError(xhr.err, xhr);
            break;
        }
    };
    streamCleanup = function (stream) {
    /*
     * this function will try to end or destroy <stream>
     */
        var err;
        // try to end stream
        try {
            stream.end();
        } catch (errCaught) {
            err = errCaught;
        }
        // if err, then try to destroy stream
        if (err) {
            try {
                stream.destroy();
            } catch (ignore) {}
        }
    };
    xhrInit = function () {
    /*
     * this function will init xhr
     */
        // init opt
        Object.keys(opt).forEach(function (key) {
            if (key[0] !== "_") {
                xhr[key] = opt[key];
            }
        });
        // init timeout
        timeout = xhr.timeout || local2.timeoutDefault || 30000;
        // init default
        local.objectAssignDefault(xhr, {
            corsForwardProxyHost: local2.corsForwardProxyHost,
            headers: {},
            location: (local.isBrowser && location) || {},
            method: "GET",
            responseType: ""
        });
        // init headers
        Object.keys(xhr.headers).forEach(function (key) {
            xhr.headers[key.toLowerCase()] = xhr.headers[key];
        });
        // coerce Uint8Array -> Buffer
        if (
            !local.isBrowser
            && !Buffer.isBuffer(xhr.data)
            && Object.prototype.toString.call(xhr.data)
            === "[object Uint8Array]"
        ) {
            Object.setPrototypeOf(xhr.data, Buffer.prototype);
        }
        // init misc
        local2._debugXhr = xhr;
        xhr.onEvent = onEvent;
        xhr.resHeaders = {};
        xhr.timeStart = xhr.timeStart || Date.now();
    };
    // init onError
    if (local2.onErrorWithStack) {
        onError = local2.onErrorWithStack(onError);
    }
    // init xhr - XMLHttpRequest
    xhr = (
        local.isBrowser
        && !opt.httpReq
        && !(local2.serverLocalUrlTest && local2.serverLocalUrlTest(opt.url))
        && new XMLHttpRequest()
    );
    // init xhr - http.request
    if (!xhr) {
        xhr = local.identity(local2.urlParse || require("url").parse)(opt.url);
        // init xhr
        xhrInit();
        // init xhr - http.request
        xhr = local.identity(
            opt.httpReq
            || (local.isBrowser && local2.http.request)
            || require(xhr.protocol.slice(0, -1)).request
        )(xhr, function (resStream) {
        /*
         * this function will read <resStream>
         */
            var chunkList;
            chunkList = [];
            xhr.resHeaders = resStream.resHeaders || resStream.headers;
            xhr.resStream = resStream;
            xhr.statusCode = resStream.statusCode;
            resStream.dataLength = 0;
            resStream.on("data", function (chunk) {
                chunkList.push(chunk);
            });
            resStream.on("end", function () {
                xhr.response = (
                    local.isBrowser
                    ? chunkList[0]
                    : Buffer.concat(chunkList)
                );
                resStream.dataLength = (
                    xhr.response.byteLength || xhr.response.length
                );
                xhr.onEvent({
                    type: "load"
                });
            });
            resStream.on("error", xhr.onEvent);
        });
        xhr.abort = function () {
        /*
         * this function will abort xhr-req
         * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/abort
         */
            xhr.onEvent({
                type: "abort"
            });
        };
        xhr.addEventListener = local.nop;
        xhr.open = local.nop;
        xhr.reqStream = xhr;
        xhr.send = xhr.end;
        xhr.setRequestHeader = local.nop;
        xhr.on("error", onEvent);
    }
    // init xhr
    xhrInit();
    // init timerTimeout
    xhr.timerTimeout = setTimeout(function () {
        xhr.err = xhr.err || new Error(
            "onTimeout - errTimeout - "
            + timeout + " ms - " + "ajax " + xhr.method + " " + xhr.url
        );
        xhr.abort();
        // cleanup reqStream and resStream
        streamCleanup(xhr.reqStream);
        streamCleanup(xhr.resStream);
    }, timeout);
    // increment ajaxProgressCounter
    local2.ajaxProgressCounter = local2.ajaxProgressCounter || 0;
    local2.ajaxProgressCounter += 1;
    // init event-handling
    xhr.addEventListener("abort", xhr.onEvent);
    xhr.addEventListener("error", xhr.onEvent);
    xhr.addEventListener("load", xhr.onEvent);
    xhr.addEventListener("loadstart", ajaxProgressUpdate);
    xhr.addEventListener("progress", ajaxProgressUpdate);
    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/upload
    if (xhr.upload && xhr.upload.addEventListener) {
        xhr.upload.addEventListener("progress", ajaxProgressUpdate);
    }
    // open url - corsForwardProxyHost
    if (local.functionOrNop(local2.corsForwardProxyHostIfNeeded)(xhr)) {
        xhr.open(xhr.method, local2.corsForwardProxyHostIfNeeded(xhr));
        xhr.setRequestHeader(
            "forward-proxy-headers",
            JSON.stringify(xhr.headers)
        );
        xhr.setRequestHeader("forward-proxy-url", xhr.url);
    // open url - default
    } else {
        xhr.open(xhr.method, xhr.url);
    }
    // send headers
    Object.keys(xhr.headers).forEach(function (key) {
        xhr.setRequestHeader(key, xhr.headers[key]);
    });
    // send data
    switch ((xhr.data && xhr.data.constructor) || true) {
    // Blob
    // https://developer.mozilla.org/en-US/docs/Web/API/Blob
    case local2.Blob:
    // FormData
    // https://developer.mozilla.org/en-US/docs/Web/API/FormData
    case local2.FormData:
        local2.blobRead(xhr.data, function (err, data) {
            if (err) {
                xhr.onEvent(err);
                return;
            }
            // send data
            xhr.send(data);
        });
        break;
    default:
        xhr.send(xhr.data);
    }
    return xhr;
};

local.ajaxProgressUpdate = function () {
/*
 * this function will update ajaxProgress
 */
    var ajaxProgressDiv1;
    // init state
    local.ajaxProgressCounter = local.ajaxProgressCounter || 0;
    local.ajaxProgressState = local.ajaxProgressState || 0;
    ajaxProgressDiv1 = (local.isBrowser && document.querySelector(
        "#ajaxProgressDiv1"
    )) || {
        style: {
            width: ""
        }
    };
    // init ajaxProgressDiv1StyleBackground
    local.ajaxProgressDiv1StyleBackground = (
        local.ajaxProgressDiv1StyleBackground
        || ajaxProgressDiv1.style.background
    );
    // show ajaxProgress
    ajaxProgressDiv1.style.background = local.ajaxProgressDiv1StyleBackground;
    // increment ajaxProgress
    if (local.ajaxProgressCounter > 0) {
        local.timerIntervalAjaxProgressHide = (
            local.timerIntervalAjaxProgressHide
            || setInterval(local.ajaxProgressUpdate, 2000)
        );
        // this algorithm will indefinitely increment ajaxProgressBar
        // with successively smaller increments without ever reaching 100%
        if ((ajaxProgressDiv1.style.width.slice(0, -1) | 0) > 95) {
            ajaxProgressDiv1.style.width = "0%";
            local.ajaxProgressState = 0;
        }
        local.ajaxProgressState += 1;
        ajaxProgressDiv1.style.width = Math.max(
            100 - 75 * Math.exp(-0.125 * local.ajaxProgressState),
            ajaxProgressDiv1.style.width.slice(0, -1) | 0
        ) + "%";
    } else {
        // finish ajaxProgress
        ajaxProgressDiv1.style.width = "100%";
    }
    // cleanup timerTimeout
    clearTimeout(local.timerTimeoutAjaxProgressHide);
    // hide ajaxProgress
    local.timerTimeoutAjaxProgressHide = setTimeout(function () {
        ajaxProgressDiv1.style.background = "transparent";
        local.ajaxProgressCounter = 0;
        local.ajaxProgressState = 0;
        // reset ajaxProgress
        clearInterval(local.timerIntervalAjaxProgressHide);
        local.timerIntervalAjaxProgressHide = null;
        setTimeout(function () {
            if (!local.ajaxProgressState) {
                ajaxProgressDiv1.style.width = "0%";
            }
        }, 500);
    }, (
        local.ajaxProgressCounter > 0
        ? local.timeoutDefault
        : 1000
    ));
};

local.assertJsonEqual = function (aa, bb, message) {
/*
 * this function will assert jsonStringifyOrdered(<aa>) === JSON.stringify(<bb>)
 */
    aa = local.jsonStringifyOrdered(aa);
    bb = JSON.stringify(bb);
    local.assertThrow(aa === bb, message || [
        aa, bb
    ]);
};

local.assertJsonNotEqual = function (aa, bb, message) {
/*
 * this function will assert jsonStringifyOrdered(<aa>) !== JSON.stringify(<bb>)
 */
    aa = local.jsonStringifyOrdered(aa);
    bb = JSON.stringify(bb);
    local.assertThrow(aa !== bb, [
        aa
    ], message || aa);
};

local.base64FromBuffer = function (bff) {
/*
 * this function will convert Uint8Array <bff> to base64
 * https://developer.mozilla.org/en-US/Add-ons/Code_snippets/StringView#The_code
 */
    var ii;
    var mod3;
    var text;
    var uint24;
    var uint6ToB64;
    // convert utf8 -> Uint8Array
    if (typeof bff === "string") {
        bff = new TextEncoder().encode(bff);
    }
    bff = bff || [];
    text = "";
    uint24 = 0;
    uint6ToB64 = function (uint6) {
        return (
            uint6 < 26
            ? uint6 + 65
            : uint6 < 52
            ? uint6 + 71
            : uint6 < 62
            ? uint6 - 4
            : uint6 === 62
            ? 43
            : 47
        );
    };
    ii = 0;
    while (ii < bff.length) {
        mod3 = ii % 3;
        uint24 |= bff[ii] << (16 >>> mod3 & 24);
        if (mod3 === 2 || bff.length - ii === 1) {
            text += String.fromCharCode(
                uint6ToB64(uint24 >>> 18 & 63),
                uint6ToB64(uint24 >>> 12 & 63),
                uint6ToB64(uint24 >>> 6 & 63),
                uint6ToB64(uint24 & 63)
            );
            uint24 = 0;
        }
        ii += 1;
    }
    return text.replace((
        /A(?=A$|$)/gm
    ), "=");
};

local.base64ToBuffer = function (b64, mode) {
/*
 * this function will convert <b64> to Uint8Array
 * https://gist.github.com/wang-bin/7332335
 */
    var bff;
    var byte;
    var chr;
    var ii;
    var jj;
    var map64;
    var mod4;
    b64 = b64 || "";
    bff = new Uint8Array(b64.length); // 3/4
    byte = 0;
    jj = 0;
    map64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    mod4 = 0;
    ii = 0;
    while (ii < b64.length) {
        chr = map64.indexOf(b64[ii]);
        if (chr >= 0) {
            mod4 %= 4;
            if (mod4 === 0) {
                byte = chr;
            } else {
                byte = byte * 64 + chr;
                bff[jj] = 255 & (byte >> ((-2 * (mod4 + 1)) & 6));
                jj += 1;
            }
            mod4 += 1;
        }
        ii += 1;
    }
    // optimization - create resized-view of bff
    bff = bff.subarray(0, jj);
    return local.bufferValidateAndCoerce(bff, mode);
};

local.base64ToUtf8 = function (b64) {
/*
 * this function will convert <b64> -> utf8
 */
    return local.base64ToBuffer(b64, "string");
};

local.blobRead = function (blob, onError) {
/*
 * this function will read from <blob>
 */
    var isDone;
    var reader;
    if (blob && blob.constructor && blob.constructor === local.FormData) {
        blob.read(onError);
        return;
    }
    if (!local.isBrowser) {
        onError(null, local.bufferValidateAndCoerce(blob.bff));
        return;
    }
    reader = new FileReader();
    reader.onabort = function (evt) {
        if (isDone) {
            return;
        }
        isDone = true;
        switch (evt.type) {
        case "abort":
        case "error":
            onError(new Error("blobRead - " + evt.type));
            break;
        case "load":
            onError(
                null,
                Object.prototype.toString.call(reader.result)
                === "[object ArrayBuffer]"
                // convert ArrayBuffer -> Uint8Array
                ? new Uint8Array(reader.result)
                : reader.result
            );
            break;
        }
    };
    reader.onerror = reader.onabort;
    reader.onload = reader.onabort;
    reader.readAsArrayBuffer(blob);
};

local.browserTest = function (opt, onError) {
/*
 * this function will spawn an electron process to test <opt>.url
 */
    var isDone;
    var isDoneHtml;
    var onMessage;
    var onParallel;
    var timerTimeout;
    var window;
    window = opt.window || globalThis;
    // init utility2_testReport
    window.utility2_testReport = window.utility2_testReport || {
        coverage: window.__coverage__,
        testPlatformList: [
            {
                name: (
                    local.isBrowser
                    ? (
                        "browser - "
                        + location.pathname + " - " + navigator.userAgent
                    )
                    : "node - " + process.platform + " " + process.version
                ) + " - " + new Date().toISOString(),
                screenshot: local.env && local.env.MODE_BUILD_SCREENSHOT_IMG,
                testCaseList: []
            }
        ]
    };
    window.utility2_testReportSave = (
        window.utility2_testReportSave
        || local.nop
    );
    if (opt.modeTestReportCreate) {
        return;
    }
    onMessage = function (evt, type, data) {
        switch (evt && type) {
        case "html":
            if (isDoneHtml) {
                return;
            }
            isDoneHtml = true;
            opt.fs.writeFile(opt.fileScreenshot.replace((
                /\.\w+$/
            ), ".html"), data, onParallel);
            return;
        case "testReport":
            if (opt.isDoneTestReport || opt.modeBrowserTest !== "test") {
                return;
            }
            opt.isDoneTestReport = true;
            // save browser-coverage
            if (data.coverage) {
                onParallel.counter += 1;
                opt.fs.writeFile(
                    opt.fileCoverage,
                    JSON.stringify(data.coverage),
                    onParallel
                );
                data.coverage = null;
            }
            // save browser-screenshot
            data.testPlatformList[0].screenshot = (
                opt.fileScreenshot.replace((
                    /.*\//
                ), "")
            );
            // save browser-test-report
            onParallel.counter += 1;
            opt.fs.writeFile(
                opt.fileTestReport,
                JSON.stringify(data, null, 4),
                onParallel
            );
            onParallel();
            return;
        }
    };
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        // node - init
        case 1:
            // init fileElectronHtml
            opt.fileElectronHtml = (
                opt.npm_config_dir_tmp
                + "/electron."
                + Date.now().toString(16)
                + Math.random().toString(16)
                + ".html"
            );
            // init url
            if (!(
                /^\w+:\/\//
            ).test(opt.url)) {
                opt.url = local.path.resolve(process.cwd(), opt.url);
            }
            opt.urlParsed = local.urlParse(opt.url);
            // init testName
            opt.testName = opt.urlParsed.pathname;
            if (opt.testName.indexOf(process.cwd()) === 0) {
                opt.testName = opt.testName.replace(process.cwd(), "");
            }
            opt.testName = (
                opt.MODE_BUILD + ".browser."
                + encodeURIComponent(opt.testName.replace(
                    "/build.."
                    + opt.CI_BRANCH
                    + ".." + opt.CI_HOST,
                    "/build"
                ))
            );
            local.objectSetDefault(opt, {
                fileCoverage: (
                    opt.npm_config_dir_tmp + "/coverage."
                    + opt.testName + ".json"
                ),
                fileScreenshot: (
                    opt.npm_config_dir_build + "/screenshot."
                    + opt.testName
                    + ".png"
                ),
                fileTestReport: (
                    opt.npm_config_dir_tmp + "/test-report."
                    + opt.testName
                    + ".json"
                ),
                modeBrowserTest: "test",
                timeExit: Date.now() + opt.timeoutDefault,
                timeoutScreenshot: opt.timeoutScreenshot || 15000
            }, 1);
            // init timerTimeout
            timerTimeout = local.onTimeout(
                opt.onNext,
                opt.timeoutDefault,
                opt.testName
            ).unref();
            data = {};
            Object.keys(opt).forEach(function (key) {
                if (typeof opt[key] !== "object") {
                    data[key] = opt[key];
                }
            });
            data.modeNext = 20;
            // init file fileElectronHtml
            local.fsWriteFileWithMkdirpSync(opt.fileElectronHtml, (
                "//<body "
                + "style=\"border:1px solid black;margin:0;padding:0;\">"
                + "<webview "
                + "preload=\""
                + opt.fileElectronHtml
                + "\" src=\""
                + opt.url.replace("{{timeExit}}", opt.timeExit)
                + "\" style="
                + "\"border:none;height:100%;margin:0;padding:0;width:100%;\">"
                + "</webview>"
                + "<script>document.body.removeChild(document.body.firstChild);"
                + "</script>"
                + "</body>"
                + "<textarea disabled style=\"display:none;\">\n"
                + local.assetsDict["/assets.example.begin.js"]
                + "(function(local){\n"
                + "\"use strict\";\n"
                + "local=globalThis.globalLocal;\n"
                + "local.env={};\n"
                + "local.isBrowser=true;\n"
                + "var opt=" + JSON.stringify(data) + ";\n"
                + [
                    "browserTest",
                    "nop",
                    "onErrorWithStack",
                    "onNext"
                ].map(function (key) {
                    return "local." + key + "=" + String(local[key])
                    // html-safe
                    .replace((
                        /<\//g
                    ), "<\\/")
                    // coverage-hack - un-instrument
                    .replace((
                        /\b__cov_.*?\+\+/g
                    ), "0") + ";\n";
                }).join("")
                + "local.browserTest(opt,console.error);\n"
                + "}());\n"
                + "//</textarea>\n"
            ));
            console.error(
                "\nbrowserTest - created fileElectronHtml "
                + opt.fileElectronHtml
                + "\n"
            );
            // spawn an electron process to test a url
            opt.npm_config_time_exit = opt.timeExit;
            data.modeNext = 10;
            local.childProcessSpawnWithTimeout("electron", [
                __filename,
                "utility2.browserTest",
                opt.url,
                "--enable-logging"
            ], {
                env: data,
                stdio: (
                    (!opt.modeDebug && opt.modeSilent)
                    ? "ignore"
                    : [
                        "ignore", 1, 2
                    ]
                ),
                timeout: opt.timeoutDefault
            }).once("error", opt.onNext).once("exit", opt.onNext);
            return;
        // node - after electron
        case 2:
            console.error(
                "\nbrowserTest - exit-code " + err + " - " + opt.url + "\n"
            );
            if (opt.modeBrowserTest !== "test") {
                opt.modeNext += 1000;
                opt.onNext();
                return;
            }
            // merge browser coverage
            data = (
                opt.modeCoverageMerge
                && local.fsReadFileOrEmptyStringSync(opt.fileCoverage, "json")
            );
            local.istanbulCoverageMerge(window.__coverage__, data);
            console.error(
                "\nbrowserTest - merged coverage from file "
                + opt.fileCoverage
                + "\n"
            );
            // merge browser test-report
            data = local.fsReadFileOrEmptyStringSync(
                opt.fileTestReport,
                "json"
            );
            local.testReportMerge(
                window.utility2_testReport,
                !opt.modeSilent && data
            );
            console.error(
                "\nbrowserTest - merged test-report from file "
                + opt.fileTestReport
                + "\n"
            );
            // create test-report.json
            local.fs.writeFileSync(
                local.env.npm_config_dir_build + "/test-report.json",
                JSON.stringify(window.utility2_testReport)
            );
            opt.onNext(data && data.testsFailed && new Error(data.testsFailed));
            return;
        // node.electron - init
        case 11:
            // handle uncaughtException
            window.process.once("uncaughtException", opt.onNext);
            // wait for electron to init
            opt.electron.app.once("ready", function () {
                opt.onNext();
            });
            return;
        // node.electron - after ready
        case 12:
            Object.assign(opt, {
                frame: false,
                height: 768,
                // disable nodeIntegration
                // https://github.com/electron/electron/blob/v2.0.0/docs/tutorial/security.md#how-1
                nodeIntegration: false,
                show: false,
                width: 1024,
                x: 0,
                y: 0
            });
            onParallel = local.onParallel(opt.onNext);
            // onParallel - html
            onParallel.counter += 1;
            // onParallel - test
            if (opt.modeBrowserTest === "test") {
                onParallel.counter += 1;
            }
            // init event-handling - ipc
            opt.electron.ipcMain.on(opt.fileElectronHtml, function (
                evt,
                type,
                data
            ) {
                try {
                    onMessage(evt, type, data);
                } catch (errCaught) {
                    opt.onNext(errCaught);
                }
            }, false);
            // init browserWindow
            opt.browserWindow = new opt.electron.BrowserWindow(opt);
            // load url in browserWindow
            opt.browserWindow.loadURL("file://" + opt.fileElectronHtml);
            return;
        // node.electron - screenshot
        case 13:
            opt.browserWindow.capturePage(opt, function (data) {
                opt.onNext(null, data);
            });
            return;
        case 14:
            opt.fs.writeFile(opt.fileScreenshot, data.toPNG(), opt.onNext);
            return;
        case 15:
            console.error(
                "\nbrowserTest - created screenshot file "
                + opt.fileScreenshot
                + "\n"
            );
            console.error(
                "browserTest - created screenshot file "
                + opt.fileScreenshot.replace((
                    /\.\w+$/
                ), ".html")
            );
            local.exit();
            return;
        // node.electron.browserWindow.webview.preload - init
        case 21:
            // init domOnEventWindowOnloadTimeElapsed
            (function () {
            /*
             * this function will measure and print time-elapsed
             * for window.onload
             */
                if (window.domOnEventWindowOnloadTimeElapsed) {
                    return;
                }
                window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;
                window.addEventListener("load", function () {
                    setTimeout(function () {
                        window.domOnEventWindowOnloadTimeElapsed = (
                            Date.now()
                            - window.domOnEventWindowOnloadTimeElapsed
                        );
                        console.error(
                            "domOnEventWindowOnloadTimeElapsed = "
                            + window.domOnEventWindowOnloadTimeElapsed
                        );
                    }, 100);
                });
            }());
            // init event-handling - load
            window.addEventListener("load", function () {
                setTimeout(opt.onNext, 5000);
            });
            // wait for render before screenshot
            setTimeout(opt.onNext, opt.timeoutScreenshot);
            if (opt.modeBrowserTest !== "test") {
                return;
            }
            // init utility2_testReportSave
            window.utility2_testReportSave = function () {
                window.utility2_testReportSave = local.nop;
                window.utility2_testReport.coverage = window.__coverage__;
                opt.electron.ipcRenderer.send(
                    opt.fileElectronHtml,
                    "testReport",
                    window.utility2_testReport
                );
            };
            return;
        // node.electron.browserWindow.webview.preload - screenshot
        case 22:
            // cleanup fileElectronHtml
            opt.fs.rename(
                opt.fileElectronHtml,
                opt.npm_config_dir_tmp + "/electron.html",
                console.error
            );
            opt.electron.ipcRenderer.send(
                opt.fileElectronHtml,
                "html",
                window.document.documentElement.outerHTML
            );
            if (opt.modeBrowserTest === "test" && !window.utility2_modeTest) {
                window.utility2_testReportSave();
            }
            return;
        default:
            if (isDone) {
                return;
            }
            isDone = true;
            // cleanup timerTimeout
            clearTimeout(timerTimeout);
            onError(err);
        }
    });
    // init opt
    [
        "CI_BRANCH",
        "CI_HOST",
        "DISPLAY",
        "MODE_BUILD",
        "PATH",
        "fileCoverage",
        "fileElectronHtml",
        "fileScreenshot",
        "fileTestReport",
        "modeBrowserTest",
        "modeCoverageMerge",
        "modeDebug",
        "modeNext",
        "modeSilent",
        "npm_config_dir_build",
        "npm_config_dir_tmp",
        "npm_config_time_exit",
        "npm_config_timeout_default",
        "timeExit",
        "timeoutDefault",
        "timeoutScreenshot",
        "url"
    ].forEach(function (key) {
        if (
            local.env
            && local.env[key] !== undefined
            && typeof opt[key] !== "number"
        ) {
            opt[key] = opt[key] || local.env[key];
        }
    });
    opt.modeNext = Number(opt.modeNext) || 0;
    opt.timeoutDefault = (
        Number(opt.timeoutDefault) || Number(local.timeoutDefault)
    );
    if (10 <= opt.modeNext) {
        opt.electron = opt.electron || require("electron");
    }
    opt.fs = opt.fs || require("fs");
    opt.onNext();
};

local.bufferConcat = function (bffList) {
/*
 * this function will emulate node's Buffer.concat for Uint8Array in browser
 */
    var byteLength;
    var ii;
    var isString;
    var jj;
    var result;
    isString = true;
    result = [
        ""
    ];
    byteLength = 0;
    bffList.forEach(function (bff) {
        if (bff !== 0 && !(bff && bff.length)) {
            return;
        }
        // optimization - concat string
        if (isString && typeof bff === "string") {
            result[0] += bff;
            return;
        }
        isString = null;
        bff = local.bufferValidateAndCoerce(bff);
        byteLength += bff.byteLength;
        result.push(bff);
    });
    // optimization - return string
    if (isString) {
        return result[0];
    }
    result[0] = local.bufferValidateAndCoerce(result[0]);
    byteLength += result[0].byteLength;
    bffList = result;
    result = local.bufferValidateAndCoerce(new Uint8Array(byteLength));
    ii = 0;
    bffList.forEach(function (bff) {
        jj = 0;
        while (jj < bff.byteLength) {
            result[ii] = bff[jj];
            ii += 1;
            jj += 1;
        }
    });
    return result;
};

local.bufferIndexOfSubBuffer = function (bff, subBff, fromIndex) {
/*
 * this function will search <bff> for <fromIndex> position of <subBff>
 */
    var ii;
    var jj;
    var kk;
    if (!subBff.length) {
        return 0;
    }
    ii = fromIndex || 0;
    while (ii < bff.length) {
        kk = ii;
        jj = 0;
        while (jj < subBff.length) {
            if (subBff[jj] !== bff[kk]) {
                break;
            }
            kk += 1;
            jj += 1;
        }
        if (jj === subBff.length) {
            return kk - jj;
        }
        ii += 1;
    }
    return -1;
};

local.bufferRandomBytes = function (length) {
/*
 * this function will return a Buffer with given <length>,
 * filled with cryptographically-strong random-values
 */
    return (
        // ternary-operator
        (
            typeof window === "object"
            && window.crypto
            && typeof window.crypto.getRandomValues === "function"
        )
        ? window.crypto.getRandomValues(new Uint8Array(length))
        : require("crypto").randomBytes(length)
    );
};

local.bufferToUtf8 = function (bff) {
/*
 * this function will convert Uint8Array <bff> -> utf8
 */
    return local.bufferValidateAndCoerce(bff, "string");
};

local.bufferValidateAndCoerce = function (bff, mode) {
/*
 * this function will validate and coerce/convert <bff> -> Buffer
 * (or String if <mode> = "string")
 */
    // validate not 0
    if (bff !== 0) {
        bff = bff || "";
    }
    if (typeof bff === "string" && mode === "string") {
        return bff;
    }
    // convert utf8 -> Uint8Array
    if (typeof bff === "string") {
        bff = (
            local.isBrowser
            ? new TextEncoder().encode(bff)
            : Buffer.from(bff)
        );
    // validate instanceof Uint8Array
    } else if (Object.prototype.toString.call(bff) !== "[object Uint8Array]") {
        throw new Error(
            "bufferValidateAndCoerce - value is not instanceof "
            + "ArrayBuffer, String, or Uint8Array"
        );
    }
    // convert Uint8Array -> utf8
    if (mode === "string") {
        return new TextDecoder().decode(bff);
    }
    // coerce Uint8Array -> Buffer
    if (!local.isBrowser && !Buffer.isBuffer(bff)) {
        Object.setPrototypeOf(bff, Buffer.prototype);
    }
    return bff;
};

local.buildApidoc = function (opt, onError) {
/*
 * this function will build apidoc with given <opt>
 */
    var result;
    // optimization - do not run if $npm_config_mode_coverage = all
    if (local.env.npm_config_mode_coverage === "all") {
        onError();
        return;
    }
    opt = local.objectSetDefault(opt, {
        blacklistDict: local,
        require: local.requireInSandbox
    });
    // save apidoc.html
    result = (
        local.fsReadFileOrEmptyStringSync("apidoc.html", "utf8")
        || local.apidocCreate(opt)
    );
    local.fsWriteFileWithMkdirpSync("tmp/build/apidoc.html", result);
    console.error(
        "created apidoc file " + process.cwd() + "/apidoc.html\n"
    );
    onError();
};

local.buildApp = function (opt, onError) {
/*
 * this function will build app with given <opt>
 */
    opt = local.objectSetDefault(opt, {
        assetsList: []
    });
    // build assets
    local.fsRmrSync("tmp/build/app");
    local.onParallelList({
        list: [
            {
                file: "/LICENSE",
                url: "/LICENSE"
            }, {
                file: "/assets." + local.env.npm_package_nameLib + ".html",
                url: "/index.html"
            }, {
                file: "/assets." + local.env.npm_package_nameLib + ".js",
                url: "/assets." + local.env.npm_package_nameLib + ".js"
            }, {
                file: "/assets.app.js",
                url: "/assets.app.js"
            }, {
                file: "/assets.example.html",
                url: "/assets.example.html"
            }, {
                file: "/assets.example.js",
                url: "/assets.example.js"
            }, {
                file: "/assets.swgg.html",
                url: "/assets.swgg.html"
            }, {
                file: "/assets.swgg.swagger.json",
                url: "/assets.swgg.swagger.json"
            }, {
                file: "/assets.swgg.swagger.petstore.json",
                url: "/assets.swgg.swagger.petstore.json"
            }, {
                file: "/assets.swgg.swagger.server.json",
                url: "/assets.swgg.swagger.server.json"
            }, {
                file: "/assets.test.js",
                url: "/assets.test.js"
            }, {
                file: "/assets.utility2.html",
                url: "/assets.utility2.html"
            }, {
                file: "/assets.utility2.base.html",
                url: "/assets.utility2.base.html"
            }, {
                file: "/assets.utility2.rollup.js",
                url: "/assets.utility2.rollup.js"
            }, {
                file: "/index.html",
                url: "/index.html"
            }, {
                file: "/index.rollup.html",
                url: "/index.rollup.html"
            }, {
                file: "/jsonp.utility2.stateInit",
                url: (
                    "/jsonp.utility2.stateInit"
                    + "?callback=window.utility2.stateInit"
                )
            }
        ].concat(opt.assetsList)
    }, function (option2, onParallel) {
        option2 = option2.elem;
        onParallel.counter += 1;
        local.ajax(option2, function (err, xhr) {
            // validate no err occurred
            local.assertThrow(!err, err);
            // jslint file
            local.jslintAndPrint(xhr.responseText, option2.file, {
                conditional: true,
                coverage: local.env.npm_config_mode_coverage
            });
            // validate no err occurred
            local.assertThrow(
                !local.jslint.jslintResult.errText,
                local.jslint.jslintResult.errText
            );
            local.fsWriteFileWithMkdirpSync(
                "tmp/build/app" + option2.file,
                xhr.response
            );
            onParallel();
        });
    }, function (err) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // test standalone assets.app.js
        local.fsWriteFileWithMkdirpSync(
            "tmp/buildApp/assets.app.js",
            local.assetsDict["/assets.app.js"]
        );
        local.childProcessSpawnWithTimeout("node", [
            "assets.app.js"
        ], {
            cwd: "tmp/buildApp",
            env: {
                PATH: local.env.PATH,
                PORT: (Math.random() * 0x10000) | 0x8000,
                npm_config_timeout_exit: 5000
            },
            stdio: [
                "ignore", "ignore", 2
            ]
        })
        .on("error", onError)
        .on("exit", function (exitCode) {
            // validate exitCode
            local.assertThrow(!exitCode, exitCode);
            onError();
        });
    });
};

local.buildLib = function (opt, onError) {
/*
 * this function will build lib with given <opt>
 */
    var result;
    local.objectSetDefault(opt, {
        customize: local.nop,
        dataFrom: local.fsReadFileOrEmptyStringSync(
            "lib." + local.env.npm_package_nameLib + ".js",
            "utf8"
        ),
        dataTo: local.templateRenderMyApp(
            local.assetsDict["/assets.my_app.template.js"],
            opt
        )
    });
    // search-and-replace - customize dataTo
    [
        // customize top-level comment-description
        (
            /\n\u0020\*\n(?:[\S\s]*?\n)?\u0020\*\/\n/
        ),
        // customize body after /* validateLineSortedReset */
        (
            /\n\/\*\u0020validateLineSortedReset\u0020\*\/\n[\S\s]*?$/
        )
    ].forEach(function (rgx) {
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
    });
    // customize local for assets.utility2.rollup.js
    if (
        local.fs.existsSync("./assets.utility2.rollup.js")
        && local.env.npm_package_nameLib !== "swgg"
    ) {
        opt.dataTo = opt.dataTo.replace(
            "    // || globalThis.utility2_rollup_old",
            "    || globalThis.utility2_rollup_old"
        ).replace(
            "    // || require(\"./assets.utility2.rollup.js\")",
            "    || require(\"./assets.utility2.rollup.js\")"
        );
    }
    // save lib
    result = opt.dataTo;
    local.fsWriteFileWithMkdirpSync(
        "lib." + local.env.npm_package_nameLib + ".js",
        result,
        local.env.npm_config_mode_coverage && local.identity("noWrite")
    );
    opt.customize(opt);
    onError();
    return result;
};

local.buildReadme = function (opt, onError) {
/*
 * this function will build readme with given <opt> my-app-lite template
 */
    var result;
    local.objectSetDefault(opt, {
        customize: local.nop,
        // reset toc
        dataFrom: local.fsReadFileOrEmptyStringSync(
            "README.md",
            "utf8"
        ).replace((
            /\n#\u0020table\u0020of\u0020contents$[\S\s]*?\n\n\n\n/m
        ), "\n# table of contents\n\n\n\n"),
        packageJsonRgx: (
            /\n#\u0020package.json\n```json\n([\S\s]*?)\n```\n/
        )
    });
    // render dataTo
    opt.dataTo = local.templateRenderMyApp(
        local.assetsDict["/assets.readme.template.md"],
        opt
    );
    // init package.json
    opt.dataFrom.replace(opt.packageJsonRgx, function (match0, match1) {
        // remove null-items from package.json
        opt.packageJson = JSON.parse(match1.replace((
            /\u0020{4}".*?":\u0020null,?$/gm
        ), ""));
        opt.packageJson.description = opt.dataFrom.split("\n")[1];
        local.tryCatchOnError(function () {
            local.objectSetDefault(opt.packageJson, {
                nameLib: local.fsReadFileOrEmptyStringSync(
                    "./package.json",
                    "json"
                ).nameLib
            });
        }, local.nop);
        opt.packageJson = local.objectSetDefault(opt.packageJson, {
            nameLib: opt.packageJson.name.replace((
                /\W/g
            ), "_"),
            nameOriginal: opt.packageJson.name
        });
        opt.packageJson = local.objectSetDefault(
            opt.packageJson,
            JSON.parse(local.templateRenderMyApp(opt.packageJsonRgx.exec(
                local.assetsDict["/assets.readme.template.md"]
            )[1], opt)),
            2
        );
        // avoid npm-installing that
        delete opt.packageJson.devDependencies[opt.packageJson.name];
        // reset scripts
        opt.packageJson.scripts = {
            "build-ci": "sh ./npm_scripts.sh",
            env: "env",
            eval: "sh ./npm_scripts.sh",
            "heroku-postbuild": "sh ./npm_scripts.sh",
            postinstall: "sh ./npm_scripts.sh",
            start: "sh ./npm_scripts.sh",
            test: "sh ./npm_scripts.sh",
            utility2: "sh ./npm_scripts.sh"
        };
        // save package.json
        local.fsWriteFileWithMkdirpSync(
            "package.json",
            local.jsonStringifyOrdered(opt.packageJson, null, 4) + "\n"
        );
        // re-render dataTo
        opt.dataTo = local.templateRenderMyApp(
            local.assetsDict["/assets.readme.template.md"],
            opt
        );
        opt.dataTo = opt.dataTo.replace(
            opt.packageJsonRgx,
            match0.replace(
                match1,
                local.jsonStringifyOrdered(opt.packageJson, null, 4)
            )
        );
    });
    // search-and-replace - customize dataTo
    [
        // customize name and description
        (
            /.*?\n.*?\n/
        ),
        // customize cdn-download
        (
            /\n#\u0020cdn\u0020download\n[\S\s]*?\n\n\n\n/
        ),
        // customize live-web-demo
        (
            /\n#\u0020live\u0020web\u0020demo\n[\S\s]*?\n\n\n\n/
        ),
        // customize to-do
        (
            /\n####\u0020todo\n[\S\s]*?\n\n\n\n/
        ),
        // customize example.js - shared js-env code - init-before
        (
            /\nglobalThis\.local\u0020=\u0020local;\n[^`]*?\n\/\/\u0020run\u0020browser\u0020js\-env\u0020code\u0020-\u0020init-test\n/
        ),
        // customize example.js - html-body
        (
            /\nutility2-comment\u0020-->(?:\\n\\\n){4}[^`]*?^<!--\u0020utility2-comment\\n\\\n/m
        ),
        // customize example.js - testRunBrowser
        (
            /\n\u0020{4}\/\/\u0020custom-case\n[^`]*?\n\u0020{4}\/\/\u0020run\u0020browser-tests\n/
        ),
        // customize build_ci - shBuildCiAfter
        (
            /\nshBuildCiAfter\u0020\(\)\u0020\{\(set\u0020-e\n[\S\s]*?\n\)\}\n/
        ),
        // customize build_ci - shBuildCiBefore
        (
            /\nshBuildCiBefore\u0020\(\)\u0020\{\(set\u0020-e\n[\S\s]*?\n\)\}\n/
        )
    ].forEach(function (rgx) {
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
    });
    // customize private-repository
    if (local.env.npm_package_private) {
        opt.dataTo = (
            opt.dataTo.replace((
                /\n\[!\[NPM\]\(https:\/\/nodei.co\/npm\/.*?\n/
            ), "\n").replace(
                "$ npm install ",
                (
                    "$ git clone "
                    + local.env.npm_package_repository_url
                    .replace("git+https://github.com/", "git@github.com:")
                    + " --single-branch -b beta node_modules/"
                )
            )
        );
    }
    // customize version
    [
        "dataFrom", "dataTo"
    ].forEach(function (elem) {
        opt[elem] = opt[elem].replace((
            /\n(####\u0020changelog\u0020|-\u0020npm\u0020publish\u0020)\d+?\.\d+?\.\d+?.*?\n/g
        ), "\n$1" + opt.packageJson.version + "\n");
    });
    // customize swaggerdoc
    if (
        !local.assetsDict["/assets.swgg.swagger.json"]
        || (
            /\bswggUiContainer\b/
        ).test(local.assetsDict["/index.html"])
        || local.env.npm_package_name === "utility2"
    ) {
        opt.dataTo = opt.dataTo.replace((
            /\n####\u0020swagger\u0020doc\n[\S\s]*?\n####\u0020/
        ), "\n#### ");
    }
    // customize example.js
    if (
        local.assetsDict["/index.html"].indexOf(
            "<script src=\"assets.example.js\"></script>"
        ) < 0
    ) {
        opt.dataTo = opt.dataTo.replace((
            /\nif\u0020\(!local.isBrowser\)\u0020\{\n[\S\s]*?\n\}\(\)\);\n/g
        ), "\nif (!local.isBrowser) {\n    return;\n}\n}());\n");
    }
    // customize comment
    opt.dataFrom.replace((
        /^(\u0020*?)(?:#\!\!\u0020|#\/\/\u0020|\/\/\!\!\u0020|<!--\u0020)(.*?)(?:\u0020-->)?$/gm
    ), function (match0, match1, match2) {
        opt.dataTo = opt.dataTo.replace(
            "\n" + match1 + match2 + "\n",
            "\n" + match0 + "\n"
        );
    });
    // customize - user-defined
    opt.customize(opt);
    // customize assets.index.template.html
    if (local.assetsDict["/assets.index.template.html"].indexOf(
        "\"assets.utility2.template.html\""
    ) < 0) {
        opt.dataTo = opt.dataTo.replace((
            /\n\/\*\u0020jslint\u0020ignore:start\u0020\*\/\nlocal.assetsDict\["\/assets.index.template.html"\]\u0020=\u0020'\\\n[\S\s]*?\n\/\*\u0020jslint\u0020ignore:end\u0020\*\/\n/
        ), "\n");
    }
    // customize shDeployCustom
    if (opt.dataFrom.indexOf("    shDeployCustom\n") >= 0) {
        [
            // customize example.sh
            (
                /\n####\u0020changelog\u0020[\S\s]*\n#\u0020quickstart\u0020example.js\n/
            ), (
                opt.dataFrom.indexOf("\"assets.utility2.template.html\"") < 0
                && local.identity(
                    /\n#\u0020quickstart\u0020[\S\s]*?\n#\u0020extra\u0020screenshots\n/
                )
            )
        ].forEach(function (rgx) {
            opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
        });
        // customize screenshot
        opt.dataTo = opt.dataTo.replace((
            /^1\.\u0020.*?screenshot\.(?:npmTest|testExampleJs|testExampleSh).*?\.png[\S\s]*?\n\n/gm
        ), "");
    }
    // customize shNpmTestPublished
    opt.dataTo = opt.dataTo.replace(
        "$ npm install " + local.env.GITHUB_REPO + "#alpha",
        "$ npm install " + local.env.npm_package_name
    );
    if (opt.dataFrom.indexOf("    shNpmTestPublished\n") < 0) {
        opt.dataTo = opt.dataTo.replace(
            "$ npm install " + local.env.npm_package_name,
            "$ npm install " + local.env.GITHUB_REPO + "#alpha"
        );
        [
            (
                /\n.*?\bhttps:\/\/www.npmjs.com\/package\/.*?\n/
            ), (
                /\n.*?npmPackageDependencyTree.*?\n/
            )
        ].forEach(function (rgx) {
            opt.dataTo = opt.dataTo.replace(rgx, "");
        });
    }
    // customize shBuildCiAfter and shBuildCiBefore
    [
        [
            "shDeployGithub", (
                /.*?\/screenshot\.deployGithub.*?\n/g
            )
        ], [
            "shDeployHeroku", (
                /.*?\/screenshot\.deployHeroku.*?\n/g
            )
        ], [
            "shReadmeTest example.js", (
                /.*?\/screenshot\.testExampleJs.*?\n/g
            )
        ], [
            "shReadmeTest example.sh", (
                /.*?\/screenshot\.testExampleSh.*?\n/g
            )
        ]
    ].forEach(function (elem) {
        if (opt.dataFrom.indexOf("    " + elem[0] + "\n") >= 0) {
            return;
        }
        // customize test-server
        opt.dataTo = opt.dataTo.replace(
            new RegExp(
                "\\n\\| test-server-"
                + elem[0].replace("shDeploy", "").toLowerCase()
                + " : \\|.*?\\n"
            ),
            "\n"
        );
        // customize screenshot
        opt.dataTo = opt.dataTo.replace(elem[1], "");
    });
    opt.dataTo = local.templateRenderMyApp(opt.dataTo, opt);
    // customize toc
    opt.toc = "\n# table of contents\n";
    opt.dataTo.replace((
        /\n\n\n\n#\u0020(.*)/g
    ), function (ignore, match1) {
        if (match1 === "table of contents") {
            return;
        }
        opt.toc += "1. [" + match1 + "](#" + match1.toLowerCase().replace((
            /[^\u0020\-0-9A-Z_a-z]/g
        ), "").replace((
            /\u0020/g
        ), "-") + ")\n";
    });
    opt.dataTo = opt.dataTo.replace("\n# table of contents\n", opt.toc);
    // customize whitespace
    opt.dataTo = opt.dataTo.replace((
        /\n{5,}/g
    ), "\n\n\n\n");
    // save README.md
    result = opt.dataTo;
    local.fs.writeFileSync("README.md", result);
    // customize assets.swgg.swagger.json
    opt.swaggerJson = local.swgg.normalizeSwaggerJson(
        local.fsReadFileOrEmptyStringSync("assets.swgg.swagger.json", "json")
    );
    local.objectSetOverride(opt.swaggerJson, {
        info: {
            title: opt.packageJson.name,
            version: opt.packageJson.version,
            "x-swgg-description": opt.packageJson.description,
            "x-swgg-homepage": opt.packageJson.homepage
        }
    }, 2);
    opt.dataTo.replace((
        /\bhttps:\/\/.*?\/assets\.app\.js/
    ), function (match0) {
        opt.swaggerJson["x-swgg-downloadStandaloneApp"] = (
            !local.env.npm_package_private && match0
        );
    });
    local.fsWriteFileWithMkdirpSync(
        "assets.swgg.swagger.json",
        local.jsonStringifyOrdered(opt.swaggerJson, null, 4) + "\n",
        !opt.swaggerJson.swagger && local.identity("noWrite")
    );
    onError();
    return result;
};

local.buildTest = function (opt, onError) {
/*
 * this function will build test with given <opt>
 */
    var result;
    local.objectSetDefault(opt, {
        customize: local.nop,
        dataFrom: local.fsReadFileOrEmptyStringSync("test.js", "utf8"),
        dataTo: local.templateRenderMyApp(
            local.assetsDict["/assets.test.template.js"],
            opt
        )
    });
    // search-and-replace - customize dataTo
    [
        // customize shared js\-env code - function
        (
            /\n\}\(\)\);\n\n\n\n\/\/\u0020run\u0020shared\u0020js\-env\u0020code\u0020-\u0020function\n[\S\s]*?$/
        )
    ].forEach(function (rgx) {
        opt.dataTo = local.stringMerge(opt.dataTo, opt.dataFrom, rgx);
    });
    // customize require("utility2")
    [
        "./assets.utility2.rollup.js",
        "./lib.utility2.js"
    ].forEach(function (file) {
        if (local.fs.existsSync(file)) {
            opt.dataTo = opt.dataTo.replace(
                "require(\"utility2\")",
                "require(\"" + file + "\")"
            );
        }
    });
    opt.customize(opt);
    // save test.js
    result = opt.dataTo;
    local.fs.writeFileSync("test.js", result);
    onError();
    return result;
};

local.childProcessSpawnWithTimeout = function (command, args, opt) {
/*
 * this function will run like child_process.spawn,
 * but with auto-timeout after timeout milliseconds
 * example usage:
    var child = local.childProcessSpawnWithTimeout(
        "/bin/sh",
        ["-c", "echo hello world"],
        {stdio: ["ignore", 1, 2], timeout: 5000}
    );
    child.on("error", console.error);
    child.on("exit", function (exitCode) {
        console.error("exitCode " + exitCode);
    });
 */
    var child;
    var child_process;
    var timerTimeout;
    child_process = require("child_process");
    // spawn child
    child = child_process.spawn(command, args, opt).on("exit", function () {
        // cleanup timerTimeout
        try {
            process.kill(timerTimeout.pid);
        } catch (ignore) {}
    });
    // init timerTimeout
    timerTimeout = child_process.spawn(
        // convert timeout to integer seconds with 2 second delay
        "sleep "
        + Math.floor(
            0.001 * (Number(opt && opt.timeout) || local.timeoutDefault)
            + 2
        )
        + "; kill -9 " + child.pid + " 2>/dev/null",
        {
            shell: true,
            stdio: "ignore"
        }
    );
    return child;
};

local.childProcessSpawnWithUtility2 = function (script, onError) {
/*
 * this function will run child_process.spawn, with lib.utility2.sh sourced
 */
    require("child_process").spawn(
        ". " + (process.env.npm_config_dir_utility2 || __dirname)
        + "/lib.utility2.sh; " + script,
        {
            shell: true,
            stdio: [
                "ignore", 1, 2
            ]
        }
    ).on("exit", function (exitCode) {
        onError(exitCode && Object.assign(new Error(), {
            exitCode
        }));
    });
};

local.cliRun = function (opt) {
/*
 * this function will run the cli with given <opt>
 */
    local.cliDict._eval = local.cliDict._eval || function () {
    /*
     * <code>
     * will eval <code>
     */
        globalThis.local = local;
        local.vm.runInThisContext(process.argv[3]);
    };
    local.cliDict["--eval"] = local.cliDict["--eval"] || local.cliDict._eval;
    local.cliDict["-e"] = local.cliDict["-e"] || local.cliDict._eval;
    local.cliDict._help = local.cliDict._help || function () {
    /*
     *
     * will print help
     */
        var commandList;
        var file;
        var packageJson;
        var text;
        var textDict;
        commandList = [
            {
                argList: "<arg2>  ...",
                description: "usage:",
                command: [
                    "<arg1>"
                ]
            }, {
                argList: "'console.log(\"hello world\")'",
                description: "example:",
                command: [
                    "--eval"
                ]
            }
        ];
        file = __filename.replace((
            /.*\//
        ), "");
        opt = Object.assign({}, opt);
        packageJson = require("./package.json");
        // validate comment
        opt.rgxComment = opt.rgxComment || (
            /\)\u0020\{\n(?:|\u0020{4})\/\*\n(?:\u0020|\u0020{5})\*((?:\u0020<[^>]*?>|\u0020\.\.\.)*?)\n(?:\u0020|\u0020{5})\*\u0020(will\u0020.*?\S)\n(?:\u0020|\u0020{5})\*\/\n(?:\u0020{4}|\u0020{8})\S/
        );
        textDict = {};
        Object.keys(local.cliDict).sort().forEach(function (key, ii) {
            if (key[0] === "_" && key !== "_default") {
                return;
            }
            text = String(local.cliDict[key]);
            if (key === "_default") {
                key = "";
            }
            textDict[text] = textDict[text] || (ii + 2);
            ii = textDict[text];
            if (commandList[ii]) {
                commandList[ii].command.push(key);
                return;
            }
            try {
                commandList[ii] = opt.rgxComment.exec(text);
                commandList[ii] = {
                    argList: (commandList[ii][1] || "").trim(),
                    command: [
                        key
                    ],
                    description: commandList[ii][2]
                };
            } catch (ignore) {
                local.assertThrow(null, new Error(
                    "cliRun - cannot parse comment in COMMAND "
                    + key
                    + ":\nnew RegExp("
                    + JSON.stringify(opt.rgxComment.source)
                    + ").exec(" + JSON.stringify(text).replace((
                        /\\\\/g
                    ), "\u0000").replace((
                        /\\n/g
                    ), "\\n\\\n").replace((
                        /\u0000/g
                    ), "\\\\") + ");"
                ));
            }
        });
        text = "";
        text += packageJson.name + " (" + packageJson.version + ")\n\n";
        text += commandList.filter(function (elem) {
            return elem;
        }).map(function (elem, ii) {
            elem.command = elem.command.filter(function (elem) {
                return elem;
            });
            switch (ii) {
            case 0:
            case 1:
                elem.argList = [
                    elem.argList
                ];
                break;
            default:
                elem.argList = elem.argList.split(" ");
                elem.description = (
                    "# COMMAND "
                    + (elem.command[0] || "<none>") + "\n# "
                    + elem.description
                );
            }
            return (
                elem.description + "\n  " + file
                + ("  " + elem.command.sort().join("|") + "  ")
                    .replace((
                    /^\u0020{4}$/
                ), "  ")
                + elem.argList.join("  ")
            );
        })
        .join("\n\n");
        console.log(text);
    };
    local.cliDict["--help"] = local.cliDict["--help"] || local.cliDict._help;
    local.cliDict["-h"] = local.cliDict["-h"] || local.cliDict._help;
    local.cliDict._default = local.cliDict._default || local.cliDict._help;
    local.cliDict.help = local.cliDict.help || local.cliDict._help;
    local.cliDict._interactive = local.cliDict._interactive || function () {
    /*
     *
     * will start interactive-mode
     */
        globalThis.local = local;
        local.identity(local.replStart || require("repl").start)({
            useGlobal: true
        });
    };
    local.cliDict["--interactive"] = (
        local.cliDict["--interactive"]
        || local.cliDict._interactive
    );
    local.cliDict["-i"] = local.cliDict["-i"] || local.cliDict._interactive;
    local.cliDict._version = local.cliDict._version || function () {
    /*
     *
     * will print version
     */
        console.log(require(__dirname + "/package.json").version);
    };
    local.cliDict["--version"] = (
        local.cliDict["--version"]
        || local.cliDict._version
    );
    local.cliDict["-v"] = local.cliDict["-v"] || local.cliDict._version;
    // default to --help command if no arguments are given
    if (process.argv.length <= 2) {
        local.cliDict._help();
        return;
    }
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        return;
    }
    local.cliDict._default();
};

local.corsBackendHostInject = function (url, backendHost, rgx, location) {
/*
 * this function will if <location>.host is a github site,
 * inject <backendHost> into <url> with given <rgx>
 */
    location = (
        location
        || (typeof window === "object" && window && window.location)
    );
    if (!(backendHost && location && (
        /\bgithub.io$/
    ).test(location.host))) {
        return url;
    }
    // init github-branch
    location.pathname.replace((
        /\/build\.\.(alpha|beta|master)\.\.travis-ci\.org\//
    ), function (ignore, match1) {
        backendHost = backendHost.replace("-alpha.", "-" + match1 + ".");
    });
    return url.replace(rgx || (
        /.*?($)/m
    ), backendHost + "$1");
};

local.corsForwardProxyHostIfNeeded = function (xhr) {
/*
 * this function will return xhr.corsForwardProxyHost, if needed
 */
    return (
        local.isBrowser
        && local.env.npm_package_nameLib
        && (
            /^https?:\/\//
        ).test(xhr.url)
        && xhr.url.indexOf(xhr.location.protocol + "//" + xhr.location.host)
        !== 0
        && (
            /\.github\.io$/
        ).test(xhr.location.host)
        && xhr.corsForwardProxyHost !== "disabled"
        && (xhr.corsForwardProxyHost || "https://h1-proxy1.herokuapp.com")
    );
};

/* istanbul ignore next */
local.cryptoAesXxxCbcRawDecrypt = function (opt, onError) {
/*
 * this function will aes-xxx-cbc decrypt with given <opt>
 * example usage:
    data = new Uint8Array([1,2,3]);
    key = '0123456789abcdef0123456789abcdef';
    mode = null;
    local.cryptoAesXxxCbcRawEncrypt({
        data: data,
        key: key,
        mode: mode
    }, function (err, data) {
        console.assert(!err, err);
        local.cryptoAesXxxCbcRawDecrypt({
            data: data,
            key: key,
            mode: mode
        }, console.log);
    });
 */
    var cipher;
    var crypto;
    var data;
    var ii;
    var iv;
    var key;
    // init key
    key = new Uint8Array(0.5 * opt.key.length);
    ii = 0;
    while (ii < key.byteLength) {
        key[ii] = parseInt(opt.key.slice(2 * ii, 2 * ii + 2), 16);
        ii += 2;
    }
    data = opt.data;
    // base64
    if (opt.mode === "base64") {
        data = local.base64ToBuffer(data);
    }
    // normalize data
    if (Object.prototype.toString.call(data) !== "[object Uint8Array]") {
        data = new Uint8Array(data);
    }
    // init iv
    iv = data.subarray(0, 16);
    // optimization - create resized-view of data
    data = data.subarray(16);
    crypto = globalThis.crypto;
    if (!local.isBrowser) {
        setTimeout(function () {
            crypto = require("crypto");
            cipher = crypto.createDecipheriv(
                "aes-" + (8 * key.byteLength) + "-cbc",
                key,
                iv
            );
            onError(null, Buffer.concat([
                cipher.update(data), cipher.final()
            ]));
        });
        return;
    }
    crypto.subtle.importKey("raw", key, {
        name: "AES-CBC"
    }, false, [
        "decrypt"
    ]).then(function (key) {
        crypto.subtle.decrypt({
            iv,
            name: "AES-CBC"
        }, key, data).then(function (data) {
            onError(null, new Uint8Array(data));
        }).catch(onError);
    }).catch(onError);
};

/* istanbul ignore next */
local.cryptoAesXxxCbcRawEncrypt = function (opt, onError) {
/*
 * this function will aes-xxx-cbc encrypt with given <opt>
 * example usage:
    data = new Uint8Array([1,2,3]);
    key = '0123456789abcdef0123456789abcdef';
    mode = null;
    local.cryptoAesXxxCbcRawEncrypt({
        data: data,
        key: key,
        mode: mode
    }, function (err, data) {
        console.assert(!err, err);
        local.cryptoAesXxxCbcRawDecrypt({
            data: data,
            key: key,
            mode: mode
        }, console.log);
    });
 */
    var cipher;
    var crypto;
    var data;
    var ii;
    var iv;
    var key;
    // init key
    key = new Uint8Array(0.5 * opt.key.length);
    ii = 0;
    while (ii < key.byteLength) {
        key[ii] = parseInt(opt.key.slice(2 * ii, 2 * ii + 2), 16);
        ii += 2;
    }
    data = opt.data;
    // init iv
    iv = new Uint8Array((((data.byteLength) >> 4) << 4) + 32);
    crypto = globalThis.crypto;
    if (!local.isBrowser) {
        setTimeout(function () {
            crypto = require("crypto");
            // init iv
            iv.set(crypto.randomBytes(16));
            cipher = crypto.createCipheriv(
                "aes-" + (8 * key.byteLength) + "-cbc",
                key,
                iv.subarray(0, 16)
            );
            data = cipher.update(data);
            iv.set(data, 16);
            iv.set(cipher.final(), 16 + data.byteLength);
            if (opt.mode === "base64") {
                iv = local.base64FromBuffer(iv);
                iv += "\n";
            }
            onError(null, iv);
        });
        return;
    }
    // init iv
    iv.set(crypto.getRandomValues(new Uint8Array(16)));
    crypto.subtle.importKey("raw", key, {
        name: "AES-CBC"
    }, false, [
        "encrypt"
    ]).then(function (key) {
        crypto.subtle.encrypt({
            iv: iv.subarray(0, 16),
            name: "AES-CBC"
        }, key, data).then(function (data) {
            iv.set(new Uint8Array(data), 16);
            // base64
            if (opt.mode === "base64") {
                iv = local.base64FromBuffer(iv);
                iv += "\n";
            }
            onError(null, iv);
        }).catch(onError);
    }).catch(onError);
};

local.dateGetWeekOfMonth = function (date) {
/*
 * this function will return sunday-based week-of-month from <date>
 */
    date = new Date(date.slice(0, 10) + "T00:00:00Z");
    return Math.ceil((date.getUTCDate() + new Date(
        date.getUTCFullYear(),
        date.getUTCMonth(),
        1
    ).getUTCDay()) / 7) - 1;
};

local.dateGetWeekOfYear = function (date) {
/*
 * this function will return ISO week-of-year from <date>
 *
 * Based on information at:
 *
 *    http://www.merlyn.demon.co.uk/weekcalc.htm#WNR
 *
 * Algorithm is to find nearest thursday, it's year
 * is the year of the week number. Then get weeks
 * between that date and the first day of that year.
 *
 * Note that dates in one year can be weeks of previous
 * or next year, overlap is up to 3 days.
 *
 * e.g. 2014/12/29 is Monday in week  1 of 2015
 *      2012/1/1   is Sunday in week 52 of 2011
 *
 * https://stackoverflow.com/questions/6117814/get-week-of-year-in-javascript-like-in-php
 */
    date = new Date(date.slice(0, 10) + "T00:00:00Z");
    // Set to nearest Thursday: current date + 4 - current day number
    // Make Sunday's day number 7
    date.setUTCDate(date.getUTCDate() + 4 - (date.getUTCDay() || 7));
    // Calculate full weeks to nearest Thursday
    return Math.ceil((((
        date
        // Get first day of year
        - new Date(Date.UTC(date.getUTCFullYear(), 0, 1))
    ) / 86400000) + 1) / 7);
};

local.dateUtcFromLocal = function (date, timezoneOffset) {
/*
 * this function will convert local-<date> to utc-date
 */
    if (!date) {
        return "";
    }
    local.assertThrow((
        /^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+?)?$/
    ).test(date), "invalid local-date " + date);
    if (!timezoneOffset) {
        return new Date(date).toISOString();
    }
    return new Date(
        new Date(date + "Z").getTime() + timezoneOffset * 60000
    ).toISOString();
};

local.dateUtcToLocal = function (date, timezoneOffset) {
/*
 * this function will convert utc-<date> to local-date
 */
    if (!date) {
        return "";
    }
    local.assertThrow((
        /^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+?)?Z$/
    ).test(date), "invalid utc-date " + date);
    timezoneOffset = timezoneOffset || new Date(date).getTimezoneOffset();
    return new Date(
        new Date(date).getTime() - timezoneOffset * 60000
    ).toISOString();
};

local.domFragmentRender = function (template, dict) {
/*
 * this function will return dom-elem rendered from <template>
 */
    var tmp;
    tmp = document.createElement("template");
    tmp.innerHTML = local.templateRender(template, dict);
    return tmp.content;
};

local.domQuerySelectorAllTagName = function (selector) {
/*
 * this function will return all tagName that match <selector>
 */
    var set;
    set = new Set();
    Array.from(document.querySelectorAll(
        selector
    )).forEach(function (elem) {
        set.add(elem.tagName);
    });
    return Array.from(set).sort();
};

local.domSelectOptionValue = function (elem) {
/*
 * this function will return <elem>.options[<elem>.selectedIndex].value
 */
    elem = elem && elem.options[elem.selectedIndex];
    return (elem && elem.value) || "";
};

local.domStyleValidate = function () {
/*
 * this function will validate <style> tags
 */
    var rgx;
    var tmp;
    rgx = (
        /^0\u0020(?:(body\u0020>\u0020)?(?:form\u0020>\u0020)?(?:\.testReportDiv\u0020.+|\.x-istanbul\u0020.+|\.button|\.colorError|\.readonly|\.textarea|\.uiAnimateShake|\.uiAnimateSlide|a|body|code|div|input|pre|textarea)(?:,|\u0020\{))|^[1-9]\d*?\u0020#/m
    );
    tmp = [];
    Array.from(
        // ternary-operator
        (
            typeof document === "object"
            && document
            && typeof document.querySelector === "function"
        )
        ? document.querySelectorAll(
            "style"
        )
        : []
    ).map(function (elem, ii) {
        elem.innerHTML.replace((
            /\/\*[\S\s]*?\*\/|;|\}/g
        ), "\n").replace((
            /^([^\n\u0020@].*?)[,{:].*?$/gm
        ), function (match0, match1) {
            try {
                ii = document.querySelectorAll(
                    match1
                ).length;
            } catch (errCaught) {
                console.error(errCaught);
            }
            if (!(ii > 1)) {
                tmp.push(ii + " " + match0);
            }
        });
    });
    tmp.filter(function (elem) {
        return !rgx.test(elem);
    }).sort().reverse().forEach(function (elem, ii, list) {
        console.error(
            "domStyleValidateUnmatched " + (list.length - ii) + ". " + elem
        );
    });
};

local.errorMessagePrepend = function (err, message) {
/*
 * this function will prepend message to <err>.message and <err>.stack
 */
    if (err === local.errDefault) {
        return;
    }
    err.message = message + err.message;
    err.stack = message + err.stack;
    return err;
};

local.exit = function (exitCode, testReport) {
/*
 * this function will exit current process with given <exitCode>
 */
    local.onErrorDefault(typeof exitCode !== "number" && exitCode);
    exitCode = (
        (!exitCode || Number(exitCode) === 0)
        ? 0
        : Number(exitCode) || 1
    );
    if (!local.isBrowser) {
        process.exit(exitCode);
        return;
    }
    if (testReport !== globalThis.utility2_testReport) {
        return;
    }
    // update coverage
    (document.querySelector(
        "#coverageReportDiv1"
    ) || {}).innerHTML = (
        local.istanbulCoverageReportCreate()
    );
    // save testReport
    globalThis.utility2_testReportSave();
};

local.fsReadFileOrEmptyStringSync = function (file, opt) {
/*
 * this function will try to read file or return empty-string, or
 * if <opt> === "json", then try to JSON.parse file or return null
 */
    try {
        return (
            opt === "json"
            ? JSON.parse(local.fs.readFileSync(file, "utf8"))
            : local.fs.readFileSync(file, opt)
        );
    } catch (ignore) {
        return (
            opt === "json"
            ? {}
            : ""
        );
    }
};

local.fsRmrSync = function (dir) {
/*
 * this function will synchronously "rm -fr" dir
 */
    local.child_process.execFileSync(
        "rm",
        [
            "-fr", local.path.resolve(process.cwd(), dir)
        ],
        {
            stdio: [
                "ignore", 1, 2
            ]
        }
    );
};

local.fsWriteFileWithMkdirpSync = function (file, data, mode) {
/*
 * this function will synchronously "mkdir -p" and write <data> to <file>
 */
    try {
        if (
            mode === "noWrite"
            || typeof require("fs").writeFileSync !== "function"
        ) {
            return;
        }
    } catch (ignore) {
        return;
    }
    // try to write to file
    try {
        require("fs").writeFileSync(file, data);
    } catch (ignore) {
        // mkdir -p
        require("child_process").spawnSync(
            "mkdir",
            [
                "-p", require("path").dirname(file)
            ],
            {
                stdio: [
                    "ignore", 1, 2
                ]
            }
        );
        // re-write to file
        require("fs").writeFileSync(file, data);
    }
};

local.isNullOrUndefined = function (arg0) {
/*
 * this function will test if arg0 is null or undefined
 */
    return arg0 === null || arg0 === undefined;
};

local.jslintAutofixLocalFunction = function (code, file) {
/*
 * this function will jslint-autofix local-function
 */
    var code2;
    var dictFnc;
    var dictProp;
    var tmp;
    if (local.isBrowser) {
        return code;
    }
    file = file.replace(process.cwd() + "/", "");
    switch (file) {
    case "README.md":
    case "lib." + process.env.npm_package_nameLib + ".js":
    case "lib." + process.env.npm_package_nameLib + ".sh":
    case "lib.apidoc.js":
    case "lib.db.js":
    case "lib.github_crud.js":
    case "lib.istanbul.js":
    case "lib.jslint.js":
    case "lib.marked.js":
    case "lib.sjcl.js":
    case "lib.swgg.js":
    case "npm_scripts.sh":
    case "test.js":
        break;
    default:
        return code;
    }
    // autofix - assets.example.begin.js
    code = code.replace((
        /^\(function\u0020\(globalThis\)\u0020\{\n[\S\s]*?\n\}\(this\)\);\n/m
    ), local.assetsDict["/assets.example.begin.js"]);
    // autofix - assets.my_app.template.js
    code = local.stringMerge(
        code,
        local.assetsDict["/assets.my_app.template.js"].replace((
            /my_app/g
        ), file.split(".")[1]),
        file !== "README.md" && local.identity(
            /\n\/\*\u0020istanbul\u0020instrument\u0020in\u0020package\u0020[\S\s]*?\n\/\*\u0020validateLineSortedReset\u0020\*\/\n/
        )
    );
    // customize local for assets.utility2.rollup.js
    if (
        file === "lib." + process.env.npm_package_nameLib + ".js"
        && local.fs.existsSync("./assets.utility2.rollup.js")
        && local.env.npm_package_nameLib !== "swgg"
    ) {
        code = code.replace(
            "    // || globalThis.utility2_rollup_old",
            "    || globalThis.utility2_rollup_old"
        ).replace(
            "    // || require(\"./assets.utility2.rollup.js\")",
            "    || require(\"./assets.utility2.rollup.js\")"
        );
    }
    // init functionAllDict and functionBaseDict
    [
        [
            "utility2", "swgg"
        ], [
            "utility2", "apidoc", "db", "github_crud", "swgg"
        ]
    ].forEach(function (dictList, ii) {
        tmp = (
            ii
            ? "functionAllDict"
            : "functionBaseDict"
        );
        if (local[tmp]) {
            return;
        }
        local[tmp] = {};
        dictList.forEach(function (dict) {
            dict = local[dict];
            Object.keys(dict).forEach(function (key) {
                if (
                    !(
                        /^[A-Z_]|^testCase_/m
                    ).test(key)
                    && typeof dict[key] === "function"
                ) {
                    local[tmp][key] = local[tmp][key] || String(dict[key]);
                }
            });
        });
        Object.keys(local[tmp]).forEach(function (key) {
            if (process.binding("natives")[key]) {
                local[tmp][key] = undefined;
            }
        });
    });
    // autofix - local-function
    dictFnc = {};
    dictProp = {};
    code = code.replace((
        /^local\.(.*?)\u0020=\u0020(function\u0020\([\S\s]*?\n\});\n+/gm
    ), function (match0, key, match2, match3) {
        // local-function - duplicate
        if (dictFnc[key]) {
            return "";
        }
        // local-function - normalize
        dictFnc[key] = true;
        match3 = local.functionAllDict[key] || "";
        // make shell-safe
        // https://unix.stackexchange.com/questions/57794/shell-escape-characters-for-sh-c
        if (file.slice(-3) === ".sh") {
            match3 = match3.replace((
                /'/g
            ), "'\"'\"'");
        }
        if (match3 && match3 !== match2) {
            match0 = match0.replace(match2, match3.replace((
                /\$\$|\$/g
            ), "$$$$"));
        }
        return match0.trimRight() + "\n\n";
    });
    // comment
    code2 = code;
    code2 = code2.replace((
        /^\u0020*?\/\*[\S\s]*?\*\/|^\u0020*?(?:\/\/.*?|.*?\\)$/gm
    ), "");
    // local-function - update dictFnc and dictProp
    code2.replace((
        /\blocal\.(\w+?\b)(?:\u0020(===|=|\|\|)(?:\u0020"function"\u0020&&\u0020local\.\w|\u0020|$))?/gm
    ), function (ignore, match1, match2) {
        switch (match2) {
        case "=":
            dictFnc[match1] = true;
            break;
        case "===":
        case "||":
            dictProp[match1] = false;
            break;
        default:
            dictProp[match1] = true;
        }
    });
    [
        dictFnc, dictProp
    ].forEach(function (dict) {
        Object.keys(dict).forEach(function (key) {
            dict[key] = dict[key] && local.functionBaseDict[key];
        });
    });
    dictFnc = local.jsonCopy(dictFnc);
    dictProp = local.jsonCopy(dictProp);
    [
        "assertThrow",
        "functionOrNop",
        "identity",
        "nop",
        "objectAssignDefault"
    ].forEach(function (key) {
        dictFnc[key] = true;
        dictProp[key] = true;
    });
    // local-function - missing
    switch (local.fs.existsSync("assets.utility2.rollup.js") || file) {
    case "README.md":
    case "lib.swgg.js":
    case "lib.utility2.js":
    case "test.js":
    case true:
        break;
    default:
        Object.keys(dictProp).forEach(function (key) {
            if (dictProp[key] && !dictFnc[key]) {
                console.error(
                    "local-function - missing (" + file + ") local." + key
                );
            }
        });
    }
    // local-function - unused
    switch (file) {
    case "lib.swgg.js":
    case "lib.utility2.js":
    case "lib.utility2.sh":
        break;
    default:
        Object.keys(dictFnc).forEach(function (key) {
            if (!dictProp.hasOwnProperty(key)) {
                console.error(
                    "local-function - unused (" + file + ") local." + key
                );
            }
        });
    }
    return code;
};

local.jsonCopy = function (obj) {
/*
 * this function will deep-copy obj
 */
    return (
        obj === undefined
        ? undefined
        : JSON.parse(JSON.stringify(obj))
    );
};

local.jsonStringifyOrdered = function (obj, replacer, space) {
/*
 * this function will JSON.stringify <obj>,
 * with object-keys sorted and circular-references removed
 * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Syntax
 */
    var circularSet;
    var stringify;
    var tmp;
    stringify = function (obj) {
    /*
     * this function will recursively JSON.stringify obj,
     * with object-keys sorted and circular-references removed
     */
        // if obj is not an object or function, then JSON.stringify as normal
        if (!(
            obj
            && typeof obj === "object"
            && typeof obj.toJSON !== "function"
        )) {
            return JSON.stringify(obj);
        }
        // ignore circular-reference
        if (circularSet.has(obj)) {
            return;
        }
        circularSet.add(obj);
        // if obj is an array, then recurse its items
        if (Array.isArray(obj)) {
            tmp = "[" + obj.map(function (obj) {
                // recurse
                tmp = stringify(obj);
                return (
                    typeof tmp === "string"
                    ? tmp
                    : "null"
                );
            }).join(",") + "]";
            circularSet.delete(obj);
            return tmp;
        }
        // if obj is not an array,
        // then recurse its items with object-keys sorted
        tmp = "{" + Object.keys(obj).sort().map(function (key) {
            // recurse
            tmp = stringify(obj[key]);
            if (typeof tmp === "string") {
                return JSON.stringify(key) + ":" + tmp;
            }
        }).filter(function (obj) {
            return typeof obj === "string";
        }).join(",") + "}";
        circularSet.delete(obj);
        return tmp;
    };
    circularSet = new Set();
    return JSON.stringify((
        (typeof obj === "object" && obj)
        // recurse
        ? JSON.parse(stringify(obj))
        : obj
    ), replacer, space);
};

local.jwtAes256GcmDecrypt = function (token, key) {
/*
 * this function will use json-web-encryption to
 * aes-256-gcm-decrypt <token> with given base64url-encoded <key>
 * https://tools.ietf.org/html/rfc7516
 */
    return local.tryCatchOnError(function () {
        token = token
        .replace((
            /-/g
        ), "+")
        .replace((
            /_/g
        ), "/")
        .split(".");
        token = local.sjcl.decrypt(
            local.sjcl.codec.base64url.toBits(local.jwtAes256KeyInit(key)),
            JSON.stringify({
                adata: token[4],
                ct: token[3],
                iv: token[2],
                ks: 256,
                mode: "gcm"
            })
        );
        return local.jwtHs256Decode(token, key);
    }, local.nop) || {};
};

local.jwtAes256GcmEncrypt = function (data, key) {
/*
 * this function will use json-web-encryption to
 * aes-256-gcm-encrypt <data> with given base64url-encoded <key>
 * https://tools.ietf.org/html/rfc7516
 */
    var adata;
    adata = local.jwtAes256KeyCreate();
    data = local.jwtHs256Encode(data, key);
    data = JSON.parse(local.sjcl.encrypt(
        local.sjcl.codec.base64url.toBits(local.jwtAes256KeyInit(key)),
        data,
        {
            adata: local.sjcl.codec.base64url.toBits(adata),
            ks: 256,
            mode: "gcm"
        }
    ));
    return local.normalizeJwtBase64Url(
        "eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4R0NNIn0.."
        + data.iv + "." + data.ct + "." + adata
    );
};

local.jwtAes256KeyCreate = function () {
/*
 * this function will create a random, aes-256-base64url-jwt-key
 */
    return local.normalizeJwtBase64Url(
        local.base64FromBuffer(local.bufferRandomBytes(32))
    );
};

local.jwtAes256KeyInit = function (key) {
/*
 * this function will init aes-256-base64url-jwt-<key>
 * https://jwt.io/
 */
    // init npm_config_jwtAes256Key
    local.env.npm_config_jwtAes256Key = (
        local.env.npm_config_jwtAes256Key
        || "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
    );
    return key || local.env.npm_config_jwtAes256Key;
};

local.jwtHs256Decode = function (token, key) {
/*
 * this function will decode json-web-token with given base64-encoded <key>
 * https://jwt.io/
 */
    var Hmac;
    var timeNow;
    Hmac = local.sjcl.misc.hmac;
    timeNow = Date.now() / 1000;
    // try to decode token
    return local.tryCatchOnError(function () {
        token = token.split(".");
        // validate header
        local.assertThrow(
            token[0] === "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
            token
        );
        // validate signature
        local.assertThrow(local.sjcl.codec.base64url.fromBits(
            new Hmac(local.sjcl.codec.base64url.toBits(
                local.jwtAes256KeyInit(key)
            )).encrypt(token[0] + "." + token[1])
        ) === token[2]);
        // return decoded data
        token = JSON.parse(local.base64ToUtf8(token[1]));
        // https://tools.ietf.org/html/rfc7519#section-4.1
        // validate jwt-registered-headers
        local.assertThrow(!token.exp || token.exp >= timeNow);
        local.assertThrow(!token.nbf || token.nbf <= timeNow);
        return token;
    }, local.nop) || {};
};

local.jwtHs256Encode = function (data, key) {
/*
 * this function will encode <data> into a json-web-token
 * with given base64-encoded <key>
 * https://jwt.io/
 */
    var Hmac;
    Hmac = local.sjcl.misc.hmac;
    data = (
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9."
        + local.normalizeJwtBase64Url(
            local.base64FromBuffer(JSON.stringify(data))
        )
    );
    return data + "." + local.sjcl.codec.base64url.fromBits(
        new Hmac(local.sjcl.codec.base64url.toBits(
            local.jwtAes256KeyInit(key)
        )).encrypt(data)
    );
};

local.listGetElementRandom = function (list) {
/*
 * this function will return random elem from <list>
 */
    return list[Math.floor(Math.random() * list.length)];
};

local.listShuffle = function (list) {
/*
 * this function will inplace shuffle <list> using fisher-yates algorithm
 * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle
 */
    var ii;
    var random;
    var swap;
    ii = list.length;
    while (ii > 1) {
        ii -= 1;
        random = Math.floor(Math.random() * (ii + 1));
        swap = list[ii];
        list[ii] = list[random];
        list[random] = swap;
    }
    return list;
};

local.localStorageSetItemOrClear = function (key, value) {
/*
 * this function will try to set <key>/<value> pair to localStorage,
 * or else call localStorage.clear()
 */
    try {
        localStorage.setItem(key, value);
    } catch (ignore) {
        localStorage.clear();
    }
};

local.middlewareAssetsCached = function (req, res, next) {
/*
 * this function will run middleware that will serve cached-assets
 */
    var opt;
    opt = {};
    local.onNext(opt, function (err, data) {
        opt.result = opt.result || local.assetsDict[req.urlParsed.pathname];
        if (opt.result === undefined) {
            next(err);
            return;
        }
        switch (opt.modeNext) {
        case 1:
            // skip gzip
            if (
                res.headersSent
                || !(
                    /\bgzip\b/
                ).test(req.headers["accept-encoding"])
            ) {
                opt.modeNext += 1;
                opt.onNext();
                return;
            }
            // gzip and cache result
            local.taskCreateCached({
                cacheDict: "middlewareAssetsCachedGzip",
                key: req.urlParsed.pathname
            }, function (onError) {
                local.zlib.gzip(opt.result, function (err, data) {
                    onError(err, !err && data.toString("base64"));
                });
            }, opt.onNext);
            break;
        case 2:
            // set gzip header
            opt.result = local.base64ToBuffer(data);
            res.setHeader("Content-Encoding", "gzip");
            res.setHeader("Content-Length", opt.result.length);
            opt.onNext();
            break;
        case 3:
            local.middlewareCacheControlLastModified(
                req,
                res,
                opt.onNext
            );
            break;
        case 4:
            res.end(opt.result);
            break;
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.middlewareBodyRead = function (req, ignore, next) {
/*
 * this function will run middleware that will
 * read and save the <req>-body to <req>.bodyRaw
 */
    // if req is already read, then goto next
    if (!req.readable) {
        next();
        return;
    }
    local.streamReadAll(req, function (err, data) {
        req.bodyRaw = req.bodyRaw || data;
        next(err);
    });
};

local.middlewareCacheControlLastModified = function (req, res, next) {
/*
 * this function will run middleware that will update res-header last-modified
 */
    // do not cache if headers already sent or url has '?' search indicator
    if (res.headersSent || req.url.indexOf("?") >= 0) {
        next();
        return;
    }
    // init serverResponseHeaderLastModified
    local.serverResponseHeaderLastModified = (
        local.serverResponseHeaderLastModified
        // resolve to 1000 ms
        || new Date(new Date().toUTCString())
    );
    // respond with 304 If-Modified-Since serverResponseHeaderLastModified
    if (
        new Date(req.headers["if-modified-since"])
        >= local.serverResponseHeaderLastModified
    ) {
        res.statusCode = 304;
        res.end();
        return;
    }
    res.setHeader("Cache-Control", "no-cache");
    res.setHeader(
        "Last-Modified",
        local.serverResponseHeaderLastModified.toUTCString()
    );
    next();
};

local.middlewareError = function (err, req, res) {
/*
 * this function will run middleware that will handle errors
 */
    // default - 404 Not Found
    if (!err) {
        local.serverRespondDefault(req, res, 404);
        return;
    }
    // http://jsonapi.org/format/#errors
    if (local.swgg && typeof local.swgg.serverRespondJsonapi === "function") {
        local.swgg.serverRespondJsonapi(req, res, err);
    }
    // statusCode [400, 600)
    local.serverRespondDefault(req, res, (
        (err.statusCode >= 400 && err.statusCode < 600)
        ? err.statusCode
        : 500
    ), err);
};

local.middlewareFileServer = function (req, res, next) {
/*
 * this function will run middleware that will serve files
 */
    if (req.method !== "GET" || local.isBrowser) {
        next();
        return;
    }
    req.urlFile = (process.cwd() + req.urlParsed.pathname
    // security - disable parent directory lookup
    .replace((
        /.*\/\.\.\//g
    ), "/"))
        // replace trailing '/' with '/index.html'
        .replace((
        /\/$/
    ), "/index.html");
    // serve file from cache
    local.taskCreateCached({
        cacheDict: "middlewareFileServer",
        key: req.urlFile
    // run background-task to re-cache file
    }, function (onError) {
        local.fs.readFile(req.urlFile, function (err, data) {
            onError(err, data && local.base64FromBuffer(data));
        });
    }, function (err, data) {
        // default to next
        if (err) {
            next();
            return;
        }
        // init res-header content-type
        local.serverRespondHeadSet(req, res, null, {
            "Content-Type": local.contentTypeDict[(
                /\.[^.]*?$|$/m
            ).exec(req.urlParsed.pathname)[0]]
        });
        // serve file from cache
        res.end(local.base64ToBuffer(data));
    });
};

local.middlewareForwardProxy = function (req, res, next) {
/*
 * this function will run middleware that will forward-proxy <req>
 * to its destination-host
 */
    var isDone;
    var onError;
    var opt;
    var timerTimeout;
    // handle preflight-cors
    if (req.method === "OPTIONS" && (
        /forward-proxy-url/
    )
    .test(req.headers["access-control-request-headers"])) {
        local.serverRespondCors(req, res);
        res.end();
        return;
    }
    if (!req.headers["forward-proxy-url"]) {
        next();
        return;
    }
    local.serverRespondCors(req, res);
    // init onError
    onError = function (err) {
        if (isDone) {
            return;
        }
        isDone = true;
        // cleanup timerTimeout
        clearTimeout(timerTimeout);
        // debug middlewareForwardProxy
        console.error("serverLog - " + JSON.stringify({
            time: new Date(opt.timeStart).toISOString(),
            type: "middlewareForwardProxyResponse",
            method: opt.method,
            url: opt.url,
            statusCode: res.statusCode | 0,
            timeElapsed: Date.now() - opt.timeStart,
            // extra
            headers: opt.headers
        }));
        if (!err) {
            return;
        }
        // cleanup clientReq and clientRes
        local.streamCleanup(opt.clientReq);
        local.streamCleanup(opt.clientResponse);
        next(err);
    };
    // init opt
    opt = local.urlParse(req.headers["forward-proxy-url"]);
    opt.method = req.method;
    opt.url = req.headers["forward-proxy-url"];
    // init timerTimeout
    timerTimeout = local.onTimeout(
        onError,
        local.timeoutDefault,
        "forward-proxy " + opt.method + " " + opt.url
    );
    // parse headers
    opt.headers = {};
    local.tryCatchOnError(function () {
        opt.headers = JSON.parse(req.headers["forward-proxy-headers"]);
    }, local.nop);
    // debug opt
    local._debugForwardProxy = opt;
    opt.clientReq = (
        opt.protocol === "https:"
        ? local.https
        : local.http
    ).request(opt, function (clientResponse) {
        opt.clientResponse = clientResponse.on("error", onError);
        res.statusCode = opt.clientResponse.statusCode;
        // pipe clientResponse to serverResponse
        opt.clientResponse.pipe(res);
    }).on("error", onError);
    opt.timeStart = Date.now();
    // init event-handling
    req.on("error", onError);
    res.on("finish", onError).on("error", onError);
    // pipe serverReq to clientReq
    req.pipe(opt.clientReq);
};

local.middlewareInit = function (req, res, next) {
/*
 * this function will run middleware that will init <req> and <res>
 */
    // debug req and res
    local._debugServerReqRes4 = local._debugServerReqRes3;
    local._debugServerReqRes3 = local._debugServerReqRes2;
    local._debugServerReqRes2 = local._debugServerReqRes1;
    local._debugServerReqRes1 = {
        req,
        res
    };
    // init timerTimeout
    local.serverRespondTimeoutDefault(req, res, local.timeoutDefault);
    // init req.urlParsed
    req.urlParsed = local.urlParse(req.url);
    // init res-header content-type
    local.serverRespondHeadSet(req, res, null, {
        "Content-Type": local.contentTypeDict[(
            /\.[^.]*?$|$/m
        ).exec(req.urlParsed.pathname)[0]]
    });
    // set main-page content-type to text/html
    if (req.urlParsed.pathname === "/") {
        local.serverRespondHeadSet(req, res, null, {
            "Content-Type": "text/html; charset=utf-8"
        });
    }
    // default to next
    next();
};

local.middlewareJsonpStateInit = function (req, res, next) {
/*
 * this function will run middleware that will
 * serve the browser-state wrapped in given jsonp-callback
 */
    var state;
    if (!(req.stateInit || (
        req.urlParsed
        && req.urlParsed.pathname === "/jsonp.utility2.stateInit"
    ))) {
        next();
        return;
    }
    state = {
        utility2: {
            assetsDict: {
                "/assets.example.html":
                local.assetsDict["/assets.example.html"],
                "/assets.example.js": local.assetsDict["/assets.example.js"],
                "/assets.swgg.swagger.json":
                local.assetsDict["/assets.swgg.swagger.json"],
                "/assets.test.js": local.assetsDict["/assets.test.js"],
                "/assets.utility2.base.html":
                local.assetsDict["/assets.utility2.base.rollup.html"],
                "/index.rollup.html": local.assetsDict["/index.rollup.html"]
            },
            env: {
                NODE_ENV: local.env.NODE_ENV,
                npm_config_mode_backend: local.env.npm_config_mode_backend,
                npm_package_assetsList: local.env.npm_package_assetsList,
                npm_package_description: local.env.npm_package_description,
                npm_package_homepage: local.env.npm_package_homepage,
                npm_package_name: local.env.npm_package_name,
                npm_package_nameLib: local.env.npm_package_nameLib,
                npm_package_version: local.env.npm_package_version
            }
        }
    };
    (local.env.npm_package_assetsList || "").split(" ").forEach(function (
        file
    ) {
        local.assetsDict["/" + file] = (
            local.assetsDict["/" + file]
            || local.fsReadFileOrEmptyStringSync(file, "utf8")
        );
        state.utility2.assetsDict["/" + file] = local.assetsDict["/" + file];
    });
    if (req.stateInit) {
        return state;
    }
    res.end(
        req.urlParsed.query.callback + "(" + JSON.stringify(state) + ");"
    );
};

local.moduleDirname = function (module, modulePathList) {
/*
 * this function will search modulePathList for the module's __dirname
 */
    var result;
    // search process.cwd()
    if (!module || module === "." || module.indexOf("/") >= 0) {
        return require("path").resolve(process.cwd(), module || "");
    }
    // search modulePathList
    [
        "node_modules"
    ]
    .concat(modulePathList)
    .concat(require("module").globalPaths)
    .concat([
        process.env.HOME + "/node_modules", "/usr/local/lib/node_modules"
    ])
    .some(function (modulePath) {
        try {
            result = require("path").resolve(
                process.cwd(),
                modulePath + "/" + module
            );
            result = require("fs").statSync(result).isDirectory() && result;
            return result;
        } catch (ignore) {
            result = null;
        }
        return result;
    });
    return result || "";
};

local.normalizeChunk = function (chunk) {
/*
 * this function will normalize the chunk
 */
    return chunk || "";
};

local.normalizeJwt = function (data) {
/*
 * this function will normalize the jwt-data with registered-headers
 * https://tools.ietf.org/html/rfc7519#section-4.1
 */
    var timeNow;
    timeNow = Date.now() / 1000;
    return local.objectSetDefault(data, {
        exp: timeNow + 5 * 60,
        iat: timeNow,
        jti: Math.random().toString(16).slice(2),
        nbf: timeNow
    });
};

local.normalizeJwtBase64Url = function (b64) {
/*
 * this function will normlize <b64> to base64url format
 */
    return b64
    .replace((
        /\=/g
    ), "")
    .replace((
        /\+/g
    ), "-")
    .replace((
        /\//g
    ), "_");
};

local.numberToRomanNumerals = function (num) {
/*
 * this function will convert num to a roman-numeral
 * https://stackoverflow.com/questions/9083037/convert-a-number-into-a-roman-numeral-in-javascript
 */
    var digits;
    var ii;
    var key;
    var roman;
    digits = String(num).split("");
    key = [
        "", "C", "CC", "CCC", "CD", "D", "DC", "DCC", "DCCC", "CM",
        "", "X", "XX", "XXX", "XL", "L", "LX", "LXX", "LXXX", "XC",
        "", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX"
    ];
    roman = "";
    ii = 3;
    while (ii) {
        ii -= 1;
        roman = (key[Number(digits.pop()) + (ii * 10)] || "") + roman;
    }
    return new Array(Number(digits.join("") + 1)).join("M") + roman;
};

local.objectSetDefault = function (dict, defaults, depth) {
/*
 * this function will recursively set defaults for undefined-items in dict
 */
    dict = dict || {};
    defaults = defaults || {};
    Object.keys(defaults).forEach(function (key) {
        var defaults2;
        var dict2;
        dict2 = dict[key];
        // handle misbehaving getter
        try {
            defaults2 = defaults[key];
        } catch (ignore) {}
        if (defaults2 === undefined) {
            return;
        }
        // init dict[key] to default value defaults[key]
        switch (dict2) {
        case "":
        case null:
        case undefined:
            dict[key] = defaults2;
            return;
        }
        // if dict2 and defaults2 are both non-null and non-array objects,
        // then recurse with dict2 and defaults2
        if (
            depth > 1
            // dict2 is a non-null and non-array object
            && typeof dict2 === "object" && dict2 && !Array.isArray(dict2)
            // defaults2 is a non-null and non-array object
            && typeof defaults2 === "object" && defaults2
            && !Array.isArray(defaults2)
        ) {
            // recurse
            local.objectSetDefault(dict2, defaults2, depth - 1);
        }
    });
    return dict;
};

local.objectSetOverride = function (dict, overrides, depth, env) {
/*
 * this function will recursively set overrides for items in dict
 */
    dict = dict || {};
    env = env || (typeof process === "object" && process.env) || {};
    overrides = overrides || {};
    Object.keys(overrides).forEach(function (key) {
        var dict2;
        var overrides2;
        dict2 = dict[key];
        overrides2 = overrides[key];
        if (overrides2 === undefined) {
            return;
        }
        // if both dict2 and overrides2 are non-null and non-array objects,
        // then recurse with dict2 and overrides2
        if (
            depth > 1
            // dict2 is a non-null and non-array object
            && typeof dict2 === "object" && dict2 && !Array.isArray(dict2)
            // overrides2 is a non-null and non-array object
            && typeof overrides2 === "object" && overrides2
            && !Array.isArray(overrides2)
        ) {
            local.objectSetOverride(dict2, overrides2, depth - 1, env);
            return;
        }
        // else set dict[key] with overrides[key]
        dict[key] = (
            dict === env
            // if dict is env, then overrides falsy-value with empty-string
            ? overrides2 || ""
            : overrides2
        );
    });
    return dict;
};

local.onErrorDefault = function (err) {
/*
 * this function will if <err> exists, then print it to stderr
 */
    if (err) {
        console.error(err);
    }
    return err;
};

local.onErrorThrow = function (err) {
/*
 * this function will if <err> exists, then throw it
 */
    if (err) {
        throw err;
    }
    return err;
};

local.onErrorWithStack = function (onError) {
/*
 * this function will create wrapper around <onError>
 * that will append current-stack to err.stack
 */
    var onError2;
    var stack;
    stack = new Error().stack.replace((
        /(.*?)\n.*?$/m
    ), "$1");
    onError2 = function (err, data, meta) {
        if (
            err
            && typeof err.stack === "string"
            && err !== local.errDefault
            && String(err.stack).indexOf(stack.split("\n")[2]) < 0
        ) {
            // append current-stack to err.stack
            err.stack += "\n" + stack;
        }
        onError(err, data, meta);
    };
    // debug onError
    onError2.toString = function () {
        return String(onError);
    };
    return onError2;
};

local.onFileModifiedRestart = function (file) {
/*
 * this function will watch the file, and if modified, then restart the process
 */
    if (
        local.env.npm_config_mode_auto_restart
        && local.fs.existsSync(file)
        && local.fs.statSync(file).isFile()
    ) {
        local.fs.watchFile(file, {
            interval: 1000,
            persistent: false
        }, function (stat2, stat1) {
            if (stat2.mtime > stat1.mtime) {
                console.error("file modified - " + file);
                setTimeout(function () {
                    local.exit(77);
                }, 1000);
            }
        });
    }
};

local.onNext = function (opt, onError) {
/*
 * this function will wrap onError inside recursive-function <opt>.onNext,
 * and append the current-stack to any err
 */
    opt.onNext = local.onErrorWithStack(function (err, data, meta) {
        try {
            opt.modeNext += (
                (err && !opt.modeErrorIgnore)
                ? 1000
                : 1
            );
            if (opt.modeDebug) {
                console.error("onNext - " + JSON.stringify({
                    modeNext: opt.modeNext,
                    errorMessage: err && err.message
                }));
                if (err && err.stack) {
                    console.error(err.stack);
                }
            }
            onError(err, data, meta);
        } catch (errCaught) {
            // throw errCaught to break infinite recursion-loop
            if (opt.errCaught) {
                local.assertThrow(null, opt.errCaught);
            }
            opt.errCaught = errCaught;
            opt.onNext(errCaught, data, meta);
        }
    });
    return opt;
};

local.onParallel = function (onError, onEach, onRetry) {
/*
 * this function will create a function that will
 * 1. run async tasks in parallel
 * 2. if counter === 0 or err occurred, then call onError(err)
 */
    var onParallel;
    onError = local.onErrorWithStack(onError);
    onEach = onEach || local.nop;
    onRetry = onRetry || local.nop;
    onParallel = function (err, data) {
        if (onRetry(err, data)) {
            return;
        }
        // decrement counter
        onParallel.counter -= 1;
        // validate counter
        if (!(onParallel.counter >= 0 || err || onParallel.err)) {
            err = new Error(
                "invalid onParallel.counter = " + onParallel.counter
            );
        // ensure onError is run only once
        } else if (onParallel.counter < 0) {
            return;
        }
        // handle err
        if (err) {
            onParallel.err = err;
            // ensure counter <= 0
            onParallel.counter = -Math.abs(onParallel.counter);
        }
        // call onError when isDone
        if (onParallel.counter <= 0) {
            onError(err, data);
            return;
        }
        onEach();
    };
    // init counter
    onParallel.counter = 0;
    // return callback
    return onParallel;
};

local.onParallelList = function (opt, onEach, onError) {
/*
 * this function will
 * 1. async-run onEach in parallel,
 *    with given <opt>.rateLimit and <opt>.retryLimit
 * 2. call <onError> when onParallel.ii + 1 === <opt>.list.length
 */
    var isListEnd;
    var onEach2;
    var onParallel;
    opt.list = opt.list || [];
    onEach2 = function () {
        while (true) {
            if (!(onParallel.ii + 1 < opt.list.length)) {
                isListEnd = true;
                return;
            }
            if (!(onParallel.counter < opt.rateLimit + 1)) {
                return;
            }
            onParallel.ii += 1;
            onEach({
                elem: opt.list[onParallel.ii],
                ii: onParallel.ii,
                list: opt.list,
                retry: 0
            }, onParallel);
        }
    };
    onParallel = local.onParallel(onError, onEach2, function (err, data) {
        if (err && data && data.retry < opt.retryLimit) {
            local.onErrorDefault(err);
            data.retry += 1;
            setTimeout(function () {
                onParallel.counter -= 1;
                onEach(data, onParallel);
            }, 1000);
            return true;
        }
        // restart if opt.list has grown
        if (isListEnd && (onParallel.ii + 1 < opt.list.length)) {
            isListEnd = null;
            onEach2();
        }
    });
    onParallel.ii = -1;
    opt.rateLimit = Number(opt.rateLimit) || 6;
    opt.rateLimit = Math.max(opt.rateLimit, 1);
    opt.retryLimit = Number(opt.retryLimit) || 2;
    onParallel.counter += 1;
    onEach2();
    onParallel();
};

local.onTimeout = function (onError, timeout, message) {
/*
 * this function will create a timeout-err-handler,
 * that appends current-stack to any err encountered
 */
    onError = local.onErrorWithStack(onError);
    // create timerTimeout
    return setTimeout(function () {
        onError(new Error(
            "onTimeout - errTimeout - " + timeout + " ms - " + message
        ));
    // coerce to finite integer
    }, timeout);
};

local.profile = function (fnc, onError) {
/*
 * this function will profile async <fnc> in milliseconds
 * with callback <onError>
 */
    var timeStart;
    timeStart = Date.now();
    // run async fnc
    fnc(function (err) {
        // call onError with difference in milliseconds
        // between Date.now() and timeStart
        onError(err, Date.now() - timeStart);
    });
};

local.profileSync = function (fnc) {
/*
 * this function will profile sync <fnc> in milliseconds
 */
    var timeStart;
    timeStart = Date.now();
    // run sync fnc
    fnc();
    // return difference in milliseconds between Date.now() and timeStart
    return Date.now() - timeStart;
};

local.replStart = function () {
/*
 * this function will start the repl-debugger
 */
    var that;
    if (globalThis.utility2_repl1) {
        return;
    }
    // start repl
    that = require("repl").start({
        useGlobal: true
    });
    globalThis.utility2_repl1 = that;
    that.onError = function (err) {
    /*
     * this function will debug repl-err
     */
        globalThis.utility2_debugReplError = err;
        console.error(err);
    };
    // save eval-function
    that.evalDefault = that.eval;
    // hook custom-eval-function
    that.eval = function (script, context, file, onError) {
        var onError2;
        onError2 = function (err, data) {
            // debug err
            globalThis.utility2_debugReplError = (
                err || globalThis.utility2_debugReplError
            );
            onError(err, data);
        };
        script.replace((
            /^(\S+)\u0020(.*?)\n/
        ), function (ignore, match1, match2) {
            switch (match1) {
            // syntax-sugar - run async shell-command
            case "$":
                switch (match2) {
                // syntax-sugar - run git diff
                case "git diff":
                    match2 = "git diff --color | cat";
                    break;
                // syntax-sugar - run git log
                case "git log":
                    match2 = "git log -n 4 | cat";
                    break;
                // syntax-sugar - run git log
                case "ll":
                    match2 = "ls -Fal";
                    break;
                }
                // source lib.utility2.sh
                if (
                    process.platform !== "win32"
                    && process.env.npm_config_dir_utility2 && (match2 !== ":")
                ) {
                    match2 = (
                        ". " + process.env.npm_config_dir_utility2
                        + "/lib.utility2.sh;" + match2
                    );
                }
                // run async shell-command
                require("child_process").spawn(match2, {
                    shell: true,
                    stdio: [
                        "ignore", 1, 2
                    ]
                // on shell exit, print return prompt
                }).on("exit", function (exitCode) {
                    console.error("exit-code " + exitCode);
                    that.evalDefault(
                        "\n",
                        context,
                        file,
                        onError2
                    );
                });
                script = "\n";
                break;
            // syntax-sugar - map text with charCodeAt
            case "charCode":
                console.error(
                    match2.split("").map(function (chr) {
                        return (
                            "\\u"
                            + chr.charCodeAt(0).toString(16).padStart(4, 0)
                        );
                    }).join("")
                );
                script = "\n";
                break;
            // syntax-sugar - sort chr
            case "charSort":
                console.error(JSON.stringify(match2.split("").sort().join("")));
                script = "\n";
                break;
            // syntax-sugar - grep current dir
            case "grep":
                // run async shell-command
                require("child_process").spawn((
                    "find . -type f | grep -v -E "
/* jslint ignore:start */
+ '"\
/\\.|(\\b|_)(\\.\\d|\
archive|artifact|\
bower_component|build|\
coverage|\
doc|\
external|\
fixture|\
git_module|\
jquery|\
log|\
min|misc|mock|\
node_module|\
raw|\rollup|\
swp|\
tmp|\
vendor)s{0,1}(\\b|_)\
" '
/* jslint ignore:end */
                    + "| tr \"\\n\" \"\\000\" | xargs -0 grep -HIin -E \""
                    + match2 + "\""
                ), {
                    shell: true,
                    stdio: [
                        "ignore", 1, 2
                    ]
                })
                // on shell exit, print return prompt
                .on("exit", function (exitCode) {
                    console.error("exit-code " + exitCode);
                    that.evalDefault(
                        "\n",
                        context,
                        file,
                        onError2
                    );
                });
                script = "\n";
                break;
            // syntax-sugar - list object's keys, sorted by item-type
            // console.error(Object.keys(global).map(function(key){return(typeof global[key]==='object'&&global[key]&&global[key]===global[key]?'global':typeof global[key])+' '+key;}).sort().join('\n')) // jslint ignore:line
            case "keys":
                script = (
                    "console.error(Object.keys(" + match2
                    + ").map(function(key){return("
                    + "typeof " + match2 + "[key]==='object'&&"
                    + match2 + "[key]&&"
                    + match2 + "[key]===global[key]"
                    + "?'global'"
                    + ":typeof " + match2 + "[key]"
                    + ")+' '+key;"
                    + "}).sort().join('\\n'))\n"
                );
                break;
            // syntax-sugar - print stringified arg
            case "print":
                script = "console.error(String(" + match2 + "))\n";
                break;
            // syntax-sugar - read file
            case "readFile":
                try {
                    console.error(JSON.stringify(
                        require("fs").readFileSync(match2, "utf8")
                    ));
                } catch (errCaught) {
                    console.error(errCaught);
                }
                script = "\n";
                break;
            }
        });
        // eval the script
        that.evalDefault(script, context, file, onError2);
    };
    that.socket = {
        end: local.nop,
        on: local.nop,
        write: local.nop
    };
    // init process.stdout
    process.stdout._writeDefault = (
        process.stdout._writeDefault
        || process.stdout._write
    );
    process.stdout._write = function (chunk, encoding, callback) {
        process.stdout._writeDefault(chunk, encoding, callback);
        // coverage-hack - ignore else-statement
        local.nop(that.socket.writable && (function () {
            that.socket.write(chunk, encoding);
        }()));
    };
    // start serverRepl1
    globalThis.utility2_serverRepl1 = require("net").createServer(function (
        socket
    ) {
        // init socket
        that.socket = socket;
        that.socket.on("data", that.write.bind(that));
        that.socket.on("error", that.onError);
        that.socket.setKeepAlive(true);
    });
    // coverage-hack - ignore else-statement
    local.nop(process.env.PORT_REPL && (function () {
        console.error(
            "repl-server listening on port " + process.env.PORT_REPL
        );
        globalThis.utility2_serverRepl1.listen(process.env.PORT_REPL);
    }()));
};

local.requireInSandbox = function (file) {
/*
 * this function will require the file in a sandbox-lite env
 */
    var exports;
    var mockDict;
    var mockList;
    var tmp;
    mockList = [
        [
            globalThis, {
                setImmediate: local.nop,
                setInterval: local.nop,
                setTimeout: local.nop
            }
        ]
    ];
    [
        [
            local, "child_process"
        ], [
            local, "cluster"
        ], [
            local, "http"
        ], [
            local, "https"
        ], [
            local, "net"
        ], [
            local, "repl"
        ], [
            local.events, "prototype"
        ], [
            globalThis, "process"
        ], [
            local.stream, "prototype"
        ], [
            process, "stdin"
        ]
    ].forEach(function (elem) {
        tmp = elem[0][elem[1]];
        mockDict = {};
        Object.keys(tmp).forEach(function (key) {
            if (
                typeof tmp[key] === "function"
                && !(
                    /^(?:fs\.Read|fs\.read|process\.binding|process\.dlopen)/
                )
                .test(elem[1] + "." + key)
            ) {
                mockDict[key] = function () {
                    return;
                };
                // coverage-hack
                mockDict[key]();
            }
        });
        mockList.push([
            tmp, mockDict
        ]);
    });
    local.testMock(mockList, function (onError) {
        local.tryCatchOnError(function () {
            exports = require(file);
        }, local.onErrorDefault);
        onError();
    }, local.onErrorThrow);
    return exports;
};

local.requireReadme = function () {
/*
 * this function will require and export example.js embedded in README.md
 */
    var code;
    var module;
    var tmp;
    // init module.exports
    module = {};
    if (local.isBrowser) {
        module.exports = local.objectSetDefault(
            globalThis.utility2_rollup || globalThis.local,
            local
        );
        return module.exports;
    }
    // start repl-debugger
    local.replStart();
    // debug dir
    [
        __dirname + "/lib.jslint.js",
        __filename,
        "undefined"
    ].forEach(function (file) {
        local.fs.exists(file, function (exists) {
            if (exists) {
                local.onFileModifiedRestart(file);
            }
        });
    });
    local.fs.readdirSync(process.cwd()).forEach(function (file) {
        file = process.cwd() + "/" + file;
        // if the file is modified, then restart the process
        local.onFileModifiedRestart(file);
        switch (local.path.basename(file)) {
        // swagger-validate assets.swgg.swagger.json
        case "assets.swgg.swagger.json":
            local.fs.readFile(file, "utf8", function (err, data) {
                local.tryCatchOnError(function () {
                    // validate no err occurred
                    local.assertThrow(!err, err);
                    local.swgg.swaggerValidate(JSON.parse(data));
                }, local.onErrorDefault);
            });
            break;
        }
    });
    // jslint process.cwd()
    if (!local.env.npm_config_mode_library) {
        local.child_process.spawn("node", [
            "-e", (
                "require("
                + JSON.stringify(__filename)
                + ").jslint.jslintAndPrintDir("
                + JSON.stringify(process.cwd())
                + ", {autofix:true,conditional:true}, process.exit);"
            )
        ], {
            env: local.objectAssignDefault({
                npm_config_mode_library: "1"
            }, local.env),
            stdio: [
                "ignore", "ignore", 2
            ]
        });
    }
    if (globalThis.utility2_rollup || local.env.npm_config_mode_start) {
        // init assets
        local.assetsDict["/index.html"] = (
            local.fsReadFileOrEmptyStringSync("index.html")
            || local.assetsDict["/index.rollup.html"] || ""
        );
        local.assetsDict["/"] = local.assetsDict["/index.html"];
        local.assetsDict["/assets.app.js"] = local.fs.readFileSync(
            __filename,
            "utf8"
        ).replace((
            /^#!\//
        ), "// ");
        // init exports
        local[local.env.npm_package_nameLib] = local;
        module.exports = local;
        return module.exports;
    }
    // init file $npm_package_main
    globalThis.utility2_moduleExports = require(
        process.cwd() + "/" + local.env.npm_package_main
    );
    globalThis.utility2_moduleExports.globalThis = globalThis;
    // read code from README.md
    code = local.templateRenderMyApp(
        local.assetsDict["/assets.example.template.js"],
        {}
    );
    local.tryCatchOnError(function () {
        tmp = (
            /```\w*?(\n[\W\s]*?example\.js[\n"][\S\s]*?)\n```/
        ).exec(
            local.fs.readFileSync("README.md", "utf8")
        );
        code = tmp.input.slice(0, tmp.index).replace((
            /.+/g
        ), "") + tmp[1];
    }, local.nop);
    code = code
    // alias require($npm_package_name) to utility2_moduleExports;
    .replace(
        new RegExp("require\\(." + local.env.npm_package_name + ".\\)"),
        "globalThis.utility2_moduleExports"
    )
    .replace(
        new RegExp("require\\(." + local.env.npm_package_nameOriginal + ".\\)"),
        "globalThis.utility2_moduleExports"
    );
    // init example.js
    tmp = process.cwd() + "/example.js";
    // jslint code
    local.jslintAndPrint(code, tmp);
    // cover code
    code = local.istanbulInstrumentInPackage(code, tmp);
    // init module.exports
    module = new local.Module(tmp);
    require.cache[tmp] = module;
    // load code into module
    module._compile(code, tmp);
    // init exports
    module.exports.utility2 = local;
    module.exports[local.env.npm_package_nameLib] = (
        globalThis.utility2_moduleExports
    );
    // init assets
    tmp = process.cwd() + "/" + local.env.npm_package_main;
    local.assetsDict["/assets." + local.env.npm_package_nameLib + ".js"] = (
        local.fs.readFileSync(tmp, "utf8").replace((
            /^#!\//
        ), "// ")
    );
    local.objectSetOverride(local.assetsDict, module.exports.assetsDict);
    local.assetsDict["/assets." + local.env.npm_package_nameLib + ".js"] = (
        local.istanbulInstrumentInPackage(
            local.assetsDict[
                "/assets." + local.env.npm_package_nameLib + ".js"
            ],
            tmp
        )
    );
    module.exports.assetsDict = local.assetsDict;
    local.assetsDict["/assets.example.js"] = code;
    local.assetsDict["/assets.test.js"] = local.istanbulInstrumentInPackage(
        local.fs.readFileSync("test.js", "utf8"),
        process.cwd() + "/test.js"
    );
    // init assets index.html
    [
        "", ".rollup"
    ].forEach(function (isRollup) {
        [
            "index", "utility2"
        ].forEach(function (file) {
            tmp = "assets." + file + ".template.html";
            local.assetsDict["/" + tmp] = (
                local.fsReadFileOrEmptyStringSync(tmp, "utf8")
                || local.assetsDict["/" + tmp]
            );
            file = (
                file.replace("utility2", "assets.utility2.base") + isRollup
                + ".html"
            );
            local.assetsDict["/" + file] = local.fsReadFileOrEmptyStringSync(
                file,
                "utf8"
            ) || local.templateRender(
                // uncomment utility2-comment
                local.assetsDict["/" + tmp].replace((
                    /<!--\u0020utility2-comment\b([\S\s]*?)\butility2-comment\u0020-->/g
                ), "$1"),
                {
                    env: local.env,
                    isRollup
                }
            );
        });
    });
    local.assetsDict["/"] = local.assetsDict["/index.html"];
    // init assets.app.js
    local.assetsDict["/assets.app.js"] = [
        "header",
        "/assets.utility2.rollup.js",
        "/assets.utility2.rollup.begin.js",
        "local.stateInit",
        "/assets.my_app.js",
        "/assets.example.js",
        "/assets.test.js",
        "/assets.utility2.rollup.end.js"
    ].map(function (key) {
        switch (key) {
/* jslint ignore:start */
case 'header':
return '\
/* this rollup was created with utility2\n\
 * https://github.com/kaizhu256/node-utility2\n\
 */\n\
\n\
\n\
\n\
/*\n\
assets.app.js\n\
\n\
' + local.env.npm_package_description + '\n\
\n\
instruction\n\
    1. save this script as assets.app.js\n\
    2. run the shell-command:\n\
        $ PORT=8081 node assets.app.js\n\
    3. open a browser to http://127.0.0.1:8081 and play with the web-demo\n\
    4. edit this script to suit your needs\n\
*/\n\
' + local.assetsDict["/assets.utility2.rollup.begin.js"]
    .replace((/utility2_rollup/g), 'utility2_app');
/* jslint ignore:end */
        case "/assets.my_app.js":
            // handle large string-replace
            tmp = "/assets." + local.env.npm_package_nameLib + ".js";
            code = local.assetsDict["/assets.utility2.rollup.content.js"]
            .split("/* utility2.rollup.js content */");
            code.splice(
                1,
                0,
                "local.assetsDict[\"" + tmp + "\"] = "
                + JSON.stringify(local.assetsDict[tmp]).replace((
                    /\\\\/g
                ), "\u0000").replace((
                    /\\n/g
                ), "\\n\\\n").replace((
                    /\u0000/g
                ), "\\\\")
            );
            code = code.join("");
            code += "\n";
            code += local.assetsDict[tmp];
            break;
        case "local.stateInit":
            // handle large string-replace
            code = local.assetsDict["/assets.utility2.rollup.content.js"]
            .split("/* utility2.rollup.js content */");
            tmp = local.middlewareJsonpStateInit({
                stateInit: true
            });
            // add extra physical files to assetsDict
            local.fs.readdirSync(".").forEach(function (file) {
                file = "/" + file;
                if (
                    local.assetsDict[file]
                    && local.assetsDict[file].length <= 0x100000
                    && String(local.assetsDict[file])
                    === local.fsReadFileOrEmptyStringSync("." + file, "utf8")
                ) {
                    tmp.utility2.assetsDict[file] = local.assetsDict[file];
                }
            });
            code.splice(1, 0, key + "(" + JSON.stringify(tmp, null, 4) + ");");
            code = code.join("");
            break;
        default:
            code = local.assetsDict[key];
        }
        return (
            "/* script-begin " + key + " */\n"
            + code.trim()
            + "\n/* script-end " + key + " */\n"
        );
    }).join("\n\n\n");
    local.objectSetDefault(module.exports, local);
    // init testCase_buildXxx
    Object.keys(local).forEach(function (key) {
        if (
            key.indexOf("_testCase_build") === 0
            || key === "_testCase_webpage_default"
        ) {
            module.exports[key.slice(1)] = (
                module.exports[key.slice(1)] || local[key]
            );
        }
    });
    return module.exports;
};

local.semverCompare = function (aa, bb) {
/*
 * this function will compare semver versions aa ? bb and return
 * -1 if aa < bb
 *  0 if aa = bb
 *  1 if aa > bb
 * https://semver.org/#spec-item-11
 */
    return [
        aa, bb
    ].map(function (aa) {
        aa = aa.split("-");
        return [
            aa[0], aa.slice(1).join("-") || "\u00ff"
        ].map(function (aa) {
            return aa.split(".").map(function (aa) {
                return ("0000000000000000" + aa).slice(-16);
            }).join(".");
        }).join("-");
    }).reduce(function (aa, bb) {
        return (
            aa === bb
            ? 0
            : aa < bb
            ? -1
            : 1
        );
    });
};

local.serverRespondCors = function (req, res) {
/*
 * this function will enable cors for the req
 * http://en.wikipedia.org/wiki/Cross-origin_resource_sharing
 */
    local.serverRespondHeadSet(req, res, null, local.jsonCopy({
        "access-control-allow-headers":
        req.headers["access-control-request-headers"],
        "access-control-allow-methods":
        req.headers["access-control-request-method"],
        "access-control-allow-origin": "*"
    }));
};

local.serverRespondDefault = function (req, res, statusCode, err) {
/*
 * this function will respond with a default message,
 * or <err>.stack for given statusCode
 */
    // init statusCode and contentType
    local.serverRespondHeadSet(
        req,
        res,
        statusCode,
        {
            "Content-Type": "text/plain; charset=utf-8"
        }
    );
    if (err) {
        // debug statusCode / method / url
        local.errorMessagePrepend(
            err,
            res.statusCode + " " + req.method + " " + req.url
            + "\n"
        );
        // print err.stack to stderr
        local.onErrorDefault(err);
        // end res with err.stack
        res.end(err.stack);
        return;
    }
    // end res with default statusCode message
    res.end(
        statusCode + " " + local.http.STATUS_CODES[statusCode]
    );
};

local.serverRespondEcho = function (req, res) {
/*
 * this function will respond with debug info
 */
    res.write(
        req.method + " " + req.url
        + " HTTP/" + req.httpVersion + "\r\n"
        + Object.keys(req.headers).map(function (key) {
            return key + ": " + req.headers[key] + "\r\n";
        }).join("") + "\r\n"
    );
    req.pipe(res);
};

local.serverRespondHeadSet = function (ignore, res, statusCode, headers) {
/*
 * this function will set the <res> object's <statusCode> and <headers>
 */
    if (res.headersSent) {
        return;
    }
    // init res.statusCode
    if (Number(statusCode)) {
        res.statusCode = Number(statusCode);
    }
    Object.keys(headers).forEach(function (key) {
        if (headers[key]) {
            res.setHeader(key, headers[key]);
        }
    });
    return true;
};

local.serverRespondTimeoutDefault = function (req, res, timeout) {
/*
 * this function will create a timeout-err-handler for server-<req>
 */
    var isDone;
    var onError;
    onError = function () {
        if (isDone) {
            return;
        }
        isDone = true;
        // debug serverResponse
        console.error("serverLog - " + JSON.stringify({
            time: new Date(req.timeStart).toISOString(),
            type: "serverResponse",
            method: req.method,
            url: req.url,
            statusCode: res.statusCode | 0,
            timeElapsed: Date.now() - req.timeStart,
            // extra
            requestContentLength: req.dataLength || 0,
            resContentLength: res.contentLength,
            requestHeaderXForwardedFor:
            req.headers["x-forwarded-for"] || "",
            requestHeaderOrigin: req.headers.origin || "",
            requestHeaderReferer: req.headers.referer || "",
            requestHeaderUserAgent: req.headers["user-agent"]
        }));
        // cleanup timerTimeout
        clearTimeout(req.timerTimeout);
    };
    req.timeStart = Date.now();
    req.onTimeout = req.onTimeout || function (err) {
        local.serverRespondDefault(req, res, 500, err);
        setTimeout(function () {
            // cleanup <req> and <res>
            local.streamCleanup(req);
            local.streamCleanup(res);
        }, 1000);
    };
    // init timerTimeout
    req.timerTimeout = local.onTimeout(
        req.onTimeout,
        timeout || local.timeoutDefault,
        "server " + req.method + " " + req.url
    );
    res.contentLength = 0;
    res.writeContentLength = res.writeContentLength || res.write;
    res.write = function (chunk, encoding, callback) {
        chunk = local.normalizeChunk(chunk);
        res.contentLength += chunk.length;
        res.writeContentLength(chunk, encoding, callback);
    };
    res.on("error", onError);
    res.on("finish", onError);
};

local.setTimeoutOnError = function (onError, timeout, err, data) {
/*
 * this function will after timeout has passed,
 * then call <onError>(<err>, <data>)
 */
    if (typeof onError === "function") {
        setTimeout(function () {
            onError(err, data);
        }, timeout);
    }
    return data;
};

local.sjclHashScryptCreate = function (password, opt) {
/*
 * this function will create a scrypt-hash of the password
 * with given <opt> (default = $s0$10801)
 * e.g.
 * $s0$e0801$epIxT/h6HbbwHaehFnh/bw==$7H0vs
 * XlY8UxxyW/BWx/9GuY7jEvGjT71GFd6O4SZND0=
 * https://github.com/wg/scrypt
 */
    // init opt
    opt = (opt || "$s0$10801").split("$");
    // init salt
    if (!opt[3]) {
        opt[3] = local.sjcl.codec.base64.fromBits(
            local.sjcl.random.randomWords(4, 0)
        );
    }
    // init hash
    opt[4] = local.sjcl.codec.base64.fromBits(
        local.sjcl.misc.scrypt(
            password || "",
            local.sjcl.codec.base64.toBits(opt[3]),
            Math.pow(2, parseInt(opt[2].slice(0, 1), 16)),
            parseInt(opt[2].slice(1, 2), 16),
            parseInt(opt[2].slice(3, 4), 16)
        )
    );
    return opt.slice(0, 5).join("$");
};

local.sjclHashScryptValidate = function (password, hash) {
/*
 * this function will validate the password against the scrypt-hash
 * https://github.com/wg/scrypt
 */
    return local.sjclHashScryptCreate(password, hash) === hash;
};

local.sjclHashSha1Create = function (data) {
/*
 * this function will create a base64-encoded sha1 hash of the string data
 */
    return local.sjcl.codec.base64.fromBits(local.sjcl.hash.sha1.hash(data));
};

local.sjclHashSha256Create = function (data) {
/*
 * this function will create a base64-encoded sha256 hash of the string data
 */
    return local.sjcl.codec.base64.fromBits(local.sjcl.hash.sha256.hash(data));
};

local.sjclHmacSha1Create = function (key, data) {
/*
 * this function will create a base64-encoded sha1 hmac
 * from the string key and string data
 */
    var Hmac;
    Hmac = local.sjcl.misc.hmac;
    return local.sjcl.codec.base64.fromBits(
        (new Hmac(
            local.sjcl.codec.utf8String.toBits(key),
            local.sjcl.hash.sha1
        )).mac(local.sjcl.codec.utf8String.toBits(data))
    );
};

local.sjclHmacSha256Create = function (key, data) {
/*
 * this function will create a base64-encoded sha256 hmac
 * from the string key and string data
 */
    var Hmac;
    Hmac = local.sjcl.misc.hmac;
    return local.sjcl.codec.base64.fromBits(
        (new Hmac(
            local.sjcl.codec.utf8String.toBits(key),
            local.sjcl.hash.sha256
        )).mac(local.sjcl.codec.utf8String.toBits(data))
    );
};

local.stateInit = function (opt) {
/*
 * this function will init state <opt>
 */
    local.objectSetOverride(local, opt, 10);
    // init swgg
    local.swgg.apiUpdate(local.swgg.swaggerJson);
};

local.streamCleanup = function (stream) {
/*
 * this function will try to end or destroy the stream
 */
    var err;
    // try to end the stream
    try {
        stream.end();
    } catch (errCaught) {
        err = errCaught;
    }
    // if err, then try to destroy the stream
    if (err) {
        try {
            stream.destroy();
        } catch (ignore) {}
    }
};

local.streamReadAll = function (stream, onError) {
/*
 * this function will concat data from <stream>
 * and pass to <onError> when finished reading
 */
    var chunkList;
    chunkList = [];
    stream.dataLength = 0;
    // on event-data, push buffer-chunk to chunkList
    stream.on("data", function (chunk) {
        chunk = local.normalizeChunk(chunk);
        chunkList.push(chunk);
        stream.dataLength += chunk.length;
    // on event-end, pass concatenated-buffer to onError
    }).on("end", function () {
        onError(
            null,
            local.isBrowser
            ? chunkList[0]
            : local.bufferConcat(chunkList)
        );
    // on event-error, pass error to onError
    }).on("error", onError);
};

local.stringHtmlSafe = function (text) {
/*
 * this function will make the text html-safe
 * https://stackoverflow.com/questions/7381974/which-characters-need-to-be-escaped-on-html
 */
    return text
    .replace((
        /&/g
    ), "&amp;")
    .replace((
        /"/g
    ), "&quot;")
    .replace((
        /'/g
    ), "&apos;")
    .replace((
        /</g
    ), "&lt;")
    .replace((
        />/g
    ), "&gt;")
    .replace((
        /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
    ), "&$1");
};

local.stringMerge = function (str1, str2, rgx) {
/*
 * this function will merge <str2> into <str1>,
 * for sections where both match <rgx>
 */
    str2.replace(rgx, function (match2) {
        str1.replace(rgx, function (match1) {
            str1 = str1.replace(match1, function () {
                return match2;
            });
        });
    });
    return str1;
};

local.stringQuotedToAscii = function (str) {
/*
 * this function will replace non-ascii-chr to unicode-escaped-ascii-chr
 * in quoted-<str>
 */
    return str
    .replace((
        /\r/g
    ), "\\r")
    .replace((
        /\t/g
    ), "\\t")
    .replace((
        /[^\n\u0020-\u007e]/g
    ), function (chr) {
        return "\\u" + ("0000" + chr.charCodeAt(0).toString(16)).slice(-4);
    });
};

local.stringRegexpEscape = function (text) {
/*
 * this function will regexp-escape text
 * https://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
 */
    return text.replace((
        /[\-\/\\\^$*+?.()|\[\]{}]/g
    ), "\\$&");
};

local.stringTruncate = function (text, maxLength) {
/*
 * this function will truncate text to given maxLength
 */
    return (
        text.length > maxLength
        ? text.slice(0, maxLength - 3).trimRight() + "..."
        : text
    );
};

local.stringUniqueKey = function (text) {
/*
 * this function will return a string-key that is unique in given text
 */
    var key;
    // seed the key with the least frequent letters in the english-language
    // https://en.wikipedia.org/wiki/Letter_frequency
    key = "zqxj";
    do {
        key += ((1 + Math.random()) * 0x10000000000000).toString(36).slice(1);
    } while (text.indexOf(key) >= 0);
    return key;
};

local.taskCreate = function (opt, onTask, onError) {
/*
 * this function will create the task onTask named <opt>.key,
 * if it does not exist, and push onError to its onErrorList
 */
    var task;
    // init task
    local.taskOnTaskDict[opt.key] = (
        local.taskOnTaskDict[opt.key]
        || {
            onErrorList: []
        }
    );
    task = local.taskOnTaskDict[opt.key];
    // push callback onError to the task
    if (onError) {
        onError = local.onErrorWithStack(onError);
        task.onErrorList.push(onError);
    }
    // if task exists, then return it
    if (!onTask || task.onTask) {
        return task;
    }
    task.onDone = function (err, data, meta) {
        // if isDone, then do nothing
        if (task.isDone) {
            return;
        }
        task.isDone = true;
        // cleanup timerTimeout
        clearTimeout(task.timerTimeout);
        // cleanup task
        delete local.taskOnTaskDict[opt.key];
        // preserve err.message and err.stack
        task.result = JSON.stringify([
            (
                (err && err.stack)
                ? Object.assign(local.jsonCopy(err), {
                    message: err.message,
                    name: err.name,
                    stack: err.stack
                })
                : err
            ), data, meta
        ]);
        // pass result to callbacks in onErrorList
        task.onErrorList.forEach(function (onError) {
            onError.apply(null, JSON.parse(task.result));
        });
    };
    // init timerTimeout
    task.timerTimeout = local.onTimeout(
        task.onDone,
        opt.timeout || local.timeoutDefault,
        "taskCreate " + opt.key
    );
    task.onTask = onTask;
    // run onTask
    task.onTask(task.onDone);
    return task;
};

local.taskCreateCached = function (opt, onTask, onError) {
/*
 * this function will
 * 1. if cache-hit, then call onError with cacheValue
 * 2. run onTask in background to update cache
 * 3. save onTask's result to cache
 * 4. if cache-miss, then call onError with onTask's result
 */
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        // 1. if cache-hit, then call onError with cacheValue
        case 1:
            // read cacheValue from memory-cache
            local.cacheDict[opt.cacheDict] = (
                local.cacheDict[opt.cacheDict]
                || {}
            );
            opt.cacheValue = local.cacheDict[opt.cacheDict][opt.key];
            if (opt.cacheValue) {
                // call onError with cacheValue
                opt.modeCacheHit = true;
                onError(null, JSON.parse(opt.cacheValue));
                if (!opt.modeCacheUpdate) {
                    break;
                }
            }
            // run background-task with lower priority for cache-hit
            setTimeout(opt.onNext, opt.modeCacheHit && opt.cacheTtl);
            break;
        // 2. run onTask in background to update cache
        case 2:
            local.taskCreate(opt, onTask, opt.onNext);
            break;
        default:
            // 3. save onTask's result to cache
            // JSON.stringify data to prevent side-effects on cache
            opt.cacheValue = JSON.stringify(data);
            if (!err && opt.cacheValue) {
                local.cacheDict[opt.cacheDict][opt.key] = opt.cacheValue;
            }
            // 4. if cache-miss, then call onError with onTask's result
            if (!opt.modeCacheHit) {
                onError(err, opt.cacheValue && JSON.parse(opt.cacheValue));
            }
            local.functionOrNop(opt.onCacheWrite)();
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.templateRender = function (template, dict, opt) {
/*
 * this function will render the template with given dict
 */
    var argList;
    var getValue;
    var match;
    var renderPartial;
    var rgx;
    var skip;
    var value;
    dict = dict || {};
    opt = opt || {};
    getValue = function (key) {
        argList = key.split(" ");
        value = dict;
        if (argList[0] === "#this/") {
            return;
        }
        // iteratively lookup nested values in the dict
        argList[0].split(".").forEach(function (key) {
            value = value && value[key];
        });
        return value;
    };
    renderPartial = function (match0, helper, key, partial) {
        switch (helper) {
        case "each":
        case "eachTrimRightComma":
            value = getValue(key);
            value = (
                Array.isArray(value)
                ? value.map(function (dict) {
                    // recurse with partial
                    return local.templateRender(partial, dict, opt);
                }).join("")
                : ""
            );
            // remove trailing-comma from last elem
            if (helper === "eachTrimRightComma") {
                value = value.trimRight().replace((
                    /,$/
                ), "");
            }
            return value;
        case "if":
            partial = partial.split("{{#unless " + key + "}}");
            partial = (
                getValue(key)
                ? partial[0]
                // handle 'unless' case
                : partial.slice(1).join("{{#unless " + key + "}}")
            );
            // recurse with partial
            return local.templateRender(partial, dict, opt);
        case "unless":
            return (
                getValue(key)
                ? ""
                // recurse with partial
                : local.templateRender(partial, dict, opt)
            );
        default:
            // recurse with partial
            return match0[0] + local.templateRender(match0.slice(1), dict, opt);
        }
    };
    // render partials
    rgx = (
        /\{\{#(\w+)\u0020([^}]+?)\}\}/g
    );
    template = template || "";
    match = rgx.exec(template);
    while (match) {
        rgx.lastIndex += 1 - match[0].length;
        template = template.replace(
            new RegExp(
                "\\{\\{#(" + match[1] + ") (" + match[2]
                + ")\\}\\}([\\S\\s]*?)\\{\\{/" + match[1] + " " + match[2]
                + "\\}\\}"
            ),
            renderPartial
        );
        match = rgx.exec(template);
    }
    // search for keys in the template
    return template.replace((
        /\{\{[^}]+?\}\}/g
    ), function (match0) {
        var markdownToHtml;
        var notHtmlSafe;
        notHtmlSafe = opt.notHtmlSafe;
        try {
            getValue(match0.slice(2, -2));
            if (value === undefined) {
                return match0;
            }
            argList.slice(1).forEach(function (arg0, ii, list) {
                switch (arg0) {
                case "alphanumeric":
                    value = value.replace((
                        /\W/g
                    ), "_");
                    break;
                case "decodeURIComponent":
                    value = decodeURIComponent(value);
                    break;
                case "encodeURIComponent":
                    value = encodeURIComponent(value);
                    break;
                case "jsonStringify":
                    value = JSON.stringify(value);
                    break;
                case "jsonStringify4":
                    value = JSON.stringify(value, null, 4);
                    break;
                case "markdownSafe":
                    value = value.replace((
                        /`/g
                    ), "'");
                    break;
                case "markdownToHtml":
                    markdownToHtml = true;
                    break;
                case "notHtmlSafe":
                    notHtmlSafe = true;
                    break;
                case "padEnd":
                case "padStart":
                case "slice":
                    skip = ii + 2;
                    value = String(value)[arg0](
                        list[skip - 1],
                        list[skip]
                    );
                    break;
                case "truncate":
                    skip = ii + 1;
                    if (value.length > list[skip]) {
                        value = value.slice(
                            0,
                            Math.max(list[skip] - 3, 0)
                        ).trimRight() + "...";
                    }
                    break;
                // default to String.prototype[arg0]()
                default:
                    if (ii <= skip) {
                        break;
                    }
                    value = value[arg0]();
                }
            });
            value = String(value);
            // default to htmlSafe
            if (!notHtmlSafe) {
                value = value
                .replace((
                    /&/g
                ), "&amp;")
                .replace((
                    /"/g
                ), "&quot;")
                .replace((
                    /'/g
                ), "&apos;")
                .replace((
                    /</g
                ), "&lt;")
                .replace((
                    />/g
                ), "&gt;")
                .replace((
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
                ), "&$1");
            }
            markdownToHtml = (
                markdownToHtml
                && (typeof local.marked === "function" && local.marked)
            );
            if (markdownToHtml) {
                value = markdownToHtml(value)
                .replace((
                    /&amp;(amp;|apos;|gt;|lt;|quot;)/ig
                ), "&$1");
            }
            return value;
        } catch (errCaught) {
            errCaught.message = (
                "templateRender could not render expression "
                + JSON.stringify(match0)
                + "\n"
            ) + errCaught.message;
            local.assertThrow(null, errCaught);
        }
    });
};

local.templateRenderMyApp = function (template, opt) {
/*
 * this function will render my-app-lite template with given <opt>.packageJson
 */
    opt.packageJson = local.fsReadFileOrEmptyStringSync("package.json", "json");
    local.objectSetDefault(opt.packageJson, {
        nameLib: opt.packageJson.name.replace((
            /\W/g
        ), "_"),
        repository: {
            url: (
                "https://github.com/kaizhu256/node-"
                + opt.packageJson.name
                + ".git"
            )
        }
    }, 2);
    opt.githubRepo = opt.packageJson.repository.url.replace((
        /\.git$/
    ), "").split("/").slice(-2);
    template = template.replace((
        /kaizhu256(\.github\.io\/|%252F|\/)/g
    ), opt.githubRepo[0] + ("$1"));
    template = template.replace((
        /node-my-app-lite/g
    ), opt.githubRepo[1]);
    template = template.replace((
        /\bh1-my-app\b/g
    ), (
        opt.packageJson.nameHeroku
        || ("h1-" + opt.packageJson.nameLib.replace((
            /_/g
        ), "-"))
    ));
    template = template.replace((
        /my-app-lite/g
    ), opt.packageJson.name);
    template = template.replace((
        /my_app/g
    ), opt.packageJson.nameLib);
    template = template.replace((
        /\{\{packageJson\.(\S+)\}\}/g
    ), function (ignore, match1) {
        return opt.packageJson[match1];
    });
    return template;
};

local.testCase_nop_default = function (opt, onError) {
/*
 * this function will test nop's default handling-behavior
 */
    local.nop();
    onError(null, opt);
};

local.testMock = function (mockList, onTestCase, onError) {
/*
 * this function will mock the objects in mockList while running the onTestCase
 */
    var onError2;
    onError2 = function (err) {
        // restore mock[0] from mock[2]
        mockList.reverse().forEach(function (mock) {
            Object.keys(mock[2]).forEach(function (key) {
                mock[0][key] = mock[2][key];
            });
        });
        onError(err);
    };
    // suppress console.error and console.log
    if (!(mockList[0] && mockList[0][0] === console)) {
        mockList.unshift([
            console, {}
        ]);
    }
    local.objectSetDefault(mockList[0][1], {
        error: local.nop,
        log: local.nop
    });
    // mock-objects
    mockList.forEach(function (mock) {
        mock[2] = {};
        // backup mock[0] into mock[2]
        Object.keys(mock[1]).forEach(function (key) {
            mock[2][key] = (
                // ternary-operator
                (
                    typeof process === "object"
                    && process.env === mock[0]
                    && mock[0][key] === undefined
                )
                // handle process.env
                ? ""
                : mock[0][key]
            );
        });
        // override mock[0] with mock[1]
        Object.keys(mock[1]).forEach(function (key) {
            mock[0][key] = mock[1][key];
        });
    });
    // try to call onError with mock-objects
    local.tryCatchOnError(function () {
        // run onTestCase
        onTestCase(onError2);
    }, onError2);
};

local.testReportCreate = function (testReport) {
/*
 * this function will create test-report artifacts
 */
    testReport = local.objectSetDefault(testReport, {
        testPlatformList: []
    });
    // print test-report summary
    console.error(
        "\n" + new Array(56).join("-")
        + "\n" + testReport.testPlatformList.filter(function (testPlatform) {
            // if testPlatform has no tests, then filter it out
            return testPlatform.testCaseList.length;
        }).map(function (testPlatform) {
            return (
                "| test-report - " + testPlatform.name + "\n|"
                + ("        " + testPlatform.timeElapsed + " ms     ")
                .slice(-16)
                + ("        " + testPlatform.testsFailed + " failed ")
                .slice(-16)
                + ("        " + testPlatform.testsPassed + " passed ")
                .slice(-16) + "     |\n" + new Array(56).join("-")
            );
        }).join("\n") + "\n"
    );
    // create test-report.html
    local.fs.writeFileSync(
        "tmp/build/test-report.html",
        local.testReportMerge(testReport, {})
    );
    // create build.badge.svg
    local.fs.writeFileSync(
        "tmp/build/build.badge.svg",
        local.assetsDict["/assets.buildBadge.template.svg"].replace((
            /0000-00-00\u002000:00:00\u0020UTC\u0020-\u0020master\u0020-\u0020aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/g
        ), (
            new Date().toISOString().slice(0, 19).replace("T", " ")
            + " - " + local.env.CI_BRANCH + " - " + local.env.CI_COMMIT_ID
        ))
    );
    // create test-report.badge.svg
    local.fs.writeFileSync(
        "tmp/build/test-report.badge.svg",
        local.assetsDict["/assets.testReportBadge.template.svg"]
        // edit number of tests failed
        .replace((
            /999/g
        ), testReport.testsFailed)
        // edit badge color
        .replace((
            /d00/g
        ), (
            testReport.testsFailed
            ? "d00"
            : "0d0"
        ))
    );
    console.error(
        "created test-report file "
        + process.cwd() + "/tmp/build/test-report.html\n"
    );
    // if any test failed, then exit with non-zero exit-code
    console.error(
        "\n" + local.env.MODE_BUILD
        + " - " + testReport.testsFailed + " failed tests\n"
    );
    // print failed testCase
    testReport.testPlatformList.forEach(function (testPlatform) {
        testPlatform.testCaseList.forEach(function (testCase) {
            if (testCase.status !== "passed") {
                console.error(JSON.stringify(testCase, null, 4));
            }
        });
    });
    return testReport;
};

local.testReportMerge = function (testReport1, testReport2) {
/*
 * this function will
 * 1. merge testReport2 into testReport1
 * 2. return testReport1 in html-format
 */
    var errorStackList;
    var testCaseNumber;
    var testReport;
    testReport2 = testReport2 || {};
    // 1. merge testReport2 into testReport1
    [
        testReport1, testReport2
    ].forEach(function (testReport, ii) {
        ii += 1;
        local.objectSetDefault(testReport, {
            date: new Date().toISOString(),
            errorStackList: [],
            testPlatformList: [],
            timeElapsed: 0
        }, 8);
        // security - handle malformed testReport
        local.assertThrow(
            typeof testReport === "object" && testReport,
            ii + " invalid testReport " + typeof testReport
        );
        // validate timeElapsed
        local.assertThrow(
            typeof testReport.timeElapsed === "number",
            ii + " invalid testReport.timeElapsed "
            + typeof testReport.timeElapsed
        );
        // security - handle malformed testReport.testPlatformList
        testReport.testPlatformList.forEach(function (testPlatform) {
            local.objectSetDefault(testPlatform, {
                name: "undefined",
                testCaseList: [],
                timeElapsed: 0
            }, 8);
            local.assertThrow(
                typeof testPlatform.name === "string",
                ii + " invalid testPlatform.name " + typeof testPlatform.name
            );
            // insert $MODE_BUILD into testPlatform.name
            if (local.env.MODE_BUILD) {
                testPlatform.name = testPlatform.name.replace((
                    /^(browser|node)\b/
                ), local.env.MODE_BUILD + " - $1");
            }
            // validate timeElapsed
            local.assertThrow(
                typeof testPlatform.timeElapsed === "number",
                (
                    ii + " invalid testPlatform.timeElapsed "
                    + typeof testPlatform.timeElapsed
                )
            );
            // security - handle malformed testPlatform.testCaseList
            testPlatform.testCaseList.forEach(function (testCase) {
                local.objectSetDefault(testCase, {
                    errorStack: "",
                    name: "undefined",
                    timeElapsed: 0
                }, 8);
                local.assertThrow(
                    typeof testCase.errorStack === "string",
                    ii + " invalid testCase.errorStack "
                    + typeof testCase.errorStack
                );
                local.assertThrow(
                    typeof testCase.name === "string",
                    ii + " invalid testCase.name " + typeof testCase.name
                );
                // validate timeElapsed
                local.assertThrow(
                    typeof testCase.timeElapsed === "number",
                    (
                        ii + " invalid testCase.timeElapsed "
                        + typeof testCase.timeElapsed
                    )
                );
            });
        });
    });
    // merge testReport2.testPlatformList into testReport1.testPlatformList
    testReport2.testPlatformList.forEach(function (testPlatform2) {
        // add testPlatform2 to testReport1.testPlatformList
        testReport1.testPlatformList.push(testPlatform2);
    });
    testReport = testReport1;
    testReport.testsFailed = 0;
    testReport.testsPassed = 0;
    testReport.testsPending = 0;
    testReport.testPlatformList.forEach(function (testPlatform) {
        testPlatform.testsFailed = 0;
        testPlatform.testsPassed = 0;
        testPlatform.testsPending = 0;
        testPlatform.testCaseList.forEach(function (testCase) {
            switch (testCase.status) {
            // update failed tests
            case "failed":
                testPlatform.testsFailed += 1;
                testReport.testsFailed += 1;
                break;
            // update passed tests
            case "passed":
                testPlatform.testsPassed += 1;
                testReport.testsPassed += 1;
                break;
            // update pending tests
            default:
                testPlatform.testsPending += 1;
                testReport.testsPending += 1;
            }
        });
        // update testPlatform.status
        testPlatform.status = (
            testPlatform.testsFailed
            ? "failed"
            : testPlatform.testsPending
            ? "pending"
            : "passed"
        );
        // sort testCaseList by status and name
        testPlatform.testCaseList.sort(function (aa, bb) {
            return (
                aa.status.replace("passed", "z") + aa.name
                > bb.status.replace("passed", "z") + bb.name
                ? 1
                : -1
            );
        });
    });
    // sort testPlatformList by status and name
    testReport.testPlatformList.sort(function (aa, bb) {
        return (
            aa.status.replace("passed", "z") + aa.name
            > bb.status.replace("passed", "z") + bb.name
            ? 1
            : -1
        );
    });
    // stop testReport timer
    if (!testReport.testsPending) {
        local.timeElapsedPoll(testReport);
    }
    // 2. return testReport1 in html-format
    // json-copy testReport that will be modified for html templating
    testReport = local.jsonCopy(testReport1);
    // update timeElapsed
    local.timeElapsedPoll(testReport);
    testReport.testPlatformList.forEach(function (testPlatform) {
        // update testPlatform.timeElapsed
        local.timeElapsedPoll(testPlatform);
        testPlatform.testCaseList.forEach(function (testCase) {
            if (!testCase.isDone) {
                local.timeElapsedPoll(testCase);
            }
            testPlatform.timeElapsed = Math.max(
                testPlatform.timeElapsed,
                testCase.timeElapsed
            );
        });
        // update testReport.timeElapsed with testPlatform.timeElapsed
        testReport.timeElapsed = Math.max(
            testReport.timeElapsed,
            testPlatform.timeElapsed
        );
    });
    // create html test-report
    testCaseNumber = 0;
    return local.templateRender(
        local.assetsDict["/assets.testReport.template.html"],
        local.objectSetOverride(testReport, {
            env: local.env,
            // map testPlatformList
            testPlatformList: testReport.testPlatformList.filter(function (
                testPlatform
            ) {
                // if testPlatform has no tests, then filter it out
                return testPlatform.testCaseList.length;
            }).map(function (testPlatform, ii) {
                errorStackList = [];
                return local.objectSetOverride(testPlatform, {
                    errorStackList,
                    name: testPlatform.name,
                    screenshot: testPlatform.screenshot,
                    // map testCaseList
                    testCaseList: testPlatform.testCaseList.map(function (
                        testCase
                    ) {
                        testCaseNumber += 1;
                        if (testCase.errorStack) {
                            errorStackList.push({
                                errorStack: (
                                    testCaseNumber + ". " + testCase.name
                                    + "\n" + testCase.errorStack
                                )
                            });
                        }
                        return local.objectSetOverride(testCase, {
                            testCaseNumber,
                            testReportTestStatusClass: (
                                "test"
                                + testCase.status[0].toUpperCase()
                                + testCase.status.slice(1)
                            )
                        }, 8);
                    }),
                    preClass: (
                        errorStackList.length
                        ? ""
                        : "displayNone"
                    ),
                    testPlatformNumber: ii + 1
                });
            }, 8),
            testStatusClass: (
                testReport.testsFailed
                ? "testFailed"
                : "testPassed"
            )
        }, 8)
    );
};

local.testRunDefault = function (opt) {
/*
 * this function will run the tests in testPlatform.testCaseList
 */
    var processExit;
    var testPlatform;
    var testReport;
    var testReportDiv1;
    var timerInterval;
    // run-server
    if (!local.isBrowser) {
        local.testRunServer(opt);
    }
    globalThis.utility2_modeTest = Number(
        globalThis.utility2_modeTest
        || opt.modeTest
        || local.modeTest
        || local.env.npm_config_mode_test
    );
    switch (globalThis.utility2_modeTest) {
    // init
    case 1:
        globalThis.utility2_modeTest += 1;
        // reset db
        if (local.db && typeof local.db.dbReset === "function") {
            local.db.dbReset(
                globalThis.utility2_dbSeedList,
                local.onErrorThrow
            );
        }
        globalThis.utility2_onReadyAfter(function () {
            local.testRunDefault(opt);
        });
        return;
    // test-run
    default:
        // test-ignore
        if (
            globalThis.utility2_onReadyBefore.counter
            || !globalThis.utility2_modeTest
            || globalThis.utility2_modeTest > 2
        ) {
            return;
        }
        // test-run
        globalThis.utility2_modeTest += 1;
    }
    // visual notification - testRun
    local.ajaxProgressUpdate();
    // mock serverLog
    local._testRunConsoleError = local._testRunConsoleError || console.error;
    console.error = function (arg0) {
    /*
     * this function will ignore serverLog-messages during test-run
     */
        /* istanbul ignore next */
        if (!globalThis.__coverage__ && !(
            /^serverLog\u0020-\u0020\{/
        ).test(arg0)) {
            local._testRunConsoleError.apply(console, arguments); // jslint ignore:line
        }
    };
    if (!local.isBrowser) {
        // mock proces.exit
        processExit = process.exit;
        process.exit = local.nop;
    }
    // init modeTestCase
    local.modeTestCase = (
        local.modeTestCase
        || local.env.npm_config_mode_test_case || ""
    );
    // init testReport
    testReport = globalThis.utility2_testReport;
    // init testReport timer
    local.timeElapsedStart(testReport);
    // init testPlatform
    testPlatform = testReport.testPlatformList[0];
    // init testPlatform timer
    local.timeElapsedStart(testPlatform);
    // reset testPlatform.testCaseList
    testPlatform.testCaseList.length = 0;
    // add tests into testPlatform.testCaseList
    Object.keys(opt).forEach(function (key) {
        // add testCase opt[key] to testPlatform.testCaseList
        if (
            typeof opt[key] === "function" && (
                local.modeTestCase
                ? local.modeTestCase.split(
                    /[,\s]/g
                ).indexOf(key) >= 0
                : key.indexOf("testCase_") === 0
            )
        ) {
            testPlatform.testCaseList.push({
                isBrowser: local.isBrowser,
                name: key,
                status: "pending",
                onTestCase: opt[key]
            });
        }
    });
    // visual notification - update test-progress until isDone
    // init testReportDiv1 elem
    if (local.isBrowser) {
        testReportDiv1 = document.querySelector(
            "#testReportDiv1"
        );
    }
    testReportDiv1 = testReportDiv1 || {
        style: {}
    };
    local.uiAnimateSlideDown(testReportDiv1);
    testReportDiv1.innerHTML = local.testReportMerge(testReport, {});
    // update test-report status every 1000 ms until isDone
    timerInterval = setInterval(function () {
        // update testPlatform.timeElapsed
        local.timeElapsedPoll(testPlatform);
        // update testReportDiv1 in browser
        testReportDiv1.innerHTML = local.testReportMerge(testReport, {});
        if (!testReport.testsPending) {
            // cleanup timerInterval
            clearInterval(timerInterval);
        }
        // notify of remaining tests
        if (testPlatform.timeElapsed % 5000 < 1000) {
            local._testRunConsoleError(
                "testRunDefault - "
                + testPlatform.timeElapsed + " ms - testCase pending - "
                + testPlatform.testCaseList
                .filter(function (testCase) {
                    return testCase.status === "pending";
                })
                .slice(0, 4)
                .map(function (testCase) {
                    return testCase.name;
                }).join(", ") + " ..."
            );
        }
    }, 1000);
    // shallow-copy testPlatform.testCaseList to prevent side-effects
    // from in-place sort from testReportMerge
    local.onParallelList({
        list: testPlatform.testCaseList.slice(),
        rateLimit: Infinity
    }, function (testCase, onParallel) {
        var onError;
        var timerTimeout;
        onError = function (err) {
            // update testPlatform.timeElapsed
            local.timeElapsedPoll(testPlatform);
            // cleanup timerTimeout
            clearTimeout(timerTimeout);
            // if testCase isDone, then fail testCase
            if (testCase.isDone) {
                err = err || new Error(
                    "callback in testCase "
                    + testCase.name
                    + " called multiple times"
                );
            }
            // if err occurred, then fail testCase
            if (err) {
                // restore console.log
                console.error = local._testRunConsoleError;
                testCase.status = "failed";
                local._testRunConsoleError(
                    "\ntestRunDefault - "
                    + testPlatform.timeElapsed + " ms - testCase failed - "
                    + testCase.name + "\n" + err.message + "\n" + err.stack
                );
                testCase.errorStack = (
                    testCase.errorStack || err.message + "\n" + err.stack
                );
                // validate errorStack is non-empty
                local.assertThrow(
                    testCase.errorStack,
                    "invalid errorStack " + testCase.errorStack
                );
            }
            // if tests isDone, then do nothing
            if (testCase.isDone) {
                return;
            }
            testCase.isDone = true;
            if (testCase.status === "pending") {
                testCase.status = "passed";
            }
            // stop testCase timer
            local.timeElapsedPoll(testCase);
            local._testRunConsoleError(
                "testRunDefault - "
                + testPlatform.timeElapsed + " ms - [" + (
                    local.isBrowser
                    ? "browser"
                    : "node"
                ) + " test-case "
                + testPlatform.testCaseList.filter(function (testCase) {
                    return testCase.isDone;
                }).length + " of " + testPlatform.testCaseList.length + " "
                + testCase.status + "] - " + testCase.name
            );
            // if all testCase.isDone, then create test-report
            onParallel();
        };
        testCase = testCase.elem;
        // init timerTimeout
        timerTimeout = local.onTimeout(
            onError,
            local.timeoutDefault,
            testCase.name
        );
        // increment number of tests remaining
        onParallel.counter += 1;
        // try to run testCase
        local.tryCatchOnError(function () {
            // start testCase timer
            local.timeElapsedStart(testCase);
            testCase.onTestCase(null, onError);
        }, onError);
    }, function () {
    /*
     * this function will create the test-report after all tests isDone
     */
        // update testPlatform.timeElapsed
        local.timeElapsedPoll(testPlatform);
        globalThis.utility2_modeTest = 1;
        local.ajaxProgressUpdate();
        // init domOnEventWindowOnloadTimeElapsed
        if (globalThis.domOnEventWindowOnloadTimeElapsed < 0x10000000000) {
            testPlatform.domOnEventWindowOnloadTimeElapsed = (
                globalThis.domOnEventWindowOnloadTimeElapsed
            );
        }
        // finalize testReport
        local.testReportMerge(testReport, {});
        // create test-report.json
        delete testReport.coverage;
        local.fsWriteFileWithMkdirpSync(
            local.env.npm_config_dir_build + "/test-report.json",
            JSON.stringify(testReport, null, 4)
        );
        setTimeout(function () {
            // restore console.log
            console.error = local._testRunConsoleError;
            // restore process.exit
            if (processExit) {
                process.exit = processExit;
            }
            // reset utility2_modeTest
            globalThis.utility2_modeTest = 0;
            // exit with number of tests failed
            local.exit(testReport.testsFailed, testReport);
        // coverage-hack - wait 1000 ms for timerInterval
        }, 1000);
    });
};

local.testRunServer = function (opt) {
/*
 * this function will
 * 1. create server from local.middlewareList
 * 2. start server on local.env.PORT
 * 3. run tests
 */
    if (globalThis.utility2_serverHttp1) {
        return;
    }
    globalThis.utility2_onReadyBefore.counter += 1;
    // 1. create server from local.middlewareList
    local.middlewareList = local.middlewareList || [
        local.middlewareInit,
        local.middlewareForwardProxy,
        local.middlewareAssetsCached,
        local.middlewareJsonpStateInit,
        local.middlewareFileServer
    ];
    local.serverLocalReqHandler = function (req, res) {
        var that;
        that = {};
        local.onNext(that, function (err) {
            if (err || that.modeNext >= local.middlewareList.length) {
                local.middlewareError(err, req, res);
                return;
            }
            // recurse with next middleware in middlewareList
            local.middlewareList[that.modeNext](req, res, that.onNext);
        });
        that.modeNext = -1;
        that.onNext();
    };
    globalThis.utility2_serverHttp1 = local.http.createServer(
        local.serverLocalReqHandler
    );
    // 2. start server on local.env.PORT
    if (local.env.npm_config_mode_library) {
        globalThis.utility2_onReadyBefore();
        return;
    }
    console.error("http-server listening on port " + local.env.PORT);
    globalThis.utility2_onReadyBefore.counter += 1;
    globalThis.utility2_serverHttp1.listen(
        local.env.PORT,
        globalThis.utility2_onReadyBefore
    );
    // 3. run tests
    local.testRunDefault(opt);
    globalThis.utility2_onReadyBefore();
};

local.throwError = function () {
/*
 * this function will throw new err
 */
    throw new Error();
};

local.timeElapsedPoll = function (opt) {
/*
 * this function will poll <opt>.timeElapsed
 */
    opt = local.timeElapsedStart(opt);
    opt.timeElapsed = Date.now() - opt.timeStart;
    return opt;
};

local.timeElapsedStart = function (opt, timeStart) {
/*
 * this function will start <opt>.timeElapsed
 */
    opt = opt || {};
    opt.timeStart = timeStart || opt.timeStart || Date.now();
    return opt;
};

local.tryCatchOnError = function (fnc, onError) {
/*
 * this function will run the fnc in a tryCatch block,
 * else call onError with errCaught
 */
    var result;
    // validate onError
    local.assertThrow(typeof onError === "function", typeof onError);
    try {
        // reset errCaught
        local._debugTryCatchError = null;
        result = fnc();
        local._debugTryCatchError = null;
        return result;
    } catch (errCaught) {
        // debug errCaught
        local._debugTryCatchError = errCaught;
        return onError(errCaught);
    }
};

local.uiAnimateShake = function (elem, onError) {
/*
 * this function will shake dom-<elem>
 */
    if (!elem || elem.classList.contains("uiAnimateShake")) {
        local.setTimeoutOnError(onError);
        return;
    }
    elem.classList.add("uiAnimateShake");
    setTimeout(function () {
        elem.classList.remove("uiAnimateShake");
        local.setTimeoutOnError(onError);
    }, 500);
};

local.uiAnimateShakeIfError = function (err, elem, onError) {
/*
 * this function will shake dom-<elem> if <err> occurred
 */
    var hasError;
    if (!elem) {
        local.setTimeoutOnError(onError);
        return;
    }
    hasError = elem.classList.contains("hasError");
    if (err && !hasError) {
        elem.classList.add("hasError");
        local.uiAnimateShake(elem, onError);
        return;
    }
    if (!err && hasError) {
        elem.classList.remove("hasError");
    }
    local.setTimeoutOnError(onError);
};

local.uiAnimateSlideAccordian = function (elem, elemList, onError) {
/*
 * this function will slideDown <elem>, but slideUp elements in <elemList>
 */
    elemList.forEach(function (elem2) {
        if (elem2 !== elem) {
            local.uiAnimateSlideUp(elem2);
        }
    });
    setTimeout(function () {
        local.uiAnimateSlideDown(elem, onError);
    }, 250);
};

local.uiAnimateSlideDown = function (elem, onError) {
/*
 * this function will slideDown dom-<elem>
 */
    onError = onError || local.nop;
    if (!(
        elem
        && elem.style && elem.style.maxHeight !== "100%"
        && elem.classList && elem.classList.contains("uiAnimateSlide")
    )) {
        onError();
        return;
    }
    elem.style.borderBottom = "";
    elem.style.borderTop = "";
    elem.style.marginBottom = "";
    elem.style.marginTop = "";
    elem.style.maxHeight = 1.5 * globalThis.innerHeight + "px";
    elem.style.paddingBottom = "";
    elem.style.paddingTop = "";
    setTimeout(function () {
        elem.style.maxHeight = "100%";
        onError();
    }, 250);
};

local.uiAnimateSlideUp = function (elem, onError) {
/*
 * this function will slideUp dom-<elem>
 */
    if (!(
        elem
        && elem.style && elem.style.maxHeight !== "0px"
        && elem.classList && elem.classList.contains("uiAnimateSlide")
    )) {
        local.setTimeoutOnError(onError);
        return;
    }
    elem.style.borderBottom = "0";
    elem.style.borderTop = "0";
    elem.style.marginBottom = "0";
    elem.style.marginTop = "0";
    elem.style.maxHeight = "0";
    elem.style.paddingBottom = "0";
    elem.style.paddingTop = "0";
    local.setTimeoutOnError(onError, 250);
};

local.urlJoin = function (aa, bb) {
/*
 * this function will if bb is relative, url-join aa with bb
 */
    // bb is absolute-url
    if ((
        /^\w+?:\/\//
    ).test(bb)) {
        return bb;
    }
    // bb is absolute-url without protocol
    if (bb.slice(0, 2) === "//") {
        return aa.split("/")[0] + bb;
    }
    // bb is absolute-url without host
    if (bb[0] === "/") {
        return aa.split("/").slice(0, 3).join("/") + bb;
    }
    // bb is relative-url
    if (aa.split("/").length < 4) {
        aa += "/";
    }
    return aa.replace((
        /[?#].*?$/
    ), "").replace((
        /[^\/]*?$/
    ), "") + bb;
};

local.urlParse = function (url) {
/*
 * this function will parse <url> according to below spec, plus a query param
 * https://developer.mozilla.org/en-US/docs/Web/API/URL
 */
    var urlParsed;
    urlParsed = {};
    // try to parse url
    local.tryCatchOnError(function () {
        // resolve host-less url
        if (local.isBrowser) {
            local.serverLocalHost = (
                local.serverLocalHost
                || location.protocol + "//" + location.host
            );
            // resolve absolute path
            if (url[0] === "/") {
                url = local.serverLocalHost + url;
            // resolve relative path
            } else if (!(
                /^\w+?:\/\//
            ).test(url)) {
                url = (
                    local.serverLocalHost
                    + location.pathname.replace((
                        /\/[^\/]*?$/
                    ), "") + "/" + url
                );
            }
            urlParsed = new globalThis.URL(url);
            urlParsed.path = "/" + urlParsed.href
            .split("/")
            .slice(3)
            .join("/")
            .split("#")[0];
        } else {
            local.env.PORT = local.env.PORT || "8081";
            local.serverLocalHost = (
                local.serverLocalHost
                || ("http://127.0.0.1:" + local.env.PORT)
            );
            // resolve absolute path
            if (url[0] === "/") {
                url = local.serverLocalHost + url;
            // resolve relative path
            } else if (!(
                /^\w+?:\/\//
            ).test(url)) {
                url = local.serverLocalHost + "/" + url;
            }
            urlParsed = local.url.parse(url);
        }
        // init query
        urlParsed.query = {};
        (urlParsed.search || "").slice(1).replace((
            /[^&]+/g
        ), function (item) {
            item = item.split("=");
            item[0] = decodeURIComponent(item[0]);
            item[1] = decodeURIComponent(item.slice(1).join("="));
            // parse repeating query-param as an array
            if (urlParsed.query[item[0]]) {
                if (!Array.isArray(urlParsed.query[item[0]])) {
                    urlParsed.query[item[0]] = [
                        urlParsed.query[item[0]]
                    ];
                }
                urlParsed.query[item[0]].push(item[1]);
            } else {
                urlParsed.query[item[0]] = item[1];
            }
        });
        urlParsed.basename = urlParsed.pathname.replace((
            /^.*\//
        ), "");
    }, local.nop);
    // https://developer.mozilla.org/en/docs/Web/API/URL#Properties
    return {
        basename: urlParsed.basename || "",
        hash: urlParsed.hash || "",
        host: urlParsed.host || "",
        hostname: urlParsed.hostname || "",
        href: urlParsed.href || "",
        path: urlParsed.path || "",
        pathname: urlParsed.pathname || "",
        port: urlParsed.port || "",
        protocol: urlParsed.protocol || "",
        query: urlParsed.query || {},
        search: urlParsed.search || ""
    };
};

local.uuid4Create = function () {
/*
 * this function will create a random uuid,
 * with format 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'
 */
    // code derived from http://jsperf.com/uuid4
    var id;
    var ii;
    id = "";
    ii = 0;
    while (ii < 32) {
        switch (ii) {
        case 8:
        case 20:
            id += "-";
            // coerce to finite integer
            id += ((Math.random() * 16) | 0).toString(16);
            break;
        case 12:
            id += "-";
            id += "4";
            break;
        case 16:
            id += "-";
            id += ((Math.random() * 4) | 8).toString(16);
            break;
        default:
            // coerce to finite integer
            id += ((Math.random() * 16) | 0).toString(16);
        }
        ii += 1;
    }
    return id;
};
}());



// run shared js-env code - init-after
(function () {
local.apidocCreate = local.apidoc.apidocCreate;
local.browserTest({
modeTestReportCreate: true
});
local.cacheDict = {};
local.contentTypeDict = {
    // application
    ".js": "application/javascript; charset=utf-8",
    ".json": "application/json; charset=utf-8",
    ".pdf": "application/pdf",
    ".xml": "application/xml; charset=utf-8",
    // image
    ".bmp": "image/bmp",
    ".gif": "image/gif",
    ".jpeg": "image/jpeg",
    ".jpg": "image/jpeg",
    ".png": "image/png",
    ".svg": "image/svg+xml; charset=utf-8",
    // text
    ".css": "text/css; charset=utf-8",
    ".htm": "text/html; charset=utf-8",
    ".html": "text/html; charset=utf-8",
    ".md": "text/markdown; charset=utf-8",
    ".txt": "text/plain; charset=utf-8"
};
// init env
local.env = (
    local.isBrowser
    ? {}
    : process.env
);
local.objectSetDefault(local.env, {
    npm_package_nameLib: (local.env.npm_package_name || "").replace((
        /\W/g
    ), "_")
});
local.objectSetDefault(local.env, {
    npm_package_description: "the greatest app in the world!",
    npm_package_name: "my-app-lite",
    npm_package_nameLib: "my_app",
    npm_package_version: "0.0.1"
});
local.errDefault = new Error("default-error");
globalThis.utility2_onReadyAfter = (
    globalThis.utility2_onReadyAfter || function (onError) {
    /*
     * this function will call onError when utility2_onReadyBefore.counter === 0
     */
        globalThis.utility2_onReadyBefore.counter += 1;
        local.taskCreate({
            key: "globalThis.utility2_onReadyAfter"
        }, null, onError);
        setTimeout(globalThis.utility2_onReadyBefore);
        return onError;
    }
);
globalThis.utility2_onReadyBefore = (
    globalThis.utility2_onReadyBefore
    || local.onParallel(function (err) {
    /*
     * this function will keep track of utility2_onReadyBefore.counter
     */
        local.taskCreate({
            key: "globalThis.utility2_onReadyAfter"
        }, function (onError) {
            onError(err);
        }, local.onErrorThrow);
    })
);
local.istanbulCoverageMerge = local.istanbul.coverageMerge || local.identity;
// cbranch-no cstat-no fstat-no missing-if-branch
local.istanbulCoverageReportCreate = (
    local.istanbul.coverageReportCreate || local.identity
);
local.istanbulInstrumentInPackage = (
    local.istanbul.instrumentInPackage || local.identity
);
local.istanbulInstrumentSync = local.istanbul.instrumentSync || local.identity;
local.jslintAndPrint = local.jslint.jslintAndPrint || local.identity;
local.regexpCharsetEncodeUri = (
    /\w!#\$%&'\(\)\*\+,\-\.\/:;=\?@~/
);
local.regexpCharsetEncodeUriComponent = (
    /\w!%'\(\)\*\-\.~/
);
// https://github.com/chjj/marked/blob/v0.3.7/lib/marked.js#L499
local.regexpMatchUrl = (
    /\bhttps?:\/\/[^\s<]+[^<.,:;"')\]\s]/
);
// https://www.w3.org/TR/html5/sec-forms.html#email-state-typeemail
local.regexpValidateEmail = (
    /^[a-zA-Z0-9.!#$%&'*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?)*$/
);
// https://en.wikipedia.org/wiki/E.164
local.regexpValidatePhone = (
    /^(?:\+\d{1,3}[\u0020\-]?)?(?:\(\d{1,4}\)[\u0020\-]?)?\d[\d\u0020\-]{7,17}$/
);
local.regexpValidateUuid = (
    /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/
);
local.stringCharsetAscii = (
    "\u0000\u0001\u0002\u0003\u0004\u0005\u0006\u0007"
    + "\b\t\n\u000b\f\r\u000e\u000f"
    + "\u0010\u0011\u0012\u0013\u0014\u0015\u0016\u0017"
    + "\u0018\u0019\u001a\u001b\u001c\u001d\u001e\u001f"
    + " !\"#$%&'()*+,-./0123456789:;<=>?"
    + "@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_"
    + "`abcdefghijklmnopqrstuvwxyz{|}~\u007f"
);
local.stringCharsetEncodeUri = (
    "!#$%&'()*+,-./"
    + "0123456789:;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"
);
local.stringCharsetEncodeUriComponent = (
    "!%'()*-."
    + "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~"
);
local.stringHelloEmoji = "hello \ud83d\ude01\n";
// mock swgg
local.swgg = local.swgg || {
    apiUpdate: local.nop,
    normalizeSwaggerJson: local.nop,
    swaggerValidate: local.nop
};
local.taskOnTaskDict = {};
// init serverLocalHost
local.urlParse("");
// init timeoutDefault
if (local.isBrowser) {
    location.search.replace((
        /\b(NODE_ENV|mode[A-Z]\w+|timeExit|timeoutDefault)=([^&#]+)/g
    ), function (match0, key, value) {
        local[key] = decodeURIComponent(value);
        local.env[key] = local[key];
        // try to JSON.parse the string
        local.tryCatchOnError(function () {
            local[key] = JSON.parse(match0);
        }, local.nop);
    });
} else {
    local.timeoutDefault = local.env.npm_config_timeout_default;
}
// init timeExit
local.timeExit = (
    Number(local.env.npm_config_time_exit) || local.timeExit
    || Number(Date.now() + Number(local.env.npm_config_timeout_exit))
);
if (local.timeExit) {
    local.timeoutDefault = local.timeExit - Date.now();
    setTimeout(local.exit, local.timeoutDefault);
}
// re-init timeoutDefault
local.timeoutDefault = Number(local.timeoutDefault) || 30000;
globalThis.utility2_onReadyAfter(local.nop);
}());



// run browser js-env code - init-after
(function () {
if (!local.isBrowser) {
    return;
}
// require modules
local.http = local._http;
local.https = local._http;
}());



/* istanbul ignore next */
// run node js-env code - init-after
(function () {
if (local.isBrowser) {
    return;
}
local.Module = require("module");
// init env
local.objectAssignDefault(local.env, {
    npm_config_dir_build: process.cwd() + "/tmp/build",
    npm_config_dir_tmp: process.cwd() + "/tmp"
});
// merge previous test-report
if (local.env.npm_config_file_test_report_merge) {
    local.testReportMerge(
        globalThis.utility2_testReport,
        local.fsReadFileOrEmptyStringSync(
            local.env.npm_config_file_test_report_merge,
            "json"
        )
    );
    if (process.argv[2] !== "--help") {
        console.error(
            "\n" + local.env.MODE_BUILD + " - merged test-report from file "
            + local.env.npm_config_file_test_report_merge
        );
    }
}
// init cli
if (module === require.main && (!globalThis.utility2_rollup || (
    process.argv[2]
    && local.cliDict[process.argv[2]]
    && process.argv[2].indexOf("utility2.") === 0
))) {
    local.cliRun({}, local.nop);
    if (local.cliDict[process.argv[2]]) {
        local.cliDict[process.argv[2]]();
        switch (process.argv[2]) {
        case "--interactive":
        case "-i":
        case "utility2.swaggerValidateFile":
        case "utility2.start":
            break;
        default:
            return;
        }
    }
}
/* validateLineSortedReset */
// override assets
[
    "/assets.index.template.html",
    "/assets.swgg.swagger.json",
    "/assets.swgg.swagger.server.json"
].forEach(function (file) {
    local.assetsDict[file] = local.assetsDict[file] || "";
    if (process.argv[2] !== "--help" && local.fs.existsSync(__dirname + file)) {
        console.error("override assets " + __dirname + file);
        local.assetsDict[file] = local.fs.readFileSync(
            __dirname + file,
            "utf8"
        );
    }
});
if (globalThis.utility2_rollup) {
    local.assetsDict["/assets.utility2.rollup.js"] = (
        local.fs.readFileSync(
            __filename,
            "utf8"
        ).split("\n/* script-end /assets.utility2.rollup.end.js */")[0]
        + "\n/* script-end /assets.utility2.rollup.end.js */\n"
    );
    return;
}
// init assets
[
    "/assets.utility2.example.js",
    "/assets.utility2.html",
    "/assets.utility2.test.js",
    "lib.apidoc.js",
    "lib.db.js",
    "lib.github_crud.js",
    "lib.istanbul.js",
    "lib.jslint.js",
    "lib.marked.js",
    "lib.sjcl.js",
    "lib.swgg.js",
    "lib.utility2.js",
    "test.js"
].forEach(function (key) {
    switch (key) {
    case "/assets.utility2.example.js":
        local.assetsDict[key] = "";
        local.tryCatchOnError(function () {
            local.fs.readFileSync(
                __dirname + "/README.md",
                "utf8"
            ).replace((
                /```javascript([\S\s]*?)```/
            ), function (ignore, match1) {
                local.assetsDict[key] = match1.trim() + "\n";
            });
        }, local.nop);
        break;
    case "/assets.utility2.html":
        local.assetsDict[key] = "";
        local.tryCatchOnError(function () {
            local.fs.readFileSync(__dirname + "/README.md", "utf8").replace((
                /<!doctype\u0020html>[\S\s]*?<\/html>\\n\\\n/
            ), function (match0) {
                local.assetsDict[key] = (
                    local.templateRender(match0
                    .replace((
                        /\\n\\$/gm
                    ), "")
                    .replace(
                        "<script src=\"assets.app.js\"></script>\n",
                        (
                            "<script "
                            + "src=\"assets.utility2.rollup.js\"></script>\n"
                            + "<script "
                            + "src=\"assets.utility2.example.js\"></script>\n"
                            + "<script "
                            + "src=\"assets.utility2.test.js\"></script>\n"
                        )
                    )
                    .replace("assets.example.js", "assets.utility2.example.js")
                    .replace("assets.test.js", "assets.utility2.test.js")
                    .replace((
                        /npm_package_/g
                    ), "")
                    // uncomment utility2-comment
                    .replace((
                        /<!--\u0020utility2-comment\b([\S\s]*?)\butility2-comment\u0020-->/g
                    ), "$1"), {
                        env: local.objectSetDefault({
                            version: "0.0.1"
                        }, require(__dirname + "/package.json")),
                        isRollup: true
                    })
                );
            });
        }, local.nop);
        break;
    case "/assets.utility2.test.js":
        local.assetsDict[key] = local.fsReadFileOrEmptyStringSync(
            __dirname + "/test.js",
            "utf8"
        );
        break;
    case "lib.swgg.js":
    case "lib.utility2.js":
        key = key.replace("lib.", "");
        local.assetsDict["/assets." + key] = local.fsReadFileOrEmptyStringSync(
            __dirname + "/lib." + key,
            "utf8"
        ).replace((
            /^#!\//
        ), "// ");
        break;
    default:
        local.assetsDict["/assets.utility2." + key] = (
            local.fsReadFileOrEmptyStringSync(
                __dirname + "/" + key,
                "utf8"
            ).replace((
                /^#!\//
            ), "// ")
        );
    }
});
local.assetsDict["/assets.utility2.rollup.js"] = [
    "header",
    "/assets.utility2.rollup.begin.js",
    "lib.apidoc.js",
    "lib.db.js",
    "lib.github_crud.js",
    "lib.istanbul.js",
    "lib.jslint.js",
    "lib.marked.js",
    "lib.sjcl.js",
    "lib.utility2.js",
    "lib.swgg.js",
    "/assets.utility2.example.js",
    "/assets.utility2.html",
    "/assets.utility2.test.js",
    "/assets.utility2.rollup.end.js"
].map(function (key) {
    var script;
    switch (key) {
    case "/assets.utility2.example.js":
    case "/assets.utility2.html":
    case "/assets.utility2.test.js":
        // handle large string-replace
        script = local.assetsDict["/assets.utility2.rollup.content.js"]
        .split("/* utility2.rollup.js content */");
        script.splice(1, 0, (
            "local.assetsDict[\"" + key + "\"] = "
            + JSON.stringify(local.assetsDict[key])
        ).replace((
            /\\\\/g
        ), "\u0000").replace((
            /\\n/g
        ), "\\n\\\n").replace((
            /\u0000/g
        ), "\\\\"));
        script = script.join("");
        script += "\n";
        break;
    case "/assets.utility2.rollup.begin.js":
    case "/assets.utility2.rollup.end.js":
        script = local.assetsDict[key];
        break;
    case "header":
        return (
            "/* this rollup was created with utility2\n"
            + " * https://github.com/kaizhu256/node-utility2\n"
            + " */\n"
        );
    case "lib.swgg.js":
    case "lib.utility2.js":
        key = "/assets." + key.replace("lib.", "");
        script = local.assetsDict[key];
        break;
    default:
        key = "/assets.utility2." + key;
        script = local.assetsDict[key];
    }
    return (
        "/* script-begin " + key + " */\n"
        + script.trim()
        + "\n/* script-end " + key + " */\n"
    );
}).join("\n\n\n");
// init lib dependents
[
    "swgg"
].forEach(function (lib) {
    var file;
    file = __dirname + "/lib." + lib + ".js";
    if (local.fs.existsSync(file)) {
        local[lib] = require(file);
    }
});
}());



}());
/* script-end /assets.my_app.js */



/* script-begin /assets.example.js */
/*
example.js

this script will demo automated browser-tests with coverage (via electron and istanbul)

instruction
    1. save this script as example.js
    2. run the shell-command:
        $ npm install utility2 electron-lite && \
            PATH="$(pwd)/node_modules/.bin:$PATH" \
            PORT=8081 \
            npm_config_mode_coverage=utility2 \
            node_modules/.bin/utility2 test example.js
    3. view test-report in ./tmp/build/test-report.html
    4. view coverage in ./tmp/build/coverage.html/index.html
*/



/* istanbul instrument in package utility2 */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2_rollup
    || globalThis.utility2_utility2
    || globalThis.utility2_moduleExports
);
// init exports
globalThis.local = local;
// run test-server
local.testRunServer(local);
// init assets
local.assetsDict["/assets.hello.txt"] = "hello \ud83d\ude01\n";
local.assetsDict["/assets.index.template.html"] = "";
}());



// run shared js-env code - function
(function () {
local.testCase_ajax_200 = function (opt, onError) {
/*
 * this function will test ajax's "200 ok" handling-behavior
 */
    if (!local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = {};
    // test ajax-path "assets.hello.txt"
    local.ajax({
        url: "assets.hello.txt"
    }, function (err, xhr) {
        local.tryCatchOnError(function () {
            // validate no err occurred
            local.assertThrow(!err, err);
            // validate data
            opt.data = xhr.responseText;
            local.assertThrow(
                opt.data === "hello \ud83d\ude01\n",
                opt.data
            );
            onError();
        }, onError);
    });
};

local.testCase_ajax_404 = function (opt, onError) {
/*
 * this function will test ajax's "404 not found" handling-behavior
 */
    if (!local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = {};
    // test ajax-path "/undefined"
    local.ajax({
        url: "/undefined"
    }, function (err) {
        local.tryCatchOnError(function () {
            // validate err occurred
            local.assertThrow(err, err);
            opt.statusCode = err.statusCode;
            // validate 404 http statusCode
            local.assertThrow(opt.statusCode === 404, opt.statusCode);
            onError();
        }, onError);
    });
};

local.testCase_webpage_default = function (opt, onError) {
/*
 * this function will test webpage's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = {
        modeCoverageMerge: true,
        url: local.serverLocalHost + "?modeTest=1"
    };
    local.browserTest(opt, onError);
};
}());



/* istanbul ignore next */
// run browser js-env code - init-test
(function () {
if (!local.isBrowser) {
    return;
}
// log stderr and stdout to #outputStdout1
["error", "log"].forEach(function (key) {
    var argList;
    var elem;
    var fnc;
    elem = document.querySelector(
        "#outputStdout1"
    );
    if (!elem) {
        return;
    }
    fnc = console[key];
    console[key] = function () {
        argList = Array.from(arguments); // jslint ignore:line
        fnc.apply(console, argList);
        // append text to #outputStdout1
        elem.textContent += argList.map(function (arg) {
            return (
                typeof arg === "string"
                ? arg
                : JSON.stringify(arg, null, 4)
            );
        }).join(" ").replace((
            /\u001b\[\d*m/g
        ), "") + "\n";
        // scroll textarea to bottom
        elem.scrollTop = elem.scrollHeight;
    };
});
Object.assign(local, globalThis.domOnEventDelegateDict);
globalThis.domOnEventDelegateDict = local;
local.onEventDomDb = (
    local.db && local.db.onEventDomDb
);
local.testRunBrowser = function (evt) {
/*
 * this function will run browser-tests
 */
    switch (
        !evt.ctrlKey
        && !evt.metaKey
        && (
            evt.modeInit
            || (evt.type + "." + (evt.target && evt.target.id))
        )
    ) {
    // custom-case
    case "click.jslintAutofixButton1":
    case "keydown.inputEval1":
    case true:
        globalThis.domOnEventDelegateDict.domOnEventResetOutput();
        // jslint #inputEval1
        local.jslint.jslintAndPrint(
            document.querySelector(
                "#inputEval1"
            ).value,
            "inputEval1.js",
            {
                autofix: (
                    evt
                    && evt.currentTarget
                    && evt.currentTarget.id === "jslintAutofixButton1"
                ),
                conditional: true
            }
        );
        if (local.jslint.jslintResult.autofix) {
            document.querySelector(
                "#inputEval1"
            ).value = (
                local.jslint.jslintResult.code
            );
        }
        document.querySelector(
            "#outputJslintPre1"
        ).textContent = (
            local.jslint.jslintResult.errText
        ).replace((
            /\u001b\[\d*m/g
        ), "").trim();
        // try to cleanup __coverage__
        try {
            delete globalThis.__coverage__["/inputEval1.js"];
        } catch (ignore) {}
        // try to cover and eval input-code
        try {
            document.querySelector(
                "#outputCode1"
            ).textContent = (
                local.istanbul.instrumentSync(
                    document.querySelector(
                        "#inputEval1"
                    ).value,
                    "/inputEval1.js"
                )
            );
            eval( // jslint ignore:line
                document.querySelector(
                    "#outputCode1"
                ).textContent.replace((
                    /^#!\//
                ), "// ")
            );
            document.querySelector(
                "#coverageReportDiv1"
            ).innerHTML = (
                local.istanbul.coverageReportCreate({
                    coverage: window.__coverage__
                })
            );
        } catch (errorCaught2) {
            console.error(errorCaught2);
        }
        return;
    case "click.testRunButton1":
        local.modeTest = 1;
        local.testRunDefault(local);
        return;
    // run browser-tests
    default:
        if (
            (evt.target && evt.target.id) !== "testRunButton1"
            && !(evt.modeInit && (
                /\bmodeTest=1\b/
            ).test(location.search))
        ) {
            return;
        }
        // show browser-tests
        if (document.querySelector(
            "#testReportDiv1"
        ).style.maxHeight === "0px") {
            globalThis.domOnEventDelegateDict.domOnEventResetOutput();
            local.uiAnimateSlideDown(document.querySelector(
                "#testReportDiv1"
            ));
            document.querySelector(
                "#testRunButton1"
            ).textContent = "hide internal test";
            local.modeTest = 1;
            local.testRunDefault(local);
            return;
        }
        // hide browser-tests
        local.uiAnimateSlideUp(document.querySelector(
            "#testReportDiv1"
        ));
        document.querySelector(
            "#testRunButton1"
        ).textContent = "run internal test";
    }
};

local.testRunBrowser({
    modeInit: true
});
}());



/* istanbul ignore next */
// run node js-env code - init-test
(function () {
if (local.isBrowser) {
    return;
}
// init exports
module.exports = local;
/* validateLineSortedReset */
// init assets
local.assetsDict = local.assetsDict || {};
[
    "assets.index.template.html",
    "assets.swgg.swagger.json",
    "assets.swgg.swagger.server.json"
].forEach(function (file) {
    file = "/" + file;
    local.assetsDict[file] = local.assetsDict[file] || "";
    if (local.fs.existsSync(local.__dirname + file)) {
        local.assetsDict[file] = local.fs.readFileSync(
            local.__dirname + file,
            "utf8"
        );
    }
});
/* jslint ignore:start */
local.assetsDict["/assets.index.template.html"] = '\
<!doctype html>\n\
<html lang="en">\n\
<head>\n\
<meta charset="utf-8">\n\
<meta name="viewport" content="width=device-width, initial-scale=1">\n\
<!-- "assets.utility2.template.html" -->\n\
<title>{{env.npm_package_name}} ({{env.npm_package_version}})</title>\n\
<style>\n\
/* jslint utility2:true */\n\
/*csslint\n\
*/\n\
/* csslint ignore:start */\n\
*,\n\
*:after,\n\
*:before {\n\
    box-sizing: border-box;\n\
}\n\
/* csslint ignore:end */\n\
@keyframes uiAnimateShake {\n\
0%,\n\
50% {\n\
    transform: translateX(10px);\n\
}\n\
100% {\n\
    transform: translateX(0);\n\
}\n\
25%,\n\
75% {\n\
    transform: translateX(-10px);\n\
}\n\
}\n\
@keyframes uiAnimateSpin {\n\
0% {\n\
    transform: rotate(0deg);\n\
}\n\
100% {\n\
    transform: rotate(360deg);\n\
}\n\
}\n\
a {\n\
    overflow-wrap: break-word;\n\
}\n\
body {\n\
    background: #eef;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: small;\n\
    margin: 0 40px;\n\
}\n\
body > div,\n\
body > form > div,\n\
body > form > input,\n\
body > form > pre,\n\
body > form > .button,\n\
body > form > .textarea,\n\
body > input,\n\
body > pre,\n\
body > .button,\n\
body > .textarea {\n\
    margin-bottom: 20px;\n\
    margin-top: 0;\n\
}\n\
body > form > input,\n\
body > form > .button,\n\
body > input,\n\
body > .button {\n\
    width: 20rem;\n\
}\n\
body > form > .textarea,\n\
body > .textarea {\n\
    height: 10rem;\n\
    width: 100%;\n\
}\n\
body > .readonly {\n\
    background: #ddd;\n\
}\n\
code,\n\
pre,\n\
.textarea {\n\
    font-family: Consolas, Menlo, monospace;\n\
    font-size: smaller;\n\
}\n\
pre {\n\
    overflow-wrap: break-word;\n\
    white-space: pre-wrap;\n\
}\n\
.button {\n\
    background-color: #fff;\n\
    border: 1px solid;\n\
    border-bottom-color: rgb(186, 186, 186);\n\
    border-left-color: rgb(209, 209, 209);\n\
    border-radius: 4px;\n\
    border-right-color: rgb(209, 209, 209);\n\
    border-top-color: rgb(216, 216, 216);\n\
    color: #00d;\n\
    cursor: pointer;\n\
    display: inline-block;\n\
    font-family: Arial, Helvetica, sans-serif;\n\
    font-size: 12px;\n\
    font-style: normal;\n\
    font-weight: normal;\n\
    margin: 0;\n\
    padding: 2px 7px 3px 7px;\n\
    text-align: center;\n\
    text-decoration: underline;\n\
}\n\
.colorError {\n\
    color: #d00;\n\
}\n\
.textarea {\n\
    background: #fff;\n\
    border: 1px solid #999;\n\
    border-radius: 0;\n\
    cursor: auto;\n\
    overflow: auto;\n\
    padding: 2px;\n\
}\n\
.uiAnimateShake {\n\
    animation-duration: 500ms;\n\
    animation-name: uiAnimateShake;\n\
}\n\
.uiAnimateSlide {\n\
    overflow-y: hidden;\n\
    transition: max-height ease-in 250ms, min-height ease-in 250ms, padding-bottom ease-in 250ms, padding-top ease-in 250ms;\n\
}\n\
.utility2FooterDiv {\n\
    text-align: center;\n\
}\n\
.zeroPixel {\n\
    border: 0;\n\
    height: 0;\n\
    margin: 0;\n\
    padding: 0;\n\
    width: 0;\n\
}\n\
</style>\n\
</head>\n\
<body>\n\
<div id="ajaxProgressDiv1" style="background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 500ms, width 1500ms; width: 0%; z-index: 1;"></div>\n\
<div class="uiAnimateSpin" style="animation: uiAnimateSpin 2s linear infinite; border: 5px solid #999; border-radius: 50%; border-top: 5px solid #7d7; display: none; height: 25px; vertical-align: middle; width: 25px;"></div>\n\
<a class="zeroPixel" download="db.persistence.json" href="" id="dbExportA1"></a>\n\
<input class="zeroPixel" data-onevent="onEventDomDb" data-onevent-db="dbImportInput" type="file">\n\
<script>\n\
/* jslint utility2:true */\n\
// init domOnEventWindowOnloadTimeElapsed\n\
(function () {\n\
/*\n\
 * this function will measure and print time-elapsed for window.onload\n\
 */\n\
    "use strict";\n\
    if (window.domOnEventWindowOnloadTimeElapsed) {\n\
        return;\n\
    }\n\
    window.domOnEventWindowOnloadTimeElapsed = Date.now() + 100;\n\
    window.addEventListener("load", function () {\n\
        setTimeout(function () {\n\
            window.domOnEventWindowOnloadTimeElapsed = (\n\
                Date.now()\n\
                - window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
            console.error(\n\
                "domOnEventWindowOnloadTimeElapsed = "\n\
                + window.domOnEventWindowOnloadTimeElapsed\n\
            );\n\
        }, 100);\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventDelegateDict\n\
(function () {\n\
/*\n\
 * this function will handle delegated dom-event\n\
 */\n\
    "use strict";\n\
    var timerTimeoutDict;\n\
    if (window.domOnEventDelegateDict) {\n\
        return;\n\
    }\n\
    window.domOnEventDelegateDict = {};\n\
    timerTimeoutDict = {};\n\
    window.domOnEventDelegateDict.domOnEventDelegate = function (evt) {\n\
        evt.targetOnEvent = evt.target.closest(\n\
            "[data-onevent]"\n\
        );\n\
        if (\n\
            !evt.targetOnEvent\n\
            || evt.targetOnEvent.dataset.onevent === "domOnEventNop"\n\
            || evt.target.closest(\n\
                ".disabled, .readonly"\n\
            )\n\
        ) {\n\
            return;\n\
        }\n\
        // rate-limit high-frequency-event\n\
        switch (evt.type) {\n\
        case "keydown":\n\
        case "keyup":\n\
            // filter non-input keyboard-event\n\
            if (!evt.target.closest(\n\
                "input, option, select, textarea"\n\
            )) {\n\
                return;\n\
            }\n\
            if (timerTimeoutDict[evt.type] !== true) {\n\
                timerTimeoutDict[evt.type] = timerTimeoutDict[\n\
                    evt.type\n\
                ] || setTimeout(function () {\n\
                    timerTimeoutDict[evt.type] = true;\n\
                    window.domOnEventDelegateDict.domOnEventDelegate(evt);\n\
                }, 50);\n\
                return;\n\
            }\n\
            timerTimeoutDict[evt.type] = null;\n\
            break;\n\
        }\n\
        switch (evt.targetOnEvent.tagName) {\n\
        case "BUTTON":\n\
        case "FORM":\n\
            evt.preventDefault();\n\
            break;\n\
        }\n\
        evt.stopPropagation();\n\
        window.domOnEventDelegateDict[evt.targetOnEvent.dataset.onevent](\n\
            evt\n\
        );\n\
    };\n\
    window.domOnEventDelegateDict.domOnEventResetOutput = function () {\n\
        Array.from(document.querySelectorAll(\n\
            ".onevent-reset-output"\n\
        )).forEach(function (elem) {\n\
            switch (elem.tagName) {\n\
            case "INPUT":\n\
            case "TEXTAREA":\n\
                elem.value = "";\n\
                break;\n\
            case "PRE":\n\
                elem.textContent = "";\n\
                break;\n\
            default:\n\
                elem.innerHTML = "";\n\
            }\n\
        });\n\
    };\n\
    // init event-handling\n\
    [\n\
        "change",\n\
        "click",\n\
        "keydown",\n\
        "submit"\n\
    ].forEach(function (eventType) {\n\
        document.addEventListener(\n\
            eventType,\n\
            window.domOnEventDelegateDict.domOnEventDelegate\n\
        );\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init timerIntervalAjaxProgressUpdate\n\
(function () {\n\
/*\n\
 * this function will increment ajax-progress-bar\n\
 * until webpage has loaded\n\
 */\n\
    "use strict";\n\
    var ajaxProgressDiv1;\n\
    var ajaxProgressState;\n\
    var ajaxProgressUpdate;\n\
    if (\n\
        window.timerIntervalAjaxProgressUpdate\n\
        || !document.querySelector(\n\
            "#ajaxProgressDiv1"\n\
        )\n\
    ) {\n\
        return;\n\
    }\n\
    ajaxProgressDiv1 = document.querySelector(\n\
        "#ajaxProgressDiv1"\n\
    );\n\
    setTimeout(function () {\n\
        ajaxProgressDiv1.style.width = "25%";\n\
    });\n\
    ajaxProgressState = 0;\n\
    ajaxProgressUpdate = (\n\
        window.local\n\
        && window.local.ajaxProgressUpdate\n\
    ) || function () {\n\
        ajaxProgressDiv1.style.width = "100%";\n\
        setTimeout(function () {\n\
            ajaxProgressDiv1.style.background = "transparent";\n\
            setTimeout(function () {\n\
                ajaxProgressDiv1.style.width = "0%";\n\
            }, 500);\n\
        }, 1000);\n\
    };\n\
    window.timerIntervalAjaxProgressUpdate = setInterval(function () {\n\
        ajaxProgressState += 1;\n\
        ajaxProgressDiv1.style.width = Math.max(\n\
            100 - 75 * Math.exp(-0.125 * ajaxProgressState),\n\
            ajaxProgressDiv1.style.width.slice(0, -1) | 0\n\
        ) + "%";\n\
    }, 1000);\n\
    window.addEventListener("load", function () {\n\
        clearInterval(window.timerIntervalAjaxProgressUpdate);\n\
        ajaxProgressUpdate();\n\
    });\n\
}());\n\
\n\
\n\
\n\
// init domOnEventSelectAllWithinPre\n\
(function () {\n\
/*\n\
 * this function will limit select-all within <pre tabIndex="0"> elements\n\
 * https://stackoverflow.com/questions/985272/selecting-text-in-an-element-akin-to-highlighting-with-your-mouse\n\
 */\n\
    "use strict";\n\
    if (window.domOnEventSelectAllWithinPre) {\n\
        return;\n\
    }\n\
    window.domOnEventSelectAllWithinPre = function (evt) {\n\
        var range;\n\
        var selection;\n\
        if (\n\
            evt\n\
            && evt.key === "a"\n\
            && (evt.ctrlKey || evt.metaKey)\n\
            && evt.target.closest(\n\
                "pre"\n\
            )\n\
        ) {\n\
            range = document.createRange();\n\
            range.selectNodeContents(evt.target.closest(\n\
                "pre"\n\
            ));\n\
            selection = window.getSelection();\n\
            selection.removeAllRanges();\n\
            selection.addRange(range);\n\
            evt.preventDefault();\n\
        }\n\
    };\n\
    // init event-handling\n\
    document.addEventListener(\n\
        "keydown",\n\
        window.domOnEventSelectAllWithinPre\n\
    );\n\
}());\n\
</script>\n\
<h1>\n\
<!-- utility2-comment\n\
    <a\n\
        {{#if env.npm_package_homepage}}\n\
        href="{{env.npm_package_homepage}}"\n\
        {{/if env.npm_package_homepage}}\n\
        target="_blank"\n\
    >\n\
utility2-comment -->\n\
        {{env.npm_package_name}} ({{env.npm_package_version}})\n\
<!-- utility2-comment\n\
    </a>\n\
utility2-comment -->\n\
</h1>\n\
<h3>{{env.npm_package_description}}</h3>\n\
<!-- utility2-comment\n\
<a class="button" download href="assets.app.js">download standalone app</a><br>\n\
<button class="button" data-onevent="testRunBrowser" id="testRunButton1">run internal test</button><br>\n\
utility2-comment -->\n\
\n\
\n\
\n\
<label>edit or paste script below to cover and test</label>\n\
<textarea class="textarea" data-onevent="testRunBrowser" id="inputEval1">\n\
// remove comment below to disable jslint\n\
/*jslint browser, devel*/\n\
/*global window*/\n\
(function () {\n\
    "use strict";\n\
    var testCaseDict;\n\
    testCaseDict = {};\n\
    testCaseDict.modeTest = 1;\n\
\n\
    // comment this testCase to disable failed error demo\n\
    testCaseDict.testCase_failed_error_demo = function (opt, onError) {\n\
    /*\n\
     * this function will run a failed error demo\n\
     */\n\
        // jslint-hack\n\
        window.utility2.nop(opt);\n\
        onError(new Error("this is a failed error demo"));\n\
    };\n\
\n\
    testCaseDict.testCase_passed_ajax_demo = function (opt, onError) {\n\
    /*\n\
     * this function will demo a passed ajax test\n\
     */\n\
        var data;\n\
        opt = {url: "/"};\n\
        // test ajax-req for main-page "/"\n\
        window.utility2.ajax(opt, function (err, xhr) {\n\
            try {\n\
                // validate no err occurred\n\
                console.assert(!err, err);\n\
                // validate "200 ok" status\n\
                console.assert(xhr.statusCode === 200, xhr.statusCode);\n\
                // validate non-empty data\n\
                data = xhr.responseText;\n\
                console.assert(data && data.length > 0, data);\n\
                onError();\n\
            } catch (errorCaught) {\n\
                onError(errorCaught);\n\
            }\n\
        });\n\
    };\n\
\n\
    window.utility2.testRunDefault(testCaseDict);\n\
}());\n\
</textarea>\n\
<button class="button" data-onevent="testRunBrowser" id="jslintAutofixButton1">jslint autofix</button><br>\n\
<pre class= "colorError" id="outputJslintPre1" tabindex="0"></pre>\n\
<label>instrumented-code</label>\n\
<pre class="readonly textarea" id="outputCode1" tabindex="0"></pre>\n\
<label>stderr and stdout</label>\n\
<pre class="onevent-reset-output readonly textarea" id="outputStdout1" tabindex="0"></pre>\n\
<div id="testReportDiv1"></div>\n\
<div id="coverageReportDiv1"></div>\n\
<!-- utility2-comment\n\
{{#if isRollup}}\n\
<script src="assets.app.js"></script>\n\
{{#unless isRollup}}\n\
utility2-comment -->\n\
<script src="assets.utility2.lib.istanbul.js"></script>\n\
<script src="assets.utility2.lib.jslint.js"></script>\n\
<script src="assets.utility2.lib.db.js"></script>\n\
<script src="assets.utility2.lib.marked.js"></script>\n\
<script src="assets.utility2.lib.sjcl.js"></script>\n\
<script src="assets.utility2.js"></script>\n\
<script>window.utility2_onReadyBefore.counter += 1;</script>\n\
<script src="jsonp.utility2.stateInit?callback=window.utility2.stateInit"></script>\n\
<script src="assets.example.js"></script>\n\
<script src="assets.test.js"></script>\n\
<script>window.utility2_onReadyBefore();</script>\n\
<!-- utility2-comment\n\
{{/if isRollup}}\n\
utility2-comment -->\n\
<div class="utility2FooterDiv">\n\
    [ this app was created with\n\
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>\n\
    ]\n\
</div>\n\
</body>\n\
</html>\n\
';
/* jslint ignore:end */
/* validateLineSortedReset */
/* jslint ignore:start */
local.assetsDict["/assets.utility2.js"] =
    local.assetsDict["/assets.utility2.js"] ||
    local.fs.readFileSync(local.__dirname + "/lib.utility2.js", "utf8"
).replace((/^#!\//), "// ");
/* jslint ignore:end */
/* validateLineSortedReset */
local.assetsDict["/"] = local.assetsDict["/assets.index.template.html"]
.replace((
    /\{\{env\.(\w+?)\}\}/g
), function (match0, match1) {
    switch (match1) {
    case "npm_package_description":
        return "the greatest app in the world!";
    case "npm_package_name":
        return "utility2";
    case "npm_package_nameLib":
        return "utility2";
    case "npm_package_version":
        return "0.0.1";
    default:
        return match0;
    }
});
local.assetsDict["/assets.example.html"] = local.assetsDict["/"];
local.assetsDict["/index.html"] = local.assetsDict["/"];
// init cli
if (module !== require.main || globalThis.utility2_rollup) {
    return;
}
/* validateLineSortedReset */
local.assetsDict["/assets.example.js"] = (
    local.assetsDict["/assets.example.js"]
    || local.fs.readFileSync(__filename, "utf8")
);
local.assetsDict["/favicon.ico"] = local.assetsDict["/favicon.ico"] || "";
// if $npm_config_timeout_exit exists,
// then exit this process after $npm_config_timeout_exit ms
if (Number(process.env.npm_config_timeout_exit)) {
    setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));
}
// start server
if (globalThis.utility2_serverHttp1) {
    return;
}
process.env.PORT = process.env.PORT || "8081";
console.error("http-server listening on port " + process.env.PORT);
local.http.createServer(function (req, res) {
    req.urlParsed = local.url.parse(req.url);
    if (local.assetsDict[req.urlParsed.pathname] !== undefined) {
        res.end(local.assetsDict[req.urlParsed.pathname]);
        return;
    }
    res.statusCode = 404;
    res.end();
}).listen(process.env.PORT);
}());



}());
/* script-end /assets.example.js */



/* script-begin /assets.test.js */
/* istanbul instrument in package utility2 */
/* istanbul ignore next */
/* jslint utility2:true */
(function (globalThis) {
    "use strict";
    var consoleError;
    var local;
    // init globalThis
    (function () {
        try {
            globalThis = Function("return this")(); // jslint ignore:line
        } catch (ignore) {}
    }());
    globalThis.globalThis = globalThis;
    // init debug_inline
    if (!globalThis["debug\u0049nline"]) {
        consoleError = console.error;
        globalThis["debug\u0049nline"] = function () {
        /*
         * this function will both print <arguments> to stderr
         * and return <arguments>[0]
         */
            var argList;
            argList = Array.from(arguments); // jslint ignore:line
            // debug arguments
            globalThis["debug\u0049nlineArguments"] = argList;
            consoleError("\n\ndebug\u0049nline");
            consoleError.apply(console, argList);
            consoleError("\n");
            // return arg0 for inspection
            return argList[0];
        };
    }
    // init local
    local = {};
    local.local = local;
    globalThis.globalLocal = local;
    // init isBrowser
    local.isBrowser = (
        typeof window === "object"
        && window === globalThis
        && typeof window.XMLHttpRequest === "function"
        && window.document
        && typeof window.document.querySelector === "function"
    );
    // init function
    local.assertThrow = function (passed, message) {
    /*
     * this function will throw err.<message> if <passed> is falsy
     */
        var err;
        if (passed) {
            return;
        }
        err = (
            // ternary-operator
            (
                message
                && typeof message.message === "string"
                && typeof message.stack === "string"
            )
            // if message is errObj, then leave as is
            ? message
            : new Error(
                typeof message === "string"
                // if message is a string, then leave as is
                ? message
                // else JSON.stringify message
                : JSON.stringify(message, null, 4)
            )
        );
        throw err;
    };
    local.functionOrNop = function (fnc) {
    /*
     * this function will if <fnc> exists,
     * them return <fnc>,
     * else return <nop>
     */
        return fnc || local.nop;
    };
    local.identity = function (value) {
    /*
     * this function will return <value>
     */
        return value;
    };
    local.nop = function () {
    /*
     * this function will do nothing
     */
        return;
    };
    local.objectAssignDefault = function (target, source) {
    /*
     * this function will if items from <target> are
     * null, undefined, or empty-string,
     * then overwrite them with items from <source>
     */
        target = target || {};
        Object.keys(source || {}).forEach(function (key) {
            if (
                target[key] === null
                || target[key] === undefined
                || target[key] === ""
            ) {
                target[key] = target[key] || source[key];
            }
        });
        return target;
    };
    // require builtin
    if (!local.isBrowser) {
        local.assert = require("assert");
        local.buffer = require("buffer");
        local.child_process = require("child_process");
        local.cluster = require("cluster");
        local.crypto = require("crypto");
        local.dgram = require("dgram");
        local.dns = require("dns");
        local.domain = require("domain");
        local.events = require("events");
        local.fs = require("fs");
        local.http = require("http");
        local.https = require("https");
        local.net = require("net");
        local.os = require("os");
        local.path = require("path");
        local.querystring = require("querystring");
        local.readline = require("readline");
        local.repl = require("repl");
        local.stream = require("stream");
        local.string_decoder = require("string_decoder");
        local.timers = require("timers");
        local.tls = require("tls");
        local.tty = require("tty");
        local.url = require("url");
        local.util = require("util");
        local.vm = require("vm");
        local.zlib = require("zlib");
    }
}(this));



(function (local) {
"use strict";



// run shared js-env code - init-before
(function () {
// init local
local = (
    globalThis.utility2 || require("./lib.utility2.js")
).requireReadme();
globalThis.local = local;
// init test
local.testRunDefault(local);
}());



// run shared js-env code - function
(function () {
local._testCase_testRunDefault_failure = function (opt, onError) {
/*
 * this function will test testRunDefault's failure handling-behavior
 */
    // test failure from callback handling-behavior
    onError(local.errDefault);
    // test failure from multiple-callback handling-behavior
    onError(null, opt);
    // test failure from ajax handling-behavior
    local.ajax({
        url: "/undefined"
    }, onError);
    // test failure from uncaught-uncaughtexception handling-behavior
    setTimeout(local.throwError);
    // test console.error handling-behavior
    local.testMock([
        [
            globalThis, {
                __coverage__: null
            }
        ]
    ], function (onError) {
        console.error();
        onError(null, opt);
    }, local.onErrorThrow);
    // test failure from thrown err handling-behavior
    throw local.errDefault;
};

local.testCase_FormData_default = function (opt, onError) {
/*
 * this function will test FormData's default handling-behavior
 */
    opt = {};
    opt.blob1 = new local.Blob([
        "aa", "bb", local.stringHelloEmoji, 0
    ]);
    opt.blob2 = new local.Blob([
        "aa", "bb", local.stringHelloEmoji, 0
    ], {
        type: "text/plain; charset=utf-8"
    });
    opt.data = new local.FormData();
    opt.data.append("text1", "aabb" + local.stringHelloEmoji + "0");
    // test file-upload handling-behavior
    opt.data.append("file1", opt.blob1);
    // test file-upload and filename handling-behavior
    opt.data.append("file2", opt.blob2, "filename2.txt");
    opt.method = "POST";
    opt.url = "/test.echo";
    local.ajax(opt, function (err, xhr) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // validate responseText
        local.assertThrow(xhr.responseText.indexOf(
            "\r\nContent-Disposition: form-data; "
            + "name=\"text1\"\r\n\r\naabbhello \ud83d\ude01\n0\r\n"
        ) >= 0, xhr.responseText);
        local.assertThrow(xhr.responseText.indexOf(
            "\r\nContent-Disposition: form-data; "
            + "name=\"file1\"\r\n\r\naabbhello \ud83d\ude01\n0\r\n"
        ) >= 0, xhr.responseText);
        local.assertThrow(xhr.responseText.indexOf(
            "\r\nContent-Disposition: form-data; name=\"file2\"; "
            + "filename=\"filename2.txt\"\r\nContent-Type: text/plain; "
            + "charset=utf-8\r\n\r\naabbhello \ud83d\ude01\n0\r\n"
        ) >= 0, xhr.responseText);
        onError(null, opt);
    });
};

local.testCase_FormData_err = function (opt, onError) {
/*
 * this function will test FormData's err handling-behavior
 */
    local.testMock([
        [
            local.FormData.prototype, {
                read: function (onError) {
                    onError(local.errDefault);
                }
            }
        ]
    ], function (onError) {
        local.ajax({
            data: new local.FormData(),
            method: "POST",
            url: "/test.echo"
        }, function (err) {
            // validate err occurred
            local.assertThrow(err, err);
            onError(null, opt);
        });
    }, onError);
};

local.testCase_FormData_nullCase = function (opt, onError) {
/*
 * this function will test FormData's null-case handling-behavior
 */
    local.ajax({
        data: new local.FormData(),
        method: "POST",
        url: "/test.echo"
    }, function (err, xhr) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // validate responseText
        local.assertThrow((
            /\r\n\r\n$/
        ).test(xhr.responseText), xhr.responseText);
        onError(null, opt);
    });
};

local.testCase_ajaxProgressUpdate_default = function (opt, onError) {
/*
 * this function will test ajaxProgressUpdate's default handling-behavior
 */
    opt = 0;
    local.testMock([
        [
            local, {
                ajaxProgressCounter: 0,
                ajaxProgressState: 0
            }
        ], [
            globalThis, {
                setTimeout: function (fnc) {
                    opt += 1;
                    local.ajaxProgressState = opt % 3;
                    fnc();
                }
            }
        ]
    ], function (onError) {
        // update ajax-progress
        local.ajaxProgressUpdate();
        // validate data
        local.assertJsonEqual(local.ajaxProgressCounter, 0);
        local.assertJsonEqual(local.ajaxProgressState, 2);
        // update ajax-progress
        local.ajaxProgressUpdate();
        // validate data
        local.assertJsonEqual(local.ajaxProgressCounter, 0);
        local.assertJsonEqual(local.ajaxProgressState, 1);
        // update ajax-progress
        local.ajaxProgressUpdate();
        // validate data
        local.assertJsonEqual(local.ajaxProgressCounter, 0);
        local.assertJsonEqual(local.ajaxProgressState, 0);
        onError(null, opt);
    }, onError);
};

local.testCase_ajax_cache = function (opt, onError) {
/*
 * this function will test ajax's cache handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = {};
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            // test http GET handling-behavior
            local.ajax({
                url: "assets.hello.txt"
            }, opt.onNext);
            break;
        case 2:
            // validate responseText
            local.assertJsonEqual(data.responseText, local.stringHelloEmoji);
            // test http GET 304 cache handling-behavior
            local.ajax({
                headers: {
                    "If-Modified-Since": (
                        new Date(Date.now() + 0xffff).toUTCString()
                    )
                },
                url: "assets.hello.txt"
            }, opt.onNext);
            break;
        case 3:
            // validate statusCode
            local.assertJsonEqual(data.statusCode, 304);
            opt.onNext();
            break;
        default:
            onError(err, opt);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.testCase_ajax_default = function (opt, onError) {
/*
 * this function will test ajax's default handling-behavior
 */
    var onParallel;
    onParallel = local.onParallel(onError);
    onParallel.counter += 1;

    // test ajax's abort handling-behavior
    onParallel.counter += 1;
    local.onParallelList({
        list: [
            "",
            "arraybuffer",
            "blob",
            "text"
        ]
    }, function (responseType, onParallel) {
        responseType = responseType.elem;
        onParallel.counter += 1;
        local.ajax({
            data: (
                responseType === "arraybuffer"
                // test POST buffer-data handling-behavior
                ? new TextEncoder().encode(local.stringHelloEmoji)
                : responseType === "blob"
                // test POST blob-data handling-behavior
                ? new local.Blob([
                    "",
                    new Uint8Array(0),
                    local.stringHelloEmoji
                ])
                // test POST string-data handling-behavior
                : local.stringHelloEmoji
            ),
            method: "POST",
            // test nodejs-res handling-behavior
            responseType: responseType.replace("blob", "arraybuffer"),
            url: "/test.body"
        }, function (err, xhr) {
            // validate no err occurred
            local.assertThrow(!err, err);
            // validate statusCode
            local.assertJsonEqual(xhr.statusCode, 200);
            // validate responseText
            switch (responseType) {
            case "arraybuffer":
            case "blob":
                local.assertJsonEqual(xhr.responseBuffer.byteLength, 11);
                local.assertJsonEqual(Array.from(xhr.responseBuffer), [
                    0x68,
                    0x65,
                    0x6c,
                    0x6c,
                    0x6f,
                    0x20,
                    0xf0,
                    0x9f,
                    0x98,
                    0x81,
                    0x0a
                ]);
                break;
            default:
                local.assertJsonEqual(xhr.responseText, local.stringHelloEmoji);
            }
            onParallel(null, opt);
        });
    }, onParallel);

    // test ajax's data handling-behavior
    onParallel.counter += 1;
    opt = local.ajax({
        url: "/test.timeout"
    }, function (err, xhr) {
        // validate err occurred
        local.assertThrow(err, err);
        // validate statusCode
        local.assertJsonEqual(xhr.statusCode, 500);
        onParallel(null, opt);
    });
    // test multiple-callback handling-behavior
    opt.onEvent({
        type: "abort"
    });
    opt.abort();
    opt.abort();

    // test ajax's echo handling-behavior
    onParallel.counter += 1;
    local.ajax({
        _aa: "aa",
        aa: "aa",
        data: local.stringHelloEmoji,
        // test req-header handling-behavior
        headers: {
            "X-Req-Header-Test": "aa"
        },
        method: "POST",
        // test modeDebug handling-behavior
        modeDebug: true,
        url: "/test.echo"
    }, function (err, xhr) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // validate statusCode
        local.assertJsonEqual(xhr.statusCode, 200);
        // validate resHeaders
        local.assertJsonEqual(xhr.resHeaders["x-res-header-test"], "bb");
        // validate responseText
        local.assertThrow((
            /\r\nhello\u0020\ud83d\ude01\n$/
        ).test(xhr.responseText), xhr.responseText);
        local.assertThrow((
            /\r\nx-req-header-test:\u0020aa\r\n/
        ).test(xhr.responseText), xhr.responseText);
        // validate properties
        local.assertJsonEqual(xhr._aa, undefined);
        local.assertJsonEqual(xhr.aa, "aa");
        onParallel(null, opt);
    });

    // test ajax's err handling-behavior
    onParallel.counter += 1;
    local.onParallelList({
        list: [
            {
                // test 404-not-found handling-behavior
                url: "/test.err-404"
            }, {
                // test 500-internal-server-error handling-behavior
                url: "/test.err-500"
            }, {
                // test undefined-status-code handling-behavior
                url: "/test.err-undefined"
            }, {
                // test corsForwardProxyHost handling-behavior
                corsForwardProxyHost: "https://undefined:0",
                location: {
                    host: "undefined.github.io"
                },
                timeout: 1,
                // test undefined-https-url handling-behavior
                url: "https://undefined:0"
            }
        ]
    }, function (option2, onParallel) {
        onParallel.counter += 1;
        local.ajax(option2.elem, function (err) {
            // validate err occurred
            local.assertThrow(err, err);
            onParallel(null, opt);
        });
    }, onParallel);

    // test ajax's file handling-behavior
    onParallel.counter += 1;
    local.ajax({
        url: "LICENSE"
    }, function (err, xhr) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // validate statusCode
        local.assertJsonEqual(xhr.statusCode, 200);
        // validate responseText
        local.assertThrow(xhr.responseText.indexOf(
            "MIT License (https://opensource.org/licenses/MIT)\n\n"
        ) === 0, xhr.data);
        onParallel(null, opt);
    });

    // test ajax's standalone handling-behavior
    onParallel.counter += 1;
    local.testMock([
        [
            local, {
                utility2: null
            }
        ]
    ], function (onError) {
        [
            "", "arraybuffer"
        ].forEach(function (responseType) {
            // test default handling-behavior
            onParallel.counter += 1;
            local.ajax({
                responseType,
                url: (
                    local.isBrowser
                    ? location.href
                    : local.serverLocalHost
                )
            }, function (err, xhr) {
                // validate no err occurred
                local.assertThrow(!err, err);
                // validate statusCode
                local.assertJsonEqual(xhr.statusCode, 200);
                onParallel();
            });
            // test err handling-behavior
            onParallel.counter += 1;
            local.ajax({
                responseType,
                undefined,
                url: (
                    local.isBrowser
                    ? location.href.replace((
                        /\?.*$/
                    ), "")
                    : local.serverLocalHost
                ) + "/undefined"
            }, function (err, xhr) {
                // validate err occurred
                local.assertThrow(err, err);
                // validate statusCode
                local.assertJsonEqual(xhr.statusCode, 404);
                onParallel();
            });
        });
        onError(null, opt);
    }, onParallel);
    onParallel();

    // test ajax's timeout handling-behavior
    onParallel.counter += 1;
    setTimeout(function () {
        local.ajax({
            timeout: 1,
            url: "/test.timeout"
        }, function (err, xhr) {
            // validate err occurred
            local.assertThrow(err, err);
            // validate statusCode
            local.assertJsonEqual(xhr.statusCode, 500);
            onParallel(null, opt);
        });
    }, 1000);
};

local.testCase_assertXxx_default = function (opt, onError) {
/*
 * this function will test assertXxx's default handling-behavior
 */
    // test assertion passed
    local.assertThrow(true, true);
    // test assertion failed with undefined message
    local.tryCatchOnError(function () {
        local.assertThrow(null);
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        // validate err.message
        local.assertJsonEqual(err.message, "");
    });
    // test assertion failed with string message
    local.tryCatchOnError(function () {
        local.assertThrow(null, "aa");
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        // validate err.message
        local.assertJsonEqual(err.message, "aa");
    });
    // test assertion failed with errObj
    local.tryCatchOnError(function () {
        local.assertThrow(null, local.errDefault);
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
    });
    // test assertion failed with json object
    local.tryCatchOnError(function () {
        local.assertThrow(null, {
            aa: 1
        });
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        // validate err.message
        local.assertJsonEqual(err.message, "{\n    \"aa\": 1\n}");
    });
    [
        "", 0, false, null, undefined
    ].forEach(function (aa, ii) {
        [
            "", 0, false, null, undefined
        ].forEach(function (bb, jj) {
            if (ii === jj) {
                // test assertJsonEqual's handling-behavior
                local.assertJsonEqual(aa, bb);
            } else {
                // test assertJsonNotEqual's handling-behavior
                local.assertJsonNotEqual(aa, bb);
            }
        });
    });
    onError(null, opt);
};

local.testCase_base64Xxx_default = function (opt, onError) {
/*
 * this function will test base64Xxx's default handling-behavior
 */
    opt = {};
    opt.base64 = local.base64FromBuffer(
        local.stringCharsetAscii + local.stringHelloEmoji
    );
    // test null-case handling-behavior
    local.assertJsonEqual(local.base64FromBuffer(), "");
    local.assertJsonEqual(local.bufferToUtf8(local.base64ToBuffer()), "");
    local.assertJsonEqual(local.base64ToUtf8(), "");
    local.assertJsonEqual(local.base64FromBuffer(local.base64ToBuffer()), "");
    local.assertJsonEqual(local.base64FromBuffer(local.base64ToUtf8()), "");
    // test identity handling-behavior
    local.assertJsonEqual(
        local.base64FromBuffer(local.base64ToBuffer(opt.base64)),
        opt.base64
    );
    local.assertJsonEqual(
        local.base64FromBuffer(local.base64ToUtf8(opt.base64)),
        opt.base64
    );
    onError(null, opt);
};

local.testCase_blobRead_default = function (opt, onError) {
/*
 * this function will test blobRead's default handling-behavior
 */
    var onParallel;
    onParallel = local.onParallel(onError);
    onParallel.counter += 1;
    // test data handling-behavior
    onParallel.counter += 1;
    local.blobRead(new local.Blob([
        "",
        "aa",
        "bb",
        new Uint8Array(0),
        local.stringHelloEmoji
    ]), function (err, data) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // validate data
        local.assertJsonEqual(
            local.bufferToUtf8(data),
            "aabbhello \ud83d\ude01\n"
        );
        onParallel(null, opt);
    });
    if (!local.isBrowser) {
        onParallel(null, opt);
        return;
    }
    // test err handling-behavior
    onParallel.counter += 1;
    local.testMock([
        [
            FileReader.prototype, {
                readAsArrayBuffer: function () {
                    this.onabort({
                        type: "abort"
                    });
                    this.onerror({
                        type: "error"
                    });
                }
            }
        ]
    ], function (onError) {
        local.blobRead(null, function (err) {
            // validate err occurred
            local.assertThrow(err, err);
        });
        onError(null, opt);
    }, onParallel);
    onParallel();
};

local.testCase_browserTest_electron = function (opt, onError) {
/*
 * this function will test browserTest's electron handling-behavior
 */
    opt = function (aa, bb, cc) {
        [
            aa, bb, cc
        ].forEach(function (fnc, ii) {
            if (typeof fnc === "function") {
                fnc(ii && opt);
                opt.onNext(null, opt);
                opt.utility2_testReportSave();
            }
        });
        return opt;
    };
    [
        "BrowserWindow",
        "addEventListener",
        "app",
        "browserWindow",
        "capturePage",
        "document",
        "documentElement",
        "electron",
        "fileCoverage",
        "fileElectronHtml",
        "fileScreenshot",
        "fileTestReport",
        "fs",
        "ipcRenderer",
        "loadURL",
        "modeCoverageMerge",
        "on",
        "once",
        "process",
        "prototype",
        "rename",
        "send",
        "toPNG",
        "unref",
        "window",
        "writeFile"
    ].forEach(function (key) {
        opt[key] = (
            key.indexOf("file") === 0
            ? "undefined"
            : opt
        );
    });
    opt.ipcMain = {
        on: function (_, fnc) {
            ["html", "testReport", "undefined"].forEach(function (type) {
                [
                    "<div></div>",
                    null,
                    {}, {
                        testPlatformList: [
                            {}
                        ]
                    }, {
                        coverage: {},
                        testPlatformList: [
                            {}
                        ]
                    }
                ].forEach(function (data) {
                    opt.isDoneTestReport = null;
                    fnc(_, type, data);
                });
            });
        }
    };
    opt.utility2_testReportSave = local.nop;
    local.testMock([
        [
            globalThis, {
                setTimeout: opt,
                utility2_testReport: null
            }
        ], [
            local, {
                fs: opt,
                fsReadFileOrEmptyStringSync: function () {
                    return "";
                },
                fsWriteFileWithMkdirpSync: opt,
                onParallel: opt
            }
        ]
    ], function (onError) {
        [
            "test", "undefined"
        ].forEach(function (modeBrowserTest) {
            [
                1, 10, 11, 20, 100
            ].forEach(function (modeNext) {
                opt.modeBrowserTest = modeBrowserTest;
                opt.modeNext = modeNext;
                switch (modeNext) {
                case 100:
                    local.tryCatchOnError(function () {
                        local.browserTest({
                            modeNext
                        }, opt);
                    }, local.nop);
                    break;
                default:
                    local.browserTest(opt, opt);
                }
            });
        });
        onError(null, opt);
    }, onError);
};

local.testCase_browserTest_screenshot = function (opt, onError) {
/*
 * this function will test browserTest's screenshot handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.browserTest({
        modeBrowserTest: "screenshot",
        timeoutDefault: 20000,
        url: "tmp/build/test-report.html"
    }, onError);
};

local.testCase_bufferIndexOfSubBuffer_default = function (opt, onError) {
/*
 * this function will test bufferIndexOfSubBuffer's default handling-behavior
 */
[
    {
        buffer: "",
        subBuffer: "",
        validate: 0
    }, {
        buffer: "",
        subBuffer: "aa",
        validate: -1
    }, {
        buffer: "aa",
        subBuffer: "",
        validate: 0
    }, {
        buffer: "aa",
        subBuffer: "aa",
        validate: 0
    }, {
        buffer: "aa",
        subBuffer: "bb",
        validate: -1
    }, {
        buffer: "aaaa",
        subBuffer: "aa",
        validate: 0
    }, {
        buffer: "aabb",
        subBuffer: "aa",
        validate: 0
    }, {
        buffer: "aabb",
        subBuffer: "bb",
        validate: 2
    }, {
        buffer: "aabbaa",
        subBuffer: "aa",
        validate: 0
    }, {
        buffer: "aabbaa",
        subBuffer: "bb",
        validate: 2
    }, {
        buffer: "aabbaa",
        subBuffer: "ba",
        validate: 3
    }
].forEach(function (opt) {
    local.assertJsonEqual(local.bufferIndexOfSubBuffer(
        new TextEncoder().encode(opt.buffer),
        new TextEncoder().encode(opt.subBuffer),
        opt.fromIndex
    ), opt.validate);
});
onError(null, opt);
};

local.testCase_bufferValidateAndCoerce_err = function (opt, onError) {
/*
 * this function will test bufferValidateAndCoerce's err handling-behavior
 */
    [[], 0, {}].forEach(function (elem) {
        opt = null;
        try {
            local.bufferValidateAndCoerce(elem);
        } catch (errCaught) {
            opt = errCaught;
        }
        // validate err occurred
        local.assertThrow(opt, elem);
    });
    onError(null, opt);
};

local.testCase_buildApidoc_default = function (opt, onError) {
/*
 * this function will test buildApidoc's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    // test $npm_config_mode_coverage=all handling-behavior
    local.testMock([
        [
            local.env, {
                npm_config_mode_coverage: "all"
            }
        ]
    ], function (onError) {
        local.buildApidoc(null, onError);
    }, local.onErrorThrow);
    local.buildApidoc({
        blacklistDict: {}
    }, onError);
};

local.testCase_buildApp_default = function (opt, onError) {
/*
 * this function will test buildApp's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.testCase_buildReadme_default(opt, local.onErrorThrow);
    local.testCase_buildLib_default(opt, local.onErrorThrow);
    local.testCase_buildTest_default(opt, local.onErrorThrow);
    local.buildApp({
        assetsList: [
            {
                file: "/assets.hello.txt",
                url: "/assets.hello.txt"
            }, {
                file: "/assets.script_only.html",
                url: "/assets.script_only.html"
            }, {
                file: "/assets.utility2.lib.db.js",
                url: "/assets.utility2.lib.db.js"
            }, {
                file: "/assets.utility2.lib.istanbul.js",
                url: "/assets.utility2.lib.istanbul.js"
            }, {
                file: "/assets.utility2.lib.jslint.js",
                url: "/assets.utility2.lib.jslint.js"
            }, {
                file: "/assets.utility2.lib.marked.js",
                url: "/assets.utility2.lib.marked.js"
            }, {
                file: "/assets.utility2.lib.sjcl.js",
                url: "/assets.utility2.lib.sjcl.js"
            }, {
                file: "/assets.utility2.rollup.js",
                url: "/assets.utility2.rollup.js"
            }
        ]
    }, onError);
};

local.testCase_buildLib_default = function (opt, onError) {
/*
 * this function will test buildLib's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.testMock([
        [
            local, {
                // test duplicate local function handling-behavior
                fsReadFileOrEmptyStringSync: function () {
                    return (
                        "local.nop = function () {\n"
                        + "/*\n"
                        + " * this function will do nothing\n"
                        + " */\n"
                        + "    return;\n"
                        + "};\n"
                        + "local.nop = function () {\n"
                        + "/*\n"
                        + " * this function will do nothing\n"
                        + " */\n"
                        + "    return;\n"
                        + "};\n"
                    );
                },
                templateRenderMyApp: function () {
                    return local.assetsDict["/assets.my_app.template.js"];
                }
            }
        ], [
            local.fs, {
                // test customize-local handling-behavior
                existsSync: function () {
                    return true;
                },
                writeFileSync: local.nop
            }
        ]
    ], function (onError) {
        local.buildLib({}, onError);
    }, local.onErrorThrow);
    local.buildLib({}, onError);
};

local.testCase_buildReadme_default = function (opt, onError) {
/*
 * this function will test buildReadme's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = {};
    // test shNpmTestPublished handling-behavior
    opt.dataFrom = local.fs.readFileSync("README.md", "utf8").replace(
        "#\u0021! shNpmTestPublished",
        "shNpmTestPublished"
    );
    opt = {};
    opt.customize = function () {
        // search-and-replace - customize dataTo
        [
            // customize quickstart-example-js
            (
                /#\u0020quickstart\u0020example.js[\S\s]*?istanbul\u0020instrument\u0020in\u0020package/
            ),
            // customize quickstart-footer
            (
                />download\u0020standalone\u0020app<[^`]*?"utility2FooterDiv"/
            ), (
                /```[^`]*?\n#\u0020extra\u0020screenshots/
            ),
            // customize build-script
            (
                /\n#\u0020internal\u0020build\u0020script\n[\S\s]*?\nshBuildCi\n/
            )
        ].forEach(function (rgx) {
            opt.dataFrom.replace(rgx, function (match0) {
                opt.dataTo = opt.dataTo.replace(rgx, match0);
            });
        });
    };
    local.buildReadme(opt, onError);
};

local.testCase_buildXxx_default = function (opt, onError) {
/*
 * this function will test buildXxx's default handling-behavior
 */
    local.testMock([
        [
            local, {
                assetsDict: {
                    "/": ""
                },
                browserTest: local.nop,
                buildApidoc: local.nop,
                buildLib: local.nop,
                buildReadme: local.nop,
                buildTest: local.nop,
                testCase_buildReadme_default: local.nop,
                testCase_buildLib_default: local.nop,
                testCase_buildTest_default: local.nop
            }
        ]
    ], function (onError) {
        local._testCase_buildApidoc_default(null, local.nop);
        local._testCase_buildApp_default(null, local.nop);
        local._testCase_buildLib_default(null, local.nop);
        local._testCase_buildReadme_default(null, local.nop);
        local._testCase_buildTest_default(null, local.nop);
        local._testCase_webpage_default(null, local.nop);
        local.assetsDict["/"] = "<script src=\"assets.test.js\"></script>";
        local._testCase_webpage_default(null, local.nop);
        onError(null, opt);
    }, onError);
};

local.testCase_childProcessSpawnWithTimeout_default = function (
    opt,
    onError
) {
/*
 * this function will test
 * childProcessSpawnWithTimeout's default handling-behavior
 */
    var onParallel;
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = {};
    onParallel = local.onParallel(onError);
    onParallel.counter += 1;
    // test default handling-behavior
    onParallel.counter += 1;
    local.childProcessSpawnWithTimeout("ls").on(
        "error",
        onParallel
    ).on("exit", function (exitCode, signal) {
        // validate exitCode
        local.assertJsonEqual(exitCode, 0);
        // validate signal
        local.assertJsonEqual(signal, null);
        onParallel(null, opt);
    });
    // test timeout handling-behavior
    onParallel.counter += 1;
    local.testMock([
        [
            local, {
                timeoutDefault: 1000
            }
        ]
    ], function (onError) {
        opt.childProcess = (
            local.childProcessSpawnWithTimeout("sleep", [
                5000
            ])
        );
        onError(null, opt);
    }, local.onErrorThrow);
    opt.childProcess
    .on("error", onParallel)
    .on("exit", function (exitCode, signal) {
        // validate exitCode
        local.assertJsonEqual(exitCode, null);
        // validate signal
        local.assertJsonEqual(signal, "SIGKILL");
        onParallel(null, opt);
    });
    onParallel(null, opt);
};

local.testCase_childProcessSpawnWithUtility2_err = function (
    opt,
    onError
) {
/*
 * this function will test
 * childProcessSpawnWithTimeout's err handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.testMock([
        // test __dirname handling-behavior
        [
            process.env, {
                npm_config_dir_utility2: ""
            }
        ]
    ], function (onError) {
        local.local.childProcessSpawnWithUtility2("undefined", function (err) {
            // validate err occurred
            local.assertThrow(err, err);
        });
        onError(null, opt);
    }, onError);
};

local.testCase_cliRun_default = function (opt, onError) {
/*
 * this function will test cliRun's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.testMock([
        [
            local, {
                replStart: null
            }
        ], [
            local.cliDict, {
                _default: local.nop,
                _help: null
            }
        ], [
            local.repl, {
                start: local.nop
            }
        ], [
            local.vm, {
                runInThisContext: local.nop
            }
        ], [
            process, {
                argv: []
            }
        ]
    ], function (onError) {
        // test default handling-behavior
        local.cliRun({
            rgxComment: (
                /^/
            )
        });
        // test builtin handling-behavior
        [
            "--eval",
            "--help",
            "--interactive",
            "--version",
            "undefined"
        ].forEach(function (key) {
            process.argv[2] = key;
            local.cliRun();
        });
        // test err handling-behavior
        local.cliDict._default = null;
        local.cliDict._help = null;
        local.tryCatchOnError(local.cliRun, local.nop);
        onError(null, opt);
    }, onError);
};

local.testCase_corsBackendHostInject_default = function (opt, onError) {
/*
 * this function will corsBackendHostInject's default handling-behavior
 */
    // test null-case handling-behavior
    local.assertJsonEqual(local.corsBackendHostInject(), undefined);
    // test override-all handling-behavior
    local.assertJsonEqual(local.corsBackendHostInject(
        "cc.com",
        "aa-alpha.bb.com",
        null,
        {
            host: "github.io",
            pathname: "/build..beta..travis-ci.org/"
        }
    ), "aa-beta.bb.com");
    // test override-rgx handling-behavior
    local.assertJsonEqual(local.corsBackendHostInject(
        "cc/dd",
        "aa-alpha.bb.com/",
        (
            /(^cc\/)/m
        ),
        {
            host: "github.io",
            pathname: "/build..beta..travis-ci.org/"
        }
    ), "aa-beta.bb.com/cc/dd");
    onError(null, opt);
};

local.testCase_corsForwardProxyHostIfNeeded_default = function (
    opt,
    onError
) {
/*
 * this function will corsForwardProxyHostIfNeeded's default handling-behavior
 */
    if (!local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.assertThrow(local.corsForwardProxyHostIfNeeded({
        location: {
            host: "undefined.github.io"
        },
        url: "https://example.com"
    }).indexOf(".herokuapp.com") >= 0);
    onError(null, opt);
};

/* istanbul ignore next */
local.testCase_cryptoAesXxxCbcRawXxx_default = function (opt, onError) {
/*
 * this function will cryptoAesXxxCbcRawXxx's default handling-behavior
 */
    if (!local.nop()) {
        onError();
        return;
    }
    opt = {};
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        case 1:
            // encrypt data
            opt.data = new TextEncoder().encode("aa");
            opt.key = "0123456789abcdef0123456789abcdef";
            opt.mode = null;
            local.cryptoAesXxxCbcRawEncrypt(opt, opt.onNext);
            break;
        case 2:
            // decrypt data
            opt.data = data.buffer;
            local.cryptoAesXxxCbcRawDecrypt(opt, opt.onNext);
            break;
        case 3:
            // validate data
            local.assertJsonEqual(local.bufferToUtf8(data), "aa");
            opt.onNext();
            break;
        case 4:
            // encrypt data - base64
            opt.data = new TextEncoder().encode("aa");
            opt.key = (
                "0123456789abcdef0123456789abcdef"
                + "0123456789abcdef0123456789abcdef"
            );
            opt.mode = "base64";
            local.cryptoAesXxxCbcRawEncrypt(opt, opt.onNext);
            break;
        case 5:
            // decrypt data - base64
            opt.data = data;
            local.cryptoAesXxxCbcRawDecrypt(opt, opt.onNext);
            break;
        case 6:
            // validate data
            local.assertJsonEqual(local.bufferToUtf8(data), "aa");
            opt.onNext();
            break;
        default:
            onError(err, opt);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.testCase_domFragmentRender_default = function (opt, onError) {
/*
 * this function will test domFragmentRender's default handling-behavior
 */
    if (!local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.assertJsonEqual(local.domFragmentRender("<div>{{value}}</div>", {
        value: "aa"
    }).children[0].outerHTML, "<div>aa</div>");
    onError(null, opt);
};

local.testCase_exit_err = function (opt, onError) {
/*
 * this function will test exit's err handling-behavior
 */
    local.exit("invalid-exitCode");
    onError(null, opt);
};

local.testCase_fsWriteFileWithMkdirpSync_default = function (opt, onError) {
/*
 * this function will test
 * fsWriteFileWithMkdirpSync's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.fsRmrSync("tmp/build/testCase_fsWriteFileWithMkdirpSync_default");
    // validate data
    local.assertJsonEqual(local.fsReadFileOrEmptyStringSync(
        "tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt",
        "utf8"
    ), "");
    local.fsWriteFileWithMkdirpSync(
        "tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt",
        "aa"
    );
    // validate data
    local.assertJsonEqual(local.fsReadFileOrEmptyStringSync(
        "tmp/build/testCase_fsWriteFileWithMkdirpSync_default/aa.txt",
        "utf8"
    ), "aa");
    onError(null, opt);
};

local.testCase_isNullOrUndefined_default = function (opt, onError) {
/*
 * this function will test isNullOrUndefined's default handling-behavior
 */
    // validate data
    local.assertJsonEqual(local.isNullOrUndefined(null), true);
    // validate data
    local.assertJsonEqual(local.isNullOrUndefined(undefined), true);
    // validate data
    local.assertJsonEqual(local.isNullOrUndefined(false), false);
    onError(null, opt);
};

local.testCase_jsonCopy_default = function (opt, onError) {
/*
 * this function will test jsonCopy's default handling-behavior
 */
// test various data-type handling-behavior
[
    undefined, null, false, true, 0, 1, 1.5, "a"
].forEach(function (elem) {
    local.assertJsonEqual(local.jsonCopy(elem), elem);
});
onError(null, opt);
};

local.testCase_jsonStringifyOrdered_default = function (opt, onError) {
/*
 * this function will test jsonStringifyOrdered's default handling-behavior
 */
    // test data-type handling-behavior
    local.identity([
        undefined,
        null,
        false,
        true,
        0,
        1,
        1.5,
        "a",
        {},
        []
    ]).forEach(function (data) {
        local.assertJsonEqual(
            local.jsonStringifyOrdered(data),
            JSON.stringify(data)
        );
    });
    // test data-ordering handling-behavior
    opt = {
        // test nested dict handling-behavior
        ff: {
            hh: 2,
            gg: 1
        },
        // test nested array handling-behavior
        ee: [
            1, null, undefined
        ],
        dd: local.nop,
        cc: undefined,
        bb: null,
        aa: 1
    };
    // test circular-reference handling-behavior
    opt.zz = opt;
    local.assertJsonEqual(
        opt,
        {
            aa: 1,
            bb: null,
            ee: [
                1, null, null
            ],
            ff: {
                gg: 1,
                hh: 2
            }
        }
    );
    onError(null, opt);
};

local.testCase_jwtAes256GcmXxx_default = function (opt, onError) {
/*
 * this function will test jwtAes256GcmXxx's default handling-behavior
 */
    opt = {};
    opt.key = local.jwtAes256KeyCreate();
    // use canonical example at https://jwt.io/
    opt.data = JSON.parse(local.jsonStringifyOrdered(local.normalizeJwt({
        sub: "1234567890",
        name: "John Doe",
        admin: true
    })));
    // encrypt token
    opt.token = local.jwtAes256GcmEncrypt(opt.data, opt.key);
    // validate encrypted-token
    local.assertJsonEqual(
        local.jwtAes256GcmDecrypt(opt.token, opt.key),
        opt.data
    );
    // test decryption-failed handling-behavior
    local.assertJsonEqual(local.jwtAes256GcmDecrypt(opt.token, null), {});
    onError(null, opt);
};

local.testCase_jwtHs256Xxx_default = function (opt, onError) {
/*
 * this function will test jwtHs256Xxx's default handling-behavior
 */
    opt = {};
    opt.key = local.normalizeJwtBase64Url(local.base64FromBuffer("secret"));
    // use canonical example at https://jwt.io/
    opt.data = {
        sub: "1234567890",
        name: "John Doe",
        admin: true
    };
    opt.token = local.jwtHs256Encode(opt.data, opt.key);
    // validate encoded-token
    local.assertJsonEqual(
        opt.token,
        (
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
            + ".eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZ"
            + "SI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9"
            + ".TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ"
        )
    );
    // validate decoded-data
    local.assertJsonEqual(
        local.jwtHs256Decode(opt.token, opt.key),
        {
            admin: true,
            name: "John Doe",
            sub: "1234567890"
        }
    );
    // test decoding-failed handling-behavior
    local.assertJsonEqual(local.jwtHs256Decode(opt.token, "undefined"), {});
    onError(null, opt);
};

local.testCase_libUtility2Js_standalone = function (opt, onError) {
/*
 * this function will test lib.utility2.js's standalone handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.fs.writeFileSync("tmp/lib.utility2.js", local.fs.readFileSync(
        "lib.utility2.js",
        "utf8"
    ).replace("/* istanbul instrument in package utility2 */", ""));
    require("./tmp/lib.utility2.js");
    onError(null, opt);
};

local.testCase_listGetElementRandom_default = function (opt, onError) {
/*
 * this function will test listGetRandom's default handling-behavior
 */
    opt = {};
    // init list
    opt.list = [
        "aa", "bb", "cc", "dd"
    ];
    opt.elemDict = {};
    // get 1000 random elem from list
    opt.ii = 0;
    while (opt.ii < 1000) {
        opt.elemDict[local.listGetElementRandom(opt.list)] = true;
        opt.ii += 1;
    }
    // validate all elem were retrieved from list
    local.assertJsonEqual(
        Object.keys(opt.elemDict).sort(),
        [
            "aa", "bb", "cc", "dd"
        ]
    );
    onError(null, opt);
};

local.testCase_listShuffle_default = function (opt, onError) {
/*
 * this function will test listShuffle's default handling-behavior
 */
    opt = {};
    // init list
    opt.list = "[0,1]";
    // shuffle list 100 times
    opt.ii = 0;
    while (opt.ii < 100) {
        opt.listShuffled = JSON.stringify(
            local.listShuffle(JSON.parse(opt.list))
        );
        // validate shuffled list
        local.assertJsonEqual(opt.listShuffled.length, opt.list.length);
        opt.changed = opt.changed || opt.listShuffled !== opt.list;
        opt.ii += 1;
    }
    // validate list changed at least once during the shuffle
    local.assertThrow(opt.changed, opt);
    onError(null, opt);
};

local.testCase_localStorageSetItemOrClear_default = function (
    opt,
    onError
) {
/*
 * this function will localStorageSetItemOrClear's default handling-behavior
 */
    if (!local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.localStorageSetItemOrClear(
        "testCase_localStorageSetItemOrClear_default",
        null
    );
    local.assertJsonEqual(
        localStorage.testCase_localStorageSetItemOrClear_default,
        "null"
    );
    local.testMock([
        [
            localStorage, {
                clear: null,
                setItem: function () {
                    throw local.errDefault;
                }
            }
        ]
    ], function (onError) {
        localStorage.clear = onError;
        local.localStorageSetItemOrClear(
            "testCase_localStorageSetItemOrClear_default",
            null
        );
    }, onError);
};

local.testCase_middlewareForwardProxy_default = function (opt, onError) {
/*
 * this function will test middlewareForwardProxy's default handling-behavior
 */
    var onParallel;
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    onParallel = local.onParallel(onError);
    onParallel.counter += 1;
    // test preflight-cors handling-behavior
    onParallel.counter += 1;
    local.ajax({
        headers: {
            "access-control-request-headers": (
                "forward-proxy-headers,forward-proxy-url"
            )
        },
        method: "OPTIONS",
        url: ""
    }, onParallel);
    // test forward-proxy-http handling-behavior
    onParallel.counter += 1;
    local.ajax({
        headers: {
            "forward-proxy-url": "/assets.hello.txt"
        },
        url: ""
    }, function (err, xhr) {
        // validate no err occurred
        local.assertThrow(!err, err);
        // validate responseText
        local.assertJsonEqual(xhr.responseText, local.stringHelloEmoji);
        onParallel(null, opt, xhr);
    });
    // test err handling-behavior
    onParallel.counter += 1;
    local.ajax({
        headers: {
            "forward-proxy-url": "https://undefined:0"
        },
        url: ""
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        onParallel(null, opt);
    });
    onParallel(null, opt);
};

local.testCase_middlewareJsonpStateInit_assetsList = function (
    opt,
    onError
) {
/*
 * this function will middlewareJsonpStateInit's assetsList handling-behavior
 */
    local.testMock([
        [
            local.env, {
                npm_package_assetsList: "undefined"
            }
        ], [
            local, {
                assetsDict: {}
            }
        ]
    ], function (onError) {
        local.middlewareJsonpStateInit({
            stateInit: true
        });
        // validate data
        local.assertJsonEqual(local.assetsDict["/undefined"], "");
        onError(null, opt);
    }, onError);
};

local.testCase_moduleDirname_default = function (opt, onError) {
/*
 * this function will test moduleDirname's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    // test null-case handling-behavior
    local.assertJsonEqual(
        local.moduleDirname(null, module.paths),
        process.cwd()
    );
    // test path handling-behavior
    local.assertJsonEqual(
        local.moduleDirname(".", module.paths),
        process.cwd()
    );
    local.assertJsonEqual(
        local.moduleDirname("./", module.paths),
        process.cwd()
    );
    // test module-exists handling-behavior
    opt = local.moduleDirname("electron-lite", module.paths);
    local.assertThrow((
        /\/electron-lite$/
    ).test(opt), opt);
    // test module-does-not-exist handling-behavior
    local.assertJsonEqual(
        local.moduleDirname("syntax-err", module.paths),
        ""
    );
    onError(null, opt);
};

local.testCase_numberToRomanNumerals_default = function (opt, onError) {
/*
 * this function will test numberToRomanNumerals's default handling-behavior
 */
    opt = {};
    opt.list = [
        "",
        "I",
        "II",
        "III",
        "IV",
        "V",
        "VI",
        "VII",
        "VIII",
        "IX",
        "X",
        "XI",
        "XII",
        "XIII",
        "XIV",
        "XV",
        "XVI",
        "XVII",
        "XVIII",
        "XIX",
        "XX",
        "XXI",
        "XXII",
        "XXIII",
        "XXIV",
        "XXV",
        "XXVI",
        "XXVII",
        "XXVIII",
        "XXIX",
        "XXX",
        "XXXI",
        "XXXII",
        "XXXIII",
        "XXXIV",
        "XXXV",
        "XXXVI",
        "XXXVII",
        "XXXVIII",
        "XXXIX",
        "XL",
        "XLI",
        "XLII",
        "XLIII",
        "XLIV",
        "XLV",
        "XLVI",
        "XLVII",
        "XLVIII",
        "XLIX",
        "L",
        "LI",
        "LII",
        "LIII",
        "LIV",
        "LV",
        "LVI",
        "LVII",
        "LVIII",
        "LIX",
        "LX",
        "LXI",
        "LXII",
        "LXIII",
        "LXIV",
        "LXV",
        "LXVI",
        "LXVII",
        "LXVIII",
        "LXIX",
        "LXX",
        "LXXI",
        "LXXII",
        "LXXIII",
        "LXXIV",
        "LXXV",
        "LXXVI",
        "LXXVII",
        "LXXVIII",
        "LXXIX",
        "LXXX",
        "LXXXI",
        "LXXXII",
        "LXXXIII",
        "LXXXIV",
        "LXXXV",
        "LXXXVI",
        "LXXXVII",
        "LXXXVIII",
        "LXXXIX",
        "XC",
        "XCI",
        "XCII",
        "XCIII",
        "XCIV",
        "XCV",
        "XCVI",
        "XCVII",
        "XCVIII",
        "XCIX",
        "C"
    ];
    opt.ii = 0;
    while (opt.ii < 10) {
        local.assertJsonEqual(
            local.numberToRomanNumerals(opt.ii),
            opt.list[opt.ii]
        );
        opt.ii += 1;
    }
    onError(null, opt);
};

local.testCase_objectSetDefault_default = function (opt, onError) {
/*
 * this function will test objectSetDefault's default handling-behavior
 */
    // test null-case handling-behavior
    local.objectSetDefault();
    local.objectSetDefault({});
    // test falsy handling-behavior
    [
        "", 0, false, null, undefined
    ].forEach(function (aa) {
        [
            "", 0, false, null, undefined
        ].forEach(function (bb) {
            local.assertJsonEqual(
                local.objectSetDefault({
                    data: aa
                }, {
                    data: bb
                }).data,
                (aa === 0 || aa === false || bb === undefined)
                ? aa
                : bb
            );
        });
    });
    // test non-recursive handling-behavior
    local.assertJsonEqual(local.objectSetDefault({
        aa: 0,
        bb: {
            cc: 1
        },
        cc: {
            dd: {}
        },
        dd: [
            1, 1
        ],
        ee: [
            1, 1
        ]
    }, {
        aa: 2,
        bb: {
            dd: 2
        },
        cc: {
            dd: {
                ee: 2
            }
        },
        dd: [
            2, 2
        ],
        ee: {
            ff: 2
        }
    // test default-depth handling-behavior
    }, null), {
        aa: 0,
        bb: {
            cc: 1
        },
        cc: {
            dd: {}
        },
        dd: [
            1, 1
        ],
        ee: [
            1, 1
        ]
    });
    // test recursive handling-behavior
    local.assertJsonEqual(local.objectSetDefault({
        aa: 0,
        bb: {
            cc: 1
        },
        cc: {
            dd: {}
        },
        dd: [
            1, 1
        ],
        ee: [
            1, 1
        ]
    }, {
        aa: 2,
        bb: {
            dd: 2
        },
        cc: {
            dd: {
                ee: 2
            }
        },
        dd: [
            2, 2
        ],
        ee: {
            ff: 2
        }
    // test depth handling-behavior
    }, 2), {
        aa: 0,
        bb: {
            cc: 1,
            dd: 2
        },
        cc: {
            dd: {}
        },
        dd: [
            1, 1
        ],
        ee: [
            1, 1
        ]
    });
    onError(null, opt);
};

local.testCase_objectSetOverride_default = function (opt, onError) {
/*
 * this function will test objectSetOverride's default handling-behavior
 */
    // test null-case handling-behavior
    local.objectSetOverride();
    local.objectSetOverride({});
    // test falsy handling-behavior
    [
        "", 0, false, null, undefined
    ].forEach(function (aa) {
        [
            "", 0, false, null, undefined
        ].forEach(function (bb) {
            local.assertJsonEqual(
                local.objectSetOverride({
                    data: aa
                }, {
                    data: bb
                }).data,
                bb === undefined
                ? aa
                : bb
            );
        });
    });
    // test non-recursive handling-behavior
    local.assertJsonEqual(local.objectSetOverride({
        aa: 1,
        bb: {
            cc: 1
        },
        cc: {
            dd: 1
        },
        dd: [
            1, 1
        ],
        ee: [
            1, 1
        ]
    }, {
        aa: 2,
        bb: {
            dd: 2
        },
        cc: {
            ee: 2
        },
        dd: [
            2, 2
        ],
        ee: {
            ff: 2
        }
    // test default-depth handling-behavior
    }, null), {
        aa: 2,
        bb: {
            dd: 2
        },
        cc: {
            ee: 2
        },
        dd: [
            2, 2
        ],
        ee: {
            ff: 2
        }
    });
    // test recursive handling-behavior
    local.assertJsonEqual(local.objectSetOverride({
        aa: 1,
        bb: {
            cc: 1
        },
        cc: {
            dd: 1
        },
        dd: [
            1, 1
        ],
        ee: [
            1, 1
        ]
    }, {
        aa: 2,
        bb: {
            dd: 2
        },
        cc: {
            ee: 2
        },
        dd: [
            2, 2
        ],
        ee: {
            ff: 2
        }
    // test depth handling-behavior
    }, 2), {
        aa: 2,
        bb: {
            cc: 1,
            dd: 2
        },
        cc: {
            dd: 1,
            ee: 2
        },
        dd: [
            2, 2
        ],
        ee: {
            ff: 2
        }
    });
    // test env with empty-string handling-behavior
    local.assertJsonEqual(local.objectSetOverride(
        local.env,
        {
            "emptyString": null
        },
        // test default-depth handling-behavior
        null,
        local.env
    ).emptyString, "");
    onError(null, opt);
};

local.testCase_onErrorDefault_default = function (opt, onError) {
/*
 * this function will test onErrorDefault's default handling-behavior
 */
    local.testMock([
        [
            console, {
                error: function (arg) {
                    opt = arg;
                }
            }
        ], [
            globalThis, {
                __coverage__: null
            }
        ]
    ], function (onError) {
        // test no err handling-behavior
        local.onErrorDefault();
        // validate opt
        local.assertThrow(!opt, opt);
        // test err handling-behavior
        local.onErrorDefault(local.errDefault);
        // validate opt
        local.assertThrow(opt, opt);
        onError(null, opt);
    }, onError);
};

local.testCase_onErrorThrow_err = function (opt, onError) {
/*
 * this function will test onErrorThrow's err handling-behavior
 */
    local.tryCatchOnError(function () {
        local.onErrorThrow(local.errDefault);
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        onError(null, opt);
    });
};

local.testCase_onErrorWithStack_toString = function (opt, onError) {
/*
 * this function will test onErrorWithStack's toString handling-behavior
 */
    local.assertJsonEqual(
        String(local.onErrorWithStack(local.nop)),
        String(local.nop)
    );
    onError(null, opt);
};

local.testCase_onFileModifiedRestart_watchFile = function (opt, onError) {
/*
 * this function will test onFileModifiedRestart's watchFile handling-behavior
 */
    var onParallel;
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    onParallel = local.onParallel(onError);
    onParallel.counter += 1;
    local.fs.stat(__filename, function (err, stat) {
        // test default watchFile handling-behavior
        onParallel.counter += 1;
        local.fs.utimes(__filename, stat.atime, new Date(), onParallel);
        // test nop watchFile handling-behavior
        onParallel.counter += 1;
        setTimeout(function () {
            local.fs.utimes(__filename, stat.atime, stat.mtime, onParallel);
        }, 1000);
        onParallel(err, opt);
    });
};

local.testCase_onNext_err = function (opt, onError) {
/*
 * this function will test onNext's err handling-behavior
 */

    opt = {};
    opt.modeDebug = true;
    local.onNext(opt, function () {
        throw local.errDefault;
    });
    opt.modeNext = 0;
    local.tryCatchOnError(function () {
        opt.onNext();
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        onError(null, opt);
    });
};

local.testCase_onParallelList_default = function (opt, onError) {
/*
 * this function will test onParallelList's default handling-behavior
 */
    opt = {};
    local.onNext(opt, function (err) {
        switch (opt.modeNext) {
        case 1:
            // test null-case handling-behavior
            local.onParallelList({}, local.onErrorThrow, opt.onNext);
            break;
        case 2:
            opt.list = [
                null
            ];
            // test retryLimit handling-behavior
            opt.retryLimit = 1;
            local.onParallelList(opt, function (option2, onParallel) {
                onParallel.counter += 1;
                // test err handling-behavior
                onParallel(local.errDefault, option2);
                // test multiple-callback handling-behavior
                setTimeout(onParallel, 5000);
            }, function (err) {
                // validate err occurred
                local.assertThrow(err, err);
                opt.onNext();
            });
            break;
        case 3:
            opt.data = [];
            // test rateLimit handling-behavior
            opt.rateLimit = 3;
            opt.rateMax = 0;
            // test retryLimit handling-behavior
            opt.retryLimit = 1;
            local.onParallelList({
                list: [
                    1, 2, 3, 4
                ],
                rateLimit: opt.rateLimit
            }, function (option2, onParallel) {
                onParallel.counter += 1;
                opt.rateMax = Math.max(
                    onParallel.counter - 1,
                    opt.rateMax
                );
                // test async handling-behavior
                setTimeout(function () {
                    // test list-growth handling-behavior
                    if (option2.ii === 3) {
                        option2.list.push(5);
                    }
                    opt.data[option2.ii] = option2.elem;
                    // test retry handling-behavior
                    local.assertThrow(option2.retry < 1);
                    onParallel(null, option2);
                });
            }, opt.onNext, opt.rateLimit);
            break;
        case 4:
            // validate data
            local.assertJsonEqual(opt.data, [
                1, 2, 3, 4, 5
            ]);
            local.assertJsonEqual(opt.rateMax, 3);
            opt.data = [];
            opt.rateLimit = "syntax-err";
            opt.rateMax = 0;
            local.onParallelList({
                list: [
                    1, 2, 3, 4, 5
                ],
                rateLimit: opt.rateLimit
            }, function (option2, onParallel) {
                // test sync handling-behavior
                onParallel.counter += 1;
                opt.rateMax = Math.max(onParallel.counter, opt.rateMax);
                opt.data[option2.ii] = option2.elem;
                onParallel(null, opt);
            }, opt.onNext);
            break;
        case 5:
            // validate data
            local.assertJsonEqual(opt.data, [
                1, 2, 3, 4, 5
            ]);
            local.assertJsonEqual(opt.rateMax, 2);
            opt.onNext();
            break;
        default:
            onError(err, opt);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.testCase_onParallel_default = function (opt, onError) {
/*
 * this function will test onParallel's default handling-behavior
 */
    var onParallel;
    var onParallelError;
    // test onEach handling-behavior
    onParallel = local.onParallel(onError, function () {
        // validate counter
        local.assertThrow(onParallel.counter >= 0, onParallel);
    });
    onParallel.counter += 1;
    // test multiple-task handling-behavior
    onParallel.counter += 1;
    setTimeout(function () {
        onParallelError = local.onParallel(onParallel);
        onParallelError.counter += 1;
        onParallelError();
        // test multiple-callback-error handling-behavior
        onParallelError();
        // validate err occurred
        local.assertThrow(onParallelError.err, onParallelError.err);
        // test err handling-behavior
        onParallelError(local.errDefault);
        // validate err occurred
        local.assertThrow(onParallelError.err, onParallelError.err);
        // test ignore-after-error handling-behavior
        onParallelError();
    });
    // test default handling-behavior
    onParallel(null, opt);
};

local.testCase_onTimeout_timeout = function (opt, onError) {
/*
 * this function will test onTimeout's timeout handling-behavior
 */
    opt = local.timeElapsedStart();
    local.onTimeout(function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        // validate err.message
        local.assertThrow(
            err.message.indexOf("testCase_onTimeout_timeout") >= 0,
            err
        );
        // poll timeElapsed
        local.timeElapsedPoll(opt);
        // validate timeElapsed passed is greater than timeout
        local.assertThrow(opt.timeElapsed >= 1000, opt);
        onError(null, opt);
    }, 1000, "testCase_onTimeout_timeout");
};

local.testCase_profileXxx_default = function (opt, onError) {
/*
 * this function will test profileXxx's default handling-behavior
 */
    opt = {};
    // test profileSync's handling-behavior
    opt.timeElapsed = local.profileSync(function () {
        return;
    });
    // validate timeElapsed
    local.assertThrow(
        0 <= opt.timeElapsed && opt.timeElapsed < 1000,
        opt.timeElapsed
    );
    // test profile's async handling-behavior
    local.profile(function (onError) {
        setTimeout(onError);
    }, function (err, timeElapsed) {
        // validate no err occurred
        local.assertThrow(!err, err);
        opt.timeElapsed = timeElapsed;
        // validate timeElapsed
        local.assertThrow((
            0 <= opt.timeElapsed
            && opt.timeElapsed < local.timeoutDefault
        ), opt.timeElapsed);
        onError(null, opt);
    });
};

local.testCase_replStart_default = function (opt, onError) {
/*
 * this function will test replStart's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.replStart();
    // coverage-hack - test replStart's muliple-call handling-behavior
    local.replStart();
    local.testMock([
        [
            local.child_process, {
                spawn: function () {
                    return {
                        on: function (evt, callback) {
                            callback(null, evt);
                        }
                    };
                }
            }
        ],
        // suppress process.stdout
        [
            process.stdout, {
                write: local.nop
            }
        ]
    ], function (onError) {
        [
            // test null-case handling-behavior
            "",
            // test shell handling-behavior
            "$ :\n",
            // test git diff handling-behavior
            "$ git diff\n",
            // test git log handling-behavior
            "$ git log\n",
            // test charCode handling-behavior
            "charCode abcd\n",
            // test charSort handling-behavior
            "charSort abcd\n",
            // test grep handling-behavior
            "grep \\baa\\b\n",
            // test keys handling-behavior
            "keys {}\n",
            // test print handling-behavior
            "print abcd\n",
            // test err handling-behavior
            "undefined()\n"
        ].forEach(function (script) {
            globalThis.utility2_repl1.eval(script, null, "repl", local.nop);
        });
        // test err handling-behavior
        globalThis.utility2_repl1.onError(local.errDefault);
        onError(null, opt);
    }, onError);
};

local.testCase_replStart_tcp = function (opt, onError) {
/*
 * this function will test replStart's tcp handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = {};
    opt.data = "";
    opt.input = Math.random();
    opt.socket = local.net.createConnection(local.env.PORT_REPL);
    opt.socket.on("data", function (data) {
    /*
     * this function will concat data to opt.data
     */
        opt.data += data;
    });
    opt.socket.setEncoding("utf8");
    opt.socket.on("end", function () {
        // validate data
        local.assertThrow(
            opt.data.indexOf(opt.input) >= 0,
            JSON.stringify([
                opt.data, opt.input
            ])
        );
        onError(null, opt);
    });
    opt.socket.write(opt.input + "\n");
    // test err handling-behavior
    opt.socket.end("undefined()\n");
};

local.testCase_requireReadme_start = function (opt, onError) {
/*
 * this function will test requireReadme's start handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.testMock([
        [
            local, {
                assetsDict: {},
                onFileModifiedRestart: local.nop
            }
        ], [
            local.env, {
                npm_config_mode_start: "1",
                npm_package_nameLib: "_testCase_requireReadme_start"
            }
        ], [
            local.fs, {
                readFile: function (file, opt, onError) {
                    onError(null, "{}", file, opt);
                },
                readdirSync: function () {
                    // test jslintAndPrint.conditional handling-behavior
                    return [
                        "aa.css",
                        "aa.html",
                        "aa.js",
                        "aa.json",
                        "aa.rollup.js",
                        "assets.swgg.swagger.json"
                    ];
                }
            }
        ]
    ], function (onError) {
        // validate data
        local.requireReadme();
        local.assertThrow(local._testCase_requireReadme_start === local);
        onError(null, opt);
    }, onError);
};

local.testCase_semverCompare_default = function (opt, onError) {
/*
 * this function will test semverCompare's default handling-behavior
 */
    var aa;
    // test aa = bb
    opt = [
        "1.2.3",
        "1.2.3-",
        "1.2.3-alpha.beta",
        "1.2.3-alpha.beta"
    ];
    opt.forEach(function (bb, ii) {
        if (Boolean(ii & 1)) {
            local.assertThrow(
                local.semverCompare(aa, bb) === 0,
                [
                    local.semverCompare(aa, bb), aa, bb
                ]
            );
        }
        aa = bb;
    });
    opt = [
        "1.2.3-a",
        "1.2.3-a.2",
        "1.2.3-a.10",
        "1.2.3-b",
        "1.2.3",
        "1.2.10"
    ];
    // test aa < bb
    opt.reduce(function (aa, bb) {
        local.assertThrow(
            local.semverCompare(aa, bb) === -1,
            [
                local.semverCompare(aa, bb), aa, bb
            ]
        );
        return bb;
    });
    // test aa > bb
    opt.reverse().reduce(function (aa, bb) {
        local.assertThrow(
            local.semverCompare(aa, bb) === 1,
            [
                local.semverCompare(aa, bb), aa, bb
            ]
        );
        return bb;
    });
    onError(null, opt);
};

local.testCase_serverRespondTimeoutDefault_timeout = function (
    opt,
    onError
) {
/*
 * this function will test
 * serverRespondTimeoutDefault's timeout handling-behavior
 */
    opt = function (fnc1, fnc2) {
        [
            fnc1, fnc2
        ].forEach(function (fnc) {
            if (typeof fnc === "function") {
                fnc();
            }
        });
    };
    local.testMock([
        [
            local, {
                onTimeout: opt,
                serverRespondDefault: local.nop,
                setTimeout: opt
            }
        ]
    ], function (onError) {
        local.serverRespondTimeoutDefault({
            headers: {}
        }, {
            on: opt
        });
        onError(null, opt);
    }, onError);
};

local.testCase_setTimeoutOnError_default = function (opt, onError) {
/*
 * this function will test setTimeoutOnError's default handling-behavior
 */
    // test null-case handling-behavior
    local.assertJsonEqual(local.setTimeoutOnError(), undefined);
    // test onError handling-behavior
    local.assertJsonEqual(
        local.setTimeoutOnError(onError, 0, null, {}, opt),
        {}
    );
};

local.testCase_sjclHashScryptXxx_default = function (opt, onError) {
/*
 * this function will test sjclHashScryptXxx's default handling-behavior
 */
    // test sjclHashScryptCreate's null-case handling-behavior
    local.assertJsonEqual(
        local.sjclHashScryptCreate().slice(0, 10),
        "$s0$10801$"
    );
    // https://github.com/wg/scrypt
    // test sjclHashScryptValidate's fail handling-behavior
    local.assertJsonEqual(local.sjclHashScryptValidate(
        "password",
        (
            "$s0$80801$epIxT/h6HbbwHaehFnh/bw=="
            + "$l/guDhz2Q0v/D93gq0K0qtSX6FWP8pH5maAJkbIcRaEA"
        )
    ), false);
    // https://github.com/wg/scrypt
    // test sjclHashScryptValidate's pass handling-behavior
    local.assertJsonEqual(local.sjclHashScryptValidate("password", (
        "$s0$80801$epIxT/h6HbbwHaehFnh/bw=="
        + "$l/guDhz2Q0v/D93gq0K0qtSX6FWP8pH5maAJkbIcRaE="
    )), true);
    onError(null, opt);
};

local.testCase_sjclHashShaXxxCreate_default = function (opt, onError) {
/*
 * this function will test sjclHashShaXxxCreate's default handling-behavior
 */
    local.assertJsonEqual(
        local.sjclHashSha1Create("aa"),
        "4MkDWJjdUvxlxBRUzsnE0mEb+zc="
    );
    local.assertJsonEqual(
        local.sjclHashSha256Create("aa"),
        "lhtt0+3jy47LqsvWjeBAzXjrLtWIkTDM60xJJo6k1QY="
    );
    onError(null, opt);
};

local.testCase_sjclHmacShaXxx_default = function (opt, onError) {
/*
 * this function will test sjclHmacShaXxx's default handling-behavior
 */
    local.assertJsonEqual(
        local.sjclHmacSha1Create("aa", "bb"),
        "15pOinCz63A+qZoxnv+mJB6UF1k="
    );
    local.assertJsonEqual(
        local.sjclHmacSha256Create("aa", "bb"),
        "94Xv3VdPHA+ohKyjkM1pb0W5ZVAuMVcmIAAI2AqNRCQ="
    );
    onError(null, opt);
};

local.testCase_stringHtmlSafe_default = function (opt, onError) {
/*
 * this function will test stringHtmlSafe's default handling-behavior
 */
    local.assertJsonEqual(
        local.stringHtmlSafe(
            local.stringHtmlSafe(local.stringCharsetAscii).slice(32, -1)
        ),
        (
            " !&quot;#$%&amp;&apos;()*+,-./0123456789:;&lt;=&gt;?@"
            + "ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"
        )
    );
    onError(null, opt);
};

local.testCase_stringQuotedToAscii_default = function (opt, onError) {
/*
 * this function will test stringQuotedToAscii's default handling-behavior
 */
    local.assertJsonEqual(
        local.stringQuotedToAscii(local.stringHelloEmoji),
        "hello \\ud83d\\ude01\n"
    );
    onError(null, opt);
};

local.testCase_stringRegexpEscape_default = function (opt, onError) {
/*
 * this function will test stringRegexpEscape's default handling-behavior
 */
    local.assertJsonEqual(
        local.stringRegexpEscape(local.stringCharsetAscii),
        (
            "\u0000\u0001\u0002\u0003\u0004\u0005\u0006\u0007"
            + "\b\t\n\u000b\f\r\u000e\u000f"
            + "\u0010\u0011\u0012\u0013\u0014\u0015\u0016\u0017"
            + "\u0018\u0019\u001a\u001b\u001c\u001d\u001e\u001f"
            + " !\"#\\$%&'\\(\\)\\*\\+,\\-\\.\\/0123456789:;<=>\\?@"
            + "ABCDEFGHIJKLMNOPQRSTUVWXYZ\\[\\\\\\]\\^_`"
            + "abcdefghijklmnopqrstuvwxyz\\{\\|\\}~"
            + "\u007f"
        )
    );
    onError(null, opt);
};

local.testCase_stringTruncate_default = function (opt, onError) {
/*
 * this function will test stringTruncate's default handling-behavior
 */
    local.assertJsonEqual(local.stringTruncate("aa"), "aa");
    local.assertJsonEqual(local.stringTruncate("aa", 1), "...");
    local.assertJsonEqual(local.stringTruncate("aa", 2), "aa");
    onError(null, opt);
};

local.testCase_stringUniqueKey_default = function (opt, onError) {
/*
 * this function will test stringUniqueKey's default handling-behavior
 */
    local.assertThrow(("zqxj").indexOf(local.stringUniqueKey("zqxj") < 0));
    onError(null, opt);
};

local.testCase_taskCreateCached_default = function (opt, onError) {
/*
 * this function will test taskCreateCached's default handling-behavior
 */
    var cacheValue;
    var onTask;
    var option2;
    opt = {};
    local.onNext(opt, function (err, data) {
        switch (opt.modeNext) {
        // test no cache handling-behavior
        case 1:
            onTask = function (onError) {
                onError(null, cacheValue);
            };
            opt.cacheDict = "testCase_taskCreateCached_default";
            opt.key = "memory";
            // cleanup memory-cache
            local.cacheDict[opt.cacheDict] = null;
            cacheValue = "aa";
            option2 = {
                cacheDict: opt.cacheDict,
                key: opt.key,
                // test onCacheWrite handling-behavior
                onCacheWrite: opt.onNext
            };
            local.taskCreateCached(option2, onTask, opt.onNext);
            break;
        case 2:
            // validate data
            local.assertJsonEqual(data, "aa");
            // validate no cache-hit
            local.assertThrow(!option2.modeCacheHit, option2.modeCacheHit);
            break;
        // test cache with update handling-behavior
        case 3:
            cacheValue = "bb";
            option2 = {
                cacheDict: opt.cacheDict,
                key: opt.key,
                // test modeCacheUpdate handling-behavior
                modeCacheUpdate: true,
                // test onCacheWrite handling-behavior
                onCacheWrite: opt.onNext
            };
            local.taskCreateCached(option2, onTask, opt.onNext);
            break;
        case 4:
            // validate data
            local.assertJsonEqual(data, "aa");
            // validate modeCacheHit
            local.assertJsonEqual(option2.modeCacheHit, true);
            break;
        // test cache handling-behavior
        case 5:
            option2 = {
                cacheDict: opt.cacheDict,
                key: opt.key
            };
            local.taskCreateCached(option2, onTask, opt.onNext);
            break;
        case 6:
            // validate data
            local.assertJsonEqual(data, "bb");
            // validate modeCacheHit
            local.assertJsonEqual(option2.modeCacheHit, true);
            opt.onNext();
            break;
        default:
            onError(err, opt);
        }
    });
    opt.modeNext = 0;
    opt.onNext();
};

local.testCase_taskCreate_multipleCallback = function (opt, onError) {
/*
 * this function will test taskCreate's multiple-callback handling-behavior
 */
    opt = {
        counter: 0,
        key: "testCase_taskCreate_multiCallback"
    };
    local.taskCreate(opt, function (onError) {
        onError(null, opt);
        // test multiple-callback handling-behavior
        onError(null, opt);
    }, function () {
        opt.counter += 1;
    });
    // validate counter incremented once
    local.assertJsonEqual(opt.counter, 1);
    onError(null, opt);
};

local.testCase_taskCreate_upsert = function (opt, onError) {
/*
 * this function will test taskCreate's upsert handling-behavior
 */
    opt = {
        counter: 0,
        key: "testCase_taskCreate_upsert"
    };
    // test upsert handling-behavior
    [
        null, null
    ].forEach(function () {
        local.taskCreate(opt, function (onError) {
            opt.counter += 1;
            setTimeout(onError);
        });
    });
    // validate counter incremented once
    setTimeout(function () {
        local.assertJsonEqual(opt.counter, 1);
        onError(null, opt);
    });
};

local.testCase_templateRender_default = function (opt, onError) {
/*
 * this function will test templateRender's default handling-behavior
 */
    // test null-case handling-behavior
    local.assertJsonEqual(local.templateRender(), "");
    // test undefined-value handling-behavior
    local.assertJsonEqual(local.templateRender("{{aa}}", {}), "{{aa}}");
    // test basic handling-behavior
    local.assertJsonEqual(local.templateRender("{{aa}}", {
        aa: "```<aa\nbb>```"
    }), "```&lt;aa\nbb&gt;```");
    // test markdownToHtml handling-behavior
    local.assertJsonEqual(
        local.templateRender("{{aa markdownToHtml}}", {
            aa: local.stringCharsetAscii.slice(32, -1)
        }),
        (
            "<p> !&quot;#$%&amp;&apos;()*+,-./0123456789:;&lt;=&gt;?@"
            + "ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~"
            + "</p>\n"
        )
    );
    // test markdownSafe handling-behavior
    local.assertJsonEqual(
        local.templateRender("{{aa markdownSafe notHtmlSafe}}", {
            aa: local.stringCharsetAscii.slice(32, -1)
        }),
        (
            " !\"#$%&'()*+,-./0123456789:;<=>?@"
            + "ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_'abcdefghijklmnopqrstuvwxyz{|}~"
        )
    );
    // test notHtmlSafe handling-behavior
    local.assertJsonEqual(local.templateRender("{{aa notHtmlSafe}}", {
        aa: "```<aa\nbb>```"
    }), "```<aa\nbb>```");
    // test default handling-behavior
    local.assertJsonEqual(local.templateRender((
        "{{aa alphanumeric}} "
        + "{{aa truncate 4 truncate 4}} "
        + "{{aa jsonStringify jsonStringify4 decodeURIComponent"
        + " encodeURIComponent trim}} "
        + "{{bb}} {{cc}} {{dd}} {{ee.ff}}"
    ), {
        // test string value handling-behavior
        aa: "`<aa>`",
        // test non-string value handling-behavior
        bb: 1,
        // test null-value handling-behavior
        cc: null,
        // test undefined-value handling-behavior
        dd: undefined,
        // test nested value handling-behavior
        ee: {
            ff: "gg"
        }
    }), "__aa__ `... %22%5C%22%60%3Caa%3E%60%5C%22%22 1 null {{dd}} gg");
    // test partial handling-behavior
    local.assertJsonEqual(
        local.templateRender((
            "{{#undefined aa}}\n"
            + "list1{{#each list1}}\n"
            + "    aa - {{aa}}\n"
            + "    list2{{#eachTrimRightComma list2}}\n"
            + "        {{#this/ notHtmlSafe jsonStringify}}\n"
            + "        bb - {{bb}}\n"
            + "        {{#if bb}}\n"
            + "        if\n"
            + "        {{#unless bb}}\n"
            + "        else\n"
            + "        {{/if bb}}\n"
            + "        {{#unless bb}}\n"
            + "        unless\n"
            + "        {{/unless bb}}\n"
            + "        ,\n"
            + "    {{/eachTrimRightComma list2}}\n"
            + "{{/each list1}}\n"
            + "{{/undefined aa}}\n"
        ), {
            list1: [
                // test null-value handling-behavior
                null, {
                    aa: "aa",
                    // test recursive-list handling-behavior
                    list2: [
                        {
                            bb: "bb"
                        }, {
                            bb: null
                        }
                    ]
                }
            ]
        }),
        (
            "{{#undefined aa}}\n"
            + "list1\n"
            + "    aa - {{aa}}\n"
            + "    list2\n"
            + "\n"
            + "    aa - aa\n"
            + "    list2\n"
            + "        {\"bb\":\"bb\"}\n"
            + "        bb - bb\n"
            + "        \n"
            + "        if\n"
            + "        \n"
            + "        \n"
            + "        ,\n"
            + "    \n"
            + "        {\"bb\":null}\n"
            + "        bb - null\n"
            + "        \n"
            + "        else\n"
            + "        \n"
            + "        \n"
            + "        unless\n"
            + "        \n"
            + "        \n"
            + "\n"
            + "{{/undefined aa}}\n"
        )
    );
    // test err handling-behavior
    local.tryCatchOnError(function () {
        local.templateRender("{{aa bb}}", {
            aa: 1
        });
    }, local.nop);
    // validate err occurred
    local.assertThrow(local._debugTryCatchError, local._debugTryCatchError);
    onError(null, opt);
};

local.testCase_testReportCreate_default = function (opt, onError) {
/*
 * this function will test testReport's default handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.testMock([], function (onError) {
        // test null-case handling-behavior
        local.testReportCreate();
        // test testsFailed handling-behavior
        local.testReportCreate({
            testPlatformList: [
                {
                    testCaseList: [
                        {
                            status: "failed"
                        }, {
                            status: "passed"
                        }
                    ]
                }
            ]
        });
        onError(null, opt);
    }, onError);
};

local.testCase_throwError_default = function (opt, onError) {
/*
 * this function will test throwError's default handling-behavior
 */
    local.tryCatchOnError(function () {
        local.throwError();
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        onError(null, opt);
    });
};

local.testCase_uiAnimateXxx_default = function (opt, onError) {
/*
 * this function will test uiAnimateXxx's default handling-behavior
 */
    if (!local.isBrowser) {
        onError(null, opt);
        return;
    }
    opt = document.createElement("div");
    // test uiAnimateShake handling-behavior
    local.uiAnimateShake();
    local.uiAnimateShake(opt);
    local.assertThrow(
        opt.classList.contains("uiAnimateShake"),
        opt.classList
    );
    local.uiAnimateShake(opt);
    local.assertThrow(
        opt.classList.contains("uiAnimateShake"),
        opt.classList
    );
    // test uiAnimateShakeIfError handling-behavior
    local.uiAnimateShakeIfError();
    local.uiAnimateShakeIfError(null, opt);
    local.assertThrow(
        !opt.classList.contains("hasError"),
        opt.classList
    );
    local.uiAnimateShakeIfError(true, opt);
    local.assertThrow(opt.classList.contains("hasError"), opt.classList);
    local.uiAnimateShakeIfError(null, opt);
    local.assertThrow(!opt.classList.contains("hasError"), opt.classList);
    // test uiAnimateSlideXxx handling-behavior
    local.uiAnimateSlideDown();
    local.uiAnimateSlideUp();
    opt.classList.add("uiAnimateSlide");
    local.uiAnimateSlideDown(opt);
    local.assertThrow(
        opt.style.maxHeight.indexOf("px") >= 0,
        opt.style.maxHeight
    );
    local.uiAnimateSlideUp(opt);
    local.assertJsonEqual(opt.style.maxHeight, "0px");
    // test uiAnimateSlideAccordian handling-behavior
    local.uiAnimateSlideAccordian(
        opt,
        [
            opt, document.createElement("div")
        ]
    );
    onError(null, opt);
};

local.testCase_urlJoin_default = function (opt, onError) {
/*
 * this function will test urlJoin's default handling-behavior
 */
    local.assertJsonEqual(local.urlJoin("", ""), "/");
    local.assertJsonEqual(local.urlJoin("http://aa/bb", "zz"), "http://aa/zz");
    local.assertJsonEqual(
        local.urlJoin("http://aa/bb/", "zz"),
        "http://aa/bb/zz"
    );
    local.assertJsonEqual(
        local.urlJoin("http://aa/bb/", "/zz"),
        "http://aa/zz"
    );
    local.assertJsonEqual(local.urlJoin("http://aa/bb/", "//zz"), "http://zz");
    local.assertJsonEqual(
        local.urlJoin("http://aa/bb/", "http://zz"),
        "http://zz"
    );
    onError(null, opt);
};

local.testCase_urlParse_default = function (opt, onError) {
/*
 * this function will test urlParse's default handling-behavior
 */
    local.testMock([
        [
            local, {
                // test default PORT handling-behavior
                env: {},
                // test init-serverLocalHost handling-behavior
                serverLocalHost: ""
            }
        ]
    ], function (onError) {
        // test default handling-behavior
        local.assertJsonEqual(local.urlParse(
            "https://127.0.0.1:80/foo/bar?aa=1&bb%20cc=dd%20=ee&aa=2&aa#zz=1"
        ), {
            basename: "bar",
            hash: "#zz=1",
            host: "127.0.0.1:80",
            hostname: "127.0.0.1",
            href: (
                "https://127.0.0.1:80/foo/bar"
                + "?aa=1&bb%20cc=dd%20=ee&aa=2&aa#zz=1"
            ),
            path: "/foo/bar?aa=1&bb%20cc=dd%20=ee&aa=2&aa",
            pathname: "/foo/bar",
            port: "80",
            protocol: "https:",
            query: {
                aa: [
                    "1", "2", ""
                ],
                "bb cc": "dd =ee"
            },
            search: "?aa=1&bb%20cc=dd%20=ee&aa=2&aa"
        });
        // test err handling-behavior
        local.assertJsonEqual(local.urlParse(null), {
            basename: "",
            hash: "",
            host: "",
            hostname: "",
            href: "",
            path: "",
            pathname: "",
            port: "",
            protocol: "",
            query: {},
            search: ""
        });
        onError(null, opt);
    }, onError);
};

local.testCase_uuid4Create_default = function (opt, onError) {
/*
 * this function will test uuid4Create's default handling-behavior
 */
    local.assertThrow(
        local.regexpValidateUuid.test(local.uuid4Create()),
        local.uuid4Create()
    );
    onError(null, opt);
};

local.testCase_webpage_err = function (opt, onError) {
/*
 * this function will test webpage's err handling-behavior
 */
    if (local.isBrowser) {
        onError(null, opt);
        return;
    }
    local.browserTest({
        modeCoverageMerge: true,
        modeSilent: true,
        timeoutDefault: local.timeoutDefault - 5000,
        // https://localhost:8080/assets.script_only.html?modeTest=1&modeTestCase=_testCase_testRunDefault_failure&timeExit=
        url: (
            local.serverLocalHost
            // test script_only handling-behavior
            + "/assets.script_only.html"
            // test electron-callback handling-behavior
            + "?modeTest=1&"
            // test specific testCase handling-behavior
            // test testRunDefault's failure handling-behavior
            + "modeTestCase=_testCase_testRunDefault_failure&"
            // test timeExit handling-behavior
            + "timeExit={{timeExit}}"
        )
    }, function (err) {
        // validate err occurred
        local.assertThrow(err, err);
        onError(null, opt);
    });
};

local.utility2.serverLocalUrlTest = function (url) {
/*
 * this function will test if the url is local
 */
    url = local.urlParse(url).pathname;
    return local.isBrowser && !local.env.npm_config_mode_backend && (
        /^\/test\./
    ).test(url);
};
}());



// run shared js-env code - init-after
(function () {
// init assets
local.assetsDict["/assets.swgg.swagger.json"] = (
    local.fsReadFileOrEmptyStringSync("assets.swgg.swagger.json")
    || local.assetsDict["/assets.swgg.swagger.json"]
    || local.assetsDict["/assets.swgg.swagger.petstore.json"]
);
// coverage-hack - re-run test-server
local.testRunServer(local);
// coverage-hack - stateInit
local.stateInit({});
// init test-middleware
local.middlewareList.push(function (req, res, next) {
/*
 * this function will run the test-middleware
 */
    switch (req.urlParsed.pathname) {
    // test http POST handling-behavior
    case "/test.body":
        // test req-body-read handling-behavior
        local.middlewareBodyRead(req, res, function () {
            // test multiple req-body-read handling-behavior
            local.middlewareBodyRead(req, res, function () {
                res.write(req.bodyRaw);
                res.end();
            });
        });
        break;
    // test http POST handling-behavior
    case "/test.echo":
        // test res-header handling-behavior
        local.serverRespondHeadSet(req, res, null, {
            "X-Res-Header-Test": "bb"
        });
        local.serverRespondEcho(req, res);
        break;
    // test 500-internal-server-error handling-behavior
    case "/test.err-500":
        // test multiple-callback serverRespondHeadSet handling-behavior
        local.serverRespondHeadSet(req, res, null, {});
        next(local.errDefault);
        // test multiple-callback-error handling-behavior
        next(local.errDefault);
        // test onErrorDefault handling-behavior
        local.testMock([
            [
                local, {
                    swgg: null
                }
            ]
        ], function (onError) {
            var err;
            err = new Error("error");
            err.statusCode = 500;
            local.middlewareError(err, req, res);
            onError();
        }, local.onErrorThrow);
        break;
    // test undefined-status-code handling-behavior
    case "/test.err-undefined":
        local.serverRespondDefault(req, res, 999);
        break;
    // test timeout handling-behavior
    case "/test.timeout":
        setTimeout(function () {
            res.end();
        }, 2000);
        break;
    // serve file
    default:
        local.middlewareFileServer(req, res, next);
    }
});
}());



// run node js-env code - init-after
/* istanbul ignore next */
(function () {
if (local.isBrowser) {
    return;
}



(function () {
    switch (local.env.HEROKU_APP_NAME) {
    case "h1-cron1":
        // heroku-keepalive
        setInterval(function () {
            local.ajax({
                url: "https://h1-cron1.herokuapp.com"
            }, local.onErrorThrow);
        }, 5 * 60 * 1000);
        local.cronJob = local.nop;
        // update cron
        local.ajax({
            url: "https://kaizhu256.github.io/node-utility2/cronJob.js"
        }, function (err, xhr) {
            if (!err && xhr.responseText !== local.cronScript) {
                local.cronScript = xhr.responseText;
                local.vm.runInThisContext(local.cronScript);
            }
        });
        setInterval(function () {
            var cronTime;
            cronTime = new Date();
            if (
                cronTime.toISOString().slice(0, 16)
                < (local.cronTime && local.cronTime.toISOString())
            ) {
                return;
            }
            local.cronTime = cronTime;
            // cron every 5 minutes
            if (local.cronTime.getUTCMinutes() % 5 === 0) {
                // update cron
                local.ajax({
                    url: "https://kaizhu256.github.io/node-utility2/cronJob.js"
                }, function (err, xhr) {
                    if (!err && xhr.responseText !== local.cronScript) {
                        local.cronScript = xhr.responseText;
                        local.vm.runInThisContext(local.cronScript);
                    }
                });
            }
            local.cronJob();
        }, 30000);
        break;
    case "h1-proxy1":
        // heroku-keepalive
        setInterval(function () {
            local.ajax({
                url: "https://h1-proxy1.herokuapp.com"
            }, local.onErrorThrow);
        }, 5 * 60 * 1000);
        break;
    }
}());



// init cli
if (module !== require.main || globalThis.utility2_rollup) {
    return;
}
local.assetsDict["/assets.script_only.html"] = (
    "<h1>script_only_test</h1>\n"
    + "<script src=\"assets.utility2.js\"></script>\n"
    + "<script>window.utility2_onReadyBefore.counter += 1;</script>\n"
    + "<script src=\"assets.example.js\"></script>\n"
    + "<script src=\"assets.test.js\"></script>\n"
    + "<script>window.utility2_onReadyBefore();</script>\n"
);
if (process.argv[2]) {
    // start with coverage
    if (local.env.npm_config_mode_coverage) {
        process.argv.splice(1, 1, __dirname + "/lib.istanbul.js", "cover");
        local.istanbul.cliDict[process.argv[2]]();
        return;
    }
    // start
    process.argv.splice(1, 1);
    process.argv[1] = local.path.resolve(process.cwd(), process.argv[1]);
    local.Module.runMain();
}
}());



}());
/* script-end /assets.test.js */



/* script-begin /assets.utility2.rollup.end.js */
(function () {
    "use strict";
    globalThis.utility2_rollup_old = globalThis.utility2_rollup;
    globalThis.utility2_rollup = null;
}());
/* utility2.rollup.js end */
/* script-end /assets.utility2.rollup.end.js */
